diff --git a/jakarta-ant-1.2-src/WHATSNEW b/jakarta-ant-1.2-src/WHATSNEW
index 9abc496..a2c23ec 100644
--- a/jakarta-ant-1.2-src/WHATSNEW
+++ b/jakarta-ant-1.2-src/WHATSNEW
@@ -1,4 +1,136 @@
+Changes from Ant 1.2 to Ant 1.3 Beta 3
+===========================================
+
+Changes that could break older environments:
+--------------------------------------------
+
+* Ant doesn't search for the buildfile anymore, unless you use the new
+  -find argument.
+
+* <perforce> has been replaced by a number of new tasks.
+
+* <javac> is now implemented using a factory. This makes extending
+  javac to use a new compiler a lot easier but may break custom
+  versions of this task that rely on the old implementation.
+
+* The output generated by the xml formatter for <junit> has changed a
+  little, it doesn't append " sec" in the time attribute anymore.
+
+Other changes:
+--------------
+
+* A GUI Frontend: Antidote. This is currently in development. At this
+  time, this is not part of the Ant release, although the source is
+  included if you are interested.
+
+* New tasks: stylebook, propertyfile, depend, antlr, telnet, csc,
+  ilasm, apply, javah, several clearcase tasks, junitreport, sound
+
+* Added output attribute to <java>.
+
+* Added nested zipfileset element to <zip>
+
+* Changed <sql> so that printing is at the task level rather than 
+  the statement level.
+  
+* javadoc task will pass -d flag to any doclet if the destDir attribute is
+  given. If the doclet does not accept the -d flag then omit the destdir
+  attribute.
+
+* <cab> can work on non-Windows platforms with the help of libcabinet. 
+  See http://trill.cis.fordham.edu/~barbacha/cabinet_library/.
+
+* <ftp> now supports passive mode.
+
+* New <mapper> data type that can be used to get influence on the
+  target files for some tasks like <copy> or enable new types of tasks
+  like <apply>.
+
+* <execon> provides more control over the command line now, the names
+  of the source files are no longer required to be at the end of the
+  command.
+
+* Style tasks will now support TraX compliant XSL processors if one is present
+  in your classpath.  
+
+* Added a failonerror to the javac task. If set to false, the build will 
+  continue even if there are compilation errors.
+  
+* Added nested format elements to the tstamp task allowing additional time 
+  formats to be defined for arbitrary properties.   
+
+* Added classpath attribute and nested classpath element to <property>
+  to make the resource attribute more powerful.
+
+* ${} property expansion will now be performed on the patterns read
+  from files specified as includesfile or excludesfile attributes.
+  
+* The <tar> and <untar> tasks now support GNU format for handling paths
+  which are greater than 100 characters in length. In addition the <tar>
+  task now supports nested filesets through which the file permissions
+  may be controlled.
+
+* wlrun, wlstop and ejbjar now support Weblogic 6.0
+
+* The MPasre task has been updated to work with MParse 2.0
+
+* The documentation has been significantly updated.
+
+
+Fixed bugs:
+-----------
+
+* <signjar> doesn't use deprectated methods anymore.
+
+* javadoc's failonerror attribute works again
+
+* javadoc's additionalparam attribute will now be split into separate
+  parameters (on spaces) to allow for more than one parameter.
+
+* Changed <sql> task so that printing result sets works on Oracle
+
+* Changes to ddcreator and ejbc helper to respect the descriptor hierarchy
+  keppgenerated in ejbc can now be turned off
+  
+* ejbjar now correctly ignores <ejb-ref> elements in the deployment descriptor.
+  CMP files are included by parsing the weblogic deployment descriptor rather 
+  than relying on the naming convention used in ant 1.2
+  
+* ejbjar includes super classes and super interfaces into the generated ejb 
+  jar files. The <support> nested element allows support classes to be 
+  included in the EJB jar. The toplink element should now correctly locate
+  the toplink descriptor.
+  
+* <vssget> now correctly deals with spaces in arguments
+
+* <jar> fails early if a given manifest file doesn't exist
+
+* <rmic> doesn't search for the _Skel file anymore when stubversion is
+  set to 1.2.
+
+* <rmic> uses the the same classpath to verify a class can be rmic'd
+  as it passes to the compiler. 
+
+* org.apache.tools.mail.MailMessage (and therefore <mail>) can now
+  handle SMTP servers sending multi line responses.
+
+* nested <classpath> elements of <taskdef> now work for <taskdef>s not
+  nested into <target> as well.
+
+* <property> and <available> will search for the resource "foo" instead
+  of "/org/apache/tools/ant/taskdefs/foo" when given a relative resource
+  name foo.
+  
+* Handle build files in directories whose name contained a "#" character
+
+* <junit> can now log to files whose name contains a comma as well. 
+
+* The AntClassLoader now refers to the loader which loaded it, any 
+  requests it does not handle itself. Previously these went to the 
+  primordial loader.
+
 Changes from Ant 1.1 to Ant 1.2
+===============================
 
 Changes that could break older environments:
 --------------------------------------------
diff --git a/jakarta-ant-1.2-src/bootstrap.bat b/jakarta-ant-1.2-src/bootstrap.bat
index 31e29af..8b1578e 100644
--- a/jakarta-ant-1.2-src/bootstrap.bat
+++ b/jakarta-ant-1.2-src/bootstrap.bat
@@ -18,13 +18,13 @@ if "" == "%JAVAC%"                        set JAVAC=%JAVA_HOME%\bin\javac
 echo.
 echo ... Bootstrapping Ant Distribution
 
-if exist lib\ant.jar erase lib\ant.jar
+if     "%OS%" == "Windows_NT" if exist bootstrap rmdir/s/q bootstrap
+if not "%OS%" == "Windows_NT" if exist bootstrap deltree/y bootstrap
 
-SET LOCALCLASSPATH=
-for %%i in (lib\*.jar) do call src\bin\lcp.bat %%i
+SET LOCALCLASSPATH=lib\parser.jar;lib\jaxp.jar;lib\optional\junit.jar
 
-if exist %JAVA_HOME%\lib\tools.jar call src\bin\lcp.bat %JAVA_HOME%\lib\tools.jar
-if exist %JAVA_HOME%\lib\classes.zip call src\bin\lcp.bat %JAVA_HOME%\lib\classes.zip
+if exist %JAVA_HOME%\lib\tools.jar call src\script\lcp.bat %JAVA_HOME%\lib\tools.jar
+if exist %JAVA_HOME%\lib\classes.zip call src\script\lcp.bat %JAVA_HOME%\lib\classes.zip
 
 set TOOLS=src\main\org\apache\tools
 set CLASSDIR=classes
@@ -39,12 +39,14 @@ echo CLASSPATH=%CLASSPATH%
 if     "%OS%" == "Windows_NT" if exist %CLASSDIR%\nul rmdir/s/q %CLASSDIR%
 if not "%OS%" == "Windows_NT" if exist %CLASSDIR%\nul deltree/y %CLASSDIR%
 
-mkdir %CLASSDIR%
+if not exist %CLASSDIR% mkdir %CLASSDIR%
+if not exist build mkdir build
+if not exist build\classes mkdir build\classes
 
 echo.
 echo ... Compiling Ant Classes
 
-%JAVAC% -d %CLASSDIR% %TOOLS%\tar\*.java %TOOLS%\ant\*.java %TOOLS%\ant\types\*.java %TOOLS%\ant\taskdefs\*.java
+%JAVAC% -d %CLASSDIR% %TOOLS%\tar\*.java %TOOLS%\ant\*.java %TOOLS%\ant\types\*.java %TOOLS%\ant\taskdefs\*.java %TOOLS%\ant\util\*.java %TOOLS%\ant\util\regexp\RegexpMatcher.java %TOOLS%\ant\util\regexp\RegexpMatcherFactory.java
 
 echo.
 echo ... Copying Required Files
@@ -55,7 +57,9 @@ copy %TOOLS%\ant\types\*.properties %CLASSDIR%\org\apache\tools\ant\types
 echo.
 echo ... Building Ant Distribution
 
-%JAVA% %ANT_OPTS% org.apache.tools.ant.Main clean main bootstrap %1 %2 %3 %4 %5
+xcopy /s/q %CLASSDIR% build\classes
+
+%JAVA% %ANT_OPTS% org.apache.tools.ant.Main bootstrap
 
 echo.
 echo ... Cleaning Up Build Directories
diff --git a/jakarta-ant-1.2-src/bootstrap.sh b/jakarta-ant-1.2-src/bootstrap.sh
index 3c5a8c7..c50b50c 100644
--- a/jakarta-ant-1.2-src/bootstrap.sh
+++ b/jakarta-ant-1.2-src/bootstrap.sh
@@ -2,33 +2,12 @@
 
 # You will need to specify JAVA_HOME if compiling with 1.2 or later.
 
-ANT_HOME=.
-export ANT_HOME
-
-if [ -z "$JAVAC" ] ; then
-  JAVAC=javac;
-fi
-
-echo ... Bootstrapping Ant Distribution
-
-if test -f lib/ant.jar ; then
-  rm lib/ant.jar
-fi
-
-LOCALCLASSPATH=`echo $ANT_HOME/lib/*.jar | tr ' ' ':'`
-
-if [ "$CLASSPATH" != "" ] ; then
-  CLASSPATH=$LOCALCLASSPATH:$CLASSPATH
-else
-  CLASSPATH=$LOCALCLASSPATH
-fi
-
 if [ "$JAVA_HOME" != "" ] ; then
-  if test -f $JAVA_HOME/lib/tools.jar ; then
+  if [ -f $JAVA_HOME/lib/tools.jar ] ; then
     CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/tools.jar
   fi
  
-  if test -f $JAVA_HOME/lib/classes.zip ; then
+  if [ -f "$JAVA_HOME/lib/classes.zip" ] ; then
     CLASSPATH=$CLASSPATH:$JAVA_HOME/lib/classes.zip
   fi
 else
@@ -38,33 +17,72 @@ else
   echo "  to the installation directory of java."
 fi
 
+if [ ! -x "$JAVA_HOME/bin/java" ] ; then
+  echo "Error: JAVA_HOME is not defined correctly."
+  echo "  We cannot execute JAVA_HOME/bin/java"
+  exit
+fi
+
+# More Cygwin support
+if [ "$OSTYPE" = "cygwin32" ] || [ "$OSTYPE" = "cygwin" ] ; then
+  CLASSPATH=`cygpath --path --unix "$CLASSPATH"`
+fi
+
+ANT_HOME=.
+export ANT_HOME
+
+if [ -z "$JAVAC" ] ; then
+  JAVAC=${JAVA_HOME}/bin/javac;
+fi
+
+echo ... Bootstrapping Ant Distribution
+
+if [ -d "bootstrap" ] ; then
+  rm -r bootstrap
+fi
+
+CLASSPATH=lib/parser.jar:lib/jaxp.jar:lib/optional/junit.jar:${CLASSPATH}
+
 TOOLS=src/main/org/apache/tools
 CLASSDIR=classes
 
 CLASSPATH=${CLASSDIR}:src/main:${CLASSPATH}
+
+# convert the unix path to windows
+if [ "$OSTYPE" = "cygwin32" ] || [ "$OSTYPE" = "cygwin" ] ; then
+   CLASSPATH=`cygpath --path --windows "$CLASSPATH"`
+fi
+
 export CLASSPATH
 
 mkdir -p ${CLASSDIR}
+mkdir -p build
 
 echo ... Compiling Ant Classes
 
-${JAVAC} -d ${CLASSDIR} ${TOOLS}/tar/*.java
-${JAVAC} -d ${CLASSDIR} ${TOOLS}/ant/types/*.java
-${JAVAC} -d ${CLASSDIR} ${TOOLS}/ant/*.java
-${JAVAC} -d ${CLASSDIR} ${TOOLS}/ant/taskdefs/*.java
+${JAVAC} -d ${CLASSDIR} ${TOOLS}/tar/*.java \
+    ${TOOLS}/ant/util/regexp/RegexpMatcher.java \
+    ${TOOLS}/ant/util/regexp/RegexpMatcherFactory.java \
+    ${TOOLS}/ant/util/*.java ${TOOLS}/ant/types/*.java \
+    ${TOOLS}/ant/*.java ${TOOLS}/ant/taskdefs/*.java
 
 echo ... Copying Required Files
 
-cp src/main/org/apache/tools/ant/taskdefs/defaults.properties ${CLASSDIR}/org/apache/tools/ant/taskdefs
-cp src/main/org/apache/tools/ant/types/defaults.properties ${CLASSDIR}/org/apache/tools/ant/types
+cp src/main/org/apache/tools/ant/taskdefs/defaults.properties \
+    ${CLASSDIR}/org/apache/tools/ant/taskdefs
+cp src/main/org/apache/tools/ant/types/defaults.properties \
+    ${CLASSDIR}/org/apache/tools/ant/types
 
 echo ... Building Ant Distribution
 
-java ${ANT_OPTS} org.apache.tools.ant.Main clean main bootstrap
+cp -r ${CLASSDIR} build
+
+${JAVA_HOME}/bin/java -classpath ${CLASSPATH} org.apache.tools.ant.Main \
+                      -buildfile build.xml bootstrap
 
 echo ... Cleaning Up Build Directories
 
-chmod +x bin/ant bin/antRun
+chmod +x bootstrap/bin/ant bootstrap/bin/antRun
 
 rm -rf ${CLASSDIR}
 
diff --git a/jakarta-ant-1.2-src/build.bat b/jakarta-ant-1.2-src/build.bat
index 659fb24..512ee74 100644
--- a/jakarta-ant-1.2-src/build.bat
+++ b/jakarta-ant-1.2-src/build.bat
@@ -1,19 +1,27 @@
 @echo off
 
-set REALANTHOME=%ANT_HOME%
-set ANT_HOME=.
-if exist lib\ant.jar if exist bin\ant.bat if exist bin\lcp.bat if exist bin\antRun.bat goto runAnt
+set OLDCLASSPATH=%CLASSPATH%
+set REAL_ANT_HOME=%ANT_HOME%
+set ANT_HOME=bootstrap
+if exist bootstrap\lib\ant.jar if exist bootstrap\bin\ant.bat if exist bootstrap\bin\lcp.bat if exist bootstrap\bin\antRun.bat goto runAnt
 call bootstrap.bat
 
 :runAnt
-if not "%REALANTHOME%" == "" goto install_ant
-call .\bin\ant.bat %1 %2 %3 %4 %5 %6 %7 %8 %9
+set LOCALCLASSPATH=lib\parser.jar;lib\jaxp.jar;bootstrap\lib\ant.jar
+for %%i in (lib\optional\*.jar) do call bootstrap\bin\lcp.bat "%%i"
+set CLASSPATH=%LOCALCLASSPATH%;%CLASSPATH%
+set LOCALCLASSPATH=
+
+if not "%REAL_ANT_HOME%" == "" goto install_ant
+call bootstrap\bin\ant.bat %1 %2 %3 %4 %5 %6 %7 %8 %9
 goto cleanup
 
 :install_ant
-call .\bin\ant.bat -Dant.install="%REALANTHOME%" %1 %2 %3 %4 %5 %6 %7 %8 %9
+call bootstrap\bin\ant.bat -Dant.install="%REAL_ANT_HOME%" %1 %2 %3 %4 %5 %6 %7 %8 %9
 
 rem clean up
 :cleanup
-set ANT_HOME=%REALANTHOME%
-set REALANTHOME=
+set ANT_HOME=%REAL_ANT_HOME%
+set REAL_ANT_HOME=
+set CLASSPATH=%OLDCLASSPATH%
+set OLDCLASSPATH=
diff --git a/jakarta-ant-1.2-src/build.sh b/jakarta-ant-1.2-src/build.sh
index fc1828b..9e17257 100644
--- a/jakarta-ant-1.2-src/build.sh
+++ b/jakarta-ant-1.2-src/build.sh
@@ -1,16 +1,30 @@
 #!/bin/sh
 
 REALANTHOME=$ANT_HOME
-ANT_HOME=.
+ANT_HOME=bootstrap
 export ANT_HOME
 
-if test ! -f lib/ant.jar -o  ! -x bin/ant -o ! -x bin/antRun ; then
-  ./bootstrap.sh
+if test ! -f bootstrap/lib/ant.jar -o  ! -x bootstrap/bin/ant -o ! -x bootstrap/bin/antRun ; then
+  /bin/sh ./bootstrap.sh
 fi    
 
+LOCALCLASSPATH=lib/parser.jar:lib/jaxp.jar
+# add in the dependency .jar files
+DIRLIBS=lib/optional/*.jar
+for i in ${DIRLIBS}
+do
+    if [ "$i" != "${DIRLIBS}" ] ; then
+        LOCALCLASSPATH=$LOCALCLASSPATH:"$i"
+    fi
+done
+
+CLASSPATH=$LOCALCLASSPATH:$CLASSPATH
+export CLASSPATH
+
+
 if [ "$REALANTHOME" != "" ] ; then
-  ANT_INSTALL="-Dant.install $REALANTHOME"
+  ANT_INSTALL="-Dant.install=$REALANTHOME"
 fi
 
-bin/ant $ANT_INSTALL $*
+bootstrap/bin/ant $ANT_INSTALL $*
 
diff --git a/jakarta-ant-1.2-src/build.xml b/jakarta-ant-1.2-src/build.xml
index 3b4e8a0..ad669ad 100644
--- a/jakarta-ant-1.2-src/build.xml
+++ b/jakarta-ant-1.2-src/build.xml
@@ -1,109 +1,207 @@
 <?xml version="1.0"?>
 
-<!-- ======================================================================= -->
-<!-- Ant own build file                                                      -->
-<!-- ======================================================================= -->
-
+<!-- 
+  =======================================================================
+    Ant own build file                                                      
+  ======================================================================= 
+-->
 <project name="Ant" default="main" basedir=".">
 
   <!-- Give user a chance to override without editing this file 
        (and without typing -D each time it compiles it) -->
+  <property file=".ant.properties" />
   <property file="${user.home}/.ant.properties" />
 
   <property name="Name" value="Ant"/>
   <property name="name" value="ant"/>
-  <property name="version" value="1.2"/>
-
-  <property name="ant.home" value="."/>
-  <property name="src.bin.dir" value="src/bin"/>
-  <property name="src.etc.dir" value="src/etc"/>
-  <property name="src.dir" value="src/main"/>
-  <property name="src.tests.dir" value="src/testcases"/>
+  <property name="version" value="1.3"/>
+
+  <property name="debug" value="false" />
+  <property name="deprecation" value="false" />
+  <property name="optimize" value="true" />
+  <property name="junit.fork" value="false" />
+
+  <!-- 
+       ===================================================================
+         Set the properties related to the source tree
+       =================================================================== 
+  -->
+  <property name="src.dir" value="src"/>
+  <property name="java.dir" value="${src.dir}/main"/>
+  <property name="script.dir" value="${src.dir}/script"/>
+  <property name="lib.dir" value="lib"/>
   <property name="docs.dir" value="docs"/>
-  <property name="build.dir" value="../build/ant"/>
-  <property name="lib.dir" value="${build.dir}/lib"/>
-  <property name="bin.dir" value="${build.dir}/bin"/>
+  <property name="tests.dir" value="src/testcases"/>
+  <property name="tests.etc.dir" value="src/etc/testcases"/>
+  
+  <property name="ant.package" value="org/apache/tools/ant"/>
+  <property name="optional.package" value="${ant.package}/taskdefs/optional"/>
+
+  <property name="manifest" value="src/etc/manifest"/>
+
+
+  <!-- 
+       ===================================================================
+         Set the properties for the build area
+       =================================================================== 
+  -->
+  <property name="build.dir" value="build"/>
+  <property name="bootstrap.dir" value="bootstrap"/>
   <property name="build.classes" value="${build.dir}/classes"/>
+  <property name="build.lib" value="${build.dir}/lib"/>
   <property name="build.javadocs" value="${build.dir}/javadocs"/>
   <property name="build.tests" value="${build.dir}/testcases"/>
-  <property name="ant.dist.dir" value="../dist/ant"/>
 
   <path id="classpath">
   </path>
-  <property name="packages" value="org.apache.tools.*"/>
-  <property name="manifest" value="src/etc/manifest"/>
 
-  <property name="build.compiler" value="classic"/>
-  <property name="build.compiler.emacs" value="on"/>
-
-  <!-- =================================================================== -->
-  <!-- Define a global set of patterns that can be referenced by           -->
-  <!-- its id attribute                                                    -->
-  <!-- =================================================================== -->
-  <patternset id="chmod.patterns">
-    <include name="**/ant" />
-    <include name="**/antRun" />
-    <include name="**/bootstrap.sh" />
-  </patternset>
-
-  <!-- =================================================================== -->
-  <!-- Check to see what optional dependencies are available               -->
-  <!-- =================================================================== -->
+  <path id="tests-classpath">
+    <pathelement location="${build.classes}" />
+    <pathelement location="${build.tests}" />
+    <path refid="classpath" />
+  </path>
+
+ <!-- 
+       ===================================================================
+         Set up properties for the distribution area
+       =================================================================== 
+  -->
+  <property name="dist.name" value="jakarta-${name}-${version}"/>
+  <property name="dist.base" value="distribution"/>
+  <property name="defaultdist.dir" value="dist"/>
+
+  <target name="setup-distproperties">
+
+    <property name="dist.dir" value="${defaultdist.dir}"/>
+    <property name="dist.bin" value="${dist.dir}/bin"/>
+    <property name="dist.lib" value="${dist.dir}/lib"/>
+    <property name="dist.docs" value="${dist.dir}/docs"/>
+    <property name="dist.javadocs" value="${dist.dir}/docs/api"/>
+
+    <property name="src.dist.dir" value="dist-src"/>
+    <property name="src.dist.src" value="${src.dist.dir}/src"/>
+    <property name="src.dist.docs" value="${src.dist.dir}/docs"/>
+    <property name="src.dist.lib" value="${src.dist.dir}/lib"/>
+  </target>
+
+  <!-- 
+       ===================================================================
+         Check to see what optional dependencies are available              
+       =================================================================== 
+  -->
   <target name="check_for_optional_packages">
     <available property="jdk1.2+" classname="java.lang.ThreadLocal" />
     <available property="jdk1.3+" classname="java.lang.StrictMath" />
-    <available property="bsf.present" classname="com.ibm.bsf.BSFManager" />
-    <available property="netrexx.present" classname="netrexx.lang.Rexx" />
+    <available property="bsf.present" 
+               classname="com.ibm.bsf.BSFManager" 
+               classpathref="classpath" />
+    <available property="netrexx.present" 
+               classname="netrexx.lang.Rexx"
+               classpathref="classpath" />
     <available property="xslp.present" 
-               classname="com.kvisco.xsl.XSLProcessor" />
+               classname="com.kvisco.xsl.XSLProcessor" 
+               classpathref="classpath" />
+    <available property="trax.present" 
+               classname="javax.xml.transform.Transformer" 
+               classpathref="classpath" />
     <available property="xalan.present" 
-               classname="org.apache.xalan.xslt.XSLTProcessorFactory" />
-    <available property="ejb.ejbc.present" classname="weblogic.ejbc" />
-    <available property="ejb.DDCreator.present" classname="weblogic.ejb.utils.DDCreator" />
-    <available property="ejb.wls.present" classname="weblogic.Server" />
-    <available property="junit.present" classname="junit.framework.TestCase" />
-    <available property="ftp.present" classname="com.oroinc.net.ftp.FTPClient" />
-    <available property="starteam.present" classname="com.starbase.util.Platform" />
+               classname="org.apache.xalan.xslt.XSLTProcessorFactory" 
+               classpathref="classpath" />
+    <available property="ejb.ejbc.present" 
+               classname="weblogic.ejbc" 
+               classpathref="classpath" />
+    <available property="ejb.DDCreator.present" 
+               classname="weblogic.ejb.utils.DDCreator" 
+               classpathref="classpath" />
+    <available property="ejb.wls.present" 
+               classname="weblogic.Server" 
+               classpathref="classpath" />
+    <available property="junit.present" 
+               classname="junit.framework.TestCase" 
+               classpathref="classpath" />
+    <available property="netcomp.present" 
+               classname="com.oroinc.net.ftp.FTPClient" 
+               classpathref="classpath" />
+    <available property="starteam.present" 
+               classname="com.starbase.util.Platform" 
+               classpathref="classpath" />
+    <available property="antlr.present" 
+               classname="antlr.Tool" 
+               classpathref="classpath"/>
+    <available property="vaj.present" 
+               classname="com.ibm.ivj.util.base.Workspace"  
+               classpathref="classpath"/>
+    <available property="stylebook.present" 
+               classname="org.apache.stylebook.Engine"  
+               classpathref="classpath"/>
+    <available property="jakarta.regexp.present" 
+               classname="org.apache.regexp.RE"  
+               classpathref="classpath"/>
+    <available property="jakarta.oro.present" 
+               classname="org.apache.oro.text.regex.Perl5Matcher"  
+               classpathref="classpath" />
+    <available property="jmf.present" 
+               classname="javax.sound.sampled.Clip"  
+               classpathref="classpath"/>
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Prepares the build directory                                        -->
-  <!-- =================================================================== -->
+  <!-- 
+       ===================================================================
+         Prepare the build              
+       =================================================================== 
+  -->
   <target name="prepare">
-    <mkdir dir="${build.dir}"/>
     <tstamp />
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Compiles the source code                                            -->
-  <!-- =================================================================== -->
-  <target name="compile" depends="prepare,check_for_optional_packages">
+  <!-- 
+       ===================================================================
+         Build the code           
+       =================================================================== 
+  -->
+  <target name="build" depends="prepare, check_for_optional_packages">
+    <mkdir dir="${build.dir}"/>
     <mkdir dir="${build.classes}"/>
-
-    <javac srcdir="${src.dir}"
+    <mkdir dir="${build.lib}"/>
+    
+    <javac srcdir="${java.dir}"
            destdir="${build.classes}"
-           debug="on"
-           deprecation="off"
-           optimize="on" >
+           debug="${debug}"
+           deprecation="${deprecation}"
+           optimize="${optimize}" >
       <classpath refid="classpath" />
-
-      <exclude name="**/Script.java" unless="bsf.present" />
-      <exclude name="**/NetRexxC.java" unless="netrexx.present" />
-      <exclude name="**/XslpLiaison.java" unless="xslp.present" />
-      <exclude name="**/XalanLiaison.java" unless="xalan.present" />
-      <exclude name="**/Ejbc*.java" unless="ejb.ejbc.present" />
-      <exclude name="**/DDCreator*.java" unless="ejb.DDCreator.present" />
-      <exclude name="**/WLRun.java" unless="ejb.wls.present" />
-      <exclude name="**/WLStop.java" unless="ejb.wls.present" />
-      <exclude name="**/EjbJar.java" unless="jdk1.2+" />
-      <exclude name="**/*DeploymentTool.java" unless="jdk1.2+" />
-      <exclude name="**/junit/*" unless="junit.present" />
-      <exclude name="**/FTP*.java" unless="ftp.present" />
-      <exclude name="**/AntStarTeam*.java" unless="starteam.present" />
+      <exclude name="${ant.package}/util/regexp/JakartaRegexpMatcher.java" 
+               unless="jakarta.regexp.present" />
+      <exclude name="${ant.package}/util/regexp/JakartaOroMatcher.java" 
+               unless="jakarta.oro.present" />
+      <exclude name="${optional.package}/Script.java" unless="bsf.present" />
+      <exclude name="${optional.package}/StyleBook.java" unless="stylebook.present" />
+      <exclude name="${optional.package}/NetRexxC.java" unless="netrexx.present" />
+      <exclude name="${optional.package}/XslpLiaison.java" unless="xslp.present" />
+      <exclude name="${optional.package}/XalanLiaison.java" unless="xalan.present" />
+      <exclude name="${optional.package}/TraXLiaison.java" unless="trax.present" />
+      <exclude name="${optional.package}/ejb/Ejbc*.java" unless="ejb.ejbc.present" />
+      <exclude name="${optional.package}/ejb/DDCreator*.java" unless="ejb.DDCreator.present" />
+      <exclude name="${optional.package}/ejb/WLRun.java" unless="ejb.wls.present" />
+      <exclude name="${optional.package}/ejb/WLStop.java" unless="ejb.wls.present" />
+      <exclude name="${optional.package}/ejb/EjbJar.java" unless="jdk1.2+" />
+      <exclude name="${optional.package}/ejb/*DeploymentTool.java" unless="jdk1.2+" />
+      <exclude name="${optional.package}/Javah.java" unless="jdk1.2+" />
+      <exclude name="${optional.package}/junit/*" unless="junit.present" />
+      <exclude name="${optional.package}/net/*.java" unless="netcomp.present" />
+      <exclude name="${optional.package}/scm/AntStarTeam*.java" unless="starteam.present" />
+      <exclude name="${optional.package}/ANTLR.java" unless="antlr.present" />
+      <exclude name="${optional.package}/ide/VAJ*.java" unless="vaj.present" />
+      <exclude name="${optional.package}/perforce/*.java" unless="jakarta.oro.present" />
+      <exclude name="${optional.package}/sound/*.java" unless="jmf.present" />
+      <exclude name="${optional.package}/junit/XMLResultAggregator.java"
+               unless="xalan.present" />
+      <exclude name="${optional.package}/junit/AggregateTransformer.java"
+               unless="xalan.present" />
     </javac>
- 
+    
     <copy todir="${build.classes}">
-      <fileset dir="${src.dir}">
+      <fileset dir="${java.dir}">
         <include name="**/*.properties" />
       </fileset>
     </copy>
@@ -114,233 +212,364 @@
     <copy    todir="${build.classes}" 
              overwrite="true"
              filtering="on">
-      <fileset dir="${src.dir}">
+      <fileset dir="${java.dir}">
         <include name="**/version.txt" />
         <include name="**/defaultManifest.mf" />
       </fileset>
     </copy>
-  </target>
 
-  <!-- =================================================================== -->
-  <!-- Creates the jar archive                                             -->
-  <!-- =================================================================== -->
-  <target name="jar" depends="compile">
-    <mkdir dir="${lib.dir}"/>
-    <jar jarfile="${lib.dir}/${name}.jar"
-         basedir="${build.classes}"
-         includes="org/**"
-         manifest="${manifest}"
-    />
-  </target>
-
-  <!-- =================================================================== -->
-  <!-- Creates the binary structure                                        -->
-  <!-- =================================================================== -->
-  <target name="main" depends="jar" description="Creates the binary structure">
-     <mkdir dir="${bin.dir}"/>
-     <copy todir="${bin.dir}">
-       <fileset dir="${src.bin.dir}"/>
-     </copy>
-     <chmod perm="+x">
-       <fileset dir="${bin.dir}">
-         <patternset refid="chmod.patterns"/>
+    <copy todir="${build.classes}/${optional.package}/junit">
+       <fileset dir="${java.dir}/${optional.package}/junit">
+         <include name="html/**" />
+         <include name="xsl/**" />
        </fileset>
-     </chmod>
-     <fixcrlf srcdir="${bin.dir}" includes="ant,antRun" cr="remove"/>
-     <fixcrlf srcdir="${bin.dir}" includes="*.bat" cr="add"/>
+    </copy>
+
   </target>
+  
+  <!-- 
+       =================================================================== 
+         Create the ant jars: ant.jar and optional.jar                                                 
+       =================================================================== 
+  -->
+  <target name="jars" depends="build">
+
+    <jar jarfile="${build.lib}/${name}.jar" 
+         basedir="${build.classes}" 
+         manifest="${manifest}">
+      <exclude name="org/apache/tools/ant/taskdefs/optional/**" />
+    </jar>
+
+    <jar jarfile="${build.lib}/optional.jar" 
+         basedir="${build.classes}" 
+         manifest="${manifest}">
+      <include name="org/apache/tools/ant/taskdefs/optional/**" />
+    </jar>
 
-  <!-- =================================================================== -->
-  <!-- Creates the API documentation                                       -->
-  <!-- =================================================================== -->
-  <target name="javadocs" depends="prepare" description="Creates the API documentation">
-    <mkdir dir="${build.javadocs}"/>
-    <javadoc packagenames="${packages}"
-             sourcepath="${basedir}/${src.dir}"
-             destdir="${build.javadocs}"
-             author="true"
-             version="true"
-             windowtitle="${Name} API"
-             doctitle="${Name}"
-             bottom="Copyright &#169; 2000 Apache Software Foundation. All Rights Reserved.">
-    </javadoc>
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Creates the distribution                                            -->
-  <!-- =================================================================== -->
-  <target name="dist" depends="main,jar,javadocs" description="Creates the distribution">
-     <mkdir dir="${ant.dist.dir}"/>
-     <mkdir dir="${ant.dist.dir}/bin"/>
-     <mkdir dir="${ant.dist.dir}/lib"/>
-     <mkdir dir="${ant.dist.dir}/docs"/>
-     <mkdir dir="${ant.dist.dir}/docs/api"/>
-     <mkdir dir="${ant.dist.dir}/src"/>
-
-     <copy todir="${ant.dist.dir}/src">
-       <fileset dir="${src.dir}"/>
-     </copy>
-     <copy todir="${ant.dist.dir}/lib">
-       <fileset dir="${lib.dir}"/>
-     </copy>
-
-     <copy file="build.xml" tofile="${ant.dist.dir}/lib/build.xml"/>
-     <copy todir="${ant.dist.dir}/bin">
-       <fileset dir="src/bin"/>
-     </copy>
-     <copy todir="${ant.dist.dir}/docs">
-       <fileset dir="${docs.dir}"/>
-     </copy>
-     <copy todir="${ant.dist.dir}/docs/api">
-       <fileset dir="${build.javadocs}"/>
-     </copy>
-
-     <fixcrlf srcdir="${ant.dist.dir}/bin" includes="ant,antRun" cr="remove"/>
-     <fixcrlf srcdir="${ant.dist.dir}/bin" includes="*.bat" cr="add"/>
-     <chmod perm="+x">
-       <fileset dir="${ant.dist.dir}/bin">
-         <patternset refid="chmod.patterns"/>
+  <!--
+       ===================================================================
+         Create the essential distribution that can run ant
+       ===================================================================
+  -->
+  <target name="dist-lite" depends="jars, setup-distproperties">
+
+    <mkdir dir="${dist.dir}"/>
+    <mkdir dir="${dist.bin}"/>
+    <mkdir dir="${dist.lib}"/>
+
+    <copy todir="${dist.lib}">
+      <fileset dir="${build.lib}"/>
+    </copy>
+    
+    <copy todir="${dist.bin}">
+      <fileset dir="${script.dir}/" />
+    </copy>
+
+    <chmod dir="${dist.dir}" perm="go-rwx" />
+    <chmod perm="u+x">
+       <fileset dir="${dist.bin}">
+         <include name="**/ant" />
+         <include name="**/antRun" />
        </fileset>
      </chmod>
 
-     <copy file="README" tofile="${ant.dist.dir}/README"/>
-     <copy file="WHATSNEW" tofile="${ant.dist.dir}/WHATSNEW"/>
-     <copy file="TODO" tofile="${ant.dist.dir}/TODO"/>
-     <copy file="LICENSE" tofile="${ant.dist.dir}/LICENSE"/>
+    <fixcrlf srcdir="${dist.bin}" cr="add" includes="*.bat" />
+    <fixcrlf srcdir="${dist.bin}" cr="remove" includes="*.sh" />
+    <fixcrlf srcdir="${dist.bin}" cr="remove" includes="ant" />
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Packages the distribution with ZIP                                  -->
-  <!-- =================================================================== -->
-  <target name="dist-zip" depends="dist">
-    <zip zipfile="${Name}-${version}.zip" basedir="${ant.dist.dir}" includes="**"/>
+ <!--
+       ===================================================================
+         Create the complete distribution
+       ===================================================================
+  -->
+  <target name="dist" depends="dist-lite,javadocs">
+    <mkdir dir="${dist.docs}"/>
+    <mkdir dir="${dist.javadocs}"/>
+
+    <copy todir="${dist.lib}">
+      <fileset dir="${lib.dir}">
+        <include name="*.jar" />
+        <include name="*.zip" />
+      </fileset>
+    </copy>
+
+    <copy todir="${dist.lib}" file="${lib.dir}/optional/README"/>
+    
+    <copy todir="${dist.docs}"
+          filtering="on">
+      <fileset dir="${docs.dir}"/>
+    </copy>
+
+    <copy todir="${dist.javadocs}">
+      <fileset dir="${build.javadocs}"/>
+    </copy>
+
+    <copy todir="${dist.dir}">
+      <fileset dir=".">
+        <include name="README"/>
+        <include name="LICENSE"/>
+        <include name="TODO"/>
+        <include name="WHATSNEW"/>
+      </fileset>
+    </copy>
+
+    <chmod dir="${dist.dir}" perm="go-rwx" />
+
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Packages the distribution with TAR-GZIP                             -->
-  <!-- =================================================================== -->
-  <target name="dist-tgz" depends="dist">
-    <tar tarfile="${Name}-${version}.tar" basedir="${ant.dist.dir}" includes="**"/>
-    <gzip zipfile="${Name}-${version}.tar.gz" src="${Name}-${version}.tar"/>
+
+  <!--
+       ===================================================================
+         Target to create bootstrap build
+       ===================================================================
+  -->
+  <target name="bootstrap">
+    <antcall target="dist-lite">
+      <param name="dist.dir" value="${bootstrap.dir}" />
+    </antcall>
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Installs the ant.jar library and binary files into ant.home         -->
-  <!-- =================================================================== -->
-  <target name="bootstrap" depends="main" description="Installs the ant.jar library and binary files into ant.home">
-    <echo message="copying bootstrapped files into bin and lib"/>
-    <copy todir="lib">
-      <fileset dir="${lib.dir}"/>
-    </copy>
-    <copy todir="bin">
-      <fileset dir="${bin.dir}"/>
+
+  <!--
+       ===================================================================
+         Create the source distribution
+       ===================================================================
+  -->
+  <target name="src-dist" depends="setup-distproperties">
+
+    <mkdir dir="${src.dist.dir}" />
+ 
+    <copy todir="${src.dist.lib}">
+      <fileset dir="${lib.dir}">
+        <include name="*.jar" />
+        <include name="*.zip" />
+        <include name="optional/README"/>
+      </fileset>
     </copy>
-  </target>     
 
-  <target name="install" depends="dist" if="ant.install">
-    <echo message="installing full copy of ant into ${ant.install}"/>
-    <mkdir dir="${ant.install}"/>
-    <copy todir="${ant.install}">
-      <fileset dir="${ant.dist.dir}"/>
+    <copy todir="${src.dist.src}">
+      <fileset dir="${src.dir}"/>
     </copy>
-    <chmod perm="+x">
-      <fileset dir="${ant.install}/bin">
-        <patternset refid="chmod.patterns"/>
-      </fileset>
-    </chmod>
-  </target>     
 
-  <target name="fullinstall" depends="install"/>
-  
-  <target name="mininstall" depends="main" if="ant.install">
-    <echo message="copy minimal ant installation into ${ant.install}"/>
-    <mkdir dir="${ant.install}"/>
-    <copy todir="${ant.install}/lib">
-      <fileset dir="${lib.dir}"/>
+    <copy todir="${src.dist.docs}">
+      <fileset dir="${docs.dir}"/>
     </copy>
-    <copy todir="${ant.install}/bin">
-      <fileset dir="${bin.dir}"/>
+
+    <copy todir="${src.dist.dir}">
+      <fileset dir=".">
+        <include name="README"/>
+        <include name="LICENSE"/>
+        <include name="TODO"/>
+        <include name="WHATSNEW"/>
+        <include name="build.bat"/>
+        <include name="build.sh"/>
+        <include name="bootstrap.bat"/>
+        <include name="bootstrap.sh"/>
+        <include name="build.xml"/>
+      </fileset>
     </copy>
+
+    <fixcrlf srcdir="${src.dist.dir}" includes="*.sh" cr="remove"/>
+    <fixcrlf srcdir="${src.dist.dir}" includes="*.bat" cr="add"/>
     <chmod perm="+x">
-      <fileset dir="${ant.install}/bin">
-        <patternset refid="chmod.patterns"/>
+      <fileset dir="${src.dist.dir}">
+        <include name="*.sh" />
       </fileset>
     </chmod>
-  </target>     
 
-  <!-- =================================================================== -->
-  <!-- Cleans up generated stuff                                           -->
-  <!-- =================================================================== -->
-  <target name="clean">
-    <delete dir="${build.dir}"/>
-    <delete dir="${ant.dist.dir}"/>
+    <fixcrlf srcdir="${src.dist.src}" includes="**/*.java" cr="remove"/>
+    
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Total cleanup                                                       -->
-  <!-- =================================================================== -->
-  <target name="total-clean" depends="clean">
-    <delete dir="${bin.dir}"/>
-    <delete file="${lib.dir}/${name}.jar"/>
-    <delete file="${Name}-${version}.zip"/>
-    <delete file="${Name}-${version}.tar"/>
-    <delete file="${Name}-${version}.tar.gz"/>
+  <!--
+       ===================================================================
+         Create the binary distribution
+       ===================================================================
+  -->
+  <target name="distribution">
+    <mkdir dir="${dist.base}"/>
+
+    <antcall target="dist">
+      <param name="dist.dir" value="${dist.name}" />
+    </antcall>
+    <zip zipfile="${dist.base}/${dist.name}-bin.zip" 
+         basedir="${dist.name}/.." 
+         includes="${dist.name}/**"
+         excludes="${dist.name}/lib/optional.jar"/>
+    <tar longfile="gnu"
+         tarfile="${dist.base}/${dist.name}-bin.tar">
+      <tarfileset dir="${dist.name}/.." mode="755" username="ant" group="ant">
+        <include name="${dist.name}/bin/ant"/>
+        <include name="${dist.name}/bin/antRun"/>
+      </tarfileset> 
+      <tarfileset dir="${dist.name}/.." username="ant" group="ant"> 
+        <include name="${dist.name}/**"/>
+        <exclude name="${dist.name}/bin/ant"/>
+        <exclude name="${dist.name}/bin/antRun"/>
+        <exclude name="${dist.name}/lib/optional.jar"/>
+      </tarfileset> 
+    </tar>
+    <gzip zipfile="${dist.base}/${dist.name}-bin.tar.gz" 
+          src="${dist.base}/${dist.name}-bin.tar"/>
+    <delete file="${dist.base}/${dist.name}-bin.tar"/>
+    <copy file="${dist.name}/lib/optional.jar" tofile="${dist.base}/${dist.name}-optional.jar"/>
+    <delete dir="${dist.name}" />
+
+
+    <antcall target="src-dist">
+      <param name="src.dist.dir" value="${dist.name}" />
+    </antcall>
+    <zip zipfile="${dist.base}/${dist.name}-src.zip" 
+         basedir="${dist.name}/.." 
+         includes="${dist.name}/**"/>
+    <tar longfile="gnu"
+         tarfile="${dist.base}/${dist.name}-src.tar" >
+      <tarfileset dir="${dist.name}/.." mode="755" username="ant" group="ant">
+        <include name="${dist.name}/bootstrap.sh"/>
+        <include name="${dist.name}/build.sh"/>
+      </tarfileset> 
+      <tarfileset dir="${dist.name}/.." username="ant" group="ant"> 
+        <include name="${dist.name}/**"/>
+        <exclude name="${dist.name}/bootstrap.sh"/>
+        <exclude name="${dist.name}/build.sh"/>
+      </tarfileset>
+    </tar> 
+    <gzip zipfile="${dist.base}/${dist.name}-src.tar.gz" 
+          src="${dist.base}/${dist.name}-src.tar"/>
+    <delete file="${dist.base}/${dist.name}-src.tar"/>
+    <delete dir="${dist.name}" />
   </target>
 
-  <!-- in progress ! (may not work) -->
+  <!--
+       ===================================================================
+         Cleans up build and distribution directories
+       ===================================================================
+  -->
+  <target name="clean">
+    <delete dir="${build.dir}" />
+    <delete dir="${dist.base}" />
+    <delete dir="${defaultdist.dir}" />
+    <delete> 
+      <fileset dir="." includes="**/*~" defaultexcludes="no"/>
+    </delete>
+  </target> 
+
+  <!--
+       ===================================================================
+         Cleans everything
+       ===================================================================
+  -->
+  <target name="allclean" depends="clean">
+    <delete file="${bootstrap.dir}/bin/antRun" />
+    <delete file="${bootstrap.dir}/bin/antRun.bat" />
+  </target> 
+
+  <!--
+       ===================================================================
+         Installs ant
+       ===================================================================
+  -->
+  <target name="install" if="ant.install">
+    <antcall target="dist">
+      <param name="dist.dir" value="${ant.install}" />
+    </antcall>
+  </target>
 
-  <target name="get.snapshot">
-    <get src="http://jakarta.apache.org/build/tmp/ant/ant.src.zip" dest="ant-src.zip" />
-    <unzip src="ant-src.zip" dest="." />
+  <target name="install-lite" if="ant.install">
+    <antcall target="dist-lite">
+      <param name="dist.dir" value="${ant.install}" />
+    </antcall>
   </target>
 
-  <target name="make.snapshot">
-    <cvs cvsRoot=":pserver:anoncvs@jakarta.apache.org:/home/cvspublic"
-         package="jakarta-ant"
-         dest="."  />
-    <zip zipfile="/www/jakarta.apache.org/builds/tmp/ant/ant.src.zip" basedir="." includes="jakarta-ant/**"/>
+  <!-- 
+       ===================================================================
+         Creates the API documentation                             
+       =================================================================== 
+  -->
+  
+  <target name="javadoc_check">
+    <uptodate property="javadoc.notrequired" targetfile="${build.javadocs}/packages.html" >
+        <srcfiles dir= "${java.dir}" includes="**/*.java"/>
+    </uptodate>
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Compile testcases                                                   -->
-  <!-- =================================================================== -->
-  <target name="compiletests" depends="jar" if="junit.present">
+  <target name="javadocs" depends="prepare, javadoc_check" 
+          unless="javadoc.notrequired"
+          description="Creates the API documentation">
+    <mkdir dir="${build.javadocs}"/>
+    <javadoc packagenames="org.apache.*"
+             sourcepath="${java.dir}"
+             destdir="${build.javadocs}"
+             author="true"
+             version="true"
+             windowtitle="${Name} API"
+             doctitle="${Name}"
+             bottom="Copyright &#169; 2000 Apache Software Foundation. All Rights Reserved.">
+      <group title="Ant Core" packages="org.apache.tools.ant*" />
+      <group title="Core Tasks" packages="org.apache.tools.ant.taskdefs*" />
+      <group title="Optional Tasks" packages="org.apache.tools.ant.taskdefs.optional*" />
+    </javadoc>
+  </target>
+  
+  <!-- 
+       =================================================================== 
+         Compile testcases                                                   
+       =================================================================== 
+  -->
+  <target name="compile-tests" depends="build" if="junit.present">
     <mkdir dir="${build.tests}"/>
 
-    <javac srcdir="${src.tests.dir}"
+    <javac srcdir="${tests.dir}"
            destdir="${build.tests}"
-           debug="on"
-           deprecation="off" >
-      <classpath>
-        <pathelement location="${lib.dir}/${name}.jar" />
-        <path refid="classpath" />
-      </classpath>
+           debug="${debug}"
+           deprecation="${deprecation}" >
+      <classpath refid="tests-classpath" />
+
+      <exclude name="org/apache/tools/ant/taskdefs/optional/ANTLRTest.java" 
+               unless="antlr.present" />
+      <exclude name="org/apache/tools/ant/util/regexp/JakartaRegexpMatcherTest.java" 
+               unless="jakarta.regexp.present" />
+      <exclude name="org/apache/tools/ant/util/regexp/JakartaOroMatcherTest.java" 
+               unless="jakarta.oro.present" />
     </javac>
-   </target>
-
-  <!-- =================================================================== -->
-  <!-- Run testcase                                                        -->
-  <!-- =================================================================== -->
-  <target name="runtests" depends="compiletests" if="junit.present">
-    <junit printsummary="no" haltonfailure="yes">
-      <classpath>
-        <pathelement location="${lib.dir}/${name}.jar" />
-        <pathelement location="${build.tests}" />
-        <path refid="classpath" />
-        <pathelement path="${java.class.path}" />
-      </classpath>
+  </target>
+
+  <!-- 
+       =================================================================== 
+         Run testcase                                                        
+       =================================================================== 
+  -->
+  <target name="run-tests" depends="compile-tests" if="junit.present">
+
+    <junit printsummary="no" haltonfailure="yes" fork="${junit.fork}">
+      <jvmarg value="-classic"/>
+      <classpath refid="tests-classpath"/>
+
+      <sysproperty key="build.tests" value="${build.tests}"/>
 
       <formatter type="plain" usefile="false" />
 
       <batchtest>
-        <fileset dir="${src.tests.dir}">
+        <fileset dir="${tests.dir}">
           <include name="**/*Test*" />
           <!-- abstract class, not a testcase -->
           <exclude name="org/apache/tools/ant/taskdefs/TaskdefsTest.java" />
+          <exclude name="org/apache/tools/ant/util/regexp/RegexpMatcherTest.java" />
 
           <!-- these depend on order -->
           <exclude name="org/apache/tools/ant/taskdefs/GUnzipTest.java" />
           <exclude name="org/apache/tools/ant/taskdefs/GzipTest.java" />
+
+          <!-- only run this test if ANTLR is installed -->
+          <exclude name="org/apache/tools/ant/taskdefs/optional/ANTLRTest.java" 
+                   unless="antlr.present" />
+          <exclude name="org/apache/tools/ant/util/regexp/JakartaRegexpMatcherTest.java" 
+                   unless="jakarta.regexp.present" />
+          <exclude name="org/apache/tools/ant/util/regexp/JakartaOroMatcherTest.java" 
+                   unless="jakarta.oro.present" />
         </fileset>
       </batchtest>
 
@@ -349,192 +578,29 @@
     </junit>
 
     <!-- clean up again -->
-    <delete dir="src/etc/testcases/taskdefs/taskdefs.tmp" />
-    <delete dir="src/etc/testcases/taskdefs.tmp" />
+    <delete dir="${tests.etc.dir}/taskdefs/optional/antlr/antlr.tmp" />
+    <delete dir="${tests.etc.dir}/taskdefs/taskdefs.tmp" />
+    <delete dir="${tests.etc.dir}/taskdefs.tmp" />
+    <delete file="${tests.etc.dir}/taskdefs/tmp.jar" />
+    <delete dir="${tests.etc.dir}/types/copytest" />
   </target>
 
-  <target name="run.single.test" if="testcase" depends="compiletests">
-    <junit printsummary="no" haltonfailure="yes">
-      <classpath>
-        <pathelement location="${lib.dir}/${name}.jar" />
-        <pathelement location="${build.tests}" />
-        <path refid="classpath" />
-        <pathelement path="${java.class.path}" />
-      </classpath>
+  <target name="run-single-test" if="testcase" depends="compile-tests">
 
+    <junit printsummary="no" haltonfailure="yes" fork="${junit.fork}">
+      <jvmarg value="-classic"/>
+      <sysproperty key="build.tests" value="${build.tests}"/>
+      <classpath refid="tests-classpath"/>
       <formatter type="plain" usefile="false" />
-
       <test name="${testcase}" />
     </junit>
   </target>
 
-  <!-- =================================================================== -->
-  <!-- Targets to build distributions, probaly not that useful for         -->
-  <!-- anybody but the people doing Ant releases.                          -->
-  <!-- =================================================================== -->
-
-  <property name="JAXP_HOME" value="/usr/local/java/lib/jaxp1.0.1" />
-  <property name="ant.srcdist.dir" value="../dist/jakarta-ant-src"/>
-
-  <target name="srcbuild">
-     <mkdir dir="${ant.srcdist.dir}" />
-     <mkdir dir="${ant.srcdist.dir}/lib" />
-
-     <copy todir="${ant.srcdist.dir}">
-       <fileset dir=".">
-         <exclude name="bin/**" />
-         <exclude name="lib/**" />
-       </fileset>
-     </copy>
-
-     <fixcrlf srcdir="${ant.srcdist.dir}" includes="ant,antRun,bootstrap.sh" cr="remove"/>
-     <fixcrlf srcdir="${ant.srcdist.dir}" includes="*.bat" cr="add"/>
-     <chmod perm="+x">
-       <fileset dir="${ant.srcdist.dir}">
-         <patternset refid="chmod.patterns"/>
-       </fileset>
-     </chmod>
-
-     <copy todir="${ant.srcdist.dir}/lib">
-       <fileset dir="${JAXP_HOME}">
-         <include name="**/*.jar" />
-       </fileset>
-     </copy>
-  </target>
-  
-  <target name="src.zip" depends="srcbuild">
-    <zip zipfile="${ant.srcdist.dir}/../jakarta-ant-src.zip" 
-         basedir="${ant.srcdist.dir}" />
-  </target>
-
-  <target name="src.tgz" depends="srcbuild">
-    <property name="src.tar" 
-              value="${ant.srcdist.dir}/../jakarta-ant-src.tar" />
-    <tar tarfile="${src.tar}" basedir="${ant.srcdist.dir}" />
-    <gzip src="${src.tar}" zipfile="${src.tar}.gz" />
-    <delete file="${src.tar}" />
-  </target>
-
-  <target name="srcdist" description="Creates the source distribution"
-          depends="src.zip,src.tgz" />
-
-  <property name="ant.bindist.dir" value="../dist/jakarta-ant-bin"/>
-
-  <target name="binbuild" depends="compile">
-
-    <!-- ugly hack to build a binary distribution without optional tasks -->
-    <delete>
-      <fileset dir="${build.classes}">
-        <include name="**/Script.java" />
-        <include name="**/NetRexxC.java" />
-        <include name="**/XslpLiaison.java" />
-        <include name="**/XalanLiaison.java" />
-        <include name="**/Ejbc*.java" />
-        <include name="**/DDCreator*.java" />
-        <include name="**/WLRun.java" />
-        <include name="**/WLStop.java" />
-        <include name="**/junit/*" />
-        <include name="**/FTP*.java" />
-        <include name="**/AntStarTeam*.java" />
-      </fileset>
-    </delete>
-
-    <mkdir dir="${ant.bindist.dir}"/>
-    <mkdir dir="${ant.bindist.dir}/bin"/>
-    <mkdir dir="${ant.bindist.dir}/src"/>
-    <mkdir dir="${ant.bindist.dir}/etc"/>
-    <mkdir dir="${ant.bindist.dir}/lib"/>
-    <mkdir dir="${ant.bindist.dir}/docs/api"/>
-
-    <jar jarfile="${ant.bindist.dir}/lib/${name}.jar"
-         basedir="${build.classes}"
-         includes="org/**"
-         manifest="${manifest}"
-    />
-
-    <copy todir="${ant.bindist.dir}/docs">
-      <fileset dir="${docs.dir}"/>
-    </copy>
-    <javadoc packagenames="${packages}"
-             sourcepath="${basedir}/${src.dir}"
-             destdir="${ant.bindist.dir}/docs/api"
-             author="true"
-             version="true"
-             windowtitle="${Name} API"
-             doctitle="${Name}"
-             bottom="Copyright &#169; 2000 Apache Software Foundation. All Rights Reserved.">
-    </javadoc>
-
-    <copy todir="${ant.bindist.dir}/src">
-      <fileset dir="${src.dir}"/>
-    </copy>
-
-    <copy todir="${ant.bindist.dir}/etc">
-      <fileset dir="${src.etc.dir}">
-        <exclude name="testcases/**" />
-      </fileset>
-    </copy>
-
-    <copy todir="${ant.bindist.dir}/bin">
-      <fileset dir="${src.bin.dir}"/>
-    </copy>
-    <fixcrlf srcdir="${ant.bindist.dir}/bin" includes="ant,antRun" cr="remove"/>
-    <fixcrlf srcdir="${ant.bindist.dir}/bin" includes="*.bat" cr="add"/>
-    <chmod perm="+x">
-      <fileset dir="${ant.bindist.dir}/bin">
-        <patternset refid="chmod.patterns"/>
-      </fileset>
-    </chmod>
-
-    <copy file="build.xml" tofile="${ant.bindist.dir}/lib/build.xml"/>
-
-    <copy file="README" tofile="${ant.bindist.dir}/README"/>
-    <copy file="WHATSNEW" tofile="${ant.bindist.dir}/WHATSNEW"/>
-    <copy file="TODO" tofile="${ant.bindist.dir}/TODO"/>
-    <copy file="LICENSE" tofile="${ant.bindist.dir}/LICENSE"/>
-
-    <copy todir="${ant.bindist.dir}/lib">
-      <fileset dir="${JAXP_HOME}">
-        <include name="**/*.jar" />
-      </fileset>
-    </copy>
-  </target>
-
-  <target name="bin.zip" depends="binbuild">
-    <zip zipfile="${ant.bindist.dir}/../jakarta-ant-bin.zip" 
-         basedir="${ant.bindist.dir}" />
-  </target>
-
-  <target name="bin.tgz" depends="binbuild">
-    <property name="bin.tar" 
-              value="${ant.bindist.dir}/../jakarta-ant-bin.tar" />
-    <tar tarfile="${bin.tar}" basedir="${ant.bindist.dir}" />
-    <gzip src="${bin.tar}" zipfile="${bin.tar}.gz" />
-    <delete file="${bin.tar}" />
-  </target>
-
-  <target name="bindist" description="Creates the binary distribution"
-          depends="bin.zip,bin.tgz" />
-
-  <property name="contributed.tasks" value="../build/ant.contrib" />
-  <property name="optional" value="../dist/optional.jar" />
-
-  <target name="optional.jar" depends="compile"
-          description="Creates a JAR of the optional tasks">
-    <mkdir dir="${contributed.tasks}" />
-    <copy todir="${contributed.tasks}">
-      <fileset dir="${build.classes}">
-        <include name="**/optional/**" />
-      </fileset>
-    </copy>
-    <jar jarfile="${optional}"
-         basedir="${contributed.tasks}"
-         manifest="${manifest}"
-    />
-  </target>
-
-  <target name="release.dist" depends="srcdist,bindist,optional.jar"
-          description="Creates all five files for a release build" />
-
-</project>
+  <!-- 
+       =================================================================== 
+         Main target - runs dist-lite by default                                               
+       =================================================================== 
+  -->
+  <target name="main" depends="dist-lite"/>
 
+</project>
\ No newline at end of file
diff --git a/jakarta-ant-1.2-src/docs/P4desc.html b/jakarta-ant-1.2-src/docs/P4desc.html
deleted file mode 100644
index 298c510..0000000
--- a/jakarta-ant-1.2-src/docs/P4desc.html
+++ /dev/null
@@ -1,90 +0,0 @@
-<html>
-
-<body>
-
-<h2><a name="perforce">Perforce</a></h2>
-
-<h3>Description</h3>
-
-<p>Handles packages/modules retrieved from a <a href="http://www.perforce.com/">Perforce</a> repository.</p>
-
-<h3>Parameters</h3>
-
-<table border="1" cellpadding="2" cellspacing="0">
-    <tr>
-        <td valign="top"><b>Attribute</b></td>
-        <td valign="top"><b>Description</b></td>
-        <td align="center" valign="top"><b>Required</b></td>
-    </tr>
-    <tr>
-        <td valign="top">localpath</td>
-        <td valign="top">The local path of the file/directory to
-        write file(s) to.</td>
-        <td align="center" valign="top">Yes</td>
-    </tr>
-    <tr>
-        <td>user</td>
-        <td>Specifies the user name, overriding the value of $P4USER,
-        $USER, and $USERNAME in the environment.</td>
-        <td><p align="center">No</p>
-        </td>
-    </tr>
-    <tr>
-        <td>port</td>
-        <td>Specifies the server's listen address, overriding the
-        value of $P4PORT in the environment and the default (perforce:1666).</td>
-        <td><p align="center">No</p>
-        </td>
-    </tr>
-    <tr>
-        <td valign="top">version</td>
-        <td valign="top">The revision number of the file being
-        extracted.</td>
-        <td align="center" valign="top">No</td>
-    </tr>
-    <tr>
-        <td valign="top">date</td>
-        <td valign="top">Get files as of this date. Either [yyyy/mm/dd]
-        or [yyyy/mm/dd:hh:mm:ss]. Note that [yyyy/mm/dd] means [yyyy/mm/dd:00:00:00],
-        so if you want to include all events on that day refer to
-        the next day.</td>
-        <td align="center" valign="top">No</td>
-    </tr>
-    <tr>
-        <td valign="top">label</td>
-        <td valign="top">A label from which to check out files.</td>
-        <td align="center" valign="top">No</td>
-    </tr>
-    <tr>
-        <td valign="top">force</td>
-        <td valign="top">&quot;[true|false]&quot;. Forces
-        resynchronization even if the client already has the
-        file, and clobbers writable files. This flag doesn't
-        affect open files.</td>
-        <td align="center" valign="top">No, default &quot;false&quot;</td>
-    </tr>
-    <tr>
-        <td>change</td>
-        <td>Gets the file(s) as they were when a specified change
-        number was applied.</td>
-        <td><p align="center">No</p>
-        </td>
-    </tr>
-</table>
-
-<h3>Examples</h3>
-
-<pre>  &lt;perforce localpath=&quot;//path/to/source/...&quot;
-       force=&quot;true&quot;
-       change=&quot;4513&quot;
-  /&gt;</pre>
-
-<p>syncs the files in the source directory that are in the
-Perforce repository, as of change number 4513, overwriting any
-modified files in the current source tree is needed.</p>
-
-<pre>  &lt;perforce localpath=&quot;//path/to/source/...&quot; /&gt;</pre>
-
-<p>Syncs with the latest version of the file in the repository.</p>
-</body>
-</html>
diff --git a/jakarta-ant-1.2-src/docs/ant2/FunctionalRequirements.html b/jakarta-ant-1.2-src/docs/ant2/FunctionalRequirements.html
new file mode 100644
index 0000000..46ba380
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/ant2/FunctionalRequirements.html
@@ -0,0 +1,54 @@
+<html>
+<head>
+  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
+  <title>Ant Functional Requirements Document</title>
+</head>
+<body>
+<h2>Ant Functional Requirements</h2>
+<h3>Roles</h3>
+<p><b>User: </b>runs Ant with a complete build specification and/or
+writes Ant build specifications.</p>
+<p><b>Task Developer: </b>writes/modifies Ant tasks.</p>
+<p><b>Extensions Developer: </b>develops extensions like a GUI, IDE plugin,
+ (scripting extension?)</p>
+<p><b>Core Developer: </b>works on the Ant core</p>
+<h3>Requirements from the Ant User perspective</h3>
+<p>It should be easy to write a build file for small Java programs. It should
+ be possible to write a build file set for large Java systems. Maintenance
+ of such a set should be easy (e.g. no duplication of information).</p>
+<p>Every build process contains dependencies (e.g. item A needs B to be available
+ before its own build can start). It should be possible to specify these
+ dependencies in a declarative way.</p>
+<p>Suppose a working build specification for system A is available. It should
+ be possible for system B to declare dependencies to <i>(modules of?)</i> system
+ A without touching the build specification of A. Ant should be able to handle
+ dependencies between modules which form a DAG.</p>
+<p>It should be possible to modify details of the actual build (e.g. classpath,
+ used compiler) without the need to change the build specification. This
+ feature is needed when starting Ant (e.g. configuration with command line
+ parameters) and for a subproject build driven by the build of a dependent
+ project.</p>
+<p>Often similar items have to be built. Therefore it should be possible
+ to provide general <i>(template?)</i> build specifications, and to declare for
+ a concrete item that it should be built according to such a general specification.</p>
+<p>One result of the build process should be a log which shows what has been done.</p>
+<h3>Requirements from the task developer perspective</h3>
+<p>A task should not need to know the structure of a build specification.
+ It would have to provide an interface (not necessarily in the Java language
+ sense) for the Ant core to input the necessary configuration attributes
+ and to execute the task). There should be a standard functionality to allow
+ a task doing log output.</p>
+<p>An interface (again not necessarily in the Java language sense) should
+ be provided which allows a task to get <i>(and set?)</i> information about it's
+ context in the build process.</p>
+<h3>Requirements from the extensions developer perspective</h3>
+<p>The Ant core should be independent from a specific representation of the
+ build specification. It should be possible to create a specification programmatically
+ (thereby allowing the introduction of new representations). The core should
+ do no in- or output itself. Build errors should always lead to throwing
+ an Exception.</p>
+<p>Access to the current state of a build should be available, and its modification
+ possible.</p>
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/spec/core.html b/jakarta-ant-1.2-src/docs/ant2/original-specification.html
similarity index 100%
rename from jakarta-ant-1.2-src/spec/core.html
rename to jakarta-ant-1.2-src/docs/ant2/original-specification.html
diff --git a/jakarta-ant-1.2-src/docs/ant2/requested-features.txt b/jakarta-ant-1.2-src/docs/ant2/requested-features.txt
new file mode 100644
index 0000000..39e68a2
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/ant2/requested-features.txt
@@ -0,0 +1,122 @@
+Brainstormed and unordered list of requested features of Ant2:
+
+* namespace support so different concerns can occupy different namespaces
+  from ant (thus SAX2/JAXP1.1)
+
+* Java2
+
+* The ability for GUI/IDE tools to integrate easily with object model
+  without reinventing the wheel and writing their own parser (which
+  antidote was forced to do). Two suggested solutions were allowing GUI
+  developers to extend object model (ie GUITask extends Task) or to have
+  Task as interface (ie GUITask implements Task). This way the GUI tasks
+  could be W3C DOM Elements, have property vetoers/listeners etc.
+
+* Fully interpreted at runtime. This almost requires some form of
+  abstraction/proxy that stands in place of tasks till it is
+  interpreted.  This can be hashtables/simple dom-like model/whatever
+
+* provide utility classes to aid in building tasks. ie like up-to-date
+  functionality abstracted
+
+* make ant-call a low cost operations so it can certain
+  optional/template-like operations
+
+* allow facilities to build projects from multiple sources. ie CSS+xml
+  or XSLT+ XML or database or from inside jars or normal build.xmls
+  etc.
+
+* remove magic properties if at all humanly possible
+
+* make all tasks consistent and remove all deprecated methods
+
+* move to a system that allows docs to be generated - doc snippets
+  should be included with the tasks they document.
+
+* allow documentation to be stored in .tsk jars
+
+* allow tasks to be loaded from jars. tasks should be indicated by
+  either xml file in TSK-INF/taskdefs.xml or manifest file.
+
+* remove as much dependency on native scripts as possible.
+
+* clean object model (ie Project/Target/Task)
+
+* good event model to integrate well with IDE/GUI/whatever
+
+* better scripting/notification support so the hooks are available to
+  send notifications at certain times.
+
+* allow all datatypes to be defined anywhere
+
+* make usage of particular filters/filtersets explicit in copy tasks
+
+* make facade tasks for things like javac (JikesImpl, ModernImpl etc)
+
+* seperate tasks into .tsk jars somehow. (Probably via function - ie
+  java tasks, file tasks, ejb tasks).
+
+* unify multiple similar tasks to use similar forms (ie all the javacc
+  type tools)
+
+* support for numerous frontends - from command line over GUI to servlets
+
+* make properties fully dynamic, i.e. allow their value to be reassigned
+
+Now there is a bunch of "controvertial" points. By controvertial I mean not
+everyone agrees or else there has not been enough comments to to judge
+reception
+
+* unify the namespace of all data types (ie properties + filesets +
+  patternset + filtersets).
+
+* provide datatypes through property tag and remove need for seperate free
+  standing entities. ie
+  <property name="foo">
+    <fileset dir="blah">
+     <include name="*/**.java" />
+    </fileset>
+  </property>
+
+
+* make it possible to reuse taskengine for other things. ie
+  Installshield type app, my cron-server and other task based
+  operations. Currently no committer other than me has expressed
+  positive or negative thoughts about this
+
+* make separate build files easy (ala AntFarm) and importing different
+  projects a breeze
+
+* create the concept of workspace so that projects can be built in a
+  DAG and thus enable projects like catalina/tomcat to have an easy
+  build process. It also helps CJAN to a lesser degree and would
+  partially solve the JARs in CVS thing.
+
+* provide support for CJAN
+
+* provide support for non-hardwired (ie loadable) converters.
+
+* provide support for non-hardwired (ie loadable) datatypes.
+
+* generate docs by anakia/XSLT
+
+* provide support for user defined task configurations - i.e. give
+  users the ability to specify a default value for attributes (always
+  use debug="true" in <javac> unless something else has been
+  specified). Could be a CSS like language, could be a <taskconfig>
+  element ...
+
+* support more control over the properties that are going to be passed
+  to subprojects (modules)
+
+* keep build file syntax as compatible to Ant1 as possible -
+  i.e. don't break something just because we can.
+
+* keep the interface for Tasks as similar to the one of Ant1 as
+  possible - i.e. don't break something just because we can.
+
+* tasks provide some way to identify their attributes from the
+  outside. Possible solutions include a special method like
+  getProperties(), an external describing file shipping with the task
+  class or special javadoc comments parsed by a custom doclet.
+
diff --git a/jakarta-ant-1.2-src/docs/ant_in_anger.html b/jakarta-ant-1.2-src/docs/ant_in_anger.html
new file mode 100644
index 0000000..da6bef7
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/ant_in_anger.html
@@ -0,0 +1,816 @@
+<head>
+<title>
+	Ant in Anger
+</title>
+</head>
+
+<body bgcolor="#FFFFFF" text="#000000">
+<h1 align="center">Ant in Anger:
+</h1>
+<h2 align="center">
+	Using Ant in a Production Development System
+</h2>
+
+<h4  align="center">
+Steve Loughran (<a href="mailto:steve_l@iseran.com">steve_l@iseran.com</a>)
+</h4>
+
+<a name="introduction">
+
+<h2>Introduction</h2>
+</a>
+
+<a href="http://jakarta.apache.org/ant/">Ant</a>
+ can be an invaluable tool in a team development process -or it can
+be yet another source of problems in that ongoing crises we call
+development . This
+document contains some strategies and tactics for making the most of
+ant. It is moderately frivolous in places, and lacks almost any actual
+examples of ant xml. The lack of examples is entirely deliberate -it
+keeps document maintenance costs down. Most of the concepts covered
+don't need the detail about XML representations, as it is processes we
+are concerned about, not syntax. Finally, please be aware that the
+comments here are only suggestions which need to be customised to meet
+your own needs, not strict rules about what should and should not be
+done.
+
+<p>
+Firstly, here are some assumptions about the projects which this
+document covers
+<ul>
+<li> Pretty much pure Java.
+
+<li> Team efforts, usually with the petulant prima-donnas all us Java
+programmers become once we realise how much in demand we are.
+
+<li> A fairly distributed development team -spread across locations and
+maybe time zones.
+
+<li> Separate sub projects -from separate beans in a big
+enterprise application to separate enterprise applications which need to
+be vaguely aware of each other.
+
+<li> Significant mismatch between expectations and time available to
+deliver. 'Last Week' is the ideal delivery date handed down from above,
+next century the date coming up from below.
+
+<li> Everyone is struggling to keep up with platform and tool evolution.
+
+<li> Extensive use of external libraries, both open and closed source.
+
+</ul>
+
+What that all means is that there is no time to spend getting things
+right, you don't have that tight control on how the rest of the team
+works and the development process is often more one of chaos minimisation
+than anything else. The role of ant in such projects is to ensure that
+the build, test and deploy processes run smoothly, leaving you with all
+the other problems.
+
+<a name="core">
+<h2>Core Practices</h2>
+</a>
+<h3>
+Clarify what you want ant to do</h3>
+
+
+Ant is not a silver bullet. It is just another rusty bullet in the armory of
+development tools available at your disposal. Its primary purpose is to
+accelerate the construction and deployment of Java projects. You could certainly
+extend ant to do anything Java makes possible -it is easy to imagine writing an
+image processing task to help in web site deployment by shrinking and
+recompressing jpeg files, for example. But that would be pushing the boundary of
+what ant is really intended to do -so should be considered with care.
+
+<P>
+
+Ant is also a great adjunct to an IDE -a way of doing all the housekeeping of
+deployment and for clean, automated builds. But a good modern IDE is a
+productivity tool in its own right -one you should consider keeping using. Ant
+just lets you give the teams somewhat more freedom in IDE choice -&quot;you can
+use whatever you want in development, but ant for the deployment
+builds&quot;
+
+<h3>
+Define standard targets
+</h3>
+
+
+When you have multiple sub projects, define a standard set of targets.
+Projects with a split between interface and implementation jar files
+could consider <b>impl</b> and <b>intf</b> targets -with separate
+<b>debug-impl</b>and <b>debug-intf</b> targets for the debug version.
+And of course, the ubiquitous <b>clean</b> target.
+
+<P>
+
+With standard target names, it is easy to build encompassing ant build
+files which just hand off the work to the classes below using the
+<a href="manual/CoreTasks/ant.html">ant</a>
+task. For example. the clean target could be handed down to the intf and
+impl subdirectories from a parent directory
+
+<pre>&lt;target name=&quot;clean&quot;  depends=&quot;clean-intf, clean-impl&quot;&gt;
+&lt;/target&gt;
+
+&lt;target name=&quot;clean-intf&quot; &gt;
+	&lt;ant dir=&quot;intf&quot; target=&quot;clean&quot; /&gt;
+&lt;/target&gt;
+
+&lt;target name=&quot;clean-impl&quot;&gt;
+	&lt;ant dir=&quot;impl&quot; target=&quot;clean&quot; /&gt;
+&lt;/target&gt;  </pre>
+
+<h3>
+	Extend ant through new tasks
+</h3>
+
+If ant does not do what you want, you can use the
+<a href="manual/CoreTasks/exec.html">exec</a> and
+<a href="manual/CoreTasks/java.html">java</a> tasks or
+<a href="manual/OptionalTasks/script.html">inline scripting</a> to extend it. In a
+project with many build.xml files, you soon find that having a single
+central place for implementing the functionality keeps maintenance
+overhead down. Implementing task extensions through java code seems
+extra effort at first, but gives extra benefits:-
+
+ <ul>
+
+<li>Cross platform support can be added later without changing any
+build.xml files</li>
+
+<li>The code can be submitted to the ant project itself, for other
+people to use and maintain</li>
+
+<li>It keeps the build files simpler</li>
+
+</ul>
+
+<h3>
+Embrace Automated Testing
+</h3>
+
+<b>(alternatively "recriminate early, recriminate often")</b>
+<p>
+
+Ant lets you call <a href="manual/OptionalTasks/junit.html">JUnit</a> tasks, which unit test
+the code your team has written. Automated testing may seem like extra
+work at first, but JUnit makes writing unit tests so easy that you have
+almost no reason not to. Invest the time in learning how to use
+JUnit, write the test cases, and integrate them in a 'test' target from
+ant so that your daily or hourly team build can have the tests applied
+automatically.
+
+<p>
+
+Once code fetches from the code control system are added as another ant
+target, the integration test code can be a pure ant task run on any box
+dedicated to the task. This is ideal for verifying that the build and
+unit tests work on different targets from the usual development
+machines. For example, a Win95/Java1.1 combination could be used even
+though no developer would willingly use that configuration given the
+choice.
+
+<p>
+
+System tests are harder to automate than unit tests, but if you can
+write java code to stress large portions of the system -even if the code
+can not run as JUnit tasks- then the <a href= "manual/CoreTasks/java.html">java</a>
+task can be used to invoke them. It is best to specify that you want a
+new JVM for these tests, so that a significant crash does not break the
+full build.
+
+
+<a name="crossplatform">
+<h2>
+Cross Platform Ant
+</h2>
+</a>
+
+Ant is the best foundation for cross platform Java development and
+testing to date. But if you are not paying attention, it is possible to
+produce build files which only work on one platform -or indeed, one
+single workstation.
+
+<p>
+
+The common barriers to cross-platform ant are the use of command line
+tools (exec tasks) which are not portable, path issues, and hard coding
+in the location of things.
+
+<h3>Command Line apps: <a href="manual/CoreTasks/exec.html">Exec</a>/ <a href=
+"manual/CoreTasks/execon.html">ExecOn</a></h3>
+
+The trouble with external invocation is that not all functions are found
+cross platform, and those that are often have different names -DOS
+descendants often expect .exe or .bat at the end of files. That can be
+bad if you explicitly include the extension in the naming of the command
+(don't!), good when it lets you keep the unix and DOS versions of an
+executable in the same bin directory of the project without name
+clashes arising.
+
+<p>
+
+Both the command line invocation tasks let you specify which platform
+you want the code to run on, so you could write different tasks for each
+platform you are targeting. Alternatively, the platform differences
+could be handled inside some external code which ant calls. This can be
+some compiled down java in a new task, or an external script file.
+
+<h3>Cross platform paths</h3>
+
+Unix paths use forward slashes between directories and a colon to
+split entries. Thus
+<i>"/bin/java/lib/xerces.jar:/bin/java/lib/ant.jar"</i> is
+a path in unix. In Windows the path must use semicolon separators,
+colons being used to specify disk drives, and backslash separators
+<i>"c:\bin\java\lib\xerces.jar;c:\bin\java\lib\ant.jar"</i>.
+
+This difference between platforms (indeed, the whole java classpath
+paradigm) can cause hours of fun.
+
+<p>
+
+Ant reduces path problems; but does not eliminate them entirely. You
+need to put in some effort too. The rules for handling path names are
+that 'DOS-like pathnames are handled', 'Unix like paths are handled'.
+Disk drives -'C:'- are handled on DOS-based boxes, but placing them in
+the build.xml file ruins all chances of portability. Relative file paths
+are much more portable. Semicolons work as path separators -a fact which
+is useful if your ant invocation wrapper includes a list of jars as a
+defined property in the command line. In the build files you may find it
+better to build a classpath by listing individual files (using location=
+attributes), or by including a fileset of *.jar in the classpath
+definition.
+
+
+<p>
+Note that DOS descended file systems are case insensitive (apart from
+the obscure aberration of the WinNT posix subsystem run against NTFS),
+and that Windows pretends that all file extensions with four or more
+letters are also three letter extensions (try DELETE *.jav in your java
+directories to see a disastrous example of this).
+
+<p>
+
+Ant's policy on case sensitivity is whatever the underlying file system
+implements *VERIFY*, and its handling of file extensions is that *.jav does not
+find any .java files. The Java compiler is of course case sensitive -you can
+not have a class 'ExampleThree' implemented in "examplethree.java".
+
+<p>
+
+Some tasks only work on one platform -<a href= "manual/CoreTasks/chmod.html">
+Chmod</a> being a classic example. These tasks usually result in just a
+warning message on an unsupported platform -the rest of the target's
+tasks will still be called. Other tasks degrade their functionality on
+platforms or Java versions. In particular, any task which adjusts the
+timestamp of files can not do so properly on Java 1.1. Tasks which can
+do that - <a href="manual/CoreTasks/get.html">Get<a>, <a
+href="manual/CoreTasks/touch.html">Touch</a> and <A href="manual/CoreTasks/unzip.html">
+Unjar/Unwar/Unzip</a> for example, degrade their functionality on
+Java1.1, usually resorting to the current timestamp instead.
+
+
+<p>
+
+Finally, Perl makes a good place to wrap up Java invocations cross
+platform, rather than batch files. It is included in most Unix
+distributions, and is a simple download for <a href=
+"http://www.activestate.com/Products/ActivePerl/"> Win32 platforms from
+ActiveState</a>. A Perl file with .pl extension, with the usual Unix
+path to perl on the line 1 comment and marked as executable can be run
+on Windows, OS/2 and Unix and hence called from Ant without issues. The
+perl code can be left to resolve its own platform issues.
+
+<a name="team">
+<h2>Team Development Processes</h2>
+</a>
+
+Even if each team member is allowed their choice of IDE/editor, or even
+OS, you need to set a baseline of functionality on each box. In
+particular, the JDKs and jars need to be in perfect sync. Ideally pick
+the latest stable Java/JDK version available on all developer/target
+systems and stick with it for a while. Consider assigning one person to
+be the contact point for all tools coming in -particularly open source
+tools when a new build is available on a nightly basis. Unless needed,
+these tools should only really be updated monthly, or when a formal
+release is made.
+
+<p>
+
+Another good tactic is to use a unified directory tree, and add on extra
+tools inside that tree. All references can be made relative to the tree.
+If team members are expected to add a directory in the project to their
+path, then command line tools can be included there -including those
+invoked by ant exec tasks. Put everything under source code control and
+you have a one stop shop for getting a build/execute environment purely
+from CVS or your equivalent.
+
+
+<a name="deploying">
+<h2>Deploying with Ant</h2>
+</a>
+
+One big difference between ant and older tools such as make is that the
+processes for deploying java to remote sites are reasonably well
+evolved in ant. That is because we all have to do it these days, so
+many people have put in the effort to make the tasks easier.
+<p>
+
+Ant can <a href="manual/CoreTasks/jar.html">Jar</a>, <a href= "manual/CoreTasks/tar.html">
+Tar</a> or <a href="manual/CoreTasks/zip.html">Zip</a> files for deployment, while
+the <a href="manual/CoreTasks/war.html">War</a> task extends the jar task for
+better servlet deployment. <a href = "jlink.html" >Jlink</a> is a jar
+generation file which lets you merge multiple sub jars. This is ideal
+for a build process in which separate jars are generated by sub
+projects, yet the final output is a merged jar. <a href=
+"manual/OptionalTasks/cab.html">Cab</a> can be used on Win32 boxes to build a cab file
+which is useful if you have to target IE deployment.
+
+<p>
+
+The <a href = "index.html#ftp">ftp</a> task lets you move stuff up to a
+server. Beware of putting the ftp password in the build file -a property
+file with tight access control is slightly better. The <a href=
+"manual/CoreTasks/fixcrlf.html">FixCRLF task</a> is often a useful interim step if
+you need to ensure that files have unix file extensions before upload. A
+WebDav task has long been discussed, which would provide a more secure
+upload to web servers, but it is still in the todo list. If DAV is your
+required upload mechanism, why not take up the challenge?
+
+<p>
+
+EJB deployment is aided by the <a href="manual/OptionalTasks/ejb.html">ejb tasks</a>. At the
+time of writing, only WebLogic was supported with these tasks -if your
+EJB server is not supported, extending the ejb tasks would benefit your
+project and the rest of the ant community.
+
+<p>
+
+Finally, there are of course the fallbacks of just copying files to a
+destination using <a href="manual/CoreTasks/copy.html">Copy</a> and <a href =
+"index.html#copydir">Copydir</a> , or just sending them to a person or
+process using <a href= "manual/CoreTasks/mail.html">Mail</a>.
+
+<a name="directories">
+<h2> Directory Structures</h2>
+</a>
+
+How you structure your directory tree is very dependent upon the
+project. Here are some directory layout patterns which can be used as
+starting points.
+
+<h3>Simple Project</h3>
+
+The project contains sub directories
+<table width="100%">
+<tr>
+	<td><b>bin</b>
+	</td>
+	<td>common binaries, scripts -put this on the path.
+	</td>
+</tr>
+
+<tr>
+	<td><b>build</b>
+	</td>
+	<td>This is the tree for building; ant creates it and can empty it
+	in the 'clean' project.
+	</td>
+</tr>
+<tr>
+	<td><b>dist</b>
+	</td>
+	<td>Distribution outputs go in here; the directory is created in ant
+	and clean empties it out
+	</td>
+</tr>
+<tr>
+	<td><b>doc</b>
+	</td>
+	<td>Hand crafted documentation
+	</td>
+</tr>
+<tr>
+	<td><b>lib</b>
+	</td>
+	<td>Imported Java libraries go in to this directory
+	</td>
+</tr>
+<tr>
+	<td><b>src</b>
+	</td>
+	<td>source goes in under this tree
+	</td>
+</tr>
+</table>
+
+The bin, lib, doc and src directories should be under source code control.
+Slight variations include an extra tree of content to be included in the
+distribution jars -inf files, images, etc. Javadoc output can be
+directed to a doc/ folder beneath build/, or to doc/javadoc.
+
+<h3>Interface and Implementation split</h3>
+
+If the interface is split from the implementation code then this can be
+supported with minor changes just by having a separate build path for
+the interface directory -or better still just in the jar construction:
+one jar for interface and one jar for implementation.
+
+
+<h3>Loosely Coupled Sub Projects</h3>
+
+In the loosely coupled approach multiple projects can have their own
+copy of the tree, with their own source code access rights.
+One difference to consider is only having one instance of the bin and
+lib directories across all projects. This is sometimes good -it helps
+keep copies of xerces.jar in sync, and sometimes bad -it can update
+foundational jar files before unit testing is complete.
+
+<p>
+
+To still have a single build across the sub projects, use parent
+build.xml files which call down into the sub projects.
+
+<p>
+
+This style works well if different teams have different code
+access/commitment rights. The risk is that by giving extra leeway to the
+sub projects, you can end up with incompatible source, libraries, build
+processes and just increase your workload and integration grief all round.
+
+<h3>Integrated sub projects</h3>
+
+Tightly coupled projects have all the source in the same tree; different
+projects own different subdirectories. Build files can be moved down to
+those subdirectores (say src/com/iseran/core and src/com/iseran/extras),
+or kept at the top -with independent build files named core.xml and
+extras.xml
+
+<p>
+
+This project style works well if everyone trusts each other and the
+sub projects are not too huge or complex. The risk is that a split to a
+more loosely coupled design will become a requirement as the projects
+progress -but by the time this is realised schedule pressure and
+intertwined build files make executing the split well nigh impossible.
+If that happens then just keep with it until there is the time to
+refactor the project directory structures.
+
+<a name="antupdate">
+<h2>
+	Ant Update Policies
+</h2>
+</a>
+
+Once you start using ant, you should have a policy on when and how the
+team updates their copies. A simple policy is "every official release
+after whatever high stress milestone has pushed all unimportant tasks
+(like sleep and seeing daylight) on the back burner". This insulates you
+from the changes and occasional instabilities that ant goes through
+during development. Its main disadvantage is that it isolates you from
+the new tasks and features that ant is constantly adding.
+
+<p>
+
+Often an update will require changes to the build.xml files. Most
+changes are intended to be backwards compatible, but sometimes an
+incompatible change turns out to be
+necessary. That is why doing the update in the lull after a big
+milestone is important. It is also why including ant.jar and related
+files in the CVS tree helps ensure that old versions of your software
+can be still be built.
+
+<p>
+
+The most aggressive strategy is to get a weekly or daily snapshot of the
+ant source, build it up and use it. This forces you to tweak the
+build.xml files more regulary, as new tasks and attributes can take
+while to stabilise. You really have to want the new features, enjoy
+gratuitous extra work or take pleasure in upsetting your colleagues to
+take this approach.
+
+<p>
+
+Once you start extending ant with new tasks, it suddenly becomes much
+more tempting to pull down regular builds. The most recent ant builds
+are invariably the the best platform for writing your extensions, as you
+can take advantage of the regular enhancements to the foundational
+classes. It also prevents you from wasting time working on something
+which has already been done. A newly submitted task to do something
+complex such as talk to EJB engines, SOAP servers or just convert a text
+file to uppercase may be almost exactly what you need -so take it,
+enhance it and offer up the enhancements to the rest of the world. This
+is certainly better than starting work on your 'text case converter'
+task on Ant 0.8 in isolation, announcing its existence six months latter
+and discovering that instead of adulation all you get are helpful
+pointers to the existing implementation.
+
+<p>
+
+You should also get on the <a href =
+"mailto:ant-dev-subscribe@jakarta.apache.org" > ant-dev mailing list
+</a>, as it is where the other developers post their work, problems and
+experience. The volume can be quite high: 40+ messages a day, so
+consider routing it to an email address you don't use for much else. And
+don't make everyone on the team subscribe; it can be too much of a
+distraction.
+
+
+<a name="tips">
+<h2>
+Tips and Tricks</h2>
+</a>
+<dl>
+<dt><b>
+	get
+</b><dd>
+
+The <a href="manual/CoreTasks/get.html">get</a> task can fetch any URL, so be used
+to trigger remote server side code during the build process, from remote
+server restarts to sending SMS/pager messages to the developer
+cellphones
+
+<dt><b>
+i18n
+</b><dd>
+
+
+Internationalisation is always trouble. Ant helps here with the <A href=
+"manual/OptionalTasks/native2ascii.html">native2ascii</a> task which can escape out all non
+ascii characters into unicode. You can use this to write java files
+which include strings (and indeed comments) in your own non-ASCII
+language and then use native2ascii to convert to ascii prior to feeding
+through javac. The rest of i18n and l12n is left to you...
+
+<dt><b>
+Use Property Files
+</b><dd>
+
+Use external property files to keep per-user settings out the build
+files -especially passwords. Property files can also be used to
+dynamically set a number of properties based on the value of a single
+property, simply by dyamically generating the property filename from the
+source property. They can also be used as a source of constants across
+multiple build files.
+
+<dt><b>
+Faster compiles with Jikes
+</b><dd>
+
+The <a href="http://www.jikes.org/">jikes compiler</a> is usually much
+faster than javac, and does dependency checking. Get it. Then set
+build.compiler to "jikes" for it to be used in your build files.
+
+<dt><b>
+#include targets to simplify multi build.xml projects
+</b><dd>
+
+You can import XML files into a build file using the XML parser itself.
+This lets a multi-project development program share code through reference,
+rather than cut and paste re-use. It also lets one build up a file of
+standard tasks which can be reused over time. Because the import
+mechanism is at a level below which ant is aware, treat it as
+equivalent to the #include mechanism of the 'legacy' languages C and
+C++.
+
+<p>
+
+There are two inclusion mechanisms, an ugly one for all parsers and a
+clean one. For now, the ugly
+method is the most portable:-
+<pre>
+	&lt;!DOCTYPE project [
+	  &lt;!ENTITY IncludeBuildCore SYSTEM &quot;buildCore.xml&quot;&gt;
+	  &lt;!ENTITY IncludeBuildSecondary SYSTEM &quot;buildSecondary.xml&quot;&gt;
+	%IncludeBuildCore;
+	%IncludeBuildSecondary;
+	]&gt;  
+	
+	&lt;target name=&quot;includedBuild&quot;&gt;
+		&amp;IncludeBuildCore;
+		&amp;IncludeBuildSecondary;
+	&lt;/target&gt;
+</pre>
+The clean method using XInclude/Xpath will let you include named 
+targets from one build file or another, using
+<a href="http://www.w3.org/XML/Linking"> 
+the xpointer syntax</a>. You'll need to wait for the W3C proposals
+to finalise and the java XML parsers to implement it before
+using xpointer references.  
+<dt><b>
+Implement complex Ant builds through XSL
+</b><dd>
+
+XSLT can be used to dynamically generate build.xml files from a source
+xml file, with the <a href="manual/CoreTasks/style.html">Style</a> task controlling
+the transform. This is the current recommended strategy for creating
+complex build files dynamically.
+
+
+<dt><b>
+Change the invocation scripts
+</b><dd>
+
+By writing your own invocation script -using the DOS, Unix or Perl
+script as a starting point- you can modify a ant behavior for an
+individual project. For example, you can use an alternate variable to
+ANT_HOME as the base, extend the classpath differently, or dynamically
+create a new command line property 'project.interfaces' from all .jar
+files in an interfaces directory.
+
+<p>
+
+Having a custom invocation script which runs off a CVS controlled
+library tree under PROJECT_HOME also lets you control ant versions
+across the team -developers can have other copies of ant if they want,
+but the CVS tree always contains the jar set used to build your project.
+
+<p>
+
+You can also write wrapper scripts which invoke the existing ant
+scripts. This is an easy way to extend them. The wrapper scripts can add
+extra definitions and name explicit targets, redefine ANT_HOME and
+generally make development easier. Note that "ant" in Windows is really
+"ant.bat", so should be invoked from another batch file with a "CALL
+ant" statement -otherwise it never returns to your wrapper.
+
+
+<dt><b>
+Write all code so that it can be called from Ant
+</b><dd>
+
+This seems a bit strange and idealistic, but what it means is that you should
+write all your java code as if it may be called as a library at some point in
+future. So do not place calls to <b>System.exit()</b> deep in the code -if you
+want to exit a few functions in, raise an exception instead and have
+<b>main()</b> deal with it.
+
+<dt><b>
+Use Antidote as the invocation tool
+</b><dd>
+Even if you edit ant files by hand, Antidote makes a good execution tool
+because it eliminates the startup time of the JVM, perhaps even some of
+the XML parsing delays. 
+
+</dl>
+
+<a name="puttingtogether">
+	<h2>
+		Putting it all together
+	</h2>
+</a>
+
+What does an ant build process look like in this world? Assuming a
+single directory structure for simplicity, the build file
+should contain a number of top level targets
+<ul>
+<li>build - do an (incremental) build
+<li>test - run the junit tests
+<li>clean - clean out the output directories
+<li>deploy - ship the jars, wars, whatever to the execution system
+<li>publish - output the source and binaries to any distribution site
+<li>fetch - get the latest source from the cvs tree
+<li>docs/javadocs - do the documenation
+<li>all - clean, fetch, build, test, docs, deploy
+<li>main - the default build process (usually build or build & test)
+</ul>
+Sub projects 'web', 'bean-1', 'bean-2' can be given their own build
+files -web.xml, bean-1.xml, bean-2.xml- with the same entry points.
+Extra toplevel tasks related to databases, web site images and the like
+should be considered if they are part of the process.
+
+<p>
+Debug/release switching can be handled with separate initialisation
+targets called before the compile tasks which define the appropriate
+properties.
+
+<p>
+Internal targets should be used to structure the process
+<ul>
+<li> init - initialise properties, extra-tasks, read in per-user
+property files.
+<li> init-debug - initialise debug properties
+<li> init-release - initialise release properties
+<li> compile - do the actual compilation
+<li> link/jar - make the jars or equivalent
+<li> staging - any pre-deployment process in which the output is dropped
+	off then tested before being moved to the production site.
+</ul>
+
+The switching between debug and release can be done using the 'if' and
+'unless' conditional flags on the targets, so that debug gets called
+unless 'project.mode.release' is defined.
+
+<p>
+
+It is useful to define a project name property which can be echoed in
+the init task. This lets you work out which ant file is breaking in a
+multi file build.
+
+<p>
+
+What goes in to the internal ant tasks depends on your own projects. One
+very important tactic is 'keep path redefinition down through
+references' - you can reuse paths by giving them an ID and then
+referring to them via the 'refid' attribute you should only need to
+define a shared classpath once in the file; filesets can be reused
+similarly.
+
+<p>
+
+Once you have set up the directory structures, and defined the ant tasks
+it is time to start coding. An early priority must be to set up the
+automated test process, as that not only helps ensures that the code
+works, it verifies that the build process is working.
+
+<p>
+
+And that's it. The build file shouldn't need changing as new source
+files get added, only when you want to change the deliverables or part
+of the build process. At some point you may want to massively
+restructure the entire build process, restructuring projects and the
+like, but even then the build file you have should act as a foundation
+for a split build file process -just pull out the common properties into
+a properties file all build files read in, keep the target names unified
+and keep going with the project. Restructuring the source code control
+system is often much harder work.
+
+<h2>The Limits of Ant</h2>
+
+Before you start adopting ant as the sole mechanism for the build
+process, you need to be aware of what it doesn't do.
+<p>
+
+<h3>It's not a scripting language</h3>
+
+Ant lets you declare what you want done, with a bit of testing of the
+platform and class libraries first to enable some platform specific
+builds to take place. It does not let you specify how to handle things
+going wrong (a listener class can do that), or support complex
+conditional statements.
+
+<p>
+
+If your build needs to handle exceptions then look at the sound listener
+as a simple example of how to write your own listener class. Complex
+conditional statements can be handled by having something else do the
+tests and then build the appropriate ant task. XSLT can be used for
+this.
+
+<h3>It's not Make</h3>
+
+Some of the features of make, specifically inference rules and
+dependency checking are not included in ant. That's because they are
+'different' ways of doing a build. Make requires you to state
+dependencies and the build steps, ant wants you to state tasks and the
+order between them, the tasks themselves can do depedency checking or
+not. A full java build using Jikes is so fast that dependency checking
+is relatively moot, while many of the other tasks (but not all), compare
+the timestamp of the source file with that of the destination file
+before acting.
+
+<h3>It's not meant to be a nice language for humans</h3>
+
+XML isnt a nice representation of information for humans. It's a
+reasonable representation for programs, and text editors and source code
+management systems can all handle it nicely. But a complex ant file can
+get ugly because XML is a bit ugly, and a complex build is, well,
+complicated. Use XML comments so that the file you wrote last month
+still makes sense when you get back to it, and use Antidote to edit the
+files if you prefer it. 
+
+
+<h2>Endpiece</h2>
+
+Software development is meant to be fun. Being in the maelstrom of a
+tight project with the stress of integration and trying to code
+everything up for an insane deadline can be fun -it is certainly
+exhilirating. Adding a bit of automation to the process may make things
+less chaotic, and bit less entertaining, but it is a start to putting
+you in control of your development process. You can still have fun, you
+should just have less to worry about, a shorter build/test/deploy cycle
+and more time to spend on feature creep or important things like skiing.
+So get out there and have fun!
+
+<a name="reading">
+<h2>Further Reading</h2>
+</a>
+<ul>
+<li>
+<a
+href="http://www.martinfowler.com/articles/continuousIntegration.html">
+Continuous Integration</a>; Martin Fowler. <br>
+A paper on using ant within a software project
+running a continuous integration/testing proces.
+<li> Refactoring; Martin Fowler, ISBN: 0201485672 <br>
+	Covers JUnit as well as tactics for making some headway with the mess of
+	code you will soon have.
+
+</ul>
+<hr>
+<p align="center">Copyright &copy; 2000 Apache Software Foundation. All rights
+Reserved.</p>
+
+
diff --git a/jakarta-ant-1.2-src/docs/ejb.html b/jakarta-ant-1.2-src/docs/ejb.html
deleted file mode 100644
index 39235ff..0000000
--- a/jakarta-ant-1.2-src/docs/ejb.html
+++ /dev/null
@@ -1,514 +0,0 @@
-<html>
-
-<head>
-<meta http-equiv="Content-Language" content="en-us">
-<title>Ant EJB Tasks</title>
-
-</head>
-
-<body>
-
-<h1>Ant EJB Tasks User Manual</h1>
-<p>by</p>
-<!-- Names are in alphabetical order, on last name -->
-<ul>
-  <li>Tim Fennell (<a href="mailto:tfenne@rcn.com">tfenne@rcn.com</a>)</li>
-  <li>Conor MacNeill (<a href="mailto:conor@cortexebusiness.com.au">conor@cortexebusiness.com.au</a>)</li>
-</ul>
-
-<p>Version 1.1 - 2000/07/18</p>
-<hr>
-<h2>Table of Contents</h2>
-<ul>
-  <li><a href="#introduction">Introduction</a></li>
-  <li><a href="#ejbtasks">EJB Tasks</a></li>
-</ul>
-
-<hr>
-<h2><a name="introduction">Introduction</a></h2>
-<p>Ant provides a number of optional tasks for developing 
-<a href="http://java.sun.com/products/ejb">Enterprise Java Beans (EJBs)</a>. 
-In general these tasks are specific to the particular vendor's EJB Server. At present the tasks support
-<a href="http://www.bea.com">Weblogic</a> 4.5.1 and 5.1 EJB servers. Over time we expect further optional tasks 
-to support additional EJB Servers. 
-
-<hr>
-<h2><a name="ejbtasks">EJB Tasks</a></h2>
-<table border="1" cellpadding="5">
- <tr><td>Task</td><td>Application Servers</td></tr>
- <tr><td><a href="#ddcreator">ddcreator</a></td><td>Weblogic 4.5.1</td></tr>
- <tr><td><a href="#ejbc">ejbc</a></td><td>Weblogic 4.5.1</td></tr>
- <tr><td><a href="#wlrun">wlrun</a></td><td>Weblogic 4.5.1 and 5.1</td></tr>
- <tr><td><a href="#wlstop">wlstop</a></td><td>Weblogic 4.5.1 and 5.1</td></tr>
- <tr><td><a href="#ejbjar">ejbjar</a></td><td>Weblogic 5.1</td></tr>
-</table>
-
-<hr>
-<h2><a name="ddcreator">ddcreator</a></h2>
-<h3><b>Description:</b></h3>
-<p>ddcreator will compile a set of Weblogic text-based deployment descriptors into a serialized
-EJB deployment descriptor. The selection of which of the text-based descriptors are to be compiled
-is based on the standard Ant include and exclude selection mechanisms. 
-
-
-<h3>Parameters:</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">descriptors</td>
-    <td valign="top">This is the base directory from which descriptors are selected.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">The directory where the serialised deployment descriptors will be written</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">This is the classpath to use to run the underlying weblogic ddcreator tool. 
-                     This must include the <code>weblogic.ejb.utils.DDCreator</code> class</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>&lt;ddcreator descriptors=&quot;${dd.dir}&quot; 
-           dest=&quot;${gen.classes}&quot; 
-           classpath=&quot;${descriptorbuild.classpath}&quot;&gt;
-  &lt;include name=&quot;*.txt&quot; /&gt;
-&lt;/ddcreator&gt;</code>
-</pre>
-
-<hr>
-<h2><a name="ejbc">ejbc</a></h2>
-<h3><b>Description:</b></h3>
-<p>The ejbc task will run Weblogic's ejbc tool. This tool will take a serialised deployment descriptor, 
-examine the various EJB interfaces and bean classes and then generate the required support classes 
-necessary to deploy the bean in a Weblogic EJB container. This will include the RMI stubs and skeletons
-as well as the classes which implement the bean's home and remote interfaces.
-<p>
-The ant task which runs this tool is able to compile several beans in a single operation. The beans to be 
-compiled are selected by including their serialised deployment descriptors. The standard ant 
-<code>include</code> and <code>exclude</code> constructs can be used to select the deployment descriptors
-to be included. 
-<p>
-Each descriptor is examined to determiune whether the generated classes are out of date and need to be 
-regenerated. The deployment descriptor is de-serialized to discover the home, remote and 
-implementation classes. The corresponding source files are determined and checked to see their 
-modification times. These times and the modification time of the serialised descriptor itself are
-compared with the modification time of the generated classes. If the generated classes are not present
-or are out of date, the ejbc tool is run to generate new versions.
-<h3>Parameters:</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">descriptors</td>
-    <td valign="top">This is the base directory from which the serialised deployment descriptors are selected.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">The base directory where the generated classes, RIM stubs and RMI skeletons are written</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">manifest</td>
-    <td valign="top">The name of a manifest file to be written. This manifest will contain an entry for each EJB processed</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">The base directory of the source tree containing the source files of the home interface,
-                     remote interface and bean implementation classes.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">This classpath must include both the <code>weblogic.ejbc</code> class and the
-                     classfiles of the bean, home interface, remote interface, etc of the bean being
-                     processed.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>&lt;ejbc descriptors=&quot;${gen.classes}&quot;
-           src=&quot;${src.dir}&quot; 
-           dest=&quot;${gen.classes}&quot;
-           manifest=&quot;${build.manifest}&quot; 
-           classpath=&quot;${descriptorbuild.classpath}&quot;&gt;
-  &lt;include name=&quot;*.ser&quot; /&gt;
-&lt;/ejbc&gt;</code>
-</pre>
-
-<hr>
-<h2><a name="wlrun">wlrun</a></h2>
-<h3><b>Description:</b></h3>
-<p>The <code>wlrun</code> task is used to start a weblogic server. The task runs
-a weblogic instance in a separate Java Virtual Machine. A number of parameters 
-are used to control the operation of the weblogic instance. Note that the task, 
-and hence ant, will not complete until the weblogic instance is stopped.
-
-<h3>Parameters:</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">home</td>
-    <td valign="top">The location of the weblogic home that is to be used. This is the location 
-                     where weblogic is installed.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to be used with the Java Virtual Machine that runs the Weblogic 
-                     Server. This is typically set to the Weblogic boot classpath.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">wlclasspath</td>
-    <td valign="top">The weblogic classpath used by the Weblogic Server.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">properties</td>
-    <td valign="top">The name of the server's properties file within the weblogic home directory
-                     used to control the weblogic instance.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">name</td>
-    <td valign="top">The name of the weblogic server within the weblogic home which is to be run. 
-                     This defaults to &quot;myserver&quot;</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">policy</td>
-    <td valign="top">The name of the security policy file within the weblogic home directory that 
-                     is to be used. If not specified, the default policy file <code>weblogic.policy</code>
-                     is used.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">jvmargs</td>
-    <td valign="top">Additional argument string passed to the Java Virtual Machine used to run the
-                     Weblogic instance.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">args</td>
-    <td valign="top">Additional argument string passed to the Weblogic instance.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-
-
-<hr>
-<h2><a name="wlstop">wlstop</a></h2>
-<h3><b>Description:</b></h3>
-<p>The <code>wlstop</code> task is used to stop a weblogic instance which is currently running.
-To shut down an instance you must supply both a username and a password. These will be stored 
-in the clear in the build script used to stop the instance. For security reasons, this task is 
-therefore only appropriate in a development environment. 
-
-<h3>Parameters:</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to be used with the Java Virtual Machine that runs the Weblogic 
-                     Shutdown comment.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">user</td>
-    <td valign="top">The username of the account which will be used to shutdown the server</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">password</td>
-    <td valign="top">The password for the account specified in the user parameter.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">url</td>
-    <td valign="top">The URL which describes the port to which the server is listening for T3 connections. 
-                     For example, t3://localhost:7001</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">delay</td>
-    <td valign="top">The delay in seconds after which the server will stop. This defaults to an
-                     immediate shutdown.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-
-
-<hr>
-<h2><a name="ejbjar">ejbjar</a></h2>
-<h3><b>Description:</b></h3>
-<p>This task is designed to support building of arbitrary EJB1.1 jar files. Support is currently
-   provided for 'vanilla' EJB1.1 jar files - i.e. those containing only the user generated class
-   files and the standard deployment descriptor. Nested elements provide support for vendor
-   specific deployment tools. Currently, a nested element is provided for building Weblogic 5.1 
-   session/entity beans using the weblogic.ejbc tool as well as a nested element for building 
-   TOPLink for WebLogic 2.5.1-enabled entity beans.</p>
-
-<p>This task supports two approaches to creating ejb jar files. The first approach assumes a particular 
-   naming convention for deployment descriptor files. For an Account bean, for example, the deployment 
-   descriptor would be named <code>Account-ejb-jar.xml</code>. This naming convention allows the task to 
-   distinguish deployment descriptors without relying on their positioning within a source tree. It is 
-   also used to derive the name of the .jar file which is generated. For the example this would be 
-   <code>Account.jar</code>. Vendor specific files are assumed to be named in a similar fashion. The 
-   deployment descriptor file which defines additional weblogic specific information for the above bean 
-   would be <code>Account-weblogic-ejb-jar.xml</code>.
-   The second approach does not require a naming convention. This approach uses a specified a jar name 
-   for the resultant ejb jar. If the jar name is present, then no naming convention is required. If the
-   jar name is not specified, then the default naming convention is expected for the deployment descriptor
-   files.
-   
-<p>The task works as a directory scanning task, and performs an action for each deployment descriptor
-   found. As such the includes and excludes should be set to ensure that all desired EJB1.1
-   descriptors are found, but no application server descriptors are found. For each descriptor
-   found, ejbjar will parse the deployment descriptor to determine the necessary class files which
-   implement the bean. These files are assembled along with the deployment descriptors into a well 
-   formed EJB jar file. Note that support classes used by the bean but which are not part of the 
-   bean's interfaces are not included in the assembled jar. These need to be collected into a
-   separate support jar file.</p>
-
-<p>If no nested vendor-specific deployment elements are present, the task will simply generate a
-   generic EJB jar. Such jars are typically used as the input to vendor-specific deployment tools.
-   For each nested deployment element, a vendor specific deployment tool is run to generate a jar file
-   ready for deployment in that vendor's EJB container. Note that at this time the only supported tool is
-   Weblogic's ejbc tool.
-
-<p>The jar files are only built if they are out of date.  Each deployment tool element will examine
-   its target jar file and determine if it is out of date with respect to the class files and 
-   deployment descriptors that make up the bean. If any of these files are newer than the jar file
-   the jar will be rebuilt otherwise a message is logged that the jar file is up to date.</p>
-
-<h3>Parameters:</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">descriptordir</td>
-    <td valign="top">The base directory under which to scan for EJB deployment descriptors. If this
-                     attribute is not specified, then the deployment descriptors must be located in
-                     the directory specified by the 'srcdir' attribute.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">srcdir</td>
-    <td valign="top">The base directory containing the .class files that make up the bean.
-                     Note that this can be the same as the descriptordir if all files are
-                     in the same directory tree.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">The base directory into which generated jar files are deposited. Jar files are deposited in
-                     directories correpsonding to their location within the descriptordir namespace. Note that 
-                     this attribute is only used if the task is generating generic jars (i.e. no vendor-specific
-                     deployment elements have been specified).</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basejarname</td>
-    <td valign="top">The base name that is used for the generated jar files. If this attribute is specified, the
-                     generic jar file name will use this value as the prefix (followed by the value specified in 
-                     the 'genericjarsuffix' attibute) and the resultant ejb jar file (followed by any suffix specified
-                     in the nested element).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">basenameterminator</td>
-    <td valign="top">String value used to substring out a string from the name of each deployment descriptor found,
-                     which is then used to locate related deployment descriptors (e.g. the WebLogic descriptors). 
-                     For example, a basename of '.' and a deployment descriptor called 'FooBean.ejb-jar.xml' would
-                     result in a basename of 'FooBean' which would then be used to find FooBean.weblogic-ejb-jar.xml
-                     and FooBean.weblogic-cmp-rdbms-jar.xml, as well as to create the filenames of the jar files as
-                     FooBean-generic.jar and FooBean-wl.jar. This attribute is not used if the 'basejarname' attribute
-                     is specified.</td>
-    <td valign="top" align="center">No, defaults to '-'.</td>
-  </tr>
-  <tr>
-    <td valign="top">genericjarsuffix</td>
-    <td valign="top">String value appended to the basename of the deployment descriptor to create the filename of the
-                     generic EJB jar file.</td>
-    <td valign="top" align="center">No, defaults to '-generic.jar'.</td>
-  </tr>
-</table>
-
-<h3>Vendor-specific deployment elements</h3>
-
-Each vendor-specific nested element controls the generation of a deployable jar specific to that vendor's
-EJB container. The parameters for each supported deployment element are detailed here.
-
-<h3>Weblogic element</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">The base directory into which the generated weblogic ready jar files are deposited. 
-                     Jar files are deposited in directories correpsonding to their location within the 
-                     descriptordir namespace. </td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">genericjarsuffix</td>
-    <td valign="top">A generic jar is generated as an intermeditate step in build the weblogic deployment
-                     jar. The suffix used to generate the generic jar file is not particularly important
-                     unless it is desired to keep the generic jar file. It should not, however, be the same
-                     as the suffix setting.</td>
-    <td valign="top" align="center">No, defaults to '-generic.jar'.</td>
-  </tr>
-  <tr>
-    <td valign="top">suffix</td>
-    <td valign="top">String value appended to the basename of the deployment descriptor to create the filename of the
-                     WebLogic EJB jar file.</td>
-    <td valign="top" align="center">No, defaults to '.jar'.</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to be used when running the weblogic ejbc tool. Note that this tool 
-                     typically requires the classes that make up the bean to be available on the classpath. 
-                     Currently, however, this will cause the ejbc tool to be run in a separate VM</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keepgeneric</td>
-    <td valign="top">This controls whether the generic fiule used as input to ejbc is retained.</td>
-    <td valign="top" align="center">No, defaults to false</td>
-  </tr>
-</table>
-
-<h3>TOPLink for Weblogic element</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">The base directory into which the generated weblogic ready jar files are deposited. 
-                     Jar files are deposited in directories correpsonding to their location within the 
-                     descriptordir namespace. </td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">genericjarsuffix</td>
-    <td valign="top">A generic jar is generated as an intermeditate step in build the weblogic deployment
-                     jar. The suffix used to generate the generic jar file is not particularly important
-                     unless it is desired to keep the generic jar file. It should not, however, be the same
-                     as the suffix setting.</td>
-    <td valign="top" align="center">No, defaults to '-generic.jar'.</td>
-  </tr>
-  <tr>
-    <td valign="top">suffix</td>
-    <td valign="top">String value appended to the basename of the deployment descriptor to create the filename of the
-                     WebLogic EJB jar file.</td>
-    <td valign="top" align="center">No, defaults to '.jar'.</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to be used when running the weblogic ejbc tool. Note that this tool 
-                     typically requires the classes that make up the bean to be available on the classpath. 
-                     Currently, however, this will cause the ejbc tool to be run in a separate VM</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keepgeneric</td>
-    <td valign="top">This controls whether the generic file used as input to ejbc is retained.</td>
-    <td valign="top" align="center">No, defaults to false</td>
-  </tr>
-  <tr>
-    <td valign="top">toplinkdescriptor</td>
-    <td valign="top">This specifes the name of the TOPLink deployment descriptor file contained in the 
-                     'descriptordir' directory.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">toplinkdtd</td>
-    <td valign="top">This specifies the location of the TOPLink DTD file. This can be a file path or
-                     a file URL. This attribute is not required, but using a local DTD is recommended.</td>
-    <td valign="top" align="center">No, defaults to dtd file at www.objectpeople.com.</td>
-  </tr>
-</table>
-
-
-<h3>Examples</h3>
-This example shows ejbjar being used to generate deployment jars using a Weblogic EJB container. This example
-requires the naming standard to be used for the deployment descriptors. Using this format will create a ejb
-jar file for each variation of '*-ejb-jar.xml' that is found in the deployment descriptor directory.
-<pre>
-    &lt;ejbjar srcdir="${build.classes}"
-            descriptordir="${descriptor.dir}"&gt;
-      &lt;weblogic destdir="${deploymentjars.dir}"
-                classpath="${descriptorbuild.classpath}"/&gt;
-      &lt;include name="**/*-ejb-jar.xml"/&gt;
-      &lt;exclude name="**/*weblogic*.xml"/&gt;
-    &lt;/ejbjar&gt;
-</pre>
-
-This example shows ejbjar being used to generate a single deployment jar using a Weblogic EJB container. This example 
-does not require the deployment descriptors to use the naming standard. This will create only one ejb jar file - 
-'TheEJBJar.jar'.
-<pre>
-    &lt;ejbjar srcdir="${build.classes}"
-            descriptordir="${descriptor.dir}"
-            basejarname="TheEJBJar"&gt;
-      &lt;weblogic destdir="${deploymentjars.dir}"
-                classpath="${descriptorbuild.classpath}"/&gt;
-      &lt;include name="**/ejb-jar.xml"/&gt;
-      &lt;exclude name="**/weblogic*.xml"/&gt;
-    &lt;/ejbjar&gt;
-</pre>
-
-This example shows ejbjar being used to generate deployment jars for a TOPLink-enabled entity bean using a 
-Weblogic EJB container. This example does not require the deployment descriptors to use the naming standard.
-This will create only one TOPLink-enabled ejb jar file - 'Address.jar'.
-<pre>
-    &lt;ejbjar srcdir="${build.dir}"
-            destdir="${solant.ejb.dir}"
-            descriptordir="${descriptor.dir}"
-            basejarname="Address"&gt;
-            &lt;weblogictoplink destdir="${solant.ejb.dir}"
-                    classpath="${java.class.path}"
-                    keepgeneric="false"
-                    toplinkdescriptor="Address.xml"
-                    toplinkdtd="file:///dtdfiles/toplink-cmp_2_5_1.dtd"
-                    suffix=".jar"/&gt;
-            &lt;include name="**/ejb-jar.xml"/&gt;
-            &lt;exclude name="**/weblogic-ejb-jar.xml"/&gt;
-    &lt;/ejbjar&gt;
-</pre>
-
-</body>
-
-</html>
-
-
diff --git a/jakarta-ant-1.2-src/docs/index.html b/jakarta-ant-1.2-src/docs/index.html
deleted file mode 100644
index 9a0b470..0000000
--- a/jakarta-ant-1.2-src/docs/index.html
+++ /dev/null
@@ -1,5494 +0,0 @@
-<html>
-
-<head>
-<meta http-equiv="Content-Language" content="en-us">
-<title>Ant</title>
-</head>
-
-<body>
-
-<h1>Ant User Manual</h1>
-<p>by</p>
-<!-- Names are in alphabetical order, on last name -->
-<ul>
-  <li>Jacques Bergeron (<a href="mailto:jacques.bergeron@dogico.com">jacques.bergeron@dogico.com</a>)</li>
-  <li>Stefan Bodewig (<a href="mailto:stefan.bodewig@epost.de">stefan.bodewig@epost.de</a>)</li>
-  <li>Patrick Chanezon (<a href="mailto:chanezon@netscape.com">chanezon@netscape.com</a>)</li>
-  <li>James Duncan Davison (<a href="mailto:duncan@x180.com">duncan@x180.com</a>)</li>
-  <li>Tom Dimock (<a href="mailto:tad1@cornell.edu">tad1@cornell.edu</a>)</li>
-  <li>Bill Kelly (<a href="mailto:bill.kelly@softwired-inc.com">bill.kelly@softwired-inc.com</a>)</li>
-  <li>Arnout J. Kuiper (<a href="mailto:ajkuiper@wxs.nl">ajkuiper@wxs.nl</a>)</li>
-  <li>Conor MacNeill (<a href="mailto:conor@cortexebusiness.com.au">conor@cortexebusiness.com.au</a>)</li>
-  <li>Stefano Mazzocchi (<a href="mailto:stefano@apache.org">stefano@apache.org</a>)</li>
-  <li>Sam Ruby (<a href="mailto:rubys@us.ibm.com">rubys@us.ibm.com</a>)</li>
-  <li>Nico Seessle (<a href="mailto:nico@seessle.de">nico@seessle.de</a>)</li>
-  <li>Roger Vaughn (<a href="mailto:rvaughn@seaconinc.com">rvaughn@seaconinc.com</a>)</li>
-  <li>Dave Walend (<a href="mailto:dwalend@cs.tufts.edu">dwalend@cs.tufts.edu</a>)</li>
-</ul>
-
-<p>Version 1.2 - 2000/10/24</p>
-
-<hr>
-<h2>Table of Contents</h2>
-<ul>
-  <li><a href="#introduction">Introduction</a></li>
-  <li><a href="#getting">Getting Ant</a></li>
-  <li><a href="#sysrequirements">System Requirements</a></li>
-  <li><a href="#buildingant">Building Ant</a></li>
-  <li><a href="#installing">Installing Ant</a></li>
-  <li><a href="#running">Running Ant</a></li>
-  <li><a href="#buildfile">Writing a simple buildfile</a>
-  <li><a href="#directorybasedtasks">Directory based tasks</a></li>
-  <li><a href="#tasks">Built in Tasks</a>
-  <li><a href="#optionaltasks">Optional Tasks</a>
-  <li><a href="#buildevents">Build Events</a>
-  <li><a href="#writingowntask">Writing your own task</a></li>
-  <li><a href="#faq">FAQ, DTD, external resources</a>
-  <li><a href="../LICENSE">License</a></li>
-  <li><a href="#feedback">Feedback</a></li>
-</ul>
-
-<hr>
-<h2><a name="introduction">Introduction</a></h2>
-<p>Ant is a Java based build tool. In theory it is kind of like make without
-make's wrinkles.</p>
-<h3>Why?</h3>
-<p>Why another build tool when there is already make, gnumake, nmake, jam, and
-others? Because all of those tools have limitations that its original author
-couldn't live with when developing software across multiple platforms. Make like
-tools are inherently shell based. They evaluate a set of dependencies and then
-execute commands not unlike what you would issue on a shell. This means that you
-can easily extend these tools by using or writing any program for the OS that
-you are working on. However, this also means that you limit yourself to the OS,
-or at least the OS type such as Unix, that you are working on.</p>
-<p>Makefiles are inherently evil as well. Anybody who has worked on them for any
-time has run into the dreaded tab problem. &quot;Is my command not executing
-because I have a space in front of my tab!!!&quot; said the original author of
-Ant way too many times. Tools like Jam took care of this to a great degree, but
-still use yet another format to use and remember.</p>
-<p>Ant is different. Instead a model where it is extended with shell based
-commands, it is extended using Java classes. Instead of writing shell commands,
-the configuration files are XML based calling out a target tree where various
-tasks get executed. Each task is run by an object which implements a particular
-Task interface.</p>
-<p>Granted, this removes some of the expressive power that is inherent by being
-able to construct a shell command such as `find . -name foo -exec rm {}` but it
-gives you the ability to be cross platform. To work anywhere and everywhere. And
-hey, if you really need to execute a shell command, Ant has an exec rule that
-allows different commands to be executed based on the OS that it is executing
-on.</p>
-
-<hr>
-<h2><a name="getting">Getting Ant</a></h2>
-<h3>Binary edition</h3>
-<p>The latest stable version of Ant can be downloaded from <a
-href="http://jakarta.apache.org/builds/ant/release/v1.2/bin/">
-http://jakarta.apache.org/builds/ant/release/v1.2/bin/</a>.
-If you like living on the edge, you can download the latest version from <a
-href="http://jakarta.apache.org/builds/ant/nightly/">http://jakarta.apache.org/builds/ant/nightly/</a>.</p>
-<h3>Source edition</h3>
-<p>If you prefer the source edition, you can download Ant from <a
-href="http://jakarta.apache.org/builds/ant/release/v1.2/src/">
-http://jakarta.apache.org/builds/ant/release/v1.2/src/</a>
-(latest stable) or from <a
-href="http://jakarta.apache.org/from-cvs/jakarta-tools/">http://jakarta.apache.org/from-cvs/jakarta-ant/</a>
-(current). See the section <a href="#buildingant">Building Ant</a> on how to
-build Ant from the source code.</p>
-
-<hr>
-<h2><a name="sysrequirements">System Requirements</a></h2>
-<p>
-  To build and use ant you must have a JAXP compliant XML parser installed and available on your classpath.
-  <p>
-  If you do not have a JAXP compliant XML parse installed, you may use the reference implementation 
-  available from Sun. It is available from <a href="http://java.sun.com/xml">http://java.sun.com/xml</a>.
-  Once installed make sure the &quot;jaxp.jar&quot; and &quot;parser.jar&quot; files are in your classpath.
-  <p>
-  You will also need the JDK installed on your system, version 1.1 or later. 
-
-<hr>  
-<h2><a name="buildingant">Building Ant</a></h2>
-<p>Go to the directory <code>jakarta-ant</code>.</p>
-<p>Make sure the JDK is in you path.</p>
-<p>Set the JAVA_HOME environment variable. This should be set to the
-directory where the JDK is installed. See <a href="#installing">Installing Ant</a>
-for examples on how to do this for your operating system.</p>
-<p>Run <code>bootstrap.bat</code> (Windows) or <code>bootstrap.sh</code> (UNIX)
-to build a bootstrap version of Ant.</p>
-<p>When finished, use</p>
-<blockquote>
-  <p><code>build.bat -Dant.dist.dir=&lt;directory to install Ant&gt; dist</code></p>
-</blockquote>
-<p>for Windows, and</p>
-<blockquote>
-  <p><code>build.sh -Dant.dist.dir=&lt;directory to install Ant&gt; dist</code></p>
-</blockquote>
-<p>for UNIX, to create a binary distribution of Ant. This distribution can be
-found in the directory you specified.</p>
-<hr>
-<h2><a name="installing">Installing Ant</a></h2>
-<p>The binary distribution of Ant consists of three directories: <code>bin</code>,
-<code>docs</code> and <code>lib</code>. Only the <code>bin</code> and <code>lib</code>
-directory are crucial for running Ant. To run Ant, the following must be done:</p>
-<ul>
-  <li>Add the <code>bin</code> directory to your path.</li>
-  <li>Set the ANT_HOME environment variable. This should be set to the directory
-    which contains the <code>bin</code> and <code>lib</code> directory.</li>
-  <li>Set the JAVA_HOME environment variable. This should be set to the
-    directory where the JDK is installed.</li>
-</ul>
-<h3>Windows</h3>
-<p>Assume Ant is installed in <code>c:\ant\</code>. The following sets up the
-environment:</p>
-<pre>set ANT_HOME=c:\ant
-set JAVA_HOME=c:\jdk1.2.2
-set PATH=%PATH%;%ANT_HOME%\bin</pre>
-<h3>Unix (bash)</h3>
-<p>Assume Ant is installed in <code>/usr/local/ant</code>. The following sets up
-the environment:</p>
-<pre>export ANT_HOME=/usr/local/ant
-export JAVA_HOME=/usr/local/jdk-1.2.2
-export PATH=${PATH}:${ANT_HOME}/bin</pre>
-<h3>Advanced</h3>
-<p>There are lots of variants that can be used to run Ant. What you need is at
-least the following:</p>
-<p>The classpath for Ant must contain <code>ant.jar</code> and any jars/classes 
-needed for your chosen JAXP compliant XML parser.</p>
-<p>When you need JDK functionality (like a <a href="#javac">javac</a> task, or a
-<a href="#rmic">rmic</a> task), then for JDK 1.1, the <code>classes.zip</code>
-file of the JDK must be added to the classpath; for JDK 1.2 or JDK 1.3, <code>tools.jar</code>
-must be added. The scripts supplied with ant, in the bin directory, will add 
-<code>tools.jar</code> automatically if the JAVA_HOME environment variable is set.</p>
-<p>When you are executing platform specific applications (like the <a
-href="#exec">exec</a> task, or the <a href="#cvs">cvs</a> task), the property <code>ant.home</code>
-must be set to the directory containing a bin directory, which contains the <code>antRun</code> 
-shell script necessary to run execs on Unix.</p>
-<hr>
-<h2><a name="running">Running Ant</a></h2>
-<p>Running Ant is simple, when you installed it as described in the previous
-section. Just type <code>ant</code>.</p>
-<p>When nothing is specified, Ant looks for a <code>build.xml</code>
-file in the current directory. When found, it uses that file as a
-buildfile, otherwise it searches in the parent directory and so on
-until the root of the filesystem has been reached. To make Ant use
-another buildfile, use the commandline option <i>-buildfile
-&lt;file&gt;</i>, where <i>&lt;file&gt;</i> is the buildfile you want
-to use.</p>
-<p>You can also set properties which override properties specified in the
-buildfile (see the <a href="#property">property task</a>). 
-This can be done with the <i>-D&lt;property&gt;=&lt;value&gt;</i>
-option, where <i>&lt;property&gt;</i> is the name of the property and <i>&lt;value&gt;</i>
-the value. This can also be used (and is the only way since Java can not access them) 
-to have access to your environment variables, just pass -DMYVAR=%MYVAR% (Windows) or
--DMYVAR=$MYVAR (Unix) to Ant, you can then access these variables inside your build-file
-as ${MYVAR}.</p>
-<p>Two more options are <i>-quiet</i> which instructs Ant to print less
-information on the console when running. The option <i>-verbose</i> on the other
-hand makes Ant print more information on the console.</p>
-<p>It is also possible to specify one or more targets that should be executed. When omitted the target that is mentioned in the <i>default</i> attribute of the project is
-used.</p>
-<p>The <i>-projecthelp</i> option gives a list of this projects targets. First those with a description and then those without one.</p>
-<p>Commandline option summary:</p>
-<pre>ant [options] [target [target2 [target3] ...]]
-Options:
--help                  print this message
--projecthelp           print project help information
--version               print the version information and exit
--quiet                 be extra quiet
--verbose               be extra verbose
--debug                 print debugging information
--emacs                 produce logging information without adornments
--logfile &lt;file&gt;        use given file for log
--logger &lt;classname&gt;    the class which is to perform logging
--listener &lt;classname&gt;  add an instance of class as a project listener
--buildfile &lt;file&gt;      use given buildfile
--D&lt;property&gt;=&lt;value&gt;   use value for given property</pre>
-<h3>Examples</h3>
-<blockquote>
-  <pre>ant</pre>
-</blockquote>
-<p>runs Ant using the <code>build.xml</code> file in the current directory, on
-the default target.</p>
-<blockquote>
-  <pre>ant -buildfile test.xml</pre>
-</blockquote>
-<p>runs Ant using the <code>test.xml</code> file in the current directory, on
-the default target.</p>
-<blockquote>
-  <pre>ant -buildfile test.xml dist</pre>
-</blockquote>
-<p>runs Ant using the <code>test.xml</code> file in the current directory, on a
-target called <code>dist</code>.</p>
-<blockquote>
-  <pre>ant -buildfile test.xml -Dbuild=build/classes dist</pre>
-</blockquote>
-<p>runs Ant using the <code>test.xml</code> file in the current directory, on a
-target called <code>dist</code>. It also sets the <i>build</i> property to the
-value <i>build/classes</i>.</p>
-<h3>Running Ant by hand</h3>
-<p>When you have installed Ant in the do-it-yourself way, Ant can be started
-with:</p>
-<blockquote>
-  <pre>java -Dant.home=c:\ant org.apache.tools.ant.Main [options] [target]</pre>
-</blockquote>
-
-<p>These instructions actually do exactly the same as the <code>ant</code>
-command. The options and target are the same as when running Ant with the <code>ant</code>
-command. This example assumes you have set up your classpath to include
-<ul>
-<li>ant.jar
-<li>jars/classes for your XML parser
-<li>the JDK's tools.jar
-</ul>
-<hr>
-<h2><a name="buildfile">Writing a simple buildfile</a></h2>
-<p>The buildfile is written in XML. Each buildfile contains one project.</p>
-<p>Each element of the buildfile can have an <code>id</code> attribute and
-can later be referred to by the value supplied to this. The value has
-to be unique.</p>
-<h3>Projects</h3>
-<p>A project has three attributes:</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">name</td>
-    <td valign="top">the name of the target.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">default</td>
-    <td valign="top">the default target to use when no target is supplied.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the base directory from which all path calculations are
-      done. This attribute might be overridden by setting the &quot;basedir&quot;
-      property on forehand. When this is done, it might be omitted in the
-      project tag.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-<p>Each project defines one or more targets. A target is a set of tasks you want
-to be executed. When starting Ant, you can select which target you want to have
-executed. When no target is given, the project's default is used.</p>
-<h3>Targets</h3>
-<p>A target can depend on other targets. You might have a target for compiling,
-for instance, and a target for creating a distributable. You can only build a
-distributable when you have compiled first, so the distribute target depends on
-the compile target. Ant resolves all these dependencies.</p>
-<p>Ant tries to execute the targets in the <i>depends</i> attribute in the order
-they appear (from left to right). Keep in mind that it is possible that a target
-can get executed earlier when an earlier target depends on it:</p>
-<blockquote>
-<pre>&lt;target name=&quot;A&quot;/&gt;
-&lt;target name=&quot;B&quot; depends=&quot;A&quot;/&gt;
-&lt;target name=&quot;C&quot; depends=&quot;B&quot;/&gt;
-&lt;target name=&quot;D&quot; depends=&quot;C,B,A&quot;/&gt;</pre>
-</blockquote>
-<p>Suppose we want to execute target D. From its <i>depends</i> attribute, you
-might think that first target C, then B and then A is executed. Wrong! C depends
-on B, and B depends on A, so first A is executed, then B, then C, and finally D.</p>
-<p>A target gets executed only once. Even when more targets depend on it (see
-the previous example).</p>
-<p>A target has also the ability to perform its execution if (or
-unless) a property has been set. This allows, for example, better
-control on the building process depending on the state of the system
-(java version, OS, command line properties, etc...).  To make target
-<i>sense</i> this property you should add the <i>if</i> (or
-<i>unless</i>) attribute with the name of the property that the target
-should react to, for example</p>
-<blockquote>
-  <pre>&lt;target name=&quot;build-module-A&quot; if=&quot;module-A-present&quot;/&gt;</pre>
-  <pre>&lt;target name=&quot;build-own-fake-module-A&quot; unless=&quot;module-A-present&quot;/&gt;</pre>
-</blockquote>
-<p>If no <i>if</i> and no <i>unless</i> attribute is present, the target will 
-always be executed.</p>
-<p>It is a good practice to place your <a
-href="#tstamp">tstamp</a> tasks in a so called initialization target, on which
-all other targets depend. Make sure that target is always the first one in
-the depends list of the other targets. In this manual, most initialization targets
-have the name &quot;init&quot;.</p>
-<p>The optional <i>description</i> attribute can be used to provide a one line description of this target that is printed by the <i>-projecthelp</i> commandline option.</p>
-<p>A target has the following attributes:</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">name</td>
-    <td valign="top">the name of the target.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">depends</td>
-    <td valign="top">a comma separated list of names of targets on which this
-      target depends.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">if</td>
-    <td valign="top">the name of the property that must be set in order for this
-      target to execute.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">unless</td>
-    <td valign="top">the name of the property that must not be set in order 
-      for this target to execute.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">description</td>
-    <td valign="top">a short description of this targets function.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Tasks</h3>
-<p>A task is a piece of code that can be executed.</p>
-<p>A task can have multiple attributes (or arguments if you prefer). The value
-of an attribute might contain references to a property. These references will be
-resolved before the task is executed.</p>
-<p>Tasks have a common structure:</p>
-<blockquote>
-  <pre>&lt;name attribute1=&quot;value1&quot; attribute2=&quot;value2&quot; ... /&gt;</pre>
-</blockquote>
-<p>where name is the name of the task, attribute-x the attribute name, and
-value-x the value of this attribute.</p>
-<p>There is a set of <a href="#tasks">built in tasks</a>, but it is also very
-easy to <a href="#writingowntask">write your own</a>.</p>
-<p>All tasks share a <code>taskname</code> attribute. The value of
-this attribute will be used in the logging messages generated by
-Ant.</p>
-<h3>Properties</h3>
-<p>A project can have a set of properties. These might be set in the buildfile
-by the <a href="#property">property task</a>, or might be set outside Ant. A
-property has a name and a value. Properties might be used in in the value of
-task attributes. This is done by placing the property name between
-&quot;${&quot; and &quot;}&quot; in the attribute value.</p>
-<p>If there is a property called &quot;builddir&quot; with the value
-&quot;build&quot;, then this could be used in an attribute like this: &quot;${builddir}/classes&quot;.
-This is resolved as &quot;build/classes&quot;.</p>
-<h3>Built in Properties</h3>
-<p>Ant provides access to all system properties as if they had been
-defined using a property task, for example ${os.name} expands to the
-name of the operating system.</p>
-<p>In addition Ant knows some built in properties:</p>
-<ul>
-  <li>basedir - the absolute path of the project's basedir (as set
-    with the basedir attribute of &lt;project&gt;.</li>
-  <li>ant.file - the absolute path of the build file.</li>
-  <li>ant.java.version - the JVM version Ant detected. Currently it
-    can hold the values &quot;1.1&quot;, &quot;1.2&quot; and
-    &quot;1.3&quot;.</li>
-</ul>
-<h3>Example</h3>
-<blockquote>
-  <pre>
-&lt;project name=&quot;MyProject&quot; default=&quot;dist&quot; basedir=&quot;.&quot;&gt;
-
-  &lt;!-- set global properties for this build --&gt;
-  &lt;property name=&quot;src&quot; value=&quot;.&quot; /&gt;
-  &lt;property name=&quot;build&quot; value=&quot;build&quot; /&gt;
-  &lt;property name=&quot;dist&quot;  value=&quot;dist&quot; /&gt;
-
-  &lt;target name=&quot;prepare&quot;&gt;
-    &lt;!-- Create the time stamp --&gt;
-    &lt;tstamp/&gt;
-    &lt;!-- Create the build directory structure used by compile --&gt;
-    &lt;mkdir dir=&quot;${build}&quot; /&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;compile&quot; depends=&quot;prepare&quot;&gt;
-    &lt;!-- Compile the java code from ${src} into ${build} --&gt;
-    &lt;javac srcdir=&quot;${src}&quot; destdir=&quot;${build}&quot; /&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;dist&quot; depends=&quot;compile&quot;&gt;
-    &lt;!-- Create the ${dist}/lib directory --&gt;
-    &lt;mkdir dir=&quot;${dist}/lib&quot; /&gt;
-
-    &lt;!-- Put everything in ${build} into the MyProject-${DSTAMP}.jar file --&gt;
-    &lt;jar jarfile=&quot;${dist}/lib/MyProject-${DSTAMP}.jar&quot; basedir=&quot;${build}&quot; /&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;clean&quot;&gt;
-    &lt;!-- Delete the ${build} and ${dist} directory trees --&gt;
-    &lt;delete dir=&quot;${build}&quot; /&gt;
-    &lt;delete dir=&quot;${dist}&quot; /&gt;
-  &lt;/target&gt;
-&lt;/project&gt;
-  </pre>
-</blockquote>
-
-<h3>Token Filters</h3>
-<p>A project can have a set of tokens that might be automatically expanded if
-found when a file is copied, when the filtering-copy behavior is selected in the
-tasks that support this. These might be set in the buildfile
-by the <a href="#filter">filter task</a>.&nbsp;</p>
-<p>Since this can be a very harmful behavior, the tokens in the files <b>must</b>
-be of the form<i> @token@</i> where <i>token</i> is the token name that is set
-in the filter task. This token syntax matches the syntax of other build systems
-that perform such filtering and remains sufficiently orthogonal to most
-programming and scripting languages, as well with documentation systems.</p>
-<p>Note: in case a token with the format @token@ is found in a file but no
-filter is associated with that token, no changes take place. So, no escaping
-method is present, but as long as you choose appropriate names for your tokens,
-this should not cause problems.</p>
-
-<h3><a name="path">PATH like structures</a></h3>
-<p>You can specify PATH and CLASSPATH variables using both
-&quot;:&quot; and &quot;;&quot; as separator characters, Ant will
-convert it to the correct character of the current operating
-system.</p>
-<p>Wherever PATH like values need to be specified a nested element can
-be used. This takes the general form of</p>
-<pre>
-    &lt;classpath&gt;
-      &lt;pathelement path=&quot;${classpath}&quot; /&gt;
-      &lt;pathelement location=&quot;lib/helper.jar&quot; /&gt;
-    &lt;/classpath&gt;
-</pre>
-<p>The <code>location</code> attribute specifies a single file or
-directory relative to the project's base directory (or an absolute
-filename), while the <code>path</code> attribute accepts &quot;:&quot;
-or &quot;;&quot; separated lists of locations. The <code>path</code>
-attribute is intended to be used with predefined paths - in any other
-case multiple elements with <code>location</code> attributes should be
-preferred.</p>
-<p>As a shortcut the surrounding PATH element supports path and
-location attributes of its own, so</p>
-<pre>
-    &lt;classpath&gt;
-      &lt;pathelement path=&quot;${classpath}&quot; /&gt;
-    &lt;/classpath&gt;
-</pre>
-<p>can be abreviated to</p>
-<pre>
-    &lt;classpath path=&quot;${classpath}&quot; /&gt;
-</pre>
-<p>In addition, <a href="#fileset">FileSet</a>s can be specified via
-nested <code>&lt;fileset&gt;</code> elements. The order in which the files
-building up FileSet are added to the PATH like structure is not
-defined.</p>
-<pre>
-    &lt;classpath&gt;
-      &lt;pathelement path=&quot;${classpath}&quot; /&gt;
-      &lt;fileset dir=&quot;lib&quot;&gt;
-        &lt;include name=&quot;**/*.jar&quot; /&gt;
-      &lt;/fileset;&gt;
-      &lt;pathelement location=&quot;classes&quot; /&gt;
-    &lt;/classpath&gt;
-</pre>
-<p>Builds a PATH which holds the value of <code>${classpath}</code>
-followed by all JAR files in the <code>lib</code> directory, followed
-by the <code>classes</code> directory.</p>
-<p>If you want to use the same PATH like structure for several tasks,
-you can define them with a <code>&lt;path&gt;</code> element at the
-same level as <em>target</em>s and reference them via their
-<em>id</em> attribute - see <a href="#references">References</a> for an
-example.</p>
-<p>A PATH like structure can include a reference to another PATH like
-structure via a nested <code>&lt;path&gt;</code> elements.</p>
-<pre>
-    &lt;path id=&quot;base.path&quot;&gt;
-      &lt;pathelement path=&quot;${classpath}&quot; /&gt;
-      &lt;fileset dir=&quot;lib&quot;&gt;
-        &lt;include name=&quot;**/*.jar&quot; /&gt;
-      &lt;/fileset;&gt;
-      &lt;pathelement location=&quot;classes&quot; /&gt;
-    &lt;/path&gt;
-
-    &lt;path id=&quot;tests.path&quot;&gt;
-      &lt;path refid=&quot;base.path&quot; /&gt;
-      &lt;pathelement location=&quot;testclasses&quot; /&gt;
-    &lt;/path&gt;
-</pre>
-
-<h3><a name="arg">Command line arguments</a></h3>
-
-<p>Several tasks take arguments that shall be passed to another
-process on the command line. To make it easier to specify arguments
-that contain space characters, nested elements can be used.</p>
-<table border="1" cellpadding="2" cellspacing="0">
-<tr>
-  <td width="12%" valign="top"><b>Attribute</b></td>
-  <td width="78%" valign="top"><b>Description</b></td>
-  <td width="10%" valign="top"><b>Required</b></td>
-</tr>
-  <tr>
-    <td valign="top">value</td> 
-    <td valign="top">a single command line argument, can contain space
-      characters.</td>
-    <td align="center" rowspan="4">Exactly one of these.</td>
-  </tr>
-  <tr>
-    <td valign="top">line</td> 
-    <td valign="top">a space delimited list of command line arguments.</td>
-  </tr>
-  <tr>
-    <td valign="top">file</td> 
-    <td valign="top">The name of a file as a single command line
-      argument. Will be replaced with the absolute filename of the file
-      by Ant.</td>
-  </tr>
-  <tr>
-    <td valign="top">path</td> 
-    <td valign="top">A string that shall be treated as a PATH like
-      string as a single command line argument. You can use ; or : as
-      path separators and Ant will convert it to the platform's local
-      conventions.</td>
-  </tr>
-</table>
-<h4>Examples</h4>
-<blockquote><pre>
-  &lt;arg value=&quot;-l -a&quot; /&gt;
-</pre></blockquote>
-<p>is a single command line argument containing a space character.</p>
-<blockquote><pre>
-  &lt;arg line=&quot;-l -a&quot; /&gt;
-</pre></blockquote>
-<p>stands for two separate command line arguments.</p>
-<blockquote><pre>
-  &lt;arg path=&quot;/dir;/dir2:\dir3&quot; /&gt;
-</pre></blockquote>
-<p>is a single command line argument with value
-<code>\dir;\dir2;\dir3</code> on DOS based systems and
-<code>/dir:/dir2:/dir3</code> on Unix like systems.</p>
-<h3><a name="references">References</a></h3>
-<p>The <code>id</code> attribute of the buildfile's elements can be
-used to refer to them. This can useful if you are going to replicate
-the same snippet of XML over and over again - using a
-<code>&lt;classpath&gt;</code> structure more than once for
-example.</p>
-<p>The following example</p>
-<blockquote><pre>
-&lt;project ... &gt;
-  &lt;target ... &gt;
-    &lt;rmic ...&gt;
-      &lt;classpath&gt;
-        &lt;pathelement location=&quot;lib/&quot; /&gt;
-        &lt;pathelement path=&quot;${java.class.path}/&quot; /&gt;
-        &lt;pathelement path=&quot;${additional.path}&quot; /&gt;
-      &lt;/classpath&gt;
-    &lt;/rmic&gt;
-  &lt;/target&gt;
-
-  &lt;target ... &gt;
-    &lt;javac ...&gt;
-      &lt;classpath&gt;
-        &lt;pathelement location=&quot;lib/&quot; /&gt;
-        &lt;pathelement path=&quot;${java.class.path}/&quot; /&gt;
-        &lt;pathelement path=&quot;${additional.path}&quot; /&gt;
-      &lt;/classpath&gt;
-    &lt;/javac&gt;
-  &lt;/target&gt;
-&lt;/project&gt;
-</pre></blockquote>
-<p>could be rewritten as</p>
-<blockquote><pre>
-&lt;project ... &gt;
-  &lt;path id=&quot;project.class.path&quot;&gt;
-    &lt;pathelement location=&quot;lib/&quot; /&gt;
-    &lt;pathelement path=&quot;${java.class.path}/&quot; /&gt;
-    &lt;pathelement path=&quot;${additional.path}&quot; /&gt;
-  &lt;/path&gt;
-
-  &lt;target ... &gt;
-    &lt;rmic ...&gt;
-      &lt;classpath refid=&quot;project.class.path&quot; /&gt;
-    &lt;/rmic&gt;
-  &lt;/target&gt;
-
-  &lt;target ... &gt;
-    &lt;javac ...&gt;
-      &lt;classpath refid=&quot;project.class.path&quot; /&gt;
-    &lt;/javac&gt;
-  &lt;/target&gt;
-&lt;/project&gt;
-</pre></blockquote>
-<p>All tasks that use nested elements for <a
-href="#patternset">PatternSet</a>s, <a href="#fileset">FileSet</a>s or
-<a href="#path">PATH like structures</a> accept references to these
-structures as well.</p>
-<hr>
-<h2><a name="directorybasedtasks">Directory based tasks</a></h2>
-<p>Some tasks use directory trees for the task they perform. For instance, the <a
-href="#javac">Javac task</a> which works upon a directory tree with .java files.
-Sometimes it can be very useful to work on a subset of that directory tree. This
-section describes how you can select a subset of such a directory tree.</p>
-<p>Ant gives you two ways to create a subset, both of which can be used at the same
-time:</p>
-<ul>
-  <li>Only include files/directories that match at least one pattern of a set of
-    patterns</li>
-  <li>Exclude files/directories that match at least one pattern a set of
-    patterns</li>
-</ul>
-<p>When both inclusion and exclusion are used, only files/directories that match
-the include patterns, and don't match the exclude patterns are used.</p>
-<p>Patterns can be specified inside the buildfile via task attributes or
-nested elements and via external files. Each line of the external file
-is taken as pattern that is added to the list of include or exclude 
-patterns.</p>
-<h3>Patterns</h3>
-<p>As described earlier, patterns are used for the inclusion and exclusion.
-These patterns look very much like the patterns used in DOS and UNIX:</p>
-<p>'*' matches zero or more characters, '?' matches one character.</p>
-<p>Examples:</p>
-<p>'*.java' matches '.java', 'x.java' and 'FooBar.java', but not 'FooBar.xml'
-(does not end with '.java').</p>
-<p>'?.java' matches 'x.java', 'A.java', but not '.java' or 'xyz.java' (both
-don't have one character before '.java').</p>
-<p>Combinations of '*'s and '?'s are allowed.</p>
-<p>Matching is done per-directory. This means that first the first directory in
-the pattern is matched against the first directory in the path to match. Then
-the second directories are matched, and so on. E.g. when we have the pattern '/?abc/*/*.java'
-and the path '/xabc/foobar/test.java', then first '?abc' is matched with 'xabc',
-then '*' is matched with 'foobar' and finally '*.java' is matched with 'test.java'.
-They all match so the path matches the pattern.</p>
-<p>Too make things a bit more flexible, we add one extra feature, which makes it
-possible to match multiple directory levels. This can be used to match a
-complete directory tree, or a file anywhere in the directory tree. To do this, '**'
-must be used as the name of a directory. When '**' is used as the name of a
-directory in the pattern, it matches zero or more directories. For instance:
-'/test/**' matches all files/directories under '/test/', such as '/test/x.java',
-or '/test/foo/bar/xyz.html', but not '/xyz.xml'.</p>
-<p>There is one &quot;shorthand&quot;, if a pattern ends with '/' or '\', then '**'
-is appended. E.g. &quot;mypackage/test/&quot; is interpreted as were it &quot;mypackage/test/**&quot;.</p>
-<p>Examples:</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top">**/CVS/*</td>
-    <td valign="top">Matches all files in CVS directories, that can be located
-      anywhere in the directory tree.
-      <p>Matches:</p>
-      <p>CVS/Repository<br>
-      org/apache/CVS/Entries<br>
-      org/apache/jakarta/tools/ant/CVS/Entries</p>
-      <p>But not:</p>
-      <p>org/apache/CVS/foo/bar/Entries ('foo/bar/' part does not match)</td>
-  </tr>
-  <tr>
-    <td valign="top">org/apache/jakarta/**</td>
-    <td valign="top">Matches all files in the org/apache/jakarta directory tree.
-      <p>Matches:</p>
-      <p>org/apache/jakarta/tools/ant/docs/index.html<br>
-      org/apache/jakarta/test.xml</p>
-      <p>But not:</p>
-      <p>org/apache/xyz.java ('jakarta'/' part is missing)</td>
-  </tr>
-  <tr>
-    <td valign="top">org/apache/**/CVS/*</td>
-    <td valign="top">Matches all files in CVS directories, that are located
-      anywhere in the directory tree under org/apache.
-      <p>Matches:</p>
-      <p>org/apache/CVS/Entries<br>
-      org/apache/jakarta/tools/ant/CVS/Entries</p>
-      <p>But not:</p>
-      <p>org/apache/CVS/foo/bar/Entries ('foo/bar/' part does not match)</td>
-  </tr>
-  <tr>
-    <td valign="top">**/test/**</td>
-    <td valign="top">Matches all files which have a directory 'test' in their
-      path, including 'test' as a filename.</td>
-  </tr>
-</table>
-<p>When these patterns are used in inclusion and exclusion, you have a powerful
-way to select just the files you want.</p>
-<h3>Examples</h3>
-<pre>  
-&lt;copy todir=&quot;${dist}&quot; >
-  &lt;fileset dir=&quot;${src}&quot; 
-           includes=&quot;**/images/*&quot; 
-           excludes=&quot;**/*.gif&quot; 
-  /&gt;
-&lt;/copy&gt;</pre>
-<p>This copies all files in directories called &quot;images&quot;, that are
-located in the directory tree &quot;${src}&quot; to the destination &quot;${dist}&quot;,
-but excludes all &quot;*.gif&quot; files from the copy.</p>
-<p> This example can also be expressed using nested elements as
-<pre>
-&lt;copy todir=&quot;${dist}&quot; >
-  &lt;fileset dir=&quot;${src}&quot; /&gt;
-    &lt;include name=&quot;**/images/*&quot;/&gt;
-    &lt;exclude name=&quot;**/*.gif&quot; /&gt;
-  &lt;/fileset&gt;
-&lt;/copy&gt;
-</pre>
-
-<h3>Default Excludes</h3>
-<p>There are a set of definitions which are excluded by default from all directory based tasks.
-They are:
-<pre>        &quot;**/*~&quot;,
-        &quot;**/#*#&quot;,
-        &quot;**/%*%&quot;,
-        &quot;**/CVS&quot;,
-        &quot;**/CVS/*&quot;,
-        &quot;**/.cvsignore&quot;
-</pre>
-If you do not want these default excludes applied, you may disable them with the 
-<code>defaultexcludes=&quot;no&quot;</code> attribute.</p>
-<h3><a name="patternset">PatternSets</a></h3>
-<p>Patterns can be grouped to sets and later be referenced by their id
-attribute. They are defined via a <code>patternset</code> element -
-which can appear nested into a <a href="#fileset">FileSet</a> or a
-directory based task that constitutes an implicit FileSet. In addition
-<code>patternset</code>s can be defined at the same level as
-<code>target</code> - i.e. as children of <code>project</code></p>
-<p>Patterns can be specified by nested <code>&lt;include&gt;</code> or
-<code>&lt;exclude&gt;</code> elements or the following attributes.</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-  </tr>
-</table>
-<h4>Examples</h4>
-<blockquote><pre>
-&lt;patternset id=&quot;non.test.sources&quot; &gt;
-  &lt;include name=&quot;**/*.java&quot; /&gt;
-  &lt;exclude name=&quot;**/*Test*&quot; /&gt;
-&lt;/patternset&gt;
-</pre></blockquote>
-<p>Builds a set of patterns, that matches all <code>.java</code> files
-that do not contain the text <code>Test</code> in their name. This set
-can be <a href="#references">referred</a> to via
-<code>&lt;patternset refid=&quot;non.test.sources&quot;
-/&gt;</code> by tasks that support this feature or by FileSets.</p>
-<h3><a name="fileset">FileSets</a></h3>
-<p>FileSets are groups of files. These files can be found in a
-directory tree starting in a base directory and are matched by
-patterns taken from a number of <a
-href="#patternset">PatternSets</a>. FileSets can appear inside task
-that support this feature or at the same level as <code>target</code>
-- i.e. as children of <code>project</code>.</p>
-<p>PatternSets can be specified as nested
-<code>&lt;patternset&gt;</code> 
-elements. In addition FileSet holds an implicit PatternSet and
-supports the nested <code>&lt;include&gt;</code> and
-<code>&lt;exclude&gt;</code> elements of PatternSet directly as well
-as PatternSet's attributes.</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">The root of the directory tree of this FileSet.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h4>Examples</h4>
-<blockquote><pre>
-&lt;fileset dir=&quot;${server.src}&quot; &gt;
-  &lt;patternset id=&quot;non.test.sources&quot; &gt;
-    &lt;include name=&quot;**/*.java&quot; /&gt;
-    &lt;exclude name=&quot;**/*Test*&quot; /&gt;
-  &lt;/patternset&gt;
-&lt;/fileset&gt;
-</pre></blockquote>
-<p>Groups all files in directory <code>${server.src}</code> that are Java
-source files and don't have the text <code>Test</code> in their
-name.</p>
-<blockquote><pre>
-&lt;fileset dir=&quot;${client.src}&quot; &gt;
-  &lt;patternset refid=&quot;non.test.sources&quot; /&gt;
-&lt;/fileset&gt;
-</pre></blockquote>
-<p>Groups all files in directory <code>${client.src}</code> using the
-same patterns as the example before.</p>
-<hr>
-<h2><a name="tasks">Built in tasks</a></h2>
-<ul>
-  <li><a href="#ant">Ant</a></li>
-  <li><a href="#antcall">AntCall</a></li>
-  <li><a href="#antstructure">AntStructure</a></li>
-  <li><a href="#available">Available</a></li>
-  <li><a href="#chmod">Chmod</a></li>
-  <li><a href="#copy">Copy</a></li>
-  <li><a href="#copydir">Copydir</a></li>
-  <li><a href="#copyfile">Copyfile</a></li>
-  <li><a href="#cvs">Cvs</a></li>
-  <li><a href="#delete">Delete</a></li>
-  <li><a href="#deltree">Deltree</a></li>
-  <li><a href="#echo">Echo</a></li>
-  <li><a href="#exec">Exec</a></li>
-  <li><a href="#execon">ExecOn</a></li>
-  <li><a href="#fail">Fail</a></li>
-  <li><a href="#filter">Filter</a></li>
-  <li><a href="#fixcrlf">FixCRLF</a></li>
-  <li><a href="#genkey">GenKey</a></li>
-  <li><a href="#get">Get</a></li>
-  <li><a href="#gunzip">GUnzip</a></li>
-  <li><a href="#gzip">GZip</a></li>
-  <li><a href="#jar">Jar</a></li>
-  <li><a href="#java">Java</a></li>
-  <li><a href="#javac">Javac</a></li>
-  <li><a href="#javadoc">Javadoc/Javadoc2</a></li>
-  <li><a href="#mail">Mail</a></li>
-  <li><a href="#mkdir">Mkdir</a></li>
-  <li><a href="#move">Move</a></li>
-  <li><a href="#patch">Patch</a></li>
-  <li><a href="#property">Property</a></li>
-  <li><a href="#rename">Rename</a></li>
-  <li><a href="#replace">Replace</a></li>
-  <li><a href="#rmic">Rmic</a></li>
-  <li><a href="#signjar">SignJar</a></li>
-  <li><a href="sql.html">Sql</a></li>
-  <li><a href="#style">Style</a></li>
-  <li><a href="#tar">Tar</a></li>
-  <li><a href="#taskdef">Taskdef</a></li>
-  <li><a href="#touch">Touch</a></li>
-  <li><a href="#tstamp">Tstamp</a></li>
-  <li><a href="#unzip">Unjar</a></li>
-  <li><a href="#untar">Untar</a></li>
-  <li><a href="#unzip">Unwar</a></li>
-  <li><a href="#unzip">Unzip</a></li>
-  <li><a href="#uptodate">Uptodate</a></li>
-  <li><a href="#war">War</a></li>
-  <li><a href="#zip">Zip</a></li>
-</ul>
-<hr>
-<h2><a name="ant">Ant</a></h2>
-<h3>Description</h3>
-<p>Runs Ant on a supplied buildfile. This can be used to build subprojects.</p>
-<p>When the <i>antfile</i> attribute is omitted, the file &quot;build.xml&quot;
-in the supplied directory (<i>dir</i> attribute) is used.</p>
-<p>If no target attribute is supplied, the default target of the new project is
-used.</p>
-<p>The properties of the current project will be available in the new project.
-These properties will override the properties that are set in the new project.
-(See also the <a href="#property">properties task</a>). You can set properties
-in the new project from the old project by using nested property tags. This
-allows you to parameterize your subprojects.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">antfile</td>
-    <td valign="top">the buildfile to use. Defaults to &quot;build.xml&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
- 	<td valign="top">the directory to use as a basedir for the new Ant project. 
-					 Defaults to the current directory.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">target</td>
-    <td valign="top">the target of the new Ant project that should be executed.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">output</td>
-    <td valign="top">Filename to write the ant output to.
-    </td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>
-  &lt;ant antfile=&quot;subproject/subbuild.xml&quot; dir=&quot;subproject&quot; target=&quot;compile&quot; /&gt;
-
-  &lt;ant dir=&quot;subproject&quot; /&gt;
-
-  &lt;ant antfile=&quot;subproject/property_based_subbuild.xml&quot;&gt;
-    &lt;property name=&quot;param1&quot; value=&quot;version 1.x&quot; /&gt;
-    &lt;property file=&quot;config/subproject/default.properties&quot; /&gt;
-  &lt;/ant&gt;
-</pre>
-<hr>
-<h2><a name="antcall">AntCall</a></h2>
-<h3>Description</h3>
-<p>Call another target within the same build-file optionally specifying some
-properties (param's in this context)</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">target</td>
-    <td valign="top">The target to execute.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>param</h4>
-<p>Specifies the properties to set before running the specified target. See <a
-href="#property">property</a> for usage guidelines.</p>
-<h3>Examples</h3>
-<pre>
-  &lt;target name=&quot;default&quot;&gt;
-    &lt;antcall target=&quot;doSomethingElse&quot;&gt;
-      &lt;param name=&quot;param1&quot; value=&quot;value&quot;/&gt;
-    &lt;/antcall&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;doSomethingElse&quot;&gt;
-    &lt;echo message=&quot;param1=${param1}&quot;/&gt;
-  &lt;/target&gt;
-</pre>
-<p>Will run the target 'doSomethingElse' and echo 'param1=value'.</p>
-<hr>
-<h2><a name="antstructure">AntStructure</a></h2>
-<h3>Description</h3> 
-<p>Generates a DTD for Ant build files which contains information
-about all tasks currently known to Ant.</p> 
-<p>Note that the DTD generated by this task is incomplete, you can
-always add XML entities using <a
-href="#taskdef"><code>&lt;taskdef&gt;</code></a>. See <a
-href="http://www.sdv.fr/pages/casa/html/ant-dtd.en.html">here</a> for
-a way to get around this problem.</p>
-<p>This task doesn't know about required attributes, all will be
-listed as <code>#IMPLIED</code>.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">output</td>
-    <td valign="top">file to write the DTD to.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote><pre>
-&lt;antstructure output=&quot;project.dtd&quot; /&gt;
-</pre></blockquote>
-<hr>
-<h2><a name="available">Available</a></h2>
-<h3>Description</h3>
-<p>Sets a property if a resource is available at runtime. This resource can be a
-file resource, a class in classpath or a JVM system resource.</p>
-<p>If the resource is present, the property value is set to true by
-default, otherwise the property is not set. You can set the value to
-something specific by using the value attribute.</p>
-<p>Normally, this task is used to set properties that are useful to avoid target
-execution depending on system parameters.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">property</td>
-    <td valign="top">the name of the property to set.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">value</td>
-    <td valign="top">the value to set the property to. Defaults to &quot;true&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classname</td>
-    <td valign="top">the class to look for in classpath.</td>
-    <td valign="middle" align="center" rowspan="3">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">resource</td>
-    <td valign="top">the resource to look for in the JVM</td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the file to look for.</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td> <td valign="top">the classpath to
-      use when looking up <code>classname</code>.</td> <td
-    align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>classpath</h4>
-<p><code>Available</code>'s <em>classpath</em> attribute is a <a
-href="#path">PATH like structure</a> and can also be set via a nested
-<em>classpath</em> element.</p>
-<h3>Examples</h3>
-<pre>  &lt;available classname=&quot;org.whatever.Myclass&quot; property=&quot;Myclass.present&quot; /&gt;</pre>
-<p>sets the property <code><i>Myclass.present</i></code> to the value &quot;true&quot;
-if the <i>org.whatever.Myclass</i> is found in Ant's classpath.</p>
-<hr>
-<h2><a name="chmod">Chmod</a></h2>
-<h3>Description</h3>
-<p>Changes the permissions of a file or all files inside specified directories. Right now it has effect only under Unix.
-The permissions are also UNIX style, like the argument for the chmod command.</p>
-<p>See the section on <a href="#directorybasedtasks">directory based
-tasks</a>, on how the inclusion/exclusion of files works, and how to
-write patterns.</p>
-<p>This task holds an implicit <a href="#fileset">FileSet</a> and
-supports all of FileSet's attributes and nested elements
-directly. More FileSets can be specified using nested
-<code>&lt;fileset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the file or single directory of which the permissions 
-      must be changed.</td>
-    <td valign="top" valign="middle" rowspan="2">exactly one of the two or nested <code>&lt;fileset&gt;</code> elements.</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">the directory which holds the files whose permissions 
-      must be changed.</td>
-  </tr>
-  <tr>
-    <td valign="top">perm</td>
-    <td valign="top">the new permissions.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">parallel</td>
-    <td valign="top">process all specified files using a single
-      <code>chmod</code> command. Defaults to true.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">type</td>
-    <td valign="top">One of <em>file</em>, <em>dir</em> or
-      <em>both</em>. If set to <em>file</em>, only the permissions of
-      plain files are going to be changed. If set to <em>dir</em>, only
-      the directories are considered.</td>
-    <td align="center" valign="top">No, default is <em>file</em></td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;chmod file=&quot;${dist}/start.sh&quot; perm=&quot;ugo+rx&quot;
-  /&gt;</code></p>
-</blockquote>
-<p>makes the &quot;start.sh&quot; file readable and executable for anyone on a
-UNIX system.</p>
-<blockquote>
-<pre>
-    &lt;chmod dir=&quot;${dist}/bin&quot; perm=&quot;ugo+rx&quot; includes=&quot;**/*.sh&quot; /&gt;
-</pre>
-</blockquote>
-<p>makes all &quot;.sh&quot; files below <code>${dist}/bin</code>
-readable and executable for anyone on a UNIX system.</p>
-<blockquote>
-<pre>
-&lt;chmod perm=&quot;g+w&quot; /&gt;
-  &lt;fileset dir=&quot;shared/sources1&quot; &gt;
-    &lt;exclude name=&quot;**/trial/**&quot; /&gt;
-  &lt;/fileset&gt;
-  &lt;fileset refid=&quot;other.shared.sources&quot; /&gt;
-&lt;/chmod&gt;
-</pre>
-</blockquote>
-<p>makes all files below <code>shared/sources1</code> (except those
-below any directory named trial) writable for members of the same
-group on a UNIX system. In addition all files belonging to a FileSet
-with <code>id</code> <code>other.shared.sources</code> get the same
-permissions.</p>
-<hr>
-<h2><a name="copy">Copy</a></h2>
-<h3>Description</h3>
-<p>Copies a file or Fileset to a new file or directory.  Files are
-only copied if the source file is newer than the destination file,
-or when the destination file does not exist.  However, you can explicitly 
-overwrite files with the <var>overwrite</var> attribute.</p>
-<p><a href="#fileset">FileSet</a>s are used to select files to copy.  
-To use a fileset, the <var>todir</var> attribute must be set.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">The file to copy.</td>
-    <td valign="top" align="center">One of either <var>file</var> or 
-    at least one nested fileset element.</td>
-  </tr>
-  <tr>
-    <td valign="top">tofile</td>
-    <td valign="top">The file to copy to.</td>
-    <td valign="top" align="center" rowspan="2">With the <var>file</var> attribute, 
-    either <var>tofile</var> or <var>todir</var> can be used.  With nested filesets, 
-    only <var>todir</var> is allowed.</td>
-  </tr>
-  <tr>
-    <td valign="top">todir</td>
-    <td valign="top">The directory to copy to.</td>
-  </tr>
-  <tr>
-    <td valign="top">overwrite</td>
-    <td valign="top">Overwrite existing files even if the destination
-      files are newer. Defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">filtering</td>
-    <td valign="top">Indicates whether token filtering should take place during
-      the copy. Defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">flatten</td>
-    <td valign="top">Ignore directory structure of source directory,
-      copy all files into a single directory, specified by the <var>todir</var>
-      attribute. Defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includeEmptyDirs</td>
-	 <td valign="top">Copy empty directories included with the nested FileSet(s).
-	   Defaults to &quot;yes&quot;.</td>
-	 <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<p><b>Copy a single file</b></p>
-<pre>
-  &lt;copy file=&quot;myfile.txt&quot; tofile=&quot;mycopy.txt&quot; /&gt;
-</pre>
-<p><b>Copy a file to a directory</b></p>
-<pre>
-  &lt;copy file=&quot;myfile.txt&quot; todir=&quot;../some/dir/tree&quot; /&gt;
-</pre>
-<p><b>Copy a directory to another directory</b></p>
-<pre>
-  &lt;copy todir=&quot;../new/dir&quot;&gt;
-    &lt;fileset dir=&quot;src_dir&quot;/&gt;
-  &lt;/copy&gt;
-</pre>
-<p><b>Copy a set of files to a directory</b></p>
-<pre>
-  &lt;copy todir=&quot;../dest/dir&quot; &gt;
-    &lt;fileset dir=&quot;src_dir&quot &gt;
-      &lt;exclude name=&quot;**/*.java&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/copy&gt;
-
-  &lt;copy todir=&quot;../dest/dir&quot; &gt;
-    &lt;fileset dir=&quot;src_dir&quot excludes=&quot;**/*.java&quot; /&gt;
-  &lt;/copy&gt;
-</pre>
-<hr>
-<h2><a name="copydir">Copydir</a></h2>
-<h3><i>Deprecated</i></h3>
-<p><i>This task has been deprecated.  Use the Copy task instead.</i></p>
-<h3>Description</h3>
-<p>Copies a directory tree from the source to the destination.</p>
-<p>It is possible to refine the set of files that are being copied. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>src</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">the directory to copy.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">the directory to copy to.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">filtering</td>
-    <td valign="top">indicates whether token filtering should take place during
-      the copy</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">flatten</td>
-    <td valign="top">ignore directory structure of source directory,
-      copy all files into a single directory - specified by the dest
-      attribute (default is false).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">forceoverwrite</td>
-    <td valign="top">overwrite existing files even if the destination
-      files are newer (default is false).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;copydir src=&quot;${src}/resources&quot;
-           dest=&quot;${dist}&quot;
-  /&gt;</pre>
-<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>.</p>
-<pre>  &lt;copydir src=&quot;${src}/resources&quot;
-           dest=&quot;${dist}&quot;
-           includes=&quot;**/*.java&quot;
-           excludes=&quot;**/Test.java&quot;
-  /&gt;</pre>
-<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>
-recursively. All java files are copied, except for files with the name <code>Test.java</code>.</p>
-<pre>  &lt;copydir src=&quot;${src}/resources&quot;
-           dest=&quot;${dist}&quot;
-           includes=&quot;**/*.java&quot;
-           excludes=&quot;mypackage/test/**&quot; /&gt;</pre>
-<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>
-recursively. All java files are copied, except for the files under the <code>mypackage/test</code>
-directory.</p>
-<hr>
-<h2><a name="copyfile">Copyfile</a></h2>
-<h3><i>Deprecated</i></h3>
-<p><i>This task has been deprecated.  Use the Copy task instead.</i></p>
-<h3>Description</h3>
-<p>Copies a file from the source to the destination. The file is only copied if
-the source file is newer than the destination file, or when the destination file
-does not exist.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">the filename of the file to copy.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">the filename of the file where to copy to.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">filtering</td>
-    <td valign="top">indicates whether token filtering should take place during
-      the copy</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">forceoverwrite</td>
-    <td valign="top">overwrite existing files even if the destination
-      files are newer (default is false).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;copyfile src=&quot;test.java&quot; dest=&quot;subdir/test.java&quot;
-  /&gt;</code></p>
-  <p><code>&lt;copyfile src=&quot;${src}/index.html&quot; dest=&quot;${dist}/help/index.html&quot;
-  /&gt;</code></p>
-</blockquote>
-<hr>
-<h2><a name="cvs">Cvs</a></h2>
-<h3>Description</h3>
-<p>Handles packages/modules retrieved from a 
-<a href="http://www.cyclic.com/">CVS</a> repository.</p>
-<p>When doing automated builds, the <a href="#get">get task</a> should be
-preferred over the <i>checkout</i> command, because of speed.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">command</td>
-    <td valign="top">the CVS command to execute.</td>
-    <td align="center" valign="top">No, default &quot;checkout&quot;</td>
-  </tr>
-  <tr>
-    <td valign="top">cvsRoot</td>
-    <td valign="top">the CVSROOT variable.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">the directory where the checked out files should be placed.</td>
-    <td align="center" valign="top">No, default is project's basedir.</td>
-  </tr>
-  <tr>
-    <td valign="top">package</td>
-    <td valign="top">the package/module to check out.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">tag</td>
-    <td valign="top">the tag of the package/module to check out.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">date</td>
-    <td valign="top">Use the most recent revision no later than the given date</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">quiet</td>
-    <td valign="top">suppress informational messages.</td>
-    <td align="center" valign="top">No, default &quot;false&quot;</td>
-  </tr>
-  <tr>
-    <td valign="top">noexec</td>
-    <td valign="top">report only, don't change any files.</td>
-    <td align="center" valign="top">No, default &quot;false&quot;</td>
-  </tr>
-  <tr>
-    <td valign="top">output</td>
-    <td valign="top">the file to direct standard output from the command.</td>
-    <td align="center" valign="top">No, default output to ANT Log as MSG_INFO.</td>
-  </tr>
-  <tr>
-    <td valign="top">error</td>
-    <td valign="top">the file to direct standard error from the command.</td>
-    <td align="center" valign="top">No, default error to ANT Log as MSG_WARN.</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;cvs cvsRoot=&quot;:pserver:anoncvs@jakarta.apache.org:/home/cvspublic&quot;
-       package=&quot;jakarta-tools&quot;
-       dest=&quot;${ws.dir}&quot;
-  /&gt;</pre>
-<p>checks out the package/module &quot;jakarta-tools&quot; from the CVS
-repository pointed to by the cvsRoot attribute, and stores the files in &quot;${ws.dir}&quot;.</p>
-<pre>  &lt;cvs dest=&quot;${ws.dir}&quot; command=&quot;update&quot; /&gt;</pre>
-<p>updates the package/module that has previously been checked out into
-&quot;${ws.dir}&quot;.</p>
-<hr>
-<h2><a name="delete">Delete</a></h2>
-<h3>Description</h3>
-<p>Deletes either a single file, all files in a specified directory and its 
-sub-directories, or a set of files specified by one or more <a href="#fileset">FileSet</a>s.
-When specifying a set of files, empty directories are <em>not</em> removed.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">The file to delete.</td>
-    <td align="center" valign="middle" rowspan="2">at least one of the two</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">The directory to delete files from.</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">Show name of each deleted file (&quot;true&quot;/&quot;false&quot;).
-	 Default is &quot;false&quot; when omitted.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top"><i>Deprecated.</i>  Comma separated list of patterns of files that must be
-      deleted. All files are in the current directory 
-      and any sub-directories are deleted when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top"><i>Deprecated.</i>  The name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top"><i>Deprecated.</i>  Comma separated list of patterns of files that must be
-      excluded from the deletion list. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top"><i>Deprecated.</i>  The name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top"><i>Deprecated.</i>  Indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;delete file=&quot;/lib/ant.jar&quot; /&gt;</pre>
-<p>deletes the file <code>/lib/ant.jar</code>.</p>
-<pre>  &lt;delete dir=&quot;lib&quot; /&gt;</pre>
-<p>deletes all files in the <code>/lib</code> directory.</p>
-<pre>  &lt;delete&gt;
-    &lt;fileset dir=&quot;.&quot; includes=&quot;**/*.bak&quot; /&gt;
-  &lt;/delete&gt;
-</pre>
-<p>deletes all files with the extension &quot;<code>.bak</code>&quot from the current directory 
-and any sub-directories.</p>
-<hr>
-<h2><a name="deltree">Deltree</a></h2>
-<h3><i>Deprecated</i></h3>
-<p><i>This task has been deprecated.  Use the Delete task instead.</i></p>
-<h3>Description</h3>
-<p>Deletes a directory with all its files and subdirectories.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">the directory to delete.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;deltree dir=&quot;dist&quot; /&gt;</pre>
-<p>deletes the directory <code>dist</code>, including its files and
-subdirectories.</p>
-<pre>  &lt;deltree dir=&quot;${dist}&quot; /&gt;</pre>
-<p>deletes the directory <code>${dist}</code>, including its files and
-subdirectories.</p>
-<hr>
-<h2><a name="echo">Echo</a></h2>
-<h3>Description</h3>
-<p>Echoes a message to System.out or a file.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">message</td>
-    <td valign="top">the message to echo.</td>
-    <td valign="top" align="center">Yes, unless data is included in a
-      character section within this element.</td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the file to write the message to.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">append</td>
-    <td valign="top">Append to an existing file?</td>
-    <td valign="top" align="center">No - default is false.</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;echo message=&quot;Hello world&quot; /&gt;</pre>
-<pre>  
-&lt;echo&gt;
-This is a longer message stretching over
-two lines.
-&lt;/echo&gt;
-</pre>
-<hr>
-<h2><a name="exec">Exec</a></h2>
-<h3>Description</h3>
-<p>Executes a system command. When the <i>os</i> attribute is specified, then
-the command is only executed when Ant is run on one of the specified operating
-systems.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">command</td>
-    <td valign="top">the command to execute with all command line
-      arguments. <b>deprecated, use executable and nested
-      <code>&lt;arg&gt;</code> elements instead</b>.</td>
-    <td align="center" rowspan="2">Exactly one of the two.</td>
-  </tr>
-  <tr>
-    <td valign="top">executable</td>
-    <td valign="top">the command to execute without any command line
-      arguments.</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">the directory in which the command should be executed.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">os</td>
-    <td valign="top">list of Operating Systems on which the command may be
-      executed.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">output</td>
-    <td valign="top">the file to which the output of the command should be
-      redirected.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">timeout</td>
-    <td valign="top">Stop the command if it doesn't finish within the
-      specified time (given in milliseconds).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">failonerror</td>
-    <td valign="top">Stop the buildprocess if the command exits with a
-      returncode other than 0.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;exec dir=&quot;${src}&quot; executable=&quot;dir&quot; os=&quot;windows&quot;
-  output=&quot;dir.txt&quot; /&gt;</code></p>
-</blockquote>
-<h3>Parameters specified as nested elements</h3>
-<h4>arg</h4>
-<p>Command line arguments should be specified as nested
-<code>&lt;arg&gt;</code> elements. See <a
-href="index.html#arg">Command line arguments</a>.</p>
-<h4><a name="env">env</a></h4>
-<p>It is possible to specify environment variables to pass to the
-system command via nested <code>&lt;env&gt;</code> elements.</p>
-<p>Please note that the environment of the current Ant process is
-<b>not</b> passed to the system command if you specify variables using
-<code>&lt;env&gt;</code>.</p>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">key</td>
-    <td valign="top">The name of the environment variable.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">value</td>
-    <td valign="top">The literal value for the environment variable.</td>
-    <td align="center" rowspan="3">Exactly one of these.</td>
-  </tr>
-  <tr>
-    <td valign="top">path</td>
-    <td valign="top">The value for a PATH like environment
-      variable. You can use ; or : as path separators and Ant will
-      convert it to the platform's local conventions.</td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">The value for the environment variable. Will be
-      replaced by the absolute filename of the file by Ant.</td>
-  </tr>
-</table>
-<h5>Examples</h5>
-<blockquote><pre>
-&lt;exec executable=&quot;emacs&quot; &gt;
-  &lt;env key=&quot;DISPLAY&quot; value=&quot;:1.0&quot; /&gt;
-&lt;/exec&gt;
-</pre></blockquote>
-<p>starts <code>emacs</code> on display 1 of the X Window System.</p>
-<blockquote><pre>
-&lt;exec ... &gt;
-  &lt;env key=&quot;PATH&quot; path=&quot;${java.library.path}:${basedir}/bin&quot; /&gt;
-&lt;/exec&gt;
-</pre></blockquote>
-<p>adds <code>${basedir}/bin</code> to the <code>PATH</code> of the
-system command.</p>
-<p><b>Note:</b> Although it may work for you to specify arguments using 
-a simple arg-element and seperate them by spaces it may fail if you switch to
-a newer version of the JDK. JDK &lt; 1.2 will pass these as separate arguments
-to the program you are calling, JDK &gt;= 1.2 will pass them as a single 
-argument and cause most calls to fail.</p>
-<p><b>Note2:</b> If you are using Ant on Windows and a new DOS-Window pops up
-for every command which is excuted this may be a problem of the JDK you are using.
-This problem may occur with all JDK's &lt; 1.2.</p>
-<hr>
-<h2><a name="execon">ExecOn</a></h2>
-<h3>Description</h3>
-<p>Executes a system command. When the <i>os</i> attribute is specified, then
-the command is only executed when Ant is run on one of the specified operating
-systems.</p>
-<p>The files and/or directories of a number of <a
-href="#fileset">FileSet</a>s are passed as arguments to the system
-command. At least one nested <code>&lt;fileset&gt;</code> is required.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">executable</td>
-    <td valign="top">the command to execute without any command line
-      arguments.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">the directory in which the command should be executed.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">os</td>
-    <td valign="top">list of Operating Systems on which the command may be
-      executed.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">output</td>
-    <td valign="top">the file to which the output of the command should be
-      redirected.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">timeout</td>
-    <td valign="top">Stop the command if it doesn't finish within the
-      specified time (given in milliseconds).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">failonerror</td>
-    <td valign="top">Stop the buildprocess if the command exits with a
-      returncode other than 0.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">parallel</td>
-    <td valign="top">Run the command only once, appending all files as
-      arguments. Defaults to true. If false, command will be executed
-      once for every file.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">type</td>
-    <td valign="top">One of <em>file</em>, <em>dir</em> or
-      <em>both</em>. If set to <em>file</em>, only the names of plain
-      files will be sent to the command. If set to <em>dir</em>, only
-      the names of directories are considered.</td>
-    <td align="center" valign="top">No, default is <em>file</em></td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>fileset</h4>
-<p>You can use any number of nested <code>&lt;fileset&gt;</code>
-elements to define the files for this task and refer to
-<code>&lt;fileset&gt;</code>s defined elsewhere.</p>
-<h4>arg</h4>
-<p>Command line arguments should be specified as nested
-<code>&lt;arg&gt;</code> elements. See <a
-href="index.html#arg">Command line arguments</a>.</p>
-<h4>env</h4>
-<p>It is possible to specify environment variables to pass to the
-system command via nested <code>&lt;env&gt;</code> elements. See the
-description in the section about <a href="#env">exec</a></p>
-<p>Please note that the environment of the current Ant process is
-<b>not</b> passed to the system command if you specify variables using
-<code>&lt;env&gt;</code>.</p>
-<h3>Examples</h3>
-<blockquote><pre>
-&lt;execon executable=&quot;ls&quot; &gt;
-  &lt;arg value=&quot;-l&quot; /&gt;
-  &lt;fileset dir=&quot;/tmp&quot;&gt;
-    &lt;patternset&gt;
-      &lt;exclude name=&quot;**/*.txt&quot; /&gt;
-    &lt;/patternset&gt;
-  &lt;/fileset&gt;
-  &lt;fileset refid=&quot;other.files&quot; /&gt;
-&lt;/execon&gt;
-</pre></blockquote>
-<p>invokes <code>ls -l</code>, adding the absolute filenames of all
-files below <code>/tmp</code> not ending in <code>.txt</code> and all
-files of the FileSet with <code>id</code> <code>other.files</code> to
-the command line.</p>
-<hr>
-<h2><a name="fail">Fail</a></h2>
-<h3>Description</h3>
-<p>Exits the current build (just throwing a BuildException), optionally printing additional information.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">message</td>
-    <td valign="top">A message giving further information on why the build exited</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;fail/&gt;</pre>
-<p>will exit the current build with no further information given.
-<pre>
-BUILD FAILED
-
-build.xml:4: No message
-</pre>
-</p>
-<pre>  &lt;fail message=&quot;Something wrong here.&quot;/&gt;</pre>
-<p>will exit the current build and print something like the following to whereever
-your output goes:
-<pre>
-BUILD FAILED
-
-build.xml:4: Something wrong here.
-</pre>
-</p>
-<hr>
-<h2><a name="filter">Filter</a></h2>
-<h3>Description</h3>
-<p>Sets a token filter for this project or read multiple token filter from
-an input file and sets these as filters.
-Token filters are used by all tasks that perform file copying operations
-through the Project commodity methods.</p>
-<p>Note 1: the token string must not contain the separators chars (@).<br>
-Note 2: Either token and value attributes must be provided, or only the
-filterfile attribute.</p>
-
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">token</td>
-    <td valign="top">the token string without @</td>
-    <td align="center" valign="top">Yes*</td>
-  </tr>
-  <tr>
-    <td valign="top">value</td>
-    <td valign="top">the string that should be put to replace the token when the 
-      file is copied</td>
-    <td align="center" valign="top">Yes*</td>
-  </tr>
-  <tr>
-    <td valign="top">filtersfile</td>
-    <td valign="top">The file from which the filters must be read. This file must be a formatted as a property file. </td>
-    <td align="center" valign="top">Yes*</td>
-  </tr>
-</table>
-<p>* see notes 1 and 2 above parameters table.</p>
-<h3>Examples</h3>
-<pre>  &lt;filter token=&quot;year&quot; value=&quot;2000&quot; /&gt;
-  &lt;copy todir=&quot;${dest.dir}&quot;&gt;
-    &lt;fileset dir=&quot;${src.dir}&quot; /&gt;
-  &lt;/copy&gt;</pre> 
-<p>will copy recursively all the files from the <i>src.dir</i> directory into
-the <i>dest.dir</i> directory replacing all the occurencies of the string <i>@year@</i>
-with <i>2000.</i></p>
-<pre>  &lt;filter filterfile=&quot;deploy_env.properties&quot; /&gt;</pre>
-will read all property entries from the <i>deploy_env.properties</i> file
-and set these as filters.
-
-<hr>
-<h2><a name="fixcrlf">FixCRLF</a></h2>
-<h3>Description</h3>
-<p>Adjusts a text file to local.</p>
-<p>It is possible to refine the set of files that are being adjusted. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">srcDir</td>
-    <td valign="top">Where to find the files to be fixed up.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">destDir</td>
-    <td valign="top">Where to place the corrected files.  Defaults to
-      srcDir (replacing the original file)</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">cr</td>
-    <td valign="top">Specifies how carriage return (CR) characters are to
-      be handled.  Valid values for this property are:
-      <ul>
-      <li>add: ensure that there is a CR before every LF
-      <li>asis: leave CR characters alone
-      <li>remove: remove all CR characters
-      </ul>
-      Default is based on the platform on which you are running this task.
-      For Unix platforms, the default is remove.  For DOS based systems
-      (including Windows), the default is add.
-      <p>
-      Note: Unless this property is specified as &quot;asis&quot;, extra CR characters
-      which do not precede a LF will be removed.
-      </td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">tab</td>
-    <td valign="top">Specifies how tab characters are to be handled.  Valid
-      values for this property are:
-      <ul>
-      <li>add: convert sequences of spaces which span a tab stop to tabs
-      <li>asis: leave tab and space characters alone
-      <li>remove: convert tabs to spaces
-      </ul>
-      Default for this parameter is &quot;asis&quot;.
-      <p>
-      Note: Unless this property is specified as &quot;asis&quot;, extra spaces and
-      tabs after the last non-whitespace character on the line will be removed.
-      </td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">tablength</td>
-    <td valign="top">The number of characters a TAB stop corresponds to. 
-      Must be a positive power of 2, default for this parameter is 8.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">eof</td>
-    <td valign="top">Specifies how DOS end of file (control-Z) characters are
-      to be handled.  Valid values for this property are:
-      <ul>
-      <li>add: ensure that there is an EOF character at the end of the file
-      <li>asis: leave EOF characters alone
-      <li>remove: remove any EOF character found at the end
-      </ul>
-      Default is based on the platform on which you are running this task.
-      For Unix platforms, the default is remove.  For DOS based systems
-      (including Windows), the default is asis.
-      </td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
-       cr=&quot;remove&quot; eof=&quot;remove&quot;
-       includes=&quot;**/*.sh&quot;
-  /&gt;</pre>
-<p>Removes carriage return and eof characters from the shell scripts.  Tabs and
-spaces are left as is.
-<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
-       cr=&quot;add&quot;
-       includes=&quot;**/*.bat&quot;
-  /&gt;</pre>
-<p>Ensures that there are carriage return characters prior to evey line feed.
-Tabs and spaces are left as is.
-EOF characters are left alone if run on
-DOS systems, and are removed if run on Unix systems.</p>
-<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
-       tabs=&quot;add&quot;
-       includes=&quot;**/Makefile&quot;
-  /&gt;</pre>
-<p>Adds or removes CR characters to match local OS conventions, and
-converts spaces to tabs when appropriate.  EOF characters are left alone if
-run on DOS systems, and are removed if run on Unix systems.
-Many versions of make require tabs prior to commands.</p>
-<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
-       tabs=&quot;remove&quot;
-       includes=&quot;**/README*&quot;
-  /&gt;</pre>
-<p>Adds or removes CR characters to match local OS conventions, and
-converts all tabs to spaces.  EOF characters are left alone if run on
-DOS systems, and are removed if run on Unix systems.
-You never know what editor a user will use to browse README's.</p>
-<hr>
-<h2><a name="genkey">GenKey</a></h2>
-<h3>Description</h3>
-<p>Generates a key in keystore.</p>
-
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">alias</td>
-    <td valign="top">the alias to add under</td>
-    <td valign="top" align="center">Yes.</td>
-  </tr>
-  <tr>
-    <td valign="top">storepass</td>
-    <td valign="top">password for keystore integrity.</td>
-    <td valign="top" align="center">Yes.</td>
-  </tr>
-  <tr>
-    <td valign="top">keystore</td>
-    <td valign="top">keystore location</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">storetype</td>
-    <td valign="top">keystore type</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keypass</td>
-    <td valign="top">password for private key (if different)</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sigalg</td>
-    <td valign="top">the algorithm to use in signing</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keyalg</td>
-    <td valign="top">the method to use when generating name-value pair</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">(true | false) verbose output when signing</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">dname</td>
-    <td valign="top">The distinguished name for entity</td>
-    <td valign="top" align="center">Yes if dname element unspecified</td>
-  </tr>
-  <tr>
-    <td valign="top">validity</td>
-    <td valign="top">(integer) indicates how many days certificate is valid</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keysize</td>
-    <td valign="top">(integer) indicates the size of key generated</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-
-<p>Alternatively you can specify the distinguished name by creating a sub-element named dname and populating it with param elements that have a name and a value. When using the subelement it is automatically encoded properly and , are replace
-<p>The following two examples are identical: </p>
-
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;genkey alias=&quot;apache-group&quot; storepass=&quot;secret&quot; 
-  dname=&quot;CN=Ant Group, OU=Jakarta Division, O=Apache.org, C=US&quot; /&gt;</code></p>
-</blockquote>
-
-<blockquote>
-  <pre><code>&lt;genkey alias=&quot;apache-group&quot; storepass=&quot;secret&quot; &gt;
-  &lt;dname&gt;
-    &lt;param name=&quot;CN&quot; value=&quot;Ant Group&quot;/&gt;
-    &lt;param name=&quot;OU&quot; value=&quot;Jakarta Division&quot;/&gt;
-    &lt;param name=&quot;O&quot;  value=&quot;Apache.Org&quot;/&gt;
-    &lt;param name=&quot;C&quot;  value=&quot;US&quot;/&gt;
-  &lt;/dname&gt;
-&lt;/genkey&gt;</code></pre>
-</blockquote>
-<hr>
-<h2><a name="get">Get</a></h2>
-<h3>Description</h3>
-<p>Gets a file from a URL. When the verbose option is &quot;on&quot;, this task
-displays a '.' for every 100 Kb retrieved.</p>
-<p>This task should be preferred above the <a href="#cvs">CVS task</a> when
-doing automated builds. CVS is significantly slower than loading a compressed
-archive with http/ftp.</p>
-
-The <i>usetimestamps</i> option enables you to control downloads so that the remote file is
-only fetched if newer than the local copy. If there is no local copy, the download always takes 
-place. When a file is downloaded, the timestamp of the downloaded file is set to the remote timestamp,
-if  the JVM is Java1.2 or later. 
-NB: This timestamp facility only works on downloads using the HTTP protocol. 
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">the URL from which to retrieve a file.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">the file where to store the retrieved file.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">show verbose progress information (&quot;on&quot;/&quot;off&quot;).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">ignoreerrors</td>
-    <td valign="top">Log errors but don't treat as fatal.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">usetimestamps</td>
-    <td valign="top">conditionally download a file based on the timestamp of the local copy.
-	HTTP only</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;get src=&quot;http://jakarta.apache.org/&quot; dest=&quot;help/index.html&quot; /&gt;</pre>
-<p>Gets the index page of http://jakarta.apache.org/, and stores it in the file <code>help/index.html</code>.</p>
-
-<pre>  &lt;get src=&quot;http://jakarta.apache.org/builds/tomcat/nightly/ant.zip&quot; 
-	dest=&quot;optional.jar&quot; 
-	verbose=&quot;true&quot;
-	usetimestamps=&quot;true&quot;/&gt;</pre>
-<p>
-Gets the nightly ant build from the tomcat distribution, if the local copy
-is missing or out of date. Uses the verbose option 
-for progress information.
-</p>
-
-<hr>
-<h2><a name="gunzip">GUnzip</a></h2>
-<h3>Description</h3>
-<p>Expands a GZip file.</p>
-
-<p>If <i>dest</i> is a directory the name of the destination file is
-the same as <i>src</i> (with the &quot;.gz&quot; extension removed if
-present). If <i>dest</i> is omitted, the parent dir of <i>src</i> is
-taken. The file is only expanded if the source file is newer than the
-destination file, or when the destination file does not exist.</p>
-
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">the file to expand.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">the destination file or directory.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot;/&gt;</code></p>
-</blockquote>
-<p>expands <i>test.tar.gz</i> to <i>test.tar</i></p>
-<blockquote>
-  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot; dest=&quot;test2.tar&quot;/&gt;</code></p>
-</blockquote>
-<p>expands <i>test.tar.gz</i> to <i>test2.tar</i></p>
-<blockquote>
-  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot; dest=&quot;subdir&quot;/&gt;</code></p>
-</blockquote>
-<p>expands <i>test.tar.gz</i> to <i>subdir/test.tar</i> (assuming
-subdir is a directory).</p>
-
-<hr>
-<h2><a name="gzip">GZip</a></h2>
-<h3>Description</h3>
-<p>GZips a file.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">the file to gzip.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">zipfile</td>
-    <td valign="top">the destination file.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;gzip src=&quot;test.tar&quot; zipfile=&quot;test.tar.gz&quot;
-  /&gt;</code></p>
-</blockquote>
-<hr>
-<h2><a name="jar">Jar</a></h2>
-<h3>Description</h3>
-<p>Jars a set of files.</p>
-<p>The <i>basedir</i> attribute is the reference directory from where to jar.</p>
-<p>Note that file permissions will not be stored in the resulting jarfile.</p>
-<p>It is possible to refine the set of files that are being jarred. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>basedir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<p>You can also use nested file sets for more flexibility, and specify
-multiple ones to merge together different trees of files into one JAR.
-See the <a href="#zip">Zip</a> task for more details and examples.</p>
-<p>If the manifest is omitted, a simple one will be supplied by Ant.
-You should not include <samp>META-INF/MANIFEST.MF</samp> in your set of files.
-<p>The <code>whenempty</code> parameter controls what happens when no files match.
-If <code>create</code> (the default), the JAR is created anyway with only a manifest.
-If <code>skip</code>, the JAR is not created and a warning is issued.
-If <code>fail</code>, the JAR is not created and the build is halted with an error.
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">jarfile</td>
-    <td valign="top">the jar-file to create.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the directory from which to jar the files.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compress</td>
-    <td valign="top">Not only store data but also compress them, defaults to true</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">manifest</td>
-    <td valign="top">the manifest file to use.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">whenempty</td>
-    <td valign="top">Behavior to use if no files match.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot; basedir=&quot;${build}/classes&quot; /&gt;</pre>
-<p>jars all files in the <code>${build}/classes</code> directory in a file
-called <code>app.jar</code> in the <code>${dist}/lib</code> directory.</p>
-<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;
-       basedir=&quot;${build}/classes&quot;
-       excludes=&quot;**/Test.class&quot;
-  /&gt;</pre>
-<p>jars all files in the <code>${build}/classes</code> directory in a file
-called <code>app.jar</code> in the <code>${dist}/lib</code> directory. Files
-with the name <code>Test.class</code> are excluded.</p>
-<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;
-       basedir=&quot;${build}/classes&quot;
-       includes=&quot;mypackage/test/**&quot;
-       excludes=&quot;**/Test.class&quot;
-  /&gt;</pre>
-<p>jars all files in the <code>${build}/classes</code> directory in a file
-called <code>app.jar</code> in the <code>${dist}/lib</code> directory. Only
-files under the directory <code>mypackage/test</code> are used, and files with
-the name <code>Test.class</code> are excluded.</p>
-<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;&gt;
-    &lt;fileset dir=&quot;${build}/classes&quot;
-             excludes=&quot;**/Test.class&quot;
-    /&gt;
-    &lt;fileset dir=&quot;${src}/resources&quot;/&gt;
-  &lt;/jar&gt;</pre>
-<p>jars all files in the <code>${build}/classes</code> directory and also
-in the <code>${src}/resources</code> directory together in a file
-called <code>app.jar</code> in the <code>${dist}/lib</code> directory.
-Files with the name <code>Test.class</code> are excluded.
-If there are files such as <code>${build}/classes/mypackage/MyClass.class</code>
-and <code>${src}/resources/mypackage/image.gif</code>, they will appear
-in the same directory in the JAR (and thus be considered in the same package
-by Java).</p>
-
-<hr>
-<h2><a name="java">Java</a></h2>
-<h3>Description</h3>
-<p>Executes a Java class within the running (Ant) VM or forks another VM if
-specified.</p>
-<p>Be careful that the executed class doesn't call System.exit(), because it
-will terminate the VM and thus Ant. In case this happens, it's highly suggested
-that you set the fork attribute so that System.exit() stops the other VM and not
-the one that is currently running Ant.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">classname</td>
-    <td valign="top">the Java class to execute.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">args</td>
-    <td valign="top">the arguments for the class that is
-      executed. <b>deprecated, use nested <code>&lt;arg&gt;</code>
-      elements instead.</b></td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">the classpath to use.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpathref</td>
-    <td valign="top">the classpath to use, given as <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">fork</td>
-    <td valign="top">if enabled triggers the class execution in another VM
-      (disabled by default)</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">jvm</td>
-    <td valign="top">the command used to invoke the Java Virtual Machine,
-      default is 'java'.  The command is resolved by java.lang.Runtime.exec().
-      Ignored if fork is disabled.
-    </td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">jvmargs</td>
-    <td valign="top">the arguments to pass to the forked VM (ignored
-      if fork is disabled). <b>deprecated, use nested
-      <code>&lt;jvmarg&gt;</code> elements instead.</b></td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">maxmemory</td>
-    <td valign="top">Max amount of memory to allocate to the forked VM
-      (ignored if fork is disabled)</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">failonerror</td>
-    <td valign="top">Stop the buildprocess if the command exits with a
-      returncode other than 0. Only available if fork is true.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">The directory to invoke the VM in.  (ignored if
-      fork is disabled)</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>arg and jvmarg</h4>
-<p>Use nested <code>&lt;arg&gt;</code> and <code>&lt;jvmarg&gt;</code>
-elements to specify arguments for the or the forked VM. See <a
-href="index.html#arg">Command line arguments</a>.</p>
-<h4>sysproperty</h4>
-<p>Use nested <code>&lt;sysproperty&gt;</code>
-elements to specify system properties required by the class. 
-These properties will be made available to the VM during the execution
-of the class (either ANT's VM or the forked VM). The attributes
-for this element are the same as for <a href="index.html#env">environment
-variables</a>.</p>
-<h4>classpath</h4>
-<p><code>Java</code>'s <em>classpath</em> attribute is a <a
-href="#path">PATH like structure</a> and can also be set via a nested
-<em>classpath</em> element.</p>
-<h5>Example</h5>
-<pre>  
-       &lt;java classname=&quot;test.Main&quot; &gt;
-         &lt;arg value=&quot;-h&quot; /&gt; 
-         &lt;classpath&gt;
-           &lt;pathelement location=&quot;\test.jar&quot; /&gt;
-           &lt;pathelement path=&quot;${java.class.path}&quot; /&gt;
-         &lt;/classpath&gt;
-       &lt;/java&gt;
-</pre>
-<h3>Examples</h3>
-<pre>  &lt;java classname=&quot;test.Main&quot; /&gt;</pre>
-<pre>  &lt;java classname=&quot;test.Main&quot;
-        fork=&quot;yes&quot; &gt;
-    &lt;sysproperty key=&quot;DEBUG&quot; value=&quot;true&quot; /&gt; 
-    &lt;arg value=&quot;-h&quot; /&gt; 
-    &lt;jvmarg value=&quot;-Xrunhprof:cpu=samples,file=log.txt,depth=3&quot; /&gt; 
-  &lt;/java&gt;
-</pre>
-
-<hr>
-<h2><a name="javac">Javac</a></h2>
-<h3>Description</h3>
-<p>Compiles a source tree within the running (Ant) VM.</p>
-<p>The source and destination directory will be recursively scanned for Java
-source files to compile. Only Java files that have no corresponding class file
-or where the class file is older than the java file will be compiled.</p>
-<p>The directory structure of the source tree should follow the package
-hierarchy.</p>
-<p>It is possible to refine the set of files that are being compiled/copied.
-This can be done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>It is possible to use different compilers. This can be selected with the
-&quot;build.compiler&quot; property. There are three choices:</p>
-<ul>
-  <li>classic (the standard compiler of JDK 1.1/1.2)</li>
-  <li>modern (the new compiler of JDK 1.3)</li>
-  <li>jikes (the <a
-    href="http://oss.software.ibm.com/developerworks/opensource/jikes/project">Jikes</a>
-    compiler)</li>
-  <li>jvc (the Command-Line Compiler from Microsoft's SDK for Java /
-    Visual J++)</li>
-</ul>
-<p>For JDK 1.1/1.2 is classic the default. For JDK 1.3 is modern the default.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">srcdir</td>
-    <td valign="top">location of the java files.</td>
-    <td align="center" valign="top">Yes, unless nested <code>&lt;src&gt;</code> elements are present.</td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">location where to store the class files.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">the classpath to use.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">bootclasspath</td>
-    <td valign="top">location of bootstrap class files.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpathref</td>
-    <td valign="top">the classpath to use, given as <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">bootclasspathref</td>
-    <td valign="top">location of bootstrap class files, given as by <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">extdirs</td>
-    <td valign="top">location of installed extensions.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">encoding</td>
-    <td valign="top">encoding of source files.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">debug</td>
-    <td valign="top">indicates whether there should be compiled with debug
-      information (&quot;off&quot;).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">optimize</td>
-    <td valign="top">indicates whether there should be compiled with
-      optimization (&quot;off&quot;).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">deprecation</td>
-    <td valign="top">indicates whether there should be compiled with deprecation
-      information (&quot;off&quot;).</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">target</td>
-    <td valign="top">Generate class files for specific VM version, e.g.
-	 &quot;1.1&quot; or &quot;1.2&quot;.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">asks the compiler for verbose output.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">depend</td> <td valign="top">enables dependency
-      tracking for compilers that support this (jikes and classic)</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-
-<h3>Parameters specified as nested elements</h3>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h4>src, classpath, bootclasspath and extdirs</h4>
-<p><code>Javac</code>'s <em>srcdir</em>, <em>classpath</em>,
-<em>bootclasspath</em> and <em>extdirs</em> attributes are <a
-href="#path">PATH like structure</a> and can also be set via nested
-<em>src</em>, <em>classpath</em>, <em>bootclasspath</em> and
-<em>extdirs</em> elements respectively.</p>
-
-<h3>Examples</h3>
-<pre>  &lt;javac srcdir=&quot;${src}&quot;
-         destdir=&quot;${build}&quot;
-         classpath=&quot;xyz.jar&quot;
-         debug=&quot;on&quot;
-  /&gt;</pre>
-<p>compiles all .java files under the directory <code>${src}</code>, and stores
-the .class files in the directory <code>${build}</code>. 
-The classpath used contains <code>xyz.jar</code>, and debug information is on.</p>
-<pre>  &lt;javac srcdir=&quot;${src}&quot;
-         destdir=&quot;${build}&quot;
-         includes=&quot;mypackage/p1/**,mypackage/p2/**&quot;
-         excludes=&quot;mypackage/p1/testpackage/**&quot;
-         classpath=&quot;xyz.jar&quot;
-         debug=&quot;on&quot;
-  /&gt;</pre>
-<p>compiles .java files under the directory <code>${src}</code>, and stores the
-.class files in the directory <code>${build}</code>. 
-The classpath used contains <code>xyz.jar</code>, and debug information is on.
-Only files under <code>mypackage/p1</code> and <code>mypackage/p2</code> are
-used. Files in the <code>mypackage/p1/testpackage</code> directory are excluded
-form compilation and copy.</p>
-
-<pre>  &lt;javac srcdir=&quot;${src}:${src2}&quot;
-         destdir=&quot;${build}&quot;
-         includes=&quot;mypackage/p1/**,mypackage/p2/**&quot;
-         excludes=&quot;mypackage/p1/testpackage/**&quot;
-         classpath=&quot;xyz.jar&quot;
-         debug=&quot;on&quot;
-  /&gt;</pre>
-
-<p>is the same as the previous example with the addition of a second source path, defined by
-the propery <code>src2</code>. This can also be represented using nested elements as follows
-
-<pre>  &lt;javac destdir=&quot;${build}&quot;
-         classpath=&quot;xyz.jar&quot;
-         debug=&quot;on&quot;&gt;
-    &lt;src path=&quot;${src}&quot; /&gt;
-    &lt;src path=&quot;${src2}&quot; /&gt;
-    &lt;include name=&quot;mypackage/p1/**,mypackage/p2/**&quot; /&gt;
-    &lt;exclude name=&quot;mypackage/p1/testpackage/**&quot; /&gt;
-  &lt;/javac&gt;</pre>
-
-<p><b>Note:</b> If you are using Ant on Windows and a new DOS-Window pops up
-for every use of an external compiler this may be a problem of the JDK you are using.
-This problem may occur with all JDK's &lt; 1.2.</p>
-
-<hr>
-<h2><a name="javadoc">Javadoc/Javadoc2</a></h2>
-<h3>Description</h3>
-<p>Generates code documentation using the javadoc tool.</p>
-<p>The source directory will be recursively scanned for Java source files to process
-but only those matching the inclusion rules will be passed to the javadoc tool. This
-allows wildcards to be used to choose between package names, reducing verbosity
-and management costs over time. This task, however, has no notion of
-&quot;changed&quot; files, unlike the <a href="#javac">javac</a> task. This means
-all packages will be processed each time this task is run. In general, however,
-this task is used much less frequently.</p>
-<p>This task works seamlessly between different javadoc versions (1.1 and 1.2),
-with the obvious restriction that the 1.2 attributes will be ignored if run in a
-1.1 VM.</p>
-<p>NOTE: since javadoc calls System.exit(), javadoc cannot be run inside the
-same VM as ant without breaking functionality. For this reason, this task 
-always forks the VM. This overhead is not significant since javadoc is normally a heavy
-application and will be called infrequently.</p>
-<p>NOTE: the packagelist attribute allows you to specify the list of packages to 
-document outside of the Ant file. It's a much better practice to include everything 
-inside the build.xml file. This option was added in order to make it easier to 
-migrate from regular makefiles, where you would use this option of javadoc. 
-The packages listed in packagelist are not checked, so the task performs even 
-if some packages are missing or broken. Use this option if you wish to convert from 
-an existing makefile. Once things are running you should then switch to the regular 
-notation. 
-
-<p>DEPRECATION: the javadoc2 task simply points to the javadoc task and it's
-there for back compatibility reasons. Since this task will be removed in future
-versions, you are strongly encouraged to use <a href="#javadoc">javadoc</a>
-instead.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Availability</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">sourcepath</td>
-    <td valign="top">Specify where to find source files</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" rowspan="2">At least one of the two or nested
-      <code>&lt;sourcepath&gt;</code></td>
-  </tr>
-  <tr>
-    <td valign="top">sourcepathref</td>
-    <td valign="top">Specify where to find source files by <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">all</td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">Destination directory for output files</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">maxmemory</td>
-    <td valign="top">Max amount of memory to allocate to the javadoc VM</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sourcefiles</td>
-    <td valign="top">Space separated list of source files</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="middle" rowspan="2">at least one of the two</td>
-  </tr>
-  <tr>
-    <td valign="top">packagenames</td>
-    <td valign="top">Comma separated list of package files (with terminating
-      wildcard)</td>
-    <td align="center" valign="top">all</td>
-  </tr>
-  <tr>
-    <td valign="top">packageList</td>
-    <td valign="top">The name of a file containing the packages to process</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">Specify where to find user class files</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Bootclasspath</td>
-    <td valign="top">Override location of class files loaded by the bootstrap
-      class loader</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpathref</td>
-    <td valign="top">Specify where to find user class files by <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">bootclasspathref</td>
-    <td valign="top">Override location of class files loaded by the
-      bootstrap class loader by <a href="#references">reference</a> to a
-      PATH defined elsewhere.</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Extdirs</td>
-    <td valign="top">Override location of installed extensions</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Overview</td>
-    <td valign="top">Read overview documentation from HTML file</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Public</td>
-    <td valign="top">Show only public classes and members</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Protected</td>
-    <td valign="top">Show protected/public classes and members (default)</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Package</td>
-    <td valign="top">Show package/protected/public classes and members</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Private</td>
-    <td valign="top">Show all classes and members</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Old</td>
-    <td valign="top">Generate output using JDK 1.1 emulating doclet</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Verbose</td>
-    <td valign="top">Output messages about what Javadoc is doing</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Locale</td>
-    <td valign="top">Locale to be used, e.g. en_US or en_US_WIN</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Encoding</td>
-    <td valign="top">Source file encoding name</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Version</td>
-    <td valign="top">Include @version paragraphs</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Use</td>
-    <td valign="top">Create class and package usage pages</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Author</td>
-    <td valign="top">Include @author paragraphs</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Splitindex</td>
-    <td valign="top">Split index into one file per letter</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Windowtitle</td>
-    <td valign="top">Browser window title for the documentation (text)</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Doctitle</td>
-    <td valign="top">Include title for the package index(first) page (html-code)</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Header</td>
-    <td valign="top">Include header text for each page (html-code)</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">Footer</td>
-    <td valign="top">Include footer text for each page (html-code)</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">bottom</td>
-    <td valign="top">Include bottom text for each page (html-code)</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">link</td>
-    <td valign="top">Create links to javadoc output at the given URL</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">linkoffline</td>
-    <td valign="top">Link to docs at &lt;url&gt; using package list at
-      &lt;url2&gt;</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">group</td>
-    <td valign="top">Group specified packages together in overview page</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">nodeprecated</td>
-    <td valign="top">Do not include @deprecated information</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">nodeprecatedlist</td>
-    <td valign="top">Do not generate deprecated list</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">notree</td>
-    <td valign="top">Do not generate class hierarchy</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">noindex</td>
-    <td valign="top">Do not generate index</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">nohelp</td>
-    <td valign="top">Do not generate help link</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">nonavbar</td>
-    <td valign="top">Do not generate navigation bar</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">serialwarn</td>
-    <td valign="top">FUTURE: Generate warning about @serial tag</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">helpfile</td>
-    <td valign="top">FUTURE: Specifies the HTML help file to use</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">stylesheetfile</td>
-    <td valign="top">Specifies the CSS stylesheet to use</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">charset</td>
-    <td valign="top">FUTURE: Charset for cross-platform viewing of generated
-      documentation</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">docencoding</td>
-    <td valign="top">Output file encoding name</td>
-    <td align="center" valign="top">1.1</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">doclet</td>
-    <td valign="top">Specifies the class file that starts the doclet used in generating the documentation.</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">docletpath</td>
-    <td valign="top">Specifies the path to the doclet class file that is specified with the -doclet option.</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">docletpathref</td>
-    <td valign="top">Specifies the path to the doclet class file that
-      is specified with the -doclet option by <a
-      href="#references">reference</a> to a PATH defined elsewhere.</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">additionalparam</td>
-    <td valign="top">Lets you add additional parameters to the javadoc command line. Useful for doclets</td>
-    <td align="center" valign="top">1.2</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">failonerror</td>
-    <td valign="top">Stop the buildprocess if the command exits with a
-      returncode other than 0.</td>
-    <td align="center" valign="top">all</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-
-<h3>Parameters specified as nested elements</h3>
-<h4>link</h4>
-<p>Create link to javadoc output at the given URL. This performs the
-same role as the link and linkoffline attributes. You can use either
-syntax (or both at once), but with the nested elements you can easily
-specify multiple occurrences of the arguments.</p>
-<h4>Parameters</h4>
-
-<table width="60%" border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">href</td>
-    <td valign="top">The URL for the external documentation you wish to link to</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">offline</td>
-    <td valign="top">True if this link is not available online at the time of 
-                     generating the documentation</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">packagelistLoc</td>
-    <td valign="top">The location to the directory containing the package-list file for
-                     the external documentation</td>
-    <td align="center" valign="top">Only if the offline attribute is true</td>
-  </tr>
-</table>
-  
-<h4>groups</h4> 
-<p>Separates packages on the overview page into whatever groups you
-specify, one group per table. This performs the same role as the group
-attribute. You can use either syntax (or both at once), but with the
-nested elements you can easily specify multiple occurrences of the
-arguments.</p>
-
-<table width="60%" border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">title</td>
-    <td valign="top">Title of the group</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">packages</td>
-    <td valign="top">List of packages to include in that group</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-
-<h4>doclet</h4>
-<p>The doclet nested element is used to specify the doclet that javadoc will 
-use to process the input source files. A number of the standard javadoc arguments
-are actually arguments of the standard doclet. If these are specified in the javadoc
-task's attributes, they will be passed to the doclet specified in the 
-<code>&lt;doclet&gt;</code> nested element. Such attributes should only be specified, 
-therefore, if they can be interpreted by the doclet in use.
-
-<p>If the doclet requires additional parameters, these can be specified with
-<code>&lt;param&gt;</code> elements within the <code>&lt;doclet&gt;</code> 
-element. These paramaters are restricted to simple strings. An example usage
-of the doclet element is shown below:
-
-<pre>  &lt;javadoc ...&gt;
-     &lt;doclet name="theDoclet"
-             path="path/to/theDoclet"&gt;
-        &lt;param name="-foo" value="foovalue"/&gt;
-        &lt;param name="-bar" value="barvalue"/&gt;
-     &lt;/doclet&gt;
-  &lt;/javadoc&gt;
-</pre>
-
-<h4>sourcepath, classpath and bootclasspath</h4>
-<p><code>Javadoc</code>'s <em>sourcepath</em>, <em>classpath</em> and
-<em>bootclasspath</em> attributes are <a href="#path">PATH like
-structure</a> and can also be set via nested <em>sourcepath</em>,
-<em>classpath</em> and <em>bootclasspath</em> elements
-respectively.</p>
-
-<h3>Example</h3>
-<pre>  &lt;javadoc packagenames=&quot;com.dummy.test.*&quot;
-           sourcepath=&quot;src&quot;
-           destdir=&quot;docs/api&quot;
-           author=&quot;true&quot;
-           version=&quot;true&quot;
-           use=&quot;true&quot;
-           windowtitle=&quot;Test API&quot;
-           doctitle=&quot;&lt;h1&gt;Test&lt;/h1&gt;&quot;
-           bottom=&quot;&lt;i&gt;Copyright &amp;#169; 2000 Dummy Corp. All Rights Reserved.&lt;/i&gt;&quot;&gt;
-    &lt;group title=&quot;Group 1 Packages&quot; packages=&quot;com.dummy.test.a*&quot;/&gt;
-    &lt;group title=&quot;Group 2 Packages&quot; packages=&quot;com.dummy.test.b*&quot;/&gt;
-    &lt;link offline=&quot;true&quot; href=&quot;http://java.sun.com/products/jdk/1.2/docs/api/&quot; packagelistLoc=&quot;C:\tmp&quot;/&gt;
-    &lt;link href=&quot;http://developer.java.sun.com/developer/products/xml/docs/api/&quot;/&gt;
-  &lt/javadoc&gt;</pre>
-  
-<hr>
-<h2><a name="mail">Mail</a></h2>
-<h3>Description</h3>
-<p>A task to send SMTP email.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">from</td>
-    <td valign="top">Email address of sender.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">tolist</td>
-    <td valign="top">Comma-separated list of recipients.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">message</td>
-    <td valign="top">Message to send in the body of the email.</td>
-    <td align="center" valign="middle" rowspan="2">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">files</td>
-    <td valign="top">Filename(s) of text to send in the body of the email. 
-	Multiple files are comma-separated.</td>
-  </tr>
-  <tr>
-    <td valign="top">mailhost</td>
-    <td valign="top">Host name of the mail server.</td>
-    <td align="center" valign="top">No, default to &quot;localhost&quot;</td>
-  </tr>
-  <tr>
-    <td valign="top">subject</td>
-    <td valign="top">Email subject line.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>
-  &lt;mail from=&quot;me&quot; tolist=&quot;you&quot; subject=&quot;Results of nightly build&quot;
-        files=&quot;build.log&quot;/&gt;</pre>
-<p>Sends an eMail from <i>me</i> to <i>you</i> with a subject of 
-<i>Results of nightly build</i> and includes the contents of <i>build.log</i>
-in the body of the message.</p>
-<hr>
-
-<h2><a name="mkdir">Mkdir</a></h2>
-<h3>Description</h3>
-<p>Creates a directory. Also non-existent parent directories are created, when
-necessary.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">the directory to create.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>&lt;mkdir dir=&quot;${dist}&quot; /&gt;</pre>
-<p>creates a directory <code>${dist}</code>.</p>
-<pre>&lt;mkdir dir=&quot;${dist}/lib&quot; /&gt;</pre>
-<p>creates a directory <code>${dist}/lib</code>.</p>
-<hr>
-<h2><a name="move">Move</a></h2>
-<h3>Description</h3>
-<p>Moves a file to a new file or directory, or sets of files to
-a new directory.  By default, the
-destination file is overwritten if it already exists.  When <var>overwrite</var> is
-turned off, then files are only moved if the source file is newer than
-the destination file, or when the destination file does not exist.</p>
-<p><a href="#fileset">FileSet</a>s are used to select sets of files
-to move to the <var>todir</var> directory.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the file to move</td>
-    <td valign="top" align="center">One of <var>file</var> or 
-     at least one nested fileset element</td>
-  </tr>
-  <tr>
-    <td valign="top">tofile</td>
-    <td valign="top">the file to move to</td>
-    <td valign="top" align="center" rowspan="2">With the <var>file</var> attribute, 
-    either <var>tofile</var> or <var>todir</var> can be used.  With a nested fileset, 
-	 only <var>todir</var> is allowed.</td>
-  </tr>
-  <tr>
-    <td valign="top">todir</td>
-    <td valign="top">the directory to move to</td>
-  </tr>
-  <tr>
-    <td valign="top">overwrite</td>
-    <td valign="top">overwrite existing files even if the destination
-      files are newer (default is &quot;true&quot;)</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">filtering</td>
-    <td valign="top">indicates whether token filtering should take place during
-      the move.  See the <a href="#filter">filter</a> task for a description of
-      how filters work.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">flatten</td>
-    <td valign="top">ignore directory structure of source directory,
-      copy all files into a single directory, specified by the <var>todir</var>
-      attribute (default is &quot;false&quot;).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includeEmptyDirs</td>
-	 <td valign="top">Copy empty directories included with the nested FileSet(s).
-	   Defaults to &quot;yes&quot;.</td>
-	 <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<p><b>Move a single file (rename a file)</b></p>
-<pre>
-  &lt;move file=&quot;file.orig&quot; tofile=&quot;file.moved&quot; /&gt;
-</pre>
-<p><b>Move a single file to a directory</b></p>
-<pre>
-  &lt;move file=&quot;file.orig&quot; todir=&quot;dir/to/move/to&quot; /&gt;
-</pre>
-<p><b>Move a directory to a new directory</b></p>
-<pre>
-  &lt;move todir=&quot;new/dir/to/move/to&quot;&gt;
-    &lt;fileset dir=&quot;src/dir&quot;/&gt;
-  &lt;/move&gt;
-</pre>
-<p><b>Move a set of files to a new directory</b></p>
-<pre>
-  &lt;move todir=&quot;some/new/dir&quot; &gt;
-    &lt;fileset dir=&quot;my/src/dir&quot; &gt;
-      &lt;include name=&quot;**/*.jar&quot; /&gt;
-      &lt;exclude name=&quot;**/ant.jar&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/move&gt;
-</pre>
-<hr>
-<h2><a name="patch">Patch</a></h2>
-<h3>Description</h3>
-<p>Applies a diff file to originals.
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">patchfile</td> 
-    <td valign="top">the file that includes the diff output</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">originalfile</td> 
-    <td valign="top">the file to patch</td>
-    <td align="center" valign="top">No, tries to guess it from the diff 
-      file</td>
-  </tr>
-  <tr>
-    <td valign="top">backups</td> 
-    <td valign="top">Keep backups of the unpatched files</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">quiet</td> 
-    <td valign="top">Work silently unless an error occurs</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">reverse</td> 
-    <td valign="top">Assume patch was created with old and new files 
-      swapped.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">ignorewhitespace</td> 
-    <td valign="top">Ignore whitespace differences.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strip</td> 
-    <td valign="top">Strip the smallest prefix containing <i>num</i> leading 
-      slashes from filenames.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;patch patchfile=&quot;module.1.0-1.1.patch&quot; /&gt;</pre>
-<p>applies the diff included in <i>module.1.0-1.1.patch</i> to the
-files in base directory guessing the filename(s) from the diff output.
-<pre>  &lt;patch patchfile=&quot;module.1.0-1.1.patch&quot; strip=&quot;1&quot; /&gt;</pre>
-<p>like above but one leading directory part will be removed. i.e. if
-the diff output looked like
-<pre>
---- a/mod1.0/A	Mon Jun  5 17:28:41 2000
-+++ a/mod1.1/A	Mon Jun  5 17:28:49 2000
-</pre> 
-the leading <i>a/</i> will be stripped.
-<hr>
-<h2><a name="property">Property</a></h2>
-<h3>Description</h3>
-<p>Sets a property (by name and value), or set of properties (from file or
-resource) in the project.</p>
-<p>When a property was set by the user, or was a property in a parent project
-(that started this project with the <a href="#ant">ant task</a>), then this
-property cannot be set, and will be ignored. This means that properties set
-outside the current project always override the properties of the current
-project.</p>
-<p>There are four ways to set properties:</p>
-<ul>
-  <li>By supplying both the <i>name</i> and <i>value</i> attribute.</li>
-  <li>By supplying both the <i>name</i> and <i>refid</i> attribute.</li>
-  <li>By setting the <i>file</i> attribute with the filename of the property
-    file to load. This property file has the format as defined by the file used
-    in the class java.util.Properties.</li>
-  <li>By setting the <i>resource</i> attribute with the resource name of the
-    property file to load. This property file has the format as defined by the
-    file used in the class java.util.Properties.</li>
-</ul>
-<p>Although combinations of the three ways are possible, only one should be used
-at a time. Problems might occur with the order in which properties are set, for
-instance.</p>
-<p>The value part of the properties being set, might contain references to other
-properties. These references are resolved at the time these properties are set.
-This also holds for properties loaded from a property file.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">name</td>
-    <td valign="top">the name of the property to set.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">value</td>
-    <td valign="top">the value of the property.</td>
-    <td valign="middle" align="center" rowspan="5">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">refid</td>
-    <td valign="top"><a href="#references">Reference</a> to an object
-      defined elsewhere. Only yields reasonable results for references
-      to <a href="#path">PATH like structures</a> or properties.</td>
-  </tr>
-  <tr>
-    <td valign="top">resource</td>
-    <td valign="top">the resource name of the property file.</td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the filename of the property file .</td>
-  </tr>
-  <tr>
-    <td valign="top">location</td>
-    <td valign="top">Sets the property to the absolute filename of the
-      given file. If the value of this attribute is an absolute path, it
-      is left unchanged (with / and \ characters converted to the
-      current platforms conventions). Otherwise it is taken as a path
-      relative to the project's basedir and expanded.</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;property name=&quot;foo.dist&quot; value=&quot;dist&quot; /&gt;</pre>
-<p>sets the property <code>foo.dist</code> to the value &quot;dist&quot;.</p>
-<pre>  &lt;property file=&quot;foo.properties&quot; /&gt;</pre>
-<p>reads a set of properties from a file called &quot;foo.properties&quot;.</p>
-<pre>  &lt;property resource=&quot;foo.properties&quot; /&gt;</pre>
-<p>reads a set of properties from a resource called &quot;foo.properties&quot;.</p>
-<p>Note that you can reference a global properties file for all of your Ant
-builds using the following:
-<pre>  &lt;property file=&quot;${user.home}/.ant-global.properties&quot; /&gt;</pre>
-<p>since the &quot;user.home&quot; property is defined by the Java virtual machine
-to be your home directory.  This technique is more appropriate for Unix than 
-Windows since the notion of a home directory doesn't exist on Windows.  On the
-JVM that I tested, the home directory on Windows is &quot;C:\&quot;.  Different JVM
-implementations may use other values for the home directory on Windows.
-<hr>
-<h2><a name="rename">Rename</a></h2>
-<h3><i>Deprecated</i></h3>
-<p><i>This task has been deprecated.  Use the Move task instead.</i></p>
-<h3>Description</h3>
-<p>Renames a given file.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">file to rename.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">new name of the file.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">replace</td>
-    <td valign="top">Enable replacing of existing file (default: on).</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;rename src=&quot;foo.jar&quot; dest=&quot;${name}-${version}.jar&quot; /&gt;</pre> 
-<p>Renames the file <code>foo.jar</code> to <code>${name}-${version}.jar</code> (assuming <code>name</code>
- and <code>version</code> being predefined properties). If a file named <code>${name}-${version}.jar</code>
- already exists, it will be removed prior to renaming <code>foo.jar</code>.</p>
-<hr>
-<h2><a name="replace">Replace</a></h2>
-<h3>Description</h3>
-<p>Replace is a directory based task for replacing the occurrence of a given string with another string 
-in selected file.</p>
-<p>If you want to replace a text that crosses line boundaries, you
-must use a nested <code>&lt;replacetoken&gt;</code> element.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">file for which the token should be replaced.</td>
-    <td align="center" rowspan="2">Exactly one of the two.</td>
-  </tr>
-  <tr>
-    <td valign="top">dir</td>
-    <td valign="top">The base directory to use when replacing a token in 
-      multiple files.</td>
-  </tr>
-  <tr>
-    <td valign="top">token</td>
-    <td valign="top">the token which must be replaced.</td>
-    <td valign="top" align="center">Yes, unless a nested <code>replacetoken</code>
-      element is used.</td>
-  </tr>
-  <tr>
-    <td valign="top">value</td>
-    <td valign="top">the new value for the token. When omitted, an empty string
-      (&quot;&quot;) is used.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;replace file=&quot;${src}/index.html&quot; token=&quot;@@@&quot; value=&quot;wombat&quot; /&gt;</pre>
-<p>replaces occurrences of the string &quot;@@@&quot; with the string
-&quot;wombat&quot;, in the file <code>${src}/index.html</code>.</p>
-<h3>Parameters specified as nested elements</h3>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code> as well as the
-nested <code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<p>If either the text you want to replace or the replacement text
-cross line boundaries, you can use nested elements to specify
-them.</p>
-<h3>Examples</h3>
-<blockquote><pre>  
-&lt;replace dir=&quot;${src}&quot; value=&quot;wombat&quot;&gt;
-  &lt;include name=&quot;**/*.html&quot; /&gt;
-  &lt;replacetoken&gt;&lt;[CDATA[multi line
-token]]>&lt;/replacetoken&gt;
-&lt;/replace&gt;
-</pre></blockquote>
-<p>replaces occurrences of the string &quot;multi
-line<em>\n</em>token&quot; with the string &quot;wombat&quot;, in all
-HTML files in the directory <code>${src}</code>.Where <em>\n</em> is
-the platform specific line separator.</p>
-<blockquote><pre>  
-&lt;replace file=&quot;${src}/index.html&quot;&gt;
-  &lt;replacetoken&gt;&lt;[CDATA[two line
-token]]>&lt;/replacetoken&gt;
-  &lt;replacevalue&gt;&lt;[CDATA[two line
-token]]>&lt;/replacevalue&gt;
-&lt;/replace&gt;
-</pre></blockquote>
-<hr>
-<h2><a name="rmic">Rmic</a></h2>
-<h3>Description</h3>
-<p>Runs the rmic compiler for a certain class.</p>
-<p>Rmic can be run on a single class (as specified with the classname
-attribute) or a number of classes at once (all classes below base that
-are neither _Stub nor _Skel classes).</p>
-<p>It is possible to refine the set of files that are being rmiced. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>base</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">base</td>
-    <td valign="top">the location to store the compiled files.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classname</td>
-    <td valign="top">the class for which to run <code>rmic</code>.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">filtering</td>
-    <td valign="top">indicates whether token filtering should take place</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sourcebase</td>
-    <td valign="top">Pass the &quot;-keepgenerated&quot; flag to rmic and
- move the generated source file to the base directory.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">stubversion</td>
-    <td valign="top">Specify the JDK version for the generated stub code.
- Specify &quot;1.1&quot; to pass the &quot;-v1.1&quot; option to rmic.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to use during compilation</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpathref</td>
-    <td valign="top">The classpath to use during compilation, given as <a
-      href="#references">reference</a> to a PATH defined elsewhere</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verify</td>
-    <td valign="top">check that classes implement Remote before handing them 
-        to rmic (default is false)</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>classpath</h4>
-<p><code>Rmic</code>'s <em>classpath</em> attribute is a <a
-href="#path">PATH like structure</a> and can also be set via a nested
-<em>classpath</em> elements.</p>
-<h3>Examples</h3>
-<pre>  &lt;rmic classname=&quot;com.xyz.FooBar&quot; base=&quot;${build}/classes&quot; /&gt;</pre>
-<p>runs the rmic compiler for the class <code>com.xyz.FooBar</code>. The
-compiled files will be stored in the directory <code>${build}/classes</code>.</p>
-<pre>  &lt;rmic base=&quot;${build}/classes&quot; includes=&quot;**/Remote*.class&quot; /&gt;</pre>
-<p>runs the rmic compiler for all classes with <code>.class</code>
-files below <code>${build}/classes</code> whose classname starts with
-<i>Remote</i>. The compiled files will be stored in the directory
-<code>${build}/classes</code>.</p>
-
-<hr>
-<h2><a name="signjar">SignJar</a></h2>
-<h3>Description</h3>
-<p>Signs a jar or zip file with the javasign command line tool.</p>
-
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">jar</td>
-    <td valign="top">the jar file to sign</td>
-    <td valign="top" align="center">Yes.</td>
-  </tr>
-  <tr>
-    <td valign="top">alias</td>
-    <td valign="top">the alias to sign under</td>
-    <td valign="top" align="center">Yes.</td>
-  </tr>
-  <tr>
-    <td valign="top">storepass</td>
-    <td valign="top">password for keystore integrity.</td>
-    <td valign="top" align="center">Yes.</td>
-  </tr>
-  <tr>
-    <td valign="top">keystore</td>
-    <td valign="top">keystore location</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">storetype</td>
-    <td valign="top">keystore type</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keypass</td>
-    <td valign="top">password for private key (if different)</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sigfile</td>
-    <td valign="top">name of .SF/.DSA file</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">signedjar</td>
-    <td valign="top">name of signed JAR file</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">(true | false) verbose output when signing</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">internalsf</td>
-    <td valign="top">(true | false) include the .SF file inside the signature
-block</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sectionsonly</td>
-    <td valign="top">(true | false) don't compute hash of entire manifest</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;signjar jar=&quot;${dist}/lib/ant.jar&quot;
-alias=&quot;apache-group&quot; storepass=&quot;secret&quot; /&gt;</code></p>
-</blockquote>
-<p>signs the ant.jar with alias &quot;apache-group&quot; accessing the
-keystore and private key via &quot;secret&quot; password.</p>
-<hr>
-<h2><a name="style">Style</a></h2>
-<h3>Description</h3>
-<p>Process a set of documents via XSLT.</p>
-<p>This is useful for building views of XML based documentation,
-or in generating code.</p>
-<p>It is possible to refine the set of files that are being copied. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>basedir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">where to find the source xml file.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">destdir</td>
-    <td valign="top">directory where to store the results.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">extension</td>
-    <td valign="top">desired file extension to be used for the targets.
-        If not specified, the default is &quot;html&quot;.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">style</td>
-    <td valign="top">name of the stylesheet to use.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">processor</td>
-    <td valign="top">name of the XSLT processor to use.  Permissible
-values are &quot;xslp&quot; for the XSL:P processor, &quot;xalan&quot; 
-for the Apache XML Xalan processor, or the name of an arbitrary XSLTLiaison class.
-Defaults to xslp or xalan (in that order), if one is found in your
-class path</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><pre>
-&lt;style basedir=&quot;doc&quot; destdir=&quot;build/doc&quot;
-       extension=&quot;html&quot; style=&quot;style/apache.xml&quot;/&gt;
-</pre></p>
-</blockquote>
-<hr>
-<h2><a name="tar">Tar</a></h2>
-<h3>Description</h3>
-<p>Creates a tar archive.</p>
-<p>The <i>basedir</i> attribute is the reference directory from where to tar.</p>
-<p>It is possible to refine the set of files that are being tarred. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>basedir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<p>Note that this task does not perform compression. You might want to use the <a href="#gzip">GZip</a>
-task to come up with a .tar.gz package.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td valign="top" align="center"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">tarfile</td>
-    <td valign="top">the tar-file to create.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the directory from which to zip the files.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;tar tarfile=&quot;${dist}/manual.tar&quot; basedir=&quot;htdocs/manual&quot; /&gt;
-  &lt;gzip zipfile=&quot;${dist}/manual.tar.gz&quot; src=&quot;${dist}/manual.tar&quot; /&gt;</pre>
-<p>tars all files in the <code>htdocs/manual</code> directory in a file called <code>manual.tar</code>
-in the <code>${dist}</code>  directory, then applies the gzip task to compress
-it.</p>
-<pre>  &lt;tar tarfile=&quot;${dist}/manual.tar&quot;
-       basedir=&quot;htdocs/manual&quot;
-       excludes=&quot;mydocs/**, **/todo.html&quot;
-  /&gt;</pre>
-<p>tars all files in the <code>htdocs/manual</code> directory in a file called <code>manual.tar</code>
-in the <code>${dist}</code> directory. Files in the directory <code>mydocs</code>,
-or files with the name <code>todo.html</code> are excluded.</p>
-<hr>
-<h2><a name="taskdef">Taskdef</a></h2>
-<h3>Description</h3>
-<p>Adds a task definition to the current project, such that this new task can be
-used in the current project. Two attributes are needed, the name that identifies
-this task uniquely, and the full name of the class (including the packages) that
-implements this task.</p>
-<p>Taskdef should be used to add your own tasks to the system. See also &quot;<a
-href="#writingowntask">Writing your own task</a>&quot;.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">name</td>
-    <td valign="top">the name of the task</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classname</td>
-    <td valign="top">the full class name implementing the task</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td> <td valign="top">the classpath to
-      use when looking up <code>classname</code>.</td> <td
-    align="center" valign="top">No</td>
-  </tr>
-</table>
-<h3>Parameters specified as nested elements</h3>
-<h4>classpath</h4>
-<p><code>Taskdef</code>'s <em>classpath</em> attribute is a <a
-href="#path">PATH like structure</a> and can also be set via a nested
-<em>classpath</em> element.</p>
-<h3>Examples</h3>
-<pre>  &lt;taskdef name=&quot;myjavadoc&quot; classname=&quot;com.mydomain.JavadocTask&quot; /&gt;</pre>
-<p>makes a task called <code>myjavadoc</code> available to Ant. The class <code>com.mydomain.JavadocTask</code>
-implements the task.</p>
-<hr>
-<h2><a name="touch">Touch</a></h2>
-<h3>Description</h3>
-<p>Changes the modification time of a file and possibly creates it at
-the same time.</p>
-<p>For JDK 1.1 only the creation of new files with a modification time
-of now works, all other cases will emit a warning.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">file</td>
-    <td valign="top">the name of the file</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">millis</td>
-    <td valign="top">specifies the new modification time of the file
-       in milliseconds since midnight Jan 1 1970</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">datetime</td>
-    <td valign="top">specifies the new modification time of the file
-       in the format MM/DD/YYYY HH:MM AM_or_PM.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<p>If both <code>millis</code> and <code>datetime</code> are omitted
-the current time is assumed.</p>
-<h3>Examples</h3>
-<pre>  &lt;touch file=&quot;myfile&quot; /&gt;</pre>
-<p>creates <code>myfile</code> if it doesn't exist and changes the
-modification time to the current time.</p>
-<pre>  &lt;touch file=&quot;myfile&quot; datetime=&quot;06/28/2000 2:02 pm&quot; /&gt;</pre>
-<p>creates <code>myfile</code> if it doesn't exist and changes the
-modification time to Jun, 28 2000 2:02 pm (14:02 for those used to 24
-hour times).</p>
-<hr>
-<h2><a name="tstamp">Tstamp</a></h2>
-<h3>Description</h3>
-<p>Sets the DSTAMP, TSTAMP and TODAY properties in the current project. The
-DSTAMP is in the &quot;yyyymmdd&quot; format, the TSTAMP is in the &quot;hhmm&quot;
-format and TODAY is &quot;month day year&quot;.</p>
-<p>These properties can be used in the buildfile, for instance, to create
-timestamped filenames or used to replace placeholder tags inside documents to
-indicate, for example, the release date. The best place for this task is in your
-initialization target.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;tstamp/&gt;</pre>
-<hr>
-<h2><a name="uptodate">Uptodate</a></h2>
-<h3>Description</h3>
-<p>Sets a property if a Target file is more up to date than a set of
-Source files. Source files are specified by nested &lt;srcfiles&gt;
-elements, these are <a href="#fileset">FileSet</a>s.</p>
-<p>The value part of the property being set is <i>true</i> if the timestamp of the 
-Target file is more recent than the timestamp of every Source file.</p>
-<p>Normally, this task is used to set properties that are useful to avoid target
-execution depending on the relative age of the specified files.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">property</td>
-    <td valign="top">the name of the property to set.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">targetfile</td>
-    <td valign="top">the file for which we want to determine the status.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;uptodate property=&quot;xmlBuild.notRequired&quot; targetfile=&quot;${deploy}\xmlClasses.jar&quot; &gt;
-    &lt;srcfiles dir= &quot;${src}/xml&quot; includes=&quot;**/*.dtd&quot; /&gt;
-  &lt;/uptodate&gt;</pre>
-<p>sets the property <code><i>xmlBuild.notRequired</i></code> to the value &quot;true&quot;
-if the <i>${deploy}/xmlClasses.jar</i> is more up to date than any of the DTD files in the <i>${src}/xml</i> directory.</p>
-<hr>
-<h2><a name="unzip">Unjar/Unwar/Unzip</a></h2>
-<h3>Description</h3>
-<p>Unzips a zip-, war- or jarfile.</p>
-<p>For JDK 1.1 &quot;last modified time&quot; field is set to current time instead of being 
-carried from zipfile.</p>
-<p>File permissions will not be restored on extracted files.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">zipfile to expand.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">directory where to store the expanded files.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;unzip src=&quot;${tomcat_src}/tools-src.zip&quot; dest=&quot;${tools.home}&quot;
-  /&gt;</code></p>
-</blockquote>
-<hr>
-<h2><a name="untar">Untar</a></h2>
-<h3>Description</h3>
-<p>Untars a tarfile.</p>
-<p>File permissions will not be restored on extracted files.</p>
-<p>For JDK 1.1 &quot;last modified time&quot; field is set to current time instead of being 
-carried from tarfile.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">tarfile to expand.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">dest</td>
-    <td valign="top">directory where to store the expanded files.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>
-&lt;gunzip src=&quot;tools.tar.gz&quot;/&gt;<br>
-&lt;untar src=&quot;tools.tar&quot; dest=&quot;${tools.home}&quot;/&gt;
-</code></p>
-</blockquote>
-<hr>
-<h2><a name="war">War</a></h2>
-<h3>Description</h3>
-<p>An extension of the <a href="#jar">Jar</a> task with special
-treatment for files that should end up in the <code>WEB-INF/lib</code>,
-<code>WEB-INF/classes</code> or <code>WEB-INF</code> directories of the Web
-Application Archive.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">warfile</td>
-    <td valign="top">the war-file to create.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">webxml</td>
-    <td valign="top">The deployment descriptor to use (WEB-INF/web.xml).</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the directory from which to jar the files.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compress</td>
-    <td valign="top">Not only store data but also compress them, defaults to true</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">manifest</td>
-    <td valign="top">the manifest file to use.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">whenempty</td>
-    <td valign="top">Behavior to use if no files match.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Nested elements</h3>
-<h4>lib</h4>
-<p>The nested <code>lib</code> element specifies a <a
-href="#fileset">FileSet</a>. All files included in this fileset will
-end up in the <code>WEB-INF/lib</code> directory of the war file.</p>
-<h4>classes</h4>
-<p>The nested <code>classes</code> element specifies a <a
-href="#fileset">FileSet</a>. All files included in this fileset will
-end up in the <code>WEB-INF/classes</code> directory of the war file.</p>
-<h4>webinf</h4>
-<p>The nested <code>webinf</code> element specifies a <a
-href="#fileset">FileSet</a>. All files included in this fileset will
-end up in the <code>WEB-INF</code> directory of the war file. If this
-fileset includes a file named <code>web.xml</code>, the file is
-ignored and you will get a warning.</p>
-<h3>Examples</h3>
-<p>Assume the following structure in the project's base directory:
-<pre>
-thirdparty/libs/jdbc1.jar
-thirdparty/libs/jdbc2.jar
-build/main/com/myco/myapp/Servlet.class
-src/metadata/myapp.xml
-src/html/myapp/index.html
-src/jsp/myapp/front.jsp
-</pre>
-then the war file <code>myapp.war</code> created with
-<pre>
-&lt;war warfile=&quot;myapp.war&quot; webxml=&quot;src/metadata/myapp.xml&quot;&gt;
-  &lt;fileset dir=&quot;src/html/myapp&quot; /&gt;
-  &lt;fileset dir=&quot;src/jsp/myapp&quot; /&gt;
-  &lt;lib dir=&quot;thirdparty/libs&quot;&gt;
-    &lt;exclude name=&quot;jdbc1.jar&quot; /&gt;
-  &lt;/lib&gt;
-  &lt;classes dir=&quot;build/main&quot; /&gt;
-&lt;/war&gt;
-</pre>
-will consist of
-<pre>
-WEB-INF/web.xml
-WEB-INF/lib/jdbc2.jar
-WEB-INF/classes/com/myco/myapp/Servlet.class
-META-INF/MANIFEST.MF
-index.html
-front.jsp
-</pre>
-using Ant's default manifest file. The content of
-<code>WEB-INF/web.xml</code> is identical to
-<code>src/metadata/myapp.xml</code>.</p>
-<hr>
-<h2><a name="zip">Zip</a></h2>
-<h3>Description</h3>
-<p>Creates a zipfile.</p>
-<p>The <i>basedir</i> attribute is the reference directory from where to zip.</p>
-<p>Note that file permissions will not be stored in the resulting zipfile.</p>
-<p>It is possible to refine the set of files that are being zipped. This can be
-done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
-attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
-have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
-the files you want to have excluded. This is also done with patterns. And
-finally with the <i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns. 
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>basedir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<p>Or, you may place within it nested file sets, or references to file sets.
-In this case <code>basedir</code> is optional; the implicit file set is <em>only used</em>
-if <code>basedir</code> is set. You may use any mixture of the implicit file set
-(with <code>basedir</code> set, and optional attributes like <code>includes</code>
-and optional subelements like <code>&lt;include&gt;</code>); explicit nested
-<code>&lt;fileset&gt;</code> elements so long as at least one fileset total is specified. The ZIP file will
-only reflect the relative paths of files <em>within</em> each fileset.</p>
-<p>The <code>whenempty</code> parameter controls what happens when no files match.
-If <code>skip</code> (the default), the ZIP is not created and a warning is issued.
-If <code>fail</code>, the ZIP is not created and the build is halted with an error.
-If <code>create</code>, an empty ZIP file (explicitly zero entries) is created,
-which should be recognized as such by compliant ZIP manipulation tools.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td valign="top" align="center"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">zipfile</td>
-    <td valign="top">the zip-file to create.</td>
-    <td align="center" valign="top">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the directory from which to zip the files.</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compress</td>
-    <td valign="top">Not only store data but also compress them, defaults to true</td>
-    <td align="center" valign="top">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">whenempty</td>
-    <td valign="top">Behavior when no files match.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
-       basedir=&quot;htdocs/manual&quot;
-  /&gt;</pre>
-<p>zips all files in the <code>htdocs/manual</code> directory in a file called <code>manual.zip</code>
-in the <code>${dist}</code> directory.</p>
-<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
-       basedir=&quot;htdocs/manual&quot;
-       excludes=&quot;mydocs/**, **/todo.html&quot;
-  /&gt;</pre>
-<p>zips all files in the <code>htdocs/manual</code> directory in a file called <code>manual.zip</code>
-in the <code>${dist}</code> directory. Files in the directory <code>mydocs</code>,
-or files with the name <code>todo.html</code> are excluded.</p>
-<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
-       basedir=&quot;htdocs/manual&quot;
-       includes=&quot;api/**/*.html&quot;
-       excludes=&quot;**/todo.html&quot;
-  /&gt;</pre>
-<p>zips all files in the <code>htdocs/manual</code> directory in a file called <code>manual.zip</code>
-in the <code>${dist}</code> directory. Only html files under the directory <code>api</code>
-are zipped, and files with the name <code>todo.html</code> are excluded.</p>
-<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;&gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot;/&gt;
-    &lt;fileset dir=&quot;.&quot; includes=&quot;ChangeLog.txt&quot;/&gt;
-  &lt;/zip&gt;</pre>
-<p>zips all files in the <code>htdocs/manual</code> directory in a file called <code>manual.zip</code>
-in the <code>${dist}</code> directory, and also adds the file <code>ChangeLog.txt</code> in the
-current directory. <code>ChangeLog.txt</code> will be added to the top of the ZIP file, just as if
-it had been located at <code>htdocs/manual/ChangeLog.txt</code>.</p>
-
-<hr>
-<h2><a name="optionaltasks">Optional tasks</a></h2>
-<ul>
-  <li><a href="#cab">Cab</a></li>
-  <li><a href="#ftp">FTP</a></li>
-  <li><a href="javacc.html">JavaCC</a></li>
-  <li><a href="jlink.html">Jlink</a></li>
-  <li><a href="junit.html">JUnit</a></li>
-  <li><a href="native2ascii.html">Native2Ascii</a></li>
-  <li><a href="#netrexxc">NetRexxC</a></li>
-  <li><a href="P4desc.html">Perforce</a></li>
-  <li><a href="#renameexts">RenameExtensions</a></li>
-  <li><a href="#script">Script</a></li>
-  <li><a href="#vssget">VssGet</a></li>
-  <li><a href="ejb.html">EJB Tasks</a></li>
-</ul>
-<hr>
-<h2><a name="cab">Cab</a></h2>
-<h3>Description</h3>
-<p>The cab task creates Microsoft cab archive files.  It is invoked
-similar to the <a href="#jar">jar</a> or <a href="#zip">zip</a> tasks.
-This task will only work on Windows, and will be silently ignored on
-other platforms.  You must have the Microsoft cabarc tool available in
-your executable path.</p>
-<p>See the section on <a href="#directorybasedtasks">directory based
-tasks</a>, on how the inclusion/exclusion of files works, and how to
-write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>basedir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">cabfile</td>
-    <td valign="top">the name of the cab file to create.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">basedir</td>
-    <td valign="top">the directory to start archiving files from.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">set to &quot;yes&quot; if you want to see the output from
-      the cabarc tool.  defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compress</td>
-    <td valign="top">set to &quot;no&quot; to store files without compressing.
-      defaults to &quot;yes&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">options</td>
-    <td valign="top">use to set additional command-line options for
-      the cabarc tool.  should not normally be necessary.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that
-      must be included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that
-      must be excluded. No files (except default excludes) are excluded
-      when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used
-      or not (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote><pre>
-&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
-     basedir=&quot;htdocs/manual&quot; 
-  /&gt;
-</pre></blockquote>
-<p>cabs all files in the htdocs/manual directory in a file called
-manual.cab in the ${dist} directory.</p>
-<blockquote><pre>
-&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
-     basedir=&quot;htdocs/manual&quot;
-     excludes=&quot;mydocs/**, **/todo.html&quot;
-  /&gt;
-</pre></blockquote>
-<p>cabs all files in the htdocs/manual directory in a file called
-manual.cab in the ${dist} directory. Files in the directory mydocs,
-or files with the name todo.html are excluded.</p>
-<blockquote><pre>
-&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
-     basedir=&quot;htdocs/manual&quot;
-     includes=&quot;api/**/*.html&quot;
-     excludes=&quot;**/todo.html&quot;
-     verbose=&quot;yes&quot;
-  /&gt;
-</pre></blockquote>
-<p>cab all files in the htdocs/manual directory in a file called
-manual.cab in the ${dist} directory. Only html files under the
-directory api are archived, and files with the name todo.html are
-excluded. Output from the cabarc tool is displayed in the build
-output.</p>
-<hr>
-<h2><a name="ftp">FTP</a></h2>
-<h3>Description</h3>
-<p>The ftp task implements a basic FTP client that can send, receive,
-list, and delete files.  See below for descriptions and examples of how
-to perform each task.</p>
-<p>The ftp task makes no attempt to determine what file system syntax is
-required by the remote server, and defaults to Unix standards.
-<i>remotedir</i> must be specified in the exact syntax required by the ftp
-server. If the usual Unix conventions are not supported by the server,
-<i>separator</i> can be used to set the file separator that should be used
-instead.</p>
-<p>See the section on <a href="#directorybasedtasks">directory based
-tasks</a>, on how the inclusion/exclusion of files works, and how to
-write patterns.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">server</td>
-    <td valign="top">the address of the remote ftp server.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">port</td>
-    <td valign="top">the port number of the remote ftp server.
-                     Defaults to port 21.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">userid</td>
-    <td valign="top">the login id to use on the ftp server.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">password</td>
-    <td valign="top">the login password to use on the ftp server.</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">remotedir</td>
-    <td valign="top">the directory to which to upload files on the 
-                     ftp server.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">action</td>
-    <td valign="top">the ftp action to perform, defaulting to &quot;send&quot;.  
-                     Currently supports&quot;put&quot;, &quot;get&quot;,
-                     &quot;del&quot;, and &quot;list&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">binary</td>
-    <td valign="top">selects binary-mode (&quot;yes&quot;) or text-mode 
-                     (&quot;no&quot;) transfers.  
-                     Defaults to &quot;yes&quot;</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">displays information on each file transferred if set 
-                     to &quot;yes&quot;. Defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">depends</td>
-    <td valign="top">transfers only new or changed files if set to 
-                     &quot;yes&quot;. Defaults to &quot;no&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">newer</td>
-    <td valign="top">a synonym for <i>depends</i>.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">separator</td>
-    <td valign="top">sets the file separator used on the ftp server.
-                     Defaults to &quot;/&quot;.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">listing</td>
-    <td valign="top">the file to write results of the &quot;list&quot; action.
-                     Required for the &quot;list&quot; action, ignored otherwise.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Sending Files</h3>
-<p>The easiest way to describe how to send files is with a couple of examples:</p>
-<pre>
-  &lt;ftp server=&quot;ftp.apache.org&quot;
-       userid=&quot;anonymous&quot;
-       password=&quot;me@myorg.com&quot;&gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot; /&gt;
-  &lt;/ftp&gt;
-</pre>
-<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
-uploads all files in the <code>htdocs/manual</code> directory 
-to the default directory for that user.</p>
-<pre>  &lt;ftp server=&quot;ftp.apache.org&quot;
-       remotedir=&quot;incoming&quot;
-       userid=&quot;anonymous&quot;
-       password=&quot;me@myorg.com&quot;
-       depends=&quot;yes&quot;
-  &gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot; /&gt;
-  &lt;/ftp&gt;</pre>
-<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
-uploads all new or changed files in the <code>htdocs/manual</code> directory 
-to the <code>incoming</code> directory relative to the default directory
-for <code>anonymous</code>.</p>
-<pre>  &lt;ftp server=&quot;ftp.apache.org&quot;
-       port=&quot;2121&quot;
-       remotedir=&quot;/pub/incoming&quot;
-       userid=&quot;coder&quot;
-       password=&quot;java1&quot;
-       depends=&quot;yes&quot;
-       binary=&quot;no&quot;
-  &gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot;&gt;
-      &lt;include name=&quot;**/*.html&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/ftp&gt;</pre>
-<p>Logs in to <code>ftp.apache.org</code> at port <code>2121</code> as 
-<code>coder</code> with password <code>java1</code> and uploads all new or 
-changed HTML files in the <code>htdocs/manual</code> directory to the 
-<code>/pub/incoming</code> directory.  The files are transferred in text
-mode.</p>
-<pre>  &lt;ftp server=&quot;ftp.nt.org&quot;
-       remotedir=&quot;c:\uploads&quot;
-       userid=&quot;coder&quot;
-       password=&quot;java1&quot;
-       separator=&quot;\&quot;
-       verbose=&quot;yes&quot;
-  &gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot;&gt;
-      &lt;include name=&quot;**/*.html&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/ftp&gt;</pre>
-<p>Logs in to the Windows-based <code>ftp.nt.org</code> as 
-<code>coder</code> with password <code>java1</code> and uploads all 
-HTML files in the <code>htdocs/manual</code> directory to the 
-<code>c:\uploads</code> directory.  Progress messages are displayed as each
-file is uploaded.</p>
-<h3>Getting Files</h3>
-<p>Getting files from an FTP server works pretty much the same way as 
-sending them does.  The only difference is that the nested filesets
-use the remotedir attribute as the base directory for the files on the
-FTP server, and the dir attribute as the local directory to put the files
-into.  The file structure from the FTP site is preserved on the local machine.</p>
-<pre>
-  &lt;ftp action=&quot;get&quot;
-       server=&quot;ftp.apache.org&quot;
-       userid=&quot;anonymous&quot;
-       password=&quot;me@myorg.com&quot;&gt;
-    &lt;fileset dir=&quot;htdocs/manual&quot; &gt;
-      &lt;include name=&quot;**/*.html&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/ftp&gt;
-</pre>
-<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
-recursively downloads all .html files from default directory for that user 
-into the <code>htdocs/manual</code> directory on the local machine.</p>
-<h3>Deleting Files</h3>
-As you've probably guessed by now, you use nested fileset elements to 
-select the files to delete from the remote FTP server.  Again, the 
-filesets are relative to the remote directory, not a local directory.  In
-fact, the dir attribute of the fileset is ignored completely.
-<pre>
-  &lt;ftp action=&quot;del&quot;
-       server=&quot;ftp.apache.org&quot;
-       userid=&quot;anonymous&quot;
-       password=&quot;me@myorg.com&quot; &gt;
-    &lt;fileset&gt;
-      &lt;include name=&quot;**/*.tmp&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/ftp&gt;
-</pre>
-<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and
-tries to delete all *.tmp files from the default directory for that user.
-If you don't have permission to delete a file, a BuildException is thrown.</p>
-<h3>Listing Files</h3>
-<pre>
-  &lt;ftp action=&quot;list&quot;
-       server=&quot;ftp.apache.org&quot;
-       userid=quot;anonymous&quot;
-       password=&quot;me@myorg.com&quot; 
-       listing=&quot;data/ftp.listing&quot; &gt;
-    &lt;fileset&gt;
-      &lt;include name=&quot;**&quot; /&gt;
-    &lt;/fileset&gt;
-  &lt;/ftp&gt;
-</pre>
-<p>This provides a file listing in <code>data/ftp.listing</code> of all the files on
-the FTP server relative to the default directory of the <code>anonymous</code>
-user. The listing is in whatever format the FTP server normally lists files.</p>
-<hr>
-<h2><a name="netrexxc">NetRexxC</a></h2>
-<h3>Description</h3>
-<p>Compiles a <a href="http://www2.hursley.ibm.com/netrexx">NetRexx</a>
-source tree within the running (Ant) VM.</p>
-<p>The source and destination directory will be recursively scanned for
-NetRexx source files to compile.  Only NetRexx files that have no corresponding
-class file or where the class file is older than the java file will be compiled.</p>
-<p>Files in the source tree are copied to the destination directory,
-allowing support files to be located properly in the classpath. The source 
-files are copied because the NetRexx compiler cannot produce class files in a
-specific directory via parameters</p>
-<p>The directory structure of the source tree should follow the package
-hierarchy.</p>
-<p>It is possible to refine the set of files that are being compiled/copied.
-This can be done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and
-<i>defaultexcludes</i> attributes. With the <i>includes</i> or <i>includesfile</i> attribute you 
-specify the files you want to have included by using patterns. The 
-<i>exclude</i> or <i>excludesfile</i> attribute is used to specify the files you want to have 
-excluded.  This is also done with patterns.  And finally with the 
-<i>defaultexcludes</i> attribute, you can specify whether you
-want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns.</p>
-<p>This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">binary</td>
-    <td valign="top">Whether literals are treated as the java binary
-      type rather than the NetRexx types</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">classpath</td>
-    <td valign="top">The classpath to use during compilation</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">comments</td>
-    <td valign="top">Whether comments are passed through to the
-      generated java source</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compact</td>
-    <td valign="top">Whether error messages come out in compact or
-      verbose format</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">compile</td>
-    <td valign="top">Whether the NetRexx compiler should compile the
-      generated java code</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">console</td>
-    <td valign="top">Whether or not messages should be displayed on the
-      'console'</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">crossref</td>
-    <td valign="top">Whether variable cross references are generated</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">decimal</td>
-    <td valign="top">Whether decimal arithmetic should be used for the
-      NetRexx code</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when
-      omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">destDir</td>
-    <td valign="top">the destination directory into which the NetRexx
-      source files should be copied and then compiled</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">diag</td>
-    <td valign="top">Whether diagnostic information about the compile is
-      generated</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when
-      omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">explicit</td>
-    <td valign="top">Whether variables must be declared explicitly
-      before use</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">format</td>
-    <td valign="top">Whether the generated java code is formatted nicely
-      or left to match NetRexx line numbers for call stack debugging</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">java</td>
-    <td valign="top">Whether the generated java code is produced</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">keep</td>
-    <td valign="top">Sets whether the generated java source file should be kept
-      after compilation. The generated files will have an extension of
-      .java.keep, <b>not</b> .java</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">logo</td>
-    <td valign="top">Whether the compiler text logo is displayed when
-      compiling</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">replace</td>
-    <td valign="top">Whether the generated .java file should be replaced
-      when compiling</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">savelog</td>
-    <td valign="top">Whether the compiler messages will be written to
-      NetRexxC.log as well as to the console</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">sourcedir</td>
-    <td valign="top">Tells the NetRexx compiler to store the class files in the
-      same directory as the source files. The alternative is the working
-      directory</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">srcDir</td>
-    <td valign="top">Set the source dir to find the source Netrexx
-      files</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">strictargs</td>
-    <td valign="top">Tells the NetRexx compiler that method calls always
-      need parentheses, even if no arguments are needed, e.g. 
-      <code>aStringVar.getBytes</code> vs. 
-      <code>aStringVar.getBytes()</code></td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strictassign</td>
-    <td valign="top">Tells the NetRexx compile that assignments must
-      match exactly on type</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strictcase</td>
-    <td valign="top">Specifies whether the NetRexx compiler should be
-      case sensitive or not</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strictimport</td>
-    <td valign="top">Whether classes need to be imported explicitly using an 
-      <code>import</code> statement.  By default the NetRexx compiler will 
-      import certain packages automatically</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strictprops</td>
-    <td valign="top">Whether local properties need to be qualified
-      explicitly using <code>this</code></td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">strictsignal</td>
-    <td valign="top">Whether the compiler should force catching of
-      exceptions by explicitly named types</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">symbols</td>
-    <td valign="top">Whether debug symbols should be generated into the
-      class file</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">time</td>
-    <td valign="top">Asks the NetRexx compiler to print compilation
-      times to the console</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">trace</td>
-    <td valign="top">Turns on or off tracing and directs the resultant
-      trace output</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">utf8</td>
-    <td valign="top">Tells the NetRexx compiler that the source is in UTF8</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">verbose</td>
-    <td valign="top">Whether lots of warnings and error messages should
-      be generated</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;netrexxc srcDir=&quot;/source/project&quot;
-           includes=&quot;vnr/util/*&quot;
-           destDir=&quot;/source/project/build&quot;
-           classpath=&quot;/source/project2/proj.jar&quot;
-           comments=&quot;true&quot;
-           crossref=&quot;false&quot; replace=&quot;true&quot;
-           keep=&quot;true&quot; /&gt;</code>
-  </p>
-</blockquote>
-<hr>
-<h2><a name="renameexts">RenameExtensions</a></h2>
-<h3>Description</h3>
-<p>Renames files in the <code>srcDir</code> directory ending with the
-<code>fromExtension</code> string so that they end with the 
-<code>toExtension</code> string. Files are only replaced if 
-<code>replace</code> is true
-</p>
-<p>See the section on 
-<a href="#directorybasedtasks">directory based tasks</a>, on how the
-inclusion/exclusion of files works, and how to write patterns. 
-This task forms an implicit <a href="#fileset">FileSet</a> and
-supports all attributes of <code>&lt;fileset&gt;</code>
-(<code>dir</code> becomes <code>srcDir</code>) as well as the nested
-<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
-<code>&lt;patternset&gt;</code> elements.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">defaultexcludes</td>
-    <td valign="top">indicates whether default excludes should be used or not
-      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when
-      omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      excluded. No files (except default excludes) are excluded when
-      omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">excludesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an exclude pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">fromExtention</td>
-    <td valign="top">The string that files must end in to be renamed</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">includes</td>
-    <td valign="top">comma separated list of patterns of files that must be
-      included. All files are included when omitted.</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">includesfile</td>
-    <td valign="top">the name of a file. Each line of this file is
-      taken to be an include pattern</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">replace</td>
-    <td valign="top">Whether the file being renamed to should be
-      replaced if it already exists</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">srcDir</td>
-    <td valign="top">The starting directory for files to search in</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-  <tr>
-    <td valign="top">toExtension</td>
-    <td valign="top">The string that renamed files will end with on
-      completion</td>
-    <td valign="top" align="center">Yes</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote>
-  <p><code>&lt;renameext srcDir=&quot;/source/project1&quot;
-              includes=&quot;**&quot;
-              excludes=&quot;**/samples/*&quot;
-              fromExtension=&quot;.java.keep&quot;
-              toExtension=&quot;.java&quot;
-              replace=&quot;true&quot; /&gt;
-</code>
-  </p>
-</blockquote>
-
-<hr>
-<h2><a name="script">Script</a></h2>
-<h3>Description</h3>
-<p>Execute a script in a 
-  <a href="http://oss.software.ibm.com/developerworks/opensource/bsf/">BSF</a> supported language.
-<p>All items (tasks, targets, etc) of the running project are
-accessible from the script, using either their <code>name</code> or
-<code>id</code> attributes.</p>
-<p>Scripts can do almost anything a task written in Java could do.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <td valign="top"><b>Attribute</b></td>
-    <td valign="top"><b>Description</b></td>
-    <td align="center" valign="top"><b>Required</b></td>
-  </tr>
-  <tr>
-    <td valign="top">language</td>
-    <td valign="top">The programming language the script is written in.
-      Must be a supported BSF language</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-  <tr>
-    <td valign="top">src</td>
-    <td valign="top">The location of the script as a file, if not inline</td>
-    <td valign="top" align="center">No</td>
-  </tr>
-</table>
-<h3>Examples</h3>
-<blockquote><pre>
-&lt;project name=&quot;squares&quot; default=&quot;main&quot; basedir=&quot;.&quot;&gt;
-
-  &lt;target name=&quot;setup&quot;&gt;
-
-    &lt;script language=&quot;javascript&quot;&gt; &lt;![CDATA[
-
-      for (i=1; i&lt;=10; i++) {
-        echo = squares.createTask(&quot;echo&quot;);
-        main.addTask(echo);
-        echo.setMessage(i*i);
-      }
-
-    ]]&gt; &lt;/script&gt;
-
-  &lt;/target&gt;
-
-  &lt;target name=&quot;main&quot; depends=&quot;setup&quot; /&gt;
-
-&lt;/project&gt;
-</pre></blockquote>
-<p>generates</p>
-<blockquote><pre>
-setup:
-
-main:
-1
-4
-9
-16
-25
-36
-49
-64
-81
-100
-
-BUILD SUCCESSFUL
-</pre></blockquote>
-<p>Another example, using <a href="#references">references by id</a>
-and two different scripting languages:</p>
-<blockquote><pre>
-&lt;project name=&quot;testscript&quot; default=&quot;main&quot;&gt;
-  &lt;target name=&quot;sub&quot;&gt;
-    &lt;echo id=&quot;theEcho&quot; /&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;sub1&quot;&gt;
-    &lt;script language=&quot;netrexx&quot;&gt;&lt;![CDATA[
-      theEcho.setMessage(&quot;In sub1&quot;)
-      sub.execute
-    ]]&gt;&lt;/script&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;sub2&quot;&gt;
-    &lt;script language=&quot;javascript&quot;&gt;&lt;![CDATA[
-      theEcho.setMessage(&quot;In sub2&quot;);
-      sub.execute();
-    ]]&gt;&lt;/script&gt;
-  &lt;/target&gt;
-
-  &lt;target name=&quot;main&quot; depends=&quot;sub1,sub2&quot; /&gt;
-&lt;/project&gt;
-</pre></blockquote>
-<p>generates</p>
-<blockquote><pre>
-sub1:
-In sub1
-
-sub2:
-In sub2
-
-main:
-
-BUILD SUCCESSFUL
-</pre></blockquote>
-<hr>
-<h2><a name="vssget">VssGet</a></h2>
-<h3>Description</h3>
-Task to perform GET commands to Microsoft Visual Source Safe.
-<p>If you specify two or more attributes from version, date and 
-label only one will be used in the order version, date, label.</p>
-<h3>Parameters</h3>
-<table border="1" cellpadding="2" cellspacing="0">
-  <tr>
-    <th>Attribute</th>
-    <th>Values</th>
-    <th>Required</th>
-  </tr>
-  <tr>
-     <td>login</td>
-     <td>username,password</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>vsspath</td>
-     <td>SourceSafe path</td>
-     <td>Yes</td>
-  </tr>
-  <tr>
-     <td>localpath</td>
-     <td>Override the working directory and get to the specified path</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>writable</td>
-     <td>true or false</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>recursive</td>
-     <td>true or false</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>version</td>
-     <td>a version number to get</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>date</td>
-     <td>a date stamp to get at</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>label</td>
-     <td>a label to get for</td>
-     <td>No</td>
-  </tr>
-  <tr>
-     <td>ssdir</td>
-     <td>directory where <code>ss.exe</code> resides. By default the
-     task expects it to be in the PATH.</td>
-     <td>No</td>
-  </tr>
-</table>
-<p>Note that only one of version, date or label should be specified</p>
-<h3>Examples</h3>
-<blockquote>
-<pre>
-&lt;vssget localPath=&quot;C:\mysrc\myproject&quot;
-        recursive=&quot;true&quot; 
-        label=&quot;Release1&quot;
-        login=&quot;me,mypassword&quot;
-        vsspath=&quot;/source/aProject&quot;
-        writable=&quot;true&quot;/&gt;
-</pre>
-</blockquote>
-<p>Does a get on the VSS-Project <i>$/source/aproject</i> using the username
-<i>me</i> and the password <i>mypassword</i>. It will recursively get the files 
-which are labeled <i>Release1</i> and write them to the local directory
-<i>C:\mysrc\myproject</i>. The local files will be writable.</p>
-<hr>
-<h2><a name="buildevents">Build Events</a></h2>
-Ant is capable of generating build events as it performs the tasks necessary to build a project. 
-Listeners can be attached to ant to receive these events. This capability could be used, for example,
-to connect Ant to a GUI or to integrate Ant with an IDE. 
-
-<p>To use build events you need to create an ant <code>Project</code> object. You can then call the 
-<code>addBuildListener</code> method to add your listener to the project. Your listener must implement
-the <code>org.apache.tools.antBuildListener</code> interface. The listener will receive BuildEvents 
-for the following events
-<ul>
-<li>Build started
-<li>Build finished
-<li>Target started
-<li>Target finished
-<li>Task started
-<li>Task finished
-<li>Message logged
-</ul>
-
-If you wish to attach a listener from the command line you may use the -listener option. For example
-<blockquote>
-  <pre>ant -listener org.apache.tools.ant.XmlLogger</pre>
-</blockquote>
-will run ant with a listener which generates an XML representation of the build progress. This 
-listener is included with ant as is the default listener which generates the logging to standard
-output.
-
-
-<hr>
-<h2><a name="writingowntask">Writing your own task</a></h2>
-<p>It is very easy to write your own task:</p>
-<ol>
-  <li>Create a Java class that extends <code>org.apache.tools.ant.Task</code>.</li>
-  <li>For each attribute, write a setter method. The setter method must be a 
-    <code>public void</code> method that takes a single argument. The
-    name of the method must begin with &quot;set&quot;, followed by the
-    attribute name, with the first character in uppercase, and the rest in
-    lowercase. The type of the attribute can be <code>String</code>, any 
-    primitive type (they are converted for you from their String-representation
-	in the build-file. If you specify a boolean your method will be passed the value 
-	<i>true</i> if the value specified in the build-file is one of &quot;true&quot;,
-	&quot;yes&quot; or &quot;on&quot;), <code>Class</code>, <code>File</code>
-	(in which case the value of the attribute is interpreted relative to the 
-	project's basedir) or any other type that has a constructor with a single 
-	<code>String</code> argument</li>
-  <li>If your task has enumerated attributes, you should consider using
-    a subclass of org.apache.tools.ant.types.EnumeratedAttribute as argument
-    to your setter method. See org.apache.tools.ant.taskdefs.FixCRLF for
-    an example.</li>
-  <li>If the task should support character data, write a <code>public void 
-    addText(String)</code> method.</li>
-  <li>For each nested element, write a create or add method. A create method 
-    must be a <code>public</code> method that takes no arguments and returns 
-    an Object type. The name of the create method must begin with 
-    &quot;create&quot;, followed by the element name. An add method must be 
-    a <code>public void</code> method that takes a single argument of an 
-    Object type with a no argument constructor. The name of the add method 
-    must begin with &quot;add&quot;, followed by the element name.
-  <li>Write a <code>public void execute</code> method, with no arguments, that
-    throws a <code>BuildException</code>. This method implements the task
-    itself.</li>
-</ol>
-<h3>The life cycle of a task</h3>
-<ol>
-  <li>The task gets instantiated using a no-arg constructor at parser
-    time. This means even tasks that are never executed get
-    instantiated.</li>
-
-  <li>The tasks gets references to its project and location inside the
-    build file via their inherited <code>project</code> and
-    <code>location</code> variables.</li>
-
-  <li>If the user specified an id attribute to this task, the project
-    registers a reference to this newly created task - at parser
-    time.</li>
-
-  <li>The task gets a reference to the target it belongs to via its
-    inherited <code>target</code> variable.</li>
-
-  <li><code>init()</code> is called at parser time.</li>
-
-  <li>All child elements of the XML element corresponding to this task
-    are created via this task's <code>createXXX()</code> methods or
-    instantiated and added to this task via its <code>addXXX()</code>
-    methods - at parser time.</li>
-
-  <li>All attributes of this task get set via their corresponding
-    <code>setXXX</code> methods - at runtime.</li>
-
-  <li>The content character data sections inside the XML element
-    corresponding to this task is added to the task via its
-    <code>addText</code> method - at runtime.</li>
-
-  <li>All attributes of all child elements get set via their corresponding
-    <code>setXXX</code> methods - at runtime.</li>
-
-  <li><code>execute()</code> is called at runtime.</li>
-
-</ol>
-<h3>Example</h3>
-<p>Let's write our own task, that prints a message on the System.out stream. The
-task has one attribute called &quot;message&quot;.</p>
-<blockquote>
-  <pre>package com.mydomain;
-
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.Task;
-
-public class MyVeryOwnTask extends Task {
-  private String msg;
-
-  // The method executing the task
-  public void execute() throws BuildException {
-    System.out.println(msg);
-  }
-
-  // The setter for the &quot;message&quot; attribute
-  public void setMessage(String msg) {
-    this.msg = msg;
-  }
-}</pre>
-</blockquote>
-<p>It's really this simple;-)</p>
-<p>Adding your task to the system is rather simple too:</p>
-<ol>
-  <li>Make sure the class that implements your task is in the classpath when
-    starting Ant.</li>
-  <li>Add a <i>taskdef</i> element to your project. This actually adds
-    your task to the system.</li>
-  <li>Use your task in the rest of the buildfile.</li>
-</ol>
-<h3>Example</h3>
-<blockquote>
-  <pre>&lt;?xml version=&quot;1.0&quot;?&gt;
-
-&lt;project name=&quot;OwnTaskExample&quot; default=&quot;main&quot; basedir=&quot;.&quot;&gt;
-  &lt;taskdef name=&quot;mytask&quot; classname=&quot;com.mydomain.MyVeryOwnTask&quot;/&gt;
-
-  &lt;target name=&quot;main&quot;&gt;
-    &lt;mytask message=&quot;Hello World! MyVeryOwnTask works!&quot; /&gt;
-  &lt;/target&gt;
-&lt;/project&gt;
-</pre>
-</blockquote>
-<p>Another way to add a task (more permanently), is to add the task name and
-implementing class name to the <code>default.properties</code> file in the <code>org.apache.tools.ant.taskdefs</code>
-package. Then you can use it as if it were a built in task.</p>
-<hr>
-<h2><a name="faq">FAQ, DTD, external resources</a></h2>
-<p>There is an online FAQ for Ant at <a
-href="http://jakarta.apache.org/jyve-faq/Turbine/screen/DisplayTopics/action/SetAll/project_id/2/faq_id/16">jakarta.apache.org</a>. This
-FAQ is interactive, which means you can ask and answer questions
-online.</p>
-<p>One of the questions poping up quite often is &quot;Is there a DTD for
-buildfiles?&quot;. Please refer to the FAQ for an answer.</p>
-<hr>
-<h2><a name="feedback">Feedback</a></h2>
-<p>To provide feedback on this software, please subscribe to the Ant User
-Mail List (<a href="mailto:ant-user-subscribe@jakarta.apache.org">ant-user-subscribe@jakarta.apache.org</a>)</p>
-<p>If you want to contribute to Ant or stay current with the latest
-development, join the Ant Development Mail List (<a
-href="mailto:ant-dev-subscribe@jakarta.apache.org">ant-dev-subscribe@jakarta.apache.org</a>)</p>
-<p>Archives of both lists can be found at <a
-href="http://archive.covalent.net/">http://archive.covalent.net/</a>. Many
-thanks to Covalent Technologies.</p>
-<hr>
-<p align="center">Copyright &copy; 2000 Apache Software Foundation. All rights
-Reserved.</p>
-
-</body>
-
-</html>
-
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/ant.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/ant.html
new file mode 100644
index 0000000..3e0d838
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/ant.html
@@ -0,0 +1,69 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="ant">Ant</a></h2>
+<h3>Description</h3>
+<p>Runs Ant on a supplied buildfile. This can be used to build subprojects.</p>
+<p>When the <i>antfile</i> attribute is omitted, the file &quot;build.xml&quot;
+in the supplied directory (<i>dir</i> attribute) is used.</p>
+<p>If no target attribute is supplied, the default target of the new project is
+used.</p>
+<p>The properties of the current project will be available in the new project.
+These properties will override the properties that are set in the new project.
+(See also the <a href="property.html">property task</a>). You can set properties
+in the new project from the old project by using nested property tags. This
+allows you to parameterize your subprojects.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">antfile</td>
+    <td valign="top">the buildfile to use. Defaults to &quot;build.xml&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+ 	<td valign="top">the directory to use as a basedir for the new Ant project. 
+					 Defaults to the current directory.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">target</td>
+    <td valign="top">the target of the new Ant project that should be executed.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">Filename to write the ant output to.
+    </td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>
+  &lt;ant antfile=&quot;subproject/subbuild.xml&quot; dir=&quot;subproject&quot; target=&quot;compile&quot;/&gt;
+
+  &lt;ant dir=&quot;subproject&quot;/&gt;
+
+  &lt;ant antfile=&quot;subproject/property_based_subbuild.xml&quot;&gt;
+    &lt;property name=&quot;param1&quot; value=&quot;version 1.x&quot;/&gt;
+    &lt;property file=&quot;config/subproject/default.properties&quot;/&gt;
+  &lt;/ant&gt;
+</pre>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/antcall.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/antcall.html
new file mode 100644
index 0000000..d3057ea
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/antcall.html
@@ -0,0 +1,49 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="antcall">AntCall</a></h2>
+<h3>Description</h3>
+<p>Call another target within the same build-file optionally specifying some
+properties (param's in this context)</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">target</td>
+    <td valign="top">The target to execute.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>param</h4>
+<p>Specifies the properties to set before running the specified target. See <a
+href="property.html">property</a> for usage guidelines.</p>
+<h3>Examples</h3>
+<pre>
+  &lt;target name=&quot;default&quot;&gt;
+    &lt;antcall target=&quot;doSomethingElse&quot;&gt;
+      &lt;param name=&quot;param1&quot; value=&quot;value&quot;/&gt;
+    &lt;/antcall&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;doSomethingElse&quot;&gt;
+    &lt;echo message=&quot;param1=${param1}&quot;/&gt;
+  &lt;/target&gt;
+</pre>
+<p>Will run the target 'doSomethingElse' and echo 'param1=value'.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/antstructure.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/antstructure.html
new file mode 100644
index 0000000..708edfc
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/antstructure.html
@@ -0,0 +1,43 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="antstructure">AntStructure</a></h2>
+<h3>Description</h3> 
+<p>Generates a DTD for Ant buildfiles which contains information
+about all tasks currently known to Ant.</p> 
+<p>Note that the DTD generated by this task is incomplete, you can
+always add XML entities using <a
+href="taskdef.html"><code>&lt;taskdef&gt;</code></a>. See <a
+href="http://www.sdv.fr/pages/casa/html/ant-dtd.en.html" target="_top">here</a> for
+a way to get around this problem.</p>
+<p>This task doesn't know about required attributes, all will be
+listed as <code>#IMPLIED</code>.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">file to write the DTD to.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;antstructure output=&quot;project.dtd&quot;/&gt;
+</pre></blockquote>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/apply.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/apply.html
new file mode 100644
index 0000000..f4daa05
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/apply.html
@@ -0,0 +1,131 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="apply">Apply</a></h2>
+<h3>Description</h3>
+<p>Executes a system command. When the <i>os</i> attribute is specified, then
+the command is only executed when Ant is run on one of the specified operating
+systems.</p>
+<p>The files and/or directories of a number of <a
+href="../CoreTypes/fileset.html">FileSet</a>s are passed as arguments to the system
+command. The timestamp of each source file is compared to the
+timestamp of a target file which is defined by a nested <a
+href="../CoreTypes/mapper.html">mapper</a> element. At least one fileset and exactly
+one mapper element are required.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">executable</td>
+    <td valign="top">the command to execute without any command line
+      arguments.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the directory where the target files will be placed.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory in which the command should be executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">os</td>
+    <td valign="top">list of Operating Systems on which the command may be
+      executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">the file to which the output of the command should be
+      redirected.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">timeout</td>
+    <td valign="top">Stop the command if it doesn't finish within the
+      specified time (given in milliseconds).</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td>
+    <td valign="top">Stop the buildprocess if the command exits with a
+      returncode other than 0.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">parallel</td>
+    <td valign="top">Run the command only once, appending all files as
+      arguments. If false, command will be executed once for every file. 
+      Defaults to false. </td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">type</td>
+    <td valign="top">One of <i>file</i>, <i>dir</i> or
+      <i>both</i>. If set to <i>file</i>, only the names of plain
+      files will be sent to the command. If set to <i>dir</i>, only
+      the names of directories are considered.</td>
+    <td align="center" valign="top">No, default is <i>file</i></td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>fileset</h4>
+<p>You can use any number of nested <code>&lt;fileset&gt;</code>
+elements to define the files for this task and refer to
+<code>&lt;fileset&gt;</code>s defined elsewhere.</p>
+<h4>arg</h4>
+<p>Command line arguments should be specified as nested
+<code>&lt;arg&gt;</code> elements. See <a
+href="../using.html#arg">Command line arguments</a>.</p>
+<h4>srcfile</h4>
+<p>By default the file names of the source files will be added to the
+end of the command line. If you need to place it somewhere different,
+use a nested <code>&lt;srcfile&gt;</code> element between your
+<code>&lt;arg&gt;</code> elements to mark the insertion point.</p>
+<h4>targetfile</h4>
+<p><code>&lt;targetfile&gt;</code> is similar to
+<code>&lt;srcfile&gt;</code> and marks the position of the target
+filename on the command line. If omitted, the target filenames will
+not be added to the command line at all.</p>
+<h4>env</h4>
+<p>It is possible to specify environment variables to pass to the
+system command via nested <code>&lt;env&gt;</code> elements. See the
+description in the section about <a href="exec.html#env">exec</a></p>
+<p>Please note that the environment of the current Ant process is
+<b>not</b> passed to the system command if you specify variables using
+<code>&lt;env&gt;</code>.</p>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;apply executable=&quot;cc&quot; dest=&quot;src/C&quot; parallel=&quot;false&quot;&gt;
+  &lt;arg value=&quot;-c&quot;/&gt;
+  &lt;arg value=&quot;-o&quot;/&gt;
+  &lt;targetfile/&gt;
+  &lt;srcfile/&gt;
+  &lt;fileset dir=&quot;src/C&quot; includes=&quot;*.c&quot;/&gt;
+  &lt;mapper type=&quot;glob&quot; from=&quot;*.c&quot; to=&quot;*.o&quot;/&gt;
+&lt;/apply&gt;
+</pre></blockquote>
+<p>invokes <code>cc -c -o TARGETFILE SOURCEFILE</code> for each
+<code>.c</code> file that is newer than the corresponding
+<code>.o</code>, replacing TARGETFILE with the absolute filename of
+the <code>.o</code> and SOURCEFILE with the absolute name of the
+<code>.c</code> file.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/available.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/available.html
new file mode 100644
index 0000000..b487bf8
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/available.html
@@ -0,0 +1,91 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="available">Available</a></h2>
+<h3>Description</h3>
+<p>Sets a property if a resource is available at runtime. This resource can be a
+file resource, a class in classpath or a JVM system resource.</p>
+<p>If the resource is present, the property value is set to true by
+default, otherwise the property is not set. You can set the value to
+something specific by using the value attribute.</p>
+<p>Normally, this task is used to set properties that are useful to avoid target
+execution depending on system parameters.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">property</td>
+    <td valign="top">the name of the property to set.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">the value to set the property to. Defaults to &quot;true&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classname</td>
+    <td valign="top">the class to look for in classpath.</td>
+    <td valign="middle" align="center" rowspan="3">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">resource</td>
+    <td valign="top">the resource to look for in the JVM</td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the file to look for.</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td> <td valign="top">the classpath to
+      use when looking up <code>classname</code>.</td> <td
+    align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+	<td valign="top">the classpath to use, given as <a href="../using.html#references">reference</a> to a path defined elsewhere.</td>
+    <td align="center" valign="top">No</td>    
+  </tr>
+  
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>classpath</h4>
+<p><code>Available</code>'s <i>classpath</i> attribute is a <a
+href="../using.html#path">path-like structure</a> and can also be set via a nested
+<i>classpath</i> element.</p>
+<h3>Examples</h3>
+<pre>  &lt;available classname=&quot;org.whatever.Myclass&quot; property=&quot;Myclass.present&quot;/&gt;</pre>
+<p>sets the property <code><i>Myclass.present</i></code> to the value &quot;true&quot;
+if the class <i>org.whatever.Myclass</i> is found in Ant's classpath.</p>
+<pre>
+&lt;property name=&quot;jaxp.jar&quot; value=&quot;./lib/jaxp11/jaxp.jar&quot;/&gt;
+&lt;available file=&quot;${jaxp.jar}&quot; property=&quot;jaxp.jar.present&quot;/&gt;
+</pre>
+<p>sets the property <code><i>jaxp.jar.present</i></code> to the value &quot;true&quot;
+if the file <i>./lib/jaxp11/jaxp.jar</i> is found.</p>
+<pre>
+...in project ...
+&lt;property name=&quot;jaxp.jar&quot; value=&quot;./lib/jaxp11/jaxp.jar&quot;/&gt;
+&lt;path id=&quot;jaxp&quot; location=&quot;${jaxp.jar}&quot;/&gt;
+...in target ...
+&lt;available classname=&quot;javax.xml.transform.Transformer&quot; classpathref=&quot;jaxp&quot; property=&quot;jaxp11.present&quot;/&gt;
+</pre>
+<p>sets the property <code><i>jaxp11.present</i></code> to the value &quot;true&quot;
+if the class <i>javax.xml.transform.Transformer</i> is found in the classpath referenced by <code>jaxp</code> (in this case, it is <code>./lib/jaxp11/jaxp.jar</code>).
+</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/chmod.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/chmod.html
new file mode 100644
index 0000000..918cd2d
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/chmod.html
@@ -0,0 +1,122 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="chmod">Chmod</a></h2>
+<h3>Description</h3>
+<p>Changes the permissions of a file or all files inside specified directories. Right now it has effect only under Unix.
+The permissions are also UNIX style, like the argument for the chmod command.</p>
+<p>See the section on <a href="../dirtasks.html#directorybasedtasks">directory based
+tasks</a>, on how the inclusion/exclusion of files works, and how to
+write patterns.</p>
+<p>This task holds an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all of FileSet's attributes and nested elements
+directly. More FileSets can be specified using nested
+<code>&lt;fileset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the file or single directory of which the permissions 
+      must be changed.</td>
+    <td valign="top" valign="middle" rowspan="2">exactly one of the two or nested <code>&lt;fileset&gt;</code> elements.</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory which holds the files whose permissions 
+      must be changed.</td>
+  </tr>
+  <tr>
+    <td valign="top">perm</td>
+    <td valign="top">the new permissions.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">parallel</td>
+    <td valign="top">process all specified files using a single
+      <code>chmod</code> command. Defaults to true.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">type</td>
+    <td valign="top">One of <i>file</i>, <i>dir</i> or
+      <i>both</i>. If set to <i>file</i>, only the permissions of
+      plain files are going to be changed. If set to <i>dir</i>, only
+      the directories are considered.</td>
+    <td align="center" valign="top">No, default is <i>file</i></td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;chmod file=&quot;${dist}/start.sh&quot; perm=&quot;ugo+rx&quot;/&gt;</code></p>
+</blockquote>
+<p>makes the &quot;start.sh&quot; file readable and executable for anyone on a
+UNIX system.</p>
+<blockquote>
+<pre>
+    &lt;chmod dir=&quot;${dist}/bin&quot; perm=&quot;ugo+rx&quot; includes=&quot;**/*.sh&quot;/&gt;
+</pre>
+</blockquote>
+<p>makes all &quot;.sh&quot; files below <code>${dist}/bin</code>
+readable and executable for anyone on a UNIX system.</p>
+<blockquote>
+<pre>
+&lt;chmod perm=&quot;g+w&quot;&gt;
+  &lt;fileset dir=&quot;shared/sources1&quot;&gt;
+    &lt;exclude name=&quot;**/trial/**&quot;/&gt;
+  &lt;/fileset&gt;
+  &lt;fileset refid=&quot;other.shared.sources&quot;/&gt;
+&lt;/chmod&gt;
+</pre>
+</blockquote>
+<p>makes all files below <code>shared/sources1</code> (except those
+below any directory named trial) writable for members of the same
+group on a UNIX system. In addition all files belonging to a FileSet
+with <code>id</code> <code>other.shared.sources</code> get the same
+permissions.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/copy.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copy.html
new file mode 100644
index 0000000..65a2a8d
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copy.html
@@ -0,0 +1,121 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="copy">Copy</a></h2>
+<h3>Description</h3>
+<p>Copies a file or Fileset to a new file or directory.  Files are
+only copied if the source file is newer than the destination file,
+or when the destination file does not exist.  However, you can explicitly 
+overwrite files with the <var>overwrite</var> attribute.</p>
+<p><a href="../CoreTypes/fileset.html">FileSet</a>s are used to select files to copy.  
+To use a fileset, the <var>todir</var> attribute must be set.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">The file to copy.</td>
+    <td valign="top" align="center">One of either <var>file</var> or 
+    at least one nested fileset element.</td>
+  </tr>
+  <tr>
+    <td valign="top">preservelastmodified</td>
+    <td valign="top">Give the copied files the same last modified
+      time as the original files. Defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">tofile</td>
+    <td valign="top">The file to copy to.</td>
+    <td valign="top" align="center" rowspan="2">With the <var>file</var> attribute, 
+    either <var>tofile</var> or <var>todir</var> can be used.  With nested filesets, 
+    only <var>todir</var> is allowed.</td>
+  </tr>
+  <tr>
+    <td valign="top">todir</td>
+    <td valign="top">The directory to copy to.</td>
+  </tr>
+  <tr>
+    <td valign="top">overwrite</td>
+    <td valign="top">Overwrite existing files even if the destination
+      files are newer. Defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">filtering</td>
+    <td valign="top">Indicates whether token filtering should take place during
+      the copy. Defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">flatten</td>
+    <td valign="top">Ignore directory structure of source directory,
+      copy all files into a single directory, specified by the <var>todir</var>
+      attribute. Defaults to &quot;no&quot;. Note that you can achieve the 
+      same effect by using a <a href="../CoreTypes/mapper.html#flatten-mapper">flatten mapper</a></td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includeEmptyDirs</td>
+	 <td valign="top">Copy empty directories included with the nested FileSet(s).
+	   Defaults to &quot;yes&quot;.</td>
+	 <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>mapper</h4>
+<p>You can define file name transformations by using a nested <a
+href="../CoreTypes/mapper.html">mapper</a> element. The default mapper used by
+<code>&lt;copy&gt;</code> is the <a
+href="../CoreTypes/mapper.html#identity-mapper">identity</a>.</p>
+<h3>Examples</h3>
+<p><b>Copy a single file</b></p>
+<pre>
+  &lt;copy file=&quot;myfile.txt&quot; tofile=&quot;mycopy.txt&quot;/&gt;
+</pre>
+<p><b>Copy a file to a directory</b></p>
+<pre>
+  &lt;copy file=&quot;myfile.txt&quot; todir=&quot;../some/dir/tree&quot;/&gt;
+</pre>
+<p><b>Copy a directory to another directory</b></p>
+<pre>
+  &lt;copy todir=&quot;../new/dir&quot;&gt;
+    &lt;fileset dir=&quot;src_dir&quot;/&gt;
+  &lt;/copy&gt;
+</pre>
+<p><b>Copy a set of files to a directory</b></p>
+<pre>
+  &lt;copy todir=&quot;../dest/dir&quot; &gt;
+    &lt;fileset dir=&quot;src_dir&quot &gt;
+      &lt;exclude name=&quot;**/*.java&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/copy&gt;
+
+  &lt;copy todir=&quot;../dest/dir&quot; &gt;
+    &lt;fileset dir=&quot;src_dir&quot excludes=&quot;**/*.java&quot;/&gt;
+  &lt;/copy&gt;
+</pre>
+<p><b>Copy a set of files to a directory appending
+&quot;<code>.bak</code>&quot; to the file name on the fly</b></p>
+<pre>
+  &lt;copy todir=&quot;../backup/dir&quot; &gt;
+    &lt;fileset dir=&quot;src_dir&quot /&gt;
+    &lt;mapper type=&quot;glob&quot; from=&quot;*&quot; to=&quot;*.bak&quot;/&gt;
+  &lt;/copy&gt;
+</pre>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/copydir.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copydir.html
new file mode 100644
index 0000000..d57bfeb
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copydir.html
@@ -0,0 +1,120 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="copydir">Copydir</a></h2>
+<h3><i>Deprecated</i></h3>
+<p><i>This task has been deprecated.  Use the Copy task instead.</i></p>
+<h3>Description</h3>
+<p>Copies a directory tree from the source to the destination.</p>
+<p>It is possible to refine the set of files that are being copied. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>src</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">the directory to copy.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the directory to copy to.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">filtering</td>
+    <td valign="top">indicates whether token filtering should take place during
+      the copy</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">flatten</td>
+    <td valign="top">ignore directory structure of source directory,
+      copy all files into a single directory, specified by the <code>dest</code>
+      attribute (default is <code>false</code>).</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">forceoverwrite</td>
+    <td valign="top">overwrite existing files even if the destination
+      files are newer (default is false).</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;copydir src=&quot;${src}/resources&quot;
+           dest=&quot;${dist}&quot;
+  /&gt;</pre>
+<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>.</p>
+<pre>  &lt;copydir src=&quot;${src}/resources&quot;
+           dest=&quot;${dist}&quot;
+           includes=&quot;**/*.java&quot;
+           excludes=&quot;**/Test.java&quot;
+  /&gt;</pre>
+<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>
+recursively. All java files are copied, except for files with the name <code>Test.java</code>.</p>
+<pre>  &lt;copydir src=&quot;${src}/resources&quot;
+           dest=&quot;${dist}&quot;
+           includes=&quot;**/*.java&quot;
+           excludes=&quot;mypackage/test/**&quot;/&gt;</pre>
+<p>copies the directory <code>${src}/resources</code> to <code>${dist}</code>
+recursively. All java files are copied, except for the files under the <code>mypackage/test</code>
+directory.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/copyfile.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copyfile.html
new file mode 100644
index 0000000..129cfad
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/copyfile.html
@@ -0,0 +1,59 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="copyfile">Copyfile</a></h2>
+<h3><i>Deprecated</i></h3>
+<p><i>This task has been deprecated.  Use the Copy task instead.</i></p>
+<h3>Description</h3>
+<p>Copies a file from the source to the destination. The file is only copied if
+the source file is newer than the destination file, or when the destination file
+does not exist.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">the filename of the file to copy.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the filename of the file where to copy to.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">filtering</td>
+    <td valign="top">indicates whether token filtering should take place during
+      the copy</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">forceoverwrite</td>
+    <td valign="top">overwrite existing files even if the destination
+      files are newer (default is false).</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;copyfile src=&quot;test.java&quot; dest=&quot;subdir/test.java&quot;
+  /&gt;</code></p>
+  <p><code>&lt;copyfile src=&quot;${src}/index.html&quot; dest=&quot;${dist}/help/index.html&quot;
+  /&gt;</code></p>
+</blockquote>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/cvs.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/cvs.html
new file mode 100644
index 0000000..8b26e86
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/cvs.html
@@ -0,0 +1,97 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="cvs">Cvs</a></h2>
+<h3>Description</h3>
+<p>Handles packages/modules retrieved from a 
+<a href="http://www.cvshome.org/" target="_top">CVS</a> repository.</p>
+<p>When doing automated builds, the <a href="get.html">get task</a> should be
+preferred over the <i>checkout</i> command, because of speed.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">command</td>
+    <td valign="top">the CVS command to execute.</td>
+    <td align="center" valign="top">No, default &quot;checkout&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">cvsRoot</td>
+    <td valign="top">the CVSROOT variable.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the directory where the checked out files should be placed.</td>
+    <td align="center" valign="top">No, default is project's basedir.</td>
+  </tr>
+  <tr>
+    <td valign="top">package</td>
+    <td valign="top">the package/module to check out.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">tag</td>
+    <td valign="top">the tag of the package/module to check out.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">date</td>
+    <td valign="top">Use the most recent revision no later than the given date</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">quiet</td>
+    <td valign="top">suppress informational messages.</td>
+    <td align="center" valign="top">No, default &quot;false&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">noexec</td>
+    <td valign="top">report only, don't change any files.</td>
+    <td align="center" valign="top">No, default &quot;false&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">the file to direct standard output from the command.</td>
+    <td align="center" valign="top">No, default output to ANT Log as MSG_INFO.</td>
+  </tr>
+  <tr>
+    <td valign="top">error</td>
+    <td valign="top">the file to direct standard error from the command.</td>
+    <td align="center" valign="top">No, default error to ANT Log as MSG_WARN.</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;cvs cvsRoot=&quot;:pserver:anoncvs@jakarta.apache.org:/home/cvspublic&quot;
+       package=&quot;jakarta-tools&quot;
+       dest=&quot;${ws.dir}&quot;
+  /&gt;</pre>
+<p>checks out the package/module &quot;jakarta-tools&quot; from the CVS
+repository pointed to by the cvsRoot attribute, and stores the files in &quot;${ws.dir}&quot;.</p>
+<pre>  &lt;cvs dest=&quot;${ws.dir}&quot; command=&quot;update&quot;/&gt;</pre>
+<p>updates the package/module that has previously been checked out into
+&quot;${ws.dir}&quot;.</p>
+<pre>  &lt;cvs command=&quot;-q diff -u -N&quot; output=&quot;patch.txt&quot;/&gt;</pre>
+<p>silently (-q) creates a file called patch.txt which contains a unified (-u) diff which includes new files added via &quot;cvs add&quot; (-N) and can be used as input to patch.</p>
+<pre>  &lt;cvs command=&quot;update -A -d&quot;/&gt;</pre>
+<p>Updates from the head of repository ignoring sticky bits (-A) and creating any new directories as necessary (-d).</p>
+<p>Note: the text of the command is passed to cvs &quot;as-is&quot; so any cvs options should appear 
+before the command, and any command options should appear after the command as in the diff example 
+above. See <a href="http://www.cvshome.org/docs/manual/index.html" target="_top">the cvs manual</a> for details, 
+specifically the <a href="http://www.cvshome.org/docs/manual/cvs_16.html" target="_top">Guide to CVS commands</a></p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/delete.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/delete.html
new file mode 100644
index 0000000..5633251
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/delete.html
@@ -0,0 +1,110 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="delete">Delete</a></h2>
+<h3>Description</h3>
+<p>Deletes either a single file, all files in a specified directory and its 
+sub-directories, or a set of files specified by one or more <a href="../CoreTypes/fileset.html">FileSet</a>s.
+When specifying a set of files, empty directories are <i>not</i> removed by default.
+To remove empty directories, use the <em>includeEmptyDirs</em> atribute.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">The file to delete.</td>
+    <td align="center" valign="middle" rowspan="2">at least one of the two</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">The directory to delete files from.</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">Show name of each deleted file (&quot;true&quot;/&quot;false&quot;).
+	 Default is &quot;false&quot; when omitted.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">quiet</td>
+    <td valign="top">If the file does not exist, do not display a diagnostic 
+     message or modify the exit status to reflect an error.
+     This means that if a file or directory cannot be deleted,
+     then no error is reported. This setting emulates the 
+     -f option to the Unix &quot;rm&quot; command.
+    (&quot;true&quot;/&quot;false&quot;).
+	 Default is &quot;false&quot; meaning things are &quot;noisy&quot;.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includeEmptyDirs</td>
+    <td valign="top">Set to &quot;true&quot; to delete empty directories when
+    using filesets.  Default is &quot;false&quot;.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top"><i>Deprecated.</i>  Comma separated list of patterns of files that must be
+      deleted. All files are in the current directory 
+      and any sub-directories are deleted when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top"><i>Deprecated.</i>  The name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top"><i>Deprecated.</i>  Comma separated list of patterns of files that must be
+      excluded from the deletion list. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top"><i>Deprecated.</i>  The name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top"><i>Deprecated.</i>  Indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;delete file=&quot;/lib/ant.jar&quot;/&gt;</pre>
+<p>deletes the file <code>/lib/ant.jar</code>.</p>
+<pre>  &lt;delete dir=&quot;lib&quot;/&gt;</pre>
+<p>deletes the <code>lib</code> directory, including all files 
+and subdirectories of <code>lib</code>.</p>
+<pre>  &lt;delete&gt;
+    &lt;fileset dir=&quot;.&quot; includes=&quot;**/*.bak&quot;/&gt;
+  &lt;/delete&gt;
+</pre>
+<p>deletes all files with the extension &quot;<code>.bak</code>&quot from the current directory 
+and any sub-directories.</p>
+<pre>  &lt;delete includeEmptyDirs=&quot;true&quot; &gt;
+    &lt;fileset dir=&quot;build&quot; /&gt;
+  &lt;/delete&gt;
+</pre>
+<p>deletes all files and subdirectories of <code>build</code>, but not
+<code>build</code> itself.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/deltree.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/deltree.html
new file mode 100644
index 0000000..576b769
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/deltree.html
@@ -0,0 +1,40 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="deltree">Deltree</a></h2>
+<h3><i>Deprecated</i></h3>
+<p><i>This task has been deprecated.  Use the Delete task instead.</i></p>
+<h3>Description</h3>
+<p>Deletes a directory with all its files and subdirectories.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory to delete.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;deltree dir=&quot;dist&quot;/&gt;</pre>
+<p>deletes the directory <code>dist</code>, including its files and
+subdirectories.</p>
+<pre>  &lt;deltree dir=&quot;${dist}&quot;/&gt;</pre>
+<p>deletes the directory <code>${dist}</code>, including its files and
+subdirectories.</p>
+<hr><p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/echo.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/echo.html
new file mode 100644
index 0000000..49510f7
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/echo.html
@@ -0,0 +1,51 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="echo">Echo</a></h2>
+<h3>Description</h3>
+<p>Echoes a message to System.out or a file.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">message</td>
+    <td valign="top">the message to echo.</td>
+    <td valign="top" align="center">Yes, unless data is included in a
+      character section within this element.</td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the file to write the message to.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">append</td>
+    <td valign="top">Append to an existing file?</td>
+    <td valign="top" align="center">No &#150; default is false.</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;echo message=&quot;Hello world&quot;/&gt;</pre>
+<pre>  
+&lt;echo&gt;
+This is a longer message stretching over
+two lines.
+&lt;/echo&gt;
+</pre>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/exec.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/exec.html
new file mode 100644
index 0000000..1f029ef
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/exec.html
@@ -0,0 +1,144 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="exec">Exec</a></h2>
+<h3>Description</h3>
+<p>Executes a system command. When the <i>os</i> attribute is specified, then
+the command is only executed when Ant is run on one of the specified operating
+systems.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">command</td>
+    <td valign="top">the command to execute with all command line
+      arguments. <b>deprecated, use executable and nested
+      <code>&lt;arg&gt;</code> elements instead</b>.</td>
+    <td align="center" rowspan="2">Exactly one of the two.</td>
+  </tr>
+  <tr>
+    <td valign="top">executable</td>
+    <td valign="top">the command to execute without any command line
+      arguments.</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory in which the command should be executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">os</td>
+    <td valign="top">list of Operating Systems on which the command may be
+      executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">the file to which the output of the command should be
+      redirected.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">timeout</td>
+    <td valign="top">Stop the command if it doesn't finish within the
+      specified time (given in milliseconds).</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td>
+    <td valign="top">Stop the buildprocess if the command exits with a
+      returncode other than 0.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">newenvironment</td>
+    <td valign="top">Do not propagate old environment when new environment
+      variables are specified.</td>
+    <td align="center" valign="top">No, default is <i>false</i></td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;exec dir=&quot;${src}&quot; executable=&quot;cmd.exe&quot; os=&quot;Windows 2000&quot; output=&quot;dir.txt&quot;&gt;
+  &lt;arg line=&quot;/c dir&quot;/&gt;
+&lt;/exec&gt;</pre>
+</blockquote>
+<h3>Parameters specified as nested elements</h3>
+<h4>arg</h4>
+<p>Command line arguments should be specified as nested
+<code>&lt;arg&gt;</code> elements. See <a
+href="../using.html#arg">Command line arguments</a>.</p>
+<h4><a name="env">env</a></h4>
+<p>It is possible to specify environment variables to pass to the
+system command via nested <code>&lt;env&gt;</code> elements.</p>
+<p>Please note that the environment of the current Ant process is
+<b>not</b> passed to the system command if you specify variables using
+<code>&lt;env&gt;</code>.</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">key</td>
+    <td valign="top">The name of the environment variable.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">The literal value for the environment variable.</td>
+    <td align="center" rowspan="3">Exactly one of these.</td>
+  </tr>
+  <tr>
+    <td valign="top">path</td>
+    <td valign="top">The value for a PATH like environment
+      variable. You can use ; or : as path separators and Ant will
+      convert it to the platform's local conventions.</td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">The value for the environment variable. Will be
+      replaced by the absolute filename of the file by Ant.</td>
+  </tr>
+</table>
+<h5>Examples</h5>
+<blockquote><pre>
+&lt;exec executable=&quot;emacs&quot; &gt;
+  &lt;env key=&quot;DISPLAY&quot; value=&quot;:1.0&quot;/&gt;
+&lt;/exec&gt;
+</pre></blockquote>
+<p>starts <code>emacs</code> on display 1 of the X Window System.</p>
+<blockquote><pre>
+&lt;exec ... &gt;
+  &lt;env key=&quot;PATH&quot; path=&quot;${java.library.path}:${basedir}/bin&quot;/&gt;
+&lt;/exec&gt;
+</pre></blockquote>
+<p>adds <code>${basedir}/bin</code> to the <code>PATH</code> of the
+system command.</p>
+<p><b>Note:</b> Although it may work for you to specify arguments using 
+a simple arg-element and separate them by spaces it may fail if you switch to
+a newer version of the JDK. JDK &lt; 1.2 will pass these as separate arguments
+to the program you are calling, JDK &gt;= 1.2 will pass them as a single 
+argument and cause most calls to fail.</p>
+<p><b>Note2:</b> If you are using Ant on Windows and a new DOS-Window pops up
+for every command which is executed this may be a problem of the JDK you are using.
+This problem may occur with all JDK's &lt; 1.2.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/execon.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/execon.html
new file mode 100644
index 0000000..124097e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/execon.html
@@ -0,0 +1,138 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="execon">ExecOn</a></h2>
+<h3>Description</h3>
+<p>Executes a system command. When the <i>os</i> attribute is specified, then
+the command is only executed when Ant is run on one of the specified operating
+systems.</p>
+<p>The files and/or directories of a number of <a
+href="../CoreTypes/fileset.html">FileSet</a>s are passed as arguments to the system
+command. At least one nested <code>&lt;fileset&gt;</code> is required.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">executable</td>
+    <td valign="top">the command to execute without any command line
+      arguments.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory in which the command should be executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">os</td>
+    <td valign="top">list of Operating Systems on which the command may be
+      executed.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">the file to which the output of the command should be
+      redirected.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">timeout</td>
+    <td valign="top">Stop the command if it doesn't finish within the
+      specified time (given in milliseconds).</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td>
+    <td valign="top">Stop the buildprocess if the command exits with a
+      returncode other than 0.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">newenvironment</td>
+    <td valign="top">Do not propagate old environment when new environment
+      variables are specified.</td>
+    <td align="center" valign="top">No, default is <i>false</i></td>
+  </tr>
+  <tr>
+    <td valign="top">parallel</td>
+    <td valign="top">Run the command only once, appending all files as
+      arguments. If false, command will be executed once for every file. 
+      Defaults to false. </td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">type</td>
+    <td valign="top">One of <i>file</i>, <i>dir</i> or
+      <i>both</i>. If set to <i>file</i>, only the names of plain
+      files will be sent to the command. If set to <i>dir</i>, only
+      the names of directories are considered.</td>
+    <td align="center" valign="top">No, default is <i>file</i></td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>fileset</h4>
+<p>You can use any number of nested <code>&lt;fileset&gt;</code>
+elements to define the files for this task and refer to
+<code>&lt;fileset&gt;</code>s defined elsewhere.</p>
+<h4>arg</h4>
+<p>Command line arguments should be specified as nested
+<code>&lt;arg&gt;</code> elements. See <a
+href="../using.html#arg">Command line arguments</a>.</p>
+<h4>srcfile</h4>
+<p>By default the file names of the source files will be added to the
+end of the command line. If you need to place it somewhere different,
+use a nested <code>&lt;srcfile&gt;</code> element between your
+<code>&lt;arg&gt;</code> elements to mark the insertion point.</p>
+<h4>env</h4>
+<p>It is possible to specify environment variables to pass to the
+system command via nested <code>&lt;env&gt;</code> elements. See the
+description in the section about <a href="exec.html#env">exec</a></p>
+<p>Please note that the environment of the current Ant process is
+<b>not</b> passed to the system command if you specify variables using
+<code>&lt;env&gt;</code>.</p>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;execon executable=&quot;ls&quot; &gt;
+  &lt;arg value=&quot;-l&quot;/&gt;
+  &lt;fileset dir=&quot;/tmp&quot;&gt;
+    &lt;patternset&gt;
+      &lt;exclude name=&quot;**/*.txt&quot;/&gt;
+    &lt;/patternset&gt;
+  &lt;/fileset&gt;
+  &lt;fileset refid=&quot;other.files&quot;/&gt;
+&lt;/execon&gt;
+</pre></blockquote>
+<p>invokes <code>ls -l</code>, adding the absolute filenames of all
+files below <code>/tmp</code> not ending in <code>.txt</code> and all
+files of the FileSet with <code>id</code> <code>other.files</code> to
+the command line.</p>
+<blockquote><pre>
+&lt;execon executable=&quot;somecommand&quot; parallel=&quot;false&quot; &gt;
+  &lt;arg value=&quot;arg1&quot;/&gt;
+  &lt;srfile/&gt;
+  &lt;arg value=&quot;arg2&quot;/&gt;
+  &lt;fileset dir=&quot;/tmp&quot;/&gt;
+&lt;/execon&gt;
+</pre></blockquote>
+<p>invokes <code>somecommand arg1 SOURCEFILENAME arg2</code> for each
+file in <code>/tmp</code> replacing SOURCEFILENAME with the absolute
+filename of each file in turn. If <code>parallel</code> had been set
+to true, SOURCEFILENAME would be replaced with the absolute filenames
+of all files separated by spaces.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/fail.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/fail.html
new file mode 100644
index 0000000..3fc7681
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/fail.html
@@ -0,0 +1,50 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="fail">Fail</a></h2>
+<h3>Description</h3>
+<p>Exits the current build (just throwing a BuildException), optionally printing additional information.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">message</td>
+    <td valign="top">A message giving further information on why the build exited</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;fail/&gt;</pre>
+<p>will exit the current build with no further information given.</p>
+<pre>
+BUILD FAILED
+
+build.xml:4: No message
+</pre>
+
+<pre>  &lt;fail message=&quot;Something wrong here.&quot;/&gt;</pre>
+<p>will exit the current build and print something like the following to wherever
+your output goes:</p>
+<pre>
+BUILD FAILED
+
+build.xml:4: Something wrong here.
+</pre>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/filter.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/filter.html
new file mode 100644
index 0000000..f9ffed5
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/filter.html
@@ -0,0 +1,63 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="filter">Filter</a></h2>
+<h3>Description</h3>
+<p>Sets a token filter for this project or read multiple token filter from
+an input file and sets these as filters.
+Token filters are used by all tasks that perform file copying operations
+through the Project commodity methods.</p>
+<p>Note 1: the token string must not contain the separators chars (@).<br>
+Note 2: Either token and value attributes must be provided, or only the
+filtersfile attribute.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">token</td>
+    <td valign="top">the token string without @</td>
+    <td align="center" valign="top">Yes*</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">the string that should be put to replace the token when the 
+      file is copied</td>
+    <td align="center" valign="top">Yes*</td>
+  </tr>
+  <tr>
+    <td valign="top">filtersfile</td>
+    <td valign="top">The file from which the filters must be read. This file must be a formatted as a property file. </td>
+    <td align="center" valign="top">Yes*</td>
+  </tr>
+</table>
+<p>* see notes 1 and 2 above parameters table.</p>
+<h3>Examples</h3>
+<pre>  &lt;filter token=&quot;year&quot; value=&quot;2000&quot;/&gt;
+  &lt;copy todir=&quot;${dest.dir}&quot; filtering=&quot;true&quot;&gt;
+    &lt;fileset dir=&quot;${src.dir}&quot;/&gt;
+  &lt;/copy&gt;</pre> 
+<p>will copy recursively all the files from the <i>src.dir</i> directory into
+the <i>dest.dir</i> directory replacing all the occurences of the string <i>@year@</i>
+with <i>2000.</i></p>
+<pre>  &lt;filter filtersfile=&quot;deploy_env.properties&quot;/&gt;</pre>
+will read all property entries from the <i>deploy_env.properties</i> file
+and set these as filters.
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/fixcrlf.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/fixcrlf.html
new file mode 100644
index 0000000..287ad0e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/fixcrlf.html
@@ -0,0 +1,168 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="fixcrlf">FixCRLF</a></h2>
+<h3>Description</h3>
+<p>Adjusts a text file to local.</p>
+<p>It is possible to refine the set of files that are being adjusted. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">Where to find the files to be fixed up.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">destDir</td>
+    <td valign="top">Where to place the corrected files.  Defaults to
+      srcDir (replacing the original file)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">cr</td>
+    <td valign="top">Specifies how carriage return (CR) characters are to
+      be handled.  Valid values for this property are:
+      <ul>
+      <li>add: ensure that there is a CR before every LF</li>
+      <li>asis: leave CR characters alone</li>
+      <li>remove: remove all CR characters</li>
+      </ul>
+      Default is based on the platform on which you are running this task.
+      For Unix platforms, the default is remove.  For DOS based systems
+      (including Windows), the default is add.
+      <p>
+      Note: Unless this property is specified as &quot;asis&quot;, extra CR characters
+      which do not precede a LF will be removed.</p>
+      </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">tab</td>
+    <td valign="top">Specifies how tab characters are to be handled.  Valid
+      values for this property are:
+      <ul>
+      <li>add: convert sequences of spaces which span a tab stop to tabs</li>
+      <li>asis: leave tab and space characters alone</li>
+      <li>remove: convert tabs to spaces</li>
+      </ul>
+      Default for this parameter is &quot;asis&quot;.
+      <p>
+      Note: Unless this property is specified as &quot;asis&quot;, extra spaces and
+      tabs after the last non-whitespace character on the line will be removed.</p>
+      </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">tablength</td>
+    <td valign="top">The number of characters a TAB stop corresponds to. 
+      Must be a positive power of 2, default for this parameter is 8.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">eof</td>
+    <td valign="top">Specifies how DOS end of file (control-Z) characters are
+      to be handled.  Valid values for this property are:
+      <ul>
+      <li>add: ensure that there is an EOF character at the end of the file</li>
+      <li>asis: leave EOF characters alone</li>
+      <li>remove: remove any EOF character found at the end</li>
+      </ul>
+      Default is based on the platform on which you are running this task.
+      For Unix platforms, the default is remove.  For DOS based systems
+      (including Windows), the default is asis.
+      </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
+       cr=&quot;remove&quot; eof=&quot;remove&quot;
+       includes=&quot;**/*.sh&quot;
+  /&gt;</pre>
+<p>Removes carriage return and eof characters from the shell scripts.  Tabs and
+spaces are left as is.</p>
+<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
+       cr=&quot;add&quot;
+       includes=&quot;**/*.bat&quot;
+  /&gt;</pre>
+<p>Ensures that there are carriage return characters prior to evey line feed.
+Tabs and spaces are left as is.
+EOF characters are left alone if run on
+DOS systems, and are removed if run on Unix systems.</p>
+<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
+       tabs=&quot;add&quot;
+       includes=&quot;**/Makefile&quot;
+  /&gt;</pre>
+<p>Adds or removes CR characters to match local OS conventions, and
+converts spaces to tabs when appropriate.  EOF characters are left alone if
+run on DOS systems, and are removed if run on Unix systems.
+Many versions of make require tabs prior to commands.</p>
+<pre>  &lt;fixcrlf srcdir=&quot;${src}&quot;
+       tabs=&quot;remove&quot;
+       includes=&quot;**/README*&quot;
+  /&gt;</pre>
+<p>Adds or removes CR characters to match local OS conventions, and
+converts all tabs to spaces.  EOF characters are left alone if run on
+DOS systems, and are removed if run on Unix systems.
+You never know what editor a user will use to browse README's.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/genkey.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/genkey.html
new file mode 100644
index 0000000..8559834
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/genkey.html
@@ -0,0 +1,103 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="genkey">GenKey</a></h2>
+<h3>Description</h3>
+<p>Generates a key in keystore.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">alias</td>
+    <td valign="top">the alias to add under</td>
+    <td valign="top" align="center">Yes.</td>
+  </tr>
+  <tr>
+    <td valign="top">storepass</td>
+    <td valign="top">password for keystore integrity.</td>
+    <td valign="top" align="center">Yes.</td>
+  </tr>
+  <tr>
+    <td valign="top">keystore</td>
+    <td valign="top">keystore location</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">storetype</td>
+    <td valign="top">keystore type</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keypass</td>
+    <td valign="top">password for private key (if different)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sigalg</td>
+    <td valign="top">the algorithm to use in signing</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keyalg</td>
+    <td valign="top">the method to use when generating name-value pair</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">(true | false) verbose output when signing</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">dname</td>
+    <td valign="top">The distinguished name for entity</td>
+    <td valign="top" align="center">Yes if dname element unspecified</td>
+  </tr>
+  <tr>
+    <td valign="top">validity</td>
+    <td valign="top">(integer) indicates how many days certificate is valid</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keysize</td>
+    <td valign="top">(integer) indicates the size of key generated</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<p>Alternatively you can specify the distinguished name by creating a sub-element named dname and populating it with param elements that have a name and a value. When using the subelement it is automatically encoded properly and , are replace</p>
+<p>The following two examples are identical: </p>
+
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;genkey alias=&quot;apache-group&quot; storepass=&quot;secret&quot; 
+  dname=&quot;CN=Ant Group, OU=Jakarta Division, O=Apache.org, C=US&quot;/&gt;</code></p>
+</blockquote>
+
+<blockquote>
+  <pre><code>&lt;genkey alias=&quot;apache-group&quot; storepass=&quot;secret&quot; &gt;
+  &lt;dname&gt;
+    &lt;param name=&quot;CN&quot; value=&quot;Ant Group&quot;/&gt;
+    &lt;param name=&quot;OU&quot; value=&quot;Jakarta Division&quot;/&gt;
+    &lt;param name=&quot;O&quot;  value=&quot;Apache.Org&quot;/&gt;
+    &lt;param name=&quot;C&quot;  value=&quot;US&quot;/&gt;
+  &lt;/dname&gt;
+&lt;/genkey&gt;</code></pre>
+</blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/get.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/get.html
new file mode 100644
index 0000000..7337de5
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/get.html
@@ -0,0 +1,77 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="get">Get</a></h2>
+<h3>Description</h3>
+<p>Gets a file from a URL. When the verbose option is &quot;on&quot;, this task
+displays a '.' for every 100 Kb retrieved.</p>
+<p>This task should be preferred above the <a href="cvs.html">CVS task</a> when
+doing automated builds. CVS is significantly slower than loading a compressed
+archive with http/ftp.</p>
+
+The <i>usetimestamp</i> option enables you to control downloads so that the remote file is
+only fetched if newer than the local copy. If there is no local copy, the download always takes 
+place. When a file is downloaded, the timestamp of the downloaded file is set to the remote timestamp,
+if  the JVM is Java1.2 or later. 
+NB: This timestamp facility only works on downloads using the HTTP protocol. 
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">the URL from which to retrieve a file.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the file where to store the retrieved file.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">show verbose progress information (&quot;on&quot;/&quot;off&quot;).</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">ignoreerrors</td>
+    <td valign="top">Log errors but don't treat as fatal.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">usetimestamp</td>
+    <td valign="top">conditionally download a file based on the timestamp of the local copy.
+	HTTP only</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;get src=&quot;http://jakarta.apache.org/&quot; dest=&quot;help/index.html&quot;/&gt;</pre>
+<p>Gets the index page of http://jakarta.apache.org/, and stores it in the file <code>help/index.html</code>.</p>
+
+<pre>  &lt;get src=&quot;http://jakarta.apache.org/builds/tomcat/nightly/ant.zip&quot; 
+	dest=&quot;optional.jar&quot; 
+	verbose=&quot;true&quot;
+	usetimestamp=&quot;true&quot;/&gt;</pre>
+<p>
+Gets the nightly ant build from the tomcat distribution, if the local copy
+is missing or out of date. Uses the verbose option 
+for progress information.
+</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/gunzip.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/gunzip.html
new file mode 100644
index 0000000..b18fcd6
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/gunzip.html
@@ -0,0 +1,59 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="gunzip">GUnzip</a></h2>
+<h3>Description</h3>
+<p>Expands a GZip file.</p>
+
+<p>If <i>dest</i> is a directory the name of the destination file is
+the same as <i>src</i> (with the &quot;.gz&quot; extension removed if
+present). If <i>dest</i> is omitted, the parent dir of <i>src</i> is
+taken. The file is only expanded if the source file is newer than the
+destination file, or when the destination file does not exist.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">the file to expand.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">the destination file or directory.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot;/&gt;</code></p>
+</blockquote>
+<p>expands <i>test.tar.gz</i> to <i>test.tar</i></p>
+<blockquote>
+  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot; dest=&quot;test2.tar&quot;/&gt;</code></p>
+</blockquote>
+<p>expands <i>test.tar.gz</i> to <i>test2.tar</i></p>
+<blockquote>
+  <p><code>&lt;gunzip src=&quot;test.tar.gz&quot; dest=&quot;subdir&quot;/&gt;</code></p>
+</blockquote>
+<p>expands <i>test.tar.gz</i> to <i>subdir/test.tar</i> (assuming
+subdir is a directory).</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/gzip.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/gzip.html
new file mode 100644
index 0000000..9baf72b
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/gzip.html
@@ -0,0 +1,42 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="gzip">GZip</a></h2>
+<h3>Description</h3>
+<p>GZips a file.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">the file to gzip.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">zipfile</td>
+    <td valign="top">the destination file.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;gzip src=&quot;test.tar&quot; zipfile=&quot;test.tar.gz&quot;
+  /&gt;</code></p>
+</blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/jar.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/jar.html
new file mode 100644
index 0000000..516eb77
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/jar.html
@@ -0,0 +1,150 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="jar">Jar</a></h2>
+<h3>Description</h3>
+<p>Jars a set of files.</p>
+<p>The <i>basedir</i> attribute is the reference directory from where to jar.</p>
+<p>Note that file permissions will not be stored in the resulting jarfile.</p>
+<p>It is possible to refine the set of files that are being jarred. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>basedir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<p>You can also use nested file sets for more flexibility, and specify
+multiple ones to merge together different trees of files into one JAR.
+The extended fileset attributes from the zip task are also available
+in the jar task.
+See the <a href="zip.html">Zip</a> task for more details and examples.</p>
+<p>If the manifest is omitted, a simple one will be supplied by Ant.
+You should not include <samp>META-INF/MANIFEST.MF</samp> in your set of files.</p>
+<p>The <code>whenempty</code> parameter controls what happens when no files match.
+If <code>create</code> (the default), the JAR is created anyway with only a manifest.
+If <code>skip</code>, the JAR is not created and a warning is issued.
+If <code>fail</code>, the JAR is not created and the build is halted with an error.</p>
+<p>(The Jar task is a shortcut for specifying the manifest file of a JAR file. 
+The same thing can be accomplished by using the <i>fullpath</i>
+attribute of a zipfileset in a Zip task. The one difference is that if the
+<i>manifest</i> attribute is not specified, the Jar task will 
+include an empty one for you.)</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">jarfile</td>
+    <td valign="top">the jar-file to create.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the directory from which to jar the files.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compress</td>
+    <td valign="top">Not only store data but also compress them, defaults to true</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">manifest</td>
+    <td valign="top">the manifest file to use.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">whenempty</td>
+    <td valign="top">Behavior to use if no files match.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot; basedir=&quot;${build}/classes&quot;/&gt;</pre>
+<p>jars all files in the <code>${build}/classes</code> directory into a file
+called <code>app.jar</code> in the <code>${dist}/lib</code> directory.</p>
+<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;
+       basedir=&quot;${build}/classes&quot;
+       excludes=&quot;**/Test.class&quot;
+  /&gt;</pre>
+<p>jars all files in the <code>${build}/classes</code> directory into a file
+called <code>app.jar</code> in the <code>${dist}/lib</code> directory. Files
+with the name <code>Test.class</code> are excluded.</p>
+<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;
+       basedir=&quot;${build}/classes&quot;
+       includes=&quot;mypackage/test/**&quot;
+       excludes=&quot;**/Test.class&quot;
+  /&gt;</pre>
+<p>jars all files in the <code>${build}/classes</code> directory into a file
+called <code>app.jar</code> in the <code>${dist}/lib</code> directory. Only
+files under the directory <code>mypackage/test</code> are used, and files with
+the name <code>Test.class</code> are excluded.</p>
+<pre>  &lt;jar jarfile=&quot;${dist}/lib/app.jar&quot;&gt;
+    &lt;fileset dir=&quot;${build}/classes&quot;
+             excludes=&quot;**/Test.class&quot;
+    /&gt;
+    &lt;fileset dir=&quot;${src}/resources&quot;/&gt;
+  &lt;/jar&gt;</pre>
+<p>jars all files in the <code>${build}/classes</code> directory and also
+in the <code>${src}/resources</code> directory together into a file
+called <code>app.jar</code> in the <code>${dist}/lib</code> directory.
+Files with the name <code>Test.class</code> are excluded.
+If there are files such as <code>${build}/classes/mypackage/MyClass.class</code>
+and <code>${src}/resources/mypackage/image.gif</code>, they will appear
+in the same directory in the JAR (and thus be considered in the same package
+by Java).</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/java.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/java.html
new file mode 100644
index 0000000..93ffe00
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/java.html
@@ -0,0 +1,135 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="java">Java</a></h2>
+<h3>Description</h3>
+<p>Executes a Java class within the running (Ant) VM or forks another VM if
+specified.</p>
+<p>Be careful that the executed class doesn't call System.exit(), because it
+will terminate the VM and thus Ant. In case this happens, it's highly suggested
+that you set the fork attribute so that System.exit() stops the other VM and not
+the one that is currently running Ant.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">classname</td>
+    <td valign="top">the Java class to execute.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">args</td>
+    <td valign="top">the arguments for the class that is
+      executed. <b>deprecated, use nested <code>&lt;arg&gt;</code>
+      elements instead.</b></td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">the classpath to use.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+    <td valign="top">the classpath to use, given as <a
+      href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">fork</td>
+    <td valign="top">if enabled triggers the class execution in another VM
+      (disabled by default)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">jvm</td>
+    <td valign="top">the command used to invoke the Java Virtual Machine,
+      default is 'java'.  The command is resolved by java.lang.Runtime.exec().
+      Ignored if fork is disabled.
+    </td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">jvmargs</td>
+    <td valign="top">the arguments to pass to the forked VM (ignored
+      if fork is disabled). <b>deprecated, use nested
+      <code>&lt;jvmarg&gt;</code> elements instead.</b></td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">maxmemory</td>
+    <td valign="top">Max amount of memory to allocate to the forked VM
+      (ignored if fork is disabled)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td>
+    <td valign="top">Stop the buildprocess if the command exits with a
+      returncode other than 0. Only available if fork is true.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">The directory to invoke the VM in.  (ignored if
+      fork is disabled)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">output</td>
+    <td valign="top">Name of a file to write the output to.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>arg and jvmarg</h4>
+<p>Use nested <code>&lt;arg&gt;</code> and <code>&lt;jvmarg&gt;</code>
+elements to specify arguments for the or the forked VM. See <a
+href="../using.html#arg">Command line arguments</a>.</p>
+<h4>sysproperty</h4>
+<p>Use nested <code>&lt;sysproperty&gt;</code>
+elements to specify system properties required by the class. 
+These properties will be made available to the VM during the execution
+of the class (either ANT's VM or the forked VM). The attributes
+for this element are the same as for <a href="exec.html#env">environment
+variables</a>.</p>
+<h4>classpath</h4>
+<p><code>Java</code>'s <i>classpath</i> attribute is a <a
+href="../using.html#path">PATH like structure</a> and can also be set via a nested
+<i>classpath</i> element.</p>
+<h5>Example</h5>
+<pre>  
+       &lt;java classname=&quot;test.Main&quot; &gt;
+         &lt;arg value=&quot;-h&quot;/&gt; 
+         &lt;classpath&gt;
+           &lt;pathelement location=&quot;\test.jar&quot;/&gt;
+           &lt;pathelement path=&quot;${java.class.path}&quot;/&gt;
+         &lt;/classpath&gt;
+       &lt;/java&gt;
+</pre>
+<h3>Examples</h3>
+<pre>  &lt;java classname=&quot;test.Main&quot;/&gt;</pre>
+<pre>  &lt;java classname=&quot;test.Main&quot;
+        fork=&quot;yes&quot; &gt;
+    &lt;sysproperty key=&quot;DEBUG&quot; value=&quot;true&quot;/&gt; 
+    &lt;arg value=&quot;-h&quot;/&gt; 
+    &lt;jvmarg value=&quot;-Xrunhprof:cpu=samples,file=log.txt,depth=3&quot;/&gt; 
+  &lt;/java&gt;
+</pre>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/javac.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/javac.html
new file mode 100644
index 0000000..3c3abff
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/javac.html
@@ -0,0 +1,255 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="javac">Javac</a></h2>
+<h3>Description</h3>
+<p>Compiles a source tree within the running (Ant) VM.</p>
+<p>The source and destination directory will be recursively scanned for Java
+source files to compile. Only Java files that have no corresponding class file
+or where the class file is older than the java file will be compiled.</p>
+<p>The directory structure of the source tree should follow the package
+hierarchy.</p>
+<p>It is possible to refine the set of files that are being compiled/copied.
+This can be done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>It is possible to use different compilers. This can be selected with the
+&quot;build.compiler&quot; property. There are four choices:</p>
+<ul>
+  <li>classic (the standard compiler of JDK 1.1/1.2)</li>
+  <li>modern (the new compiler of JDK 1.3)</li>
+  <li>jikes (the <a
+    href="http://oss.software.ibm.com/developerworks/opensource/jikes/project" target="_top">Jikes</a>
+    compiler)</li>
+  <li>jvc (the Command-Line Compiler from Microsoft's SDK for Java /
+    Visual J++)</li>
+</ul>
+<p>For JDK 1.1/1.2, classic is the default. For JDK 1.3, modern is the default.
+If you wish to use a different compiler interface than one of the four
+supplied, write a class that implements the CompilerAdapter interface
+(package org.apache.tools.ant.taskdefs.compilers). Supply the full
+classname in the &quot;build.compiler&quot; property.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">srcdir</td>
+    <td valign="top">location of the java files. (See Notes at the end)</td>
+    <td align="center" valign="top">Yes, unless nested <code>&lt;src&gt;</code> elements are present.</td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">location to store the class files.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      included; all files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file that contains
+      include patterns.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      excluded; no files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file that contains
+      exclude patterns.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used
+      (<code>yes</code> | <code>no</code>); default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">the classpath to use.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">bootclasspath</td>
+    <td valign="top">location of bootstrap class files.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+    <td valign="top">the classpath to use, given as a
+      <a href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">bootclasspathref</td>
+    <td valign="top">location of bootstrap class files, given as a
+      <a href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">extdirs</td>
+    <td valign="top">location of installed extensions.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">encoding</td>
+    <td valign="top">encoding of source files.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">debug</td>
+    <td valign="top">indicates whether source should be compiled with debug
+      information; defaults to <code>off</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">optimize</td>
+    <td valign="top">indicates whether source should be compiled with
+      optimization; defaults to <code>off</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">deprecation</td>
+    <td valign="top">indicates whether source should be compiled with
+      deprecation information; defaults to <code>off</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">target</td>
+    <td valign="top">generate class files for specific VM version (e.g.,
+	 <code>1.1</code> or <code>1.2</code>).</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">asks the compiler for verbose output.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">depend</td> <td valign="top">enables dependency-tracking
+      for compilers that support this (jikes and classic)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includeAntRuntime</td> 
+    <td valign="top">whether to include the Ant run-time libraries;
+      defaults to <code>yes</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includeJavaRuntime</td> 
+    <td valign="top">whether to include the default run-time
+      libraries from the executing VM; defaults to <code>no</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td> <td valign="top">
+        indicates whether the build will continue even if there are compilation errors; defaults to <code>true</code>.
+    </td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+
+<h3>Parameters specified as nested elements</h3>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h4><code>src</code>, <code>classpath</code>, <code>bootclasspath</code> and <code>extdirs</code></h4>
+<p><code>Javac</code>'s <i>srcdir</i>, <i>classpath</i>,
+<i>bootclasspath</i> and <i>extdirs</i> attributes are <a
+href="../using.html#path">path-like structures</a> and can also be set via nested
+<code>&lt;src&gt</code>,
+<code>&lt;classpath&gt</code>,
+<code>&lt;bootclasspath&gt</code> and
+<code>&lt;extdirs&gt</code> elements, respectively.</p>
+
+<h3>Examples</h3>
+<pre>  &lt;javac srcdir=&quot;${src}&quot;
+         destdir=&quot;${build}&quot;
+         classpath=&quot;xyz.jar&quot;
+         debug=&quot;on&quot;
+  /&gt;</pre>
+<p>compiles all <code>.java</code> files under the <code>${src}</code>
+directory, and stores
+the <code>.class</code> files in the <code>${build}</code> directory.
+The classpath used contains <code>xyz.jar</code>, and debug information is on.</p>
+<pre>  &lt;javac srcdir=&quot;${src}&quot;
+         destdir=&quot;${build}&quot;
+         includes=&quot;mypackage/p1/**,mypackage/p2/**&quot;
+         excludes=&quot;mypackage/p1/testpackage/**&quot;
+         classpath=&quot;xyz.jar&quot;
+         debug=&quot;on&quot;
+  /&gt;</pre>
+<p>compiles <code>.java</code> files under the <code>${src}</code>
+directory, and stores the
+<code>.class</code> files in the <code>${build}</code> directory.
+The classpath used contains <code>xyz.jar</code>, and debug information is on.
+Only files under <code>mypackage/p1</code> and <code>mypackage/p2</code> are
+used. Files in the <code>mypackage/p1/testpackage</code> directory are excluded
+from compilation.</p>
+
+<pre>  &lt;javac srcdir=&quot;${src}:${src2}&quot;
+         destdir=&quot;${build}&quot;
+         includes=&quot;mypackage/p1/**,mypackage/p2/**&quot;
+         excludes=&quot;mypackage/p1/testpackage/**&quot;
+         classpath=&quot;xyz.jar&quot;
+         debug=&quot;on&quot;
+  /&gt;</pre>
+
+<p>is the same as the previous example, with the addition of a second
+source path, defined by
+the property <code>src2</code>. This can also be represented using nested
+<code>&lt;src&gt;</code> elements as follows:</p>
+
+<pre>  &lt;javac destdir=&quot;${build}&quot;
+         classpath=&quot;xyz.jar&quot;
+         debug=&quot;on&quot;&gt;
+    &lt;src path=&quot;${src}&quot;/&gt;
+    &lt;src path=&quot;${src2}&quot;/&gt;
+    &lt;include name=&quot;mypackage/p1/**&quot;/&gt;
+    &lt;include name=&quot;mypackage/p2/**&quot;/&gt;
+    &lt;exclude name=&quot;mypackage/p1/testpackage/**&quot;/&gt;
+  &lt;/javac&gt;</pre>
+
+<p><b>Note:</b> If you are using Ant on Windows and a new DOS window pops up
+for every use of an external compiler, this may be a problem of the JDK you are using.
+This problem may occur with all JDKs &lt; 1.2.</p>
+
+<p><b>Note:</b> If you wish to compile only source-files located in some packages below a
+common root you should not include these packages in the srcdir-attribute. Use include/exclude-attributes
+or elements to filter for these packages. If you include part of your package-structure inside the srcdir-attribute 
+(or nested src-elements) Ant will start to recompile your sources everytime you call it.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/javadoc.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/javadoc.html
new file mode 100644
index 0000000..f46c09a
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/javadoc.html
@@ -0,0 +1,466 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="javadoc">Javadoc/Javadoc2</a></h2>
+<h3>Description</h3>
+<p>Generates code documentation using the javadoc tool.</p>
+<p>The source directory will be recursively scanned for Java source files to process
+but only those matching the inclusion rules, and not matching the exclusions rules
+will be passed to the javadoc tool. This
+allows wildcards to be used to choose between package names, reducing verbosity
+and management costs over time. This task, however, has no notion of
+&quot;changed&quot; files, unlike the <a href="javac.html">javac</a> task. This means
+all packages will be processed each time this task is run. In general, however,
+this task is used much less frequently.</p>
+<p>This task works seamlessly between different javadoc versions (1.1 and 1.2),
+with the obvious restriction that the 1.2 attributes will be ignored if run in a
+1.1 VM.</p>
+<p>NOTE: since javadoc calls System.exit(), javadoc cannot be run inside the
+same VM as ant without breaking functionality. For this reason, this task 
+always forks the VM. This overhead is not significant since javadoc is normally a heavy
+application and will be called infrequently.</p>
+<p>NOTE: the packagelist attribute allows you to specify the list of packages to 
+document outside of the Ant file. It's a much better practice to include everything 
+inside the build.xml file. This option was added in order to make it easier to 
+migrate from regular makefiles, where you would use this option of javadoc. 
+The packages listed in packagelist are not checked, so the task performs even 
+if some packages are missing or broken. Use this option if you wish to convert from 
+an existing makefile. Once things are running you should then switch to the regular 
+notation. </p>
+
+<p>DEPRECATION: the javadoc2 task simply points to the javadoc task and it's
+there for back compatibility reasons. Since this task will be removed in future
+versions, you are strongly encouraged to use <a href="javadoc.html">javadoc</a>
+instead.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Availability</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">sourcepath</td>
+    <td valign="top">Specify where to find source files</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" rowspan="2">At least one of the two or nested
+      <code>&lt;sourcepath&gt;</code></td>
+  </tr>
+  <tr>
+    <td valign="top">sourcepathref</td>
+    <td valign="top">Specify where to find source files by <a
+      href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">all</td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">Destination directory for output files</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">maxmemory</td>
+    <td valign="top">Max amount of memory to allocate to the javadoc VM</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sourcefiles</td>
+    <td valign="top">Comma separated list of source files</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="middle" rowspan="2">at least one of the two</td>
+  </tr>
+  <tr>
+    <td valign="top">packagenames</td>
+    <td valign="top">Comma separated list of package files (with terminating
+      wildcard)</td>
+    <td align="center" valign="top">all</td>
+  </tr>
+  <tr>
+    <td valign="top">packageList</td>
+    <td valign="top">The name of a file containing the packages to process</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">Specify where to find user class files</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Bootclasspath</td>
+    <td valign="top">Override location of class files loaded by the bootstrap
+      class loader</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+    <td valign="top">Specify where to find user class files by <a
+      href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">bootclasspathref</td>
+    <td valign="top">Override location of class files loaded by the
+      bootstrap class loader by <a href="../using.html#references">reference</a> to a
+      PATH defined elsewhere.</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Extdirs</td>
+    <td valign="top">Override location of installed extensions</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Overview</td>
+    <td valign="top">Read overview documentation from HTML file</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Public</td>
+    <td valign="top">Show only public classes and members</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Protected</td>
+    <td valign="top">Show protected/public classes and members (default)</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Package</td>
+    <td valign="top">Show package/protected/public classes and members</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Private</td>
+    <td valign="top">Show all classes and members</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Old</td>
+    <td valign="top">Generate output using JDK 1.1 emulating doclet</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Verbose</td>
+    <td valign="top">Output messages about what Javadoc is doing</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Locale</td>
+    <td valign="top">Locale to be used, e.g. en_US or en_US_WIN</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Encoding</td>
+    <td valign="top">Source file encoding name</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Version</td>
+    <td valign="top">Include @version paragraphs</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Use</td>
+    <td valign="top">Create class and package usage pages</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Author</td>
+    <td valign="top">Include @author paragraphs</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Splitindex</td>
+    <td valign="top">Split index into one file per letter</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Windowtitle</td>
+    <td valign="top">Browser window title for the documentation (text)</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Doctitle</td>
+    <td valign="top">Include title for the package index(first) page (html-code)</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Header</td>
+    <td valign="top">Include header text for each page (html-code)</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">Footer</td>
+    <td valign="top">Include footer text for each page (html-code)</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">bottom</td>
+    <td valign="top">Include bottom text for each page (html-code)</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">link</td>
+    <td valign="top">Create links to javadoc output at the given URL</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">linkoffline</td>
+    <td valign="top">Link to docs at &lt;url&gt; using package list at
+      &lt;url2&gt;</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">group</td>
+    <td valign="top">Group specified packages together in overview page</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">nodeprecated</td>
+    <td valign="top">Do not include @deprecated information</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">nodeprecatedlist</td>
+    <td valign="top">Do not generate deprecated list</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">notree</td>
+    <td valign="top">Do not generate class hierarchy</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">noindex</td>
+    <td valign="top">Do not generate index</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">nohelp</td>
+    <td valign="top">Do not generate help link</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">nonavbar</td>
+    <td valign="top">Do not generate navigation bar</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">serialwarn</td>
+    <td valign="top">FUTURE: Generate warning about @serial tag</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">helpfile</td>
+    <td valign="top">FUTURE: Specifies the HTML help file to use</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">stylesheetfile</td>
+    <td valign="top">Specifies the CSS stylesheet to use</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">charset</td>
+    <td valign="top">FUTURE: Charset for cross-platform viewing of generated
+      documentation</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">docencoding</td>
+    <td valign="top">Output file encoding name</td>
+    <td align="center" valign="top">1.1</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">doclet</td>
+    <td valign="top">Specifies the class file that starts the doclet used in generating the documentation.</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">docletpath</td>
+    <td valign="top">Specifies the path to the doclet class file that is specified with the -doclet option.</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">docletpathref</td>
+    <td valign="top">Specifies the path to the doclet class file that
+      is specified with the -doclet option by <a
+      href="../using.html#references">reference</a> to a PATH defined elsewhere.</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">additionalparam</td>
+    <td valign="top">Lets you add additional parameters to the javadoc
+            command line. Useful for doclets. Parameters containing
+            spaces need to be quoted using &amp;quot;.</td>
+    <td align="center" valign="top">1.2</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">failonerror</td>
+    <td valign="top">Stop the buildprocess if the command exits with a
+      returncode other than 0.</td>
+    <td align="center" valign="top">all</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+
+<h3>Parameters specified as nested elements</h3>
+<h4>link</h4>
+<p>Create link to javadoc output at the given URL. This performs the
+same role as the link and linkoffline attributes. You can use either
+syntax (or both at once), but with the nested elements you can easily
+specify multiple occurrences of the arguments.</p>
+<h4>Parameters</h4>
+
+<table width="60%" border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">href</td>
+    <td valign="top">The URL for the external documentation you wish to link to</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">offline</td>
+    <td valign="top">True if this link is not available online at the time of 
+                     generating the documentation</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">packagelistLoc</td>
+    <td valign="top">The location to the directory containing the package-list file for
+                     the external documentation</td>
+    <td align="center" valign="top">Only if the offline attribute is true</td>
+  </tr>
+</table>
+  
+<h4>groups</h4> 
+<p>Separates packages on the overview page into whatever groups you
+specify, one group per table. This performs the same role as the group
+attribute. You can use either syntax (or both at once), but with the
+nested elements you can easily specify multiple occurrences of the
+arguments.</p>
+
+<table width="60%" border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">title</td>
+    <td valign="top">Title of the group</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">packages</td>
+    <td valign="top">List of packages to include in that group</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+
+<h4>doclet</h4>
+<p>The doclet nested element is used to specify the doclet that javadoc will 
+use to process the input source files. A number of the standard javadoc arguments
+are actually arguments of the standard doclet. If these are specified in the javadoc
+task's attributes, they will be passed to the doclet specified in the 
+<code>&lt;doclet&gt;</code> nested element. Such attributes should only be specified, 
+therefore, if they can be interpreted by the doclet in use.</p>
+
+<p>If the doclet requires additional parameters, these can be specified with
+<code>&lt;param&gt;</code> elements within the <code>&lt;doclet&gt;</code> 
+element. These paramaters are restricted to simple strings. An example usage
+of the doclet element is shown below:</p>
+
+<pre>  &lt;javadoc ...&gt;
+     &lt;doclet name=&quot;theDoclet&quot;
+             path=&quot;path/to/theDoclet&quot;&gt;
+        &lt;param name=&quot;-foo&quot; value=&quot;foovalue&quot;/&gt;
+        &lt;param name=&quot;-bar&quot; value=&quot;barvalue&quot;/&gt;
+     &lt;/doclet&gt;
+  &lt;/javadoc&gt;
+</pre>
+
+<h4>sourcepath, classpath and bootclasspath</h4>
+<p><code>Javadoc</code>'s <i>sourcepath</i>, <i>classpath</i> and
+<i>bootclasspath</i> attributes are <a href="../using.html#path">PATH like
+structure</a> and can also be set via nested <i>sourcepath</i>,
+<i>classpath</i> and <i>bootclasspath</i> elements
+respectively.</p>
+
+<h3>Example</h3>
+<pre>  &lt;javadoc packagenames=&quot;com.dummy.test.*&quot;
+           sourcepath=&quot;src&quot;
+           destdir=&quot;docs/api&quot;
+           author=&quot;true&quot;
+           version=&quot;true&quot;
+           use=&quot;true&quot;
+           windowtitle=&quot;Test API&quot;
+           doctitle=&quot;&lt;h1&gt;Test&lt;/h1&gt;&quot;
+           bottom=&quot;&lt;i&gt;Copyright &amp;#169; 2000 Dummy Corp. All Rights Reserved.&lt;/i&gt;&quot;&gt;
+    &lt;group title=&quot;Group 1 Packages&quot; packages=&quot;com.dummy.test.a*&quot;/&gt;
+    &lt;group title=&quot;Group 2 Packages&quot; packages=&quot;com.dummy.test.b*&quot;/&gt;
+    &lt;link offline=&quot;true&quot; href=&quot;http://java.sun.com/products/jdk/1.2/docs/api/&quot; packagelistLoc=&quot;C:\tmp&quot;/&gt;
+    &lt;link href=&quot;http://developer.java.sun.com/developer/products/xml/docs/api/&quot;/&gt;
+  &lt/javadoc&gt;</pre>
+  
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/mail.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/mail.html
new file mode 100644
index 0000000..61da405
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/mail.html
@@ -0,0 +1,64 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="mail">Mail</a></h2>
+<h3>Description</h3>
+<p>A task to send SMTP email.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">from</td>
+    <td valign="top">Email address of sender.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">tolist</td>
+    <td valign="top">Comma-separated list of recipients.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">message</td>
+    <td valign="top">Message to send in the body of the email.</td>
+    <td align="center" valign="middle" rowspan="2">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">files</td>
+    <td valign="top">Filename(s) of text to send in the body of the email. 
+	Multiple files are comma-separated.</td>
+  </tr>
+  <tr>
+    <td valign="top">mailhost</td>
+    <td valign="top">Host name of the mail server.</td>
+    <td align="center" valign="top">No, default to &quot;localhost&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">subject</td>
+    <td valign="top">Email subject line.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>
+  &lt;mail from=&quot;me&quot; tolist=&quot;you&quot; subject=&quot;Results of nightly build&quot;
+        files=&quot;build.log&quot;/&gt;</pre>
+<p>Sends an eMail from <i>me</i> to <i>you</i> with a subject of 
+<i>Results of nightly build</i> and includes the contents of <i>build.log</i>
+in the body of the message.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/mkdir.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/mkdir.html
new file mode 100644
index 0000000..76ae61f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/mkdir.html
@@ -0,0 +1,38 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="mkdir">Mkdir</a></h2>
+<h3>Description</h3>
+<p>Creates a directory. Also non-existent parent directories are created, when
+necessary.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the directory to create.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>&lt;mkdir dir=&quot;${dist}&quot;/&gt;</pre>
+<p>creates a directory <code>${dist}</code>.</p>
+<pre>&lt;mkdir dir=&quot;${dist}/lib&quot;/&gt;</pre>
+<p>creates a directory <code>${dist}/lib</code>.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/move.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/move.html
new file mode 100644
index 0000000..cafd04e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/move.html
@@ -0,0 +1,117 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="move">Move</a></h2>
+<h3>Description</h3>
+<p>Moves a file to a new file or directory, or sets of files to
+a new directory.  By default, the
+destination file is overwritten if it already exists.  When <var>overwrite</var> is
+turned off, then files are only moved if the source file is newer than
+the destination file, or when the destination file does not exist.</p>
+<p><a href="../CoreTypes/fileset.html">FileSet</a>s are used to select sets of files
+to move to the <var>todir</var> directory.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the file to move</td>
+    <td valign="top" align="center">One of <var>file</var> or 
+     at least one nested fileset element</td>
+  </tr>
+  <tr>
+    <td valign="top">tofile</td>
+    <td valign="top">the file to move to</td>
+    <td valign="top" align="center" rowspan="2">With the <var>file</var> attribute, 
+    either <var>tofile</var> or <var>todir</var> can be used.  With a nested fileset, 
+	 only <var>todir</var> is allowed.</td>
+  </tr>
+  <tr>
+    <td valign="top">todir</td>
+    <td valign="top">the directory to move to</td>
+  </tr>
+  <tr>
+    <td valign="top">overwrite</td>
+    <td valign="top">overwrite existing files even if the destination
+      files are newer (default is &quot;true&quot;)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">filtering</td>
+    <td valign="top">indicates whether token filtering should take place during
+      the move.  See the <a href="filter.html">filter</a> task for a description of
+      how filters work.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">flatten</td>
+    <td valign="top">ignore directory structure of source directory,
+      copy all files into a single directory, specified by the <var>todir</var>
+      attribute (default is &quot;false&quot;).Note that you can achieve the 
+      same effect by using a <a href="../CoreTypes/mapper.html#flatten-mapper">flatten mapper</a></td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includeEmptyDirs</td>
+	 <td valign="top">Copy empty directories included with the nested FileSet(s).
+	   Defaults to &quot;yes&quot;.</td>
+	 <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>mapper</h4>
+<p>You can define file name transformations by using a nested <a
+href="../CoreTypes/mapper.html">mapper</a> element. The default mapper used by
+<code>&lt;copy&gt;</code> is the <a
+href="../CoreTypes/mapper.html#identity-mapper">identity</a>.</p>
+<h3>Examples</h3>
+<p><b>Move a single file (rename a file)</b></p>
+<pre>
+  &lt;move file=&quot;file.orig&quot; tofile=&quot;file.moved&quot;/&gt;
+</pre>
+<p><b>Move a single file to a directory</b></p>
+<pre>
+  &lt;move file=&quot;file.orig&quot; todir=&quot;dir/to/move/to&quot;/&gt;
+</pre>
+<p><b>Move a directory to a new directory</b></p>
+<pre>
+  &lt;move todir=&quot;new/dir/to/move/to&quot;&gt;
+    &lt;fileset dir=&quot;src/dir&quot;/&gt;
+  &lt;/move&gt;
+</pre>
+<p><b>Move a set of files to a new directory</b></p>
+<pre>
+  &lt;move todir=&quot;some/new/dir&quot; &gt;
+    &lt;fileset dir=&quot;my/src/dir&quot; &gt;
+      &lt;include name=&quot;**/*.jar&quot;/&gt;
+      &lt;exclude name=&quot;**/ant.jar&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/move&gt;
+</pre>
+<p><b>Append <code>&quot;.bak&quot;</code> to the names of all files
+in a directory.</b></p>
+<pre>
+  &lt;move todir=&quot;my/src/dir&quot; &gt;
+    &lt;fileset dir=&quot;my/src/dir&quot; &gt;
+      &lt;exclude name=&quot;**/*.bak&quot;/&gt;
+    &lt;/fileset&gt;
+    &lt;mapper type=&quot;glob&quot; from=&quot;*&quot; to=&quot;*.bak&quot;/&gt;
+  &lt;/move&gt;
+</pre>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/patch.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/patch.html
new file mode 100644
index 0000000..aa84ce9
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/patch.html
@@ -0,0 +1,77 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="patch">Patch</a></h2>
+<h3>Description</h3>
+<p>Applies a diff file to originals.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">patchfile</td> 
+    <td valign="top">the file that includes the diff output</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">originalfile</td> 
+    <td valign="top">the file to patch</td>
+    <td align="center" valign="top">No, tries to guess it from the diff 
+      file</td>
+  </tr>
+  <tr>
+    <td valign="top">backups</td> 
+    <td valign="top">Keep backups of the unpatched files</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">quiet</td> 
+    <td valign="top">Work silently unless an error occurs</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">reverse</td> 
+    <td valign="top">Assume patch was created with old and new files 
+      swapped.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">ignorewhitespace</td> 
+    <td valign="top">Ignore whitespace differences.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strip</td> 
+    <td valign="top">Strip the smallest prefix containing <i>num</i> leading 
+      slashes from filenames.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;patch patchfile=&quot;module.1.0-1.1.patch&quot;/&gt;</pre>
+<p>applies the diff included in <i>module.1.0-1.1.patch</i> to the
+files in base directory guessing the filename(s) from the diff output.</p>
+<pre>  &lt;patch patchfile=&quot;module.1.0-1.1.patch&quot; strip=&quot;1&quot;/&gt;</pre>
+<p>like above but one leading directory part will be removed. i.e. if
+the diff output looked like</p>
+<pre>
+--- a/mod1.0/A	Mon Jun  5 17:28:41 2000
++++ a/mod1.1/A	Mon Jun  5 17:28:49 2000
+</pre> 
+the leading <i>a/</i> will be stripped.
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/property.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/property.html
new file mode 100644
index 0000000..a8635fc
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/property.html
@@ -0,0 +1,129 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="property">Property</a></h2>
+<h3>Description</h3>
+<p>Sets a property (by name and value), or set of properties (from file or
+resource) in the project.</p>
+<p>When a property was set by the user, or was a property in a parent project
+(that started this project with the <a href="ant.html">ant task</a>), then this
+property cannot be set, and will be ignored. This means that properties set
+outside the current project always override the properties of the current
+project.</p>
+<p>There are five ways to set properties:</p>
+<ul>
+  <li>By supplying both the <i>name</i> and <i>value</i> attribute.</li>
+  <li>By supplying both the <i>name</i> and <i>refid</i> attribute.</li>
+  <li>By setting the <i>file</i> attribute with the filename of the property
+    file to load. This property file has the format as defined by the file used
+    in the class java.util.Properties.</li>
+  <li>By setting the <i>resource</i> attribute with the resource name of the
+    property file to load. This property file has the format as defined by the
+    file used in the class java.util.Properties.</li>
+  <li>By setting the <i>environment</i> attribute with a prefix to use.
+    Properties will be defined for every environment variable by
+    prefixing the supplied name and a period to the name of the variable.</li>
+</ul>
+<p>Although combinations of the three ways are possible, only one should be used
+at a time. Problems might occur with the order in which properties are set, for
+instance.</p>
+<p>The value part of the properties being set, might contain references to other
+properties. These references are resolved at the time these properties are set.
+This also holds for properties loaded from a property file.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">the name of the property to set.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">the value of the property.</td>
+    <td valign="middle" align="center" rowspan="6">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">refid</td>
+    <td valign="top"><a href="../using.html#references">Reference</a> to an object
+      defined elsewhere. Only yields reasonable results for references
+      to <a href="../using.html#path">PATH like structures</a> or properties.</td>
+  </tr>
+  <tr>
+    <td valign="top">resource</td>
+    <td valign="top">the resource name of the property file.</td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the filename of the property file .</td>
+  </tr>
+  <tr>
+    <td valign="top">location</td>
+    <td valign="top">Sets the property to the absolute filename of the
+      given file. If the value of this attribute is an absolute path, it
+      is left unchanged (with / and \ characters converted to the
+      current platforms conventions). Otherwise it is taken as a path
+      relative to the project's basedir and expanded.</td>
+  </tr>
+  <tr>
+    <td valign="top">environment</td>
+    <td valign="top">the prefix to use when retrieving environment variables. Thus
+    if you specify environment=&quot;myenv&quot; you will be able to access OS-specific 
+    environment variables via property names &quot;myenv.PATH&quot; or 
+	&quot;myenv.TERM&quot;. Note that if you supply a property name with a final 
+	&quot;.&quot; it will not be doubled. ie environment=&quot;myenv.&quot; will still 
+	allow access of environment variables through &quot;myenv.PATH&quot; and 
+	&quot;myenv.TERM&quot;. This functionality is currently only implemented 
+    on select platforms. Feel free to send patches to increase the number of platforms
+    this functionality is supported on ;)</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td> 
+    <td valign="top">the classpath to use when looking up a resource.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td> 
+    <td valign="top">the classpath to use when looking up a resource,
+      given as <a href="../using.html#references">reference</a> to a PATH defined
+      elsewhere..</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>classpath</h4>
+<p><code>Property</code>'s <i>classpath</i> attribute is a <a
+href="../using.html#path">PATH like structure</a> and can also be set via a nested
+<i>classpath</i> element.</p>
+<h3>Examples</h3>
+<pre>  &lt;property name=&quot;foo.dist&quot; value=&quot;dist&quot;/&gt;</pre>
+<p>sets the property <code>foo.dist</code> to the value &quot;dist&quot;.</p>
+<pre>  &lt;property file=&quot;foo.properties&quot;/&gt;</pre>
+<p>reads a set of properties from a file called &quot;foo.properties&quot;.</p>
+<pre>  &lt;property resource=&quot;foo.properties&quot;/&gt;</pre>
+<p>reads a set of properties from a resource called &quot;foo.properties&quot;.</p>
+<p>Note that you can reference a global properties file for all of your Ant
+builds using the following:</p>
+<pre>  &lt;property file=&quot;${user.home}/.ant-global.properties&quot;/&gt;</pre>
+<p>since the &quot;user.home&quot; property is defined by the Java virtual machine
+to be your home directory.  This technique is more appropriate for Unix than 
+Windows since the notion of a home directory doesn't exist on Windows.  On the
+JVM that I tested, the home directory on Windows is &quot;C:\&quot;.  Different JVM
+implementations may use other values for the home directory on Windows.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/rename.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/rename.html
new file mode 100644
index 0000000..6c2d133
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/rename.html
@@ -0,0 +1,49 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="rename">Rename</a></h2>
+<h3><i>Deprecated</i></h3>
+<p><i>This task has been deprecated.  Use the Move task instead.</i></p>
+<h3>Description</h3>
+<p>Renames a given file.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">file to rename.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">new name of the file.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">replace</td>
+    <td valign="top">Enable replacing of existing file (default: on).</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;rename src=&quot;foo.jar&quot; dest=&quot;${name}-${version}.jar&quot;/&gt;</pre> 
+<p>Renames the file <code>foo.jar</code> to <code>${name}-${version}.jar</code> (assuming <code>name</code>
+ and <code>version</code> being predefined properties). If a file named <code>${name}-${version}.jar</code>
+ already exists, it will be removed prior to renaming <code>foo.jar</code>.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/replace.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/replace.html
new file mode 100644
index 0000000..e84336b
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/replace.html
@@ -0,0 +1,164 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="replace">Replace</a></h2>
+<h3>Description</h3>
+<p>Replace is a directory based task for replacing the occurrence of a given string with another string 
+in selected file.</p>
+<p>If you want to replace a text that crosses line boundaries, you
+must use a nested <code>&lt;replacetoken&gt;</code> element.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">file for which the token should be replaced.</td>
+    <td align="center" rowspan="2">Exactly one of the two.</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">The base directory to use when replacing a token in 
+      multiple files.</td>
+  </tr>
+  <tr>
+    <td valign="top">token</td>
+    <td valign="top">the token which must be replaced.</td>
+    <td valign="top" align="center">Yes, unless a nested <code>replacetoken</code>
+      element is used.</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">the new value for the token. When omitted, an empty string
+      (&quot;&quot;) is used.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">propertyFile</td>
+    <td valign="top">valid property file from which properties specified using nested <code>&lt;replacefilter&gt;</code> elements are drawn.</td>
+    <td valign="top" align="center">Yes only if <i>property</i> attribute of <code>&lt;replacefilter&gt;</code> is used.</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;replace file=&quot;${src}/index.html&quot; token=&quot;@@@&quot; value=&quot;wombat&quot;/&gt;</pre>
+<p>replaces occurrences of the string &quot;@@@&quot; with the string
+&quot;wombat&quot;, in the file <code>${src}/index.html</code>.</p>
+<h3>Parameters specified as nested elements</h3>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code> as well as the
+nested <code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<p>If either the text you want to replace or the replacement text
+cross line boundaries, you can use nested elements to specify
+them.</p>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;replace dir=&quot;${src}&quot; value=&quot;wombat&quot;&gt;
+  &lt;include name=&quot;**/*.html&quot;/&gt;
+  &lt;replacetoken&gt;&lt;![CDATA[multi line
+token]]>&lt;/replacetoken&gt;
+&lt;/replace&gt;
+</pre></blockquote>
+<p>replaces occurrences of the string &quot;multi
+line<i>\n</i>token&quot; with the string &quot;wombat&quot;, in all
+HTML files in the directory <code>${src}</code>.Where <i>\n</i> is
+the platform specific line separator.</p>
+<blockquote><pre>
+&lt;replace file=&quot;${src}/index.html&quot;&gt;
+  &lt;replacetoken&gt;&lt;![CDATA[two line
+token]]>&lt;/replacetoken&gt;
+  &lt;replacevalue&gt;&lt;![CDATA[two line
+token]]>&lt;/replacevalue&gt;
+&lt;/replace&gt;
+</pre></blockquote>
+<h4>replacefilter</h4>
+<p>In addition to allowing for multiple replacements, optional nested <code>&lt;replacefilter&gt;</code> elements allow replacement values to be extracted from a property file. The name of this file is specified using the <code>&lt;replace&gt;</code> attribute <i>propertyFile</i>.
+</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">token</td>
+    <td valign="top">The string to search for.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">The replacement string.</td>
+    <td align="center" rowspan="2">Either may be specified, but not both. Both can be omitted, if desired.</td>
+  </tr>
+  <tr>
+    <td valign="top">property</td>
+    <td valign="top">Name of the property whose value is to serve as the replacement value.</td>
+  </tr>
+</table>
+<p>If neither <i>value</i> nor <i>property</i> is used, the value provided using the <code>&lt;replace&gt;</code> attribute <i>value</i> and/or the <code>&lt;replacevalue&gt;</code> element is used. If no value was specified using either of these options, the token is replaced with an empty string.
+</p>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;replace 
+    file=&quot;configure.sh&quot;
+    value=&quot;defaultvalue&quot;
+    propertyFile=&quot;source/name.properties&quot; &gt;
+  &lt;replacefilter 
+    token=&quot;@token1@&quot; /&gt;
+  &lt;replacefilter 
+    token=&quot;@token2@&quot; 
+    value=&quot;value2&quot;/&gt;
+  &lt;replacefilter 
+    token=&quot;@token3@&quot; 
+    property=&quot;property.key&quot;/&gt;
+&lt;/replace&gt;
+</pre></blockquote>
+<p>In file <code>configure.sh</code>, replace all instances of &quot;@token1@&quot; with &quot;defaultvalue&quot;, all instances of &quot;@token2@&quot; with &quot;value2&quot;, and all instances of &quot;@token3@&quot; with the value of the property &quot;property.key&quot;, as it appears in property file <code>src/name.properties</code>.</p>
+<p><b>Note:</b> It is possible to use either the <i>token</i>/<code>&lt;replacetoken&gt;</code> and <i>value</i>/<code>&lt;replacevalue&gt;</code> attributes/elements, the nested replacefilter elements, or both in the same operation.
+</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/rmic.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/rmic.html
new file mode 100644
index 0000000..80f5395
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/rmic.html
@@ -0,0 +1,158 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="rmic">Rmic</a></h2>
+<h3>Description</h3>
+<p>Runs the rmic compiler for a certain class.</p>
+<p>Rmic can be run on a single class (as specified with the classname
+attribute) or a number of classes at once (all classes below base that
+are neither _Stub nor _Skel classes).</p>
+<p>It is possible to refine the set of files that are being rmiced. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>base</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">base</td>
+    <td valign="top">the location to store the compiled files.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classname</td>
+    <td valign="top">the class for which to run <code>rmic</code>.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">filtering</td>
+    <td valign="top">indicates whether token filtering should take place</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sourcebase</td>
+    <td valign="top">Pass the &quot;-keepgenerated&quot; flag to rmic and
+ move the generated source file to the base directory.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">stubversion</td>
+    <td valign="top">Specify the JDK version for the generated stub code.
+ Specify &quot;1.1&quot; to pass the &quot;-v1.1&quot; option to rmic.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">The classpath to use during compilation</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+    <td valign="top">The classpath to use during compilation, given as <a
+      href="../using.html#references">reference</a> to a PATH defined elsewhere</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verify</td>
+    <td valign="top">check that classes implement Remote before handing them 
+        to rmic (default is false)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">iiop</td>
+    <td valign="top">indicates that portable (RMI/IIOP) stubs should be generated</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">iiopopts</td>
+    <td valign="top">additional arguments for IIOP class generation</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">idl</td>
+    <td valign="top">indicates that IDL output files should be generated</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">idlopts</td>
+    <td valign="top">additional arguments for IDL file generation</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">debug</td>
+    <td valign="top">generate debug info (passes -g to rmic). Defaults to false.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>classpath</h4>
+<p><code>Rmic</code>'s <i>classpath</i> attribute is a <a
+href="../using.html#path">PATH like structure</a> and can also be set via a nested
+<i>classpath</i> elements.</p>
+<h3>Examples</h3>
+<pre>  &lt;rmic classname=&quot;com.xyz.FooBar&quot; base=&quot;${build}/classes&quot;/&gt;</pre>
+<p>runs the rmic compiler for the class <code>com.xyz.FooBar</code>. The
+compiled files will be stored in the directory <code>${build}/classes</code>.</p>
+<pre>  &lt;rmic base=&quot;${build}/classes&quot; includes=&quot;**/Remote*.class&quot;/&gt;</pre>
+<p>runs the rmic compiler for all classes with <code>.class</code>
+files below <code>${build}/classes</code> whose classname starts with
+<i>Remote</i>. The compiled files will be stored in the directory
+<code>${build}/classes</code>.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/signjar.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/signjar.html
new file mode 100644
index 0000000..c093e14
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/signjar.html
@@ -0,0 +1,91 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="signjar">SignJar</a></h2>
+<h3>Description</h3>
+<p>Signs a jar or zip file with the javasign command line tool.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">jar</td>
+    <td valign="top">the jar file to sign</td>
+    <td valign="top" align="center">Yes.</td>
+  </tr>
+  <tr>
+    <td valign="top">alias</td>
+    <td valign="top">the alias to sign under</td>
+    <td valign="top" align="center">Yes.</td>
+  </tr>
+  <tr>
+    <td valign="top">storepass</td>
+    <td valign="top">password for keystore integrity.</td>
+    <td valign="top" align="center">Yes.</td>
+  </tr>
+  <tr>
+    <td valign="top">keystore</td>
+    <td valign="top">keystore location</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">storetype</td>
+    <td valign="top">keystore type</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keypass</td>
+    <td valign="top">password for private key (if different)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sigfile</td>
+    <td valign="top">name of .SF/.DSA file</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">signedjar</td>
+    <td valign="top">name of signed JAR file</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">(true | false) verbose output when signing</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">internalsf</td>
+    <td valign="top">(true | false) include the .SF file inside the signature
+block</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sectionsonly</td>
+    <td valign="top">(true | false) don't compute hash of entire manifest</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;signjar jar=&quot;${dist}/lib/ant.jar&quot;
+alias=&quot;apache-group&quot; storepass=&quot;secret&quot;/&gt;</code></p>
+</blockquote>
+<p>signs the ant.jar with alias &quot;apache-group&quot; accessing the
+keystore and private key via &quot;secret&quot; password.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/sql.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/sql.html
similarity index 72%
rename from jakarta-ant-1.2-src/docs/sql.html
rename to jakarta-ant-1.2-src/docs/manual/CoreTasks/sql.html
index ec12391..579bc38 100644
--- a/jakarta-ant-1.2-src/docs/sql.html
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/sql.html
@@ -1,5 +1,7 @@
 <html>
 <head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
 </head>
 <body>
 
@@ -9,12 +11,12 @@
 
 <p>Multiple statements can be set and each statement is delimited from the next use a semi-colon. Individual lines within the statements can be commented using either -- or // at the start of the line.</p>
 
-<p>The auto-commit attribute specifies whether auto commit should be turned on or off whilst executing the statements. If auto-commit is turned on each statement will be executed and commited. If it is turned off the statements will all be executed as one transaction.</p>
+<p>The auto-commit attribute specifies whether auto commit should be turned on or off whilst executing the statements. If auto-commit is turned on each statement will be executed and committed. If it is turned off the statements will all be executed as one transaction.</p>
 
-<p>The <i>onerror</i> attribute specifies how to preceed when an error occurs during the execution of one of the statements. 
+<p>The <i>onerror</i> attribute specifies how to proceed when an error occurs during the execution of one of the statements. 
 The possible values are: <b>continue</b> execution, only show the error;
 <b>stop</b> execution and commit transaction;
-and <b>abort</b> execution and transaction and fail task.
+and <b>abort</b> execution and transaction and fail task.</p>
 
 <h3>Parameters</h3>
 <table border="1" cellpadding="2" cellspacing="0">
@@ -51,17 +53,17 @@ and <b>abort</b> execution and transaction and fail task.
 <tr>
   <td width="12%" valign="top">autocommit</td>
   <td width="78%" valign="top">Auto commit flag for database connection (default false)</td>
-  <td width="10%" valign="top">No, default "false"</td>
+  <td width="10%" valign="top">No, default &quot;false&quot;</td>
 </tr>
 <tr>
   <td width="12%" valign="top">print</td>
   <td width="78%" valign="top">Print result sets from the statements (default false)</td>
-  <td width="10%" valign="top">No, default "false"</td>
+  <td width="10%" valign="top">No, default &quot;false&quot;</td>
 </tr>
 <tr>
   <td width="12%" valign="top">showheaders</td>
   <td width="78%" valign="top">Print headers for result sets from the statements (default true)</td>
-  <td width="10%" valign="top">No, default "true"</td>
+  <td width="10%" valign="top">No, default &quot;true&quot;</td>
 </tr>
 <tr>
   <td width="12%" valign="top">output</td>
@@ -76,7 +78,7 @@ and <b>abort</b> execution and transaction and fail task.
 <tr>
   <td width="12%" valign="top">onerror</td>
   <td width="78%" valign="top">Action to perform when statement fails: continue, stop, abort</td>
-  <td width="10%" valign="top">No, default "abort"</td>
+  <td width="10%" valign="top">No, default &quot;abort&quot;</td>
 </tr>
 <tr>
   <td width="12%" valign="top">rdbms</td>
@@ -95,7 +97,7 @@ and <b>abort</b> execution and transaction and fail task.
 <p>Use nested <code>&lt;transaction&gt;</code> 
 elements to specify multiple blocks of commands to the executed
 executed in the same connection but different transactions. This
-is particularly usefull when there are multiple files to execute
+is particularly useful when there are multiple files to execute
 on the same schema.</p>
 <table border="1" cellpadding="2" cellspacing="0">
   <tr>
@@ -111,29 +113,29 @@ on the same schema.</p>
 </table>
 <h4>classpath</h4>
 <p><code>Sql</code>'s <em>classpath</em> attribute is a <a
-href="#path">PATH like structure</a> and can also be set via a nested
+href="../using.html#path">PATH like structure</a> and can also be set via a nested
 <em>classpath</em> element. It is used to load the JDBC classes.</p>
 <p>
 The 
 </p>
 
 <h3>Examples</h3>
-<pre><blockquote>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass"
-    src="data.sql"
+<blockquote><pre>&lt;sql
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot;
+    src=&quot;data.sql&quot;
 /&gt;
 </pre></blockquote>
 
 <p>Connects to the database given in url as the sa user using the org.database.jdbcDriver and executes the sql statements contained within the file data.sql</p>
 
 <blockquote><pre>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass"
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot;
     &gt;
 insert
 into table some_table
@@ -151,10 +153,10 @@ need to escape <code>&lt;</code>, <code>&gt;</code> <code>&amp;</code>
 or other special characters. For example:</p>
 
 <blockquote><pre>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass"
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot;
     &gt;&lt;![CDATA[
 
 update some_table set column1 = column1 + 1 where column2 &lt; 42;
@@ -164,14 +166,14 @@ update some_table set column1 = column1 + 1 where column2 &lt; 42;
 
 <p>The following connects to the database given in url as the sa user using the org.database.jdbcDriver and executes the sql statements contained within the files data1.sql, data2.sql and data3.sql and then executes the truncate operation on <i>some_other_table</i>.</p>
 
-<pre><blockquote>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass" &gt;
-  &lt;transaction  src="data1.sql" /&gt;
-  &lt;transaction  src="data2.sql" /&gt;
-  &lt;transaction  src="data3.sql" /&gt;
+<blockquote><pre>&lt;sql
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot; &gt;
+  &lt;transaction  src=&quot;data1.sql&quot; /&gt;
+  &lt;transaction  src=&quot;data2.sql&quot; /&gt;
+  &lt;transaction  src=&quot;data3.sql&quot; /&gt;
   &lt;transaction&gt;
     truncate table some_other_table;
   &lt;/transaction&gt;
@@ -180,31 +182,32 @@ update some_table set column1 = column1 + 1 where column2 &lt; 42;
 
 <p>The following connects to the database given in url as the sa user using the org.database.jdbcDriver and executes the sql statements contained within the file data.sql, with output piped to outputfile.txt, searching /some/jdbc.jar as well as the system classpath for the driver class.</p>
 
-<pre><blockquote>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass"
-    src="data.sql"
-    print="yes"
-    output="outputfile.txt"
+<blockquote><pre>&lt;sql
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot;
+    src=&quot;data.sql&quot;
+    print=&quot;yes&quot;
+    output=&quot;outputfile.txt&quot;
     &gt;
 &lt;classpath&gt;
-	&lt;pathelement location="/some/jdbc.jar"&gt;
+	&lt;pathelement location=&quot;/some/jdbc.jar&quot;&gt;
 &lt;/classpath&gt;
 &lt;/sql&gt;
 </pre></blockquote>
 
-<p>The following will only execute if the RDBMS is "oracle" and the version starts with "8.1."</p>
+<p>The following will only execute if the RDBMS is &quot;oracle&quot; and the version 
+starts with &quot;8.1.&quot;</p>
 
-<pre><blockquote>&lt;sql
-    driver="org.database.jdbcDriver"
-    url="jdbc:database-url"
-    userid="sa"
-    password="pass"
-    src="data.sql"
-    rdbms="oracle"
-    version="8.1."
+<blockquote><pre>&lt;sql
+    driver=&quot;org.database.jdbcDriver&quot;
+    url=&quot;jdbc:database-url&quot;
+    userid=&quot;sa&quot;
+    password=&quot;pass&quot;
+    src=&quot;data.sql&quot;
+    rdbms=&quot;oracle&quot;
+    version=&quot;8.1.&quot;
     &gt;
 insert
 into table some_table
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/style.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/style.html
new file mode 100644
index 0000000..8dab1e6
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/style.html
@@ -0,0 +1,152 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="style">Style</a></h2>
+<h3>Description</h3>
+<p>Process a set of documents via XSLT.</p>
+<p>This is useful for building views of XML based documentation,
+or in generating code.</p>
+<p>It is possible to refine the set of files that are being copied. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and supports all 
+  attributes of <code>&lt;fileset&gt;</code> (<code>dir</code> becomes <code>basedir</code>) 
+  as well as the nested <code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> 
+  and <code>&lt;patternset&gt;</code> elements.</p>
+<p>Style supports the use of a &lt;param&gt; element which is use to pass values 
+  to an &lt;xsl:param&gt; declaration.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">where to find the source XML file.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">directory where to store the results.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">extension</td>
+    <td valign="top">desired file extension to be used for the targets. If not 
+      specified, the default is &quot;html&quot;.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">style</td>
+    <td valign="top">name of the stylesheet to use.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">processor</td>
+    <td valign="top">name of the XSLT processor to use.  Permissible values are
+      &quot;trax&quot; for a TraX compliant processor, &quot;xslp&quot; for the 
+      XSL:P processor, &quot;xalan&quot; for the Apache XML Xalan (version 1) 
+      processor, or the name of an arbitrary XSLTLiaison class. Defaults to trax, 
+      followed by xslp then xalan (in that order). The first one found in your 
+      class path is the one that is used.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be included. 
+      All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is taken to be 
+      an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be excluded. 
+      No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is taken to be 
+      an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">in</td>
+    <td valign="top">specifies a single XML document to be styled. Should be used 
+      with the out attribute.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">out</td>
+    <td valign="top">specifies the output name for the styled result from the 
+      in attribute.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>param</h4>
+<p>Param is used to pass a parameter to the XSL stylesheet.</p>
+<h4>Parameters</h4>
+<table width="60%" border="1" cellpadding="2" cellspacing="0">
+  <tr> 
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr> 
+    <td valign="top">name</td>
+    <td valign="top">Name of the XSL parameter</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr> 
+    <td valign="top">expression</td>
+    <td valign="top">XSL expression to be placed into the param. To pass a text 
+      value into the style sheet it needs to be escaped using single quotes.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <pre>
+&lt;style basedir=&quot;doc&quot; destdir=&quot;build/doc&quot;
+       extension=&quot;html&quot; style=&quot;style/apache.xsl&quot;/&gt;</pre>
+  <h4>Using XSL parameters</h4>
+  <pre>&lt;style basedir=&quot;doc&quot; destdir=&quot;build/doc&quot;
+		extension=&quot;html&quot; style=&quot;style/apache.xsl&quot;&gt;
+	&lt;param name=&quot;date&quot; expression=&quot;'07-01-2000'&quot;/&gt;
+&lt;/style&gt;</pre>
+  <p>This will replace an xsl:param definition&lt;xsl:param name=&quot;date&quot;&gt;&lt;/xsl:param&gt; 
+    with the text value 07-01-2000 </p>
+  </blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/tar.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/tar.html
new file mode 100644
index 0000000..dfce644
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/tar.html
@@ -0,0 +1,178 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="tar">Tar</a></h2>
+<h3>Description</h3>
+<p>Creates a tar archive.</p>
+<p>The <i>basedir</i> attribute is the reference directory from where to tar.</p>
+<p>This task is a <a href="../dirtasks.html#directorybasedtasks">directory based task</a>
+and, as such, forms an implicit <a href="../CoreTypes/fileset.html">Fileset</a>. This 
+defines which files, relative to the <i>basedir</i>, will be included in the
+archive. The tar task supports all the attributes of Fileset to refine the
+set of files to be included in the implicit fileset.</p>
+
+<p>In addition to the implicit fileset, the tar task supports nested filesets. These
+filesets are extended to allow control over the access mode, username and groupname 
+to be applied to the tar entries. This is useful, for example, when preparing archives for 
+Unix systems where some files need to have execute permission.</p>
+
+<p>Early versions of tar did not support path lengths greater than 100 
+characters. Modern versions of tar do so, but in incompatible ways.
+The behaviour of the tar task when it encounters such paths is 
+controlled by the <i>longfile</i> attribute. 
+If the longfile attribute is set to <code>fail</code>, any long paths will 
+cause the tar task to fail.  If the longfile attribute is set to 
+<code>truncate</code>, any long paths will be truncated to the 100 character 
+maximum length prior to adding to the archive. If the value of the longfile 
+attribute is set to <code>omit</code> then files containing long paths will be 
+omitted from the archive.  Either option ensures that the archive can be 
+untarred by any compliant version of tar. If the loss of path or file 
+information is not acceptable, and it rarely is, longfile may be set to the 
+value <code>gnu</code>. The tar task will then produce a GNU tar file which 
+can have arbitrary length paths. Note however, that the resulting archive will 
+only be able to be untarred with GNU tar.  The default for the longfile 
+attribute is <code>warn</code> which behaves just like the gnu option except 
+that it produces a warning for each file path encountered that does not match 
+the limit.</p>
+
+<p>Note that this task does not perform compression. You might want to use the 
+<a href="gzip.html">GZip</a> task to prepare a .tar.gz package.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td valign="top" align="center"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">tarfile</td>
+    <td valign="top">the tar-file to create.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the directory from which to zip the files.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">longfile</td>
+    <td valign="top">Determines how long files (&gt;100 chars) are to be 
+       handled.  Allowable values are &quot;truncate&quot;, &quot;fail&quot;, 
+       &quot;warn&quot;, &quot;omil&quot; and &quot;gnu&quot;.  Default is 
+       &quot;warn&quot;.
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<h3>Nested Elements</h3>
+The tar task supports nested <a href="../CoreTypes/fileset.html">tarfileset</a> elements. These are
+extended Filesets which, in addition to the standard fileset elements, support three additional
+attributes
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td valign="top" align="center"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">mode</td>
+    <td valign="top">An 3 digit octal string, specify the user, group and other modes in 
+                     the standard Unix fashion</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">username</td>
+    <td valign="top">The username for the tar entry. This is not the same as the UID, which is 
+                     not currently set by the tar task.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">groupname</td>
+    <td valign="top">The username for the tar entry. This is not the same as the GID, which is 
+                     not currently set by the tar task.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<pre>  &lt;tar tarfile=&quot;${dist}/manual.tar&quot; basedir=&quot;htdocs/manual&quot;/&gt;
+  &lt;gzip zipfile=&quot;${dist}/manual.tar.gz&quot; src=&quot;${dist}/manual.tar&quot;/&gt;</pre>
+<p>tars all files in the <code>htdocs/manual</code> directory into a file called <code>manual.tar</code>
+in the <code>${dist}</code>  directory, then applies the gzip task to compress
+it.</p>
+<pre>  &lt;tar tarfile=&quot;${dist}/manual.tar&quot;
+       basedir=&quot;htdocs/manual&quot;
+       excludes=&quot;mydocs/**, **/todo.html&quot;
+  /&gt;</pre>
+<p>tars all files in the <code>htdocs/manual</code> directory into a file called <code>manual.tar</code>
+in the <code>${dist}</code> directory. Files in the directory <code>mydocs</code>,
+or files with the name <code>todo.html</code> are excluded.</p>
+
+<pre>&lt;tar longfile=&quot;gnu&quot;
+     tarfile=&quot;${dist.base}/${dist.name}-src.tar&quot; &gt;
+  &lt;tarfileset dir=&quot;${dist.name}/..&quot; mode=&quot;755&quot; username=&quot;ant&quot; group=&quot;ant&quot;&gt;
+    &lt;include name=&quot;${dist.name}/bootstrap.sh&quot;/&gt;
+    &lt;include name=&quot;${dist.name}/build.sh&quot;/&gt;
+  &lt;/fileset&gt; 
+  &lt;tarfileset dir=&quot;${dist.name}/..&quot; username=&quot;ant&quot; group=&quot;ant&quot;&gt; 
+    &lt;include name=&quot;${dist.name}/**&quot;/&gt;
+    &lt;exclude name=&quot;${dist.name}/bootstrap.sh&quot;/&gt;
+    &lt;exclude name=&quot;${dist.name}/build.sh&quot;/&gt;
+  &lt;/fileset&gt;
+&lt;/tar&gt; </pre>
+
+<p>This example shows building a tar which uses the GNU extensions for long paths and
+where some files need to be marked as executable (mode 755)
+and the rest are use the default mode (read-write by owner). The first
+fileset selects just the executable files. The second fileset must exclude
+the executable files and include all others. </p>
+
+<p><strong>Note: </strong> The tar task does not ensure that a file is only selected
+by one fileset. If the same file is selected by more than one fileset, it will be included in the 
+tar file twice, with the same path.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/taskdef.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/taskdef.html
new file mode 100644
index 0000000..ec6250a
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/taskdef.html
@@ -0,0 +1,56 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="taskdef">Taskdef</a></h2>
+<h3>Description</h3>
+<p>Adds a task definition to the current project, such that this new task can be
+used in the current project. Two attributes are needed, the name that identifies
+this task uniquely, and the full name of the class (including the packages) that
+implements this task.</p>
+<p>Taskdef should be used to add your own tasks to the system. See also &quot;<a
+href="../develop.html#writingowntask">Writing your own task</a>&quot;.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">the name of the task</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classname</td>
+    <td valign="top">the full class name implementing the task</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td> <td valign="top">the classpath to
+      use when looking up <code>classname</code>.</td> <td
+    align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>classpath</h4>
+<p><code>Taskdef</code>'s <i>classpath</i> attribute is a <a
+href="../using.html#path">PATH like structure</a> and can also be set via a nested
+<i>classpath</i> element.</p>
+<h3>Examples</h3>
+<pre>  &lt;taskdef name=&quot;myjavadoc&quot; classname=&quot;com.mydomain.JavadocTask&quot;/&gt;</pre>
+<p>makes a task called <code>myjavadoc</code> available to Ant. The class <code>com.mydomain.JavadocTask</code>
+implements the task.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/touch.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/touch.html
new file mode 100644
index 0000000..7bb503d
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/touch.html
@@ -0,0 +1,57 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="touch">Touch</a></h2>
+<h3>Description</h3>
+<p>Changes the modification time of a file and possibly creates it at
+the same time.</p>
+<p>For JDK 1.1 only the creation of new files with a modification time
+of now works, all other cases will emit a warning.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">file</td>
+    <td valign="top">the name of the file</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">millis</td>
+    <td valign="top">specifies the new modification time of the file
+       in milliseconds since midnight Jan 1 1970</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">datetime</td>
+    <td valign="top">specifies the new modification time of the file
+       in the format MM/DD/YYYY HH:MM AM_or_PM.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<p>If both <code>millis</code> and <code>datetime</code> are omitted
+the current time is assumed.</p>
+<h3>Examples</h3>
+<pre>  &lt;touch file=&quot;myfile&quot;/&gt;</pre>
+<p>creates <code>myfile</code> if it doesn't exist and changes the
+modification time to the current time.</p>
+<pre>  &lt;touch file=&quot;myfile&quot; datetime=&quot;06/28/2000 2:02 pm&quot;/&gt;</pre>
+<p>creates <code>myfile</code> if it doesn't exist and changes the
+modification time to Jun, 28 2000 2:02 pm (14:02 for those used to 24
+hour times).</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/tstamp.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/tstamp.html
new file mode 100644
index 0000000..14fe4f2
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/tstamp.html
@@ -0,0 +1,75 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="tstamp">Tstamp</a></h2>
+<h3>Description</h3>
+<p>Sets the DSTAMP, TSTAMP and TODAY properties in the current project. The
+DSTAMP is in the &quot;yyyymmdd&quot; format, the TSTAMP is in the &quot;hhmm&quot;
+format and TODAY is &quot;month day year&quot;.</p>
+<p>These properties can be used in the buildfile, for instance, to create
+timestamped filenames or used to replace placeholder tags inside documents to
+indicate, for example, the release date. The best place for this task is in your
+initialization target.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr> <td colspan="3"> No parameters</td>
+  </tr>
+</table>
+
+<h3>Nested Elements</h3>
+The tstamp task supports a format nested element which allows a property to be
+given the current date and time in a given format. The date/time patterns are as defined in the Java 
+SimpleDateFormat class. 
+
+
+<table width="60%" border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">property</td>
+    <td valign="top">
+        The property which is to receive the date/time string in the given pattern
+    </td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">pattern</td>
+    <td valign="top">The date/time pattern to be used. The values are defined by the Java
+                     SimpleDateFormat class</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<p> Set the standard DSTAMP, TSTAMP and TODAY properties according to the formats above</p>
+<pre>  &lt;tstamp/&gt;</pre>
+
+<p> As for the above example, set the standard properties and also set the property 
+&quot;TODAY_UK&quot; with the date/time pattern &quot;d MMM yyyy&quot;</p>
+
+<pre>  &lt;tstamp&gt;
+    &lt;format property=&quot;TODAY_UK&quot; pattern=&quot;d MMMM yyyy&quot;&gt;
+  &lt;/tstamp&gt;
+</pre>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/untar.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/untar.html
new file mode 100644
index 0000000..6f978c6
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/untar.html
@@ -0,0 +1,52 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="untar">Untar</a></h2>
+<h3>Description</h3>
+<p>Untars a tarfile.</p>
+
+<p><strong>Note: </strong>File permissions will not be restored on extracted files.</p>
+
+<p>For JDK 1.1 &quot;last modified time&quot; field is set to current time instead of being 
+carried from tarfile.</p>
+
+<p>The untar task recognizes the long pathname entries used by GNU tar.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">tarfile to expand.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">directory where to store the expanded files.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>
+&lt;gunzip src=&quot;tools.tar.gz&quot;/&gt;<br>
+&lt;untar src=&quot;tools.tar&quot; dest=&quot;${tools.home}&quot;/&gt;
+</code></p>
+</blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/unzip.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/unzip.html
new file mode 100644
index 0000000..918acb7
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/unzip.html
@@ -0,0 +1,45 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="unzip">Unjar/Unwar/Unzip</a></h2>
+<h3>Description</h3>
+<p>Unzips a zip-, war- or jarfile.</p>
+<p>For JDK 1.1 &quot;last modified time&quot; field is set to current time instead of being 
+carried from zipfile.</p>
+<p>File permissions will not be restored on extracted files.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">zipfile to expand.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">directory where to store the expanded files.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;unzip src=&quot;${tomcat_src}/tools-src.zip&quot; dest=&quot;${tools.home}&quot;
+  /&gt;</code></p>
+</blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/uptodate.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/uptodate.html
new file mode 100644
index 0000000..658cdaf
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/uptodate.html
@@ -0,0 +1,62 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="uptodate">Uptodate</a></h2>
+<h3>Description</h3>
+<p>Sets a property if a target files are more up to date than a set of
+Source files. Source files are specified by nested &lt;srcfiles&gt;
+elements, these are <a href="../CoreTypes/fileset.html">FileSet</a>s, while target
+files are specified using a nested <a href="../CoreTypes/mapper.html">mapper</a>
+element.</p>
+<p>The value part of the property being set is <i>true</i> if the
+timestamp of the target files is more recent than the timestamp of
+every corresponding source file.</p>
+<p>The default behavior is to use a <a href="../CoreTypes/mapper.html#merge-mapper">merge
+mapper</a> with the <code>to</code> attribute set to the value of the
+targetfile attribute.</p>
+<p>Normally, this task is used to set properties that are useful to avoid target
+execution depending on the relative age of the specified files.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">property</td>
+    <td valign="top">the name of the property to set.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">targetfile</td>
+    <td valign="top">the file for which we want to determine the status.</td>
+    <td valign="top" align="center">Yes, unless a nested mapper element is 
+      present.</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>  &lt;uptodate property=&quot;xmlBuild.notRequired&quot; targetfile=&quot;${deploy}\xmlClasses.jar&quot; &gt;
+    &lt;srcfiles dir= &quot;${src}/xml&quot; includes=&quot;**/*.dtd&quot;/&gt;
+  &lt;/uptodate&gt;</pre>
+<p>sets the property <code><i>xmlBuild.notRequired</i></code> to the value &quot;true&quot;
+if the <i>${deploy}/xmlClasses.jar</i> is more up to date than any of the DTD files in the <i>${src}/xml</i> directory.</p>
+<p>This can be written as</p>
+<pre>  &lt;uptodate property=&quot;xmlBuild.notRequired&quot;  &gt;
+    &lt;srcfiles dir= &quot;${src}/xml&quot; includes=&quot;**/*.dtd&quot;/&gt;
+    &lt;mapper type=&quot;merge&quot; to=&quot;${deploy}\xmlClasses.jar&quot;/&gt;
+  &lt;/uptodate&gt;</pre>
+<p>as well.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/war.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/war.html
new file mode 100644
index 0000000..dff6c6f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/war.html
@@ -0,0 +1,149 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="war">War</a></h2>
+<h3>Description</h3>
+<p>An extension of the <a href="jar.html">Jar</a> task with special
+treatment for files that should end up in the
+<code>WEB-INF/lib</code>, <code>WEB-INF/classes</code> or
+<code>WEB-INF</code> directories of the Web Application Archive.</p>
+<p>(The War task is a shortcut for specifying the particular layout of a WAR file. 
+The same thing can be accomplished by using the <i>prefix</i> and <i>fullpath</i>
+attributes of zipfilesets in a Zip or Jar task.)</p>
+<p>The extended zipfileset element from the zip task (with attributes <i>prefix</i>, <i>fullpath</i>, and <i>src</i>) is available in the War task.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">warfile</td>
+    <td valign="top">the war-file to create.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">webxml</td>
+    <td valign="top">The deployment descriptor to use (WEB-INF/web.xml).</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the directory from which to jar the files.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compress</td>
+    <td valign="top">Not only store data but also compress them, defaults to true</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">manifest</td>
+    <td valign="top">the manifest file to use.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">whenempty</td>
+    <td valign="top">Behavior to use if no files match.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Nested elements</h3>
+<h4>lib</h4>
+<p>The nested <code>lib</code> element specifies a <a
+href="../CoreTypes/fileset.html">FileSet</a>. All files included in this fileset will
+end up in the <code>WEB-INF/lib</code> directory of the war file.</p>
+<h4>classes</h4>
+<p>The nested <code>classes</code> element specifies a <a
+href="../CoreTypes/fileset.html">FileSet</a>. All files included in this fileset will
+end up in the <code>WEB-INF/classes</code> directory of the war file.</p>
+<h4>webinf</h4>
+<p>The nested <code>webinf</code> element specifies a <a
+href="../CoreTypes/fileset.html">FileSet</a>. All files included in this fileset will
+end up in the <code>WEB-INF</code> directory of the war file. If this
+fileset includes a file named <code>web.xml</code>, the file is
+ignored and you will get a warning.</p>
+<h3>Examples</h3>
+<p>Assume the following structure in the project's base directory:</p>
+<pre>
+thirdparty/libs/jdbc1.jar
+thirdparty/libs/jdbc2.jar
+build/main/com/myco/myapp/Servlet.class
+src/metadata/myapp.xml
+src/html/myapp/index.html
+src/jsp/myapp/front.jsp
+src/graphics/images/gifs/small/logo.gif
+src/graphics/images/gifs/large/logo.gif
+</pre>
+then the war file <code>myapp.war</code> created with
+<pre>
+&lt;war warfile=&quot;myapp.war&quot; webxml=&quot;src/metadata/myapp.xml&quot;&gt;
+  &lt;fileset dir=&quot;src/html/myapp&quot;/&gt;
+  &lt;fileset dir=&quot;src/jsp/myapp&quot;/&gt;
+  &lt;lib dir=&quot;thirdparty/libs&quot;&gt;
+    &lt;exclude name=&quot;jdbc1.jar&quot;/&gt;
+  &lt;/lib&gt;
+  &lt;classes dir=&quot;build/main&quot;/&gt;
+  &lt;zipfileset dir=&quot;src/graphics/images/gifs&quot; 
+              prefix=&quot;images&quot;/&gt;
+&lt;/war&gt;
+</pre>
+will consist of
+<pre>
+WEB-INF/web.xml
+WEB-INF/lib/jdbc2.jar
+WEB-INF/classes/com/myco/myapp/Servlet.class
+META-INF/MANIFEST.MF
+index.html
+front.jsp
+images/small/logo.gif
+images/large/logo.gif
+</pre>
+using Ant's default manifest file. The content of
+<code>WEB-INF/web.xml</code> is identical to
+<code>src/metadata/myapp.xml</code>.
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTasks/zip.html b/jakarta-ant-1.2-src/docs/manual/CoreTasks/zip.html
new file mode 100644
index 0000000..5b89b48
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTasks/zip.html
@@ -0,0 +1,161 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="zip">Zip</a></h2>
+<h3>Description</h3>
+<p>Creates a zipfile.</p>
+<p>The <i>basedir</i> attribute is the reference directory from where to zip.</p>
+<p>Note that file permissions will not be stored in the resulting zipfile.</p>
+<p>It is possible to refine the set of files that are being zipped. This can be
+done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and <i>defaultexcludes</i>
+attributes. With the <i>includes</i> or <i>includesfile</i> attribute you specify the files you want to
+have included by using patterns. The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
+the files you want to have excluded. This is also done with patterns. And
+finally with the <i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns. </p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>basedir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<p>Or, you may place within it nested file sets, or references to file sets.
+In this case <code>basedir</code> is optional; the implicit file set is <i>only used</i>
+if <code>basedir</code> is set. You may use any mixture of the implicit file set
+(with <code>basedir</code> set, and optional attributes like <code>includes</code>
+and optional subelements like <code>&lt;include&gt;</code>); explicit nested
+<code>&lt;fileset&gt;</code> elements so long as at least one fileset total is specified. The ZIP file will
+only reflect the relative paths of files <i>within</i> each fileset. The Zip task and its derivatives know a special form of a fileset named zipfileset that has additional attributes (described below). </p>
+<p>The <code>whenempty</code> parameter controls what happens when no files match.
+If <code>skip</code> (the default), the ZIP is not created and a warning is issued.
+If <code>fail</code>, the ZIP is not created and the build is halted with an error.
+If <code>create</code>, an empty ZIP file (explicitly zero entries) is created,
+which should be recognized as such by compliant ZIP manipulation tools.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td valign="top" align="center"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">zipfile</td>
+    <td valign="top">the zip-file to create.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the directory from which to zip the files.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compress</td>
+    <td valign="top">Not only store data but also compress them, defaults to true</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">whenempty</td>
+    <td valign="top">Behavior when no files match.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Parameters specified as nested elements</h3>
+<h4>fileset</h4>
+<p>The zip task supports any number of nested <a
+href="../CoreTypes/fileset.html"><code>&lt;fileset&gt;</code></a> elements to specify
+the files to be included in the archive.</p>
+<h4>zipfileset</h4>
+<p>A <code>&lt;zipfileset&gt;</code> has three additional attributes: <i>prefix</i>, <i>fullpath</i>, and <i>src</i>.  The 
+<i>prefix</i> and <i>fullpath</i> attributes modify the location of the files when they are placed 
+inside the archive. If the <i>prefix</i> attribute is set, all files in the fileset are prefixed
+with that path in the archive. If the <i>fullpath</i> attribute is set, the file described by the fileset is placed at that 
+exact location in the archive. (The <i>fullpath</i> attribute can only be set for filesets that represent a single file. The <i>prefix</i> and <i>fullpath</i> attributes cannot both be set on the same fileset.)  The <i>src</i> attribute
+may be used in place of the <i>dir</i> attribute to specify a zip file whose
+contents will be extracted and included in the archive.  As with directories, include and exclude patterns may be used to specify a subset of the zip file
+for inclusion in the archive.</p>
+
+<h3>Examples</h3>
+<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
+       basedir=&quot;htdocs/manual&quot;
+  /&gt;</pre>
+<p>zips all files in the <code>htdocs/manual</code> directory into a file called <code>manual.zip</code>
+in the <code>${dist}</code> directory.</p>
+<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
+       basedir=&quot;htdocs/manual&quot;
+       excludes=&quot;mydocs/**, **/todo.html&quot;
+  /&gt;</pre>
+<p>zips all files in the <code>htdocs/manual</code> directory. Files in the directory <code>mydocs</code>,
+or files with the name <code>todo.html</code> are excluded.</p>
+<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;
+       basedir=&quot;htdocs/manual&quot;
+       includes=&quot;api/**/*.html&quot;
+       excludes=&quot;**/todo.html&quot;
+  /&gt;</pre>
+<p>zips all files in the <code>htdocs/manual</code> directory. Only html files under the directory <code>api</code>
+are zipped, and files with the name <code>todo.html</code> are excluded.</p>
+<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;&gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot;/&gt;
+    &lt;fileset dir=&quot;.&quot; includes=&quot;ChangeLog.txt&quot;/&gt;
+  &lt;/zip&gt;</pre>
+<p>zips all files in the <code>htdocs/manual</code> directory, and also adds the file <code>ChangeLog.txt</code> in the
+current directory. <code>ChangeLog.txt</code> will be added to the top of the ZIP file, just as if
+it had been located at <code>htdocs/manual/ChangeLog.txt</code>.</p>
+<pre>  &lt;zip zipfile=&quot;${dist}/manual.zip&quot;&gt;
+    &lt;zipfileset dir=&quot;htdocs/manual&quot; prefix=&quot;docs/user-guide&quot;/&gt;
+    &lt;zipfileset dir=&quot;.&quot; includes=&quot;ChangeLog27.txt&quot; fullpath=&quot;docs/ChangeLog.txt&quot;/&gt;
+    &lt;zipfileset src=&quot;examples.zip&quot; includes=&quot;**/*.html&quot; prefix=&quot;docs/examples&quot;/&gt;
+  &lt;/zip&gt;</pre>
+<p>zips all files in the <code>htdocs/manual</code> directory into the <code>docs/user-guide</code> directory
+in the archive, adds the file <code>ChangeLog27.txt</code> in the
+current directory as <code>docs/ChangeLog.txt</code>, and includes all the html files in <code>examples.zip</code> 
+under <code>docs/examples</code>.  The archive might end up containing the files:</p>
+<pre><code>    docs/user-guide/html/index.html
+    docs/ChangeLog.txt
+    docs/examples/index.html
+</code></pre>
+
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTypes/fileset.html b/jakarta-ant-1.2-src/docs/manual/CoreTypes/fileset.html
new file mode 100644
index 0000000..531615f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTypes/fileset.html
@@ -0,0 +1,92 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="fileset">FileSet</a></h2>
+<p>FileSets are groups of files. These files can be found in a
+directory tree starting in a base directory and are matched by
+patterns taken from a number of <a
+href="patternset.html">PatternSets</a>. FileSets can appear inside tasks
+that support this feature or at the same level as <code>target</code>
+&#150; i.e., as children of <code>project</code>.</p>
+<p>PatternSets can be specified as nested
+<code>&lt;patternset&gt;</code> 
+elements. In addition, FileSet holds an implicit PatternSet and
+supports the nested <code>&lt;include&gt;</code> and
+<code>&lt;exclude&gt;</code> elements of PatternSet directly, as well
+as PatternSet's attributes.</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">the root of the directory tree of this FileSet.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (<code>yes | no</code>); default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      included; all files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file; each line of this file is
+      taken to be an include pattern.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      excluded; no files (except default excludes) are excluded when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file; each line of this file is
+      taken to be an exclude pattern.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<h4>Examples</h4>
+<blockquote><pre>
+&lt;fileset dir=&quot;${server.src}&quot; &gt;
+  &lt;patternset id=&quot;non.test.sources&quot; &gt;
+    &lt;include name=&quot;**/*.java&quot;/&gt;
+    &lt;exclude name=&quot;**/*Test*&quot;/&gt;
+  &lt;/patternset&gt;
+&lt;/fileset&gt;
+</pre></blockquote>
+<p>Groups all files in directory <code>${server.src}</code> that are Java
+source files and don't have the text <code>Test</code> in their
+name.</p>
+<blockquote><pre>
+&lt;fileset dir=&quot;${client.src}&quot; &gt;
+  &lt;patternset refid=&quot;non.test.sources&quot;/&gt;
+&lt;/fileset&gt;
+</pre></blockquote>
+<p>Groups all files in directory <code>${client.src}</code>, using the
+same patterns as the example above.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTypes/mapper.html b/jakarta-ant-1.2-src/docs/manual/CoreTypes/mapper.html
new file mode 100644
index 0000000..f002234
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTypes/mapper.html
@@ -0,0 +1,335 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="mapper">Mapping File Names</a></h2>
+<p>Some tasks take source files and create target files. Depending on
+the task, it may be quite obvious which name a target file will have
+(using <a href="../CoreTasks/javac.html">javac</a>, you know there will be
+<code>.class</code> files for your <code>.java</code> files) &#150; in
+other cases you may want to specify the target files, either to help
+Ant or to get an extra bit of functionality.</p>
+<p>While source files are usually specified as <a
+href="fileset.html">fileset</a>s, you don't specify target files directly &#150;
+instead, you tell Ant how to find the target file(s) for one source file. An
+instance of <code>org.apache.tools.ant.util.FileNameMapper</code> is
+responsible for this. It constructs target file names based on rules
+that can be parameterized with <code>from</code> and <code>to</code>
+attributes &#150; the exact meaning of which is implementation-dependent.</p>
+<p>These instances are defined in <code>&lt;mapper&gt;</code> elements
+with the following attributes:</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">type</td>
+    <td valign="top">specifies one of the built-in implementations.</td>
+    <td rowspan="2" align="center" valign="middle">Exactly one of both</td>
+  </tr>
+  <tr>
+    <td valign="top">classname</td>
+    <td valign="top">specifies the implementation by class name.</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td> 
+    <td valign="top">the classpath to use when looking up
+      <code>classname</code>.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpathref</td>
+    <td valign="top">the classpath to use, given as <a
+      href="../using.html#references">reference</a> to a path defined elsewhere.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">from</td> 
+    <td valign="top">the <code>from</code> attribute for the given
+      implementation.</td>
+    <td align="center" valign="top">Depends on implementation.</td>
+  </tr>
+  <tr>
+    <td valign="top">to</td> 
+    <td valign="top">the <code>to</code> attribute for the given
+      implementation.</td>
+    <td align="center" valign="top">Depends on implementation.</td>
+  </tr>
+</table>
+<p>The classpath can be specified via a nested
+<code>&lt;classpath&gt;</code>, as well &#150; that is,
+a <a href="../using.html#path">path</a>-like structure.</p>
+<p>The built-in mapper types are:</p>
+<h4><a name="identity-mapper">identity</a></h4>
+<p>The target file name is identical to the source file name. Both
+<code>to</code> and <code>from</code> will be ignored.</p>
+<b>Examples:</b>
+<blockquote><pre>
+&lt;mapper type=&quot;identity&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>A.java</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top"><code>C.properties</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+  </tr>
+</table>
+<h4><a name="flatten-mapper">flatten</a></h4>
+<p>The target file name is identical to the source file name, with all
+leading directory information stripped off. Both <code>to</code> and
+<code>from</code> will be ignored.</p>
+<b>Examples:</b>
+<blockquote><pre>
+&lt;mapper type=&quot;flatten&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>A.java</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>B.java</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top"><code>C.properties</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>A.properties</code></td>
+  </tr>
+</table>
+<h4><a name="merge-mapper">merge</a></h4>
+<p>The target file name will always be the same, as defined by
+<code>to</code> &#150; <code>from</code> will be ignored.</p>
+<h5>Examples:</h5>
+<blockquote><pre>
+&lt;mapper type=&quot;merge&quot; to=&quot;archive.tar&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>archive.tar</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>archive.tar</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top"><code>archive.tar</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>archive.tar</code></td>
+  </tr>
+</table>
+<h4><a name="glob-mapper">glob</a></h4>
+<p>Both <code>to</code> and <code>from</code> define patterns that may
+contain at most one <code>*</code>. For each source file that matches
+the <code>from</code> pattern, a target file name will be constructed
+from the <code>to</code> pattern by substituting the <code>*</code> in
+the <code>to</code> pattern with the text that matches the
+<code>*</code> in the <code>from</code> pattern. Source file names
+that don't match the <code>from</code> pattern will be ignored.</p>
+<b>Examples:</b>
+<blockquote><pre>
+&lt;mapper type=&quot;glob&quot; from=&quot;*.java&quot; to=&quot;*.java.bak&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>A.java.bak</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>foo/bar/B.java.bak</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+</table>
+<blockquote><pre>
+&lt;mapper type=&quot;glob&quot; from=&quot;C*ies&quot; to=&quot;Q*y&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top"><code>Q.property</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>Qlasses/dir/dir2/A.property</code></td>
+  </tr>
+</table>
+<h4><a name="regexp-mapper">regexp</a></h4>
+<p>Both <code>to</code> and <code>from</code> define regular
+expressions. If the source file name matches the <code>from</code>
+pattern, the target file name will be constructed from the
+<code>to</code> pattern, using <code>\0</code> to <code>\9</code> as
+back-references for the full
+match (<code>\0</code>) or the matches of the subexpressions in
+parentheses.
+Source
+files not matching the <code>from</code> pattern will be ignored.</p>
+<p>Note that you need to escape a dollar-sign (<code>$</code>) with
+another dollar-sign in Ant.</p>
+<p>The regexp mapper needs a supporting library and an implementation
+of <code>org.apache.tools.ant.util.regexp.RegexpMatcher</code> that
+hides the specifics of the library. Ant comes with implementations for
+<a href="http://jakarta.apache.org/regexp/" target="_top">jakarta-regexp</a> and <a
+href="http://jakarta.apache.org/oro/" target="_top">jakarta-ORO</a>. If you compile
+from sources and plan to use one of them, make sure the libraries are
+in your <code>CLASSPATH</code>. For information about using <a
+href="http://www.cacas.org/~wes/java/" target="_top">gnu.regexp</a> or <a
+href="http://www.crocodile.org/~sts/Rex/" target="_top">gnu.rex</a> with Ant, see <a
+href="http://marc.theaimsgroup.com/?l=ant-dev&m=97550753813481&w=2" target="_top">this</a>
+article.</p>
+<p>Ant will choose the regular-expression library based on the
+following algorithm:</p>
+<ul>
+<li>If the system property
+<code>ant.regexp.matcherimpl</code> has been set, it is taken as the
+name of the class implementing
+<code>org.apache.tools.ant.util.regexp.RegexpMatcher</code> that
+should be used.</li>
+<li>If it has not been set, first try jakarta-ORO; if that
+cannot be found, try jakarta-regexp.</li>
+</ul>
+
+<b>Examples:</b>
+<blockquote><pre>
+&lt;mapper type=&quot;regexp&quot; from=&quot;^(.*)\.java$$&quot; to=&quot;\1.java.bak&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>A.java.bak</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>foo/bar/B.java.bak</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+</table>
+<blockquote><pre>
+&lt;mapper type=&quot;regexp&quot; from=&quot;^(.*)/([^/]+)/([^/]*)$$&quot; to=&quot;\1/\2/\2-\3&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>foo/bar/bar-B.java</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top">ignored</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>Classes/dir/dir2/dir2-A.properties</code></td>
+  </tr>
+</table>
+<blockquote><pre>
+&lt;mapper type=&quot;regexp&quot; from=&quot;^(.*)\.(.*)$$&quot; to=&quot;\2.\1&quot;/&gt;
+</pre></blockquote>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Source file name</b></td>
+    <td valign="top"><b>Target file name</b></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>A.java</code></td>
+    <td valign="top"><code>java.A</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>foo/bar/B.java</code></td>
+    <td valign="top"><code>java.foo/bar/B</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>C.properties</code></td>
+    <td valign="top"><code>properties.C</code></td>
+  </tr>
+  <tr>
+    <td valign="top"><code>Classes/dir/dir2/A.properties</code></td>
+    <td valign="top"><code>properties.Classes/dir/dir2/A</code></td>
+  </tr>
+</table>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/CoreTypes/patternset.html b/jakarta-ant-1.2-src/docs/manual/CoreTypes/patternset.html
new file mode 100644
index 0000000..491a62f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/CoreTypes/patternset.html
@@ -0,0 +1,84 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="patternset">PatternSet</a></h2>
+<p>Patterns can be grouped to sets and later be referenced by their
+<code>id</code>
+attribute. They are defined via a <code>patternset</code> element,
+which can appear nested into a <a href="fileset.html">FileSet</a> or a
+directory-based task that constitutes an implicit FileSet. In addition,
+<code>patternset</code>s can be defined at the same level as
+<code>target</code> &#151; i.e., as children of <code>project</code>.</p>
+<p>Patterns can be specified by nested <code>&lt;include&gt;</code> or
+<code>&lt;exclude&gt;</code> elements or the following attributes.</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file; each line of this file is
+      taken to be an include pattern.</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma-separated list of patterns of files that must be
+      excluded; no files (except default excludes) are excluded when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file; each line of this file is
+      taken to be an exclude pattern.</td>
+  </tr>
+</table>
+
+<h4>Examples</h4>
+<blockquote><pre>
+&lt;patternset id=&quot;non.test.sources&quot; &gt;
+  &lt;include name=&quot;**/*.java&quot;/&gt;
+  &lt;exclude name=&quot;**/*Test*&quot;/&gt;
+&lt;/patternset&gt;
+</pre></blockquote>
+<p>Builds a set of patterns that matches all <code>.java</code> files
+that do not contain the text <code>Test</code> in their name. This set
+can be <a href="../using.html#references">referred</a> to via
+<code>&lt;patternset refid=&quot;non.test.sources&quot;/&gt;</code>,
+by tasks that support this feature, or by FileSets.</p>
+<p>Note that while the <code>includes</code> and
+<code>excludes</code> attributes accept
+multiple elements separated by commas or spaces, the nested
+&lt;include&gt; and &lt;exclude&gt; elements expect their name
+attribute to hold a single pattern.</p>
+<p>The nested &lt;include&gt; and &lt;exclude&gt; elements allow you to use
+if and unless arguments to specify that the element should only be used if a 
+property is set, or that it should be used only if a property is not set.</p>
+<p>For example</p>
+<blockquote><pre>
+&lt;patternset id=&quot;sources&quot; &gt;
+  &lt;include name=&quot;std/**/*.java&quot;/&gt;
+  &lt;include name=&quot;prof/**/*.java&quot; if=&quot;professional&quot;/&gt;
+  &lt;exclude name=&quot;**/*Test*&quot;/&gt;
+&lt;/patternset&gt;
+</pre></blockquote>
+<p>will only include the files in the sub-directory <em>prof</em> if the property
+<em>professional</em> is set to some value.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/Integration/Antidote.html b/jakarta-ant-1.2-src/docs/manual/Integration/Antidote.html
new file mode 100644
index 0000000..5a73d82
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/Integration/Antidote.html
@@ -0,0 +1,111 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "strict.dtd">
+<HTML> 
+  <HEAD> 
+     <TITLE>About Antidote</TITLE> 
+  </HEAD> 
+
+  <BODY> 
+
+    <H1>About Antidote</H1>
+
+    <P>Version 0.1 (2001/02/13)</P>
+
+    <P>Authors: 
+    <A HREF="mailto:simeon@fitch.net">Simeon H.K. Fitch</A>
+    </P>
+
+    <H2>Overview</H2> 
+
+    <P>Antidote is the <A
+    HREF="http://jakarta.apache.org/ant/index.html">Ant</A> subproject
+    for developing a graphical user interface to facilitate the
+    efficient use of Ant. In general, its purpose is to allow the
+    quick generation, modification, and use of Ant build files,
+    helping the user define a build process and track down build
+    problems. It is not meant to be an IDE, but an enabler for the
+    powerful features available in Ant, particularlyl for novice
+    users, or users who want a rapid way of controlling their build
+    process.</P>
+
+
+    <H2>Status</H2>
+
+    <P>Antidote is still in the early stages of development, but does
+    have a set of usable features, including:
+    <UL>
+      <LI>Reading Ant build files.</LI>
+      <LI>Selecting targets and executing them.</LI>
+      <LI>Context highlighted build status console.</LI>
+      <LI>Modification of (some) build file components.</LI>
+      <LI>Saving modified build file.</LI>
+    </UL>
+    </P>
+
+    <P>Current development tasks include:
+    <UL>
+      <LI>A more complete set of target and task editing
+      capabilities.</LI>
+      <LI>A wizard for creating basic build files, including importing
+      existing code bases.</LI>
+      <LI>Better build progress monitoring.</LI>
+    </UL>
+    </P>
+
+    <P>The Antidote source distribution comes with requirements and
+    design documentation that better cover the details of application
+    architecture, how to develop against it, and what the long term
+    goals are. Furthermore, there is a <code>TODO</code> file listing
+    the detailed, near-term tasks that need accomplishing.</P>
+
+    <H2>Getting Involved</H2>
+
+    <P>The source code for Antidote is included with the <A
+    HREF="http://jakarta.apache.org/site/cvsindex.html">CVS</A>
+    version of <A
+    HREF="http://jakarta.apache.org/cvsweb/index.cgi/jakarta-ant">Ant</A>,
+    starting in the directory <A
+    HREF="http://jakarta.apache.org/cvsweb/index.cgi/jakarta-ant/src/antidote">
+    jakarta-ant/src/antidote</A>. All the existing documentation can
+    be found there where new contributors should read:
+    <UL>
+      <LI><A
+      HREF="http://jakarta.apache.org/cvsweb/index.cgi/~checkout~/jakarta-ant/src/antidote/docs/design-overview.html">Design
+      Overview</A></LI> 
+      <LI><A HREF="http://jakarta.apache.org/cvsweb/index.cgi/~checkout~/jakarta-ant/src/antidote/docs/gui-requirements.html">Feature List</A></LI>
+      <LI><A
+      HREF="http://jakarta.apache.org/cvsweb/index.cgi/~checkout~/jakarta-ant/src/antidote/docs/gui-ideas.txt">Idea Refinement</A></LI>
+      <LI><A
+      HREF="http://jakarta.apache.org/cvsweb/index.cgi/~checkout~/jakarta-ant/src/antidote/docs/new-module-howto.html">New Module HOWTO</A></LI>
+      <LI><A
+      HREF="http://jakarta.apache.org/cvsweb/index.cgi/~checkout~/jakarta-ant/src/antidote/docs/uml/index.html">Static
+      Class Diagrams</A></LI>
+    </UL>
+
+
+    <P>Online discussions about Antidote occur on the <A
+    HREF="http://jakarta.apache.org/site/mail.html">jakarta-ant
+    mailing list</A>. The application infrastructure is fairly
+    complete, but there are almost unlimited oppotunities for feature
+    contributions.
+
+    <P>Asipring contributors new to the Jakarta Project should
+    (carefully) read the following for details on the contribution
+    process:
+    <UL>
+      <LI><A
+      HREF="http://jakarta.apache.org/site/getinvolved.html">Get
+      Involved</A></LI>
+      <LI><A
+      HREF="http://jakarta.apache.org/site/guidelines.html">Project
+      Guidelines</A></LI>
+      <LI><A HREF="http://jakarta.apache.org/site/source.html">Source
+      Repositories (how to contribute patches)</A></LI>
+    </UL>
+    
+
+    <HR>
+    <P ALIGN="center">Copyright &copy; 2000 Apache Software Foundation. All
+    rights Reserved.</P>
+
+  </BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/docs/manual/Integration/VAJAntTool.html b/jakarta-ant-1.2-src/docs/manual/Integration/VAJAntTool.html
new file mode 100644
index 0000000..2cfe696
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/Integration/VAJAntTool.html
@@ -0,0 +1,590 @@
+<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
+<html>
+<head>
+  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+  <meta http-equiv="Content-Language" content="en-us">
+  <title>Visual Age for Java Tasks and Plugin User Manual</title>
+</head>
+<body>
+
+<h1>Visual Age for Java Tasks and Plugin User Manual</h1>
+ <a name="authors"></a>by<ul>
+  <li>Wolf Siberski
+      (<a href="mailto:wolf.siberski@tui.de"> wolf.siberski@tui.de</a> )</li>
+  <li>Christoph Wilhelms
+      (<a href="mailto:christoph.wilhelms@tui.de"> christoph.wilhelms@tui.de</a>)</li>
+</ul>
+Version 1.1 - 2001/02/14<br>
+<hr>
+<h2>Table of Contents</h2>
+<ul>
+  <li><a href="#introduction">Introduction</a></li>
+  <li><a href="#tasks">The Tasks</a><a href="#introduction"></a></li>
+  <ul>
+    <li><a href="#vajload">VAJLoad</a></li>
+    <li><a href="#vajexport">VAJExport</a></li>
+    <li><a href="#vajimport">VAJImport</a></li>
+  </ul>
+  <li><a href="#sample_buildfile">A sample build file</a><br></li>
+  <li><a href="#plugin">The Plugin</a></li>
+  <ul>
+    <li><a href="#installation">Installation</a></li>
+    <li><a href="#usage">Usage</a></li>
+  </ul>
+  <li><a href="#faq">Frequently Asked Questions</a></li>
+  <li><a href="#va_versions">Visual Age Versions</a></li>
+  <li><a href="#history">History</a><a href="#history"></a></li>
+</ul>
+
+<hr>
+<h2><a name="introduction"></a>Introduction</h2>
+Visual Age for Java is a great Java IDE, but it lacks decent
+build support; for creating deliveries. On the other hand,
+Ant supports the build process very good, but is
+(at least at the moment) command line based. So we decided
+to write some tasks to access the VAJ repository and
+a small visual Ant frontend to make running Ant from VAJ possible.
+We use the Tool API to integrate Ant in VisualAge for Java.
+In combination  with the VAJ tasks (vajload, vajexport, vajimport)
+you can load defined defined  versions of projects into your workspace,
+export the source code, compile it with an external compiler
+and build a jar without leaving the IDE. Of course compile
+messages are viewed in a logging window. Concluding: This
+tool provides decent deployment support VAJ has not (out of the box).<br>
+
+<h2><a name="tasks"></a>The Tasks</h2>
+At the moment there are three tasks which help integrating the VAJ repositorycontents into an external build process:
+
+<table cellpadding="2" cellspacing="2" border="0" width="500">
+   <tbody>
+     <tr valign="Top">
+       <td valign="Top"><a href="#vajload">VAJLoad</a><br>
+       </td>
+       <td valign="Top"> loads specified versions into the workspace<br>
+       </td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top"><a href="#vajexport">VAJExport</a><br>
+       </td>
+       <td valign="Top"> exports specified packages into the file system<br>
+       </td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top"><a href="#vajimport">VAJImport</a><br>
+       </td>
+       <td valign="Top"> imports specified files into the workspace<br>
+       </td>
+     </tr>
+  </tbody>
+</table>
+These tasks are described in detail below.
+
+<hr>
+<h2><a name="vajload"></a>VAJLoad</h2>
+<h3>Description:</h3>
+<p>Loads a specified VAJ project version into the workspace.</p>
+
+<h3>Parameters</h3>
+<p>none</p>
+
+<h3>Parameters specified as nested elements</h3>
+<h4>vajproject</h4>
+<table border="1" cellpadding="2" cellspacing="0">
+   <tbody>
+     <tr>
+       <td valign="Top"><b>Attribute</b></td>
+       <td valign="Top"><b>Description</b></td>
+       <td align="Center" valign="Top"><b>Required</b></td>
+     </tr>
+     <tr>
+       <td valign="Top">name</td>
+       <td valign="Top">name of the VAJ project to load into the workspace</td>       <td valign="Top" align="Center">yes</td>
+     </tr>
+     <tr>
+       <td valign="Top">version</td>
+       <td valign="Top">name of the requested version</td>
+       <td valign="Top" align="Center">yes</td>
+     </tr>
+
+  </tbody>
+</table>
+
+<h3>Example</h3>
+<pre>
+&lt;vajload&gt;
+    &lt;vajproject name="My Testcases" version="1.7beta" /&gt;
+    &lt;vajproject name="JUnit" version="3.2" /&gt;
+&lt;/vajload&gt;
+</pre>
+
+<hr>
+<h2><a name="vajexport"></a>VAJExport</h2>
+
+<h3>Description:</h3>
+<p>Exports Java source files, class files and/or resources from the workspace
+to the file system. Exports can be specified by giving the VAJ projectname and package name(s). This works very similar to <a href="index.html#fileset">
+FileSets</a>. </p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+   <tbody>
+     <tr>
+       <td valign="Top"><b>Attribute</b></td>
+       <td valign="Top"><b>Description</b></td>
+       <td align="Center" valign="Top"><b>Required</b></td>
+     </tr>
+     <tr>
+       <td valign="Top">destdir</td>
+       <td valign="Top">location to store the exported files</td>
+       <td valign="Top" align="Center">yes</td>
+     </tr>
+     <tr>
+       <td valign="Top">exportSources</td>
+       <td valign="Top">export source files (default: "yes")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">exportResources</td>
+       <td valign="Top">export resource files (default: "yes")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">exportClasses</td>
+       <td valign="Top">export class files (default: "no")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">exportDebugInfo</td>
+       <td valign="Top">include debug info in exported
+       class files (default: "no")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">defaultexcludes       </td>
+       <td valign="Top">use default excludes when exporting (default: "yes")       <td valign="Top" align="Center">no</td>
+     </tr>
+  </tbody>
+</table>
+
+<h3>Parameters specified as nested elements</h3>
+
+<h4>include</h4>
+specifies the packages to include into the export
+
+<table border="1" cellpadding="2" cellspacing="0">
+   <tbody>
+     <tr>
+       <td valign="Top"><b>Attribute</b></td>
+       <td valign="Top"><b>Description</b></td>
+       <td align="Center" valign="Top"><b>Required</b></td>
+     </tr>
+     <tr>
+       <td valign="Top">name</td>
+       <td valign="Top">name of the VAJ project and package to export.<br>
+              The first element of the name must be the project name, <br>
+              then the package name elements separated by '/'.</td>
+       <td valign="Top">yes</td>
+     </tr>
+  </tbody>
+</table>
+
+<h4>exclude</h4>
+specifies the packages to exclude from the export<br>
+
+<table border="1" cellpadding="2" cellspacing="0">
+   <tbody>
+     <tr>
+       <td valign="Top"><b>Attribute</b></td>
+       <td valign="Top"><b>Description</b></td>
+       <td align="Center" valign="Top"><b>Required</b></td>
+     </tr>
+     <tr>
+       <td valign="Top">name</td>
+       <td valign="Top">name of the VAJ project/package not to export</td>
+       <td valign="Top" align="Center">yes</td>
+     </tr>
+  </tbody>
+</table>
+
+<h3>Example</h3>
+<pre>
+&lt;vajexport destdir="${src.dir}" exportResources="no"&gt;
+    &lt;include name="MyProject/**"/&gt;
+    &lt;exclude name="MyProject/test/**"/&gt;
+&lt;/vajexport&gt;
+</pre>
+This example exports all packages in the VAJ project 'MyProject', except
+packages starting with 'test'.
+<hr>
+<h2><a name="vajimport"></a>VAJImport</h2>
+
+<h3>Description:</h3>
+<p>Imports Java source files, class files and/or resources from the file
+system into VAJ. These imports can be specified with a fileset. </p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+   <tbody>
+     <tr>
+       <td valign="Top"><b>Attribute</b></td>
+       <td valign="Top"><b>Description</b></td>
+       <td align="Center" valign="Top"><b>Required</b></td>
+     </tr>
+     <tr>
+       <td valign="Top">vajProject</td>
+       <td valign="Top">imported files are added to this VAJ project</td>
+       <td valign="Top" align="Center">yes</td>
+     </tr>
+     <tr>
+       <td valign="Top">importSources</td>
+       <td valign="Top">export source files (default: "yes")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">importResources</td>
+       <td valign="Top">export resource files (default: "yes")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">importClasses</td>
+       <td valign="Top">export class files (default: "no")</td>
+       <td valign="Top" align="Center">no</td>
+     </tr>
+  </tbody>
+</table>
+
+<h3>Parameters specified as nested elements</h3>
+
+<h4>fileset</h4>
+A <a href="index.html#fileset">FileSet</a> specifies the files to import.
+<h3>Example</h3>
+<pre>
+&lt;vajimport project="Test" importClasses="true"&gt;
+    &lt;fileset dir="${import.dir}"&gt;
+        &lt;include name="com/sample/**/*.class"/&gt;
+        &lt;exclude name="com/sample/test/**"/&gt
+    &lt;/fileset&gt;
+&lt;/vajimport&gt;
+</pre>
+This example imports all class files in the directory ${import.dir}/com/sample
+excluding those in the subdirectory test<br>
+
+<hr>
+<h2><a name="sample_buildfile"></a>A sample build file</h2>
+This is a sample build file which builds a zip file useful for distribution
+of the VAJ plugin. The build file exports a specific version of Ant, compiles
+it, extracts necessary helper classes and zips everything together. This
+is useful as complete example as well as to deploy Ant in a team where all
+developers use VAJ. The resulting zip file must be unzipped in
+<tt>&lt;VAJInstallDir&gt;\ide\tools\org-apache-tools-ant</tt>.
+For more information see the <a href="#installation">installation</a> section.<br>
+<br>
+<pre>
+&lt;?xml version="1.0"?&gt;
+&lt;!-- ======================================================================= --&gt;
+&lt;!-- Builds a binary distribution of the VAJ Ant Plugin                      --&gt;
+&lt;!-- ======================================================================= --&gt;
+&lt;project name="anttool" default="buildall" basedir="c:\temp\anttool"&gt;
+
+  &lt;property name="src.dir" value="${basedir}/src"/&gt;
+  &lt;property name="zip.dir" value="${basedir}/dist"/&gt;
+  &lt;property name="build.classes" value="${basedir}/classes"/&gt;
+
+  &lt;!-- location of the unzipped Ant source distribution  --&gt;
+  &lt;property name="antdistribution.dir" value="u:\ant-1.3beta1"/&gt;
+
+  &lt;!-- VAJ install dir --&gt;
+  &lt;property name="vaj.dir" value="C:\IBMVJava2"/&gt;
+
+  &lt;path id="classpath"&gt;
+      &lt;pathelement location="${src.dir}"/&gt;
+      &lt;pathelement location="${vaj.dir}\IDE\project_resources\IBM IDE Utility class libraries" /&gt;
+      &lt;pathelement location="${build.classes}"/&gt;
+  &lt;/path&gt;
+
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Load Projects into Workspace                                        --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="load" description="load projects"&gt;
+    &lt;vajload&gt;
+      &lt;project name="Ant" version="1.3"/&gt;
+      &lt;project name="Apache Oro RegExp" version="2.0.1"/&gt;
+    &lt;/vajload&gt;
+  &lt;/target&gt;
+
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Creates the build dirs                                              --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="preparedirs"&gt;
+    &lt;mkdir dir="${basedir}"/&gt;
+    &lt;mkdir dir="${src.dir}"/&gt;
+    &lt;mkdir dir="${zip.dir}"/&gt;
+    &lt;mkdir dir="${build.classes}"/&gt;
+  &lt;/target&gt;
+
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Export from VA                                                      --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="export" depends="preparedirs" description="export projects"&gt;
+    &lt;mkdir dir="${src.dir}"/&gt;
+    &lt;!-- Export all Ant sources except optional tasks and the Oro sources --&gt;
+    &lt;vajexport destdir="${src.dir}"&gt;
+      &lt;include name="Ant/**"/&gt;
+      &lt;exclude name="Ant/**/optional/**"/&gt;
+      &lt;exclude name="Ant/org/apache/tools/ant/gui/**"/&gt;
+      &lt;include name="Apache Oro*/**"/&gt;
+    &lt;/vajexport&gt;
+    &lt;!-- Export selected optional tasks --&gt;
+    &lt;vajexport destdir="${src.dir}"&gt;
+      &lt;include name="Ant/org/apache/tools/ant/taskdefs/optional/ide/**"/&gt;
+    &lt;/vajexport&gt;
+  &lt;/target&gt;
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Unzip necessary libraries                                           --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="expand"&gt;
+    &lt;mkdir dir="${build.classes}"/&gt;
+    &lt;unzip src="${antdistribution.dir}\lib\parser.jar"
+           dest="${build.classes}"
+    /&gt;
+    &lt;unzip src="${antdistribution.dir}\lib\jaxp.jar"
+           dest="${build.classes}"
+    /&gt;
+    &lt;delete dir="${build.classes}\META-INF" /&gt;
+  &lt;/target&gt;
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Compile the source code                                            --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="compile" depends="expand" description="compile java sources"&gt;
+    &lt;mkdir dir="${build.classes}"/&gt;
+    &lt;javac srcdir="${src.dir}"
+           destdir="${build.classes}"
+           debug="on"
+           deprecation="off"
+           optimize="on" &gt;
+      &lt;classpath refid="classpath" /&gt;
+      &lt;include name="org/apache/**"/&gt;
+      &lt;exclude name="**/JakartaRegexpMatcher.java"/&gt;
+    &lt;/javac&gt;
+  &lt;/target&gt;
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Copy resources and zip everything together                           --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="zip" depends="compile" description="creates zip distribution"&gt;
+    &lt;copy todir="${build.classes}"&gt;
+      &lt;fileset dir="${src.dir}"&gt;
+          &lt;include name="org/apache/**"/&gt;
+          &lt;exclude name="**/*.java"/&gt;
+      &lt;/fileset&gt;
+    &lt;/copy&gt;
+    &lt;mkdir dir="${build.classes}/doc"/&gt;
+    &lt;copy todir="${build.classes}/doc" overwrite="yes"&gt;
+      &lt;fileset dir="${antdistribution.dir}/docs"&gt;
+          &lt;include name="VAJAnttool.html, toolmenu.gif, anttool1.gif"/&gt;
+      &lt;/fileset&gt;
+    &lt;/copy&gt;
+    &lt;copy file="${antdistribution.dir}/src/main/org/apache/tools/ant/taskdefs/optional/ide/default.ini" todir="${build.classes}" overwrite="yes"/&gt;
+    &lt;mkdir dir="${zip.dir}"/&gt;
+    &lt;zip basedir="${build.classes}" zipfile="${zip.dir}/anttool.zip" /&gt;
+  &lt;/target&gt;
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Cleans source and class dirs                                        --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="clean" depends="preparedirs" description="removes all files from src and build tree"&gt;
+    &lt;delete&gt;
+      &lt;fileset dir="${src.dir}"/&gt;
+    &lt;/delete&gt;
+    &lt;delete&gt;
+      &lt;fileset dir="${build.classes}"/&gt;
+    &lt;/delete&gt;
+    &lt;delete&gt;
+      &lt;fileset dir="${zip.dir}"/&gt;
+    &lt;/delete&gt;
+  &lt;/target&gt;
+
+  &lt;!-- =================================================================== --&gt;
+  &lt;!-- Cleans the build dir, loads required project versions, exports,     --&gt;
+  &lt;!-- compiles and zips the Plugin                                        --&gt;
+  &lt;!-- =================================================================== --&gt;
+  &lt;target name="buildall" depends="clean, load, export, zip" description="build all"&gt;
+  &lt;/target&gt;
+&lt;/project&gt;
+</pre>
+
+<hr>
+<h2><a name="plugin"></a>The Plugin</h2>
+The tasks are usable within VAJ by running the
+org.apache.tools.ant.Main class, but this is
+quite inconvenient. Therefore a small GUI is
+provided which allows selecting a build file
+and executing its targets. This Plugin is accessible
+from the VAJ Tools menu (see <a href="#usage">Usage</a>).
+
+<hr>
+<h2><a name="installation"></a>Installation</h2>
+At the moment the installation has it's rough edges. If something
+described below doesn't work for You, it's probably not Your fault
+but incomplete/wrong instructions. In this case, please contact one
+of the <a href="#authors">authors</a>.
+We assume <font face="Courier">C:\IBMVJava</font> as VAJ installdirectory. If You have installed it elsewhere, adapt the pathes below.
+Execute following steps to get the PlugIn up and running:
+<ul>
+  <li>install the Visual Age IDE Tools (via File-&gt;Quick Start-&gt;
+      Add feature-&gt;'IBM IDE Utility class libraries'
+  </li>
+  <li>import an appropriate XML parser to VAJ (we use Xerces 1.2.0 and are
+      happy with it). Unfortunately the XML parser delivered with VAJ (in
+      the project 'IBM XML Parser for Java') doesn't work with Ant. You have to
+      remove that project (temporarily) from the workspace before importing another
+      XML implementation.
+  </li>
+
+  <li>import the Ant sources into VAJ.</li>
+  <li>Create the directory <font face="Courier">
+      C:\IBMVJava\ide\tools\org-apache-tools-ant</font>.
+  </li>
+  <li>export the Ant and XML parser class files into this directory. Be sure      to select class files and resources. Sources don't have to be exported.      Some optional tasks have errors and can't be exported when You      don't have the necessary packages in Your workspace (e.g. junit      task, ejbc task). If You need this tasks either import these packages      into VAJ, too, or copy the .class files directly from the binary      distribution.
+  </li>
+  <li>copy <font face="Courier">default.ini</font> (in <font face="Courier">
+      jakarta-ant\src\...\taskdefs\optional\ide</font>)     to <font face="Courier">
+      C:\IBMVJava\ide\tools\org-apache-tools-ant\default.ini</font>.
+  </li>
+  <li>if you want to access this help from the Workbench, create the      directory <font face="Courier"> C:\IBMVJava\ide\tools\org-apache-tools-ant\doc</font>
+      and copy the files     <font face="Courier">VAJAntTool.html</font>,
+      <font face="Courier">toolmenu.gif</font> and     <font face="Courier">
+      anttool1.gif</font> to it.
+  </li>
+  <li>VAJ has to be restarted to recognize the new tool.</li>
+  <li>Now if You open the context menu of a project, You should see the entry     'Ant Build' in the Tools submenu (see <a href="#usage">Usage</a>).
+  </li>
+  <li>Make sure the tool works as expected. Now You can remove Ant and the      imported XML parser from Your workspace (and optionally add the
+      IBM parser again).
+  </li>
+</ul>
+
+<hr>
+<h2><a name="usage"></a>Usage</h2>
+Beeing sure the tool is installed correctly and your Ant buildfile is configured, it is really easy to use.<br>
+Go to your Workbench, select the project you want to deploy and
+open its context menu. In the submenu <i>Tools</i> you should find
+the new entry <i>Ant Build</i>. Klick it to start the tool!<center><img src="toolmenu.gif" border="0" height="246" width="393"></center>
+           After a short time this frame should pop up:
+<center><img src="anttool1.gif" border="0" height="222" width="389"></center>
+           This frame contains the following elements:
+<ul>
+  <li>A menubar with some options described later</li>
+  <li>The name of your selected VAJ project</li>
+  <li>An entry field for the Ant XML buildfile with a browse [...] button.      The full qualified filename, including the directory is needed here.
+  </li>
+  <li>A list with tasks specified in the buildfile. Until your first save      of the build info (described later), this list will be empty. When
+      loading a build file by the <i>Reload Project</i> button, this list
+      is filled with all tasks which have a description attribute. The
+      task you select in this list will be executed when pressing the
+      <i> Execute Task</i> button.
+  </li>
+  <li>A pulldown box for specifying the log level.</li>
+  <li>Three buttons. Two of them I have already described and the third one      is just the <i>Close </i>button to exit our small tool!
+  </li>
+</ul>
+After you have set up your buildprocess you might find it usefulto save the data you've just entered, so we implemented an option tosave it to the  repository into your selected project. Make sure that youhave an open edition of your project before selecting
+<i>Save BuildInfo To Repository</i> from  the <i>File</i> menu.
+Now your information is saved to this edition of your  project and will
+be loaded automatically the next time you start <i>Ant Build</i>.<br>
+If you have closed the log window accidentally, it can be reopenedwith the <i>Log</i> item in the <i>File</i> menu, and if you want toknow who developed this, just select <i>About</i> in the <i>Help</i> menu.
+<hr>
+<h2><a name="faq"></a>Frequently Asked Questions</h2>
+
+<p><b>Q: I want to load, export and build more then one Visual Age project
+to one jar! How to?</b><br>
+A: The VA tasks are able to load and export several Projects allat once. You can choose whatever project you like for storing the tool
+information, it doesn't really matter
+</p>
+<p><b>Q: When I load my build file, the list of targets is empty. Why?</b><br>
+A: You need to add the optional "description" parameter to the targets You
+want to come up in the list. Then reload the build file in the "ant build"
+tool. We chose to display only targets with description to allow the build
+file developer to distinguish between targets for end users and helper targets.
+</p>
+<p><b>Q: Is there a sample build file available? </b><br>
+A: Now You can find an <a href="#sample_buildfile">example</a> in this manual
+</p>
+
+<p><b>Q: Why does it export my entire workspace when I've already implicitly
+selected a project when starting the Tool?</b><br>
+A: This selection does not carry into the buildfile you are using. Set the
+Project name at the beginning of the "includes" parameter.
+</p>
+<p><b>Q: When I import Ant into my Workspace, I get Problems reported. Can I
+ignore them?</b><br>
+A: It depends on the problems reported, and what you want to do with Ant.
+Problems you can't ignore:
+<ul>
+  <li>Classes from javax.xml.parser missing - install a compatible parser
+      (see <a href="#installation">installation</a>)
+  </li>
+  <li>Classes from com.ibm.ivj.util missing - install the Visual Age IDE
+      Utility feature  (see <a href="#installation">installation</a>).
+  </li>
+</ul>
+</p>
+
+<p><b>Q: Why is the task name vajload when the class is called VAJLoadProjects?</b><br>
+A: At the moment this task can load only project versions. This is reflected
+by the class name. It may be extended to load package and class versions,
+too, and we didn't want to let these extensions affect the build files. Therefore
+we chose the more general name vajload as task name.
+</p>
+<p><b>Q: I want to use the same buildfile both within Visual Age and from the
+command line using my regular Ant environment. What do I need to be aware
+of?</b><br>
+A: The three Visual Age Tasks won't work when executing Ant from the command
+line.
+</p>
+<p><b>Q: How do I control the import/export of sourcefiles, compiled files and
+project resources explicity?</b><br>
+A: Via the Boolean values exportClasses (default false) exportSources (default
+true) and exportResources (default true). In some situations, Resources are
+not exported correctly without this being explicity set.
+</p>
+<hr>
+<h2><a name="known_problems"></a>Known Problems</h2>
+<ul>
+  <li>Exporting a package containing just resources doesn't work. This is
+      a VAJ Tool API bug. Workaround: create a dummy class and set 'exportSources'
+      to false.
+  </li>
+</ul>
+<hr>
+
+<h2><a name="va_versions"></a>VisualAge for Java Versions</h2>
+This tool integration has been tested with versions 3.02 and 3.5of VisualAge for Java. It should run with the 2.x Versions, too, butwe didn't try. The graphical user interface is build with AWT so it isJDK independent by now.
+<hr>
+
+<h2><a name="history"></a>History</h2>
+<table cellpadding="2" cellspacing="2" border="1" width="400">
+   <tbody>
+     <tr valign="Top">
+       <td valign="Top">1.0</td>
+       <td valign="Top">2000/09/11</td>
+       <td valign="Top">Initial Version</td>
+     </tr>
+     <tr valign="Top">
+       <td valign="Top">1.1</td>
+       <td valign="Top">2001/02/14</td>
+       <td valign="Top">Added Task documentation and more FAQs (thanks to
+                        Richard Bourke for the FAQ additions)
+       </td>
+     </tr>
+  </tbody>
+</table>
+<hr>
+<center>Copyright &copy; 2001 Apache Software Foundation. All rights Reserved.</center>
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/Integration/anttool1.gif b/jakarta-ant-1.2-src/docs/manual/Integration/anttool1.gif
new file mode 100644
index 0000000..6859656
Binary files /dev/null and b/jakarta-ant-1.2-src/docs/manual/Integration/anttool1.gif differ
diff --git a/jakarta-ant-1.2-src/docs/manual/Integration/toolmenu.gif b/jakarta-ant-1.2-src/docs/manual/Integration/toolmenu.gif
new file mode 100644
index 0000000..164db44
Binary files /dev/null and b/jakarta-ant-1.2-src/docs/manual/Integration/toolmenu.gif differ
diff --git a/jakarta-ant-1.2-src/docs/manual/LICENSE b/jakarta-ant-1.2-src/docs/manual/LICENSE
new file mode 100644
index 0000000..032be14
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/LICENSE
@@ -0,0 +1,48 @@
+/*
+ * ============================================================================
+ *                   The Apache Software License, Version 1.1
+ * ============================================================================
+ * 
+ *    Copyright (C) 1999 The Apache Software Foundation. All rights reserved.
+ * 
+ * Redistribution and use in source and binary forms, with or without modifica-
+ * tion, are permitted provided that the following conditions are met:
+ * 
+ * 1. Redistributions of  source code must  retain the above copyright  notice,
+ *    this list of conditions and the following disclaimer.
+ * 
+ * 2. Redistributions in binary form must reproduce the above copyright notice,
+ *    this list of conditions and the following disclaimer in the documentation
+ *    and/or other materials provided with the distribution.
+ * 
+ * 3. The end-user documentation included with the redistribution, if any, must
+ *    include  the following  acknowledgment:  "This product includes  software
+ *    developed  by the  Apache Software Foundation  (http://www.apache.org/)."
+ *    Alternately, this  acknowledgment may  appear in the software itself,  if
+ *    and wherever such third-party acknowledgments normally appear.
+ * 
+ * 4. The names "Ant" and  "Apache Software Foundation"  must not be used to
+ *    endorse  or promote  products derived  from this  software without  prior
+ *    written permission. For written permission, please contact
+ *    apache@apache.org.
+ * 
+ * 5. Products  derived from this software may not  be called "Apache", nor may
+ *    "Apache" appear  in their name,  without prior written permission  of the
+ *    Apache Software Foundation.
+ * 
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,
+ * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
+ * FITNESS  FOR A PARTICULAR  PURPOSE ARE  DISCLAIMED.  IN NO  EVENT SHALL  THE
+ * APACHE SOFTWARE  FOUNDATION  OR ITS CONTRIBUTORS  BE LIABLE FOR  ANY DIRECT,
+ * INDIRECT, INCIDENTAL, SPECIAL,  EXEMPLARY, OR CONSEQUENTIAL  DAMAGES (INCLU-
+ * DING, BUT NOT LIMITED TO, PROCUREMENT  OF SUBSTITUTE GOODS OR SERVICES; LOSS
+ * OF USE, DATA, OR  PROFITS; OR BUSINESS  INTERRUPTION)  HOWEVER CAUSED AND ON
+ * ANY  THEORY OF LIABILITY,  WHETHER  IN CONTRACT,  STRICT LIABILITY,  OR TORT
+ * (INCLUDING  NEGLIGENCE OR  OTHERWISE) ARISING IN  ANY WAY OUT OF THE  USE OF
+ * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ * 
+ * This software  consists of voluntary contributions made  by many individuals
+ * on behalf of the  Apache Software Foundation.  For more  information  on the 
+ * Apache Software Foundation, please see <http://www.apache.org/>.
+ *
+ */
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/antlr.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/antlr.html
new file mode 100644
index 0000000..4762424
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/antlr.html
@@ -0,0 +1,78 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>ANTLR Task</title>
+</head>
+
+<body>
+
+<h2><a name="antlr">ANTLR</a></h2>
+<h3>Description</h3>
+<p>
+  Invokes the <a HREF="http://www.antlr.org/" target="_top">ANTLR</a> Translator generator
+  on a grammar file.
+</p>
+<p>
+  To use the ANTLR task, set the <i>target</i> attribute to the name of the
+  grammar file to process.  Optionally, you can also set the
+  <i>outputdirectory</i> to write the generated file to a specific directory.
+  Otherwise ANTLR writes the generated files to the directory containing
+  the grammar file.
+</p>
+<p>
+  This task only invokes ANTLR if the grammar file is newer than the generated
+  files.
+</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">target</td>
+    <td valign="top">The grammar file to process.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">outputdirectory</td>
+    <td valign="top">
+      The directory to write the generated files to.  If not set, the files
+      are written to the directory containing the grammar file.
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">fork</td>
+    <td valign="top">Run ANTLR in a separate VM.</td>
+    <td align="center" valign="top">No, default is &quot;off&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">dir</td>
+    <td valign="top">The directory to invoke the VM in. (ignored if
+      fork is disabled)</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<h3>Example</h3>
+<blockquote><pre>
+&lt;antlr
+    target=&quot;etc/java.g&quot;
+    outputdirectory=&quot;build/src&quot;
+/&gt;
+</pre></blockquote>
+<p>
+  This invokes ANTLR on grammar file etc/java.g, writing the generated
+  files to build/src.
+</p>
+<hr>
+
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/cab.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/cab.html
new file mode 100644
index 0000000..ddd974b
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/cab.html
@@ -0,0 +1,130 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="cab">Cab</a></h2>
+<h3>Description</h3>
+<p>The cab task creates Microsoft cab archive files.  It is invoked
+similar to the <a href="../CoreTasks/jar.html">jar</a> or <a href="../CoreTasks/zip.html">zip</a> tasks.
+This task will work on Windows using the external cabarc tool (provided by Microsoft)
+which must be located in your executable path.</p>
+<p>To use this task on other platforms you need to download and compile libcabinet from 
+<a href="http://trill.cis.fordham.edu/~barbacha/cabinet_library/">
+http://trill.cis.fordham.edu/~barbacha/cabinet_library/</a>.</p>
+<p>See the section on <a href="../dirtasks.html#directorybasedtasks">directory based
+tasks</a>, on how the inclusion/exclusion of files works, and how to
+write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>basedir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">cabfile</td>
+    <td valign="top">the name of the cab file to create.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the directory to start archiving files from.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">set to &quot;yes&quot; if you want to see the output from
+      the cabarc tool.  defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compress</td>
+    <td valign="top">set to &quot;no&quot; to store files without compressing.
+      defaults to &quot;yes&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">options</td>
+    <td valign="top">use to set additional command-line options for
+      the cabarc tool.  should not normally be necessary.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that
+      must be included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that
+      must be excluded. No files (except default excludes) are excluded
+      when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used
+      or not (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
+     basedir=&quot;htdocs/manual&quot; 
+  /&gt;
+</pre></blockquote>
+<p>cabs all files in the htdocs/manual directory into a file called
+manual.cab in the ${dist} directory.</p>
+<blockquote><pre>
+&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
+     basedir=&quot;htdocs/manual&quot;
+     excludes=&quot;mydocs/**, **/todo.html&quot;
+  /&gt;
+</pre></blockquote>
+<p>cabs all files in the htdocs/manual directory into a file called
+manual.cab in the ${dist} directory. Files in the directory mydocs,
+or files with the name todo.html are excluded.</p>
+<blockquote><pre>
+&lt;cab cabfile=&quot;${dist}/manual.cab&quot;
+     basedir=&quot;htdocs/manual&quot;
+     includes=&quot;api/**/*.html&quot;
+     excludes=&quot;**/todo.html&quot;
+     verbose=&quot;yes&quot;
+  /&gt;
+</pre></blockquote>
+<p>Cab all files in the htdocs/manual directory into a file called
+manual.cab in the ${dist} directory. Only html files under the
+directory api are archived, and files with the name todo.html are
+excluded. Output from the cabarc tool is displayed in the build
+output.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/clearcase.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/clearcase.html
new file mode 100644
index 0000000..82fb7e3
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/clearcase.html
@@ -0,0 +1,258 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant</title>
+</head>
+
+<body>
+
+<h1>ClearCase Support</h1>
+<ul>
+  <li><a href="#cccheckin">CCCheckin</a></li>
+  <li><a href="#cccheckout">CCCheckout</a></li>
+  <li><a href="#ccuncheckout">CCUnCheckout</a></li>
+  <li><a href="#ccupdate">CCUpdate</a></li>
+</ul>
+
+<hr>
+<h2><a name="cccheckin">CCCheckin</a></h2>
+<h3>Description</h3>
+Task to perform a Checkin command to ClearCase.
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+    <td>viewpath</td>
+    <td>Path to the ClearCase view file or directory that the command 
+        will operate on</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>comment</td>
+    <td>Specify a comment. Only one of comment or commentfile may be used.</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>commentfile</td>
+    <td>Specify a file containing a comment. Only one of comment or commentfile 
+        may be used.</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>nowarn</td>
+    <td>Suppress warning messages</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>preservetime</td>
+    <td>Preserve the modification time</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>keepcopy</td>
+    <td>Keeps a copy of the file with a .keep extension</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>identical</td>
+    <td>Allows the file to be checked in even if it is identical 
+        to the original</td>
+    <td>No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;cccheckin viewpath=&quot;c:/views/viewdir/afile&quot;
+        commentfile=&quot;acomment.txt&quot;/&gt;
+        nowarn=&quot;true&quot;
+        identical=&quot;true&quot;
+</pre>
+</blockquote>
+<p>Does a ClearCase <i>checkin</i> on the file <i>c:/views/viewdir/afile</i>. 
+Comment text from the file <i>acomment.txt</i> is added to ClearCase as a comment.
+All warning messages are suppressed. The file is checked in even if it is
+<i>identical</i> to the original.</p>
+<hr>
+<h2><a name="cccheckout">CCCheckout</a></h2>
+<h3>Description</h3>
+Task to perform a Checkout command to ClearCase.
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+    <td>viewpath</td>
+    <td>Path to the ClearCase view file or directory that the command 
+        will operate on</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>reserved</td>
+    <td>Specifies whether to check out the file as reserved or not</td>
+    <td>Yes</td>
+  </tr>
+  <tr>
+    <td>out</td>
+    <td>Creates a writable file under a different filename</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>nodata</td>
+    <td>Checks out the file but does not create an editable file 
+        containing its data</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>branch</td>
+    <td>Specify a branch to check out the file to</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>version</td>
+    <td>Allows checkout of a version other than main latest</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>nowarn</td>
+    <td>Suppress warning messages</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>comment</td>
+    <td>Specify a comment. Only one of comment or commentfile may be used.</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>commentfile</td>
+    <td>Specify a file containing a comment. Only one of comment or 
+        commentfile may be used.</td>
+    <td>No</td>
+ </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;cccheckout viewpath=&quot;c:/views/viewdir/afile&quot;
+        reserved=&quot;true&quot; 
+        branch=&quot;abranch&quot;
+        nowarn=&quot;true&quot;
+        comment=&quot;Some comment text&quot;/&gt;
+</pre>
+</blockquote>
+<p>Does a ClearCase <i>checkout</i> on the file <i>c:/views/viewdir/afile</i>. 
+It is checked out as <i>reserved</i> on branch called <i>abranch</i>. All 
+warning messages are suppressed. A <i>Some comment text</i> is added to 
+ClearCase as a comment.</p>
+<hr>
+<h2><a name="ccuncheckout">CCUnCheckout</a></h2>
+<h3>Description</h3>
+Task to perform a UnCheckout command to ClearCase.
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+    <td>viewpath</td>
+    <td>Path to the ClearCase view file or directory that the command 
+        will operate on</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>keepcopy</td>
+    <td>Specifies whether to keep a copy of the file with a .keep 
+        extension or not</td>
+    <td>No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;ccuncheckout viewpath=&quot;c:/views/viewdir/afile&quot;
+        keepcopy=&quot;true&quot;/&gt;
+</pre>
+</blockquote>
+<p>Does a ClearCase <i>uncheckout</i> on the file <i>c:/views/viewdir/afile</i>. 
+A copy of the file called <i>c:/views/viewdir/afile.keep</i> is kept.</p>
+<hr>
+<h2><a name="ccupdate">CCUpdate</a></h2>
+<h3>Description</h3>
+Task to perform an Update command to ClearCase.
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+    <td>viewpath</td>
+    <td>Path to the ClearCase view file or directory that the command 
+        will operate on</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>graphical</td>
+    <td>Displays a graphical dialog during the update</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>log</td>
+    <td>Specifies a log file for ClearCase to write to</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>overwrite</td>
+    <td>Specifies whether to overwrite hijacked files or not</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>rename</td>
+    <td>Specifies that hijacked files should be renamed with a .keep extension</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>currenttime</td>
+    <td>Specifies that modification time should be written as the 
+        current time. Either currenttime or preservetime can be 
+        specified.</td>
+    <td>No</td>
+  </tr>
+  <tr>
+    <td>preservetime</td>
+    <td>Specifies that modification time should preserved from the 
+        VOB time. Either currenttime or preservetime can be 
+        specified.</td>
+    <td>No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;ccupdate viewpath=&quot;c:/views/viewdir&quot;
+        graphical=&quot;false&quot; 
+        log=&quot;log.log&quot;
+        overwrite=&quot;true&quot;
+        currenttime=&quot;true&quot;
+        rename=&quot;false&quot;/&gt;
+</pre>
+</blockquote>
+<p>Does a ClearCase <i>update</i> on the directory <i>c:/views/viewdir</i>. 
+A graphical dialog will be displayed. The output will be logged to 
+<i>log.log</i> and it will overwrite any hijacked files. The modified 
+time will be set to the current time.</p>
+
+</body>
+
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/depend.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/depend.html
new file mode 100644
index 0000000..d8d4293
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/depend.html
@@ -0,0 +1,163 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2>Depend</h2>
+
+A task to manage Java class file dependencies.
+
+<h3>Description</h3>
+
+<p>
+The depend task works by determining which classes are out of date with
+respect to their source and then removing the class files of any other
+classes which depend on the out-of-date classes.
+</p>
+
+<p> To determine the class dependencies, the depend task analyses the class 
+files of all class files passed to it. Depend does not parse your source code in 
+any way but relies upon the class references encoded into the class files by the 
+compiler. This is generally faster than parsing the Java source.</p>
+
+<p>
+To learn more about how this information is obtained from the class files, 
+please refer to <a href="http://java.sun.com/docs/books/vmspec/">the Java 
+Virtual Machine Specification</a>
+</p>
+
+<p> Since a class' dependencies only change when the class itself changes, the 
+depend task is able to cache dependency information. Only those class files 
+which have changed will have their dependency information re-analysed. Note that 
+if you change a class' dependencies by changing the source, it will be 
+recompiled anyway. You can examine the dependency files created to understand 
+the  dependencies of your classes. Please do not rely, however, on the format of 
+the information, as it may change in a later release. </p>
+
+<p> Once depend discovers all of the class dependencies, it &quot;inverts&quot; 
+this relation to determine, for each class, which other classes are dependent 
+upon it. This &quot;affects&quot; list is used to discover which classes are 
+invalidated by the out of date class. The class files of the invalidated 
+classes are removed, triggering the compilation of the affected classes. </p>
+
+<p> The depend task supports an attribute, &quot;closure&quot; which controls 
+whether depend will only consider direct class-class relationships or whether it 
+will also consider transitive, indirect relationships. For example, say there 
+are three classes, A, which depends on B, which in-turn depend on C. Now say 
+that class C is out of date. Without closure, only class B would be removed by 
+depend. With closure set, class A would also be removed. Normally direct 
+relationships are sufficient - it is unusual for a class to depend on another 
+without having a direct relationship. With closure set, you will notice that 
+depend typically removes far more class files. </p>
+
+<h3>Performance</h3> 
+
+<p> The performance of the depend task is dependent on a 
+number of factors such as class relationship complexity and how many class files 
+are out of date. The following tests have been run when build Ant itself, on the 
+author's machine using JDK1.3 </p>
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td>Building Ant from clean using Javac</td>
+    <td>11 seconds</td>
+  </tr>
+  <tr>
+    <td>Building Ant from clean using Jikes</td>
+    <td>5 seconds</td>
+  </tr>
+  <tr>
+    <td>Running &lt;depend&gt; when up-to-date and no cache</td>
+    <td>4 seconds (Depend takes 2 seconds)</td>
+  </tr>
+  <tr>
+    <td>Running &lt;depend&gt; when up-to-date and with a cache</td>
+    <td>2 seconds (Depend takes 1 seconds)</td>
+  </tr>
+</table>
+
+<p> This involves compiling 177 files. The above figures are indicative only. 
+The decision about whether it is cheaper to just recompile all classes or to 
+use the depend task will depend on the size of your project and how interrelated 
+your classes are. </p>
+
+
+<h3>Limitations</h3>
+
+<p> There are some dependencies which depend will not detect. </p>
+
+<ul>
+<li>If the Java compiler optimizes away a class relationship, 
+    there can be a source dependency without a class dependency. </li>
+    
+<li>Non public classes cause two problems. Firstly depend cannot relate
+    the class file to a source file. In the future this may be addressed
+    using the source file attribute in the classfile. Secondly, neither 
+    depend nor the compiler tasks can detect when a non public class is
+    missing. Inner classes are handled by the depend task.</li>
+</ul>
+
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">This is the directory where the source exists. depend
+will examine this to determine which classes. If you use multiple
+source directories you can pass this a path of source directories.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">destDir</td>
+    <td valign="top">This is the root directory of the class files which
+will be analysed. If this is not present, the srcdir is used.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">cache</td>
+    <td valign="top">This is a directory in which depend can store and
+retrieve dependency information. If this is not present, depend will not
+use a cache </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">closure</td>
+    <td valign="top">This attribute controls whether depend only removes
+classes which directly depend on out of date classes. If this is set to true,
+depend will traverse the class dependency graph deleting all affected
+classes. Defaults to false</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<blockquote>
+  <pre>    &lt;depend srcdir=&quot;${java.dir}&quot;
+    destdir=&quot;${build.classes}&quot;
+    cache=&quot;depcache&quot;
+    closure=&quot;yes&quot;/&gt;</pre>
+</blockquote>
+
+<p> In this example classes in the ${build.classes} directory will be removed if 
+they depend on out-of-date classes. Classes are considered out of date with 
+respect to the source in the ${java.dir} directory using the same mechanism as 
+the javac task. In this instance the depend task caches its dependency 
+information in the depcache directory. </p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation.
+All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/dotnet.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/dotnet.html
new file mode 100644
index 0000000..2a82945
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/dotnet.html
@@ -0,0 +1,473 @@
+<html>
+<head>
+<title> .NET classes for Ant
+</title>
+</head>
+
+<body bgcolor="#ffffff">
+<h1>.NET classes for Ant</h1>
+<p>By Steve Loughran; steve_l@iseran.com</p>
+
+<h2>Vision</h2>
+<p>
+Make ant the definitive build tool for .NET projects, just
+as it is becoming for java projects
+</p>
+
+<h2>Detail</h2>
+
+<p>
+The emergent policy in big java projects is 'IDE for code and debug';
+Ant for builds, test and deployment. While IDEs are great for an 
+individual development task, Ant not only rebuilds everything insanely
+fast, it has great support for modern deployment tasks -ftp upload, 
+EJB servers, SQL commands, all can be done from a relatively simple
+XML declaration of what you want done. Also in a large project 
+(especially open source) there is no means of dictating which IDE to use.
+Ant gives IDE independence, cross platform portability and ease of 
+extensibility. </p>
+ 
+<p>
+
+Projects using .net should be able to use the same tool. This will 
+avoid everyone being dependent on Visual Studio.net (if they have it) 
+supplemented with makefiles and batch files. Anyone doing mixed java/dotnet
+development will be particulary grateful, as they can have a unified build 
+process. </p>
+
+<p>
+
+If at sometime in the future bits of .net do appear on different platforms 
+then ant based build files will migrate -once the ant tasks have been 
+migrated and any hard codings of DOS-descendant file system conventions 
+removed from the build.xml files.</p>
+
+<h2>Key .net Tasks</h2>
+
+<ol>
+<li>csc - csharp compiler - *.csc -&gt; output</li>
+<li>ilasm - IL assembler - *.il -&gt;.exe or .dll</li>
+<li>ResX - ResXToResources.exe .resx -&gt; .resources</li>
+<li>al - assembly linker (.dll) -&gt;</li>
+<li>Signcode - .exe + keys -&gt; .exe</li>
+<li>Resgen - .properties -&gt; .resources</li>
+<li>Type Library Exporter (TlbExp.exe) .dll -&gt; .tlb</li>
+<li>TlbImp.exe Type Library Importer </li>
+<li>RegAsm.exe Assembly Registration Tool .dll -&gt; .reg | registration</li>
+<li>WebServiceUtil -SOAP proxy import, SDL generation tool</li>
+</ol>
+
+<h2>Ant Wrapper for net tasks</h2>
+
+Rarely used .net command line tools can be invoked manually. The key tasks
+to address are the common steps in a build process and those which benefit
+from the file pattern matching function. 
+
+<p>
+
+The esoteric tasks can then supported on demand by those who need them. 
+The initial .net tasks should provide a foundation for that demand creation 
+to be simple. </p>
+
+<h2>Plan</h2>
+
+<ol>
+
+<li>code up C sharp task and distribute for feedback &amp; identify possible
+aid</li>
+<li>Use for a real end to end development task</li>
+<li>Add the next task I need (whatever that is)</li>
+<li>Refactor to produce a base class for .net tasks</li>
+<li>Leave it other people write all the other tasks</li>
+</ol>
+
+<h2>Risks</h2>
+<ul>
+<li>
+The .net SDK is unstable; the next builds will change the commands, arguments 
+and behaviours. Probability: 100%. Impact: 2 days.</li>
+<li>Portable tasks turn out to be harder than envisaged 
+ (=reworking if/when non Win32 .net build tools appear)</li>
+
+</ul>
+
+<hr>
+<h2>Using Ant in .net projects</h2>
+
+To use the net tasks one needs
+<ul>
+
+<li> A Win2K box (or any other platform which supports the .net build tools)</li>
+
+<li> JavaVM - Java1.1 or later; Java1.3 recommended.</li>
+
+<li> Ant downloaded and the environment and path variables set up so 
+that typing 'ant' invokes ant via a batch file.</li>
+
+<li> An XML parser for ant. The usual distributions include an appropriate 
+version parser.jar and jaxp.jar.</li>
+
+<li> the .net tasks archive (dotnettasks.jar) included in the
+ ant\lib directory</li>
+
+<li> The .net sdk installed with the binaries on the path. (Test: type CSC)</li>
+
+<li> A build.xml file to describe the build process</li>
+</ul>
+
+<hr>
+<h2> Change Log </h2>
+
+<h4>Version 0.3</h4>
+
+The changes here reflect Beta-1 of the dotnet SDK and experience of use in 
+more complex projects. This build does not work with the older SDK, 
+primarily because the automatic reference feature references libraries
+only found in the new SDK version.  
+<p>
+External changes</p>
+<ul>
+<li>Recursive inclusion of .cs and .il files</li>
+
+<li>Documentation enhanced, includes examples and details of all parameters</li>
+
+<li>The csc task automatically includes the common dotnet assemblies, so
+there is no need to remember to refer to 'System.dll', 'System.Web.Services',
+ etc. This feature can be disabled by setting the 'includeDefaultReferences' 
+ flag to false. </li>
+
+ <li> References can also be referred to using the ReferenceFiles parameter, which
+is an ant path specification. The old 'references' string is still retained.</li>
+<li> An 'extraoptions' attribute enables the build file to include any CSC options
+which are not explicitly supported in the CSC task. </li>
+</ul>
+
+Internal changes
+<ul>
+<li>Some minor refactoring (move common code a method)</li>
+<li>Application of Jedits JavaStyle task resulted in a major reshaping of
+the codebase and the insertion of a blank line every second line. Significant
+effort was required to revert some (but not all) changes.</li>
+<li>Removed throws clause from methods which can't throw exceptions </li>
+</ul>
+
+The test harness has been expanded to include unicode source file  
+(the build works but the rest of the system has 'issues' with high unicode
+package and method names)
+
+<h4>Version 0.2</h4>
+First public edition, added to the ant cvs tree. Tested on the PDC build of 
+the dotnet SDK only, and still immature. The command execution code was 
+refactored out into a 'NetCommand' class for re-use. The Ilasm task was added
+at this time.
+
+<h4>Version 0.1</h4>
+Initial proof of concept; very rudimentary support for CSC only. 
+
+<hr>
+<h2>Task: CSC</h2>
+
+This task compiles CSharp source into executables or modules.
+
+This task compiles CSharp source into executables or modules.
+The task will only work on win2K until other platforms support csc.exe or 
+an equivalent. CSC.exe must be on the execute path too.
+
+<p>
+All parameters are optional: &lt;csc/&gt; should suffice to produce a debug
+build of all *.cs files. References to external files do require explicit 
+enumeration, so are one of the first attributes to consider adding. </p>
+
+<p>
+
+The task is a directory based task, so attributes like <b>includes=&quot;**/*.cs&quot;</b> and 
+<b>excludes=&quot;broken.cs&quot;</b> can be used to control the files pulled in. By default, 
+all *.cs files from the project folder down are included in the command. 
+When this happens the output file -if not specified-
+is taken as the first file in the list, which may be somewhat hard to control.
+Specifying the output file with <b>'outfile'</b> seems prudent. </p>
+
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Example Values</b></td>
+  </tr>
+
+<tr>
+    <td valign="top">additionalModules</td>
+    <td valign="top">Semicolon separated list of modules to refer to</td>
+    </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      </td>
+    <td valign="top">&quot;true&quot;(default) or &quot;false&quot;</td>
+	</tr>
+<tr>
+    <td valign="top">definitions</td>
+    <td valign="top">defined constants</td>
+    <td valign="top"> &quot;RELEASE;BETA1&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">debug</td>
+    <td valign="top">include debug information</td>
+    <td valign="top">&quot;true&quot;(default) or &quot;false&quot;</td>
+    </tr>
+
+<tr>
+    <td valign="top">docFile</td>
+    <td valign="top">name of file for documentation</td>
+    <td valign="top">&quot;doc.xml&quot;</td>
+    </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+  </tr>
+  <tr>
+    <td valign="top">extraOptions</td>
+    <td valign="top">Any extra options which aren't explicitly 
+		supported by the CSharp task </td>
+	<td>&quot;/warnaserror+ /baseaddress:0x12840000&quot;</td>
+  </tr>
+
+  
+<tr>
+    <td valign="top">failOnError</td>
+    <td valign="top">Should a failed compile halt the build?</td>
+    <td valign="top">&quot;true&quot;(default) or &quot;false&quot;</td>
+    </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">includeDefaultReferences</td>
+    <td valign="top">Flag which when true automatically includes
+	the common assemblies in dotnet beta1, and tells the compiler to link in
+	mscore.dll
+	</td>
+    <td valign="top">&quot;true&quot;(default) or &quot;false&quot;</td>
+  </tr>
+
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+  </tr>
+
+<tr>
+    <td valign="top">incremental</td>
+    <td valign="top">Incremental build flag. Avoid till it works</td>
+    <td valign="top">&quot;true&quot; or &quot;false&quot;(default)</td>
+    </tr>
+<tr>
+    <td valign="top">mainClass</td>
+    <td valign="top">name of main class for executables</td>
+    <td valign="top">&quot;com.example.project.entrypoint&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">optimize</td>
+    <td valign="top">optimisation flag</td>
+    <td valign="top">&quot;true&quot; or &quot;false&quot;(default)</td>
+    </tr>
+<tr>
+    <td valign="top">outputFile</td>
+    <td valign="top">filename of output</td>
+    <td valign="top">&quot;example.exe&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">references</td>
+    <td valign="top">Semicolon separated list of dlls to refer to</td>
+	<td valign="top">&quot;mylib.dll;nunit.dll&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">referenceFiles </td>
+    <td valign="top">Ant Path descriptioon of references to include. 
+	Wildcards should work. </td>
+	<td valign="top"></td>
+    </tr>
+	
+<tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">source directory (default = project directory)</td>
+    <td valign="top">&quot;.&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">targetType</td>
+    <td valign="top">Type of target</td>
+    <td valign="top">&quot;exe&quot;, &quot;module&quot;, &quot;winexe&quot; or &quot;library&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">unsafe</td>
+    <td valign="top">enable unsafe code</td>
+    <td valign="top">&quot;true&quot; or &quot;false&quot;(default)</td>
+    </tr>
+<tr>
+    <td valign="top">warnLevel</td>
+    <td valign="top">level of warning currently between 1 and 4 with 4
+	being the strictest. </td>
+    <td valign="top">&quot;1&quot;-&quot;4&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">win32Icon</td>
+    <td valign="top">filename of icon to include</td>
+ 	<td valign="top">&quot;res/myicon.ico&quot;</td>
+   </tr>
+
+</table>
+<p>
+Example
+</p>
+<pre>&lt;csc
+        optimize=&quot;true&quot;
+        debug=&quot;false&quot;
+        docFile=&quot;documentation.xml&quot;
+        warnLevel=&quot;4&quot;
+        unsafe=&quot;false&quot;
+        targetType=&quot;exe&quot;
+        incremental=&quot;false&quot;
+        definitions=&quot;RELEASE&quot;
+        excludes=&quot;src/unicode_class.cs&quot;
+        mainClass = &quot;MainApp&quot;
+        outputFile=&quot;NetApp.exe&quot;
+        /&gt;   
+</pre>
+<hr>
+<h2> Task: ilasm </h2>
+<p>Task to assemble .net 'Intermediate Language' files.
+The task will only work on win2K until other platforms support csc.exe or 
+an equivalent. ilasm.exe must be on the execute path too.
+</p>
+<p>
+All parameters are optional: &lt;il/&gt; should suffice to produce a debug
+build of all *.il files.
+The option set is roughly compatible with the CSharp class;
+even though the command line options are only vaguely
+equivalent. [The low level commands take things like /OUT=file,
+csc wants /out:file ... /verbose is used some places; /quiet here in
+ildasm... etc.] It would be nice if someone made all the command line
+tools consistent (and not as brittle as the java cmdline tools) 
+</p>
+
+<p>
+
+The task is a directory based task, so attributes like <b>includes=&quot;*.il&quot;</b> and 
+<b>excludes=&quot;broken.il&quot;</b> can be used to control the files pulled in. 
+Each file is built on its own, producing an appropriately named output file unless
+manually specified with <b>outfile</b>
+</p>
+
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Example</b></td>
+  </tr>
+
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when omitted.</td>
+  </tr>
+
+  <tr>
+    <td valign="top">debug</td>
+    <td valign="top">include debug information</td>
+    <td valign="top">true (default)</td>
+    </tr>
+
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+  </tr>
+  <tr>
+    <td valign="top">extraOptions</td>
+    <td valign="top">Any extra options which aren't explicitly 
+		supported by the ilasm task </td>
+	<td></td>
+  </tr>
+  
+<tr>
+    <td valign="top">failOnError</td>
+    <td valign="top">Should a failed compile halt the build?</td>
+    <td valign="top">&quot;true&quot;(default)</td>
+    </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+  </tr>
+<tr>
+    <td valign="top">listing</td>
+    <td valign="top">Produce a listing (off by default). Listings go to the
+	current output stream</td>
+    <td valign="top">&quot;on&quot;, &quot;off&quot; (default)</td>
+    </tr>
+<tr>
+    <td valign="top">outputFile</td>
+    <td valign="top">filename of output</td>
+    <td valign="top">&quot;example.exe&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">owner</td>
+    <td valign="top">restrict disassembly by setting the 'owner' string</td>
+    <td valign="top">&quot;secret&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">resourceFile</td>
+    <td valign="top">name of resource file to include</td>
+    <td valign="top">&quot;resources.res&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">source directory (default = project directory)</td>
+    <td valign="top"></td>
+    </tr>
+<tr>
+    <td valign="top">targetType</td>
+    <td valign="top">Type of target. library means DLL is output. </td>
+    <td valign="top">&quot;exe&quot;(default), &quot;library&quot;</td>
+    </tr>
+<tr>
+    <td valign="top">verbose</td>
+    <td valign="top">output progress messages</td>
+    <td valign="top">&quot;on&quot;, &quot;off&quot; (default)</td>
+    </tr>
+
+</table>
+<p>
+Example</p>
+<pre>&lt;ilasm
+        outputFile=&quot;app.exe&quot;
+        verbose=&quot;on&quot;
+        listing=&quot;on&quot;
+        owner=&quot;secret&quot;
+        /&gt;
+</pre>
+<hr>
+<p align="center">Copyright &copy; 2000 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ejb.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ejb.html
new file mode 100644
index 0000000..3527a3e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ejb.html
@@ -0,0 +1,857 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant EJB Tasks</title>
+
+</head>
+
+<body>
+
+<h1>Ant EJB Tasks User Manual</h1>
+<p>by</p>
+<!-- Names are in alphabetical order, on last name -->
+<ul>
+  <li>Tim Fennell (<a href="mailto:tfenne@rcn.com">tfenne@rcn.com</a>)</li>
+  <li>Conor MacNeill (<a href="mailto:conor@cortexebusiness.com.au">conor@cortexebusiness.com.au</a>)</li>
+</ul>
+
+<p>Version 1.1 - 2000/07/18</p>
+<hr>
+<h2>Table of Contents</h2>
+<ul>
+  <li><a href="#introduction">Introduction</a></li>
+  <li><a href="#ejbtasks">EJB Tasks</a></li>
+</ul>
+
+<hr>
+<h2><a name="introduction">Introduction</a></h2>
+<p>Ant provides a number of optional tasks for developing 
+<a href="http://java.sun.com/products/ejb" target="_top">Enterprise Java Beans (EJBs)</a>. 
+In general these tasks are specific to the particular vendor's EJB Server. At present the tasks support
+<a href="http://www.bea.com" target="_top">Weblogic</a> 4.5.1 and 5.1 EJB servers. Over time we expect further optional tasks 
+to support additional EJB Servers. 
+</p>
+<hr>
+<h2><a name="ejbtasks">EJB Tasks</a></h2>
+<table border="1" cellpadding="5">
+ <tr><td>Task</td><td>Application Servers</td></tr>
+ <tr><td><a href="#ddcreator">ddcreator</a></td><td>Weblogic 4.5.1</td></tr>
+ <tr><td><a href="#ejbc">ejbc</a></td><td>Weblogic 4.5.1</td></tr>
+ <tr><td><a href="#wlrun">wlrun</a></td><td>Weblogic 4.5.1, 5.1 &amp; 6.0</td></tr>
+ <tr><td><a href="#wlstop">wlstop</a></td><td>Weblogic 4.5.1, 5.1 &amp; 6.0</td></tr>
+ <tr><td><a href="#ejbjar">ejbjar</a></td><td>Weblogic 5.1 &amp; 6.0</td></tr>
+</table>
+
+<hr>
+<h2><a name="ddcreator">ddcreator</a></h2>
+<h3><b>Description:</b></h3>
+<p>ddcreator will compile a set of Weblogic text-based deployment descriptors into a serialized
+EJB deployment descriptor. The selection of which of the text-based descriptors are to be compiled
+is based on the standard Ant include and exclude selection mechanisms. 
+</p>
+
+<h3>Parameters:</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">descriptors</td>
+    <td valign="top">This is the base directory from which descriptors are selected.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">The directory where the serialised deployment descriptors will be written</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">This is the classpath to use to run the underlying weblogic ddcreator tool. 
+                     This must include the <code>weblogic.ejb.utils.DDCreator</code> class</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>&lt;ddcreator descriptors=&quot;${dd.dir}&quot; 
+           dest=&quot;${gen.classes}&quot; 
+           classpath=&quot;${descriptorbuild.classpath}&quot;&gt;
+  &lt;include name=&quot;*.txt&quot; /&gt;
+&lt;/ddcreator&gt;
+</pre>
+
+<hr>
+<h2><a name="ejbc">ejbc</a></h2>
+<h3><b>Description:</b></h3>
+<p>The ejbc task will run Weblogic's ejbc tool. This tool will take a serialised deployment descriptor, 
+examine the various EJB interfaces and bean classes and then generate the required support classes 
+necessary to deploy the bean in a Weblogic EJB container. This will include the RMI stubs and skeletons
+as well as the classes which implement the bean's home and remote interfaces.</p>
+<p>
+The ant task which runs this tool is able to compile several beans in a single operation. The beans to be 
+compiled are selected by including their serialised deployment descriptors. The standard ant 
+<code>include</code> and <code>exclude</code> constructs can be used to select the deployment descriptors
+to be included. </p>
+<p>
+Each descriptor is examined to determine whether the generated classes are out of date and need to be 
+regenerated. The deployment descriptor is de-serialized to discover the home, remote and 
+implementation classes. The corresponding source files are determined and checked to see their 
+modification times. These times and the modification time of the serialised descriptor itself are
+compared with the modification time of the generated classes. If the generated classes are not present
+or are out of date, the ejbc tool is run to generate new versions.</p>
+<h3>Parameters:</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">descriptors</td>
+    <td valign="top">This is the base directory from which the serialised deployment descriptors are selected.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">dest</td>
+    <td valign="top">The base directory where the generated classes, RIM stubs and RMI skeletons are written</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">manifest</td>
+    <td valign="top">The name of a manifest file to be written. This manifest will contain an entry for each EJB processed</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">The base directory of the source tree containing the source files of the home interface,
+                     remote interface and bean implementation classes.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">This classpath must include both the <code>weblogic.ejbc</code> class and the
+                     classfiles of the bean, home interface, remote interface, etc of the bean being
+                     processed.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<pre>&lt;ejbc descriptors=&quot;${gen.classes}&quot;
+           src=&quot;${src.dir}&quot; 
+           dest=&quot;${gen.classes}&quot;
+           manifest=&quot;${build.manifest}&quot; 
+           classpath=&quot;${descriptorbuild.classpath}&quot;&gt;
+  &lt;include name=&quot;*.ser&quot; /&gt;
+&lt;/ejbc&gt;
+</pre>
+
+<hr>
+<h2><a name="wlrun">wlrun</a></h2>
+<h3><b>Description:</b></h3>
+
+<p>The <code>wlrun</code> task is used to start a weblogic server. The task runs 
+a weblogic instance in a separate Java Virtual Machine. A number of parameters 
+are used to control the operation of the weblogic instance. Note that the task, 
+and hence ant, will not complete until the weblogic instance is stopped.</p>
+
+<h3>Parameters:</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required for 4.5.1 and 5.1</b></td>
+    <td align="center" valign="top"><b>Required for 6.0</b></td>
+  </tr>
+  <tr>
+    <td valign="top">BEA Home</td>
+    <td valign="top">The location of the BEA Home qwhere the server's config is defined.
+                     If this attribute is present, wlrun assumes that the server will
+                     be running under Weblogic 6.0</td>
+    <td valign="top" align="center">N/A</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">home</td>
+    <td valign="top">The location of the weblogic home that is to be used. This is the location 
+                     where weblogic is installed.</td>
+    <td valign="top" align="center">Yes</td>
+    <td valign="top" align="center">Yes. Note this is the absolute location, not relative to 
+                                    BEA home.</td>
+  </tr>
+  <tr>
+    <td valign="top">Domain</td>
+    <td valign="top">The domain to which the server belongs.</td>
+    <td valign="top" align="center">N/A</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">The classpath to be used with the Java Virtual Machine that runs the Weblogic 
+                     Server. Prior to Weblogic 6.0, this is typically set to the Weblogic 
+                     boot classpath. Under Weblogic 6.0 this should include all the 
+                     weblogic jars</td>
+    <td valign="top" align="center">Yes</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">wlclasspath</td>
+    <td valign="top">The weblogic classpath used by the Weblogic Server.</td>
+    <td valign="top" align="center">No</td>
+    <td valign="top" align="center">N/A</td>
+  </tr>
+  <tr>
+    <td valign="top">properties</td>
+    <td valign="top">The name of the server's properties file within the weblogic home directory
+                     used to control the weblogic instance.</td>
+    <td valign="top" align="center">Yes</td>
+    <td valign="top" align="center">N/A</td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">The name of the weblogic server within the weblogic home which is to be run. 
+                     This defaults to &quot;myserver&quot;</td>
+    <td valign="top" align="center">No</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">policy</td>
+    <td valign="top">The name of the security policy file within the weblogic home directory that 
+                     is to be used. If not specified, the default policy file <code>weblogic.policy</code>
+                     is used.</td>
+    <td valign="top" align="center">No</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">username</td>
+    <td valign="top">The management username used to manage the server</td>
+    <td valign="top" align="center">N/A</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">password</td>
+    <td valign="top">The server's management password</td>
+    <td valign="top" align="center">N/A</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">pkPassword</td>
+    <td valign="top">The private key password so the server can decrypt the SSL 
+                     private key file</td>
+    <td valign="top" align="center">N/A</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">jvmargs</td>
+    <td valign="top">Additional argument string passed to the Java Virtual Machine used to run the
+                     Weblogic instance.</td>
+    <td valign="top" align="center">No</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">args</td>
+    <td valign="top">Additional argument string passed to the Weblogic instance.</td>
+    <td valign="top" align="center">No</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<h3>Nested Elements</h3>
+
+<p>The wlrun task supports nested &lt;classpath&gt; and &lt;wlclasspath&gt; 
+elements to set the repsective classpaths.</p>
+
+<h3>Examples</h3>
+
+<p>This example shows the use of wlrun to run a server under Weblogic 5.1</p>
+
+<pre>
+    &lt;wlrun taskname=&quot;myserver&quot;
+           classpath=&quot;${weblogic.boot.classpath}&quot;
+           wlclasspath=&quot;${weblogic.classes}:${code.jars}&quot;
+           name=&quot;myserver&quot; 
+           home=&quot;${weblogic.home}&quot;
+           properties=&quot;myserver/myserver.properties&quot;/&gt;
+</pre>
+
+<p>This example shows wlrun being used to run the petstore server under
+Weblogic 6.0</p>
+
+<pre>
+    &lt;wlrun taskname=&quot;petstore&quot;
+           classpath=&quot;${weblogic.classes}&quot;
+           name=&quot;petstoreServer&quot; 
+           domain=&quot;petstore&quot; 
+           home=&quot;${weblogic.home}&quot;
+           password=&quot;petstorePassword&quot;
+           beahome=&quot;${bea.home}&quot;/&gt;
+</pre>
+
+<hr>
+<h2><a name="wlstop">wlstop</a></h2>
+<h3><b>Description:</b></h3>
+
+<p>The <code>wlstop</code> task is used to stop a weblogic instance which is 
+currently running. To shut down an instance you must supply both a username and 
+a password. These will be stored in the clear in the build script used to stop 
+the instance. For security reasons, this task is therefore only appropriate in a 
+development environment. </p>
+
+<p>This task works for most version of Weblogic, including 6.0. You need to 
+specify the BEA Home to have this task work correctly under 6.0</p>
+
+<h3>Parameters:</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">BEAHome</td>
+    <td valign="top">This attribute selects Weblogic 6.0 shutdown.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">The classpath to be used with the Java Virtual Machine that runs the Weblogic 
+                     Shutdown comment.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">user</td>
+    <td valign="top">The username of the account which will be used to shutdown the server</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">password</td>
+    <td valign="top">The password for the account specified in the user parameter.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">url</td>
+    <td valign="top">The URL which describes the port to which the server is listening for T3 connections. 
+                     For example, t3://localhost:7001</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">delay</td>
+    <td valign="top">The delay in seconds after which the server will stop. This defaults to an
+                     immediate shutdown.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+
+<h3>Nested Element</h3>
+
+<p>The classpath of the welstop task can be set by a &lt;classpath&gt; nested element.</p>
+
+<h3>Examples</h3>
+
+<p>This example show the shutdown for a Weblogic 6.0 server</p>
+
+<pre>
+    &lt;wlstop classpath=&quot;${weblogic.classes}&quot;
+            user=&quot;system&quot;
+            url=&quot;t3://localhost:7001&quot;
+            password=&quot;foobar&quot;
+            beahome=&quot;${bea.home}&quot;/&gt;
+</pre>
+
+<hr>
+<h2><a name="ejbjar">ejbjar</a></h2>
+<h3><b>Description:</b></h3>
+
+<p>This task is designed to support building of EJB1.1 jar files. Support is 
+currently provided for 'vanilla' EJB1.1 jar files - i.e. those containing only 
+the user generated class files and the standard deployment descriptor. Nested 
+elements provide support for vendor specific deployment tools. These currently
+include: </p>
+<ul>
+  <li>an element or building Weblogic 5.1/6.0 session/entity beans using the 
+      weblogic.ejbc tool.</li>
+  <li>an element for building TOPLink for WebLogic 2.5.1-enabled entity beans.</li>
+</ul>
+
+<p>This task supports two approaches to creating ejb jar files. The first 
+approach assumes a particular naming convention for deployment descriptor files. 
+For an Account bean, for example, the deployment descriptor would be named 
+<code>Account-ejb-jar.xml</code>. This naming convention allows the task to 
+distinguish deployment descriptors without relying on their positioning within a 
+source tree. It is also used to derive the name of the .jar file which is 
+generated. For the example this would be <code>Account.jar</code>. Vendor 
+specific files are assumed to be named in a similar fashion. The deployment 
+descriptor file which defines additional weblogic specific information for the 
+above bean would be <code>Account-weblogic-ejb-jar.xml</code>. The second 
+approach does not require a naming convention. This approach uses a specified a 
+jar name for the resultant ejb jar. If the jar name is present, then no naming 
+convention is required. If the jar name is not specified, then the default 
+naming convention is expected for the deployment descriptor files.</p>
+
+<p>The task works as a directory scanning task, and performs an action for each 
+deployment descriptor found. As such the includes and excludes should be set 
+to ensure that all desired EJB1.1 descriptors are found, but no application 
+server descriptors are found. For each descriptor found, ejbjar will parse the 
+deployment descriptor to determine the necessary class files which implement the 
+bean. These files are assembled along with the deployment descriptors into a 
+well formed EJB jar file. Any support files which need to be included in the 
+generated jarcan be added with the &lt;support&gt; nested element. For each 
+class included in the jar, ejbjar will scan for any super classes or super
+interfaces. These will be added to the generated jar.</p>
+
+<p>If no nested vendor-specific deployment elements are present, the task will 
+simply generate a generic EJB jar. Such jars are typically used as the input to 
+vendor-specific deployment tools. For each nested deployment element, a vendor 
+specific deployment tool is run to generate a jar file ready for deployment in 
+that vendor's EJB container. </p>
+
+<p>The jar files are only built if they are out of date.  Each deployment tool 
+element will examine its target jar file and determine if it is out of date with 
+respect to the class files and deployment descriptors that make up the bean. If 
+any of these files are newer than the jar file the jar will be rebuilt otherwise 
+a message is logged that the jar file is up to date.</p>
+
+<h3>Parameters:</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">descriptordir</td>
+    <td valign="top">The base directory under which to scan for EJB 
+                     deployment descriptors. If this attribute is not 
+                     specified, then the deployment descriptors must be 
+                     located in the directory specified by the 'srcdir' 
+                     attribute.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">srcdir</td>
+    <td valign="top">The base directory containing the .class files that 
+                     make up the bean. Note that this can be the same as 
+                     the descriptordir if all files are in the same directory
+                     tree.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">The base directory into which generated jar files are 
+                     deposited. Jar files are deposited in directories 
+                     corresponding to their location within the descriptordir
+                     namespace. Note that this attribute is only used if the 
+                     task is generating generic jars (i.e. no vendor-specific
+                     deployment elements have been specified).</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basejarname</td>
+    <td valign="top">The base name that is used for the generated jar files. 
+                     If this attribute is specified, the generic jar file name 
+                     will use this value as the prefix (followed by the value 
+                     specified in the 'genericjarsuffix' attribute) and the 
+                     resultant ejb jar file (followed by any suffix specified
+                     in the nested element).</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">basenameterminator</td>
+    <td valign="top">String value used to substring out a string from the name 
+                     of each deployment descriptor found, which is then used to
+                     locate related deployment descriptors (e.g. the WebLogic 
+                     descriptors). For example, a basename of '.' and a 
+                     deployment descriptor called 'FooBean.ejb-jar.xml' would
+                     result in a basename of 'FooBean' which would then be used
+                     to find FooBean.weblogic-ejb-jar.xml and 
+                     FooBean.weblogic-cmp-rdbms-jar.xml, as well as to create 
+                     the filenames of the jar files as FooBean-generic.jar and 
+                     FooBean-wl.jar. This attribute is not used if the 
+                     'basejarname' attribute is specified.</td>
+    <td valign="top" align="center">No, defaults to '-'.</td>
+  </tr>
+  <tr>
+    <td valign="top">genericjarsuffix</td>
+    <td valign="top">String value appended to the basename of the deployment 
+                     descriptor to create the filename of the generic EJB jar 
+                     file.</td>
+    <td valign="top" align="center">No, defaults to '-generic.jar'.</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">This classpath is used when resolving classes which
+                     are to be added to the jar. Typically nested deployment
+                     tool elements will also support a classpath which 
+                     will be combined with this classpath when resolving 
+                     classes</td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+  <tr>
+    <td valign="top">flatdestdir</td>
+    <td valign="top">Set this attribute to true if you want all generated jars
+                     to be placed in the root of the destdir, rather than
+                     according to the location of the deployment descriptor
+                     within the descriptor dir hierarchy.</td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+</table>
+
+<h3>Nested Elements</h3>
+
+<p>In addition to the vendor specific nested elements, the ejbjar task provides 
+three nested elements. </p>
+
+<h4>Classpath</h4>
+
+<p>The &lt;classpath&gt; nested element allows the classpath 
+to be set. It is useful when setting the classpath from a reference path. IN all 
+othe rrespects the behaviour is the same as the classpath attribute.</p>
+
+<h4>dtd</h4>
+
+<p>The &lt;dtd&gt; element is used to specify the local location of DTDs to be 
+used when parsing the EJB deployment descriptor. Using a local DTD is much 
+faster than loading the DTD across the net. If you are running ejbjar behind a 
+firewall you may not even be able to access the remote DTD. The supported 
+vendor-specific nested elements know the location of the required DTDs within 
+the vendor class hierarchy and, in general, this means &lt;dtd&gt; elements are 
+not required. It does mean, however, that the vendor's class hierarchy must be 
+available in the classpath when Ant is started. If your want to run Ant without 
+requiring the vendor classes in the classpath, you would need to use a 
+&lt;dtd&gt; element.</p>
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">publicId</td>
+    <td valign="top">The public Id of the DTD for which the location is being provided</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">location</td>
+    <td valign="top">The location of the local copy of the DTD. This can either be a
+                     file or a resource loadable from the classpath.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+</table>
+
+<h4>support</h4>
+
+<p>The &lt;support&gt; nested element is used to supply additional classes 
+(files) to be included in the generated jars. The &lt;support&gt; element is a 
+FileSet, so it can either reference a fileset declared elsewehere or it can be 
+defined in-place with the approrpiate &lt;include&gt; and &lt;exclude&gt; nested 
+elements. The files in the support fileset are added into the generated EJB jar 
+in the same relative location as their location within the support fileset. Note 
+that when ejbjar generates more than one jar file, the support files are added 
+to each one.</p>
+
+<h3>Vendor-specific deployment elements</h3>
+
+Each vendor-specific nested element controls the generation of a deployable jar 
+specific to that vendor's EJB container. The parameters for each supported 
+deployment element are detailed here.
+
+<h3>Weblogic element</h3>
+
+<p>The weblogic element is used to control the weblogic.ejbc compiler for 
+generating weblogic EJB jars. Prior to Ant 1.3, the method of locating CMP 
+descriptors was to use the ejbjar naming convention. So if your ejb-jar was 
+called, Customer-ejb-jar.xml, your weblogic descriptor was called Customer-
+weblogic-ejb-jar.xml and your CMP descriptor had to be Customer-weblogic-cmp-
+rdbms-jar.xml. In addition, the &lt;type-storage&gt; element in the weblogic 
+descriptor had to be set to the standard name META-INF/weblogic-cmp-rdbms-
+jar.xml, as that is where the CMP descriptor was mapped to in the generated 
+jar.</p>
+
+<p>There are a few problems with this scheme. It does not allow for more than 
+one CMP descriptor to be defined in a jar and it is not compatible with the 
+deployment descriptors generated by some tools.</p>
+
+<p>In Ant 1.3, ejbjar parses the weblogic deployment descriptor to discover the 
+CMP descriptors, which are then included automatically. This behaviour is 
+controlled by the newCMP attribute. Note that if you move to the new method of 
+determining CMP descriptors, you will need to update your weblogic deployment 
+descriptor's &lt;type-storage&gt; element. In the above example, you would 
+define this as META-INF/Customer-weblogic-cmp-rdbms-jar.xml.</p>
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">The base directory into which the generated weblogic ready
+                     jar files are deposited. Jar files are deposited in 
+                     directories corresponding to their location within the 
+                     descriptordir namespace. </td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">genericjarsuffix</td>
+    <td valign="top">A generic jar is generated as an intermediate step in 
+                     build the weblogic deployment jar. The suffix used to 
+                     generate the generic jar file is not particularly 
+                     important unless it is desired to keep the generic 
+                     jar file. It should not, however, be the same
+                     as the suffix setting.</td>
+    <td valign="top" align="center">No, defaults to '-generic.jar'.</td>
+  </tr>
+  <tr>
+    <td valign="top">suffix</td>
+    <td valign="top">String value appended to the basename of the deployment 
+                     descriptor to create the filename of the WebLogic EJB 
+                     jar file.</td>
+    <td valign="top" align="center">No, defaults to '.jar'.</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">The classpath to be used when running the weblogic ejbc 
+                     tool. Note that this tool typically requires the classes
+                     that make up the bean to be available on the classpath. 
+                     Currently, however, this will cause the ejbc tool to be 
+                     run in a separate VM</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">wlclasspath</td>
+    <td valign="top">Weblogic 6.0 will give a warning if the home and remote interfaces
+                     of a bean are on the system classpath used to run weblogic.ejbc. 
+                     In that case, the standard weblogic classes should be set with
+                     this attribute (or equivalent nested element) and the 
+                     home and remote interfaces located with the standard classpath
+                     attribute</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keepgeneric</td>
+    <td valign="top">This controls whether the generic file used as input to 
+                     ejbc is retained.</td>
+    <td valign="top" align="center">No, defaults to false</td>
+  </tr>
+  <tr>
+    <td valign="top">compiler</td>
+    <td valign="top">This allows for the selection of a different compiler
+                     to be used for the compilation of the generated Java
+                     files. This could be set, for example, to Jikes to 
+                     compile with the Jikes compiler.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">rebuild</td>
+    <td valign="top">This flag controls whether weblogic.ejbc is always 
+                     invoked to build the jar file. In certain circumstances,
+                     such as when only a bean class has been changed, the jar
+                     can be generated by merely replacing the changed classes
+                     and not rerunning ejbc. Setting this to false will reduce
+                     the time to run ejbjar. 
+                     </td>
+    <td valign="top" align="center">No, defaults to true.</td>
+  </tr>
+  <tr>
+    <td valign="top">keepgenerated</td>
+    <td valign="top">Controls whether weblogic will keep the generated Java
+                     files used to build the class files added to the 
+                     jar. This can be useful when debugging
+                     </td>
+    <td valign="top" align="center">No, defaults to false.</td>
+  </tr>
+  <tr>
+    <td valign="top">args</td>
+    <td valign="top">Any additional arguments to be passed to the weblogic.ejbc
+                     tool.
+                     </td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+  <tr>
+    <td valign="top">weblogicdtd</td>
+    <td valign="top"><b>Deprecated</b>. Defines the location of the ejb-jar DTD in 
+                     the weblogic class hierarchy. This should not be necessary if you
+                     have weblogic in your classpath. If you do not, you should use a 
+                     nested &lt;dtd&gt; element, described above. If you do choose
+                     to use an attribute, you should use the ejbdtd attribute in
+                     preference to this one, anyway.
+                     </td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+  <tr>
+    <td valign="top">wldtd</td>
+    <td valign="top"><b>Deprecated</b>. Defines the location of the weblogic-ejb-jar 
+                     DTD which covers the Weblogic specific deployment descriptors.
+                     This should not be necessary if you have weblogic in your 
+                     classpath. If you do not, you should use a nested &lt;dtd&gt; 
+                     element, described above.
+                     </td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+  <tr>
+    <td valign="top">ejbdtd</td>
+    <td valign="top"><b>Deprecated</b>. Defines the location of the ejb-jar DTD in 
+                     the weblogic class hierarchy. This should not be necessary if you
+                     have weblogic in your classpath. If you do not, you should use a 
+                     nested &lt;dtd&gt; element, described above.
+                     </td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+  <tr>
+    <td valign="top">newCMP</td>
+    <td valign="top">If this is set to true, the ne wmethod for locating
+                     CMP descriptors will be used.</td>
+    <td valign="top" align="center">No. Defaults to false</td>
+  </tr>
+  <tr>
+    <td valign="top">oldCMP</td>
+    <td valign="top"><b>Deprecated</b> This is an antonym for newCMP which should be used instead.</td>
+    <td valign="top" align="center">No.</td>
+  </tr>
+</table>
+
+<p>The weblogic nested element itself supports two nested elements &lt;classpath&gt; and 
+&lt;wlclasspath&gt; which are used to set the respective classpaths. These nested elements
+are useful when setting up class paths using reference Ids.</p>
+
+<h3>TOPLink for Weblogic element</h3>
+
+<p>The TopLink element is used to handle beans which use Toplink for the CMP operations. It
+is derived from the standard weblogic element so it supports the same set of attributes please these
+additional attributes</p>
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">toplinkdescriptor</td>
+    <td valign="top">This specifies the name of the TOPLink deployment descriptor file contained in the 
+                     'descriptordir' directory.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">toplinkdtd</td>
+    <td valign="top">This specifies the location of the TOPLink DTD file. This can be a file path or
+                     a file URL. This attribute is not required, but using a local DTD is recommended.</td>
+    <td valign="top" align="center">No, defaults to dtd file at www.objectpeople.com.</td>
+  </tr>
+</table>
+
+
+<h3>Examples</h3>
+
+<p>This example shows ejbjar being used to generate deployment jars using a 
+Weblogic EJB container. This example requires the naming standard to be used for 
+the deployment descriptors. Using this format will create a ejb jar file for 
+each variation of '*-ejb-jar.xml' that is found in the deployment descriptor 
+directory.</p>
+
+<pre>
+    &lt;ejbjar srcdir=&quot;${build.classes}&quot;
+            descriptordir=&quot;${descriptor.dir}&quot;&gt;
+      &lt;weblogic destdir=&quot;${deploymentjars.dir}&quot;
+                classpath=&quot;${descriptorbuild.classpath}&quot;/&gt;
+      &lt;include name=&quot;**/*-ejb-jar.xml&quot;/&gt;
+      &lt;exclude name=&quot;**/*weblogic*.xml&quot;/&gt;
+    &lt;/ejbjar&gt;
+</pre>
+
+<p>If weblogic is not in the Ant classpath, the following example 
+shows how to specify the location of the weblogic DTDs. This 
+example also show the use of a nested classpath element.</p>
+   
+<pre>
+    &lt;ejbjar descriptordir=&quot;${src.dir}&quot; srcdir=&quot;${build.classes}&quot;&gt;
+       &lt;weblogic destdir=&quot;${deployment.webshop.dir}&quot; 
+                 keepgeneric=&quot;true&quot;
+                 args=&quot;-g -keepgenerated ${ejbc.compiler}&quot;
+                 suffix=&quot;.jar&quot;
+                 oldCMP=&quot;false&quot;&gt;
+         &lt;classpath&gt;
+           &lt;pathelement path=&quot;${descriptorbuild.classpath}&quot;/&gt;
+         &lt;/classpath&gt;
+       &lt;/weblogic&gt;
+       &lt;include name=&quot;**/*-ejb-jar.xml&quot;/&gt; 
+       &lt;exclude name=&quot;**/*-weblogic-ejb-jar.xml&quot;/&gt;
+       &lt;dtd publicId=&quot;-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN&quot;
+            location=&quot;${weblogic.home}/classes/weblogic/ejb/deployment/xml/ejb-jar.dtd&quot;/&gt;
+       &lt;dtd publicId=&quot;-//BEA Systems, Inc.//DTD WebLogic 5.1.0 EJB//EN&quot;
+            location=&quot;${weblogic.home}/classes/weblogic/ejb/deployment/xml/weblogic-ejb-jar.dtd&quot;/&gt;
+    &lt;/ejbjar&gt;
+</pre>   
+
+
+<p>This example shows ejbjar being used to generate a single deployment jar 
+using a Weblogic EJB container. This example does not require the deployment 
+descriptors to use the naming standard. This will create only one ejb jar file -
+'TheEJBJar.jar'.</p>
+
+
+<pre>
+    &lt;ejbjar srcdir=&quot;${build.classes}&quot;
+            descriptordir=&quot;${descriptor.dir}&quot;
+            basejarname=&quot;TheEJBJar&quot;&gt;
+      &lt;weblogic destdir=&quot;${deploymentjars.dir}&quot;
+                classpath=&quot;${descriptorbuild.classpath}&quot;/&gt;
+      &lt;include name=&quot;**/ejb-jar.xml&quot;/&gt;
+      &lt;exclude name=&quot;**/weblogic*.xml&quot;/&gt;
+    &lt;/ejbjar&gt;
+</pre>
+
+<p>This example shows ejbjar being used to generate deployment jars for a TOPLink-enabled entity bean using a 
+Weblogic EJB container. This example does not require the deployment descriptors to use the naming standard.
+This will create only one TOPLink-enabled ejb jar file - 'Address.jar'.</p>
+
+<pre>
+    &lt;ejbjar srcdir=&quot;${build.dir}&quot;
+            destdir=&quot;${solant.ejb.dir}&quot;
+            descriptordir=&quot;${descriptor.dir}&quot;
+            basejarname=&quot;Address&quot;&gt;
+            &lt;weblogictoplink destdir=&quot;${solant.ejb.dir}&quot;
+                    classpath=&quot;${java.class.path}&quot;
+                    keepgeneric=&quot;false&quot;
+                    toplinkdescriptor=&quot;Address.xml&quot;
+                    toplinkdtd=&quot;file:///dtdfiles/toplink-cmp_2_5_1.dtd&quot;
+                    suffix=&quot;.jar&quot;/&gt;
+            &lt;include name=&quot;**/ejb-jar.xml&quot;/&gt;
+            &lt;exclude name=&quot;**/weblogic-ejb-jar.xml&quot;/&gt;
+    &lt;/ejbjar&gt;
+</pre>
+
+<p>This final example shows how you would set-up ejbjar under Weblogic 6.0. It also shows the use of the 
+&lt;support&gt; element to add support files
+
+<pre>
+    &lt;ejbjar descriptordir=&quot;${dd.dir}&quot; srcdir=&quot;${build.classes.server}&quot;&gt;
+       &lt;include name=&quot;**/*-ejb-jar.xml&quot;/&gt; 
+       &lt;exclude name=&quot;**/*-weblogic-ejb-jar.xml&quot;/&gt;
+       &lt;support dir=&quot;${build.classes.server}&quot;&gt;
+            &lt;include name=&quot;**/*.class&quot;/&gt; 
+       &lt;/support&gt;
+       &lt;weblogic destdir=&quot;${deployment.dir}&quot; 
+                 keepgeneric=&quot;true&quot;
+                 suffix=&quot;.jar&quot;
+                 rebuild=&quot;false&quot;&gt;
+         &lt;classpath&gt;
+            &lt;pathelement path=&quot;${build.classes.server}&quot;/&gt;
+         &lt;/classpath&gt;
+         &lt;wlclasspath&gt;
+            &lt;pathelement path=&quot;${weblogic.classes}&quot;/&gt;
+         &lt;/wlclasspath&gt;
+       &lt;/weblogic&gt;
+    &lt;/ejbjar&gt;
+</pre>
+
+
+</body>
+
+</html>
+
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ftp.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ftp.html
new file mode 100644
index 0000000..d6e04b9
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/ftp.html
@@ -0,0 +1,224 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="ftp">FTP</a></h2>
+<h3>Description</h3>
+<p><b>Note:</b> The ftp-task uses the NetComponents-Package which you will need to download from
+<a href="http://www.savarese.org" target="_top">http://www.savarese.org</a> and add to your classpath.</p>
+<p>The ftp task implements a basic FTP client that can send, receive,
+list, and delete files.  See below for descriptions and examples of how
+to perform each task.</p>
+<p>The ftp task makes no attempt to determine what file system syntax is
+required by the remote server, and defaults to Unix standards.
+<i>remotedir</i> must be specified in the exact syntax required by the ftp
+server. If the usual Unix conventions are not supported by the server,
+<i>separator</i> can be used to set the file separator that should be used
+instead.</p>
+<p>See the section on <a href="../dirtasks.html#directorybasedtasks">directory based
+tasks</a>, on how the inclusion/exclusion of files works, and how to
+write patterns.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">server</td>
+    <td valign="top">the address of the remote ftp server.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">port</td>
+    <td valign="top">the port number of the remote ftp server.
+                     Defaults to port 21.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">userid</td>
+    <td valign="top">the login id to use on the ftp server.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">password</td>
+    <td valign="top">the login password to use on the ftp server.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">remotedir</td>
+    <td valign="top">the directory to which to upload files on the 
+                     ftp server.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">action</td>
+    <td valign="top">the ftp action to perform, defaulting to &quot;send&quot;.  
+                     Currently supports &quot;put&quot;, &quot;get&quot;,
+                     &quot;del&quot;, and &quot;list&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">binary</td>
+    <td valign="top">selects binary-mode (&quot;yes&quot;) or text-mode 
+                     (&quot;no&quot;) transfers.  
+                     Defaults to &quot;yes&quot;</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">passive</td>
+    <td valign="top">selects passive-mode (&quot;yes&quot;) transfers.  
+                     Defaults to &quot;no&quot;</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">displays information on each file transferred if set 
+                     to &quot;yes&quot;. Defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">depends</td>
+    <td valign="top">transfers only new or changed files if set to 
+                     &quot;yes&quot;. Defaults to &quot;no&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">newer</td>
+    <td valign="top">a synonym for <i>depends</i>.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">separator</td>
+    <td valign="top">sets the file separator used on the ftp server.
+                     Defaults to &quot;/&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">listing</td>
+    <td valign="top">the file to write results of the &quot;list&quot; action.
+                     Required for the &quot;list&quot; action, ignored otherwise.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Sending Files</h3>
+<p>The easiest way to describe how to send files is with a couple of examples:</p>
+<pre>
+  &lt;ftp server=&quot;ftp.apache.org&quot;
+       userid=&quot;anonymous&quot;
+       password=&quot;me@myorg.com&quot;&gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot;/&gt;
+  &lt;/ftp&gt;
+</pre>
+<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
+uploads all files in the <code>htdocs/manual</code> directory 
+to the default directory for that user.</p>
+<pre>  &lt;ftp server=&quot;ftp.apache.org&quot;
+       remotedir=&quot;incoming&quot;
+       userid=&quot;anonymous&quot;
+       password=&quot;me@myorg.com&quot;
+       depends=&quot;yes&quot;
+  &gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot;/&gt;
+  &lt;/ftp&gt;</pre>
+<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
+uploads all new or changed files in the <code>htdocs/manual</code> directory 
+to the <code>incoming</code> directory relative to the default directory
+for <code>anonymous</code>.</p>
+<pre>  &lt;ftp server=&quot;ftp.apache.org&quot;
+       port=&quot;2121&quot;
+       remotedir=&quot;/pub/incoming&quot;
+       userid=&quot;coder&quot;
+       password=&quot;java1&quot;
+       depends=&quot;yes&quot;
+       binary=&quot;no&quot;
+  &gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot;&gt;
+      &lt;include name=&quot;**/*.html&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/ftp&gt;</pre>
+<p>Logs in to <code>ftp.apache.org</code> at port <code>2121</code> as 
+<code>coder</code> with password <code>java1</code> and uploads all new or 
+changed HTML files in the <code>htdocs/manual</code> directory to the 
+<code>/pub/incoming</code> directory. The files are transferred in text mode. Passive mode has been switched on to send files from behind a firewall.</p>
+<pre>  &lt;ftp server=&quot;ftp.nt.org&quot;
+       remotedir=&quot;c:\uploads&quot;
+       userid=&quot;coder&quot;
+       password=&quot;java1&quot;
+       separator=&quot;\&quot;
+       verbose=&quot;yes&quot;</pre>
+<PRE>
+  &gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot;&gt;
+      &lt;include name=&quot;**/*.html&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/ftp&gt;</PRE><p>Logs in to the Windows-based <code>ftp.nt.org</code> as 
+<code>coder</code> with password <code>java1</code> and uploads all 
+HTML files in the <code>htdocs/manual</code> directory to the 
+<code>c:\uploads</code> directory.  Progress messages are displayed as each
+file is uploaded.</p>
+<h3>Getting Files</h3>
+<p>Getting files from an FTP server works pretty much the same way as 
+sending them does.  The only difference is that the nested filesets
+use the remotedir attribute as the base directory for the files on the
+FTP server, and the dir attribute as the local directory to put the files
+into.  The file structure from the FTP site is preserved on the local machine.</p>
+<pre>
+  &lt;ftp action=&quot;get&quot;
+       server=&quot;ftp.apache.org&quot;
+       userid=&quot;anonymous&quot;
+       password=&quot;me@myorg.com&quot;&gt;
+    &lt;fileset dir=&quot;htdocs/manual&quot; &gt;
+      &lt;include name=&quot;**/*.html&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/ftp&gt;
+</pre>
+<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and 
+recursively downloads all .html files from default directory for that user 
+into the <code>htdocs/manual</code> directory on the local machine.</p>
+<h3>Deleting Files</h3>
+As you've probably guessed by now, you use nested fileset elements to 
+select the files to delete from the remote FTP server.  Again, the 
+filesets are relative to the remote directory, not a local directory.  In
+fact, the dir attribute of the fileset is ignored completely.
+<pre>
+  &lt;ftp action=&quot;del&quot;
+       server=&quot;ftp.apache.org&quot;
+       userid=&quot;anonymous&quot;
+       password=&quot;me@myorg.com&quot; &gt;
+    &lt;fileset&gt;
+      &lt;include name=&quot;**/*.tmp&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/ftp&gt;
+</pre>
+<p>Logs in to <code>ftp.apache.org</code> as <code>anonymous</code> and
+tries to delete all *.tmp files from the default directory for that user.
+If you don't have permission to delete a file, a BuildException is thrown.</p>
+<h3>Listing Files</h3>
+<pre>
+  &lt;ftp action=&quot;list&quot;
+       server=&quot;ftp.apache.org&quot;
+       userid=quot;anonymous&quot;
+       password=&quot;me@myorg.com&quot; 
+       listing=&quot;data/ftp.listing&quot; &gt;
+    &lt;fileset&gt;
+      &lt;include name=&quot;**&quot;/&gt;
+    &lt;/fileset&gt;
+  &lt;/ftp&gt;
+</pre>
+<p>This provides a file listing in <code>data/ftp.listing</code> of all the files on
+the FTP server relative to the default directory of the <code>anonymous</code>
+user. The listing is in whatever format the FTP server normally lists files.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/javacc.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/javacc.html
similarity index 96%
rename from jakarta-ant-1.2-src/docs/javacc.html
rename to jakarta-ant-1.2-src/docs/manual/OptionalTasks/javacc.html
index 85216a4..4a04afd 100644
--- a/jakarta-ant-1.2-src/docs/javacc.html
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/javacc.html
@@ -10,7 +10,7 @@
 <h2><a name="javacc">JavaCC</a></h2>
 <h3>Description</h3> 
 <p>
-  Invokes the <a HREF="http://www.metamata.com/javacc/">JavaCC</a> compiler 
+  Invokes the <a HREF="http://www.metamata.com/javacc/" target="_top">JavaCC</a> compiler 
   compiler on a grammar file.
 </p>
 <p>
@@ -160,7 +160,7 @@
 <blockquote><pre>
 &lt;javacc 
     target=&quot;src/Parser.jj&quot; 
-    outputdirectory&quot;build/src&quot;
+    outputdirectory=&quot;build/src&quot;
     javacchome=&quot;c:/program files/JavaCC&quot; 
     static=&quot;true&quot;
 /&gt;
@@ -172,3 +172,11 @@
 </p>
 <hr>
 
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation.
+All rights
+Reserved.</p>
+
+</body>
+</html>
+
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/javah.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/javah.html
new file mode 100644
index 0000000..5787fe1
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/javah.html
@@ -0,0 +1,117 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant</title>
+</head>
+
+<body>
+
+<h2><a name="zip">Javah</a></h2>
+<h3>Description</h3>
+<p>Generates JNI headers from a Java class.</p>
+<p> When this task executes, it will generate the C header and source files that
+are needed to implement native methods. JNI operates differently depending on
+whether <a href="http://java.sun.com/j2se/1.3/docs/tooldocs/win32/javah.html">JDK1.2</a>
+(or later) or <a href="http://java.sun.com/products/jdk/1.1/docs/tooldocs/win32/javah.html">pre-JDK1.2</a>
+systems are used.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td valign="top" align="center"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">class</td>
+    <td valign="top">the fully-qualified name of the class (or classes,
+      separated by commas)</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">outputFile</td>
+    <td valign="top">concatenates the resulting header or source files for all the classes listed into this file</td>
+    <td align="center" valign="middle" rowspan="2">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">destdir</td>
+    <td valign="top">sets the directory where javah saves the header files or the
+      stub files.</td>
+  </tr>
+  <tr>
+    <td valign="top">force</td>
+    <td valign="top">specifies that output files should always be written (JDK1.2 only)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">old</td>
+    <td valign="top">specifies that old JDK1.0-style header files should be generated
+      (otherwise output file contain JNI-style native method      function prototypes) (JDK1.2 only)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">stubs</td>
+    <td valign="top">generate C declarations from the Java object file (used with old)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">causes Javah to print a message concerning the status     of the generated files</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">the classpath to use.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">bootclasspath</td>
+    <td valign="top">location of bootstrap class files.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">extdirs</td>
+    <td valign="top"> location of installed extensions.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<p>Either outputFile or destdir must be supplied, but not both.&nbsp;</p>
+<h3>Examples</h3>
+<pre>  &lt;javah destdir=&quot;c&quot; class=&quot;org.foo.bar.Wibble&quot; /&gt;</pre>
+<p>makes a JNI header of the named class, using the JDK1.2 JNI model. Assuming
+the directory 'c' already exists, the file <tt>org_foo_bar_Wibble.h</tt>
+is created there. If this file already exists, it is left unchanged.</p>
+<pre>  &lt;javah outputFile=&quot;wibble.h&quot;&gt;
+    &lt;class name=&quot;org.foo.bar.Wibble,org.foo.bar.Bobble&quot;/&gt;
+  &lt;/javah&gt;</pre>
+<p>is similar to the previous example, except the output is written to a file
+called <tt>wibble.h</tt>
+in the current directory.</p>
+<pre>  &lt;javah destdir=&quot;c&quot; force=&quot;yes&quot;&gt;
+    &lt;class name=&quot;org.foo.bar.Wibble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Bobble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Tribble&quot;/&gt;
+  &lt;/javah&gt;</pre>
+<p>writes three header files, one for each of the classes named. Because the
+force option is set, these header files are always written when the Javah task
+is invoked, even if they already exist.</p>
+<pre>  &lt;javah destdir=&quot;c&quot; verbose=&quot;yes&quot; old=&quot;yes&quot; force=&quot;yes&quot;&gt;
+    &lt;class name=&quot;org.foo.bar.Wibble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Bobble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Tribble&quot;/&gt;
+  &lt;/javah&gt;
+  &lt;javah destdir=&quot;c&quot; verbose=&quot;yes&quot; stubs=&quot;yes&quot; old=&quot;yes&quot; force=&quot;yes&quot;&gt;
+    &lt;class name=&quot;org.foo.bar.Wibble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Bobble&quot;/&gt;
+    &lt;class name=&quot;org.foo.bar.Tribble&quot;/&gt;
+  &lt;/javah&gt;</pre>
+<p>writes the headers for the three classes using the 'old' JNI format, then
+writes the corresponding .c stubs. The verbose option will cause Javah to
+describe its progress.</p>
+
+<hr>
+
+</body>
+
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/jjtree.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/jjtree.html
new file mode 100644
index 0000000..4e76e9c
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/jjtree.html
@@ -0,0 +1,178 @@
+<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
+<html>
+<head>
+   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+   <meta http-equiv="Content-Language" content="en-us">
+   <title>JJTree Task</title>
+</head>
+<body>
+
+<h2>
+<a NAME="jjtree"></a>JJTree</h2>
+
+<h3>
+Description</h3>
+Invokes the <a href="http://www.metamata.com/javacc/">JJTree</a> preprocessor
+for the JavaCC compiler compiler. It inserts parse tree building actions
+at various places in the JavaCC source that it generates. The output of
+JJTree is run through JavaCC to create the parser.
+<p>To use the jjtree task, set the <i>target</i> attribute to the name
+of the jjtree grammar file to process. You also need to specify the directory
+containing the JavaCC installation using the <i>javacchome</i> attribute,
+so that ant can find the JavaCC classes. Optionally, you can also set the
+<i>outputdirectory</i>
+to write the generated file to a specific directory. Otherwise jjtree writes
+the generated JavaCC grammar file to the directory containing the JJTree
+grammar file.
+<p>This task only invokes JJTree if the grammar file is newer than the
+generated JavaCC file.
+<h3>
+Parameters</h3>
+
+<table BORDER CELLSPACING=0 CELLPADDING=2 >
+<tr>
+<td VALIGN=TOP><b>Attribute</b></td>
+
+<td VALIGN=TOP><b>Description</b></td>
+
+<td ALIGN=CENTER VALIGN=TOP><b>Required</b></td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>target</td>
+
+<td VALIGN=TOP>The jjtree grammar file to process.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>Yes</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>javacchome</td>
+
+<td VALIGN=TOP>The directory containing the JavaCC distribution.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>Yes</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>outputdirectory</td>
+
+<td VALIGN=TOP>The directory to write the generated file to. If not set,
+the files are written to the directory containing the grammar file.&nbsp;</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>buildnodefiles</td>
+
+<td VALIGN=TOP>Sets the BUILD_NODE_FILES grammar option. This is a boolean
+option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>multi</td>
+
+<td VALIGN=TOP>Sets the MULTI grammar option. This is a boolean option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodedefaultvoid</td>
+
+<td VALIGN=TOP>Sets the NODE_DEFAULT_VOID grammar option. This is a boolean
+option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodefactory</td>
+
+<td VALIGN=TOP>Sets the NODE_FACTORY grammar option. This is boolean option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodescopehook</td>
+
+<td VALIGN=TOP>Sets the NODE_SCOPE_HOOK grammar option. This is a boolean
+option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodeusesparser</td>
+
+<td VALIGN=TOP>Sets the NODE_USES_PARSER grammar option. This is a boolean
+option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>static</td>
+
+<td VALIGN=TOP>Sets the STATIC grammar option. This is a boolean option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>visitor</td>
+
+<td VALIGN=TOP>Sets the VISITOR grammar option. This is a boolean option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodepackage</td>
+
+<td VALIGN=TOP>Sets the NODE_PACKAGE grammar option. This is a string option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>visitorexception</td>
+
+<td VALIGN=TOP>Sets the VISITOR_EXCEPTION grammar option. This is a string
+option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+
+<tr>
+<td VALIGN=TOP>nodeprefix</td>
+
+<td VALIGN=TOP>Sets the NODE_PREFIX grammar option. This is a string option.</td>
+
+<td ALIGN=CENTER VALIGN=TOP>No</td>
+</tr>
+</table>
+
+<h3>
+Example</h3>
+
+<blockquote>
+<pre>&lt;jjtree&nbsp;
+&nbsp;&nbsp;&nbsp; target="src/Parser.jjt"&nbsp;
+&nbsp;&nbsp;&nbsp; outputdirectory="build/src"
+&nbsp;&nbsp;&nbsp; javacchome="c:/program files/JavaCC"&nbsp;
+&nbsp;&nbsp;&nbsp; nodeusesparser="true"
+/></pre>
+</blockquote>
+This invokes JJTree on grammar file src/Parser.jjt, writing the generated
+grammar file, Parser.jj, file to build/src. The grammar option NODE_USES_PARSER
+is set to true when invoking JJTree.
+<br>
+<hr>
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/jlink.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/jlink.html
similarity index 96%
rename from jakarta-ant-1.2-src/docs/jlink.html
rename to jakarta-ant-1.2-src/docs/manual/OptionalTasks/jlink.html
index 7da42aa..ce26a07 100644
--- a/jakarta-ant-1.2-src/docs/jlink.html
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/jlink.html
@@ -54,7 +54,7 @@ The <i>exclude</i> or <i>excludesfile</i> attribute is used to specify
 the files you want to have excluded. This is also done with patterns. And
 finally with the <i>defaultexcludes</i> attribute, you can specify whether you
 want to use default exclusions or not. See the section on <a
-href="#directorybasedtasks">directory based tasks</a>, on how the
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
 inclusion/exclusion of files works, and how to write patterns. The patterns are
 relative to the <i>base</i> directory.</p>
 
@@ -83,7 +83,7 @@ relative to the <i>base</i> directory.</p>
    <tr>
      <td valign="top">mergefiles</td>
      <td valign="top">files to be merged into the output, if possible.</td>
-     <td valign="middle" align="middle" rowspan="2">At least one of 
+     <td valign="middle" align="center" rowspan="2">At least one of 
 mergefiles or addfiles</td>
    </tr>
    <tr>
diff --git a/jakarta-ant-1.2-src/docs/junit.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/junit.html
similarity index 85%
rename from jakarta-ant-1.2-src/docs/junit.html
rename to jakarta-ant-1.2-src/docs/manual/OptionalTasks/junit.html
index 7445c93..b5efdf8 100644
--- a/jakarta-ant-1.2-src/docs/junit.html
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/junit.html
@@ -75,23 +75,43 @@ elements</a>.</p>
 <h3><a name="nested">Nested Elements</a></h3>
 
 <p><code>junit</code> supports a nested <code>&lt;classpath&gt;</code>
-element, that represents a <a href="index.html#path">PATH like
+element, that represents a <a href="../using.html#path">PATH like
 structure</a>.</p>
 
 <h4>jvmarg</h4>
 
 <p>If fork is enabled, additional parameters may be passed to the new
-VM via nested <code>&lt;jvmarg&gt;</code> attributes, for example:</p>
+VM via nested <code>&lt;jvmarg&gt;</code> attributes, for example:
 
-<pre><blockquote>
+<pre>
 &lt;junit fork=&quot;yes&quot;&gt;
   &lt;jvmarg value=&quot;-Djava.compiler=NONE&quot;/&gt;
+  ...
 &lt;/junit&gt;
-</blockquote></pre>
+</pre>
+
 would run the test in a VM without JIT.</p>
 
 <p><code>&lt;jvmarg&gt;</code> allows all attributes described in <a
-href="index.html#arg">Command line arguments</a>.</p>
+href="../using.html#arg">Command line arguments</a>.</p>
+
+<h4>sysproperty</h4>
+
+<p>Use nested <code>&lt;sysproperty&gt;</code> elements to specify system
+properties required by the class. These properties will be made available
+to the VM during the execution of the test (either ANT's VM or the forked VM).
+The attributes for this element are the same as for <a href="../CoreTasks/exec.html#env">environment variables</a>.
+
+<pre>
+&lt;junit fork=&quot;no&quot;&gt;
+  &lt;sysproperty key=&quot;basedir&quot; value=&quot;${basedir}&quot;/&gt;
+  ...
+&lt;/junit&gt;
+</pre>
+
+would run the test in ANT's VM and make the <code>basedir</code> property
+available to the test.</p>
+
 
 <h4>formatter</h4>
 
@@ -169,6 +189,11 @@ can be specified.</p>
       <code>&lt;junit&gt;</code>.</td>
     <td align="center" valign="top">No</td>
   </tr>
+  <tr>
+    <td valign="top">todir</td> 
+    <td valign="top">Directory to write the reports to.</td>
+    <td align="center" valign="top">No, default is current directory.</td>
+  </tr>
   <tr>
     <td valign="top">outfile</td> 
     <td valign="top">Base name of the test result. The full filename is
@@ -198,7 +223,7 @@ can be specified.</p>
 
 <p><code>batchtest</code> collects the included files from any number
 of nested <a
-href="index.html#fileset"><code>&lt;fileset&gt;</code></a>s. It then
+href="../CoreTypes/fileset.html"><code>&lt;fileset&gt;</code></a>s. It then
 generates a test class name for each file that ends in
 <code>.java</code> or <code>.class</code>.</p>
 
@@ -227,6 +252,11 @@ generates a test class name for each file that ends in
       <code>&lt;junit&gt;</code>.</td>
     <td align="center" valign="top">No</td>
   </tr>
+  <tr>
+    <td valign="top">todir</td> 
+    <td valign="top">Directory to write the reports to.</td>
+    <td align="center" valign="top">No, default is current directory.</td>
+  </tr>
   <tr>
     <td valign="top">if</td> 
     <td valign="top">Only run tests if the named property is set.</td>
@@ -243,29 +273,30 @@ generates a test class name for each file that ends in
 <code>&lt;formatter&gt;</code> elements.</p>
 
 <h3>Examples</h3>
-<pre><blockquote>
+
+<p><pre>
 &lt;junit&gt;
   &lt;test name="my.test.TestCase" /&gt;
 &lt;/junit&gt;
-</pre></blockquote>
+</pre>
 
-<p>Runs the test defined in <code>my.test.TestCase</code> in the same
+Runs the test defined in <code>my.test.TestCase</code> in the same
 VM. No output will be generated unless the test fails.</p>
 
-<pre><blockquote>
+<p><pre>
 &lt;junit printsummary="yes" fork="yes" haltonfailure="yes"&gt;
   &lt;formatter type="plain" /&gt;
   &lt;test name="my.test.TestCase" /&gt;
 &lt;/junit&gt;
-</pre></blockquote>
+</pre>
 
-<p>Runs the test defined in <code>my.test.TestCase</code> in a
+Runs the test defined in <code>my.test.TestCase</code> in a
 separate VM.  At the end of the test a single line summary will be
 printed. A detailed report of the test can be found in
 <code>TEST-my.test.TestCase.txt</code>. The build process will be
 stopped if the test fails.</p>
 
-<pre><blockquote>
+<p><pre>
 &lt;junit printsummary="yes" haltonfailure="yes"&gt;
   &lt;classpath&gt;
     &lt;pathelement location="${build.tests}" /&gt;
@@ -278,16 +309,16 @@ stopped if the test fails.</p>
     &lt;formatter type="xml" /&gt;
   &lt;/test&gt;
 
-  &lt;batchtest fork="yes"&gt;
+  &lt;batchtest fork="yes" todir="${reports.tests}"&gt;
     &lt;fileset dir="${src.tests}"&gt;
       &lt;include name="**/*Test*.java" /&gt;
-      &lt;exclude name="**/AllTests.java" /&lt;
+      &lt;exclude name="**/AllTests.java" /&gt;
     &lt;/fileset&gt;
   &lt;/batchtest&gt;
 &lt;/junit&gt;
-</pre></blockquote>
+</pre>
 
-<p>Runs <code>my.test.TestCase</code> in the same VM (ignoring the
+Runs <code>my.test.TestCase</code> in the same VM (ignoring the
 given CLASSPATH), only a warning is printed if this test fails. In
 addition to the plain text test results, for this test a XML result
 will be output to <code>result.xml</code>.</p>
@@ -295,7 +326,7 @@ will be output to <code>result.xml</code>.</p>
 <p>For each matching file in the directory <code>${src.tests}</code> a
 test is run in a separate VM. If a test fails, the build process is
 aborted. Results are collected in files named
-<code>TEST-<em>name</em>.txt</code>.</p>
+<code>TEST-<em>name</em>.txt</code> and written to <code>${reports.tests}</code>.</p>
 
 </body>
 </html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/junitreport.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/junitreport.html
new file mode 100644
index 0000000..435dc90
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/junitreport.html
@@ -0,0 +1,118 @@
+<html>
+<head>
+<title>JUnitReport</title>
+</head>
+
+<body>
+
+<h2><a name="junitreport">JUnitReport</a></h2>
+Merge the individual XML files generated by the JUnit task and eventually apply
+a stylesheet on the resulting merged document to provide a browsable report of
+the testcases results.
+<h3>Requirements</h3>
+<p>You need&nbsp; <a href="http://xml.apache.org/xalan/">Xalan 1</a> to use this
+task or use the Xalan1 compatibility jar of <a href="http://xml.apache.org/xalan-j/">Xalan2</a>.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td width="12%" valign="top"><b>Attribute</b></td>
+    <td width="78%" valign="top"><b>Description</b></td>
+    <td width="10%" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">tofile</td>
+    <td valign="top">The name of the XML file that will aggregate all individual
+      XML testsuite previously generated by the JUnit task.</td>
+    <td align="center" valign="top">No. Default to TESTS-TestSuites.xml</td>
+  </tr>
+  <tr>
+    <td valign="top">todir</td>
+    <td valign="top">The directory where should be written the file resulting
+      from the individual XML testsuite aggregation.</td>
+    <td align="center" valign="top">No. Default to current directory</td>
+  </tr>
+</table>
+<h3><a name="nested">Nested Elements</a></h3>
+<h4>fileset</h4>
+<p><code>junitreport</code> collects individual xml files generated by the JUnit
+task using the nested <a href="index.html#fileset"><code>&lt;FileSet&gt;</code></a>
+element.</p>
+<h4>report</h4>
+<p>Generate a browsable report based on the document created by the merge.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td width="12%" valign="top"><b>Attribute</b></td>
+    <td width="78%" valign="top"><b>Description</b></td>
+    <td width="10%" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">format</td>
+    <td valign="top">The format of the generated report. Must be &quot;noframes&quot;
+      or &quot;frames&quot;.</td>
+    <td align="center" valign="top">No, default to &quot;frames&quot;</td>
+  </tr>
+  <tr>
+    <td valign="top">styledir</td>
+    <td valign="top">The directory where the stylesheets are defined. They must
+      be conforming to the following conventions:
+      <p>For the noframes format, only the stylesheet overview-summary.xsl is
+      used.</p>
+      <p>For the frames format, the result will be javadoc-like. List of package
+      will be in top left frame, the list of classes in bottom left frame and
+      the details/summary in the main window.&nbsp; It uses the following XSLs:</p>
+      <ul>
+        <li><tt>all-packages.xsl</tt> - creates an <i>all-packages.html</i> file that
+          contains the list of all packages (top-left frame) with links to their
+          corresponding <i>package-summary.html</i> files in their respective
+          location (package name matches path name)</li>
+        <li><tt>all-classes.xsl</tt> - creates an <i> all-classes.html</i> file that contains the
+          whole list of classes in all packages with links to their
+          corresponding <i>&lt;classname&gt;-details.html</i> in their
+          respective package directory.</li>
+        <li><tt>overview-packages.xsl</tt> - creates an <i>overview-packages.html</i>
+          that makes a summary of all packages and classes not belonging to a
+          package.</li>
+        <li><tt>class-details.xsl</tt> - creates a detailed page about the testcases of a
+          testsuite. This this xsl will be applied on all testsuites and written
+          to the <i>&lt;classname&gt;-details.html</i> file located in their
+          respective package directory. </li>
+        <li><tt>package-summary.xsl</tt> - create a testsuite summary for a package. This
+          will be written to <i> package-summary.html</i> in its corresponding package
+          directory. </li>
+        <li><tt>classes-list.xsl</tt> - creates the list of classes belonging to a
+          specific package. This will be written to classes-list.html&nbsp; in
+          its corresponding package directory.</li>
+      </ul>
+    </td>
+    <td align="center" valign="top">No. Default to embedded stylesheets.</td>
+  </tr>
+  <tr>
+    <td valign="top">todir</td>
+    <td valign="top">The directory where the files resulting from the
+      transformation should be written to.</td>
+    <td align="center" valign="top">No. Default to current directory</td>
+  </tr>
+  <tr>
+    <td valign="top">extension</td>
+    <td valign="top">The extension of the generated files, they must include the
+      dot (ex: .html)</td>
+    <td align="center" valign="top">No. Default to .html</td>
+  </tr>
+</table>
+<h3>Example of report</h3>
+<blockquote>
+  <pre>&lt;junitreport todir=&quot;./reports&quot;&gt;
+  &lt;fileset dir=&quot;./reports&quot;&gt;
+    &lt;include name=&quot;TEST-*.xml&quot;/&gt;
+  &lt;/fileset&gt;
+  &lt;report format=&quot;frames&quot; todir=&quot;./report/html&quot;/&gt;
+&lt;/junitreport&gt;
+</pre>
+</blockquote>
+<p>would generate a <tt>TESTS-TestSuites.xml</tt> file in the directory <tt>reports</tt> and
+generate the default framed report in the directory <tt>report/html</tt>.</p>
+
+</body>
+
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/mparse.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/mparse.html
new file mode 100644
index 0000000..49436b0
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/mparse.html
@@ -0,0 +1,117 @@
+<!-- saved from url=(0022)http://internet.e-mail -->
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>MParse Task</title>
+</head>
+
+<body>
+
+<h2><a name="mparse">MParse</a></h2>
+<p>by</p>
+<ul>
+  <li>Stephane Bailliez (<a href="mailto:sbailliez@imediation.com">sbailliez@imediation.com</a>)</li>
+</ul>
+<h3>Requirements</h3>
+<p>This task requires Metamata Development environment 2.0 freely available at <a href="http://www.metamata.com">Metamata</a>.</p>
+<h3>Description</h3> 
+<p>
+  Invokes the Metamata <a HREF="http://www.metamata.com/parse.html">MParse</a> compiler 
+  compiler on a grammar file.
+</p>
+<p>
+  To use the <i>mparse</i> task, set the <i>target</i> attribute to the name of the 
+  grammar file to process.  You also need to specify the directory containing 
+  the Metamata installation using the <i>metamatahome</i> attribute, so that Ant 
+  can find the MParse classes.
+</p>
+<p>
+  This task only invokes MParse if the grammar file is newer than the generated 
+  Java files. MParse assumes that the Java class name of the generated parser
+  is the same as the name of the grammar file, less the .jj extension.
+</p>
+
+<p>For additional information about MParse, please consult the online manual available <a href="http://download.metamata.com/parse.pdf">here</a>
+(PDF)
+</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">target</td>
+    <td valign="top">The .jj grammar file to process. It will only be processed
+      if the grammar is newer than the corresponding .java file.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">metamatahome</td>
+    <td valign="top">The home directory containing the Metamata distribution.</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">
+      Enable all messages
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">debugparser</td>
+    <td valign="top">
+      Enables parser debugging
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">debugscanner</td>
+    <td valign="top">
+      Enables scanner debugging
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">cleanup</td>
+    <td valign="top">Remove the intermediate Sun
+      JavaCC file created during the transformation of the grammar file.</td>
+    <td valign="top" align="center">No. Default to false</td>
+  </tr>
+  <tr>
+    <td valign="top">maxmemory</td>
+    <td valign="top">Set the maximum memory for the JVM. this is a convenient
+      way to set the -mx or -Xmx argument.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Nested elements</h3>
+<h4>jvmarg</h4>
+<p>Additional parameters may be passed to the VM via nested <code>&lt;jvmarg&gt;</code>
+attributes. <code>&lt;jvmarg&gt;</code> allows all attributes described in <a href="index.html#arg">Command
+line arguments</a>.</p>
+<h4>classpath</h4>
+<p>Sets class path (also source path unless one explicitly set). Overrides
+METAPATH/CLASSPATH environment variables. &nbsp;The <tt>classpath</tt> element represents a <a href="index.html#path">PATH like
+structure</a>.</p>
+<h4>sourcepath</h4>
+<p>Sets source path. Overrides the SOURCEPATH environment variable.&nbsp;The <tt>sourcepath</tt> element represents a <a href="index.html#path">PATH like
+structure</a>.</p>
+<h3>Example</h3>
+<pre>  &lt;mparse target=&quot;c:/metamata/examples/parseexamples/javagrammars/singlefile/JavaParser.jj&quot;
+          metamatahome=&quot;c:/metamata&quot; cleanup=&quot;true&quot;&gt;
+    &lt;classpath&gt;
+      &lt;pathelement location=&quot;c:/metamata/examples/&quot;/&gt;
+    &lt;/classpath&gt;
+  &lt;/mparse&gt;</pre>
+<p>
+  This invokes Metamata MParse installed in <tt>c:/metamata</tt> on one of the grammar file
+example <tt>(JavaParser.jj)</tt>
+ and cleans up the intermediate Sun JavaCC file.
+</p>
+<hr>
+
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/native2ascii.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/native2ascii.html
new file mode 100644
index 0000000..816fa54
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/native2ascii.html
@@ -0,0 +1,135 @@
+<html>
+  <head><title>Native2Ascii</title></head>
+  <body>
+    <h2>Native2Ascii</h2>
+    
+    <h3>Description:</h3>
+    
+    <p>
+      Converts files from native encodings to ASCII with escaped Unicode.
+      A common usage is to convert source files maintained in a native
+      operating system encoding, to ASCII prior to compilation.
+    </p>
+
+    <p>
+      Files in the directory <em>src</em>
+      are converted from a native encoding to ASCII.
+      By default, all files in the directory are converted.
+      However, conversion may be limited to selected files using
+      <em>includes</em> and <em>excludes</em> attributes.
+      For more information on file matching patterns,
+      see the section on
+      <a href="index.html../dirtasks.html#directorybasedtasks">directory based tasks</a>.
+      If no <em>encoding</em> is specified, 
+      the default encoding for the JVM is used.
+      If <em>ext</em> is specified, then output files are renamed
+      to use it as a new extension. 
+      More sophisticated file name translations can be achieved using a nested
+      <em>&lt;mapper&gt;</em> element. By default an 
+      <a href="../CoreTypes/mapper.html#identity-mapper">identity mapper</a> will be used.
+      If <em>dest</em> and <em>src</em> point to the same directory,
+      the <em>ext</em> attribute or a nested <em>&lt;mapper&gt;</em>
+      is required.
+    </p>
+
+    <p>
+      This task forms an implicit <a href="index.html../CoreTypes/fileset.html">File Set</a>,
+      and supports all attributes of <code>&lt;fileset&gt;</code>
+      (<code>dir</code> becomes <code>src</code>) as well as 
+      nested <code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code>,
+      and <code>&lt;patternset&gt;</code> elements.
+    </p>
+
+    <table border="1" cellpadding="2" cellspacing="0">
+      <tr>
+        <td><b>Attribute</b></td>
+        <td><b>Description</b></td>
+        <td><b>Required</b></td>
+      </tr>
+      <tr>
+        <td>reverse</td>
+        <td>Reverse the sense of the conversion,
+          i.e. convert from ASCII to native</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>encoding</td>
+        <td>The native encoding the files are in
+          (default is the default encoding for the JVM)</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>src</td>
+        <td>The directory to find files in (default is <em>basedir</em>)</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>dest</td>
+        <td>The directory to output file to</td>
+        <td align="center">Yes</td>
+      </tr>
+      <tr>
+        <td>ext</td>
+        <td>File extension to use in renaming output files</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>defaultexcludes</td>
+        <td>indicates whether default excludes should be used or not
+          (&quot;yes&quot;/&quot;no&quot;).
+          Default excludes are used when omitted.
+        </td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>includes</td>
+        <td>comma separated list of patterns of files that must be
+          included. All files are included when omitted.</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>includesfile</td>
+        <td>the name of a file. Each line of this file is
+          taken to be an include pattern</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>excludes</td>
+        <td>comma separated list of patterns of files that must be excluded.
+          No files (except default excludes) are excluded when omitted.</td>
+        <td align="center">No</td>
+      </tr>
+      <tr>
+        <td>excludesfile</td>
+        <td>the name of a file. Each line of this file is
+          taken to be an exclude pattern</td>
+        <td align="center">No</td>
+      </tr>
+    </table>
+      
+    <h3>Examples</h3>
+
+    <pre>
+&lt;native2ascii encoding=&quot;EUCJIS&quot; src=&quot;srcdir&quot; dest=&quot;srcdir&quot;
+   includes=&quot;**/*.eucjis&quot; ext=&quot;.java&quot; /&gt;
+    </pre>
+
+    <p>
+      Converts all files in the directory <em>srcdir</em>
+      ending in <code>.eucjis</code> from the EUCJIS encoding to ASCII
+      and renames them to end in <code>.java</code>.
+    </p>
+
+<pre>
+&lt;native2ascii encoding='EUCJIS&quot; src=&quot;native/japanese&quot; dest=&quot;src&quot;
+   includes=&quot;**/*.java /&gt;
+</pre>
+
+    <p>
+      Converts all the files ending in <code>.java</code>
+      in the directory <em>native/japanese</em> to ASCII,
+      placing the results in the directory <em>src</em>.
+      The names of the files remain the same.
+    </p>
+  </body>
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/netrexxc.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/netrexxc.html
new file mode 100644
index 0000000..cc4530d
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/netrexxc.html
@@ -0,0 +1,277 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="netrexxc">NetRexxC</a></h2>
+<h3>Description</h3>
+<p>Compiles a <a href="http://www2.hursley.ibm.com/netrexx" target="_top">NetRexx</a>
+source tree within the running (Ant) VM.</p>
+<p>The source and destination directory will be recursively scanned for
+NetRexx source files to compile.  Only NetRexx files that have no corresponding
+class file or where the class file is older than the java file will be compiled.</p>
+<p>Files in the source tree are copied to the destination directory,
+allowing support files to be located properly in the classpath. The source 
+files are copied because the NetRexx compiler cannot produce class files in a
+specific directory via parameters</p>
+<p>The directory structure of the source tree should follow the package
+hierarchy.</p>
+<p>It is possible to refine the set of files that are being compiled/copied.
+This can be done with the <i>includes</i>, <i>includesfile</i>, <i>excludes</i>, <i>excludesfile</i> and
+<i>defaultexcludes</i> attributes. With the <i>includes</i> or <i>includesfile</i> attribute you 
+specify the files you want to have included by using patterns. The 
+<i>exclude</i> or <i>excludesfile</i> attribute is used to specify the files you want to have 
+excluded.  This is also done with patterns.  And finally with the 
+<i>defaultexcludes</i> attribute, you can specify whether you
+want to use default exclusions or not. See the section on <a
+href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns.</p>
+<p>This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>srcdir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">binary</td>
+    <td valign="top">Whether literals are treated as the java binary
+      type rather than the NetRexx types</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">classpath</td>
+    <td valign="top">The classpath to use during compilation</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">comments</td>
+    <td valign="top">Whether comments are passed through to the
+      generated java source</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compact</td>
+    <td valign="top">Whether error messages come out in compact or
+      verbose format</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">compile</td>
+    <td valign="top">Whether the NetRexx compiler should compile the
+      generated java code</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">console</td>
+    <td valign="top">Whether or not messages should be displayed on the
+      'console'</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">crossref</td>
+    <td valign="top">Whether variable cross references are generated</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">decimal</td>
+    <td valign="top">Whether decimal arithmetic should be used for the
+      NetRexx code</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when
+      omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">destDir</td>
+    <td valign="top">the destination directory into which the NetRexx
+      source files should be copied and then compiled</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">diag</td>
+    <td valign="top">Whether diagnostic information about the compile is
+      generated</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when
+      omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">explicit</td>
+    <td valign="top">Whether variables must be declared explicitly
+      before use</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">format</td>
+    <td valign="top">Whether the generated java code is formatted nicely
+      or left to match NetRexx line numbers for call stack debugging</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">java</td>
+    <td valign="top">Whether the generated java code is produced</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">keep</td>
+    <td valign="top">Sets whether the generated java source file should be kept
+      after compilation. The generated files will have an extension of
+      .java.keep, <b>not</b> .java</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">logo</td>
+    <td valign="top">Whether the compiler text logo is displayed when
+      compiling</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">replace</td>
+    <td valign="top">Whether the generated .java file should be replaced
+      when compiling</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">savelog</td>
+    <td valign="top">Whether the compiler messages will be written to
+      NetRexxC.log as well as to the console</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">sourcedir</td>
+    <td valign="top">Tells the NetRexx compiler to store the class files in the
+      same directory as the source files. The alternative is the working
+      directory</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">Set the source dir to find the source NetRexx
+      files</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">strictargs</td>
+    <td valign="top">Tells the NetRexx compiler that method calls always
+      need parentheses, even if no arguments are needed, e.g. 
+      <code>aStringVar.getBytes</code> vs. 
+      <code>aStringVar.getBytes()</code></td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strictassign</td>
+    <td valign="top">Tells the NetRexx compile that assignments must
+      match exactly on type</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strictcase</td>
+    <td valign="top">Specifies whether the NetRexx compiler should be
+      case sensitive or not</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strictimport</td>
+    <td valign="top">Whether classes need to be imported explicitly using an 
+      <code>import</code> statement.  By default the NetRexx compiler will 
+      import certain packages automatically</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strictprops</td>
+    <td valign="top">Whether local properties need to be qualified
+      explicitly using <code>this</code></td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">strictsignal</td>
+    <td valign="top">Whether the compiler should force catching of
+      exceptions by explicitly named types</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">symbols</td>
+    <td valign="top">Whether debug symbols should be generated into the
+      class file</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">time</td>
+    <td valign="top">Asks the NetRexx compiler to print compilation
+      times to the console</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">trace</td>
+    <td valign="top">Turns on or off tracing and directs the resultant
+      trace output</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">utf8</td>
+    <td valign="top">Tells the NetRexx compiler that the source is in UTF8</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">verbose</td>
+    <td valign="top">Whether lots of warnings and error messages should
+      be generated</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;netrexxc srcDir=&quot;/source/project&quot;
+           includes=&quot;vnr/util/*&quot;
+           destDir=&quot;/source/project/build&quot;
+           classpath=&quot;/source/project2/proj.jar&quot;
+           comments=&quot;true&quot;
+           crossref=&quot;false&quot; replace=&quot;true&quot;
+           keep=&quot;true&quot;/&gt;</code>
+  </p>
+</blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/perforce.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/perforce.html
new file mode 100644
index 0000000..ba66244
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/perforce.html
@@ -0,0 +1,355 @@
+<html>
+<head>
+<title>Perforce Tasks for ANT</title>
+</head>
+<body>
+<h1>Perforce Tasks User Manual</h1>
+<p>by</p>
+<ul>
+    <li>Les Hughes (<a href="mailto:leslie.hughes@rubus.com">leslie.hughes@rubus.com</a>)</li>
+</ul>
+<p>Version 1.1 - 2001/01/09</p>
+<hr>
+<h2>Contents</h2>
+<ul>
+    <li><a href="#intro">Introduction</a></li>
+    <li><a href="#tasks">The Tasks</a></li>
+    <li><a href="#changes">Change History</a></li>
+</ul>
+<br>
+<h2><a name="intro">Introduction</a></h2>
+<p>These tasks provide an interface to the <a href="http://www.perforce.com" target="_top">Perforce</a> SCM.
+The <code>org.apache.tools.ant.taskdefs.optional.perforce</code> package consists of a simple framework to support 
+p4 functionality as well as some Ant tasks encapsulating frequently used (by me :-) p4 commands. 
+However, the addition of new p4 commands is a pretty simple task (see the source). 
+Although it is possible to use these commands on the desktop, 
+they were primarily intended to be used by automated build systems.</p>
+
+<p><b>Note:</b> These tasks require the <a href="http://jakarta.apache.org/oro" target="_top">oro 2.0</a> regular
+expression package. Simply download this package and copy the jakarta-oro-2.0.jar file into Ant's lib directory.
+You will also need the perforce client executable (p4 or p4.exe but not p4win.exe) in your path.
+</p>
+
+
+
+<h2><a name="tasks">The Tasks</a></h2>
+
+<table border="0" cellspacing="0" cellpadding="3">
+    <tr>
+        <td><a href="#p4sync">P4Sync</a></td>
+        <td>Synchronise a workspce to a depot</td>
+    </tr>
+    <tr>
+        <td><a href="#p4change">P4Change</a></td>
+        <td>Request a new changelist from the perforce server</td>
+    </tr>
+    <tr>
+        <td><a href="#p4edit">P4Edit</a></td>
+        <td>Open files for edit (checkout)</td>
+    </tr>
+    <tr>
+        <td><a href="#p4submit">P4Submit</a></td>
+        <td>Submit a changelist to the perforce server (checkin)</td>
+    </tr>
+    <tr>
+        <td><a href="#p4have">P4Have</a></td>
+        <td>List current files in client view, useful for reporting</td>
+    </tr>
+    <tr>
+        <td><a href="#p4label">P4Label</a></td>
+        <td>Create a label reflecting files in the current workspace</td>
+    </tr>
+</table>
+
+<h3>General P4 Properties</h3>
+<p>Each p4 task requires a number of settings, either through build-wide properties, individual attributes 
+or environment variables. These are
+</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Property</b></td>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Env Var</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Default</b></td>
+  </tr>
+  <tr>
+    <td valign="top">p4.port</td>
+    <td valign="top">port</td>
+    <td valign="top">P4PORT</td>
+    <td valign="top">The p4d server and port to connect to</td>
+    <td valign="top">perforce:1666</td>
+  </tr>
+  <tr>
+    <td valign="top">p4.client</td>
+    <td valign="top">client</td>
+    <td valign="top">P4CLIENT</td>
+    <td valign="top">The p4 client spec to use</td>
+    <td valign="top">The logged in username</td>
+  </tr>
+  <tr>
+    <td valign="top">p4.user</td>
+    <td valign="top">user</td>
+    <td valign="top">P4USER</td>
+    <td valign="top">The p4 username</td>
+    <td valign="top">The logged in username</td>
+  </tr>
+<tr>
+    <td valign="top" align="center">--</td>
+    <td valign="top">view</td>
+    <td valign="top" align="center">--</td>
+    <td valign="top">The client, branch or label view to operate upon. See the p4 user guide for more info.</td>
+    <td valign="top">//...</td>
+  </tr>
+
+</table>
+<p>
+Your local  installation of perforce may require other settings (e.g. P4PASSWD, P4CONFIG). At the moment, these can only be set outside of Ant, as environment variables.
+</p>
+
+<h3>Examples</h3>
+<p>Setting in the environment:-</p>
+<p>
+(Unix csh)</p>
+<pre>setenv P4PORT myperforcebox:1666</pre>
+<p>(Unix sh et al)</p>
+<pre>P4USER=myp4userid; export P4USER</pre>
+<p>Using build properties:-</p>
+<pre>&lt;property name=&quot;p4.client&quot; value=&quot;nightlybuild&quot;/&gt;</pre>
+<p>Using task attributes:-</p>
+<pre>
+&lt;p4Whatever
+	port=&quot;myserver:1666&quot;
+	client=&quot;smoketest&quot;
+	user=&quot;smoketestdude&quot;
+	.
+	.
+	.
+/&gt;
+</pre>
+
+<p>
+For more information regarding the underlying 'p4' commands you are referred to the Perforce Command Reference
+available from the <a href="http://www.perforce.com/" target="_top">Perforce website</a>.
+</p>
+
+<h3>Taskdefs</h3>
+<p>Standard taskdefs (for you to copy'n'paste)</p>
+<pre>
+    &lt;taskdef name=&quot;p4sync&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Sync&quot; /&gt;
+    &lt;taskdef name=&quot;p4change&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Change&quot; /&gt;
+    &lt;taskdef name=&quot;p4edit&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Edit&quot; /&gt;
+    &lt;taskdef name=&quot;p4submit&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Submit&quot; /&gt;
+    &lt;taskdef name=&quot;p4have&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Have&quot; /&gt;
+    &lt;taskdef name=&quot;p4label&quot; classname=&quot;org.apache.tools.ant.taskdefs.optional.perforce.P4Label&quot; /&gt;
+</pre>
+
+<hr>
+<h2>Task Descriptions</h2>
+<h2><a name="p4sync">P4Sync</a></h2>
+<h3>Description:</h3>
+<p>Synchronize the current workspace with the depot.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">force</td>
+    <td valign="top">force a refresh of files</td>
+    <td valign="top" align="center">no</td>
+  </tr>
+<tr>
+    <td valign="top">label</td>
+    <td valign="top">sync client to label</td>
+    <td valign="top" align="center">no</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<pre>&lt;p4sync label=&quot;nightlybuild-0.0123&quot; force=&quot;yes&quot; /&gt;
+&lt;p4sync view=&quot;//depot/projects/projectfoo/main/src/...&quot; /&gt;
+</pre>
+<hr>
+
+
+
+<h2><a name="p4change">P4Change</a></h2>
+<h3>Description:</h3>
+<p>Request a new changelist from the perforce server. 
+This task sets the ${p4.change} property which can then be passed to P4Submit or P4Edit.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">None</td>
+    <td valign="top" align="center">--</td>
+    <td valign="top" align="center">--</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<pre>&lt;p4change /&gt;
+</pre>
+<hr>
+
+
+
+
+<h2><a name="p4edit">P4Edit</a></h2>
+<h3>Description:</h3>
+<p>Open file(s) for edit. P4Change should be used to obtain a new changelist for P4Edit as,
+although P4Edit can open files to the default change,  P4Submit cannot yet submit it.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">view</td>
+    <td valign="top">The filespec to request to edit</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">change</td>
+    <td valign="top">An existing changelist number to assign files to.</td>
+    <td valign="top" align="center">No, but see above.</td>
+  </tr>
+
+</table>
+
+<h3>Examples</h3>
+<pre>
+&lt;p4edit
+	view=&quot;//depot/projects/projectfoo/main/src/Blah.java...&quot;
+	change=&quot;${p4.change}&quot; /&gt;
+</pre>
+<hr>
+
+
+
+
+<h2><a name="p4submit">P4Submit</a></h2>
+<h3>Description:</h3>
+<p>Submit a changelist, usually obtained from P4Change.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">change</td>
+    <td valign="top">The changelist number to submit</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<pre>&lt;p4submit change=&quot;${p4.change}&quot; /&gt;
+</pre>
+<hr>
+
+
+
+
+<h2><a name="p4have">P4Have</a></h2>
+<h3>Description:</h3>
+<p>List handy file info reflecting the current client contents.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">None</td>
+    <td valign="top" align="center">--</td>
+    <td valign="top" align="center">--</td>
+  </tr>
+</table>
+
+<h3>Examples</h3>
+<pre>&lt;p4have /&gt;
+</pre>
+<hr>
+
+
+
+
+<h2><a name="p4label">P4Label</a></h2>
+<h3>Description:</h3>
+<p>Create a new label and set contents to reflect current client file revisions.
+</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">The name of the label</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">view</td>
+    <td valign="top">client view to use for label</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">desc</td>
+    <td valign="top">Label Description</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+
+
+</table>
+
+<h3>Examples</h3>
+<pre>
+&lt;p4label
+	name=&quot;NightlyBuild:${DSTAMP}:${TSTAMP}&quot; 
+	desc=&quot;Auto Nightly Build&quot;
+/&gt;
+</pre>
+<hr>
+
+
+<h2><a name="changes">Change History</a></h2>
+<table border="1" cellpadding="2" cellspacing="0">
+<tr>
+    <td valign="top">Sept 2000</td>
+    <td valign="top" align="center">--</td>
+    <td valign="top">Internal Release within Rubus</td>
+</tr>
+
+<tr>
+    <td valign="top">Nov 2000</td>
+    <td valign="top">V1.0</td>
+    <td valign="top">Initial Release donated to ASF :-)</td>
+</tr>
+<tr>
+    <td valign="top">Jan 2001</td>
+    <td valign="top">V1.1</td>
+    <td valign="top">fixed cross platform (NT/Unix) bug<br>refactored p4 output handling code<br>refactored exec'ing code</td>
+</tr>
+</table>
+</body>
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/propertyfile.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/propertyfile.html
new file mode 100644
index 0000000..786f37f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/propertyfile.html
@@ -0,0 +1,156 @@
+<html>
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant PropertyFile Task</title>
+
+</head>
+
+<body>
+
+<h1>Ant PropertyFile Task User Manual</h1>
+<p>by</p>
+<!-- Names are in alphabetical order, on last name -->
+<ul>
+  <li>Thomas Christen (<a href="mailto:chr@active.ch">chr@active.ch</a>)</li>
+  <li>Jeremy Mawson (<a href="mailto:jem@loftinspace.com.au">jem@loftinspace.com/au</a>)</li>
+</ul>
+
+<p>Version 1.1 - 2001/01/28</p>
+<hr>
+<h2>Table of Contents</h2>
+<ul>
+  <li><a href="#introduction">Introduction</a></li>
+  <li><a href="#proptask">PropertyFile Task</a></li>
+  <li><a href="#entryElement">Entry Task</a></li>
+</ul>
+
+<hr>
+<h2><a name="introduction">Introduction</a></h2>
+<p>Ant provides an optional task for editing property files.  This is very useful
+when wanting to make unattended modifications to configuration files for application
+servers and applications.  Currently, the task maintains a working property file with
+the ability to add properties or make changes to existing ones.  However, any comments
+are lost.  Work is being done to make this task a bit more &quot;human friendly&quot;.</p>
+
+<hr>
+<h2><a name="proptask">PropertyFile Task</a></h2>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+<tr>
+  <td width="12%" valign="top"><b>Attribute</b></td>
+  <td width="78%" valign="top"><b>Description</b></td>
+  <td width="10%" valign="top"><b>Required</b></td>
+</tr>
+<tr>
+  <td width="12%" valign="top">file</td>
+  <td width="78%" valign="top">Location of the property file to be edited</td>
+  <td width="10%" valign="top">Yes</td>
+</tr>
+<tr>
+  <td width="12%" valign="top">comment</td>
+  <td width="78%" valign="top">Header for the file itself</td>
+  <td width="10%" valign="top">no</td>
+</tr>
+</table>
+
+<h3>Parameters specified as nested elements</h3>
+<h4><a name="entryElement">Entry</a></h4>
+<p>Use nested <code>&lt;entry&gt;</code>
+elements to specify actual modifcations to the property file itself</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">key</td>
+    <td valign="top">Name of the property name/value pair</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">value</td>
+    <td valign="top">Value to set (=), to add (+) or subtract (-)</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">type</td>
+    <td valign="top">Regard the value as : int, date or string (default)</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">operation</td>
+    <td valign="top">&quot;+&quot; or &quot;=&quot; (default) for all datatypes<br>&quot;-&quot; (for date and int only).<br>
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">default</td>
+    <td valign="top">Initial value to set for a property if it is not
+                     already defined in the property file.<br>
+                     For type date, two additional keywords are allowed: &quot;now&quot; or &quot;never&quot;.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">pattern</td>
+    <td valign="top">For int and date type only. If present, Values will
+                     be parsed and formatted accordingly.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+
+<p>The following changes the my.properties file.  Assume my.properties look like:</p>
+
+<pre># A comment
+akey=novalue</pre>
+
+<p>After running, the file would now look like
+</p>
+<pre>#Thu Nov 02 23:41:47 EST 2000
+akey=avalue
+adate=2000/11/02 23\:41
+anint=1
+formated.int=0014
+formated.date=028 17\:34
+</pre>
+<p>
+The slashes conform to the expectations of the Properties class.  The file will be stored in a manner so that each character is examined and escaped if necessary.  Note that the original comment is now lost.  Please keep this in mind when running this task against heavily commented properties files.  It may be best to have a commented version in the source tree, copy it to a deployment area, and then run the modifications on the copy.  Future versions of PropertyFile will hopefully eliminate this shortcoming.
+</p>
+
+<blockquote><pre>&lt;propertyfile
+    file=&quot;my.properties&quot;
+    comment&quot;My properties&quot; &gt;
+  &lt;entry  key=&quot;akey&quot; value=&quot;avalue&quot; /&gt;
+  &lt;entry  key=&quot;adate&quot; type=&quot;date&quot; value=&quot;now&quot;/&gt;
+  &lt;entry  key=&quot;anint&quot; type=&quot;int&quot; operation=&quot;+&quot;/&gt;
+  &lt;entry  key=&quot;formated.int&quot; type=&quot;int&quot; default=&quot;0013&quot; operation=&quot;+&quot; pattern=&quot;0000&quot;/&gt;
+  &lt;entry  key=&quot;formated.date&quot; type=&quot;date&quot; value=&quot;now&quot; pattern=&quot;DDD HH:mm&quot;/&gt;
+&lt;/propertyfile&gt;
+</pre></blockquote>
+<p>
+To produce dates relative from today :</p>
+<blockquote><pre>&lt;propertyfile
+    file=&quot;my.properties&quot;
+    comment=&quot;My properties&quot; &gt;
+  &lt;entry  key=&quot;formated.date-1&quot;
+      type=&quot;date&quot; default=&quot;now&quot; pattern=&quot;DDD&quot;
+      operation=&quot;-&quot; value=&quot;1&quot;/&gt;
+  &lt;entry  key=&quot;formated.tomorrow&quot;
+      type=&quot;date&quot; default=&quot;now&quot; pattern=&quot;DDD&quot;
+      operation=&quot;+&quot; value=&quot;1&quot;/&gt;
+&lt;/propertyfile&gt;
+</pre></blockquote>
+
+<p>
+Concatenation of strings :</p>
+<blockquote><pre>&lt;propertyfile
+    file=&quot;my.properties&quot;
+    comment=&quot;My properties&quot; &gt;
+  &lt;entry  key=&quot;progress&quot; default=&quot;&quot; operation=&quot;+&quot; value=&quot;.&quot;/&gt;
+&lt;/propertyfile&gt;
+</pre></blockquote>
+<p>Each time called, a &quot;.&quot; will be appended to &quot;progress&quot;
+</p>
+</body>
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/renameextensions.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/renameextensions.html
new file mode 100644
index 0000000..430b311
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/renameextensions.html
@@ -0,0 +1,108 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="renameexts">RenameExtensions</a></h2>
+<h3><i>Deprecated</i></h3>
+<p><i>This task has been deprecated.  Use the <a href="../CoreTasks/move.html">move</a>
+task with a <a href="../CoreTypes/mapper.html#glob-mapper">glob mapper</a> instead.</i></p>
+<h3>Description</h3>
+<p>Renames files in the <code>srcDir</code> directory ending with the
+<code>fromExtension</code> string so that they end with the 
+<code>toExtension</code> string. Files are only replaced if 
+<code>replace</code> is true
+</p>
+<p>See the section on 
+<a href="../dirtasks.html#directorybasedtasks">directory based tasks</a>, on how the
+inclusion/exclusion of files works, and how to write patterns. 
+This task forms an implicit <a href="../CoreTypes/fileset.html">FileSet</a> and
+supports all attributes of <code>&lt;fileset&gt;</code>
+(<code>dir</code> becomes <code>srcDir</code>) as well as the nested
+<code>&lt;include&gt;</code>, <code>&lt;exclude&gt;</code> and
+<code>&lt;patternset&gt;</code> elements.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">defaultexcludes</td>
+    <td valign="top">indicates whether default excludes should be used or not
+      (&quot;yes&quot;/&quot;no&quot;). Default excludes are used when
+      omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      excluded. No files (except default excludes) are excluded when
+      omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">excludesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an exclude pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">fromExtention</td>
+    <td valign="top">The string that files must end in to be renamed</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">includes</td>
+    <td valign="top">comma separated list of patterns of files that must be
+      included. All files are included when omitted.</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">includesfile</td>
+    <td valign="top">the name of a file. Each line of this file is
+      taken to be an include pattern</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">replace</td>
+    <td valign="top">Whether the file being renamed to should be
+      replaced if it already exists</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">srcDir</td>
+    <td valign="top">The starting directory for files to search in</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">toExtension</td>
+    <td valign="top">The string that renamed files will end with on
+      completion</td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+  <p><code>&lt;renameext srcDir=&quot;/source/project1&quot;
+              includes=&quot;**&quot;
+              excludes=&quot;**/samples/*&quot;
+              fromExtension=&quot;.java.keep&quot;
+              toExtension=&quot;.java&quot;
+              replace=&quot;true&quot;/&gt;
+</code>
+  </p>
+</blockquote>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/script.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/script.html
new file mode 100644
index 0000000..fdb8a26
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/script.html
@@ -0,0 +1,121 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="script">Script</a></h2>
+<h3>Description</h3>
+<p>Execute a script in a 
+  <a href="http://oss.software.ibm.com/developerworks/opensource/bsf/" target="_top">BSF</a> supported language.</p>
+<p>All items (tasks, targets, etc) of the running project are
+accessible from the script, using either their <code>name</code> or
+<code>id</code> attributes.</p>
+<p>Scripts can do almost anything a task written in Java could do.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">language</td>
+    <td valign="top">The programming language the script is written in.
+      Must be a supported BSF language</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">src</td>
+    <td valign="top">The location of the script as a file, if not inline</td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+<blockquote><pre>
+&lt;project name=&quot;squares&quot; default=&quot;main&quot; basedir=&quot;.&quot;&gt;
+
+  &lt;target name=&quot;setup&quot;&gt;
+
+    &lt;script language=&quot;javascript&quot;&gt; &lt;![CDATA[
+
+      for (i=1; i&lt;=10; i++) {
+        echo = squares.createTask(&quot;echo&quot;);
+        main.addTask(echo);
+        echo.setMessage(i*i);
+      }
+
+    ]]&gt; &lt;/script&gt;
+
+  &lt;/target&gt;
+
+  &lt;target name=&quot;main&quot; depends=&quot;setup&quot;/&gt;
+
+&lt;/project&gt;
+</pre></blockquote>
+<p>generates</p>
+<blockquote><pre>
+setup:
+
+main:
+1
+4
+9
+16
+25
+36
+49
+64
+81
+100
+
+BUILD SUCCESSFUL
+</pre></blockquote>
+<p>Another example, using <a href="../using.html#references">references by id</a>
+and two different scripting languages:</p>
+<blockquote><pre>
+&lt;project name=&quot;testscript&quot; default=&quot;main&quot;&gt;
+  &lt;target name=&quot;sub&quot;&gt;
+    &lt;echo id=&quot;theEcho&quot;/&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;sub1&quot;&gt;
+    &lt;script language=&quot;netrexx&quot;&gt;&lt;![CDATA[
+      theEcho.setMessage(&quot;In sub1&quot;)
+      sub.execute
+    ]]&gt;&lt;/script&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;sub2&quot;&gt;
+    &lt;script language=&quot;javascript&quot;&gt;&lt;![CDATA[
+      theEcho.setMessage(&quot;In sub2&quot;);
+      sub.execute();
+    ]]&gt;&lt;/script&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;main&quot; depends=&quot;sub1,sub2&quot;/&gt;
+&lt;/project&gt;
+</pre></blockquote>
+<p>generates</p>
+<blockquote><pre>
+sub1:
+In sub1
+
+sub2:
+In sub2
+
+main:
+
+BUILD SUCCESSFUL
+</pre></blockquote>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/sound.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/sound.html
new file mode 100644
index 0000000..1e35997
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/sound.html
@@ -0,0 +1,95 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="sound">Sound</a></h2>
+<h3>Description</h3>
+<p>Plays a sound-file at the end of the build, according to whether
+the build failed or succeeded. You can specify either a specific
+sound-file to play, or, if a directory is specified, the
+<code>&lt;sound&gt;</code> task will randomly select a file to play.
+Note: At this point, the random selection is based on all the files
+in the directory, not just those ending in appropriate suffixes
+for sound-files, so be sure you only have sound-files in the 
+directory you specify.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">loops</td>
+    <td valign="top">the number of extra times to play the sound-file;
+      default is <code>0</code>.
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">duration</td>
+    <td valign="top">the amount of time (in milliseconds) to play
+      the sound-file.
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<p>
+To specify the sound-files or the sound-file directories, use the
+nested <code>&lt;success&gt;</code> and <code>&lt;fail&gt;</code> 
+elements:</p>
+<blockquote>
+<pre>
+&lt;success&gt;     the path to a sound-file directory, or the name of a
+              specific sound-file, to be played if the build succeeded.
+&lt;fail&gt;        the path to a sound-file directory, or the name of a
+              specific sound-file, to be played if the build succeeded.
+</pre>
+</blockquote>
+
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;target name=&quot;fun&quot; if=&quot;fun&quot; unless=&quot;fun.done&quot;&gt;
+  &lt;sound loops=&quot;2&quot;&gt;
+    &lt;success source=&quot;${user.home}/sounds/bell.wav&quot;/&gt;
+    &lt;fail source=&quot;${user.home}/sounds/ohno.wav&quot;/&gt;
+  &lt;/sound&gt;
+  &lt;property name=&quot;fun.done&quot; value=&quot;true&quot;/&gt;
+&lt;/target&gt;
+</pre>
+</blockquote>
+plays the <code>bell.wav</code> sound-file if the build succeeded, or
+the <code>ohno.wav</code> sound-file if the build failed, three times,
+if the <code>fun</code> property is set to <code>true</code>.
+If the target
+is a dependency of an &quot;initialization&quot; target that other
+targets depend on, the
+<code>fun.done</code> property prevents the target from being executed
+more than once.
+<blockquote>
+<pre>
+&lt;target name=&quot;fun&quot; if=&quot;fun&quot; unless=&quot;fun.done&quot;&gt;
+  &lt;sound>
+    &lt;success source=&quot;//intranet/sounds/success&quot;/&gt;
+    &lt;fail source=&quot;//intranet/sounds/failure&quot;/&gt;
+  &lt;/sound&gt;
+  &lt;property name=&quot;fun.done&quot; value=&quot;true&quot;/&gt;
+&lt;/target&gt;
+</pre>
+</blockquote>
+randomly selects a sound-file to play when the build succeeds or fails.
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/stylebook.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/stylebook.html
new file mode 100644
index 0000000..e1d39f2
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/stylebook.html
@@ -0,0 +1,63 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="stylebook">Stylebook</a></h2>
+<h3>Description</h3>
+<p>This executes the apache Stylebook documentation generator. 
+Unlike the commandline version of this tool, all three arguments
+are required to run stylebook.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">book</td>
+    <td valign="top">the book xml file that the documentation generation starts from
+    </td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">skindirectory</td>
+    <td valign="top">the directory that contains the stylebook skin
+    </td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">targetdirectory</td>
+    <td valign="top">the destination directory where the documentation is generated 
+    </td>
+    <td valign="top" align="center">Yes</td>
+  </tr>
+</table>
+<p>
+The user can also specify the nested &lt;classpath&gt; element which defines classpath 
+in which the task is executed.</p>
+
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;stylebook targetdirectory=&quot;build/docs&quot; 
+           book=&quot;src/xdocs/book.xml&quot; 
+           skindirectory=&quot;src/skins/myskin&quot;/&gt;
+</pre>
+</blockquote>
+The above will generate documentation in build/docs starting from the book 
+src/xdocs/book.xml and using the skin located in directory src/skins/myskin.
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/telnet.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/telnet.html
new file mode 100644
index 0000000..9633777
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/telnet.html
@@ -0,0 +1,100 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="telnet">Telnet</a></h2>
+<h3>Description</h3>
+Task to automate a remote telnet session. The task uses nested &lt;read&gt; to indicate strings to wait for, and  &lt;write&gt; tags to specify text to send.  
+
+<p>If you do specify a userid and password, the system will assume a common unix prompt to wait on. This behavior can be easily over-ridden.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+     <td>userid</td>
+     <td>the login id to use on the telnet server.</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>password</td>
+     <td>the login password to use on the telnet server.</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>server</td>
+     <td>the address of the remote telnet server.</td>
+     <td>Yes</td>
+  </tr>
+  <tr>
+     <td>port</td>
+     <td>the port number of the remote telnet server. Defaults to port 23.</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>initialCR</td>
+     <td>send a cr after connecting (&quot;yes&quot;). Defaults to &quot;no&quot;.</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>timeout</td>
+     <td>set a default timeout to wait for a response. Specified in seconds. Default is no timeout.</td>
+     <td>No</td>
+  </tr>
+</table>
+<h3>Examples</h3>
+A simple example of connecting to a server and running a command.  This assumes a prompt of &quot;ogin:&quot; for the userid, and a prompt of &quot;assword:&quot; for the password.
+<blockquote><pre>
+&lt;telnet userid=&quot;bob&quot; password=&quot;badpass&quot; server=&quot;localhost&quot;&gt;
+   &lt;read&gt;/home/bob&lt;/read&gt;
+   &lt;write&gt;ls&lt;/write&gt;
+   &lt;read string=&quot;/home/bob&quot;/&gt;
+&lt;/telnet&gt;
+</pre></blockquote>
+
+This task can be rewritten as:
+<blockquote><pre>
+&lt;telnet server=&quot;localhost&quot;&gt;
+   &lt;read&gt;ogin:&lt;/read&gt;
+   &lt;write&gt;bob&lt;/write&gt;
+   &lt;read&gt;assword:&lt;/read&gt;
+   &lt;write&gt;badpass&lt;/write&gt;
+   &lt;read&gt;/home/bob&lt;/read&gt;
+   &lt;write&gt;ls&lt;/write&gt;
+   &lt;read&gt;/home/bob&lt;/read&gt;
+&lt;/telnet&gt;
+</pre></blockquote>
+
+A timeout can be specified at the &lt;telnet&gt; level or at the &lt;read&gt; level. This will connect, issue a sleep command that is suppressed from displaying and wait 10 seconds before quitting.
+<blockquote><pre>
+&lt;telnet userid=&quot;bob&quot; password=&quot;badpass&quot; server=&quot;localhost&quot; timeout=&quot;20&quot;&gt;
+   &lt;read&gt;/home/bob&lt;/read&gt;
+   &lt;write echo=&quot;false&quot;&gt;sleep 15&lt;/write&gt;
+   &lt;read timeout=&quot;10&quot;&gt;/home/bob&lt;/read&gt;
+&lt;/telnet&gt;
+</pre></blockquote>
+
+The task can be used with other ports as well:
+<blockquote><pre>
+&lt;telnet port=&quot;80&quot; server=&quot;localhost&quot; timeout=&quot;20&quot;&gt;
+   &lt;read/&gt;
+   &lt;write&gt;GET / http/0.9&lt;/write&gt;
+   &lt;write/&gt;
+   &lt;read timeout=&quot;10&quot;&gt;&amp;lt;/HTML&amp;gt;&lt;/read&gt;
+&lt;/telnet&gt;
+</pre></blockquote>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/test.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/test.html
new file mode 100644
index 0000000..880be1f
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/test.html
@@ -0,0 +1,72 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="test">Test</a></h2>
+<h3>Description</h3>
+<p>This is a primitive task to execute a unit test in the org.apache.testlet framework.</p>
+
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">showSuccess</td>
+    <td valign="top">a boolean value indicating whether tests should display a 
+    message on success
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">showBanner</td>
+    <td valign="top">a boolean value indicating whether a banner should be displayed 
+    when starting testlet engine
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">forceShowTrace</td>
+    <td valign="top">a boolean indicating that a stack trace is displayed on any failure
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+  <tr>
+    <td valign="top">showTrace</td>
+    <td valign="top">a boolean indicating that a stack trace is displayed on 
+    error (but not normal failure)
+    </td>
+    <td valign="top" align="center">No</td>
+  </tr>
+</table>
+<p>
+The user can also specify the nested &lt;classpath&gt; element which defines classpath 
+in which the task is executed. The user also specifies a subelement per testlet executed
+which has content that specifies tasklet classname.</p>
+
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;test showSuccess=&quot;false&quot; showBanner=&quot;false&quot; showTrace=&quot;true&quot; forceShowTrace=&quot;true&quot;&gt;
+   &lt;classpath refid=&quot;test.classpath&quot;/&gt;
+   &lt;testlet&gt;org.foo.MyTestlet&lt;testlet/&gt;
+   &lt;testlet&gt;org.foo.MyOtherTestlet&lt;testlet/&gt;
+&lt;test/&gt;
+</pre>
+</blockquote>
+The above will run the testlets org.foo.MyTestlet and org.foo.MyOtherTestlet
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vssget.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vssget.html
new file mode 100644
index 0000000..b639c2e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vssget.html
@@ -0,0 +1,91 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="vssget">VssGet</a></h2>
+<h3>Description</h3>
+Task to perform GET commands to Microsoft Visual Source Safe.
+<p>If you specify two or more attributes from version, date and 
+label only one will be used in the order version, date, label.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <th>Attribute</th>
+    <th>Values</th>
+    <th>Required</th>
+  </tr>
+  <tr>
+     <td>login</td>
+     <td>username,password</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>vsspath</td>
+     <td>SourceSafe path</td>
+     <td>Yes</td>
+  </tr>
+  <tr>
+     <td>localpath</td>
+     <td>Override the working directory and get to the specified path</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>writable</td>
+     <td>true or false</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>recursive</td>
+     <td>true or false</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>version</td>
+     <td>a version number to get</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>date</td>
+     <td>a date stamp to get at</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>label</td>
+     <td>a label to get for</td>
+     <td>No</td>
+  </tr>
+  <tr>
+     <td>ssdir</td>
+     <td>directory where <code>ss.exe</code> resides. By default the
+     task expects it to be in the PATH.</td>
+     <td>No</td>
+  </tr>
+</table>
+<p>Note that only one of version, date or label should be specified</p>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;vssget localPath=&quot;C:\mysrc\myproject&quot;
+        recursive=&quot;true&quot; 
+        label=&quot;Release1&quot;
+        login=&quot;me,mypassword&quot;
+        vsspath=&quot;/source/aProject&quot;
+        writable=&quot;true&quot;/&gt;
+</pre>
+</blockquote>
+<p>Does a get on the VSS-Project <i>$/source/aproject</i> using the username
+<i>me</i> and the password <i>mypassword</i>. It will recursively get the files 
+which are labeled <i>Release1</i> and write them to the local directory
+<i>C:\mysrc\myproject</i>. The local files will be writable.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vsslabel.html b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vsslabel.html
new file mode 100644
index 0000000..f489e4e
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/OptionalTasks/vsslabel.html
@@ -0,0 +1,78 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+
+<html>
+<head>
+	<title>Documentation for Ant 1.3 optional task VSSLABEL</title>
+</head>
+
+<body>
+<h2><a name="vsslabel">VssLabel</a></h2>
+<h3>Description</h3>
+Task to perform LABEL commands to Microsoft Visual Source Safe.
+<p>Assigns a label to the specified version or current version of a file or
+project.</p>
+<h3>Parameters</h3>
+<table border="1" cellpadding="2" cellspacing="0">
+   <tr>
+     <th>Attribute</th>
+     <th>Values</th>
+     <th>Required</th>
+   </tr>
+   <tr>
+      <td>login</td>
+      <td>username,password</td>
+      <td>No</td>
+   </tr>
+   <tr>
+      <td>vsspath</td>
+      <td>SourceSafe path</td>
+      <td>Yes</td>
+   </tr>
+   <tr>
+      <td>ssdir</td>
+      <td>directory where <code>ss.exe</code> resides. By default the task
+      expects it to be in the PATH.</td>
+      <td>No</td>
+   </tr>
+   <tr>
+      <td>label</td>
+      <td>A label to apply to the hierarchy</td>
+      <td>Yes</td>
+   </tr>
+   <tr>
+      <td>version</td>
+      <td>An existing file or project version to label. By default the current
+      version is labelled.</td>
+      <td>No</td>
+   </tr>
+</table>
+<h3>Examples</h3>
+<blockquote>
+<pre>
+&lt;vsslabel vsspath=&quot;/source/aProject&quot;
+          login=&quot;me,mypassword&quot;
+          label=&quot;Release1&quot;/&gt;
+</pre>
+</blockquote>
+<p>Labels the current version of the VSS project <i>$/source/aproject</i> with
+the label <i>Release1</i> using the username <i>me</i> and the password 
+<i>mypassword</i>.
+</p>
+<blockquote>
+<pre>
+&lt;vsslabel vsspath=&quot;/source/aProject/myfile.txt&quot;
+          version=&quot;4&quot;
+          label=&quot;1.03.004&quot;/&gt;
+</pre>
+</blockquote>
+<p>Labels version 4 of the VSS file <i>$/source/aproject/myfile.txt</i> with the
+label <i>1.03.004</i>. If this version already has a label, the operation (and
+the build) will fail.
+</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/coretasklist.html b/jakarta-ant-1.2-src/docs/manual/coretasklist.html
new file mode 100644
index 0000000..c458f79
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/coretasklist.html
@@ -0,0 +1,70 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+<base target="mainFrame">
+</head>
+
+<body>
+
+<h2><a href="toc.html" target="navFrame">Table of Contents</a></h2>
+
+<h3>Concepts and Types</h3>
+<a href="dirtasks.html">Directory Based Tasks</a><br>
+<a href="CoreTypes/patternset.html">Patternset</a><br>
+<a href="CoreTypes/fileset.html">Fileset</a><br>
+<a href="CoreTypes/mapper.html">File Mappers</a><br>
+
+<h3>Core Tasks</h3>
+<a href="CoreTasks/ant.html">Ant</a><br>
+<a href="CoreTasks/antcall.html">AntCall</a><br>
+<a href="CoreTasks/antstructure.html">AntStructure</a><br>
+<a href="CoreTasks/apply.html">Apply</a><br>
+<a href="CoreTasks/available.html">Available</a><br>
+<a href="CoreTasks/chmod.html">Chmod</a><br>
+<a href="CoreTasks/copy.html">Copy</a><br>
+<a href="CoreTasks/copydir.html"><i>Copydir</i></a><br>
+<a href="CoreTasks/copyfile.html"><i>Copyfile</i></a><br>
+<a href="CoreTasks/cvs.html">Cvs</a><br>
+<a href="CoreTasks/delete.html">Delete</a><br>
+<a href="CoreTasks/deltree.html">Deltree</a><br>
+<a href="CoreTasks/echo.html">Echo</a><br>
+<a href="CoreTasks/exec.html">Exec</a><br>
+<a href="CoreTasks/execon.html">ExecOn</a><br>
+<a href="CoreTasks/fail.html">Fail</a><br>
+<a href="CoreTasks/filter.html">Filter</a><br>
+<a href="CoreTasks/fixcrlf.html">FixCRLF</a><br>
+<a href="CoreTasks/genkey.html">GenKey</a><br>
+<a href="CoreTasks/get.html">Get</a><br>
+<a href="CoreTasks/gunzip.html">GUnzip</a><br>
+<a href="CoreTasks/gzip.html">GZip</a><br>
+<a href="CoreTasks/jar.html">Jar</a><br>
+<a href="CoreTasks/java.html">Java</a><br>
+<a href="CoreTasks/javac.html">Javac</a><br>
+<a href="CoreTasks/javadoc.html">Javadoc/Javadoc2</a><br>
+<a href="CoreTasks/mail.html">Mail</a><br>
+<a href="CoreTasks/mkdir.html">Mkdir</a><br>
+<a href="CoreTasks/move.html">Move</a><br>
+<a href="CoreTasks/patch.html">Patch</a><br>
+<a href="CoreTasks/property.html">Property</a><br>
+<a href="CoreTasks/rename.html"><i>Rename</i></a><br>
+<a href="CoreTasks/replace.html">Replace</a><br>
+<a href="CoreTasks/rmic.html">Rmic</a><br>
+<a href="CoreTasks/signjar.html">SignJar</a><br>
+<a href="CoreTasks/sql.html">Sql</a><br>
+<a href="CoreTasks/style.html">Style</a><br>
+<a href="CoreTasks/tar.html">Tar</a><br>
+<a href="CoreTasks/taskdef.html">Taskdef</a><br>
+<a href="CoreTasks/touch.html">Touch</a><br>
+<a href="CoreTasks/tstamp.html">Tstamp</a><br>
+<a href="CoreTasks/unzip.html">Unjar</a><br>
+<a href="CoreTasks/untar.html">Untar</a><br>
+<a href="CoreTasks/unzip.html">Unwar</a><br>
+<a href="CoreTasks/unzip.html">Unzip</a><br>
+<a href="CoreTasks/uptodate.html">Uptodate</a><br>
+<a href="CoreTasks/war.html">War</a><br>
+<a href="CoreTasks/zip.html">Zip</a><br>
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/credits.html b/jakarta-ant-1.2-src/docs/manual/credits.html
new file mode 100644
index 0000000..e51c12b
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/credits.html
@@ -0,0 +1,46 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<div align="center">
+<h1>Ant User Manual</h1>
+<p>by</p>
+</div>
+<!-- Names are in alphabetical order, on last name -->
+<ul>
+  <li>Stephane Bailliez (<a href="mailto:sbailliez@imediation.com">sbailliez@imediation.com</a>)</li>
+  <li>Jacques Bergeron (<a href="mailto:jacques.bergeron@dogico.com">jacques.bergeron@dogico.com</a>)</li>
+  <li>Stefan Bodewig (<a href="mailto:stefan.bodewig@epost.de">stefan.bodewig@epost.de</a>)</li>
+  <li>Patrick Chanezon (<a href="mailto:chanezon@netscape.com">chanezon@netscape.com</a>)</li>
+  <li>James Duncan Davison (<a href="mailto:duncan@x180.com">duncan@x180.com</a>)</li>
+  <li>Tom Dimock (<a href="mailto:tad1@cornell.edu">tad1@cornell.edu</a>)</li>
+  <li>Diane Holt (<a href="mailto:holtdl@yahoo.com">holtdl@yahoo.com</a>)</li>
+  <li>Bill Kelly (<a href="mailto:bill.kelly@softwired-inc.com">bill.kelly@softwired-inc.com</a>)</li>
+  <li>Arnout J. Kuiper (<a href="mailto:ajkuiper@wxs.nl">ajkuiper@wxs.nl</a>)</li>
+  <li>Conor MacNeill (<a href="mailto:conor@cortexebusiness.com.au">conor@cortexebusiness.com.au</a>)</li>
+  <li>Stefano Mazzocchi (<a href="mailto:stefano@apache.org">stefano@apache.org</a>)</li>
+  <li>Erik Meade (<a href="mailto:emeade@geekfarm.org">emeade@geekfarm.org</a>)</li>
+  <li>Sam Ruby (<a href="mailto:rubys@us.ibm.com">rubys@us.ibm.com</a>)</li>
+  <li>Nico Seessle (<a href="mailto:nico@seessle.de">nico@seessle.de</a>)</li>
+  <li>Jon S. Stevens (<a href="mailto:jon@latchkey.com">jon@latchkey.com</a>)</li>
+  <li>Roger Vaughn (<a href="mailto:rvaughn@seaconinc.com">rvaughn@seaconinc.com</a>)</li>
+  <li>Dave Walend (<a href="mailto:dwalend@cs.tufts.edu">dwalend@cs.tufts.edu</a>)</li>
+  <li>Phillip Wells (<a href="mailto:philwells@rocketmail.com">philwells@rocketmail.com</a>)</li>
+</ul>
+
+<center>
+<p>Version: @VERSION@<br>
+$Id: credits.html,v 1.1.2.2 2001/02/15 11:26:13 conor Exp $</p>
+</center>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/develop.html b/jakarta-ant-1.2-src/docs/manual/develop.html
new file mode 100644
index 0000000..d767fa1
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/develop.html
@@ -0,0 +1,204 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+<h1>Developing with Ant</h1>
+
+<h2><a name="writingowntask">Writing Your Own Task</a></h2>
+<p>It is very easy to write your own task:</p>
+<ol>
+  <li>Create a Java class that extends <code>org.apache.tools.ant.Task</code>.</li>
+  <li>For each attribute, write a <i>setter</i> method. The setter method must be a 
+    <code>public void</code> method that takes a single argument. The
+    name of the method must begin with <code>set</code>, followed by the
+    attribute name, with the first character of the name in uppercase, and the rest in
+    lowercase. The type of the attribute can be:
+<ul>
+<li>
+<code>String</code>
+</li>
+<li>
+any primitive type (they are converted for you from their String-representation
+in the buildfile)
+</li>
+<li>
+boolean &#150; your method will be passed the value 
+<i>true</i> if the value specified in the buildfile is one of <code>true</code>,
+<code>yes</code>, or <code>on</code>)
+</li>
+<li>
+<code>Class</code>
+</li>
+<li>
+<code>File</code>
+(in which case the value of the attribute is interpreted relative to the 
+project's basedir)
+</li>
+<li>
+any other type that has a constructor with a single 
+<code>String</code> argument
+</li>
+</ul>
+</li>
+<li>If your task has enumerated attributes, you should consider using
+a subclass of <code>org.apache.tools.ant.types.EnumeratedAttribute</code>
+as an argument
+to your setter method. See
+<code>org/apache/tools/ant/taskdefs/FixCRLF.java</code> for
+an example.</li>
+<li>If the task should support character data, write a <code>public void 
+addText(String)</code> method.</li>
+<li>For each nested element, write a <i>create</i> or <i>add</i> method.
+A create method 
+must be a <code>public</code> method that takes no arguments and returns 
+an <code>Object</code> type. The name of the create method must begin with 
+<code>create</code>, followed by the element name. An add method must be 
+a <code>public void</code> method that takes a single argument of an 
+<code>Object</code> type with a no-argument constructor.
+The name of the add method 
+must begin with <code>add</code>, followed by the element name.</li>
+<li>Write a <code>public void execute</code> method, with no arguments, that
+throws a <code>BuildException</code>. This method implements the task
+itself.</li>
+</ol>
+
+<h3>The Life-cycle of a Task</h3>
+<ol>
+  <li>The task gets instantiated using a no-argument constructor, at parser
+    time. This means even tasks that are never executed get
+    instantiated.</li>
+
+  <li>The task gets references to its project and location inside the
+    buildfile via its inherited <code>project</code> and
+    <code>location</code> variables.</li>
+
+  <li>If the user specified an <code>id</code> attribute to this task,
+    the project
+    registers a reference to this newly created task, at parser
+    time.</li>
+
+  <li>The task gets a reference to the target it belongs to via its
+    inherited <code>target</code> variable.</li>
+
+  <li><code>init()</code> is called at parser time.</li>
+
+  <li>All child elements of the XML element corresponding to this task
+    are created via this task's <code>createXXX()</code> methods or
+    instantiated and added to this task via its <code>addXXX()</code>
+    methods, at parser time.</li>
+
+  <li>All attributes of this task get set via their corresponding
+    <code>setXXX</code> methods, at runtime.</li>
+
+  <li>The content character data sections inside the XML element
+    corresponding to this task is added to the task via its
+    <code>addText</code> method, at runtime.</li>
+
+  <li>All attributes of all child elements get set via their corresponding
+    <code>setXXX</code> methods, at runtime.</li>
+
+  <li><code>execute()</code> is called at runtime. While the above initialization 
+    steps only occur once, the execute() method may be 
+    called more than once, if the task is invoked more than once. For example, 
+    if <code>target1</code> and <code>target2</code> both depend
+    on <code>target3</code>, then running 
+    <code>'ant target1 target2'</code> will run all tasks in
+    <code>target3</code> twice.</li>
+</ol>
+
+<h3>Example</h3>
+<p>Let's write our own task, which prints a message on the
+<code>System.out</code> stream.
+The
+task has one attribute, called <code>message</code>.</p>
+<blockquote>
+<pre>
+package com.mydomain;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Task;
+
+public class MyVeryOwnTask extends Task {
+  private String msg;
+
+  // The method executing the task
+  public void execute() throws BuildException {
+    System.out.println(msg);
+  }
+
+  // The setter for the &quot;message&quot; attribute
+  public void setMessage(String msg) {
+    this.msg = msg;
+  }
+}
+</pre>
+</blockquote>
+<p>It's really this simple ;-)</p>
+<p>Adding your task to the system is rather simple too:</p>
+<ol>
+  <li>Make sure the class that implements your task is in the classpath when
+    starting Ant.</li>
+  <li>Add a <code>&lt;taskdef&gt;</code> element to your project.
+    This actually adds your task to the system.</li>
+  <li>Use your task in the rest of the buildfile.</li>
+</ol>
+
+<h3>Example</h3>
+<blockquote>
+<pre>
+&lt;?xml version=&quot;1.0&quot;?&gt;
+
+&lt;project name=&quot;OwnTaskExample&quot; default=&quot;main&quot; basedir=&quot;.&quot;&gt;
+  &lt;taskdef name=&quot;mytask&quot; classname=&quot;com.mydomain.MyVeryOwnTask&quot;/&gt;
+
+  &lt;target name=&quot;main&quot;&gt;
+    &lt;mytask message=&quot;Hello World! MyVeryOwnTask works!&quot;/&gt;
+  &lt;/target&gt;
+&lt;/project&gt;
+</pre>
+</blockquote>
+<p>Another way to add a task (more permanently), is to add the task name and
+implementing class name to the <code>default.properties</code> file in the
+<code>org.apache.tools.ant.taskdefs</code>
+package. Then you can use it as if it were a built-in task.</p>
+
+<hr>
+<h2><a name="buildevents">Build Events</a></h2>
+<P>Ant is capable of generating build events as it performs the tasks necessary to build a project. 
+Listeners can be attached to Ant to receive these events. This capability could be used, for example,
+to connect Ant to a GUI or to integrate Ant with an IDE. 
+</P>
+<p>To use build events you need to create an ant <code>Project</code> object. You can then call the 
+<code>addBuildListener</code> method to add your listener to the project. Your listener must implement
+the <code>org.apache.tools.antBuildListener</code> interface. The listener will receive BuildEvents 
+for the following events</P>
+<ul>
+<li>Build started</li>
+<li>Build finished</li>
+<li>Target started</li>
+<li>Target finished</li>
+<li>Task started</li>
+<li>Task finished</li>
+<li>Message logged</li>
+</ul>
+
+<p>
+If you wish to attach a listener from the command line you may use the
+<code>-listener</code> option. For example:</p>
+<blockquote>
+  <pre>ant -listener org.apache.tools.ant.XmlLogger</pre>
+</blockquote>
+<p>will run Ant with a listener that generates an XML representation of the build progress. This 
+listener is included with Ant, as is the default listener, which generates the logging to standard output.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/dirtasks.html b/jakarta-ant-1.2-src/docs/manual/dirtasks.html
new file mode 100644
index 0000000..83cc0ce
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/dirtasks.html
@@ -0,0 +1,168 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h2><a name="directorybasedtasks">Directory-based Tasks</a></h2>
+<p>Some tasks use directory trees for the task they perform.
+For example, the <a
+href="CoreTasks/javac.html">javac</a> task, which works upon a directory tree
+with <code>.java</code> files.
+Sometimes it can be very useful to work on a subset of that directory tree. This
+section describes how you can select a subset of such a directory tree.</p>
+<p>Ant gives you two ways to create a subset, both of which can be used at the same
+time:</p>
+<ul>
+  <li>Only include files/directories that match at least one pattern of a set of
+    patterns.</li>
+  <li>Exclude files/directories that match at least one pattern a set of
+    patterns.</li>
+</ul>
+<p>When both inclusion and exclusion are used, only files/directories that match
+the include patterns, and don't match the exclude patterns, are used.</p>
+<p>Patterns can be specified inside the buildfile via task attributes or
+nested elements and via external files. Each line of the external file
+is taken as a pattern that is added to the list of include or exclude 
+patterns.</p>
+<h3>Patterns</h3>
+<p>As described earlier, patterns are used for the inclusion and exclusion.
+These patterns look very much like the patterns used in DOS and UNIX:</p>
+<p>'*' matches zero or more characters, '?' matches one character.</p>
+<p><b>Examples:</b></p>
+<p>
+<code>*.java</code>&nbsp;&nbsp;matches&nbsp;&nbsp;<code>.java</code>,
+<code>x.java</code> and <code>FooBar.java</code>, but
+not <code>FooBar.xml</code> (does not end with <code>.java</code>).</p>
+<p>
+<code>?.java</code>&nbsp;&nbsp;matches&nbsp;&nbsp;<code>x.java</code>,
+<code>A.java</code>, but not <code>.java</code> or <code>xyz.java</code>
+(both don't have one character before <code>.java</code>).</p>
+<p>
+Combinations of <code>*</code>'s and <code>?</code>'s are allowed.</p>
+<p>Matching is done per-directory. This means that first the first directory in
+the pattern is matched against the first directory in the path to match. Then
+the second directory is matched, and so on. For example, when we have the pattern <code>/?abc/*/*.java</code>
+and the path <code>/xabc/foobar/test.java</code>,
+the first <code>?abc</code> is matched with <code>xabc</code>,
+then <code>*</code> is matched with <code>foobar</code>,
+and finally <code>*.java</code> is matched with <code>test.java</code>.
+They all match, so the path matches the pattern.</p>
+<p>To make things a bit more flexible, we add one extra feature, which makes it
+possible to match multiple directory levels. This can be used to match a
+complete directory tree, or a file anywhere in the directory tree.
+To do this, <code>**</code>
+must be used as the name of a directory.
+When <code>**</code> is used as the name of a
+directory in the pattern, it matches zero or more directories.
+For example:
+<code>/test/**</code> matches all files/directories under <code>/test/</code>,
+such as <code>/test/x.java</code>,
+or <code>/test/foo/bar/xyz.html</code>, but not <code>/xyz.xml</code>.</p>
+<p>There is one &quot;shorthand&quot; &#150; if a pattern ends
+with <code>/</code>
+or <code>\</code>, then <code>**</code>
+is appended.
+For example, <code>mypackage/test/</code> is interpreted as if it were
+<code>mypackage/test/**</code>.</p>
+<p><b>Example patterns:</b></p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><code>**/CVS/*</code></td>
+    <td valign="top">Matches all files in <code>CVS</code> directories that can be located
+      anywhere in the directory tree.<br>
+      Matches:
+      <pre>
+      CVS/Repository
+      org/apache/CVS/Entries
+      org/apache/jakarta/tools/ant/CVS/Entries
+      </pre>
+      But not:
+      <pre>
+      org/apache/CVS/foo/bar/Entries (<code>foo/bar/</code> part does not match)</td>
+      </pre>
+  </tr>
+  <tr>
+    <td valign="top"><code>org/apache/jakarta/**</code></td>
+    <td valign="top">Matches all files in the <code>org/apache/jakarta</code> directory tree.<br>
+      Matches:
+      <pre>
+      org/apache/jakarta/tools/ant/docs/index.html
+      org/apache/jakarta/test.xml
+      </pre>
+      But not:
+      <pre>
+      org/apache/xyz.java
+      </pre>
+      (<code>jakarta/</code> part is missing).</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>org/apache/**/CVS/*</code></td>
+    <td valign="top">Matches all files in <code>CVS</code> directories
+      that are located anywhere in the directory tree under
+      <code>org/apache</code>.<br>
+      Matches:
+      <pre>
+      org/apache/CVS/Entries
+      org/apache/jakarta/tools/ant/CVS/Entries
+      </pre>
+      But not:
+      <pre>
+      org/apache/CVS/foo/bar/Entries
+      </pre>
+      (<code>foo/bar/</code> part does not match)</td>
+  </tr>
+  <tr>
+    <td valign="top"><code>**/test/**</code></td>
+    <td valign="top">Matches all files that have a <code>test</code>
+        element in their path, including <code>test</code> as a filename.</td>
+  </tr>
+</table>
+<p>When these patterns are used in inclusion and exclusion, you have a powerful
+way to select just the files you want.</p>
+
+<h3>Examples</h3>
+<pre>  
+&lt;copy todir=&quot;${dist}&quot;>
+  &lt;fileset dir=&quot;${src}&quot; 
+           includes=&quot;**/images/*&quot; 
+           excludes=&quot;**/*.gif&quot; 
+  /&gt;
+&lt;/copy&gt;</pre>
+<p>This copies all files in directories called <code>images</code> that are
+located in the directory tree defined by <code>${src}</code> to the
+destination directory defined by <code>${dist}</code>,
+but excludes all <code>*.gif</code> files from the copy.</p>
+<p> This example can also be expressed using nested elements:</p>
+<pre>
+&lt;copy todir=&quot;${dist}&quot;>
+  &lt;fileset dir=&quot;${src}&quot;/&gt;
+    &lt;include name=&quot;**/images/*&quot;/&gt;
+    &lt;exclude name=&quot;**/*.gif&quot;/&gt;
+  &lt;/fileset&gt;
+&lt;/copy&gt;
+</pre>
+
+<h3>Default Excludes</h3>
+<p>There are a set of definitions that are excluded by default from all directory-based tasks.
+They are:</p>
+<pre>
+     **/*~
+     **/#*#
+     **/%*%
+     **/CVS
+     **/CVS/**
+     **/.cvsignore
+</pre>
+<p>If you do not want these default excludes applied, you may disable them with the 
+<code>defaultexcludes=&quot;no&quot;</code> attribute.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/feedback.html b/jakarta-ant-1.2-src/docs/manual/feedback.html
new file mode 100644
index 0000000..fe2f251
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/feedback.html
@@ -0,0 +1,31 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h1><a name="feedback">Feedback</a></h1>
+<p>To provide feedback on this software, please subscribe to the 
+<a href="http://jakarta.apache.org/site/mail.html" target="_top">Ant User Mailing List</a>
+</p>
+
+<p>If you want to contribute to Ant or stay current with the latest
+development, join the 
+<a href="http://jakarta.apache.org/site/mail.html" target="_top">Ant Development Mailing List</a>
+</p>
+<p>Archives of both lists can be found at <a
+href="http://archive.covalent.net/" target="_top">http://archive.covalent.net/</a>. Many
+thanks to Covalent Technologies. A searchable archive can be found at <a
+href="http://marc.theaimsgroup.com" target="_top">http://marc.theaimsgroup.com</a>. If
+you know of any additional archive sites, please report them to the
+lists.</p>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/ide.html b/jakarta-ant-1.2-src/docs/manual/ide.html
new file mode 100644
index 0000000..0411b16
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/ide.html
@@ -0,0 +1,23 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+<base target="mainFrame">
+</head>
+
+<body>
+
+<h2><a href="toc.html" target="navFrame">Table of Contents</a></h2>
+
+<h3>IDE Integration</h3>
+<a href="Integration/Antidote.html">
+         Antidote<br>(in development)</a><br><br>
+<a href="http://www.dieter-bogdoll.de/java/AntRunner/">
+         AntRunner For JBuilder <br>(unbundled)</a><br><br>
+<a href="http://ant.netbeans.org/">NetBeans <br>Forte for Java <br>(unbundled)</a><br><br>
+<a href="Integration/VAJAntTool.html">VisualAge for Java</a><br><br>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/index.html b/jakarta-ant-1.2-src/docs/manual/index.html
new file mode 100644
index 0000000..3b17dba
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/index.html
@@ -0,0 +1,17 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<frameset cols="20%,80%">
+<frame src="toc.html" name="navFrame">
+<frame src="credits.html" name="mainFrame">
+</frameset>
+<noframes>
+<H2>Ant User Manual</H2>
+
+<a href="toc.html">Ant User Manual</a></noframes>
+
+</html>
diff --git a/jakarta-ant-1.2-src/docs/manual/install.html b/jakarta-ant-1.2-src/docs/manual/install.html
new file mode 100644
index 0000000..1ba7de0
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/install.html
@@ -0,0 +1,378 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+
+<h1>Installing Ant</h1>
+<h2><a name="getting">Getting Ant</a></h2>
+<h3>Binary edition</h3>
+<p>The latest stable version of Ant can be downloaded from <a
+href="http://jakarta.apache.org/builds/ant/release/v1.3/bin/">
+http://jakarta.apache.org/builds/ant/release/v1.3/bin/</a>.
+
+If you like living on the edge, you can download the latest version from <a
+href="http://jakarta.apache.org/builds/ant/nightly/">http://jakarta.apache.org/builds/ant/nightly/</a>.</p>
+<h3>Source Edition</h3>
+
+<p>If you prefer the source edition, you can download the source for the latest Ant release from <a
+href="http://jakarta.apache.org/builds/ant/release/v1.3/src/">
+http://jakarta.apache.org/builds/ant/release/v1.3/src/</a>. 
+
+Again, if you prefer the edge, you can access 
+the code as it is being developed via CVS. The Jakarta website has details on 
+<a href="http://jakarta.apache.org/site/cvsindex.html" target="_top">accessing CVS</a>. Please checkout the 
+jakarta-ant module. 
+
+See the section <a href="#buildingant">Building Ant</a> on how to
+build Ant from the source code.
+You can also access the 
+<a href="http://jakarta.apache.org/cvsweb/index.cgi/jakarta-ant/" target="_top">
+Ant CVS repository</a> on-line. </p>
+
+<hr>
+<h2><a name="sysrequirements">System Requirements</a></h2>
+<p>
+To build and use Ant, you must have a JAXP-compliant XML parser installed and 
+available on your classpath.</p>
+<p>
+Both the binary and source distributions of Ant include the reference 
+implementation of JAXP 1.0. Please see 
+<a href="http://java.sun.com/xml/" target="_top">http://java.sun.com/xml/</a> 
+for more information. 
+If you wish to use a different JAXP-compliant parser, you should remove
+<code>jaxp.jar</code> and <code>parser.jar</code>
+from Ant's <code>lib</code> directory.
+
+You can then either put the jars from your preferred parser into Ant's 
+<code>lib</code> directory or put the jars on the system classpath.</p>
+
+<p>
+For the current version of Ant, you will also need a JDK installed on
+your system, version 1.1 or later. A future version of Ant will require
+JDK 1.2 or later.
+</p>
+  
+<hr>
+<h2><a name="installing">Installing Ant</a></h2>
+<p>The binary distribution of Ant consists of three directories:
+<code>bin</code>,
+<code>docs</code> and
+<code>lib</code>
+
+Only the <code>bin</code> and <code>lib</code> directories are 
+required to run Ant. 
+
+To install Ant, choose a directory and copy the distribution
+file there. This directory will be known as ANT_HOME. 
+
+Before you can run ant there is some additional set up you 
+will need to do:</p>
+<ul>
+<li>Add the <code>bin</code> directory to your path.</li>
+<li>Set the <code>ANT_HOME</code> environment variable to
+the directory where you installed Ant.</li>
+<li>Optionally, set the <code>JAVA_HOME</code> environment variable
+(see the <a href="#advanced">Advanced</a> section below).
+This should be set to the directory where your JDK is installed.</li>
+<li>If you are using Ant's optional tasks then you may need to add additional
+jars to your <code>lib</code> directory or to your CLASSPATH.
+See <a href="#librarydependencies">Library Dependencies</a>
+for for a list of jar requirements for various optional tasks.
+</li>
+
+</ul>
+<p><strong>Note:</strong> Do not install Ant's ant.jar file into the lib/ext
+directory of the JDK/JRE. Ant is an application, whilst the extension 
+directory is intended for JDK extensions. In particular there are security 
+restrictions on the classes which may be loaded by an extension.</p>
+
+<h3>Windows</h3>
+<p>Assume Ant is installed in <code>c:\ant\</code>. The following sets up the
+environment:</p>
+<pre>set ANT_HOME=c:\ant
+set JAVA_HOME=c:\jdk1.2.2
+set PATH=%PATH%;%ANT_HOME%\bin</pre>
+
+<h3>Unix (bash)</h3>
+<p>Assume Ant is installed in <code>/usr/local/ant</code>. The following sets up
+the environment:</p>
+<pre>export ANT_HOME=/usr/local/ant
+export JAVA_HOME=/usr/local/jdk-1.2.2
+export PATH=${PATH}:${ANT_HOME}/bin</pre>
+
+
+<h3><a name="advanced">Advanced</a></h3>
+
+<p>There are lots of variants that can be used to run Ant. What you need is at
+least the following:</p>
+<ul>
+<li>The classpath for Ant must contain <code>ant.jar</code> and any jars/classes 
+needed for your chosen JAXP-compliant XML parser.</li>
+<li>When you need JDK functionality
+(such as for the <a href="CoreTasks/javac.html">javac</a> task or the
+<a href="CoreTasks/rmic.html">rmic</a> task), then for JDK 1.1, the <code>classes.zip</code>
+file of the JDK must be added to the classpath; for JDK 1.2 or JDK 1.3, <code>tools.jar</code>
+must be added. The scripts supplied with Ant,
+in the <code>bin</code> directory, will add 
+the required JDK classes automatically, if the <code>JAVA_HOME</code>
+environment variable is set.</li>
+
+<li>When you are executing platform-specific applications, such as the 
+<a href="CoreTasks/exec.html">exec</a> task or the 
+<a href="CoreTasks/cvs.html">cvs</a> task, the property <code>ant.home</code>
+must be set to the directory containing where you installed Ant. Again
+this is set by the Ant scripts to the value of the ANT_HOME environment
+variable.</li>
+</ul>
+
+<hr>  
+<h2><a name="buildingant">Building Ant</a></h2>
+<p>To build Ant from source, you can either install the Ant source distribution
+or checkout the jakarta-ant module from CVS.</p>
+<p>Once you have installed the source, change into the installation
+directory.</p>
+
+<p>Set the <code>JAVA_HOME</code> environment variable
+to the directory where the JDK is installed.
+See <a href="#installing">Installing Ant</a>
+for examples on how to do this for your operating system. </p>
+
+<p>Make sure you have downloaded any auxiliary jars required to
+build tasks you are interested in. These should either be available
+on the CLASSPATH or added to the <code>lib/optional</code>
+directory.
+See <a href="#librarydependencies">Library Dependencies</a>
+for for a list of jar requirements for various features.
+Note that this will make the auxiliary jars
+available for the building of Ant only. For running Ant you will
+still need to
+make the jars available as described under 
+<a href="#installing">Installing Ant</a>.</p>
+
+<p>Your are now ready to build Ant:</p>
+<blockquote>
+  <p><code>build -Ddist.dir=&lt;<i>directory_to_contain_Ant_distribution</i>&gt; dist</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Windows</i>)</p>
+  <p><code>build.sh -Ddist.dir=&lt;<i>directory_to_contain_Ant_distribution</i>&gt; dist</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Unix</i>)</p>
+</blockquote>
+
+<p>This will create a binary distribution of Ant in the directory you specified.</p>
+
+<p>The above action does the following:</p>
+<ul>
+
+<li>If necessary it will bootstrap the Ant code. Bootstrapping involves the manual 
+compilation of enough Ant code to be able to run Ant. The bootstrapped Ant is
+used for the remainder of the build steps. </li>
+
+<li>Invokes the bootstrapped Ant with the parameters passed to the build script. In 
+this case, these parameters define an Ant property value and specify the &quot;dist&quot; target
+in Ant's own <code>build.xml</code> file.
+</ul>
+
+<p>On most occasions you will not need to explicitly bootstrap Ant since the build
+scripts do that for you. If however, the build file you are using makes use of features
+not yet compiled into the bootstrapped Ant, you will need to manually bootstrap.
+Run <code>bootstrap.bat</code> (Windows) or <code>bootstrap.sh</code> (UNIX)
+to build a new bootstrap version of Ant.</p>
+
+If you wish to install the build into the current <code>ANT_HOME</code>
+directory, you can use:
+<blockquote>
+  <p><code>build install</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Windows</i>)</p>
+  <p><code>build.sh install</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Unix</i>)</p>
+</blockquote>
+
+You can avoid the lengthy Javadoc step, if desired, with:
+<blockquote>
+  <p><code>build install-lite</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Windows</i>)</p>
+  <p><code>build.sh install-lite</code>&nbsp;&nbsp;&nbsp;&nbsp;(<i>Unix</i>)</p>
+</blockquote>
+This will only install the <code>bin</code> and <code>lib</code> directories. 
+<p>Both the <code>install</code> and 
+<code>install-lite</code> targets will overwrite 
+the current Ant version in <code>ANT_HOME</code>.</p>
+
+<hr>
+<h2><a name="running">Running Ant</a></h2>
+<p>Running Ant is simple, when you installed it as described in the previous
+section. Just type <code>ant</code>.</p>
+<p>When nothing is specified, Ant looks for a <code>build.xml</code>
+file in the current directory. If found, it uses that file as the
+buildfile. If you use the <code>-find</code> option,
+Ant will search for a buildfile in 
+the parent directory, and so on, until the root of the filesystem 
+has been reached. To make Ant use
+another buildfile, use the command-line
+option <code>-buildfile <i>file</i></code>,
+where <i>file</i> is the buildfile you want to use.</p>
+
+<p>You can also set properties that override properties specified in the
+buildfile (see the <a href="CoreTasks/property.html">property</a> task). 
+This can be done with
+the <nobr><code>-D<i>property</i>=<i>value</i></code></nobr> option,
+where <i>property</i> is the name of the property,
+and <i>value</i> is the value for that property.
+This can also be used to pass in the value of some environment variables.
+You can also access environment variables using the <a href="CoreTasks/property.html">
+property</a> task.
+
+Just pass <nobr><code>-DMYVAR=%MYVAR%</code></nobr> (Windows) or
+<nobr><code>-DMYVAR=$MYVAR</code></nobr> (Unix)
+to Ant &#150; you can then access
+these variables inside your buildfile as <code>${MYVAR}</code>.</p>
+
+<p>Two more options are: <nobr><code>-quiet</code></nobr>,
+which instructs Ant to print less
+information on the console when running, and
+<nobr><code>-verbose</code></nobr>, which causes Ant to print
+additional information to the console.</p>
+
+<p>It is also possible to specify one or more targets that should be executed.
+When omitted, the target that is specified in the
+<code>default</code> attribute of the <code>&lt;project&gt;</code> tag is
+used.</p>
+
+<p>The <nobr><code>-projecthelp</code></nobr>
+option gives a list of this project's
+targets. First those with a description, then those without one.</p>
+
+<p>Command-line option summary:</p>
+<pre>ant [options] [target [target2 [target3] ...]]
+Options:
+-help                  print this message
+-projecthelp           print project help information
+-version               print the version information and exit
+-quiet                 be extra quiet
+-verbose               be extra verbose
+-debug                 print debugging information
+-emacs                 produce logging information without adornments
+-logfile <i>file</i>          use given file for log output
+-logger <i>classname</i>      the class that is to perform logging
+-listener <i>classname</i>    add an instance of class as a project listener
+-buildfile <i>file</i>        use specified buildfile
+-find <i>file</i>             search for buildfile towards the root of the filesystem and use the first one found
+-D<i>property</i>=<i>value</i>       set <i>property</i> to <i>value</i>
+</pre>
+<h3>Examples</h3>
+<blockquote>
+  <pre>ant</pre>
+</blockquote>
+<p>runs Ant using the <code>build.xml</code> file in the current directory, on
+the default target.</p>
+<blockquote>
+  <pre>ant -buildfile test.xml</pre>
+</blockquote>
+<p>runs Ant using the <code>test.xml</code> file in the current directory, on
+the default target.</p>
+<blockquote>
+  <pre>ant -buildfile test.xml dist</pre>
+</blockquote>
+<p>runs Ant using the <code>test.xml</code> file in the current directory, on a
+target called <code>dist</code>.</p>
+<blockquote>
+  <pre>ant -buildfile test.xml -Dbuild=build/classes dist</pre>
+</blockquote>
+<p>runs Ant using the <code>test.xml</code> file in the current directory, on a
+target called <code>dist</code>, setting the <code>build</code> property to the
+value <code>build/classes</code>.</p>
+
+<h3>Running Ant by Hand</h3>
+<p>If you have installed Ant in the do-it-yourself way, Ant can be started
+with:</p>
+<blockquote>
+  <pre>java -Dant.home=c:\ant org.apache.tools.ant.Main [options] [target]</pre>
+</blockquote>
+
+<p>These instructions actually do exactly the same as the <code>ant</code>
+command. The options and target are the same as when running Ant with the <code>ant</code>
+command. This example assumes you have set your classpath to include:</p>
+<ul>
+<li><code>ant.jar</code></li>
+<li>jars/classes for your XML parser</li>
+<li>the JDK's required jar/zip files</li>
+</ul>
+<hr>
+<h2><a name="librarydependencies">Library Dependencies</a></h2>
+<p>The following libraries are needed in your CLASSPATH or in the
+install directory's <code>lib</code> directory if you are using the
+indicated feature. Note that only one of the regexp libraries is
+needed for use with the mappers.</p>
+<p/>
+
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td><b>Jar Name</b></td>
+    <td><b>Needed For</b></td>
+    <td><b>Available At</b></td>
+  </tr>
+  <tr>
+    <td>jakarta-regexp-1.2.jar</td>
+    <td>regexp type with mappers</td>
+    <td><a href="http://jakarta.apache.org/regexp/" target="_top">jakarta.apache.org/regexp/</a></td>
+  </tr>
+  <tr>
+    <td>jakarta-oro-2.0.1.jar</td>
+    <td>regexp type with mappers and the perforce tasks</td>
+    <td><a href="http://jakarta.apache.org/oro/" target="_top">jakarta.apache.org/oro/</a></td>
+  </tr>
+  <tr>
+    <td>junit.jar</td>
+    <td>junit tasks</td>
+    <td><a href="http://www.junit.org/" target="_top">www.junit.org</a></td>
+  </tr>
+  <tr>
+    <td>stylebook.jar</td>
+    <td>stylebook task</td>
+    <td>CVS repository of <a href="http://xml.apache.org" target="_top">xml.apache.org</a></td>
+  </tr>
+  <tr>
+    <td>testlet.jar</td>
+    <td>test task</td>
+    <td><a href="http://java.apache.org/framework" target="_top">java.apache.org/framework</a></td>
+  </tr>
+  <tr>
+    <td>antlr.jar</td>
+    <td>antlr task</td>
+    <td><a href="http://www.antlr.org/" target="_top">www.antlr.org</a></td>
+  </tr>
+  <tr>
+    <td >bsf.jar</td>
+    <td>script task</td>
+    <td><a href="http://oss.software.ibm.com/developerworks/projects/bsf" target="_top">
+        oss.software.ibm.com/developerworks/projects/bsf</a></td>
+  </tr>
+  <tr>
+    <td>netrexx.jar</td>
+    <td>netrexx task</td>
+    <td><a href="http://www2.hursley.ibm.com/netrexx" target="_top">
+        www2.hursley.ibm.com/netrexx</a></td>
+  </tr>
+  <tr>
+    <td>rhino.jar</td>
+    <td>javascript with script task</td>
+    <td><a href="http://www.mozilla.org/" target="_top">www.mozilla.org</a></td>
+  </tr>
+  <tr>
+    <td>jpython.jar</td>
+    <td>python with script task</td>
+    <td><a href="http://www.jpython.org/" target="_top">www.jpython.org</a></td>
+  </tr>
+  <tr>
+    <td>netcomponents.jar</td>
+    <td>ftp and telnet tasks</td>
+    <td><a href="http://www.savarese.org/oro/downloads/index.html#NetComponents"
+           target="_top">www.savarese.org/oro/downloads</a></td>
+  </tr>
+</table>
+<br>
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/intro.html b/jakarta-ant-1.2-src/docs/manual/intro.html
new file mode 100644
index 0000000..859a8f2
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/intro.html
@@ -0,0 +1,54 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+<h1><a name="introduction">Introduction</a></h1>
+<p>Ant is a Java-based build tool. In theory, it is kind of like
+<i>make</i>, without <i>make</i>'s wrinkles.</p>
+<h3>Why?</h3>
+<p>Why another build tool when there is already
+<i>make</i>,
+<i>gnumake</i>,
+<i>nmake</i>,
+<i>jam</i>,
+and
+others? Because all those tools have limitations that Ant's original author
+couldn't live with when developing software across multiple platforms.
+Make-like
+tools are inherently shell-based: they evaluate a set of dependencies,
+then execute commands not unlike what you would issue on a shell.
+This means that you
+can easily extend these tools by using or writing any program for the OS that
+you are working on; however, this also means that you limit yourself to the OS,
+or at least the OS type, such as Unix, that you are working on.</p>
+<p>Makefiles are inherently evil as well. Anybody who has worked on them for any
+time has run into the dreaded tab problem. &quot;Is my command not executing
+because I have a space in front of my tab?!!&quot; said the original author of
+Ant way too many times. Tools like Jam took care of this to a great degree, but
+still have yet another format to use and remember.</p>
+<p>Ant is different. Instead of a model where it is extended with shell-based
+commands, Ant is extended using Java classes. Instead of writing shell commands,
+the configuration files are XML-based, calling out a target tree where various
+tasks get executed. Each task is run by an object that implements a particular
+Task interface.</p>
+<p>Granted, this removes some of the expressive power that is inherent in being
+able to construct a shell command such as
+<nobr><code>`find . -name foo -exec rm {}`</code></nobr>, but it
+gives you the ability to be cross-platform &#150; to work anywhere and
+everywhere. And
+hey, if you really need to execute a shell command, Ant has an
+&lt;exec&gt; task that
+allows different commands to be executed based on the OS it is executing
+on.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/optionaltasklist.html b/jakarta-ant-1.2-src/docs/manual/optionaltasklist.html
new file mode 100644
index 0000000..eb5c002
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/optionaltasklist.html
@@ -0,0 +1,44 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+<base target="mainFrame">
+</head>
+
+<body>
+
+<h2><a href="toc.html" target="navFrame">Table of Contents</a></h2>
+
+<h3>Optional Tasks</h3>
+<a href="OptionalTasks/dotnet.html">.NET Tasks</a><br>
+<a href="OptionalTasks/antlr.html">ANTLR</a><br>
+<a href="OptionalTasks/cab.html">Cab</a><br>
+<a href="OptionalTasks/clearcase.html">Clearcase Tasks</a><br>
+<a href="OptionalTasks/depend.html">Depend</a><br>
+<a href="OptionalTasks/ejb.html">EJB Tasks</a><br>
+<a href="OptionalTasks/ftp.html">FTP</a><br>
+<a href="OptionalTasks/javacc.html">JavaCC</a><br>
+<a href="OptionalTasks/javah.html">Javah</a><br>
+<a href="OptionalTasks/jjtree.html">JJTree</a><br>
+<a href="OptionalTasks/jlink.html">Jlink</a><br>
+<a href="OptionalTasks/junit.html">JUnit</a><br>
+<a href="OptionalTasks/junitreport.html">JUnitReport</a><br>
+<a href="OptionalTasks/mparse.html">MParse</a><br>
+<a href="OptionalTasks/native2ascii.html">Native2Ascii</a><br>
+<a href="OptionalTasks/netrexxc.html">NetRexxC</a><br>
+<a href="OptionalTasks/perforce.html">Perforce Tasks</a><br>
+<a href="OptionalTasks/propertyfile.html">PropertyFile</a><br>
+<a href="OptionalTasks/renameextensions.html"><i>RenameExtensions</i></a><br>
+<a href="OptionalTasks/script.html">Script</a><br>
+<a href="OptionalTasks/sound.html">Sound</a><br>
+<a href="OptionalTasks/stylebook.html">Stylebook</a><br>
+<a href="OptionalTasks/telnet.html">Telnet</a><br>
+<a href="OptionalTasks/test.html">Test</a><br>
+<a href="Integration/VAJAntTool.html#tasks">Visual Age for Java Tasks</a><br>
+<a href="OptionalTasks/vssget.html">VssGet</a><br>
+<a href="OptionalTasks/vsslabel.html">VssLabel</a><br>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/resources.html b/jakarta-ant-1.2-src/docs/manual/resources.html
new file mode 100644
index 0000000..1d7b241
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/resources.html
@@ -0,0 +1,25 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+<h1>Ant Resources</h1>
+
+<h2><a name="faq">FAQ</a></h2>
+<p>There is an on-line FAQ for Ant at <a target="_top"
+href="http://jakarta.apache.org/jyve-faq/Turbine/screen/DisplayTopics/action/SetAll/project_id/2/faq_id/16">jakarta.apache.org</a>. This
+FAQ is interactive, which means you can ask and answer questions
+on line.</p>
+<p>One of the questions popping up quite often is &quot;Is there a DTD for
+buildfiles?&quot; Please refer to the FAQ for an answer.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/toc.html b/jakarta-ant-1.2-src/docs/manual/toc.html
new file mode 100644
index 0000000..418e4b7
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/toc.html
@@ -0,0 +1,26 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+<base target="mainFrame">
+</head>
+
+<body>
+
+<h2>Table of Contents</h2>
+<a href="intro.html">Introduction</a><br>
+<a href="install.html">Installing Ant</a><br>
+<a href="using.html">Using Ant</a><br>
+<a href="coretasklist.html" target="navFrame">Built-in Tasks</a><br>
+<a href="optionaltasklist.html" target="navFrame">Optional Tasks</a><br>
+<a href="ide.html" target="navFrame">IDE Integration</a><br>
+<a href="develop.html">Developing with Ant</a><br>
+<a href="resources.html">Ant Resources</a><br>
+<a href="LICENSE">License</a><br>
+<a href="feedback.html">Feedback</a><br><br>
+<a href="credits.html">Authors</a><br>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/manual/using.html b/jakarta-ant-1.2-src/docs/manual/using.html
new file mode 100644
index 0000000..bc74fc4
--- /dev/null
+++ b/jakarta-ant-1.2-src/docs/manual/using.html
@@ -0,0 +1,468 @@
+<html>
+
+<head>
+<meta http-equiv="Content-Language" content="en-us">
+<title>Ant User Manual</title>
+</head>
+
+<body>
+<h1>Using Ant</h1>
+<h2><a name="buildfile">Writing a Simple Buildfile</a></h2>
+<p>Ant's buildfiles are written in XML. Each buildfile contains one project.</p>
+<p>Each task element of the buildfile can have an <code>id</code> attribute and
+can later be referred to by the value supplied to this. The value has
+to be unique. (For additional information, see the
+<a href="#tasks"> Tasks</a> section below.)</p>
+<h3>Projects</h3>
+<p>A <i>project</i> has three attributes:</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">the name of the project.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">default</td>
+    <td valign="top">the default target to use when no target is supplied.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">basedir</td>
+    <td valign="top">the base directory from which all path calculations are
+      done. This attribute might be overridden by setting
+      the &quot;basedir&quot;
+      property beforehand. When this is done, it must be omitted in the
+      project tag. If neither the attribute nor the property have
+      been set, the parent directory of the buildfile will be used.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+<p>Each project defines one or more <i>targets</i>.
+A target is a set of <i>tasks</i> you want
+to be executed. When starting Ant, you can select which target(s) you
+want to have executed. When no target is given,
+the project's default is used.</p>
+
+<h3>Targets</h3>
+<p>A target can depend on other targets. You might have a target for compiling,
+for example, and a target for creating a distributable. You can only build a
+distributable when you have compiled first, so the distribute target
+<i>depends on</i> the compile target. Ant resolves these dependencies.</p>
+<p>It should be noted, however, that Ant's <code>depends</code> attribute
+only specifies the <i>order</i> in which targets should be executed &#150; it
+does not affect whether the target that specifies the dependency(s) gets
+executed if the dependent target(s) did not (need to) run.
+</p>
+<p>Ant tries to execute the targets in the <code>depends</code>
+attribute in the order
+they appear (from left to right). Keep in mind that it is possible that a target
+can get executed earlier when an earlier target depends on it:</p>
+<blockquote>
+<pre>&lt;target name=&quot;A&quot;/&gt;
+&lt;target name=&quot;B&quot; depends=&quot;A&quot;/&gt;
+&lt;target name=&quot;C&quot; depends=&quot;B&quot;/&gt;
+&lt;target name=&quot;D&quot; depends=&quot;C,B,A&quot;/&gt;</pre>
+</blockquote>
+<p>Suppose we want to execute target D. From its
+<code>depends</code> attribute, you
+might think that first target C, then B and then A is executed.
+Wrong! C depends on B, and B depends on A, so first A is executed, then B, then C, and finally D.</p>
+<p>A target gets executed only once, even when more than one target
+depends on it (see the previous example).</p>
+<p>A target also has the ability to perform its execution if (or
+unless) a property has been set. This allows, for example, better
+control on the building process depending on the state of the system
+(java version, OS, command-line property defines, etc.).  To make a target
+<i>sense</i> this property, you should add the <code>if</code> (or
+<code>unless</code>) attribute with the name of the property that the target
+should react to. For example:</p>
+<blockquote>
+  <pre>&lt;target name=&quot;build-module-A&quot; if=&quot;module-A-present&quot;/&gt;</pre>
+  <pre>&lt;target name=&quot;build-own-fake-module-A&quot; unless=&quot;module-A-present&quot;/&gt;</pre>
+</blockquote>
+<p>If no <code>if</code> and no <code>unless</code> attribute is present,
+the target will always be executed.</p>
+<p>The optional <code>description</code> attribute can be used to provide a one-line description of this target, which is printed by the
+<nobr><code>-projecthelp</code></nobr> command-line option.</p>
+<p>It is a good practice to place your <a
+href="CoreTasks/tstamp.html">tstamp</a> tasks in a so-called
+<i>initialization</i> target, on which
+all other targets depend. Make sure that target is always the first one in
+the depends list of the other targets. In this manual, most initialization targets
+have the name &quot;init&quot;.</p>
+<p>A target has the following attributes:</p>
+<table border="1" cellpadding="2" cellspacing="0">
+  <tr>
+    <td valign="top"><b>Attribute</b></td>
+    <td valign="top"><b>Description</b></td>
+    <td align="center" valign="top"><b>Required</b></td>
+  </tr>
+  <tr>
+    <td valign="top">name</td>
+    <td valign="top">the name of the target.</td>
+    <td align="center" valign="top">Yes</td>
+  </tr>
+  <tr>
+    <td valign="top">depends</td>
+    <td valign="top">a comma-separated list of names of targets on which this
+      target depends.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">if</td>
+    <td valign="top">the name of the property that must be set in order for this
+      target to execute.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">unless</td>
+    <td valign="top">the name of the property that must not be set in order 
+      for this target to execute.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+  <tr>
+    <td valign="top">description</td>
+    <td valign="top">a short description of this target's function.</td>
+    <td align="center" valign="top">No</td>
+  </tr>
+</table>
+
+<a name="tasks">
+<h3>Tasks</h3>
+</a>
+<p>A task is a piece of code that can be executed.</p>
+<p>A task can have multiple attributes (or arguments, if you prefer). The value
+of an attribute might contain references to a property. These references will be
+resolved before the task is executed.</p>
+<p>Tasks have a common structure:</p>
+<blockquote>
+  <pre>&lt;<i>name</i> <i>attribute1</i>=&quot;<i>value1</i>&quot; <i>attribute2</i>=&quot;<i>value2</i>&quot; ... /&gt;</pre>
+</blockquote>
+<p>where <i>name</i> is the name of the task,
+<i>attributeN</i> is the attribute name, and
+<i>valueN</i> is the value for this attribute.</p>
+<p>There is a set of <a href="coretasklist.html" target="navFrame">built-in tasks</a>, along with a 
+number of
+<a href="optionaltasklist.html" target="navFrame"> optional tasks</a>, but it is also very
+easy to <a href="develop.html#writingowntask">write your own</a>.</p>
+<p>All tasks share a task name attribute. The value of
+this attribute will be used in the logging messages generated by
+Ant.</p>
+Tasks can be assigned an <code>id</code> attribute:
+<blockquote>
+<pre>&lt;<i>taskname</i> id="<i>taskID</i>" ... /&gt;</pre>
+</blockquote>
+where <i>taskname</i> is the name of the task, and <i>taskID</i> is
+a unique name for this task.
+You can refer to the
+corresponding task object in scripts or other tasks via this name.
+For example, in scripts you could do:
+<blockquote>
+<pre>
+&lt;script ... &gt;
+  task1.setFoo("bar");
+&lt;/script&gt;
+</pre>
+</blockquote>
+to set the <code>foo</code> attribute of this particular task instance.
+In another task (written in Java), you can access the instance via
+<code>project.getReference("task1")</code>.
+<p>
+Note<sup>1</sup>: If "task1" has not been run yet, then
+it has not been configured (ie., no attributes have been set), and if it is
+going to be configured later, anything you've done to the instance may
+be overwritten.
+</p>
+<p>
+Note<sup>2</sup>: Future versions of Ant will most likely <i>not</i>
+be backward-compatible with this behaviour, since there will likely be no
+task instances at all, only proxies.
+</p>
+
+<h3>Properties</h3>
+<p>A project can have a set of properties. These might be set in the buildfile
+by the <a href="CoreTasks/property.html">property task</a>, or might be set outside Ant. A
+property has a name and a value. Properties may be used in the value of
+task attributes. This is done by placing the property name between
+&quot;<code>${</code>&quot; and &quot;<code>}</code>&quot; in the
+attribute value. For example,
+if there is a &quot;builddir&quot; property with the value
+&quot;build&quot;, then this could be used in an attribute like this:
+<code>${builddir}/classes</code>.
+This is resolved as <code>build/classes</code>.</p>
+
+<h3>Built-in Properties</h3>
+<p>Ant provides access to all system properties as if they had been
+defined using a <code>&lt;property&gt;</code> task.
+For example, <code>${os.name}</code> expands to the
+name of the operating system.</p>
+<p>In addition, Ant has some built-in properties:</p>
+<pre>
+basedir             the absolute path of the project's basedir (as set
+                    with the basedir attribute of &lt;project&gt;).
+ant.file            the absolute path of the buildfile.
+ant.project.name    the name of the project that is currently executing;
+                    it is set in the name attribute of &lt;project&gt;.
+ant.java.version    the JVM version Ant detected; currently it can hold
+                    the values &quot;1.1&quot;, &quot;1.2&quot; and &quot;1.3&quot;.
+</pre>
+
+<h3>Example</h3>
+<pre>
+&lt;project name=&quot;MyProject&quot; default=&quot;dist&quot; basedir=&quot;.&quot;&gt;
+
+  &lt;!-- set global properties for this build --&gt;
+  &lt;property name=&quot;src&quot; value=&quot;.&quot;/&gt;
+  &lt;property name=&quot;build&quot; value=&quot;build&quot;/&gt;
+  &lt;property name=&quot;dist&quot;  value=&quot;dist&quot;/&gt;
+
+  &lt;target name=&quot;init&quot;&gt;
+    &lt;!-- Create the time stamp --&gt;
+    &lt;tstamp/&gt;
+    &lt;!-- Create the build directory structure used by compile --&gt;
+    &lt;mkdir dir=&quot;${build}&quot;/&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;compile&quot; depends=&quot;init&quot;&gt;
+    &lt;!-- Compile the java code from ${src} into ${build} --&gt;
+    &lt;javac srcdir=&quot;${src}&quot; destdir=&quot;${build}&quot;/&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;dist&quot; depends=&quot;compile&quot;&gt;
+    &lt;!-- Create the distribution directory --&gt;
+    &lt;mkdir dir=&quot;${dist}/lib&quot;/&gt;
+
+    &lt;!-- Put everything in ${build} into the MyProject-${DSTAMP}.jar file --&gt;
+    &lt;jar jarfile=&quot;${dist}/lib/MyProject-${DSTAMP}.jar&quot; basedir=&quot;${build}&quot;/&gt;
+  &lt;/target&gt;
+
+  &lt;target name=&quot;clean&quot;&gt;
+    &lt;!-- Delete the ${build} and ${dist} directory trees --&gt;
+    &lt;delete dir=&quot;${build}&quot;/&gt;
+    &lt;delete dir=&quot;${dist}&quot;/&gt;
+  &lt;/target&gt;
+&lt;/project&gt;
+</pre>
+
+<h3>Token Filters</h3>
+<p>A project can have a set of tokens that might be automatically expanded if
+found when a file is copied, when the filtering-copy behavior is selected in the
+tasks that support this. These might be set in the buildfile
+by the <a href="CoreTasks/filter.html">filter task</a>.&nbsp;</p>
+<p>Since this can potentially be a very harmful behavior,
+the tokens in the files <b>must</b>
+be of the form <code>@</code><i>token</i><code>@</code>, where
+<i>token</i> is the token name that is set
+in the filter task. This token syntax matches the syntax of other build systems
+that perform such filtering and remains sufficiently orthogonal to most
+programming and scripting languages, as well as with documentation systems.</p>
+<p>Note: If a token with the format <code>@</code><i>token</i><code>@</code>
+is found in a file, but no
+filter is associated with that token, no changes take place;
+therefore, no escaping
+method is available &#150; but as long as you choose appropriate names for your
+tokens, this should not cause problems.</p>
+<p><b>Warning:</b> If you copy binary files with filtering turned on, you can corrupt the
+files. This feature should be used with text files <em>only</em>.</p>
+
+<h3><a name="path">Path-like Structures</a></h3>
+<p>You can specify <code>PATH</code>- and <code>CLASSPATH</code>-type
+references using both
+&quot;<code>:</code>&quot; and &quot;<code>;</code>&quot; as separator
+characters. Ant will
+convert the separator to the correct character of the current operating
+system.</p>
+<p>Wherever path-like values need to be specified, a nested element can
+be used. This takes the general form of:</p>
+<pre>
+    &lt;classpath&gt;
+      &lt;pathelement path=&quot;${classpath}&quot;/&gt;
+      &lt;pathelement location=&quot;lib/helper.jar&quot;/&gt;
+    &lt;/classpath&gt;
+</pre>
+<p>The <code>location</code> attribute specifies a single file or
+directory relative to the project's base directory (or an absolute
+filename), while the <code>path</code> attribute accepts colon-
+or semicolon-separated lists of locations. The <code>path</code>
+attribute is intended to be used with predefined paths &#150; in any other
+case, multiple elements with <code>location</code> attributes should be
+preferred.</p>
+<p>As a shortcut, the <code>&lt;classpath&gt;</code> tag
+supports <code>path</code> and
+<code>location</code> attributes of its own, so:</p>
+<pre>
+    &lt;classpath&gt;
+      &lt;pathelement path=&quot;${classpath}&quot;/&gt;
+    &lt;/classpath&gt;
+</pre>
+<p>can be abreviated to:</p>
+<pre>
+    &lt;classpath path=&quot;${classpath}&quot;/&gt;
+</pre>
+<p>In addition, <a href="CoreTypes/fileset.html">FileSet</a>s can be specified via
+nested <code>&lt;fileset&gt;</code> elements. The order in which the files
+building up a fileset are added to the path-like structure is not
+defined.</p>
+<pre>
+    &lt;classpath&gt;
+      &lt;pathelement path=&quot;${classpath}&quot;/&gt;
+      &lt;fileset dir=&quot;lib&quot;&gt;
+        &lt;include name=&quot;**/*.jar&quot;/&gt;
+      &lt;/fileset&gt;
+      &lt;pathelement location=&quot;classes&quot;/&gt;
+    &lt;/classpath&gt;
+</pre>
+<p>Builds a path that holds the value of <code>${classpath}</code>,
+followed by all jar files in the <code>lib</code> directory, followed
+by the <code>classes</code> directory.</p>
+<p>If you want to use the same path-like structure for several tasks,
+you can define them with a <code>&lt;path&gt;</code> element at the
+same level as <i>target</i>s, and reference them via their
+<i>id</i> attribute &#150; see <a href="#references">References</a> for an
+example.</p>
+<p>A path-like structure can include a reference to another path-like
+structure via nested <code>&lt;path&gt;</code> elements:</p>
+<pre>
+    &lt;path id=&quot;base.path&quot;&gt;
+      &lt;pathelement path=&quot;${classpath}&quot;/&gt;
+      &lt;fileset dir=&quot;lib&quot;&gt;
+        &lt;include name=&quot;**/*.jar&quot;/&gt;
+      &lt;/fileset&gt;
+      &lt;pathelement location=&quot;classes&quot;/&gt;
+    &lt;/path&gt;
+
+    &lt;path id=&quot;tests.path&quot;&gt;
+      &lt;path refid=&quot;base.path&quot;/&gt;
+      &lt;pathelement location=&quot;testclasses&quot;/&gt;
+    &lt;/path&gt;
+</pre>
+ The shortcuts previously mentioned for <code>&lt;classpath&gt;</code> are also valid for <code>&lt;path&gt;</code>.For example:
+<pre>
+    &lt;path id=&quot;base.path&quot;&gt;
+      &lt;pathelement path=&quot;${classpath}&quot;/&gt;
+    &lt;/path&gt;
+</pre>
+can be written as:
+<pre>
+    &lt;path id=&quot;base.path&quot; path=&quot;${classpath}&quot;/&gt;
+</pre>
+
+<h3><a name="arg">Command-line Arguments</a></h3>
+<p>Several tasks take arguments that will be passed to another
+process on the command line. To make it easier to specify arguments
+that contain space characters, nested <code>arg</code> elements can be used.</p>
+<table border="1" cellpadding="2" cellspacing="0">
+<tr>
+  <td width="12%" valign="top"><b>Attribute</b></td>
+  <td width="78%" valign="top"><b>Description</b></td>
+  <td width="10%" valign="top"><b>Required</b></td>
+</tr>
+  <tr>
+    <td valign="top">value</td> 
+    <td valign="top">a single command-line argument; can contain space
+      characters.</td>
+    <td align="center" rowspan="4">Exactly one of these.</td>
+  </tr>
+  <tr>
+    <td valign="top">line</td> 
+    <td valign="top">a space-delimited list of command-line arguments.</td>
+  </tr>
+  <tr>
+    <td valign="top">file</td> 
+    <td valign="top">The name of a file as a single command-line
+      argument; will be replaced with the absolute filename of the file.</td>
+  </tr>
+  <tr>
+    <td valign="top">path</td> 
+    <td valign="top">A string that will be treated as a path-like
+      string as a single command-line argument; you can use <code>;</code>
+      or <code>:</code> as
+      path separators and Ant will convert it to the platform's local
+      conventions.</td>
+  </tr>
+</table>
+<h4>Examples</h4>
+<blockquote><pre>
+  &lt;arg value=&quot;-l -a&quot;/&gt;
+</pre></blockquote>
+<p>is a single command-line argument containing a space character.</p>
+<blockquote><pre>
+  &lt;arg line=&quot;-l -a&quot;/&gt;
+</pre></blockquote>
+<p>represents two separate command-line arguments.</p>
+<blockquote><pre>
+  &lt;arg path=&quot;/dir;/dir2:\dir3&quot;/&gt;
+</pre></blockquote>
+<p>is a single command-line argument with the value
+<code>\dir;\dir2;\dir3</code> on DOS-based systems and
+<code>/dir:/dir2:/dir3</code> on Unix-like systems.</p>
+
+<h3><a name="references">References</a></h3>
+<p>The <code>id</code> attribute of the buildfile's elements can be
+used to refer to them. This can useful if you are going to replicate
+the same snippet of XML over and over again &#150; using a
+<code>&lt;classpath&gt;</code> structure more than once for
+example.</p>
+<p>The following example:</p>
+<blockquote><pre>
+&lt;project ... &gt;
+  &lt;target ... &gt;
+    &lt;rmic ...&gt;
+      &lt;classpath&gt;
+        &lt;pathelement location=&quot;lib/&quot;/&gt;
+        &lt;pathelement path=&quot;${java.class.path}/&quot;/&gt;
+        &lt;pathelement path=&quot;${additional.path}&quot;/&gt;
+      &lt;/classpath&gt;
+    &lt;/rmic&gt;
+  &lt;/target&gt;
+
+  &lt;target ... &gt;
+    &lt;javac ...&gt;
+      &lt;classpath&gt;
+        &lt;pathelement location=&quot;lib/&quot;/&gt;
+        &lt;pathelement path=&quot;${java.class.path}/&quot;/&gt;
+        &lt;pathelement path=&quot;${additional.path}&quot;/&gt;
+      &lt;/classpath&gt;
+    &lt;/javac&gt;
+  &lt;/target&gt;
+&lt;/project&gt;
+</pre></blockquote>
+<p>could be rewritten as:</p>
+<blockquote><pre>
+&lt;project ... &gt;
+  &lt;path id=&quot;project.class.path&quot;&gt;
+    &lt;pathelement location=&quot;lib/&quot;/&gt;
+    &lt;pathelement path=&quot;${java.class.path}/&quot;/&gt;
+    &lt;pathelement path=&quot;${additional.path}&quot;/&gt;
+  &lt;/path&gt;
+
+  &lt;target ... &gt;
+    &lt;rmic ...&gt;
+      &lt;classpath refid=&quot;project.class.path&quot;/&gt;
+    &lt;/rmic&gt;
+  &lt;/target&gt;
+
+  &lt;target ... &gt;
+    &lt;javac ...&gt;
+      &lt;classpath refid=&quot;project.class.path&quot;/&gt;
+    &lt;/javac&gt;
+  &lt;/target&gt;
+&lt;/project&gt;
+</pre></blockquote>
+<p>All tasks that use nested elements for <a
+href="CoreTypes/patternset.html">PatternSet</a>s, <a href="CoreTypes/fileset.html">FileSet</a>s or
+<a href="#path">path-like structures</a> accept references to these
+structures as well.</p>
+
+<hr>
+<p align="center">Copyright &copy; 2000,2001 Apache Software Foundation. All rights
+Reserved.</p>
+
+</body>
+</html>
+
diff --git a/jakarta-ant-1.2-src/docs/native2ascii.html b/jakarta-ant-1.2-src/docs/native2ascii.html
deleted file mode 100644
index e93a798..0000000
--- a/jakarta-ant-1.2-src/docs/native2ascii.html
+++ /dev/null
@@ -1,58 +0,0 @@
-<html>
-<head><title>Native2Ascii</title></head>
-<body>
-<h2>Native2Ascii</h2>
-
-<h3>Description:</h3>
-
-<p>Converts files from native encodings to ascii with escaped Unicode.
-A common usage is to convert source files maintained in a native
-operating system encoding, to ascii prior to compilation.</p>
-
-<p>All matching files in the source directory are converted from a
-native encoding to ascii.  If no encoding is specified, the default
-encoding for the JVM is used.  If ext is specified, then output
-files are renamed to use it as a new extension.  If dest and
-src point to the same directory, ext is required.</p>
-
-<p>This is a directory based task, and supports includes, includesfile,
-excludes, excludesfile, and defaultexcludes along with its specific
-attributes.</p>
-
-<pre>
-Attribute Description                              Required
------------------------------------------------------------
-reverse   Reverse the sense of the conversion,     No
-          i.e. convert from ascii to native 
-
-encoding  The native encoding the files are in     No
-
-src       The directory to find files in           No
-
-dest      The directory to output file to          Yes
-
-ext       File extension to use in renaming        No
-          output files 
-</pre>
-
-<h3>Examples</h3>
-
-<pre>
-&lt;native2ascii encoding=&quot;EUCJIS&quot; src=&quot;srcdir&quot; dest=&quot;srcdir&quot;
-   includes=&quot;**/*.eucjis&quot; ext=&quot;.java&quot; /&gt;
-</pre>
-
-<p>Converts all files in the directory srcdir ending in eucjis
-from the EUCJIS encoding to ascii and renames the to end in
-.java.</p>
-
-<pre>
-&lt;native2ascii encoding='EUCJIS&quot; src=&quot;native/japanese&quot; dest=&quot;src&quot;
-   includes=&quot;**/*.java /&gt;
-</pre>
-
-<p>Converts all the files ending in .java in the directory native/japanese
-to ascii, placing the results in the directory src.  The names of
-the files remain the same.</p>
-</body>
-</html>
\ No newline at end of file
diff --git a/jakarta-ant-1.2-src/src/antidote/ChangeLog b/jakarta-ant-1.2-src/src/antidote/ChangeLog
new file mode 100644
index 0000000..b9bf026
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/ChangeLog
@@ -0,0 +1,153 @@
+2000-11-27  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/ActionManager.java: Added ability to
+	generate popup menus from a list of action IDs. 
+
+2000-11-24  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/Console.java: Added context colorization.
+
+2000-11-20  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/command/DisplayErrorCmd.java: Added
+	code to allow display of stack backtrace if needed.
+
+2000-11-18  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/customizer/PropertiesPropertyEditor.java:
+	Added proper editing capability. Rows are added and removed
+	automatically. 
+	
+	* org/apache/tools/ant/gui/customizer/XXXPropertyEditor.java:
+	Removed stray event firing upon setting value of property to edit.
+
+2000-11-16  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/customizer/StringPropertyEditor.java:
+	Changed underlying widget type to JTextPane so that it would
+	accomidate multi-line strings property.
+
+	* org/apache/tools/ant/gui/acs/ACSTreeNodeElement.java: Fixed
+	nasty java.lang.IllegalAccessException bug that I thought was
+	related to Java 1.3 Blackdown RC1, but wasn't. It was related to
+	using Jikes, which interprests method resolution differently than
+	javac, resulting in a call trying to access a private method
+	implementation of a public interface.
+
+	* org/apache/tools/ant/gui/ResourceManager.java: Added convenience
+	method for getting resource images for a given class.
+
+	* org/apache/tools/ant/gui/AntAction.java: Added toggle property.
+
+	* org/apache/tools/ant/gui/ActionManager.java: Added ability to
+	handle toggle actions to menu bar (still need to add support to
+	tool bar).
+
+	* org/apache/tools/ant/gui/EventResponder.java: Added emacs
+	notifier command.
+
+	* org/apache/tools/ant/gui/ide/EmacsNotifier.java: Imported.
+
+	* org/apache/tools/ant/gui/ProjectProxy.java: Added code to add
+	listeners registered with the AppContext to the build.
+
+	* org/apache/tools/ant/gui/AppContext.java: Now allows registering
+	of build listeners to be added to project at build time.
+
+	* org/apache/tools/ant/gui/Main.java: Added loading of build file
+	provided on command line.
+
+2000-11-14  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/Antidote.java: Added top area widget,
+	which is *not* managed inside a split pane.
+
+	* org/apache/tools/ant/gui/ProjectNavigator.java: Added minimum
+	size to keep resizing of parent from hiding widget.
+
+	* org/apache/tools/ant/gui/ActionManager.java: Large functionality
+	addtion for allowing action enabled/disabled state to be defined
+	in the configuration file. The triggering of state changes is
+	based on the firing of specific events.
+
+	* org/apache/tools/ant/gui/AntAction.java: Broke out from inner
+	class of ActionManager to its own self (I'm my own man!).
+
+	* org/apache/tools/ant/gui/command/CloseCmd.java: Added firing of
+	ProjectClosedEvent so state updates could occur.
+
+	* org/apache/tools/ant/gui/resources/action.properties: Added
+	enabledOn and disabledOn event specifications.
+
+	* org/apache/tools/ant/gui/Console.java: Improved reporting level
+	handling (some events weren't getting reported).
+
+2000-11-10  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/PropertyEditor.java: Added new
+	DynamicCustomizer class instead of HTML based info.
+
+2000-11-09  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/ProjectProxy.java: Started rework of
+	project data model, using elements from the XML parser directly
+	through the new Ant Construction Set package.
+
+2000-11-08  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/About.java: Useless tweaking inspired
+	by procrastination.
+
+2000-11-05  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/LogLevelEnum.java: Added log level
+	enumeration for use with combo boxes (drops nicely into default model).
+
+	* org/apache/tools/ant/gui/event/BuildEventType.java: Added
+	delivering of event to a BuildListener based on enumeration value.
+
+	* org/apache/tools/ant/gui/ProjectProxy.java: Added generation of
+	BuildEvent on project start and finish, as the project itself
+	doesn't generate theses events (unfortunately).
+
+	* org/apache/tools/ant/gui/Console.java: Added filtering level,
+	and clearing of buffer when a new build starts.
+
+	* org/apache/tools/ant/gui/AntEditor.java: Added automatic border
+	for all subclasses.
+
+2000-11-04  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/ProjectProxy.java: Added inner class to
+	execute the build in a separate thread.
+
+	* org/apache/tools/ant/gui/event/EventBus.java: Added check to see
+	if postEvent() is being called on the AWTEvent thread, and if not,
+	post the dispatching of the event to that thread. This is needed
+	as most of the listeners will be bound to GUI components and will
+	be updating their state (which must occur on the event thread).
+
+	* org/apache/tools/ant/gui/ProjectProxy.java: Added a
+	BuildListener to forward events to the EventBus.
+
+2000-11-03  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/Antidote.java: Removed hard-coded
+	Console class.
+
+	* org/apache/tools/ant/gui/Console.java: Changed to a real
+	AntEditor class, initialized by the config file.
+
+2000-11-02  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/event/EventBus.java: Added interrupt
+	level support.
+
+	* org/apache/tools/ant/gui/About.java: Created
+	
+2000-11-01  Simeon H.K. Fitch  <simeon@fitch.net>
+
+	* org/apache/tools/ant/gui/Main.java: Added XMLHelper.init() call
+	
+	* build.xml: Updated run target to include ant.jar in classpath.
+
diff --git a/jakarta-ant-1.2-src/src/antidote/README b/jakarta-ant-1.2-src/src/antidote/README
new file mode 100644
index 0000000..a759736
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/README
@@ -0,0 +1,68 @@
+
+                                A N T I D O T E
+ 
+  What is it? 
+  -----------
+  
+  Antidote is the Java based GUI interface to the Ant build tool.
+
+  Status
+  ------
+  
+  Antidote is in the early stages of development. Its usefulnes is limited, and
+  will not be distributed with the binary versions of Ant until it is deemed
+  featureful and robust enough for end user use. That being said, it currently
+  will load an Ant build.xml file, allow you to edit some of the file's
+  properties, save it, and launch a build starting at any target in the
+  project. 
+
+  The Latest Version
+  ------------------
+
+  The latest version is the current CVS version, which may or may not be useful
+  at any given time. The source code is not being base-lined at any specific
+  version at this time.
+
+  Documentation
+  -------------
+
+  Any documentation that exists for Antidote can be found in the antidote/docs
+  directory. Documentation is primarily developement based documentation as
+  Antidote is not yet mature enough for reliable user documentation.
+
+  Building
+  --------
+
+  Antidote requres JAXP 1.0.1 from Sun (http://java.sun.com/xml). Some time in
+  the future it is hoped at any w3c based XML will be usable, but at the 
+  current time the Sun library is needed. The easiest way to install the
+  jaxp.jar and parsers.jar file that comes with the distribution is to copy 
+  them into your $JAVA_HOME/jre/lib/ext directory.
+
+  There is a build.xml file in the same directory as this file that will work
+  with Ant 1.2. It is recommended that Ant be built first (from ../..), 
+  followed by this directory. By default, the compiled classes will be written
+  to ~/built/antidote/classes, but the JAR file and launch scripts are written
+  to the Ant build directory (~/build/ant).
+
+  Running
+  -------
+
+  Antidote requires at least Java 1.2 to run. 
+
+  Upon successful building of Ant and Antidote (in that order), go to
+  ~/build/ant/bin and run "antidote". You will probably have to set the
+  environment variable "ANT_HOME" to "~/build/ant" in the shell that you launch
+  antidote from. If desired, you can provide the build file to launch at statup
+  as the first argument on the command line to "antidote".
+
+  Licensing
+  ---------
+
+  This software is licensed under the terms you may find in the file 
+  named "LICENSE" provided with this distribution.
+
+  Thanks for using Antidote.
+
+                                          The Apache Jakarta Project
+                                         <http://jakarta.apache.org/>
diff --git a/jakarta-ant-1.2-src/src/antidote/TODO b/jakarta-ant-1.2-src/src/antidote/TODO
new file mode 100644
index 0000000..7d6de3d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/TODO
@@ -0,0 +1,69 @@
+TODO List:
+
+    * Add editors for defining file sets, and other "sets".
+
+    * Write wizzard framework.
+
+    * Implement a build progress reporter.
+
+    * Implement a "Worker Thread" pattern that allows workers to have
+      their work done in a thread property registered with Antidote, and
+      provide support to that worker to provide progress updates via
+      the GUI. Should also provide support for hour-glass cursor
+      handling, and AWT event blocking until task is completed. This
+      would be used for things such as loading files or other tasks
+      that the user must wait for completion.
+
+    * Add menu option to select the compiler to use, which then sets
+      the "build.compiler" property. Better yet, create a generic menu 
+      building capability that allows the setting of a property from a 
+      list of options.
+
+    * Add ability to put an "all" or "don't care" specifyer on the action
+      "enableOn" and "disableOn" properties.
+
+    * Add ability to view task dependencies more fully.
+
+    * Add better editors for specific tasks.
+
+    * Add a Progress Monitor for file loading (especially for slow boxen like
+      mine) .
+
+    * Implement some for of refid hyperlinking functionality.
+
+    * Implement context sensitive menus for the console window, allowing
+      an error to be selected and invoked in IDE.
+
+    * Write preferences framwork, including persistence support.
+
+    * Provide some sort of class path debugging support.
+
+    * Add "syntax" colorization to the console window {done}, 
+      with a preferences editor for setting up the styles {not-done}.
+
+    * Figure out an approach to gracefully stopping a running build.
+
+    * Add error handler for SAX parser to better report loading errors.
+
+    * Add support to ActionManager to handle toggle actions in tool bar. Also
+      need a better way of detecting the selected state of the action button.
+
+    * Project properties viewer, including the ability to view
+      dependencies (local and cascading).
+
+    * Acquire or implement a logging facility.
+
+    * Eat more dog food.
+
+(pending Ant 2.0)
+    
+    * Need Ant API access to:
+        - Tasks within a Target
+        - The topo sorted task list to get flattened dependencies
+        - The build setup code to recduce code replication.
+        - Normalize the Ant data model to represent a more consistent
+          tree structure, and more bean-like API.
+
+    * Better define the data model architecture, and how it interfaces
+      with the Ant data model.
+
diff --git a/jakarta-ant-1.2-src/src/antidote/bin/antidote b/jakarta-ant-1.2-src/src/antidote/bin/antidote
new file mode 100644
index 0000000..22e167a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/bin/antidote
@@ -0,0 +1,48 @@
+#! /bin/sh
+
+if [ -f $HOME/.antrc ] ; then 
+  . $HOME/.antrc
+fi
+
+if [ "$ANT_HOME" = "" ] ; then
+  # try to find ANT
+  if [ -d /opt/ant ] ; then 
+    ANT_HOME=/opt/ant
+  fi
+
+  if [ -d ${HOME}/opt/ant ] ; then 
+    ANT_HOME=${HOME}/opt/ant
+  fi
+
+  ## resolve links - $0 may be a link to ant's home
+  PRG=$0
+  progname=`basename $0`
+  
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '.*/.*' > /dev/null; then
+	PRG="$link"
+    else
+	PRG="`dirname $PRG`/$link"
+    fi
+  done
+  
+  ANT_HOME=`dirname "$PRG"`/..
+
+fi
+
+# Allow .antrc to specifiy flags to java cmd
+if [ "$JAVACMD" = "" ] ; then 
+  JAVACMD=java
+fi
+
+LOCALCLASSPATH=`echo $ANT_HOME/lib/*.jar | tr ' ' ':'`
+
+if [ "$CLASSPATH" != "" ] ; then
+  LOCALCLASSPATH=$CLASSPATH:$LOCALCLASSPATH
+fi
+
+
+$JAVACMD -classpath $LOCALCLASSPATH -Dant.home=${ANT_HOME} org.apache.tools.ant.gui.Main $@
+
diff --git a/jakarta-ant-1.2-src/src/antidote/bin/antidote.bat b/jakarta-ant-1.2-src/src/antidote/bin/antidote.bat
new file mode 100644
index 0000000..e5f6292
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/bin/antidote.bat
@@ -0,0 +1,48 @@
+@echo off
+
+rem Slurp the command line arguments.  This loop allows for an unlimited number of 
+rem agruments (up to the command line limit, anyway).
+
+set ANT_CMD_LINE_ARGS=
+
+:setupArgs
+if %1a==a goto doneArgs
+set ANT_CMD_LINE_ARGS=%ANT_CMD_LINE_ARGS% %1
+shift
+goto setupArgs
+
+:doneArgs
+rem The doneArgs label is here just to provide a place for the argument list loop
+rem to break out to.
+
+rem find ANT_HOME
+if not "%ANT_HOME%"=="" goto checkJava
+
+rem check for ant in Program Files on system drive
+rem if not exist "%SystemDrive%\Program Files\ant" goto checkSystemDrive
+rem set ANT_HOME=%SystemDrive%\Program Files\ant
+rem goto checkJava
+
+rem :checkSystemDrive
+rem check for ant in root directory of system drive
+rem if not exist "%SystemDrive%\ant" goto noAntHome
+rem set ANT_HOME=%SystemDrive%\ant
+rem goto checkJava
+
+:noAntHome
+echo ANT_HOME is not set and ant could not be located. Please set ANT_HOME.
+goto end
+
+:checkJava
+if "%JAVACMD%" == "" set JAVACMD=java
+
+set LOCALCLASSPATH="%CLASSPATH%"
+for %%i in ("%ANT_HOME%\lib\*.jar") do call "%ANT_HOME%\bin\lcp.bat" "%%i"
+
+%JAVACMD% -classpath %LOCALCLASSPATH% -Dant.home="%ANT_HOME%" org.apache.tools.ant.gui.Main %ANT_CMD_LINE_ARGS%
+goto end
+
+:end
+set LOCALCLASSPATH=
+set ANT_CMD_LINE_ARGS=
+
diff --git a/jakarta-ant-1.2-src/src/antidote/build.xml b/jakarta-ant-1.2-src/src/antidote/build.xml
new file mode 100644
index 0000000..2104bcf
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/build.xml
@@ -0,0 +1,213 @@
+<?xml version="1.0"?>
+
+<project name="Antidote" default="main" basedir=".">
+
+  <!-- Give user a chance to override without editing this file 
+       (and without typing -D each time it compiles it) -->
+  <property file="${user.home}/.ant.properties" />
+
+  <property name="Name" value="Antidote"/>
+  <property name="name" value="antidote"/>
+  <property name="version" value="0.1"/>
+
+  <property name="ant.home" value="../../"/>
+  <property name="src.bin.dir" value="bin"/>
+  <property name="src.etc.dir" value="etc"/>
+  <property name="src.dir" value="."/>
+  <property name="docs.dir" value="docs"/>
+  <property name="build.dir" value="../../../build/antidote"/>
+  <property name="ant.build.dir" value="../../../build/ant"/>
+  <property name="lib.dir" value="${ant.build.dir}/lib"/>
+  <property name="bin.dir" value="${ant.build.dir}/bin"/>
+  <property name="build.classes" value="${build.dir}/classes"/>
+  <property name="build.javadocs" value="${build.dir}/javadocs"/>
+  <property name="ant.dist.dir" value="../../../dist/ant"/>
+
+  <path id="classpath">
+    <pathelement location="${lib.dir}/ant.jar"/>
+  </path>
+  <property name="packages" value="org.apache.tools.ant.gui.*"/>
+  <property name="manifest" value="etc/manifest"/>
+
+  <!-- =================================================================== -->
+  <!-- Set some the defaults the user can override in .ant.properties      -->
+  <!-- =================================================================== -->
+  <property name="build.compiler" value="modern"/>
+  <property name="build.compiler.emacs" value="on"/>
+
+  <!-- =================================================================== -->
+  <!-- Define a global set of patterns that can be referenced by           -->
+  <!-- its id attribute                                                    -->
+  <!-- =================================================================== -->
+  <patternset id="chmod.patterns">
+    <include name="**/antidote" />
+  </patternset>
+
+  <!-- =================================================================== -->
+  <!-- Prepares the build directory                                        -->
+  <!-- =================================================================== -->
+  <target name="prepare">
+    <mkdir dir="${build.dir}"/>
+    <mkdir dir="${ant.build.dir}"/>
+    <tstamp />
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Compiles the source code                                            -->
+  <!-- =================================================================== -->
+  <target name="compile" depends="prepare">
+    <mkdir dir="${build.classes}"/>
+
+    <javac srcdir="${src.dir}"
+           destdir="${build.classes}"
+           debug="on"
+           deprecation="on"
+           optimize="off" >
+      <classpath refid="classpath" />
+    </javac>
+ 
+    <copy todir="${build.classes}">
+      <fileset dir="${src.dir}">
+        <include name="**/*.properties" />
+        <include name="**/*.gif" />
+      </fileset>
+    </copy>
+
+    <filter token="VERSION" value="${version}" />
+    <filter token="DATE" value="${TODAY}" />
+    <filter token="TIME" value="${TSTAMP}" />
+    <copy    todir="${build.classes}" 
+             overwrite="true"
+             filtering="on">
+      <fileset dir="${src.dir}">
+        <include name="**/version.txt" />
+      </fileset>
+    </copy>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Creates the jar archive                                             -->
+  <!-- =================================================================== -->
+  <target name="jar" depends="compile">
+    <mkdir dir="${lib.dir}"/>
+    <jar jarfile="${lib.dir}/${name}.jar"
+         basedir="${build.classes}"
+         includes="org/**"
+         manifest="${manifest}"
+    />
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Creates the binary structure                                        -->
+  <!-- =================================================================== -->
+  <target name="main" depends="jar" description="Creates the binary structure">
+     <mkdir dir="${bin.dir}"/>
+     <copy todir="${bin.dir}">
+       <fileset dir="${src.bin.dir}"/>
+     </copy>
+     <chmod perm="+x">
+       <fileset dir="${bin.dir}">
+         <patternset refid="chmod.patterns"/>
+       </fileset>
+     </chmod>
+     <fixcrlf srcdir="${bin.dir}" includes="antidote" cr="remove"/>
+     <fixcrlf srcdir="${bin.dir}" includes="*.bat" cr="add"/>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Creates the API documentation                                       -->
+  <!-- =================================================================== -->
+  <target name="javadocs" depends="prepare" description="Creates the API documentation">
+    <mkdir dir="${build.javadocs}"/>
+    <javadoc packagenames="${packages}"
+             sourcepath="${basedir}/${src.dir}"
+             destdir="${build.javadocs}"
+             author="true"
+             private="true"
+             version="true"
+             windowtitle="${Name} API"
+             doctitle="${Name}"
+             bottom="Copyright &#169; 2000 Apache Software Foundation. All Rights Reserved.">
+      <group title="Antidote" packages="org.apache.tools.ant.gui*" />
+    </javadoc>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Creates the distribution                                            -->
+  <!-- =================================================================== -->
+  <target name="dist" depends="main,jar,javadocs" description="Creates the distribution">
+     <mkdir dir="${ant.dist.dir}"/>
+     <mkdir dir="${ant.dist.dir}/bin"/>
+     <mkdir dir="${ant.dist.dir}/lib"/>
+     <mkdir dir="${ant.dist.dir}/docs"/>
+     <mkdir dir="${ant.dist.dir}/docs/api"/>
+     <mkdir dir="${ant.dist.dir}/src"/>
+
+     <copy todir="${ant.dist.dir}/src">
+       <fileset dir="${src.dir}"/>
+     </copy>
+     <copy todir="${ant.dist.dir}/lib">
+       <fileset dir="${lib.dir}"/>
+     </copy>
+
+     <copy todir="${ant.dist.dir}/bin">
+       <fileset dir="bin"/>
+     </copy>
+     <copy todir="${ant.dist.dir}/docs">
+       <fileset dir="${docs.dir}"/>
+     </copy>
+     <copy todir="${ant.dist.dir}/docs/api">
+       <fileset dir="${build.javadocs}"/>
+     </copy>
+
+     <fixcrlf srcdir="${ant.dist.dir}/bin" includes="antidote" cr="remove"/>
+     <fixcrlf srcdir="${ant.dist.dir}/bin" includes="*.bat" cr="add"/>
+     <chmod perm="+x">
+       <fileset dir="${ant.dist.dir}/bin">
+         <patternset refid="chmod.patterns"/>
+       </fileset>
+     </chmod>
+
+     <copy file="README" tofile="${ant.dist.dir}/README"/>
+     <copy file="WHATSNEW" tofile="${ant.dist.dir}/WHATSNEW"/>
+     <copy file="TODO" tofile="${ant.dist.dir}/TODO"/>
+     <copy file="LICENSE" tofile="${ant.dist.dir}/LICENSE"/>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Packages the distribution with ZIP                                  -->
+  <!-- =================================================================== -->
+  <target name="dist-zip" depends="dist">
+    <zip zipfile="${Name}-${version}.zip" basedir="${ant.dist.dir}" includes="**"/>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Packages the distribution with TAR-GZIP                             -->
+  <!-- =================================================================== -->
+  <target name="dist-tgz" depends="dist">
+    <tar tarfile="${Name}-${version}.tar" basedir="${ant.dist.dir}" includes="**"/>
+    <gzip zipfile="${Name}-${version}.tar.gz" src="${Name}-${version}.tar"/>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Cleans up generated stuff                                           -->
+  <!-- =================================================================== -->
+  <target name="clean">
+    <delete dir="${build.dir}"/>
+    <delete dir="${ant.dist.dir}"/>
+  </target>
+
+  <!-- =================================================================== -->
+  <!-- Total cleanup                                                       -->
+  <!-- =================================================================== -->
+  <target name="total-clean" depends="clean">
+    <delete dir="${bin.dir}"/>
+    <delete file="${lib.dir}/${name}.jar"/>
+    <delete file="${Name}-${version}.zip"/>
+    <delete file="${Name}-${version}.tar"/>
+    <delete file="${Name}-${version}.tar.gz"/>
+  </target>
+
+
+</project>
+
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/design-overview.html b/jakarta-ant-1.2-src/src/antidote/docs/design-overview.html
new file mode 100644
index 0000000..4436afc
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/docs/design-overview.html
@@ -0,0 +1,253 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "strict.dtd">
+<HTML> 
+  <HEAD> 
+     <TITLE>Antidote Design Overview</TITLE> 
+  </HEAD> 
+
+  <BODY> 
+
+    <H1>Antidote Design Overview</H1>
+
+    <P>Version 0.2 (2000/12/18)</P>
+
+    <P>Authors: 
+    <A HREF="mailto:simeon@fitch.net">Simeon H.K. Fitch</A>
+    </P>
+
+    <H2>Introduction</H2> 
+
+    <P>The purpose of this document is to communicate the overall
+    structure and design patters used in Antidote, the GUI for
+    Ant. This document is a work in progress, as well as a living
+    document, and it is most likely not be in full synchronization with
+    the source code. Therefore, if there is any doubt, view the source
+    ;-)</P>
+
+    <H2>Overview</H2>
+    
+    <P>The Antidote architecture design aims to provide a high level
+    of modularity and extensibility. Ideally the components of
+    Antidote will be able to be assembled in different configurations
+    to provide the type of application or plug-in desired.</P>
+
+    <P>To acheive this modularity, a high level of decoupling is
+    necessary. The standard UI design approach of providing separation
+    of view (presentation) from model (data) is applied, leveraging
+    the built-in Ant data model where possible, as well as the
+    predifined Swing model interfaces. Furthermore, the architecture
+    is highly event driven, whereby modules communicate via a shared
+    communications channel.</P>
+    
+    <P>To a large extent, the configuration of application modules is
+    driven by localized configuration files, allowing new modules or
+    data views to be added, as well as providing multi-language
+    support.</P>
+
+    <P>The diagram below conveys a high altitude view of the
+    application's structure. As the application grows, new components
+    will be plugged in to what will be described as the <TT>EventBus</TT>.
+
+    <TT><PRE>
+
+Antidote Component Architecture
+
+   +---------------+ +----------------+ +-------------+ +-------------+
+   |               | |                | |             | |             |  
+   | ActionManager | | EventResponder | |  AntModule  | |  AntModule  |
+   |               | |                | |(ProjectNav) | |(SourceEdit) |  
+   +---------------+ +----------------+ +-------------+ +-------------+
+           |                  ^               ^               ^
+           |                  |               |               |
+      ActionEvent         EventObject      AntEvent       AntEvent
+           |                  |               |               |
+           v                  v               v               v
+  /---------------------------------------------------------------------\
+ /                                                                       \
+<                                   EventBus                              >
+ \                                                                       /
+  \---------------------------------------------------------------------/
+           |                  ^               ^               ^
+           |                  |               |               |
+      EventObject         ChangeEvent      BuildEvent     EventObject
+           |                  |               |               |
+           v                  |               |               v
+   +---------------+ +----------------+ +-------------+ +--------------+
+   |               | |                | |             | |              |  
+   |   Console     | |  ProjectProxy  | |    Ant      | | (Your Module)|
+   |               | |                | |             | |              |  
+   +---------------+ +----------------+ +-------------+ +--------------+
+
+    </TT></PRE>
+
+    <H2>Event Bus</H2>
+
+    <P>The backbone of the application is the <TT>EventBus</TT>. Any
+    component of the application can post events to the
+    <TT>EventBus</TT>. Components that wish to receive events are
+    called <TT>BusMember</TT>s.</P>
+
+    <P>The <TT>EventBus</TT> will dispatch any object of type
+    <TT>java.util.Event</TT>, which means that Ant <TT>BuildEvent</TT>
+    objects, as well as <TT>AWTEvent</TT> objects can be posted (if desired). A
+    new class of events called <TT>AntEvent</TT> is defined for Antidote
+    specific events, which have the additional capability of being
+    cancelled mid-dispatch.</P>
+
+    <P>Each <TT>BusMember</TT> must provide a <TT>BusFilter</TT> instance,
+    which is the members' means of telling the bus which
+    events it is interested in. This allows a <TT>BusMember</TT> to,
+    say, only receive <TT>AntEvent</TT> objects.</P>
+
+    <P>When a <TT>BusMember</TT> registers itself with the
+    <TT>EventBus</TT>, it must provide a (so called) <I>interrupt
+    level</I> which is a integer value defining a relative ordering
+    for dispatching <TT>EventObject</TT>s to <TT>BusMember</TT>s. The
+    purpose of this is to allow certain <TT>BusMember</TT> instances
+    to see an event before others, and in the case of <TT>AntEvent</TT
+    objects, keep the event from propogating onward. The
+    <TT>EventBus</TT> class defines the interrupt level constants
+    <TT>VETOING=1</TT>, <TT>MONITORING=5</TT>, and <TT>RESPONDING=10</TT> to
+    help define categories of members. The implied purpose being that:
+    <UL>
+
+      <LI><TT>VETOING</TT>: Listens for certain types of events, and
+      may process them in a non-default manner to determine if the
+      event should be cancelled before being dispatched to the
+      <TT>RESPONDING</TT> group. 
+
+      <LI><TT>MONITORING</TT>: Just listens for events, like a logger
+      or status monitor.</LI>
+
+      <LI><TT>RESPONDING</TT>: Process events in a default manner,
+      knowing that the event has passed any <TT>VETOING</TT> members.</LI>
+
+    </UL>
+
+    Within a specific interrupt level, the order in which members will
+    receive events is undefied. A <TT>BusMember</TT> may be registered
+    at a level that is +/- of one of the defined levels, as long as it
+    follows the constraint <TT>MONITORING <= interruptLevel <=
+    MAX_INTERRUPT</TT>.</P>
+
+
+    <H2>Actions and ActionManager</H2>
+
+    <P>Extensive use of the <TT>javax.swing.Action</TT> interface is
+    made for defining the set of menu and tool bar options that are
+    available. The configuration file <TT>action.properties</TT>
+    exists to define what should appear in the menu and toolbar, how
+    it is displayed, and the <TT>Action</TT> command name that is
+    dispatched when the user invokes that action. A class called
+    <TT>ActionManager</TT> exists for not only processing the
+    configuration file, but also for dispatching invoked action events
+    to the <TT>EventBus</TT>, and for controlling the enabled state of
+    an <TT>Action</TT>. When a new menu item or toolbar button is
+    desired, first it is added to the <TT>action.properties</TT> file,
+    and then the code to respond to it is added to the
+    <TT>EventResponder</TT> (see below).
+
+
+    <H2>Commands and EventResponder</H2> 
+
+    <P>At some point in the stages of event processing, an event may
+    require the data model to be modified, or some other task be
+    performed. The <TT>Command</TT> interface is defined to classify
+    code which performs some task or operation. This is distinct from
+    an <TT>Action</TT>, which is a user request for an operation. A
+    <TT>Command</TT> class is the encapsulation of the operation
+    itself.</P>
+
+    <P>When an <TT>Action</TT> generates an <TT>ActionEvent</TT>, the
+    event is posted to the <TT>EventBus</TT> which delivers the event
+    to all interested <TT>BusMember</TT>s. It eventually makes it to
+    the <TT>EventResponder</TT> instance (registered at the
+    <TT>RESPONDING</TT> interrupt level), which is responsible for
+    translating specific events into <TT>Command</TT> objects, and
+    then executing the <TT>Command</TT> object. For example, when the
+    user selects the "Open..." menu option, an <TT>ActionEvent</TT> is
+    generated by the Swing <TT>MenuItem</TT> class, which is then
+    posted to the <TT>EventBus</TT> by the <TT>ActionManager</TT>. The
+    <TT>ActionEvent</TT> is delivered to the <TT>EventResponder</TT>,
+    which converts the <TT>ActionEvent</TT> into a <TT>Command</TT>
+    instance. The <TT>EventResponder</TT> then calls the method
+    <TT>Command.execute()</TT> to invoke the command (which displays a
+    dialog for selecting a file to open).</P>
+
+    <P>When adding new <TT>Action</TT>s or general tasks to the
+    application, a <TT>Command</TT> object should be created to
+    encapsulate the behavior. This includes most operations which
+    modify the state of the data model.</P>
+
+    <P>The purpose of this encapsulation is to allow the clean
+    separation of making a request, and servicing a request. Due to
+    various conditions in the application state, the actualy response
+    to a request may change, as well as who services it. This
+    design approach facilitates that.</P>
+
+    <H2>Data Model and Views</H2>
+
+    <P><I>NB: This part of the architecture is not fleshed out very well. There
+    needs to be a discussion of the degree to which the Antidote development
+    should be able to impose changes on the Ant data model, and to what level
+    that model should be mirrored in the Antidote code base. The coupling
+    between them should be kept low, and at the same time changes to one should
+    affect the other minimally. Still, features like property change events and
+    bean introspection (or BeanInfo) may be needed to be added to the Ant data
+    model. Right now the data model is encapsulated in the package
+    <TT>org.apache.tools.ant.gui.acs</TT> (where "<TT>acs</TT>" stands for "Ant
+    Construction Set").</I></P>
+
+    <H2>Application Context</H2>
+
+    <P>In order to keep the coupling amoung application modules to a
+    minimum, a single point of reference is needed for coordination
+    and data sharing. The class <TT>AppContext</TT> is the catch-all
+    class for containing the application state. Most modules and
+    <TT>Command</TT> classes require an instance of the
+    <TT>AppContext</TT> class. Because all state information in
+    contained in an <TT>AppContext</TT> instance, multiple instances
+    of Antidote can run inside the same JVM as long as each has it's
+    own <TT>AppContext</TT>. (Interestingly, two instances of the
+    Antidote could conceivably share an <TT>AppContext</TT> instance
+    through RMI, allowing remote interaction/collaboration.)</P>
+
+    <H2>Configuration and ResourceManager</H2>
+    
+    <P>Full "i18n" support should be assumed in modern applications,
+    and all user viewable strings should be defined in a configuration
+    file. For Antidote this configuraiton file is
+    <TT>antidote.properties</TT>, which is located (with other UI
+    resources) in the subpackage "resources".</P>
+
+    <P>To aid in the lookup of text properties, as well as other
+    resources like icons, a class called <TT>ResourceManager</TT> is
+    defined. There are various convenience methods attached to this
+    class, which will likely grow to make looking up configuration
+    values as easy as possible.</P>
+
+    <P>The organization of configuration properties is based on the
+    fully qualifed path of the class that requires the property. For
+    example, the "about" box contains a messages, so it looks for the
+    property "<TT>org.apache.tools.ant.gui.About.message</TT>" for the text
+    message it should display. Therefore, the <TT>ResourceManager</TT>
+    method <TT>getString()</TT> takes a <TT>Class</TT> instance as
+    well as a <TT>String</TT> key. Please see the
+    <TT>ResourceManager</TT> documentation for more information. Given
+    this support, no user visible strings should appear in the source
+    code itself.</P>
+
+    <H2>Other Resources</H2>
+    
+    <P>Other information about development on Antidote:</P>
+    <UL>
+      <LI><A HREF="uml/index.html">Antidote UML Static Class Diagrams</A></LI>
+      <LI><A HREF="gui-requirements.html">Antidote Feature Wishlist</A></LI>
+      <LI><A HREF="new-module-howto.html">Antidote Module HOWTO</A></LI>
+    </UL>
+
+    <HR>
+    <P ALIGN="center">Copyright &copy; 2000 Apache Software Foundation. All
+    rights Reserved.</P>
+
+  </BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/gui-ideas.txt b/jakarta-ant-1.2-src/src/antidote/docs/gui-ideas.txt
new file mode 100644
index 0000000..7d19005
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/docs/gui-ideas.txt
@@ -0,0 +1,335 @@
+(NOTE: the following text is a vision for an Ant GUI by Stefan Vaillant
+<mailto:Stephan.Vaillant@nokia.com> called Anttool. It is included here in the
+Antidote docs section as it provides a better vision for what the GUI should be
+than the current requirements document, and should be considered an integral
+part of the long-term plans for Antidote. Simeon Fitch)
+
+
+-----------------------------------------------------------------------
+
+********************
+**Anttool Proposal**
+********************
+
+By: Stefan Vaillant <mailto:Stephan.Vaillant@nokia.com>
+
+-----------------------------------------------------------------------
+
+Anttool Overview:
+-----------------
+
+With Anttool a user can manage the build process for existing ant build files.
+By using the grafical user interface, the user can adjust certain properties to
+his environment, start and cancel builds, monitor their progress and call
+appropiate programs to fix problems.  It is not possible to modify the build
+file. Instead, an external XML editor or antidote should be used.
+
+
+For inexperienced users, the tool provides an easy and efficient way to install
+open source software: load software to the local system, build it and install
+it.  The tool can be used without any knowledge of XML or the ant DTD.  Instead,
+the user just adjusts the relevant properties to his environment and starts the
+build.
+
+For programmers, the tool supports the basic build/test/edit cycle.  Given an
+existing ant build file, the programmer can use the grafical user interface to
+execute individual targets, browse the effects of the build and start editors to
+fix problems that occured during the build.
+
+
+I general, anttool is ment for users who see the build file as a black-box: They
+are not primarily interested in the internal structure of the build file nor in
+modifiying it.  Instead, they want to call ant with the appropiate arguments and
+want to see, what is the result of the build.
+
+Therefore, anttool only shows targets and properties that are relevant for these
+users. Tasks are not shown at all.
+
+
+Anttool User Interface:
+-----------------------
+
+The user interface of anttool is devided into two panels: The "Control Panel"
+shows all loaded build files and their targets.  The "Project Panel" shows
+details for one project, including the logging information from the last
+build(s), the editable properties of an build and relevant files of that build.
+
+By default, the user interface does not show targets or properties that have no
+description or a descriuption starting with a ".".  These targets or properties
+are called "hidden" in the following text.
+
+
+The Control Panel:
+------------------
+
+The Control Panel shows a tree with all loaded projects.  For each project the
+non-hidden targets are shown.  (Anttool can be configured to show also hidden
+targets, see Configuration below).
+
+If you move the cursor over a project or target, a description for it will be
+shown as a tooltip.
+
+Two icons are prefixing the name of the project or target: one is visualizing
+the state of the project or target, the other is a button to start or cancel the
+project or target.  The state icon can have the following different colors:
+	- green if the execution was successfull.
+	- yellow if an execution is needed because the output files are
+      out-of-date [not possible with current ant version?]
+	- red if the execution resulted in errors.
+	- white (i.e. nothing) if the state is unknown
+[Alternative: what about buttons labeled with the target name?
+ The button is used for start/stopping the build.
+ No tree required then. ]
+
+	
+If you select a node in the tree, the Project Panel (see below) will show
+details for the relevant project.
+
+If you right-click on a node in the tree, a pop-up menu will show the following
+commands:
+	edit: open XML editor at selected element
+	open: in new window  [? is that needed]
+		
+		
+The Project Panel:
+------------------
+
+The Project Panel consists of three tabs: 
+
+The "Build Log" tab shows information about the last build(s), the "Properties"
+tab shows non-hidden properties and the "Files" tab shows files relevant for the
+project.
+
+The Build Log Tab:
+
+In this tab you can monitor the build on detail.  A tree shows the executed
+targets of a build, their tasks and log messages for each task.  The start time
+is noted after the build name.
+
+In the pop-up menu, you can choose from the following commands:
+		edit: open editor for shown file at shown location.
+		show log level->Error/Warning/Info/Verbose/Debug
+			(only the items possible are shown,
+			 see configuration.)
+
+The Properties Tab:
+
+The properties tab shows all non-hidden properties of the project.  (optionally,
+also hidden properties can be shown, see Configuratin below.)
+
+Each Property is shown as follows:
+	<Name>: <entry field>     <reset checkbox>
+where
+       	<Name> is name of the property, with "." and "-" replaced by " "
+	and first letters capatilized.
+	<entry field> is a text field to enter a value for the properts.
+	In some cases, special benas are shown:
+		Name ends with ".dir"	=> provide a file chooser to select a directory
+		Name ends with ".lib"   => provide a file chooser to select .jar file
+		Name is "build.compiler" => provide combo box with possible compilers.
+			[selecting JDK's seems not well support in ant?
+			 If you have e.g. JDK 1.2.1 and 1.2.2 installed,
+	 		 how to easily select the compiler version?]
+		Name ends with ".jdk"   => let the user select one of the configures
+JDK's
+			[more general then build.compiler, but supported by ant?]
+		Name ends with ".file"  => provide a file chooser
+	<reset checkbox> resets the value to the (default) value that is
+contained in the .xml file
+
+All values entered are save in a file
+$HOME/.ant/<full-path-build-file>.property.  (See also Configuration.)
+
+If property values are changed, then ant is called with
+main("-Dproperty1=value1 ..").
+	
+[show also (class)pathes as property, use id instead of name?  But: is that
+ required? Why not simply define individual properties for the required
+ libraries and combine them then to a path.  ]
+		
+
+	
+The File Set Tab:
+
+This tab show files that are releated to the project.  For each non-hidden
+fileset of the project, the id of the fileset is shown and all files included to
+that fileset.
+
+If you right-click on a file, a pop-up menu is shown with which you can start
+programs to deal with these files.  The relevant configuration information is
+extracted from the existing operation system settings.
+
+[or: one tab for each fileset?] 
+
+Repository:
+-----------
+
+[This needs some more work.]
+
+Anttool also simplyfies the loading of source files form the web.  By using the
+repository mechanism of anttool, you can perform the complete workflow from
+download to install with just a few mouse clicks:
+
+	select one out of the Repositories from the main menu.
+		Anttool will query the server for a list of up-to-date
+		packages.
+		
+	select one of the presented packages
+		Anttool will then download the selected package:
+		In case a .zip (or similar) package was selected,
+		the file is downloaded and
+		unpacked to "/Users/"<name>.
+		In case a CVS repository was selected, 
+		the files are downloaded to "/Users/"<name>.
+		
+		Afterwards
+		a file with the name "build.xml" is searched 
+		and loaded to anttool.
+		Optionally, the file "$HOME/.ant/default.properties"
+		is copied to "$HOME/.ant/<full-path-build-file>.properties,
+		overwriting the defaults in the downloaded build file
+		with your preferences (e.g. installation directory, JDK, ...)
+		[copy only relevant properties?]		
+
+	check if the properties in the selected project match your intention.
+
+	press "start" on the project
+		
+
+Anttool Configuration:
+-----------------------
+
+The menu "Tools" in the menu bar allows you to adjust Anttool behavior to your
+preferences and environment.
+
+The following menu entries are available:
+
+Configure JDKs:
+	Can be used to configure the JDKs available
+	on your system. The configured values are offered
+	for properties that end with ".jdk".
+	
+	The screen offers a table to edit a set of names
+	and pathes.
+	By pressing "rescan" the system is scanned for new JDKs
+	by consulting the installed software.
+
+	[Should there be one combo box
+		Anttool JDK:   <internal|JDK list|....>
+	 that indicates the JDK that should be used to run ant?
+	 Should that be even project specific setting?
+	]
+
+Configure Repository: [better name?]
+	Anttool is aware of certain places where Anttool supporting software
+	can be found on the internet.
+	These URLs can be configured here.
+	These repositories are offered to the user when he selects 
+	the "Repository" menu in the menu bar.
+
+	The screen offers a table to edit a set of names
+	and URLs.
+
+Configure Libraries:
+	Can be used to configure the libraries available
+	on your system. The configured values are offered
+	for properties that end with ".lib".
+	
+	The screen offers a table to edit a set of names
+	and pathes.
+	By pressing "rescan" the system is scanned for new libraries
+	by searching below a directory.
+
+
+Preferences:
+	show hidden targets: bool 
+		[or: offer addition menu to start hidden targets?]
+	show hidden filesets: bool
+	show hidden properties: bool	
+
+	log level used for build: ...
+	number of log files saved: 
+	number of log files shown in UI:
+
+	Directory to save property values:
+
+	file name remembered in file menu: 
+
+	checkig for new files in filesets: [seconds]	
+	autoload new buildfile: [seconds, 0= never]
+
+
+General features:
+-----------------
+The menubar menu's are 
+	File
+		Open...
+		Close
+		-------
+		1 buildfile.xml
+		2 ....
+		3 ...
+		------
+		Exit
+	Repository
+		Apache...		as configured
+		<name2>...	        
+		....	      	
+	Options
+		Configure JDKs...
+		Configure Repository...
+		Configure Libraries...
+		Preferences...
+		Look&Feel...
+	Help
+		Antool Help...
+		Ant Web Home		calls netscape
+		-----------
+		About...
+
+
+Build files can be dragged and dropped into anttool.	
+
+The set off loaded build files should be saved on exit and
+reloaded on restart automatically.
+
+
+
+Technical questions on the internals of anttool
+-----------------------------------------------
+- How to detect if a target needs to be run (yellow color)?
+  Seems not be possible currently.
+  One solution [what will ant 2.0 contain?]:
+	Define new abstract class "MonitoredTask", inherited from Task.
+	Copy, Javac, javadoc, etc inherit from these.
+	MonitoredTask defines:
+		execute() { prepareTask(); if (executionNeeded) { perform() }; }
+		executionNeeded: boolean // signals that I need to run because output is
+older than input
+		perform()
+		performMap() // what will happen with each file, i.e.
+				Main.java  -> Main.class
+				UI.java    -> UI.class
+				...
+			     or
+			        Main.class -> lib.jar
+				UI.class   -> lib.jar
+			     size of Map should be equal to number of steps reported in loggin.
+
+  Only "executionNeeded" is required to add a yellow flag for targets.  The
+  performMap would be nice to have. It could be used later to show a finegrained
+  graph (or matrix) about what is happening during a build.
+
+  Add configuration item on how often call the funtions (i.e. how often to do
+  the polling.)
+	
+- How to do the calling of the external tools?
+	XML editor? (how to generate the dtd? How to execute "antstructure"
+    withour changing the build file.)
+	How to simulate the windows functionality for e.g. open java source with
+    JBuilder?
+		How to read the registry information?
+		How to do DDE calls?
+
+- is there any free installation tool for java?
+	(to install anttool itself)
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/gui-requirements.html b/jakarta-ant-1.2-src/src/antidote/docs/gui-requirements.html
new file mode 100644
index 0000000..079684a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/docs/gui-requirements.html
@@ -0,0 +1,250 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "strict.dtd">
+<HTML> 
+  <HEAD> 
+	 <TITLE>Ant GUI Feature List</TITLE> 
+  </HEAD> 
+  <BODY> 
+    <H1>Ant GUI Feature List</H1>
+    <P>Version 0.4 (2000/11/06)</P>
+    <P>Authors: 
+    <A HREF="mailto:simeon@fitch.net">Simeon H.K. Fitch</A>,
+    <A HREF="mailto:chris@christophertodd.com">Chris Todd</A>,
+    <A HREF="mailto:clint.combs@contrado.com">Clint Combs</A>,
+    <A HREF="mailto:conor@ebinteractive.com.au">Conor MacNeill</A>,
+    <A HREF="mailto:matthew.k.heun@gaerospace.com">Matthew Kuperus Heun</A>,
+    <A HREF="mailto:duncan@x180.com">James Duncan Davidson</A>
+    
+    
+    <P>The purpose of this document is to capture the proposed feature list for
+    the Ant Graphical User Interface. This is not a hard requirements
+    specification; you won't find the word "shall" in it (other than that one
+    time). :-)</P>
+
+    <P>In general, the purpose of the GUI is to allow the quick generation and
+    modification of Ant build files, helping the user define their build process
+    and track down build problems. For it to be successful it must make the user
+    more efficient and productive, insofar as their involvement in build
+    management and use of Ant goes. It should first address the needs of the
+    novice Ant user, and then add abilities for the "power" user. This does not
+    imply that the UI should be "dumbed down", it just means that usability
+    should come before slick but complicated features.</P>
+
+    <P>The features are in a loose order of expressed interested by
+    contributors.</P>
+
+    <!-- Section List -->
+    <OL TYPE="A">
+
+
+      <LI><H2>Build Management</H2></LI>
+      <P>Once a build file is created, the user will want to start and
+      stop it from the UI. This will serve both as a testing facility as well as
+      a general compile tool. Monitoring of the build can occur through the Ant
+      BuildListener interface.</P>
+      <OL>
+        <LI>Build execution.</LI>
+        <OL TYPE="a">
+          <LI>Initiate a build starting from any task.</LI>
+          <LI>Stop a currently active build.</LI>
+        </OL>
+        <LI>Build monitoring.</LI>
+        <OL TYPE="a">
+          <LI>Provide feedback on the current status of the build.<BR>
+          <I>This is where you can have more fun with the directed graph view,
+          where the current build activity is highlighted on the screen, making
+          the whole thing behave like a dynamic state transition diagram. You
+          can then highlight the node where the build fails, etc.</I></LI>
+          <LI>Show log messages from the build, allowing the user to determine
+          the task they originated from.</LI>
+          <LI>Provide the ability to filter logged messages, adn to display the
+          messages in color codes corresponding to logging levels.</LI>
+          <LI>Allow the installation of custom log listeners</LI>
+          <LI>Record runtime statistics to determine bottleneck in the build
+          process<BR>
+          <I>This may be of limited use, as calling &lt;javac&gt; probably takes
+          the most time. But maybe not.</I></LI> 
+        </OL>
+      </OL>
+      <BR>
+
+      <LI><H2>Build Wizard (auto-configure)</H2></LI>
+      <P>To make starting a new project with Ant as easy as possible, the a
+      wizard type of UI can be used where the user provides some basic
+      information and the application deduces what a default build.xml file for
+      it should look like.</P>
+      <OL>
+        <LI>Project attributes.</LI>
+        <OL TYPE="a">
+          <LI>Provide input for the required project attributes.<BR>
+          <I>This probably means project name and default target.</I></LI>
+        </OL>
+        <LI>Project directories.</LI>
+        <OL TYPE="a">
+          <LI>Ask for the source directory.</LI>
+          <LI>Ask for the destination directory.</LI>
+          <LI>Ask for the necessary JAR files.</LI>
+        </OL>
+        <LI>Project properties.</LI>
+        <OL TYPE="a">
+          <LI>Provide a default set of project properties.<BR>
+          <I>In here would be things like classpath, build.compiler, version,
+          etc.</I></LI>
+          <LI>Allow the user to add to or remove from properties the default set
+          of properties.</LI>
+        </OL>
+        <LI>Task creation</LI>
+        <OL TYPE="a">
+          <LI>Provide a list of "standard" tasks to insert into the project.<BR>
+          <I>This would be tasks like &lt;javac&gt; and
+          &lt;javadoc&gt;.</I></LI>
+          <LI>Generate default init, compile, javadoc, and clean targets.</LI>
+        </OL>
+        <LI>Creation review.</LI>
+        <OL TYPE="a">
+          <LI>Provide a review of the contents of the generated build.xml
+          file.</LI>
+          <LI>Allow the user to go back to any step in the process to change a
+          setting.</LI> 
+          <LI>Prompt the user to save the build.xml file.</LI>
+        </OL>
+      </OL>
+      <BR>
+
+
+      <LI><H2>IDE Integration</H2></LI>
+      <P>Components of the Ant GUI shoule support plugging into IDEs and code
+      editors.</P>
+      <OL>
+        <LI>Emacs</LI>
+        <OL TYPE="a">
+          <LI>Provide support for launching builds from emacs, and notification
+          of errors.</LI>
+        </OL>
+        <LI>JEdit</LI>
+        <OL TYPE="a">
+          <LI>Provide JEdit plug-in.</LI>
+        </OL>
+        <LI>ProjectBuilder</LI>
+        <OL TYPE="a">
+          <LI>Provide integration with OSX ProjectBuilder.</LI>
+        </OL>
+        <LI>NetBeans</LI>
+        <OL TYPE="a">
+          <LI>Provide integration with the NetBeans IDE.</LI>
+        </OL>
+      </OL>
+      <BR>
+
+
+      <LI><H2>Project Editing</H2></LI>
+      <P>The Ant UI will be centered around the project file. All operations of
+      the UI will be on a project, whether it be existing or new. <I>How
+      sub-projects are handled (i.e. via the &lt;ant&gt; task) needs to be
+      determined.</I></P>
+      <OL>
+        <LI>Load a project.</LI>
+        <OL TYPE="a">
+          <LI>Read the native Ant XML format as defined by the Ant users'
+          manual.</LI>
+          <LI>When possible, automatically handle changes in the Ant element
+          set, or at least changes to the task set, as well as the valid set of
+          attributes.<BR>
+          <I>Possible approach: load "default.properties", use
+          introspection to discover attribute set, then reference some other
+          mechanism for attributes that are manifested as properties.</I>
+          </LI>
+          <LI>Report errors in the XML source.</LI> 
+          <LI>Provide a list of recently opened documents for 
+          quick reloading.</LI>
+        </OL>
+        <LI>View project contents.</LI>
+        <OL TYPE="a">
+          <LI>View the project in it's XML source format.</LI>
+          <LI>View the project in a non-source format.<BR>
+          <I>This is left ambiguous to keep the implementation out of the
+          requirements. The different presentation formats are likely to evolve
+          over time.</I>
+          </LI>
+          <LI>View the project properties.</LI>
+          <LI>View the project contents (tasks).</LI>
+        </OL>
+        <LI>Modify a project.</LI>
+        <OL TYPE="a">
+          <LI>Edit via the XML source.</LI> 
+          <LI>Edit properties via a property sheet.</LI>
+          <LI>Provide facility for editing XML references used in the build
+          file.</LI> 
+        </OL>
+        <LI>Save a project.</LI>
+        <OL TYPE="a">
+          <LI>Save to the native Ant XML format as defined by the Ant users'
+          manual.</LI> 
+          <LI>Default save name is "build.xml".</LI>
+          <LI>Verify before overwriting existing file when in "Save as"
+          mode.</LI> 
+        </OL>
+        <LI>Create a new project.</LI>
+        <OL TYPE="a">
+          <LI>Define a project name.</LI>
+          <LI>Define the default target.</LI>
+          <LI>Define the project base directory.</LI>
+        </OL>
+      </OL>
+      <BR>
+
+
+      <LI><H2>Task Editing</H2></LI>
+      <P>Tasks define what it is that Ant is to do, and will be the object most
+      edited in the UI. <U>Task</U> <I>is to</I> <U>Paragraph</U> <I>as</I>
+      <U>Project</U> <I>is to</I> <U>Document</U>.  
+      <OL>
+        <LI>View tasks.</LI>
+        <OL TYPE="a">
+          <LI>View a sorted list of tasks.<BR>
+          <I>Provide sorting based on name, depth in dependency tree, how many
+          tasks depend in it...</I></LI>
+          <LI>View tasks as a directed graph.<BR>
+          <I>Need a good graph editing library. Looked at <A
+          HREF="http://gef.tigris.org">GEF</A> but it still needs a lot of
+          work, to make it easily reusable. Long term status unknown.</I></LI>
+          <LI>View tasks as a dependency tree.</LI>
+          <LI>View task as a properties sheet.</LI>
+          <LI>Provide dependency viewing, both immediate and "flattened"
+          views.</LI> 
+        </OL>        
+        <LI>Modify task.</LI>
+        <OL TYPE="a">
+          <LI>Allow editing of a task via a property sheet.</LI>
+          <LI>Allow editing of a task via XML source.</LI>
+          <LI>Allow the graphical editing of task dependencies<BR>
+          <I>This is where you can go hog wild with the component wiring type of
+          UI. </I></LI>
+          <LI>Allow non-graphical editing of dependencies.</LI>
+          <LI>Provide detection of circular dependencies.</LI>
+          <LI>Facilitate definition of conditional tasks with evaluation
+          editor.</LI> 
+        </OL>
+      </OL>
+      <BR>
+
+      <LI><H2>Build File Source Editing</H2></LI>
+      <P>This section listes desired features for editing the Ant build file
+      directly. Some components of this could be met by a generic XML editing
+      capability, but other parts will be Ant specific features.</P>
+      <OL>
+        <LI>XML Editor.</LI>
+        <OL TYPE="a">
+          <LI>Provide syntax higlighting.</LI>
+          <LI>Provide auto-indentation.</LI>
+          <LI>Provide smart tag completion.</LI>
+          <LI>Provide visual highlighting of syntax errors.</LI>
+          <LI>Support auto-reparsing of contents and model update.</LI>
+        </OL>
+    </OL>
+
+    <HR>
+    <P ALIGN="center">Copyright &copy; 2000 Apache Software Foundation. All
+    rights Reserved.</P>
+
+  </BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/new-module-howto.html b/jakarta-ant-1.2-src/src/antidote/docs/new-module-howto.html
new file mode 100644
index 0000000..db01408
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/docs/new-module-howto.html
@@ -0,0 +1,89 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "strict.dtd">
+<HTML> 
+  <HEAD> 
+     <TITLE>Antidote New Module HOWTO</TITLE> 
+  </HEAD> 
+
+  <BODY> 
+
+    <H1>Antidote New Module HOWTO</H1>
+
+    <P>Version 0.1 (2000/12/18)</P>
+
+    <P>Authors: 
+    <A HREF="mailto:simeon@fitch.net">Simeon H.K. Fitch</A>
+    </P>
+
+    <H2>Introduction</H2> 
+    
+    <P>The purpose of this document is to provide an overview of the
+    basic steps one must undertake to add a new module to
+    Antidote. Please see <A HREF="design-overview.html">The Antidote
+    Design Overview</A> for information on what a module is and how it
+    fits into Antidote. If you've already got all that, then read
+    on!</P>
+
+    <P>NB: <I>Please submit updates and criticisms to this, particularly
+    areas that were unclear, missing, or difficult to follow.</I></P>
+
+    <H2>1) Specialize <TT>org.apache.tools.ant.gui.core.AntModule</TT></H2>
+
+    <P>All modules must inherit from the <TT>AntModule</TT>
+    class. This will probably irritate some of you, but it essentially
+    enforces inheritance from <TT>javax.swing.JComponent</TT> and
+    provides encapsulated handling of the <TT>AppContext</TT> instance
+    that is so important to this class.</P>
+
+    <P>Your module is required to implement the
+    <TT>AntModule.contextualize(AppContext)</TT> method. The first
+    thing this method should do is call
+    <TT>AntModule.setContext(AppContext)</TT>, and then it is safe for
+    it to begin constructing its display, using whatever resources it
+    needs from the given <TT>AppContext</TT> instance. Think of this
+    in a similar manner to <TT>Applet.init()</TT> or
+    <TT>Servlet.init()</TT>.
+
+    <H2>2) Update 
+       <TT>org/apache/tools/ant/gui/resources/antidote.properties</TT></H2>
+
+    <H3>2a) Externalize All Displayable Strings</H3>
+
+    <P>All displayable strings must be externalized to the
+    <TT>antidote.properties</TT> file, and looked up via the
+    <TT>AppContext.getResources()</TT> method after the
+    <TT>AntModule.contextualize()</TT> method has been called. Follow
+    the naming convention currently used in the properties file and
+    you should have to problems. This task should be done
+    <B>during</B> development of your module. Under no cercumstances
+    should your module be submitted or committed without this task
+    being completed. Remember that Antidote has an international
+    audience.</P>
+
+    <H3>2b) Add Module to List of Auto-Loaded Modules</H3>
+
+    <P>Look for the properties with the format
+    <TT>org.apache.tools.ant.gui.Antidote.xxx.modules</TT> where
+    <TT>xxx</TT> is one of {left | right | top | bottom}. Depending on
+    where you want your module to appear, and the order that you want
+    it to appear in relationship to the other modules, add the class
+    name of your module appropriately. If multiple modules are listed
+    for a single property (via a comma delimited list), then each
+    module will have it's own tab in a <TT>javax.swing.JTabbedPane</TT>.
+
+    <P>NB:<I>This goofy way of constructing the main screen will probably 
+    change to something much more general (but not as general as, say 
+    <A HREF="http://www.alphaworks.ibm.com/tech/bml">BML</A>).</P>
+
+    <H2>Run it!</H2>
+    <P>That should be all you need to do, at least to get your module
+    plugged in. Check out the source code for
+    <TT>ProjectNavigator</TT> and <TT>PropertyEditor</TT> for module
+    examples that use the various facilities of the Antidote
+    framework.</P>
+
+    <HR>
+    <P ALIGN="center">Copyright &copy; 2000 Apache Software Foundation. All
+    rights Reserved.</P>
+
+  </BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/index.html b/jakarta-ant-1.2-src/src/antidote/docs/uml/index.html
new file mode 100644
index 0000000..4f685e9
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/docs/uml/index.html
@@ -0,0 +1,44 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "strict.dtd">
+<HTML> 
+  <HEAD> 
+     <TITLE>Antidote UML Static Class Diagrams</TITLE> 
+  </HEAD> 
+
+  <BODY> 
+
+    <H1>Antidote UML Static Class Diagrams</H1>
+
+    <P>Version 0.1 (2000/12/19)</P>
+
+    <P>Authors: 
+    <A HREF="mailto:simeon@fitch.net">Simeon H.K. Fitch</A>
+    </P>
+
+    <H2>Diagram Images</H2>
+
+    <P>The following UML static class diagrams were generated using <A
+    HREF="http://www.togethersoft.com">Together/J</A>, reverse engineering the
+    existing code. They are no means guaranteed to be kept up to date, and are
+    only a snapshot of development in progress. Their purpose is to help give
+    people a quick glance a the class structure of the various packages that
+    make up.</P>
+
+    <OL>
+    <LI><A HREF="org-apache-tools-ant-gui.gif">org.apache.tools.ant.gui</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-acs.gif">org.apache.tools.ant.gui.acs</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-core.gif">org.apache.tools.ant.gui.core</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-command.gif">org.apache.tools.ant.gui.command</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-customizer.gif">org.apache.tools.ant.gui.customizer</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-event.gif">org.apache.tools.ant.gui.event</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-ide.gif">org.apache.tools.ant.gui.ide</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-modules.gif">org.apache.tools.ant.gui.modules</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-modules-console.gif">org.apache.tools.ant.gui.modules.console</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-modules-edit.gif">org.apache.tools.ant.gui.modules.edit</A></LI>
+    <LI><A HREF="org-apache-tools-ant-gui-util.gif">org.apache.tools.ant.gui.util</A></LI>
+    </OL>
+
+    <HR>
+    <P ALIGN="center">Copyright &copy; 2000 Apache Software Foundation. All
+    rights Reserved.</P>
+  </BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-acs.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-acs.gif
new file mode 100644
index 0000000..215b26d
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-acs.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-command.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-command.gif
new file mode 100644
index 0000000..d8f28a2
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-command.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-core.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-core.gif
new file mode 100644
index 0000000..da7c4c7
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-core.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-customizer.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-customizer.gif
new file mode 100644
index 0000000..a7a0d8b
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-customizer.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-event.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-event.gif
new file mode 100644
index 0000000..16dff21
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-event.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-ide.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-ide.gif
new file mode 100644
index 0000000..b8fe343
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-ide.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-console.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-console.gif
new file mode 100644
index 0000000..fced09c
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-console.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-edit.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-edit.gif
new file mode 100644
index 0000000..0bf9f76
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules-edit.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules.gif
new file mode 100644
index 0000000..6530e8f
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-modules.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-util.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-util.gif
new file mode 100644
index 0000000..482c86d
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui-util.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui.gif b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui.gif
new file mode 100644
index 0000000..59ab84f
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/docs/uml/org-apache-tools-ant-gui.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/About.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/About.java
new file mode 100644
index 0000000..54b0c4f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/About.java
@@ -0,0 +1,142 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui;
+import org.apache.tools.ant.gui.util.WindowUtils;
+
+import org.apache.tools.ant.gui.core.AppContext;
+import javax.swing.*;
+import java.io.IOException;
+import java.util.*;
+import java.awt.BorderLayout;
+import java.awt.Dimension;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+
+/**
+ * Dialog displaying information on the application.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class About extends JDialog {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+	public About(AppContext context) {
+		super(context.getParentFrame(), true);
+		setDefaultCloseOperation(DISPOSE_ON_CLOSE);
+
+		String version = null;
+		String date = null;
+
+		Properties props = new Properties();
+
+		try {
+			props.load(getClass().getResourceAsStream("version.txt"));
+		}
+		catch(IOException ex) {
+			// XXX log me.
+			ex.printStackTrace();
+			return;
+		}
+
+		version = props.getProperty("VERSION", "??");
+		date = props.getProperty("DATE", "??");
+
+		String message = context.getResources().getMessage(
+			getClass(), "message", 
+			new Object[] { version, date });
+
+		String title = context.getResources().getString(
+			getClass(), "title");
+		setTitle(title);
+
+        JTextPane contents = new JTextPane();
+        contents.setContentType("text/html");
+        contents.setText(message);
+        contents.setEditable(false);
+        // XXX Still not sure why this is necessary. JTextPane doesn't 
+        // seem to report a "true" preferred size.
+        contents.setPreferredSize(
+            new Dimension(contents.getPreferredSize().width, 450));
+		getContentPane().add(BorderLayout.CENTER, contents);
+
+		// Add the OK button.
+		JButton ok = new JButton(
+			context.getResources().getString(getClass(), "ok"));
+		ok.addActionListener(new ActionHandler());
+		JPanel p = new JPanel();
+		p.add(ok);
+		getContentPane().add(BorderLayout.SOUTH, p);
+
+        getRootPane().setDefaultButton(ok);
+
+
+		// Just go ahead and show it...
+		pack();
+		WindowUtils.centerWindow(context.getParentFrame(), this);
+		setVisible(true);
+	}
+
+	/** Handles press of the OK button. */
+	private class ActionHandler implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			WindowUtils.sendCloseEvent(About.this);
+		}
+	}
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Antidote.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Antidote.java
new file mode 100644
index 0000000..7008751
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Antidote.java
@@ -0,0 +1,147 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui;
+import org.apache.tools.ant.gui.core.*;
+import javax.swing.*;
+import java.awt.BorderLayout;
+import java.awt.Dimension;
+import java.lang.reflect.Constructor;
+
+/**
+ * The root class for the Ant GUI. Assembles all the graphical components
+ * based on the configuration files.
+ * 
+ * @version $Revision: 1.9 $ 
+ * @author Simeon Fitch 
+ */
+public class Antidote extends JComponent {
+    /** Source of application state data. */
+    private AppContext _context = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public Antidote(AppContext context) {
+        setLayout(new BorderLayout());
+
+        _context = context;
+
+        // Add the various modules to the editing area.
+        JSplitPane splitter = new JSplitPane();
+        splitter.add(JSplitPane.LEFT, populateModules("left"));
+        splitter.add(JSplitPane.RIGHT, populateModules("right"));
+        // This is necessary because, frankly, the JSplitPane widget
+        // sucks, and doesn't provide enought (working) control over the
+        // initial size of it's subcomponents. setDividerLocation(double)
+        // doesn't seem to work until after the widget is visible.
+        splitter.setPreferredSize(new Dimension(500, 300));
+
+        // Top bottom splitter. 
+        JSplitPane splitter2 = new JSplitPane(JSplitPane.VERTICAL_SPLIT);
+        splitter2.setOneTouchExpandable(true);
+
+        splitter2.add(JSplitPane.TOP, splitter);
+        splitter2.add(JSplitPane.BOTTOM, populateModules("bottom"));
+
+        add(BorderLayout.CENTER, splitter2);
+        splitter2.resetToPreferredSizes();
+
+        add(BorderLayout.NORTH, populateModules("top"));
+
+        setPreferredSize(new Dimension(640, 480));
+    }
+
+
+	/** 
+	 * Instantiate the configured modules.
+	 * 
+     * @return Component containing the modules(s).
+	 */
+    private JComponent populateModules(String prefix) {
+
+        String[] classNames = _context.getResources().
+            getStringArray(getClass(), prefix + ".modules");
+
+        AntModule[] modules = new AntModule[classNames.length];
+
+        for(int i = 0; i < classNames.length; i++) {
+            try {
+                Class type = Class.forName(classNames[i]);
+
+                modules[i] = (AntModule) type.newInstance();
+                modules[i].contextualize(_context);
+            }
+            catch(Exception ex) {
+                // XXX log me.
+                ex.printStackTrace();
+            }
+        }
+
+        if(modules.length == 1) {
+            return modules[0];
+        }
+        else if(modules.length > 1) {
+            JTabbedPane tabbed = new JTabbedPane(JTabbedPane.BOTTOM);
+
+            for(int i = 0; i < modules.length; i++) {
+                tabbed.addTab(modules[i].getName(), modules[i]);
+            }
+            return tabbed;
+        }
+        else {
+            return new JLabel("I shouldn't be here...");
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Args.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Args.java
new file mode 100644
index 0000000..c263138
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Args.java
@@ -0,0 +1,161 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.gui;
+import org.apache.tools.ant.gui.core.ResourceManager;
+
+/**
+ * Class encapsulating the parsing of command-line arguments for Antidote.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class Args {
+
+    private ResourceManager _resources = null;
+    private boolean _wizardMode = false;
+    private String _fileName = null;
+    private boolean _debugMode = false;
+
+    /** 
+     * Ctor for parsing command line arguments.
+     * 
+     * @param args Arguments to parse.
+     */
+    public Args(String[] args) {
+        for(int i = 0; i < args.length; i++) {
+            String arg = args[i];
+            if(i == args.length - 1 && !arg.startsWith("-")) {
+                _fileName = arg;
+            }
+            else if(arg.startsWith("-h")) {
+                System.out.println(getUsage());
+                System.exit(0);
+            }
+            else if(arg.equals("-wizard")) {
+                _wizardMode = true;
+            }
+            else if(arg.equals("-debug")) {
+                _debugMode = true;
+            }
+            else {
+                String msg = getResources().getMessage(
+                    "invalidArg", new Object[] { arg });
+                abort(msg);
+            }
+        }
+    }
+
+    /** 
+     * Get the resources, loading them if necessary.
+     * 
+     * @return Loaded resources.
+     */
+    private ResourceManager getResources() {
+        if(_resources == null) {
+            _resources = new ResourceManager(
+                "org.apache.tools.ant.gui.resources.args");
+        }
+        return _resources;
+    }
+
+    /** 
+     * Print message and exit.
+     * 
+     * @param error Error message to print.
+     */
+    private void abort(String error) {
+        System.err.println(error);
+        System.err.println(getUsage());
+        System.exit(1);
+    }
+
+    /** 
+     * Get the command line usage of Antidote.
+     * 
+     * @return Command line usage help.
+     */
+    public String getUsage() {
+        return getResources().getString("usage");
+    }
+
+    /** 
+     * Get the build filename.
+     * 
+     * @return Build file name.
+     */
+    public String getBuildFile() {
+        return _fileName;
+    }
+
+    /** 
+     * Determine if wizard mode was requested for generating a new 
+     * build file.
+     * 
+     * @return True if wizard mode, false otherwise.
+     */
+    public boolean isWizardMode() {
+        return _wizardMode;
+    }
+
+    /** 
+     * Determine if debug mode was requested.
+     * 
+     * @return True if debug mode, false otherwise.
+     */
+    public boolean isDebugMode() {
+        return _debugMode;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Main.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Main.java
new file mode 100644
index 0000000..d145090
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/Main.java
@@ -0,0 +1,155 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui;
+import org.apache.tools.ant.gui.core.*;
+import org.apache.tools.ant.gui.util.XMLHelper;
+import org.apache.tools.ant.gui.wizard.Wizard;
+import org.apache.tools.ant.gui.wizard.build.BuildData;
+import org.apache.tools.ant.gui.wizard.WizardListener;
+import org.apache.tools.ant.gui.command.LoadFileCmd;
+import org.apache.tools.ant.gui.event.EventBus;
+import org.apache.tools.ant.gui.acs.ACSFactory;
+import javax.swing.*;
+import java.awt.BorderLayout;
+import java.io.File;
+
+/**
+ * Launch point for the Antidote GUI. Configurs it as an application.
+ * 
+ * @version $Revision: 1.16 $ 
+ * @author Simeon Fitch 
+ */
+public class Main {
+	/** 
+	 * Application start.
+	 * 
+	 * @param args TBD
+	 */
+    public static void main(String[] args) {
+        XMLHelper.init();
+
+        Args settings = new Args(args);
+
+
+        try {
+            JFrame f = new JFrame("Antidote");
+            f.setDefaultCloseOperation(3 /*JFrame.EXIT_ON_CLOSE*/);
+            AppContext context = new AppContext(f);
+
+            if(!settings.isWizardMode()) {
+                EventResponder resp = new EventResponder(context);
+                Antidote gui = new Antidote(context);
+
+                JMenuBar menu = context.getActions().createMenuBar();
+                f.setJMenuBar(menu);
+                f.getContentPane().add(BorderLayout.CENTER, gui);
+                f.getContentPane().add(BorderLayout.NORTH, 
+                                       context.getActions().createToolBar());
+                
+                // Add the project selection menu.
+                ProjectSelectionMenu ps = new ProjectSelectionMenu(context);
+                ps.insertInto(menu);
+                
+                // Add debugging items.
+                if(settings.isDebugMode()) {
+                    context.getEventBus().addMember(
+                        EventBus.VETOING, new EventDebugMonitor());
+                }
+
+                // Load a build file if one is provided.
+                if(settings.getBuildFile() != null) {
+                    LoadFileCmd load = new LoadFileCmd(context);
+                    load.setFile(new File(settings.getBuildFile()));
+                    load.run();
+                }
+            }
+            else {
+                // We are in wizard mode. Create it.
+                Wizard wiz = new Wizard(new BuildData());
+                // XXX this is temporary for testing. Eventually
+                // it will launch the regular antidote screen with the
+                // results of the wizard.
+                wiz.addWizardListener(new WizardListener() {
+                        public void finished(Object model) {
+                            BuildData data = (BuildData) model;
+                            System.out.println(data.createProject());
+                            System.exit(0);
+                        }
+                        public void canceled() {
+                            System.exit(0);
+                        }
+
+                    });
+
+                f.getContentPane().add(BorderLayout.CENTER, wiz);
+            }
+
+            ImageIcon icon = 
+                context.getResources().loadImageIcon("icon-small.gif");
+            if(icon != null) {
+                f.setIconImage(icon.getImage());
+            }
+            else {
+                System.out.println("Application icon not found.");
+            }
+
+            f.pack();
+            f.setVisible(true);
+
+        }
+        catch(Exception ex) {
+            ex.printStackTrace();
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSBeanDescriptor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSBeanDescriptor.java
new file mode 100644
index 0000000..11afb2f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSBeanDescriptor.java
@@ -0,0 +1,73 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.apache.tools.ant.gui.core.ResourceManager;
+import java.beans.*;
+
+/**
+ * Specialized BeanDescriptor for providing more descriptive information.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+class ACSBeanDescriptor extends BeanDescriptor {
+    public ACSBeanDescriptor(BaseBeanInfo type) {
+        super(type.getType(), type.getCustomizerType());
+        setDisplayName(
+            type.getResources().getString(type.getClass(), "beanName"));
+        setShortDescription(
+            type.getResources().getString(type.getClass(), "beanDescription"));
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSDefaultElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSDefaultElement.java
new file mode 100644
index 0000000..b9b2acc
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSDefaultElement.java
@@ -0,0 +1,73 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+
+/**
+ * Default element used when no other element is specificed.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSDefaultElement extends ACSElement {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSDefaultElement() {
+
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSElement.java
new file mode 100644
index 0000000..831de2e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSElement.java
@@ -0,0 +1,153 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+import java.beans.PropertyChangeListener;
+import java.beans.PropertyChangeEvent;
+import java.beans.PropertyChangeSupport; 
+
+/**
+ * Abstract base class for all Ant Construction Set
+ * elements. Depends on the JAXP XML library from Sun.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch */
+public abstract class ACSElement extends ElementNode {
+    /** Name of the 'xmlString' property. */
+    public static final String XML_STRING = "xmlString";
+
+    /** Event support. */
+    private PropertyChangeSupport _propSupport = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    protected ACSElement() {
+    }
+
+	/** 
+	 * Get the display name of this.
+	 * 
+	 * @return Display name.
+	 */
+    public String getDisplayName() {
+        return getTagName();
+    }
+
+	/** 
+	 * Get the XML representation of this.
+	 * 
+	 * @return XML representation.
+	 */
+    public String getXMLString() {
+        return toString();
+    }
+
+	/** 
+	 * Set the given attribute.
+	 * 
+	 * @param name Name of the attribute.
+	 * @param value Value of the attribute.
+	 */
+    public void setAttribute(String name, String value) {
+        if(value == null && getAttribute(name).length() != 0) {
+            removeAttribute(name);
+        }
+        else {
+            super.setAttribute(name, value);
+        }
+    }
+
+	/** 
+	 * Add a change listener.
+	 * 
+	 * @param l Listener to add.
+	 */
+    public void addPropertyChangeListener(PropertyChangeListener l) {
+        if(_propSupport == null) {
+            _propSupport = new PropertyChangeSupport(this);
+        }
+        _propSupport.addPropertyChangeListener(l);
+    }
+
+
+	/** 
+	 * Remove a change listener
+	 * 
+	 * @param l Listener to remove.
+	 */
+    public void removePropertyChangeListener(PropertyChangeListener l) {
+        if(_propSupport == null) {
+            _propSupport = new PropertyChangeSupport(this);
+        }
+        _propSupport.removePropertyChangeListener(l);
+    }
+
+	/** 
+	 * Fire a change event to all listener.
+	 * 
+	 * @param propName Name of the property.
+	 * @param oldValue The old value.
+	 * @param newValue The new value.
+	 */
+    protected void firePropertyChange(
+        String propName, Object oldValue, Object newValue) {
+        
+        if(_propSupport != null) {
+            _propSupport.firePropertyChange(propName, oldValue, newValue);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSFactory.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSFactory.java
new file mode 100644
index 0000000..143d286
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSFactory.java
@@ -0,0 +1,272 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import javax.xml.parsers.*;
+import java.io.IOException;
+import java.io.File;
+import java.net.URL;
+import org.w3c.dom.*;
+import org.xml.sax.SAXException;
+import com.sun.xml.parser.Parser;
+import com.sun.xml.tree.SimpleElementFactory;
+import com.sun.xml.tree.XmlDocument;
+import com.sun.xml.tree.XmlDocumentBuilder;
+import java.util.Properties;
+import java.util.Enumeration;
+import com.sun.xml.parser.Resolver;
+
+/**
+ * Factory for loading Ant Construction set elements.
+ * 
+ * @version $Revision: 1.8 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSFactory {
+    /** Singleton instance of the factory. */
+    private static ACSFactory _instance = null;
+
+    /** Element maping. */
+    private static final Properties _elementMap = new Properties();
+
+    static {
+        try {
+            // First we bootstrap our knowledge of the Ant tasks by reading
+            // in the taskdef definitions and assigning them the default
+            // task element class.
+            _elementMap.load(org.apache.tools.ant.taskdefs.Ant.class.
+                          getResourceAsStream("defaults.properties"));
+            Enumeration enum = _elementMap.propertyNames();
+            while(enum.hasMoreElements()) {
+                String name = (String) enum.nextElement();
+                // XXX the name of the class needs to be stored externally.
+                _elementMap.setProperty(
+                    name, "org.apache.tools.ant.gui.acs.ACSTaskElement");
+            }
+
+            // Then we add/override the local definitions.
+            _elementMap.load(ACSFactory.class.
+                             getResourceAsStream("acs-element.properties"));
+        }
+        catch(Throwable ex) {
+            // If something wrong happens here we can't do much more...
+            ex.printStackTrace();
+            System.exit(1);
+        }
+    }
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    private ACSFactory() {
+
+    }
+
+	/** 
+	 * Get an instance of the factory.
+	 * 
+	 * @return Factory instance.
+	 */
+    public static ACSFactory getInstance() {
+        if(_instance == null) {
+            _instance = new ACSFactory();
+        }
+        return _instance;
+    }
+
+	/** 
+	 * Load a project from the given XML file.
+     * XXX fix me.
+	 * 
+	 * @param location Location of the file.
+	 * @return Loaded project.
+	 */
+    public ACSProjectElement load(File location) throws IOException {
+        return load(new URL("file", null, location.getPath()));
+    }
+
+	/** 
+	 * Load a project from the given XML file.
+     * XXX fix me.
+	 * 
+	 * @param location Location of the file.
+	 * @return Loaded project.
+	 */
+    public ACSProjectElement load(URL location) throws IOException {
+        XmlDocument doc = null;
+
+        try {
+            SAXParser sax = SAXParserFactory.newInstance().newSAXParser();
+            Parser parser = (Parser) sax.getParser();
+            XmlDocumentBuilder builder = new XmlDocumentBuilder();
+            builder.setIgnoringLexicalInfo(false);
+            SimpleElementFactory fact = new SimpleElementFactory();
+            fact.addMapping(_elementMap, ACSFactory.class.getClassLoader());
+
+            builder.setElementFactory(fact);
+            
+            parser.setDocumentHandler(builder);
+            parser.setEntityResolver(new Resolver());
+            //parser.setErrorHandler();
+
+            sax.parse(location.openStream(), null);
+
+            doc = builder.getDocument();
+
+        }
+        catch(ParserConfigurationException ex) {
+            ex.printStackTrace();
+            throw new IOException(ex.getMessage());
+        }
+        catch(SAXException ex) {
+            ex.printStackTrace();
+            throw new IOException(ex.getMessage());
+        }
+
+        return (ACSProjectElement) doc.getDocumentElement();
+    }
+
+    /** 
+     * Create a new, empty project.
+     * 
+     * @return Empty project.
+     */
+    public ACSProjectElement createProject() {
+        SimpleElementFactory fact = new SimpleElementFactory();
+        fact.addMapping(_elementMap, ACSFactory.class.getClassLoader());
+        XmlDocument doc = new XmlDocument();
+        doc.setElementFactory(fact);
+        return (ACSProjectElement) doc.createElement("project");
+    }
+
+
+    /** 
+     * Create a new target.
+     * 
+     * @param project Project the target is assigned to.
+     * @return New, unnamed target.
+     */
+    public ACSTargetElement createTarget(ACSProjectElement project) {
+        ACSTargetElement retval = (ACSTargetElement) project.
+            getOwnerDocument().createElement("target");
+        indent(project, 1);
+        project.appendChild(retval);
+        return retval;
+    }
+
+    /** 
+     * Create a new task.
+     * 
+     * @param target Target the task is assigned to.
+     * @return New, unnamed task.
+     */
+    public ACSTaskElement createTask(ACSTargetElement target) {
+        ACSTaskElement retval = (ACSTaskElement) target.
+            getOwnerDocument().createElement("task");
+        indent(target, 2);
+        target.appendChild(retval);
+        return retval;
+    }
+
+    /** 
+     * Create a new property.
+     * 
+     * @param node the Node to assign the property to.
+     * @return New, unnamed property.
+     */
+    public ACSPropertyElement createProperty(ACSElement node) {
+        ACSPropertyElement retval = (ACSPropertyElement) node.
+            getOwnerDocument().createElement("property");
+        // XXX fixme.
+        indent(node, 1);
+        node.appendChild(retval);
+        return retval;
+    }
+
+    /** 
+     * Insert a new line and indentation at the end of the given
+     * node in preparation for a new element being added.
+     * 
+     * @param node Node to append indent to.
+     * @param level Indentation level.
+     */
+    private void indent(ACSElement node, int level) {
+        StringBuffer buf = new StringBuffer("\n");
+        for(int i = 0; i < level; i++) {
+            buf.append("    ");
+        }
+
+        Text text = node.getOwnerDocument().createTextNode(buf.toString());
+        node.appendChild(text);
+    }
+
+
+	/** 
+	 * Test code
+	 * 
+	 * @param args  XML file to parse.
+	 */
+    public static void main(String[] args) {
+        try {
+            ACSFactory f = ACSFactory.getInstance();
+
+            System.out.println(f.load(new File(args[0])));
+        }
+        catch(Exception ex) {
+            ex.printStackTrace();
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSNamedElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSNamedElement.java
new file mode 100644
index 0000000..5f2ddfa
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSNamedElement.java
@@ -0,0 +1,128 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+import java.util.StringTokenizer;
+
+/**
+ * Class representing an element with a name and description.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSNamedElement extends ACSTreeNodeElement {
+    /** The 'name' property name. */
+    public static final String NAME = "name";
+    /** The discription property name. */
+    public static final String DESCRIPTION = "description";
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSNamedElement() {
+
+    }
+
+	/** 
+	 * Get the target name.
+	 * 
+	 * @return Target name.
+	 */
+    public String getName() {
+        return getAttribute(NAME);
+    }
+
+	/** 
+	 * Set the name.
+	 * 
+	 * @param name New name value.
+	 */
+    public void setName(String name) {
+        String old = getName();
+        setAttribute(NAME, name);
+        firePropertyChange(NAME, old, name);
+    }
+
+	/** 
+	 * Get the long description of the target.
+	 * 
+	 * @return Target description.
+	 */
+    public String getDescription() {
+        return getAttribute(DESCRIPTION);
+    }
+
+	/** 
+	 * Set the description
+	 * 
+	 * @param description New description value.
+	 */
+    public void setDescription(String description) {
+        String old = getDescription();
+        setAttribute(DESCRIPTION, description);
+        firePropertyChange(DESCRIPTION, old, description);
+    }
+
+	/** 
+	 * Get the display name.
+	 * 
+	 * @return Display name.
+	 */
+    public String getDisplayName() {
+        return getName();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElement.java
new file mode 100644
index 0000000..1e64a3a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElement.java
@@ -0,0 +1,167 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+import java.net.URL;
+import java.io.File;
+
+/**
+ * Class representing a project element in the build file.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSProjectElement extends ACSNamedElement {
+    /** The 'default' property name. */
+    public static final String DEFAULT = "default";
+    /** The 'basdir' property name. */
+    public static final String BASEDIR = "basedir";
+    /** Property name of the persistence location. */
+    public static final String LOCATION = "location";
+    /** The location where this project is persisted. */
+    private URL _location = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSProjectElement() {
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public Class getType() {
+        return ACSProjectElement.class;
+    }
+
+	/** 
+	 * Get the name of the default target.
+	 * 
+	 * @return Default target name.
+	 */
+    public String getDefault() {
+        return getAttribute(DEFAULT);
+    }
+
+	/** 
+	 * Set the name of the default target.
+	 * 
+	 * @param def Name of the default target.
+	 */
+    public void setDefault(String def) {
+        String old = getDefault();
+        setAttribute(DEFAULT, def);
+        firePropertyChange(DEFAULT, old, def);
+    }
+
+	/** 
+	 * Get the specified base directory for the build.
+	 * 
+	 * @return Base directory
+	 */
+    public String getBasedir() {
+        return getAttribute(BASEDIR);
+    }
+
+	/** 
+	 * Set the base directory for builds.
+	 * 
+	 * @param baseDir Build base directory.
+	 */
+    public void setBasedir(String baseDir) {
+        String old = getBasedir();
+        setAttribute(BASEDIR, baseDir);
+        firePropertyChange(BASEDIR, old, baseDir);
+    }
+
+    /** 
+     * Get the location where this project is persisted.
+     * 
+     * @return Saved location, or null if not persisted.
+     */
+    public URL getLocation() {
+        return _location;
+    }
+
+    /** 
+     * Set the loction where the project is persisted.
+     * 
+     * @param location Location of project.
+     */
+    public void setLocation(URL location) {
+        URL old = _location;
+        _location = location;
+        firePropertyChange(LOCATION, old, _location);
+    }
+
+    /** 
+     * Set the loction where the project is persisted.
+     * 
+     * @param location Location of project as a file.
+     */
+    public void setLocation(File location) {
+        try {
+            setLocation(new URL("file", null, location.getAbsolutePath()));
+        }
+        catch(java.net.MalformedURLException ex) {
+            // No reason why this should happen.
+            // xxx Log me.
+            ex.printStackTrace();
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElementBeanInfo.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElementBeanInfo.java
new file mode 100644
index 0000000..423be92
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSProjectElementBeanInfo.java
@@ -0,0 +1,136 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+import java.beans.*;
+
+/**
+ * BeanInfo for the ACSProjectElement class.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSProjectElementBeanInfo extends BaseBeanInfo {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSProjectElementBeanInfo() {
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public Class getType() {
+        return ACSProjectElement.class;
+    }
+
+	/** 
+	 * Get the customizer type.
+	 * 
+	 * @return Customizer type.
+	 */
+    public Class getCustomizerType() {
+        return Customizer.class;
+    }
+
+	/** 
+	 * Get the property descriptors.
+	 * 
+     * @return Property descriptors.
+	 */
+    public PropertyDescriptor[] getPropertyDescriptors() {
+        PropertyDescriptor[] retval = null;
+
+        try {
+            retval = new PropertyDescriptor[] {
+                new PropertyDescriptor(ACSProjectElement.NAME, 
+                                       ACSProjectElement.class),
+                new PropertyDescriptor(ACSProjectElement.DESCRIPTION, 
+                                       ACSProjectElement.class),
+                new PropertyDescriptor(ACSProjectElement.DEFAULT, 
+                                       ACSProjectElement.class),
+                new PropertyDescriptor(ACSProjectElement.BASEDIR, 
+                                       ACSProjectElement.class)
+
+            };
+            retval[0].setDisplayName(getResources().getString(
+                getClass(),ACSProjectElement.NAME));
+            retval[1].setDisplayName(getResources().getString(
+                getClass(),ACSProjectElement.DESCRIPTION));
+            retval[2].setDisplayName(getResources().getString(
+                getClass(),ACSProjectElement.DEFAULT));
+            retval[3].setDisplayName(getResources().getString(
+                getClass(),ACSProjectElement.BASEDIR));
+
+            setSortingOrder(retval);
+        }
+        catch(IntrospectionException ex) {
+            ex.printStackTrace();
+            throw new Error(ex.toString());
+        }
+
+        return retval;
+    }
+
+    /** Customizer for this bean info. */
+    public static class Customizer extends DynamicCustomizer {
+        public Customizer() {
+            super(ACSProjectElement.class);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElement.java
new file mode 100644
index 0000000..d791fdb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElement.java
@@ -0,0 +1,154 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+
+/**
+ * Element containing a property definition.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSPropertyElement extends ACSTreeNodeElement {
+    /** The 'name' property name. */
+    public static final String NAME = "name";
+    /** The 'value' property name. */
+    public static final String VALUE = "value";
+    /** The file to load properties from. */
+    public static final String FILE = "file";
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSPropertyElement() {
+    }
+
+	/** 
+	 * Get the display name of this.
+	 * 
+	 * @return Display name.
+	 */
+    public String getDisplayName() {
+        String file = getFile();
+
+        if(file == null || file.trim().length() == 0) {
+            return getName();
+        }
+        else {
+            return "file: " + file;
+        }
+    }
+
+	/** 
+	 * Get the property name.
+	 * 
+	 * @return Property name.
+	 */
+    public String getName() {
+        return getAttribute(NAME);
+    }
+
+	/** 
+	 * Set the property name.
+	 * 
+	 * @param name Property name.
+	 */
+    public void setName(String name) {
+        String old = getName();
+        setAttribute(NAME, name);
+        firePropertyChange(NAME, old, name);
+    }
+
+	/** 
+	 * Get the property value.
+	 * 
+	 * @return Property value.
+	 */
+    public String getValue() {
+        return getAttribute(VALUE);
+    }
+
+	/** 
+	 * Set the property value.
+	 * 
+	 * @param name Property value.
+	 */
+    public void setValue(String value) {
+        String old = getValue();
+        setAttribute(VALUE, value);
+        firePropertyChange(VALUE, old, value);
+    }
+
+	/** 
+	 * Get the external property file.
+	 * 
+	 * @return Property file.
+	 */
+    public String getFile() {
+        return getAttribute(FILE);
+    }
+
+	/** 
+	 * Set the external property file.
+	 * 
+	 * @param name Property file.
+	 */
+    public void setFile(String file) {
+        String old = getFile();
+        setAttribute(FILE, file);
+        firePropertyChange(FILE, old, file);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElementBeanInfo.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElementBeanInfo.java
new file mode 100644
index 0000000..318196e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSPropertyElementBeanInfo.java
@@ -0,0 +1,132 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+import java.beans.*;
+
+/**
+ * BeanInfo for the ACSPropertyElement class.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSPropertyElementBeanInfo extends BaseBeanInfo {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSPropertyElementBeanInfo() {
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public Class getType() {
+        return ACSPropertyElement.class;
+    }
+
+	/** 
+	 * Get the customizer type.
+	 * 
+	 * @return Customizer type.
+	 */
+    public Class getCustomizerType() {
+        return Customizer.class;
+    }
+
+	/** 
+	 * Get the property descriptors.
+	 * 
+     * @return Property descriptors.
+	 */
+    public PropertyDescriptor[] getPropertyDescriptors() {
+        PropertyDescriptor[] retval = null;
+
+        try {
+            retval = new PropertyDescriptor[] {
+                new PropertyDescriptor(ACSPropertyElement.FILE, 
+                                       ACSPropertyElement.class),
+                new PropertyDescriptor(ACSPropertyElement.NAME, 
+                                       ACSPropertyElement.class),
+                new PropertyDescriptor(ACSPropertyElement.VALUE, 
+                                       ACSPropertyElement.class)
+            };
+
+            retval[0].setDisplayName(getResources().getString(
+                getClass(),ACSPropertyElement.FILE));
+            retval[1].setDisplayName(getResources().getString(
+                getClass(),ACSPropertyElement.NAME));
+            retval[2].setDisplayName(getResources().getString(
+                getClass(),ACSPropertyElement.VALUE));
+
+            setSortingOrder(retval);
+        }
+        catch(IntrospectionException ex) {
+            ex.printStackTrace();
+            throw new Error(ex.toString());
+        }
+
+        return retval;
+    }
+
+    /** Customizer for this bean info. */
+    public static class Customizer extends DynamicCustomizer {
+        public Customizer() {
+            super(ACSPropertyElement.class);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElement.java
new file mode 100644
index 0000000..2a2dc77
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElement.java
@@ -0,0 +1,155 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import com.sun.xml.tree.ElementNode;
+import java.util.StringTokenizer;
+
+/**
+ * Class representing a build target.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSTargetElement extends ACSNamedElement {
+
+    /** Dependency property name. */
+    public static final String DEPENDS = "depends";
+    /** 'if' clause property name. */
+    public static final String IF = "if";
+    /** 'unless' clause property name. */
+    public static final String UNLESS = "unless";
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSTargetElement() {
+
+    }
+
+	/** 
+	 * Get the set of dependency names. 
+	 * 
+	 * @return Dependency names.
+	 */
+    public String[] getDepends() {
+        String depends = getAttribute(DEPENDS);
+        StringTokenizer tok = new StringTokenizer(depends,",");
+        String[] retval = new String[tok.countTokens()];
+        for(int i = 0; i < retval.length; i++) {
+            retval[i] = tok.nextToken().trim();
+        }
+        
+        return retval;
+    }
+
+	/** 
+	 * Set the list of dependency names.
+	 * 
+	 * @param depends Dependency names.
+	 */
+    public void setDepends(String[] depends) {
+        String old = getAttribute(DEPENDS);
+        StringBuffer buf = new StringBuffer();
+        for(int i = 0; depends != null && i < depends.length; i++) {
+            buf.append(depends[i]);
+            if(i < depends.length - 1) {
+                buf.append(", ");
+            }
+        }
+        setAttribute(DEPENDS, buf.toString());
+        firePropertyChange(DEPENDS, old, buf.toString());
+    }
+
+	/** 
+	 * Get the 'if' clause.
+	 * 
+	 * @return 'if' clause.
+	 */
+    public String getIf() {
+        return getAttribute(IF);
+    }
+    
+	/** 
+	 * Set the 'if' clause.
+	 * 
+	 * @param val 'if' clause value.
+	 */
+    public void setIf(String val) {
+        String old = getIf();
+        setAttribute(IF, val);
+        firePropertyChange(IF, old, val);
+    }
+
+	/** 
+	 * Get the 'unless' clause.
+	 * 
+	 * @return 'unless' clause.
+	 */
+    public String getUnless() {
+        return getAttribute(UNLESS);
+    }
+
+	/** 
+	 * Set the 'unless' clause.
+	 * 
+	 * @param val 'unless' clase value.
+	 */
+    public void setUnless(String val) {
+        String old = getUnless();
+        setAttribute(UNLESS, val);
+        firePropertyChange(UNLESS, old, val);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElementBeanInfo.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElementBeanInfo.java
new file mode 100644
index 0000000..b4d9c84
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTargetElementBeanInfo.java
@@ -0,0 +1,147 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+
+import java.beans.*;
+
+/**
+ * BeanInfo for the ACSTargetElement class.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSTargetElementBeanInfo extends BaseBeanInfo {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSTargetElementBeanInfo() {
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public Class getType() {
+        return ACSTargetElement.class;
+    }
+
+	/** 
+	 * Get the customizer type.
+	 * 
+	 * @return Customizer type.
+	 */
+    public Class getCustomizerType() {
+        return Customizer.class;
+    }
+
+	/** 
+	 * Get the property descriptors.
+	 * 
+     * @return Property descriptors.
+	 */
+    public PropertyDescriptor[] getPropertyDescriptors() {
+        PropertyDescriptor[] retval = null;
+
+        try {
+            retval = new PropertyDescriptor[] {
+                new PropertyDescriptor(ACSTargetElement.NAME, 
+                                       ACSTargetElement.class),
+                new PropertyDescriptor(ACSTargetElement.DESCRIPTION,
+                                       ACSTargetElement.class),
+                new PropertyDescriptor(ACSTargetElement.DEPENDS,
+                                       ACSTargetElement.class),
+                new PropertyDescriptor(ACSTargetElement.IF,
+                                       ACSTargetElement.class),
+                new PropertyDescriptor(ACSTargetElement.UNLESS,
+                                       ACSTargetElement.class),
+                new PropertyDescriptor(ACSTargetElement.XML_STRING, 
+                                       ACSTargetElement.class,
+                                       "getXMLString", null)
+            };
+
+            // Set display names.
+            retval[0].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.NAME));
+            retval[1].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.DESCRIPTION));
+            retval[2].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.DEPENDS));
+            retval[3].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.IF));
+            retval[4].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.UNLESS));
+            retval[5].setDisplayName(getResources().getString(
+                getClass(),ACSTargetElement.XML_STRING));
+
+            setSortingOrder(retval);
+        }
+        catch(IntrospectionException ex) {
+            ex.printStackTrace();
+            throw new Error(ex.toString());
+        }
+
+        return retval;
+    }
+
+
+    /** Customizer for this bean info. */
+    public static class Customizer extends DynamicCustomizer {
+        public Customizer() {
+            super(ACSTargetElement.class);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElement.java
new file mode 100644
index 0000000..dff9136
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElement.java
@@ -0,0 +1,153 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.w3c.dom.Node;
+import org.w3c.dom.NamedNodeMap;
+import java.util.*;
+
+/**
+ * Element containing a property definition.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSTaskElement extends ACSTreeNodeElement {
+    /** Property name for the task type. */
+    public static final String TASK_TYPE = "taskType";
+    /** Property name for attributes. It's called "namedValues" so
+     *  it doesn't collide with the Node.getAttributes() method. */
+    public static final String NAMED_VALUES = "namedValues";
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSTaskElement() {
+    }
+
+	/** 
+	 * Get the task type.
+	 * 
+	 * @return Task type.
+	 */
+    public String getTaskType() {
+        return getTagName();
+    }
+
+    /** 
+     * Set the task type.
+     * 
+     * @param type Type name.
+     */
+    public void setTaskType(String type) {
+        setTag(type);
+    }
+
+	/** 
+	 * Get the attributes (named value mappings). This method is not named
+     * getAttributes() because there is already a method of that name in
+     * the Node interface.
+	 * 
+	 * @return Name-value mappings.
+	 */
+    public Properties getNamedValues() {
+        Properties retval = new Properties();
+
+        NamedNodeMap attribs = getAttributes();
+        for(int i = 0, len = attribs.getLength(); i < len; i++) {
+            Node n = attribs.item(i);
+            retval.setProperty(n.getNodeName(), n.getNodeValue());
+        }
+        return retval;
+    }
+
+
+	/** 
+	 * Set the attributes. This method sets the Node attirbutes using 
+     * the given Map containing name-value pairs.
+	 * 
+	 * @param attributes New attribute set.
+	 */
+    public void setNamedValues(Properties props) {
+        // XXX this code really sucks. It is really annoying that the 
+        // DOM interfaces don't have a general "setAttributes()" or
+        // "removeAllAttributes()" method, but instead make you 
+        // remove each attribute individually, or require you to figure
+        // out what the differences are between the two. 
+
+        // Although this is very inefficient, I'm taking the conceptually
+        // simplistic approach to this and brute force removing the existing 
+        // set and replacing it with a brand new set. If this becomes a 
+        // performance concern (which I doubt it will) it can be optimized 
+        // later.
+
+        Properties old = getNamedValues();
+
+        Enumeration enum = old.propertyNames();
+        while(enum.hasMoreElements()) {
+            String name = (String) enum.nextElement();
+            removeAttribute(name);
+        }
+        
+        enum = props.propertyNames();
+        while(enum.hasMoreElements()) {
+            String key = (String) enum.nextElement();
+            setAttribute(key, props.getProperty(key));
+        }
+
+        firePropertyChange(NAMED_VALUES, old, props);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElementBeanInfo.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElementBeanInfo.java
new file mode 100644
index 0000000..6d9d697
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTaskElementBeanInfo.java
@@ -0,0 +1,134 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+import java.beans.*;
+
+/**
+ * BeanInfo for the ACSTaskElement class.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ACSTaskElementBeanInfo extends BaseBeanInfo {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ACSTaskElementBeanInfo() {
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public Class getType() {
+        return ACSTaskElement.class;
+    }
+
+	/** 
+	 * Get the customizer type.
+	 * 
+	 * @return Customizer type.
+	 */
+    public Class getCustomizerType() {
+        return Customizer.class;
+    }
+
+	/** 
+	 * Get the property descriptors.
+	 * 
+     * @return Property descriptors.
+	 */
+    public PropertyDescriptor[] getPropertyDescriptors() {
+        PropertyDescriptor[] retval = null;
+
+        try {
+            retval = new PropertyDescriptor[] {
+                new PropertyDescriptor(ACSTaskElement.TASK_TYPE, 
+                                       ACSTaskElement.class,
+                                       "getTaskType", null),
+                new PropertyDescriptor(ACSTaskElement.NAMED_VALUES, 
+                                       ACSTaskElement.class),
+                new PropertyDescriptor(ACSTaskElement.XML_STRING, 
+                                       ACSTaskElement.class,
+                                       "getXMLString", null)
+            };
+
+            retval[0].setDisplayName(getResources().getString(
+                getClass(),ACSTaskElement.TASK_TYPE));
+            retval[1].setDisplayName(getResources().getString(
+                getClass(),ACSTaskElement.NAMED_VALUES));
+            retval[2].setDisplayName(getResources().getString(
+                getClass(),ACSTaskElement.XML_STRING));
+
+            setSortingOrder(retval);
+        }
+        catch(IntrospectionException ex) {
+            ex.printStackTrace();
+            throw new Error(ex.toString());
+        }
+
+        return retval;
+    }
+
+    /** Customizer for this bean info. */
+    public static class Customizer extends DynamicCustomizer {
+        public Customizer() {
+            super(ACSTaskElement.class);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTreeNodeElement.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTreeNodeElement.java
new file mode 100644
index 0000000..0dde06f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ACSTreeNodeElement.java
@@ -0,0 +1,71 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import com.sun.xml.tree.ElementNode;
+import javax.swing.tree.TreeNode;
+import java.util.*;
+
+/**
+ * Abstract base class for all ACSElement classes that are also tree node.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class ACSTreeNodeElement extends ACSElement {
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/BaseBeanInfo.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/BaseBeanInfo.java
new file mode 100644
index 0000000..e042340
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/BaseBeanInfo.java
@@ -0,0 +1,159 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+import org.apache.tools.ant.gui.core.ResourceManager;
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+import java.beans.*;
+import javax.swing.ImageIcon;
+import java.awt.Image;
+
+/**
+ * Abstract base class for ACS BeanInfo classes.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+abstract class BaseBeanInfo extends SimpleBeanInfo {
+    /** Property name for specifiying a sorting order. */
+    public static final String SORT_ORDER = DynamicCustomizer.SORT_ORDER;
+    /** Resource provider for bean info. */
+    private static ResourceManager _resources = new ResourceManager();
+
+    /** Icon for this. */
+    private Image _icon = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    protected BaseBeanInfo() {
+        // Load the icon.
+        ImageIcon img = _resources.getImageIcon(getClass(), "icon");
+        if(img != null) {
+            _icon = img.getImage();
+        }
+    }
+
+	/** 
+	 * Get the local resources.
+	 * 
+	 * @return Resources.
+	 */
+    ResourceManager getResources() {
+        return _resources;
+    }
+
+	/** 
+	 * Get the bean descriptor.
+	 * 
+	 * @return Bean descriptor.
+	 */
+    public BeanDescriptor getBeanDescriptor() {
+        return new ACSBeanDescriptor(this);
+    }
+
+	/** 
+	 * Get the icon for displaying this bean.
+	 * 
+	 * @param kind Kind of icon. XXX currently ignored
+	 * @return Image for bean, or null if none.
+	 */
+    public Image getIcon(int kind) {
+        // XXX kind is currently ignored.
+        return _icon;
+    }
+
+	/** 
+	 * Set the sorting order property of the given objects based
+     * on the order that they appear in the array. 
+	 * 
+	 * @param vals FeatureDescriptors to set sorting order property for.
+	 */
+    protected void setSortingOrder(FeatureDescriptor[] vals) {
+        for(int i = 0; i < vals.length; i++) {
+            vals[i].setValue(SORT_ORDER, new Integer(i));
+        }
+    }
+
+	/** 
+	 * Get the type that this BeanInfo represents.
+	 * 
+	 * @return Type.
+	 */
+    public abstract Class getType();
+
+	/** 
+	 * Get the type of the customizer to use. 
+	 * 
+	 * @return Customizer to use.
+	 */
+    public abstract Class getCustomizerType();
+
+    /**
+     * Gets the beans <code>PropertyDescriptor</code>s.
+     * 
+     * @return An array of PropertyDescriptors describing the editable
+     * properties supported by this bean.  May return null if the
+     * information should be obtained by automatic analysis.
+     * <p>
+     * If a property is indexed, then its entry in the result array will
+     * belong to the IndexedPropertyDescriptor subclass of PropertyDescriptor.
+     * A client of getPropertyDescriptors can use "instanceof" to check
+     * if a given PropertyDescriptor is an IndexedPropertyDescriptor.
+     */
+    public abstract PropertyDescriptor[] getPropertyDescriptors();
+
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeModel.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeModel.java
new file mode 100644
index 0000000..0dbc1df
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeModel.java
@@ -0,0 +1,312 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+
+
+import javax.swing.tree.*;
+import javax.swing.event.TreeModelListener;
+import javax.swing.event.TreeModelEvent;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import org.apache.tools.ant.gui.acs.*;
+import java.util.*;
+
+/**
+ * Provides a tree model view of the Project class. XXX This
+ * is a major hack right now that needs to be cleaned up.
+ *
+ * @version $Revision: 1.4 $ 
+ * @author Simeon H.K. Fitch */
+public class ElementTreeModel implements TreeModel {
+    /** Root of the tree. */
+    private ACSProjectElement _root = null;
+    /** List of listeners. */
+    private List _listeners = new ArrayList();
+
+    public ElementTreeModel(ACSProjectElement root) {
+        _root = root;
+    }
+
+    /**
+     * Returns the root of the tree.  Returns null only if the tree has
+     * no nodes.
+     *
+     * @return  the root of the tree
+     */
+    public Object getRoot() {
+        return _root;
+    }
+
+    /** 
+     * Gets the set of children that this tree model is interested in.
+     * NB: This is <b>really</b> inefficient, but may not be an issue given
+     * the number of times it is ultimately called. A profiler definately needs
+     * to be applied here.
+     * 
+     * @param parent Parent to extract children from.
+     */
+    private List getChildren(Node parent) {
+        NodeList children = parent.getChildNodes();
+        int length = children.getLength();
+
+        List retval = new ArrayList(length);
+        for(int i = 0; i < length; i++) {
+            // XXX This is where we will eventually add dynamic filtering
+            // capabilities.
+            Node n = children.item(i);
+            if(n instanceof ACSTreeNodeElement) {
+                retval.add(n);
+            }
+        }
+
+        return retval;
+    }
+
+    /**
+     * Returns the child of <I>parent</I> at index <I>index</I> in the parent's
+     * child array.  <I>parent</I> must be a node previously obtained from
+     * this data source. This should not return null if <i>index</i>
+     * is a valid index for <i>parent</i> (that is <i>index</i> >= 0 &&
+     * <i>index</i> < getChildCount(<i>parent</i>)).
+     *
+     * @param   parent  a node in the tree, obtained from this data source
+     * @return  the child of <I>parent</I> at index <I>index</I>
+     */
+    public Object getChild(Object parent, int index) {
+        if(parent instanceof Node) {
+            Node n = (Node) parent;
+            List children = getChildren(n);
+            return children.get(index);
+        }
+        else {
+            return null;
+        }
+    }
+
+
+    /**
+     * Returns the number of children of <I>parent</I>.  Returns 0 if the node
+     * is a leaf or if it has no children.  <I>parent</I> must be a node
+     * previously obtained from this data source.
+     *
+     * @param   parent  a node in the tree, obtained from this data source
+     * @return  the number of children of the node <I>parent</I>
+     */
+    public int getChildCount(Object parent) {
+        if(parent instanceof Node) {
+            Node n = (Node) parent;
+            return getChildren(n).size();
+        }
+        else {
+            return 0;
+        }
+    }
+
+    /**
+     * Returns true if <I>node</I> is a leaf.  It is possible for this method
+     * to return false even if <I>node</I> has no children.  A directory in a
+     * filesystem, for example, may contain no files; the node representing
+     * the directory is not a leaf, but it also has no children.
+     *
+     * @param   node    a node in the tree, obtained from this data source
+     * @return  true if <I>node</I> is a leaf
+     */
+    public boolean isLeaf(Object node) {
+        if(node instanceof Node) {
+            Node n = (Node) node;
+            return getChildren(n).size() == 0;
+        }
+        else {
+            return true;
+        }
+
+    }
+
+    /**
+     * Returns the index of child in parent.
+     */
+    public int getIndexOfChild(Object parent, Object child) {
+        if(parent instanceof Node && child instanceof Node) {
+            Node n = (Node) parent;
+            List children = getChildren(n);
+            int count = children.size();
+            for(int i = 0; i < count; i++) {
+                if(children.get(i) == child) return i;
+            }
+        }
+        return -1;
+    }
+
+    /**
+      * Messaged when the user has altered the value for the item identified
+      * by <I>path</I> to <I>newValue</I>.  If <I>newValue</I> signifies
+      * a truly new value the model should post a treeNodesChanged
+      * event.
+      *
+      * @param path path to the node that the user has altered.
+      * @param newValue the new value from the TreeCellEditor.
+      */
+    public void valueForPathChanged(TreePath path, Object newValue) {
+        // XXX What should the implementation be here?
+        fireNodeChanged((Node) path.getLastPathComponent());
+    }
+
+
+    /**
+     * Adds a listener for the TreeModelEvent posted after the tree changes.
+     *
+     * @see     #removeTreeModelListener
+     * @param   l       the listener to add
+     */
+    public void addTreeModelListener(TreeModelListener l) {
+        _listeners.add(l);
+    }
+
+    /**
+     * Removes a listener previously added with <B>addTreeModelListener()</B>.
+     *
+     * @see     #addTreeModelListener
+     * @param   l       the listener to remove
+     */  
+    public void removeTreeModelListener(TreeModelListener l) {
+        _listeners.remove(l);
+    }
+
+    /** 
+     * Get the list of nodes from the root to the
+     * given node.
+     * 
+     * @param startNode Node to get path for.
+     */
+    public Node[] getPathToRoot(Node startNode) {
+        return getPathToRoot(startNode, 0);
+    }
+
+    /** 
+     * A recursive method for generating a list of nodes defining
+     * the path from the given node to the root.
+     * 
+     * @param node Node to get path for.
+     * @param depth The number of calls taken towards the root.
+     */
+    private Node[] getPathToRoot(Node node, int depth) {
+        Node[] retval = null;
+
+        depth++;
+        if(node == _root || node.getParentNode() == null) {
+            retval = new Node[depth];
+        }
+        else {
+            retval = getPathToRoot(node.getParentNode(), depth);
+        }
+
+        retval[retval.length - depth] = node;
+        return retval;
+    }
+
+
+    /** 
+     * Fire a node change event.
+     * 
+     * @param node Node that changed.
+     */
+    public void fireNodeChanged(Node node) {
+        TreeModelEvent event = new TreeModelEvent(this, getPathToRoot(node));
+
+        // XXX This doen't support modifying the list during dispatch...
+        Iterator it = _listeners.iterator();
+        while(it.hasNext()) {
+            TreeModelListener l = (TreeModelListener) it.next();
+            l.treeNodesChanged(event);
+        }
+    }
+
+    /** 
+     * Fire a node change event.
+     * 
+     * @param node Node that changed.
+     */
+    public void fireNodeAdded(Node node) {
+        Node parent = node.getParentNode();
+        TreeModelEvent event = null;
+        if(parent == null) {
+            event = new TreeModelEvent(this, getPathToRoot(node));
+        }
+        else {
+            Node[] path = getPathToRoot(parent);
+            int[] indicies = null;
+            Node[] children = new Node[] { node };
+
+            // XXX Right now we assume that the node was added at the end.
+            // This may not be the case in the future.
+            if(parent.getLastChild() == node) {
+                List filteredChildren = getChildren(parent);
+                indicies = new int[] { filteredChildren.indexOf(node) };
+            }
+            else {
+                throw new UnsupportedOperationException(
+                    "Haven't implemented non-append notification yet.");
+            }
+
+            event = new TreeModelEvent(this, path, indicies, children);
+        }
+
+        // XXX This doen't support modifying the list during dispatch...
+        Iterator it = _listeners.iterator();
+        while(it.hasNext()) {
+            TreeModelListener l = (TreeModelListener) it.next();
+            l.treeNodesInserted(event);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeSelectionModel.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeSelectionModel.java
new file mode 100644
index 0000000..6fcdf7a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/ElementTreeSelectionModel.java
@@ -0,0 +1,103 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.acs;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+
+import javax.swing.tree.DefaultTreeSelectionModel;
+import javax.swing.tree.TreePath;
+import java.util.*;
+
+/**
+ * Selection model for the currently selected targets.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class ElementTreeSelectionModel extends DefaultTreeSelectionModel {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public ElementTreeSelectionModel() {
+        setSelectionMode(DISCONTIGUOUS_TREE_SELECTION);
+    }
+
+	/** 
+	 * Convenience method for providing the set of currently selected
+     * elements. NB: It returns all of the nodes in the selection path, 
+     * so the root node will be a selected element whenever a child is 
+     * selected.
+	 * 
+     * @return the currently selected elements.
+	 */
+    public ACSElement[] getSelectedElements() {
+        TreePath[] path = getSelectionPaths();
+        List values = new LinkedList();
+        for(int i = 0; path != null && i < path.length; i++) {
+            TreePath curr = path[i];
+            for(int j = 0; j < curr.getPathCount(); j++) {
+                Object item = curr.getPathComponent(j);
+                if(item instanceof ACSElement) {
+                    values.add(item);
+                }
+            }
+        }
+
+        ACSElement[] retval = new ACSElement[values.size()];
+        values.toArray(retval);
+        return retval;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/acs-element.properties b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/acs-element.properties
new file mode 100644
index 0000000..b872754
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/acs-element.properties
@@ -0,0 +1,12 @@
+#
+# Property file mapping DOM nodes to Java class names.
+#
+
+# The default element
+*Element=org.apache.tools.ant.gui.acs.ACSDefaultElement
+
+# Specific elements.
+project=org.apache.tools.ant.gui.acs.ACSProjectElement
+property=org.apache.tools.ant.gui.acs.ACSPropertyElement
+target=org.apache.tools.ant.gui.acs.ACSTargetElement
+task=org.apache.tools.ant.gui.acs.ACSTaskElement
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/package.html b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/package.html
new file mode 100644
index 0000000..73f3f6e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/acs/package.html
@@ -0,0 +1,9 @@
+<HTML><BODY> <H1>Ant Construction Set</H1> 
+
+<P>This package contains the tools for constructing and manipulating an Ant
+build file</P>
+
+<P><B>NB</B>: Requires the <A HREF="http://java.sun.com/xml">Java API for XML
+Parsing</A> from Sun.</P>
+</BODY>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AboutCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AboutCmd.java
new file mode 100644
index 0000000..f00b76e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AboutCmd.java
@@ -0,0 +1,84 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.About;
+import java.awt.Window;
+import java.awt.event.WindowEvent;
+
+
+/**
+ * Handler for the About command.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class AboutCmd extends AbstractCommand {
+
+	/** 
+	 * Standard constructor. 
+	 * 
+	 */
+    public AboutCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Show the about box.
+	 * 
+	 */
+    public void run() {
+		new About(getContext());
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AbstractCommand.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AbstractCommand.java
new file mode 100644
index 0000000..585bc37
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/AbstractCommand.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+
+
+/**
+ * Convenience base class for Command implementations.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class AbstractCommand implements Command {
+	/** Application context. */
+	private AppContext _context = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    protected AbstractCommand(AppContext context) {
+        _context = context;
+    }
+
+	/** 
+	 * Get the application context that was provided to setContext();
+	 * 
+	 * @return Application context.
+	 */
+    protected AppContext getContext() {
+        return _context;
+    }
+
+	/** 
+	 * Run the command. From interface Runnable.
+	 * 
+	 */
+    public abstract void run();
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/BuildCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/BuildCmd.java
new file mode 100644
index 0000000..42319eb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/BuildCmd.java
@@ -0,0 +1,122 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+q *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.ErrorEvent;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+
+/**
+ * Starts an Ant build.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildCmd extends AbstractCommand {
+
+    /** Project to build. */
+    private ACSProjectElement _project = null;
+    /** Targets to build. */
+    private ACSTargetElement[] _targets = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 */
+    public BuildCmd(AppContext context) { 
+        super(context);
+    }
+
+    /** 
+     * Set the specific project to build (instead of the default).
+     * 
+     * @param project Project to build.
+     */
+    public void setProject(ACSProjectElement project) {
+        _project = project;
+    }
+
+    /** 
+     * Set the specific targets to build (instead of the default).
+     * 
+     * @param targets Array of targets to build.
+     */
+    public void setTargets(ACSTargetElement[] targets) {
+        _targets = targets;
+    }
+
+	/** 
+	 * Start the Ant build.
+	 * 
+	 */
+    public void run() {
+        if(_project == null) {
+            _project = getContext().getSelectionManager().getSelectedProject();
+        }
+
+        if(_targets == null) {
+            _targets = getContext().getSelectionManager().getSelectedTargets();
+        }
+
+        if(_project != null) {
+            try {
+                getContext().getProjectManager().build(_project, _targets);
+            }
+            catch(Throwable ex) {
+                getContext().getEventBus().postEvent(
+                    new ErrorEvent(getContext(), ex));
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ChangeLookAndFeelCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ChangeLookAndFeelCmd.java
new file mode 100644
index 0000000..4e03f62
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ChangeLookAndFeelCmd.java
@@ -0,0 +1,81 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.util.ChangeLookAndFeel;
+
+/**
+ * ChangeLookAndFeel command.
+ *
+ * @version $Revision: 1.5 $
+ * @author Erik Meade
+ * @author Simeon Fitch
+ */
+public class ChangeLookAndFeelCmd extends AbstractCommand {
+	/**
+	 * Standard ctor.
+	 *
+	 */
+    public ChangeLookAndFeelCmd(AppContext context) {
+        super(context);
+    }
+
+	/**
+	 * Successfully do nothing.
+	 *
+	 */
+    public void run() {
+		new ChangeLookAndFeel(getContext());
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/CloseCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/CloseCmd.java
new file mode 100644
index 0000000..a0c6a5a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/CloseCmd.java
@@ -0,0 +1,111 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.ProjectClosedEvent;
+import org.apache.tools.ant.gui.event.ProjectSelectedEvent;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+
+
+/**
+ * Handler for the close command.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class CloseCmd extends AbstractCommand {
+
+    /** Project to close. */
+    private ACSProjectElement _project = null;
+
+	/** 
+	 * Standard constructor. 
+	 * 
+	 */
+    public CloseCmd(AppContext context) {
+        super(context);
+    }
+
+    /** 
+     * Set the specific project to close (instead of the default).
+     * 
+     * @param project Project to close.
+     */
+    public void setProject(ACSProjectElement project) {
+        _project = project;
+    }
+
+	/** 
+	 * Send a close event to the parent window. 
+	 * 
+	 */
+    public void run() {
+        if(_project == null) {
+            _project = getContext().getSelectionManager().getSelectedProject();
+        }
+
+        if(_project != null) {
+            getContext().getProjectManager().close(_project);
+            getContext().getEventBus().postEvent(
+                new ProjectClosedEvent(getContext()));
+
+            ACSProjectElement[] open = 
+                getContext().getProjectManager().getOpen();
+            if(open != null && open.length > 0) {
+                getContext().getEventBus().postEvent(
+                    new ProjectSelectedEvent(getContext(), open[0]));
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/Command.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/Command.java
new file mode 100644
index 0000000..a72994b
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/Command.java
@@ -0,0 +1,72 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+
+
+
+/**
+ * Interface for commands. 
+ * Details TBD
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public interface Command extends Runnable {
+	/** 
+	 * Run the command. From interface Runnable.
+	 * 
+	 */
+    void run();
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/DisplayErrorCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/DisplayErrorCmd.java
new file mode 100644
index 0000000..5406771
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/DisplayErrorCmd.java
@@ -0,0 +1,164 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.util.StackFrame;
+import javax.swing.*;
+import java.awt.FlowLayout;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+
+/**
+ * Command for displaying an arbitrary error message to the user.
+ *
+ * @version $Revision: 1.7 $ 
+ * @author Simeon H.K. Fitch 
+ */
+public class DisplayErrorCmd extends AbstractCommand {
+    /** Text description of error. */
+    private String _message = null;
+    /** Throwable associated with the error. */
+    private Throwable _ex = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public DisplayErrorCmd(AppContext context) {
+        this(context, null, null);
+    }
+
+	/** 
+	 * No Throwable constructor.
+	 * 
+	 * @param context Application context.
+	 * @param message Error message.
+	 */
+    public DisplayErrorCmd(AppContext context, String message) {
+        this(context, message, null);
+    }
+
+	/** 
+	 * Standard constuctor.
+	 * 
+	 * @param context Application context.
+	 * @param message Error message.
+	 * @param ex Throwable assocated with error.
+	 */
+    public DisplayErrorCmd(AppContext context, String message, Throwable ex) {
+        super(context);
+        _message = message;
+        _ex = ex;
+    }
+
+	/** 
+	 * Set the error message.
+	 * 
+	 * @param message Error message.
+	 */
+    public void setMessage(String message) {
+        _message = message;
+    }
+
+	/** 
+	 * Set the throwable associated with the error.
+	 * 
+	 * @param ex Throwable associated with the error.
+	 */
+    public void setThrowable(Throwable ex) {
+        _ex = ex;
+    }
+
+	/** 
+	 * Display the error.
+	 * 
+	 */
+    public void run() {
+        String title = getContext().getResources().
+            getString(getClass(), "title"); 
+
+        JOptionPane.showMessageDialog(
+            getContext().getParentFrame(), new MsgPanel(),
+            title, JOptionPane.ERROR_MESSAGE);
+    }
+
+    // Panel for assembling the error information.
+    private class MsgPanel extends JPanel implements ActionListener {
+        public MsgPanel() {
+            setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));
+            add(new JLabel(_message));
+            if(_ex != null) {
+                add(new JLabel(_ex.getMessage()));
+                JButton b = new JButton(getContext().getResources().
+                                        getString(DisplayErrorCmd.class, 
+                                                  "expand"));
+                b.addActionListener(this);
+                add(Box.createVerticalStrut(20));
+                add(b);
+            }
+        }
+        // Called when the user clicks the expand button.
+        public void actionPerformed(ActionEvent e) {
+            JComponent source = (JComponent) e.getSource();
+            JComponent parent = (JComponent) source.getParent();
+            parent.remove(source);
+            JTextArea text = new JTextArea();
+            text.setEditable(false);
+            text.setText(StackFrame.toString(_ex));
+            parent.add(new JScrollPane(text));
+            SwingUtilities.windowForComponent(parent).pack();
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/EmacsNotifyCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/EmacsNotifyCmd.java
new file mode 100644
index 0000000..cd9bd6d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/EmacsNotifyCmd.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.ide.EmacsNotifier;
+
+/**
+ * Toggle on or off the sending of error events to emacs so that 
+ * it can display the source of the error.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public class EmacsNotifyCmd extends AbstractCommand {
+    /** A global notifier can be used as it stores no state. */
+    private static EmacsNotifier _notifier = new EmacsNotifier();
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public EmacsNotifyCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Turn on or off the notifying of emacs.
+	 * 
+	 */
+    public void run() {
+        if(getContext().getProjectManager().
+           isRegisteredBuildListener(_notifier)) {
+            getContext().getProjectManager().removeBuildListener(_notifier);
+        }
+        else {
+            getContext().getProjectManager().addBuildListener(_notifier);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ExitCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ExitCmd.java
new file mode 100644
index 0000000..25d38a2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/ExitCmd.java
@@ -0,0 +1,86 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.util.WindowUtils;
+
+import java.awt.Window;
+import java.awt.event.WindowEvent;
+
+
+/**
+ * Handler for an exit command .
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class ExitCmd extends AbstractCommand {
+	/** 
+	 * Standard constructor. 
+	 * 
+	 * @param context Application context.
+	 */
+    public ExitCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Send a close event to the parent window. 
+	 * 
+	 */
+    public void run() {
+        // Manually send a window close event to the window.
+		WindowUtils.sendCloseEvent(getContext().getParentFrame());
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/LoadFileCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/LoadFileCmd.java
new file mode 100644
index 0000000..e729071
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/LoadFileCmd.java
@@ -0,0 +1,119 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.ErrorEvent;
+import org.apache.tools.ant.gui.event.NewProjectEvent;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import java.io.File;
+import java.io.IOException;
+
+/**
+ * Command for reading in a build file and initializing the data model.
+ * 
+ * @version $Revision: 1.9 $ 
+ * @author Simeon Fitch 
+ */
+public class LoadFileCmd extends  AbstractCommand {
+    /** The file to load. */
+    private File _file = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public LoadFileCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Set the file to load.
+	 * 
+	 * @param file File to load.
+	 */
+    public void setFile(File file) {
+        _file = file;
+    }
+
+	/** 
+	 * Open the file and load it.
+	 * 
+	 */
+    public void run() {
+        if(!_file.exists()) {
+            String message = getContext().getResources().getMessage(
+                getClass(), "noFile", new Object[] { _file.toString() });
+
+            getContext().getEventBus().
+                postEvent(new ErrorEvent(getContext(), message));
+        }
+        else {
+            try {
+                ACSProjectElement project =
+                    getContext().getProjectManager().open(_file);
+                getContext().getEventBus().postEvent(
+                    new NewProjectEvent(getContext(), project));
+            }
+            catch(Exception ex) {
+                String message = getContext().getResources().getMessage(
+                    getClass(), "loadError", 
+                    new Object[] { _file.toString() });
+
+                getContext().getEventBus().
+                    postEvent(new ErrorEvent(getContext(), message, ex));
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewProjectCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewProjectCmd.java
new file mode 100644
index 0000000..604661a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewProjectCmd.java
@@ -0,0 +1,92 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.NewProjectEvent;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+
+/**
+ * Command for creating a new project.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class NewProjectCmd extends AbstractCommand {
+    /** New project count for this session. Used to create default names, 
+     *  numbered as a convenience. */
+    private static int _count = 1;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public NewProjectCmd(AppContext context) {
+        super(context);
+    }
+
+    /** 
+     * Create a new project and make it active.
+     * 
+     */
+    public void run() {
+        ACSProjectElement project = 
+            getContext().getProjectManager().createNew();
+        project.setName(getContext().getResources().
+                        getString(getClass(), "defName") + " " + _count++);
+        getContext().getEventBus().postEvent(
+            new NewProjectEvent(getContext(), project));
+        
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewPropertyCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewPropertyCmd.java
new file mode 100644
index 0000000..5941a52
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewPropertyCmd.java
@@ -0,0 +1,93 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.NewPropertyEvent;
+import org.apache.tools.ant.gui.acs.*;
+
+/**
+ * Command for creating a new propertyh.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class NewPropertyCmd extends AbstractCommand {
+    /** New count for this session. Used to create default names, 
+     *  numbered as a convenience. */
+    private static int _count = 1;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */ 
+    public NewPropertyCmd(AppContext context) {
+        super(context);
+    }
+
+    /** 
+     * Create a new property and make it active.
+     * 
+     */
+    public void run() {
+        ACSElement[] vals = getContext().getSelectionManager().
+            getSelectedElements();
+        if(vals != null && vals.length > 0) {
+            ACSPropertyElement retval = 
+                ACSFactory.getInstance().createProperty(vals[vals.length - 1]);
+            getContext().getEventBus().postEvent(
+                new NewPropertyEvent(getContext(),  retval));
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTargetCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTargetCmd.java
new file mode 100644
index 0000000..9d2d01f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTargetCmd.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.NewTargetEvent;
+import org.apache.tools.ant.gui.acs.*;
+
+/**
+ * Command for creating a new target.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class NewTargetCmd extends AbstractCommand {
+    /** New project count for this session. Used to create default names, 
+     *  numbered as a convenience. */
+    private static int _count = 1;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public NewTargetCmd(AppContext context) {
+        super(context);
+    }
+
+    /** 
+     * Create a new target and make it active.
+     * 
+     */
+    public void run() {
+        ACSProjectElement project = getContext().getSelectionManager().
+            getSelectedProject();
+        ACSTargetElement retval = 
+            ACSFactory.getInstance().createTarget(project);
+        retval.setName(getContext().getResources().
+                        getString(getClass(), "defName") + " " + _count++);
+        getContext().getEventBus().postEvent(
+            new NewTargetEvent(getContext(),  retval));
+        
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTaskCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTaskCmd.java
new file mode 100644
index 0000000..b6c05c6
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NewTaskCmd.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.NewTaskEvent;
+import org.apache.tools.ant.gui.acs.*;
+
+/**
+ * Command for creating a new task.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class NewTaskCmd extends AbstractCommand {
+    /** New count for this session. Used to create default names, 
+     *  numbered as a convenience. */
+    private static int _count = 1;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public NewTaskCmd(AppContext context) {
+        super(context);
+    }
+
+    /** 
+     * Create a new task and make it active.
+     * 
+     */
+    public void run() {
+        ACSTargetElement[] targets = getContext().getSelectionManager().
+            getSelectedTargets();
+        if(targets != null && targets.length > 0) {
+            ACSTaskElement retval = 
+                ACSFactory.getInstance().createTask(targets[0]);
+            retval.setTaskType("javac");
+            getContext().getEventBus().postEvent(
+                new NewTaskEvent(getContext(),  retval));
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NoOpCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NoOpCmd.java
new file mode 100644
index 0000000..f2ef831
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/NoOpCmd.java
@@ -0,0 +1,78 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * NoOp command.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class NoOpCmd extends AbstractCommand {
+	/** 
+     * Standard ctor.
+     * 
+	 * @param context Application context.
+	 */
+    public NoOpCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Successfully do nothing.
+	 * 
+	 */
+    public void run() {}
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/OpenCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/OpenCmd.java
new file mode 100644
index 0000000..89143f0
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/OpenCmd.java
@@ -0,0 +1,98 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.OpenRequestEvent;
+import org.apache.tools.ant.gui.core.XMLFileFilter;
+import javax.swing.JFileChooser;
+import javax.swing.filechooser.FileFilter;
+import java.io.File;
+
+/**
+ * Command to execute the opening of a file. A dialog is presented to the
+ * user for selecting a build file to open. If a file is selected then an
+ * OpenRequestEvent is posted.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public class OpenCmd extends AbstractCommand {
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public OpenCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Display a dialog asking the user to select a file to open.
+     * If one is selected then an event is posted requesting the open 
+     * operation be completed.
+	 * 
+	 */
+    public void run() {
+        FileFilter filter = new XMLFileFilter(getContext().getResources());
+
+        JFileChooser chooser = new JFileChooser();
+        chooser.addChoosableFileFilter(filter);
+        int val = chooser.showOpenDialog(getContext().getParentFrame());
+        if(val == JFileChooser.APPROVE_OPTION) {
+            File selected = chooser.getSelectedFile();
+            getContext().getEventBus().postEvent(
+                new OpenRequestEvent(getContext(), selected));
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveAsCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveAsCmd.java
new file mode 100644
index 0000000..1499a76
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveAsCmd.java
@@ -0,0 +1,181 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.ErrorEvent;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import java.io.*;
+import org.apache.tools.ant.gui.core.XMLFileFilter;
+import javax.swing.JFileChooser;
+import javax.swing.filechooser.FileFilter;
+import javax.swing.JOptionPane;
+import java.net.URL;
+import java.net.MalformedURLException;
+
+
+/**
+ * Command for doing a "Save as" type of save.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class SaveAsCmd extends AbstractCommand {
+    /** File to save to. */
+    private URL _location = null;
+    /** Project to save. */
+    private ACSProjectElement _project = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public SaveAsCmd(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Set the location to save to
+	 * 
+	 * @param location location to save to.
+	 */
+    public void setLocation(URL location) {
+        _location = location;
+    }
+
+    /** 
+     * Set the specific project to save (instead of the default).
+     * 
+     * @param project Project to save.
+     */
+    public void setProject(ACSProjectElement project) {
+        _project = project;
+    }
+
+
+	/** 
+	 * Save the project to the current file name.
+	 * 
+	 */
+    public void run() {
+        FileFilter filter = new XMLFileFilter(getContext().getResources());
+
+        if(_project == null) {
+            _project = getContext().getSelectionManager().getSelectedProject();
+        }
+
+        if(_project != null) {
+            // If no location is specified, then this truly is a SaveAs 
+            // command. Provide the user the UI to select the output.
+            if(_location == null) {
+                JFileChooser chooser = new JFileChooser();
+                chooser.addChoosableFileFilter(filter);
+                int val = chooser.showSaveDialog(
+                    getContext().getParentFrame());
+                if(val == JFileChooser.APPROVE_OPTION) {
+                    File file = chooser.getSelectedFile();
+                    if(file.exists()) {
+                        String title = getContext().getResources().
+                            getString(SaveCmd.class, "title");
+                        String message = getContext().getResources().
+                            getMessage(SaveCmd.class, "overwrite", 
+                                       new Object[] { file.toString()});
+                        val = JOptionPane.showConfirmDialog(
+                            getContext().getParentFrame(), message, title, 
+                            JOptionPane.YES_NO_OPTION);
+                        // If cancelled unset file.
+                        if(val != JOptionPane.YES_OPTION) {
+                            return;
+                        }
+                    }
+                    try {
+                        _location = new URL(
+                            "file", null, file.getAbsolutePath());
+                    }
+                    catch(MalformedURLException ex) {
+                        // Shouldn't happen. Save will just not
+                        // happen.
+                        ex.printStackTrace();
+                    }
+                }
+            }
+            
+            // If a location is now available, do the save operation.
+            if(_location != null) {
+                try {
+                    getContext().getProjectManager().saveAs(
+                        _project, _location);
+                }
+                catch(IOException ex) {
+                    String message = getContext().getResources().getMessage(
+                        SaveCmd.class, "saveError", 
+                        new Object[] { _location.toString() });
+                    
+                    getContext().getEventBus().
+                        postEvent(new ErrorEvent(getContext(), message, ex));
+                }
+            }
+        }
+        else {
+            // We shouldn't ever get here.
+            String message = getContext().getResources().getString(
+                SaveCmd.class, "noProject"); 
+            
+            getContext().getEventBus().
+                postEvent(new ErrorEvent(getContext(), message));
+            
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveCmd.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveCmd.java
new file mode 100644
index 0000000..869e2d8
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/command/SaveCmd.java
@@ -0,0 +1,79 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.command;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+
+/**
+ * Command to execute the saving of the current build file.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public class SaveCmd extends SaveAsCmd {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 */
+    public SaveCmd(AppContext context) {
+        super(context);
+        ACSProjectElement project = 
+            getContext().getSelectionManager().getSelectedProject();
+        if(project != null) {
+            setLocation(project.getLocation());
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ActionManager.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ActionManager.java
new file mode 100644
index 0000000..dd63596
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ActionManager.java
@@ -0,0 +1,337 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.command.Command;
+import javax.swing.*;
+import java.util.*;
+import java.lang.reflect.Constructor;
+
+/**
+ * Manager of antidote actions. Receives its configuration from the action
+ * ResourceBundle.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ActionManager {
+    /** Parameters for the Command constructor. */
+    private static final Class[] COMMAND_CTOR_PARAMS = { AppContext.class };
+
+    /** Externalized resources. */
+    private ResourceManager _resources = null;
+
+    /** Array of action identifiers. */
+    private String[] _actionIDs = null;
+
+    /** Look table of all defined actions. */
+    private Map _actions = new HashMap();
+
+    /** Event bus. */
+    private EventBus _bus = null;
+    /** Class for storing the event type to action type
+     *  mapping for setting enabled state. */
+    private EventToActionMapper _mapper = null;
+
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param bus Event bus to post events to.
+     * @param resources Location of resources.
+	 */
+    public ActionManager(EventBus bus, ResourceManager resources) {
+        _bus = bus;
+        _resources = resources;
+        bus.addMember(EventBus.RESPONDING, new Enabler());
+
+        _mapper = new EventToActionMapper();
+
+        // Configure the set of actions.
+        String[] names = _resources.getStringArray("actions");
+        _actionIDs = new String[names.length];
+        for(int i = 0; i < _actionIDs.length; i++) {
+            _actionIDs[i] = names[i];
+            AntAction action = new AntAction(_resources, _bus, _actionIDs[i]);
+            _actions.put(_actionIDs[i], action);
+
+            // For each action we need to add the reverse event trigger
+            // lookup.
+            _mapper.addAction(action);
+        }
+    }
+
+	/** 
+	 * Create a menubar for the application based on the configuration file.
+	 * 
+	 * @return Menubar.
+	 */
+    public JMenuBar createMenuBar() {
+        JMenuBar retval = new JMenuBar();
+        Map menus = new HashMap();
+
+        String toTok = _resources.getString("menus");
+        StringTokenizer tok = new StringTokenizer(toTok, ", ");
+        while(tok.hasMoreTokens()) {
+            String name = tok.nextToken();
+            JMenu menu = new JMenu(name);
+
+            // XXX should be in config file
+            menu.setMnemonic(name.charAt(0));
+
+            // XXX need to i18n here...
+            if(name.equalsIgnoreCase("help")) {
+                try {
+                    retval.setHelpMenu(menu);
+                }
+                catch(Error err) {
+                    // Catch the "not implemented" error in
+                    // some (all?) Swing implementations
+                    retval.add(menu);
+                }
+            }
+            else {
+                retval.add(menu);
+            }
+            menus.put(name, menu);
+        }
+
+        for(int i = 0; i < _actionIDs.length; i++) {
+            AntAction action = (AntAction) _actions.get(_actionIDs[i]);
+            String parent = action.getParentMenuName();
+            if(parent != null) {
+                JMenu menu = (JMenu) menus.get(parent);
+                // A well configured file shouldn't cause this,
+                // but be safe anyway.
+                if(menu == null) {
+                    menu = new JMenu(parent);
+                    retval.add(menu);
+                    menus.put(parent, menu);
+                }
+
+                // See if we should add a separator.
+                if(action.isPreceededBySeparator() && 
+                   menu.getMenuComponentCount() > 0) {
+                    menu.addSeparator();
+                }
+
+                if(!action.isToggle()) {
+                    JMenuItem item = menu.add(action);
+                    item.setAccelerator(action.getAccelerator());
+                    addNiceStuff(item, action);
+                }
+                else {
+                    JCheckBoxMenuItem b = 
+                        new JCheckBoxMenuItem(action.getName());
+                    b.setActionCommand(action.getID());
+                    b.addActionListener(action);
+                    // XXX eck. This is a 1.3 feature. Fix ME!
+                    // Need to provide binding between action and widget.
+//                    b.setAction(action);
+                    addNiceStuff(b, action);
+                    menu.add(b);
+                }
+
+            }
+        }
+
+        return retval;
+    }
+
+	/** 
+	 * Create a tool bar based on the current configuration.
+	 * 
+	 * @return Toolbar ready for action.
+	 */
+    public JToolBar createToolBar() {
+        JToolBar retval = new JToolBar();
+        
+        for(int i = 0; i < _actionIDs.length; i++) {
+            AntAction action = (AntAction) _actions.get(_actionIDs[i]);
+            // If it has an icon, then we add it to the toolbar.
+            if(action.getIcon() != null) {
+                if(action.isPreceededBySeparator()) {
+                    retval.addSeparator();
+                }
+
+                JButton button = retval.add(action);
+                button.setText(null);
+
+                addNiceStuff(button, action);
+            }
+        }
+
+        return retval;
+    }
+
+	/** 
+	 * Create a popup menu with the given actionIDs.
+     * XXX check this for object leak. Does the button
+     * get added to the action as a listener? There are also some
+     * changes to this behavior in 1.3.
+	 * 
+	 * @param actionIDs List of action IDs for actions
+     *  to appear in popup menu.
+	 * @return Popup menu to display.
+	 */
+    public JPopupMenu createPopup(String[] actionIDs) {
+        JPopupMenu retval = new JPopupMenu();
+
+        for(int i = 0; i < actionIDs.length; i++) {
+            AntAction action = (AntAction) _actions.get(actionIDs[i]);
+            if(action != null) {
+                AbstractButton button = retval.add(action);
+                addNiceStuff(button, action);
+            }
+        }
+
+        return retval;
+    }
+
+	/** 
+	 * Get the command assocaited with the Action with the given id.
+	 * 
+	 * @param actionID Id of action to get command for.
+	 * @return Command associated with action, or null if none available.
+	 */
+    public Command getActionCommand(String actionID, AppContext context) {
+        Command retval = null;
+        AntAction action = (AntAction) _actions.get(actionID);
+        if(action != null) {
+            Class clazz = action.getCommandClass();
+            if(clazz != null) {
+                try {
+                    Constructor ctor = 
+                        clazz.getConstructor(COMMAND_CTOR_PARAMS);
+                    retval = (Command) ctor.newInstance(
+                        new Object[] { context });
+                }
+                catch(Exception ex) {
+                    // XXX log me.
+                    ex.printStackTrace();
+                }
+            }
+        }
+        return retval;
+    }
+
+
+	/** 
+	 * Add tool tip, Mnemonic, etc.
+	 * 
+	 * @param button Button to work on. 
+	 * @param action Associated action.
+	 */
+    private void addNiceStuff(AbstractButton button, AntAction action) {
+        // Set the action command so that it is consitent
+        // no matter what language the display is in.
+        button.setActionCommand(action.getID());
+
+        // XXX this should be moved to the config file.
+        String label = button.getText();
+        if(label != null) {
+            button.setMnemonic(label.charAt(0));
+        }
+
+        String tip = action.getShortDescription();
+        if(tip != null) {
+            button.setToolTipText(tip);
+        }
+    }
+
+
+    /** Class for updating the enabled status of icons based
+     *  on the events seen. */
+    private class Enabler implements BusMember {
+        private final Filter _filter = new Filter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Receives all events.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            _mapper.applyEvent(event);
+            return true;
+        }
+    }
+
+    /** Class providing filtering for project events. */
+    private static class Filter implements BusFilter {
+        /** 
+         * Determines if the given event should be accepted.
+         * 
+         * @param event Event to test.
+         * @return True if event should be given to BusMember, false otherwise.
+         */
+        public boolean accept(EventObject event) {
+            return true;
+        }
+    }
+
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntAction.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntAction.java
new file mode 100644
index 0000000..bcefb1e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntAction.java
@@ -0,0 +1,316 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import javax.swing.*;
+import java.net.URL;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.util.*;
+
+import org.apache.tools.ant.gui.event.EventBus;
+
+/**
+ * Class representing an action in the Antidote application. 
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class AntAction extends AbstractAction {
+    /** Property name for the parent menu item. */
+    public static final String PARENT_MENU_NAME = "parentMenuName";
+    public static final String SEPARATOR = "separator";
+    public static final String ACCELERATOR = "accelerator";
+    public static final String ENABLED = "enabled";
+    public static final String ENABLE_ON = "enableOn";
+    public static final String DISABLE_ON = "disableOn";
+    public static final String TOGGLE = "toggle";
+    public static final String COMMAND = "command";
+
+    /** Property resources. */
+    private  ResourceManager _resources =  null;
+    /** Event bus. */
+    private EventBus _bus = null;
+    /** Unique id. */
+    private String _id = null;
+
+    /** Events that the action should cause transition to the 
+     *  enabled(true) state. */
+    private Class[] _enableOn = null;
+    /** Events that the action should cause transition to the 
+     *  enabled(false) state. */
+    private Class[] _disableOn = null;
+    /** Flag indicating toggle action. */
+    private boolean _toggle = false;
+
+
+    /** 
+     * Standard ctor.
+     * 
+     * @param id Unique id for the action
+     */
+    public AntAction(ResourceManager resources, EventBus bus, String id) {
+        _resources = resources;
+        _bus = bus;
+        _id = id;
+        putValue(NAME, getString("name"));
+        putValue(SHORT_DESCRIPTION, getString("shortDescription"));
+        putValue(PARENT_MENU_NAME, getString(PARENT_MENU_NAME));
+        putValue(SEPARATOR, getString(SEPARATOR));
+
+
+        // Set the default enabled state.
+        String enabled = getString(ENABLED);
+        if(enabled != null) {
+            setEnabled(Boolean.valueOf(enabled).booleanValue());
+        }
+
+        // Set an accellerator if any.
+        String accelerator = getString(ACCELERATOR);
+        if(accelerator != null) {
+            putValue(ACCELERATOR, KeyStroke.getKeyStroke(accelerator));
+        }
+
+        // Check to see if action is a toggle action.
+        String toggle = getString(TOGGLE);
+        if(toggle != null) {
+            _toggle = Boolean.valueOf(toggle).booleanValue();
+        }
+
+        // See if there is a command associated with the action.
+        String command = getString(COMMAND);
+        if(command != null) {
+            try {
+                Class cmd = Class.forName(command);
+                putValue(COMMAND, cmd);
+            }
+            catch(Exception ex) {
+                // XXX log me.
+                ex.printStackTrace();
+            }
+        }
+
+        // Add an icon if any (which means it'll show up on the tool bar).
+        String iconName = getString("icon");
+        if(iconName != null) {
+            putValue(SMALL_ICON, _resources.loadImageIcon(iconName));
+        }
+
+        _enableOn = resolveClasses(getString(ENABLE_ON));
+        _disableOn = resolveClasses(getString(DISABLE_ON));
+
+    }
+        
+	/** 
+	 * Convenience method for looking put a resource with the name
+     * "id.key". Will return null if the resource doesn't exist.
+	 * 
+	 * @param key Key name for the action.
+	 * @return String resource for composite key, or null if not found.
+	 */
+    private String getString(String key) {
+        String retval = null;
+        try {
+            retval = _resources.getString(_id + "." + key);
+        }
+        catch(MissingResourceException ex) {
+            // Its ok to be missing a resource name...
+            // Too bad the API throws an exception in this case. 
+        }
+        return retval;
+    }
+
+
+	/** 
+	 * Parse out the list of classes from the given string and
+     * resolve them into classes.
+	 * 
+	 * @param classNames Comma delimited list of class names.
+	 */
+    private Class[] resolveClasses(String classNames) {
+        if(classNames == null) return null;
+
+        StringTokenizer tok = new StringTokenizer(classNames, ", ");
+        Vector vals = new Vector();
+        while(tok.hasMoreTokens()) {
+            String name = tok.nextToken();
+            try {
+                vals.addElement(Class.forName(name));
+            }
+            catch(ClassNotFoundException ex) {
+                //XXX log me.
+                System.err.println(
+                    "Warning: the event class " + name + 
+                    " was not found. Please check config file.");
+            }
+        }
+
+        Class[] retval = new Class[vals.size()];
+        vals.copyInto(retval);
+        return retval;
+    }
+
+    /** 
+     * Unique id for the action.
+     * 
+     * @return Action id.
+     */
+    public String getID() {
+        return _id;
+    }
+
+    /** 
+     * Get the name of the menu in the menu bar that this action shoul
+     * appear under.
+     * 
+     * @return Menu to appear under, or null if not a menu action.
+     */
+    public String getParentMenuName() {
+        return (String) getValue(PARENT_MENU_NAME);
+    }
+        
+    /** 
+     * Get the localized name for the action.
+     * 
+     * @return Name
+     */
+    public String getName() {
+        return (String) getValue(NAME);
+    }
+        
+    /** 
+     * Get the short description. Used in tool tips.
+     * 
+     * @return Short description.
+     */
+    public String getShortDescription() {
+        return (String) getValue(SHORT_DESCRIPTION);
+    }
+        
+    /** 
+     * Determine if a separator should appear before the action.
+     * 
+     * @return True if add separator, false otherwise.
+     */
+    public boolean isPreceededBySeparator() {
+        return Boolean.valueOf(
+            String.valueOf(getValue(SEPARATOR))).booleanValue();
+    }
+
+    /** 
+     * Get the icon.
+     * 
+     * @return Icon for action, or null if none.
+     */
+    public Icon getIcon() {
+        return (Icon) getValue(SMALL_ICON);
+    }
+
+	/** 
+	 * Get the accelerator keystroke.
+	 * 
+	 * @return Accelerator
+	 */
+    public KeyStroke getAccelerator() {
+        return (KeyStroke) getValue(ACCELERATOR);
+    }
+
+
+	/** 
+	 * Get the event types which should cause this to go to the
+     * enabled state.
+	 * 
+	 */
+    public Class[] getEnableOnEvents() {
+        return _enableOn;
+    }
+
+	/** 
+	 * Get the event types which should cause this to go to 
+     * this disabled state.
+	 * 
+	 */
+    public Class[] getDisableOnEvents() {
+        return _disableOn;
+    }
+
+	/** 
+	 * True if this is a toggle action, false otherwise.
+	 * 
+	 * @return True if this is a toggle action, false otherwise.
+	 */
+    public boolean isToggle() {
+        return _toggle;
+    }
+
+
+	/** 
+	 * Get the assciated command class.
+	 * 
+	 * @return Command class.
+	 */
+    public Class getCommandClass() {
+        return (Class) getValue(COMMAND);
+    }
+
+    /** 
+     * Pass the action on to the EventBus.
+     * 
+     * @param e Event to forward.
+     */
+    public void actionPerformed(ActionEvent e) {
+        _bus.postEvent(e);
+    }
+}
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntModule.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntModule.java
new file mode 100644
index 0000000..b126edb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AntModule.java
@@ -0,0 +1,122 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import javax.swing.JComponent;
+import javax.swing.BorderFactory;
+
+/**
+ * Abstract base class for a "module", which is really anything that
+ * can send or receive events, or edit or view the model.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class AntModule extends JComponent {
+
+    /** The application context. */
+    private AppContext _context = null;
+
+    /** 
+     * Default constructor.
+     */
+    protected AntModule() {
+        // Create a dummy border so that the widget will at least have a
+        // minimal display in a bean environment.
+        setBorder(BorderFactory.createTitledBorder(getClass().getName()));
+    }
+
+    /** 
+     * This method is called after instantiation when the application context
+     * is available for constructing the class' display. Think of this in
+     * a similar manner to Applet.init() or Servlet.init(). It should 
+     * immediately call #setContext() with the given parameter.
+     * 
+     * @param context Valid application context providing
+     *                all required resources.  
+     */
+    public abstract void contextualize(AppContext context);
+
+    /** 
+     * Set the application context.
+     * 
+     * @param context Application context.
+     */
+    protected void setContext(AppContext context) {
+        _context = context;
+        setBorder(_context == null ? null : 
+                  BorderFactory.createTitledBorder(getName()));
+    }
+
+    /** 
+     * Get the application context.
+     * 
+     * @return Application context.
+     */
+    public AppContext getContext() {
+        if(_context == null) {
+            throw new IllegalStateException(
+                "The AppContext has not been set.");
+        }
+        return _context;
+    }
+    /** 
+     * Get the name of the editor.
+     * 
+     * @return Editor's name.
+     */
+    public String getName() {
+        return getContext().getResources().getString(getClass(), "name");
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AppContext.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AppContext.java
new file mode 100644
index 0000000..73304bf
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/AppContext.java
@@ -0,0 +1,164 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+import java.awt.Frame;
+import java.util.*;
+
+/**
+ * A container for the state information for the application. Provides
+ * a centeralized place to gain access to resources and data.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public class AppContext {
+    /** Event bus. */
+    private EventBus _eventBus = new EventBus();
+    /** Application resources. */
+    private ResourceManager _resources = new ResourceManager();
+    /** The project manager. */
+    private ProjectManager _projectManager = new ProjectManager();
+    /** Thing that keeps track of the current selection state. */
+    private SelectionManager _selectionManager = new SelectionManager();
+
+    /** Application actions. */
+    private ActionManager _actions = 
+        new ActionManager(_eventBus, new ResourceManager(
+            "org.apache.tools.ant.gui.resources.action"));
+
+    /** Parent frame used in various operations. XXX what do we do 
+     *  in the applet context. */
+    private Frame _parentFrame = null;
+
+    /** 
+     * Constructor of apps that don't have a graphical
+     * component (e.g. web based).
+     *  
+     */
+    public AppContext() {
+        this(null);
+    }
+
+    /** 
+     * Standard constructor.
+     * 
+     * @param parent Parent frame. XXX may go away.
+     */
+    public AppContext(Frame parent) {
+        _parentFrame = parent;
+        BuildEventForwarder handler = new BuildEventForwarder(this);
+        _projectManager.addBuildListener(handler);
+        _eventBus.addMember(EventBus.MONITORING, _selectionManager);
+    }
+
+	/** 
+	 * Get the parent frame. XXX may change...
+	 * 
+	 * @return Parent frame.
+	 */
+    public Frame getParentFrame() {
+        return _parentFrame;
+    }
+
+	/** 
+	 * Get the localized resources.
+	 * 
+	 * @return Resources.
+	 */
+    public ResourceManager getResources() {
+        return _resources;
+    }
+
+	/** 
+	 * Get the action manager.
+	 * 
+	 * @return Action manager.
+	 */
+    public ActionManager getActions() {
+        return _actions;
+    }
+
+	/** 
+	 * Get the event bus.
+	 * 
+	 * @return EventBus.
+	 */
+    public EventBus getEventBus() {
+        return _eventBus;
+    }
+
+    /** 
+     * Get the project manager.
+     * 
+     * @return Project manager.
+     */
+    public ProjectManager getProjectManager() {
+        return _projectManager;
+    }
+
+    /** 
+     * Get the selection manager.
+     * 
+     * @return Selection manager.
+     */
+    public SelectionManager getSelectionManager() {
+        return _selectionManager;
+    }
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/BuildEventForwarder.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/BuildEventForwarder.java
new file mode 100644
index 0000000..a43a24e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/BuildEventForwarder.java
@@ -0,0 +1,158 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.BuildEvent;
+
+/**
+ * BuildListener for forwarding events to the EventBus.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildEventForwarder implements BuildListener {
+
+    /** Application context. */
+    private AppContext _context = null;
+
+    public BuildEventForwarder(AppContext context) {
+        _context = context;
+    }
+
+    /**
+     *  Fired before any targets are started.
+     */
+    public void buildStarted(BuildEvent event){
+        postEvent(event, BuildEventType.BUILD_STARTED);
+        // We doubly post this event.
+        _context.getEventBus().postEvent(
+            new BuildStartedEvent(_context, event));
+    }
+
+    /**
+     *  Fired after the last target has finished. This event
+     *  will still be thrown if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void buildFinished(BuildEvent event) {
+        postEvent(event, BuildEventType.BUILD_FINISHED);
+        // We doubly post this event.
+        _context.getEventBus().postEvent(
+            new BuildFinishedEvent(_context, event));
+    }
+
+    /**
+     *  Fired when a target is started.
+     *
+     *  @see BuildEvent#getTarget()
+     */
+    public void targetStarted(BuildEvent event) {
+        postEvent(event, BuildEventType.TARGET_STARTED);
+    }
+
+    /**
+     *  Fired when a target has finished. This event will
+     *  still be thrown if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void targetFinished(BuildEvent event) {
+        postEvent(event, BuildEventType.TARGET_FINISHED);
+    }
+
+    /**
+     *  Fired when a task is started.
+     *
+     *  @see BuildEvent#getTask()
+     */
+    public void taskStarted(BuildEvent event) {
+        postEvent(event, BuildEventType.TASK_STARTED);
+    }
+
+    /**
+     *  Fired when a task has finished. This event will still
+     *  be throw if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void taskFinished(BuildEvent event) {
+        postEvent(event, BuildEventType.TASK_FINISHED);
+    }
+
+    /**
+     *  Fired whenever a message is logged.
+     *
+     *  @see BuildEvent#getMessage()
+     *  @see BuildEvent#getPriority()
+     */
+    public void messageLogged(BuildEvent event) {
+        postEvent(event, BuildEventType.MESSAGE_LOGGED);
+    }
+
+	/** 
+	 * Forward the event.
+	 * 
+	 * @param event Event to forward.
+	 * @param type Description of how the event came in.
+	 */
+    private void postEvent(BuildEvent event, BuildEventType type) {
+        _context.getEventBus().postEvent(
+            new AntBuildEvent(_context, event, type));
+    }
+
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventDebugMonitor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventDebugMonitor.java
new file mode 100644
index 0000000..b711944
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventDebugMonitor.java
@@ -0,0 +1,106 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.BusMember;
+import org.apache.tools.ant.gui.event.BusFilter;
+import java.util.EventObject;
+
+/**
+ * Class that prints all events to stderr.
+ *
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class EventDebugMonitor implements BusMember {
+
+    /** Filter for all events. */
+    private final Filter _filter = new Filter();
+
+    /** 
+     * Defatult ctor.
+     * 
+     */
+    public EventDebugMonitor() {
+    }
+
+    /** 
+     * Get the filter to that is used to determine if an event should
+     * to to the member.
+     * 
+     * @return Filter to use.
+     */
+    public BusFilter getBusFilter() {
+        return _filter;
+    }
+        
+    /** 
+     * Called when an event is to be posed to the member.
+     * 
+     * @param event Event to post.
+     * @return true if event should be propogated, false if
+     * it should be cancelled.
+     */
+    public boolean eventPosted(EventObject event) {
+        System.err.println(event);
+        return true;
+    }
+
+    /** Filter for all events. */
+    private static class Filter implements BusFilter {
+        public boolean accept(EventObject event) {
+            return true;
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventResponder.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventResponder.java
new file mode 100644
index 0000000..ba24c80
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventResponder.java
@@ -0,0 +1,179 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.command.*;
+import java.util.EventObject;
+import java.awt.event.ActionEvent;
+import javax.swing.*;
+
+/**
+ * The purpose of this class is to watch for events that require some sort
+ * of action, like opening a file.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class EventResponder {
+
+    /** The application context. */
+    private AppContext _context = null;
+
+	/** 
+	 * Standard constructor. 
+	 * 
+	 * @param context Application context.
+	 */
+    public EventResponder(AppContext context) {
+        _context = context;
+
+        // XXX This needs to be changed, along with the event bus,
+        // to allow the EventResponder to be the last listener
+        // to receive the event. This will allow the addition
+        // of event filters to yank an event out of the bus, sort of 
+        // like an interrupt level.
+        _context.getEventBus().addMember(
+			EventBus.RESPONDING, new ActionResponder());
+        _context.getEventBus().addMember(
+			EventBus.RESPONDING, new AntResponder());
+    }
+
+    /** Handler for bus events. */
+    private class ActionResponder implements BusMember {
+        private final ActionFilter _filter = new ActionFilter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            String command = ((ActionEvent)event).getActionCommand();
+
+            Command cmd = 
+                _context.getActions().getActionCommand(command, _context);
+            if(cmd != null) {
+                cmd.run();
+                return false;
+            }
+            else {
+				// XXX log me.
+                System.err.println("Unhandled action: " + command);
+                // XXX temporary.
+                new DisplayErrorCmd(
+                    _context, 
+                    "Sorry. \"" + command + 
+                    "\" not implemented yet. Care to help out?").run();
+                return true;
+            }
+        }
+    }
+
+    /** Filter for action events. */
+    private static class ActionFilter implements BusFilter {
+        public boolean accept(EventObject event) {
+            return event instanceof ActionEvent;
+        }
+    }
+
+    /** Handler for bus events. */
+    private class AntResponder implements BusMember {
+        private final AntFilter _filter = new AntFilter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            AntEvent e = (AntEvent) event;
+            Command cmd = e.createDefaultCmd();
+            cmd.run();
+            return cmd instanceof NoOpCmd;
+        }
+    }
+
+    /** Filter for ant events. */
+    private static class AntFilter implements BusFilter {
+        public boolean accept(EventObject event) {
+            return event instanceof AntEvent;
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventToActionMapper.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventToActionMapper.java
new file mode 100644
index 0000000..bb39864
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/EventToActionMapper.java
@@ -0,0 +1,145 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+import java.util.*;
+
+/**
+ * The purpose of this class is to manage the 
+ * mappings between event type and action enabled state.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+class EventToActionMapper {
+
+    /** Lookup for enable(true) events. Key is event type, value is
+     *  a list of actions that are changed by the event. */
+    private Map _enableOn = new HashMap();
+    /** Lookup for enable(false) events. Key is event type, value is
+     *  a list of actions that are changed by the event. */
+    private Map _disableOn = new HashMap();
+
+
+	/** 
+	 * Defaul ctor.
+	 * 
+	 */
+    public EventToActionMapper() {
+    }
+
+	/** 
+	 * Add an action.
+	 * 
+	 * @param action Action to add.
+	 */
+    public void addAction(AntAction action) {
+        putAction(action, action.getEnableOnEvents(), _enableOn);
+        putAction(action, action.getDisableOnEvents(), _disableOn);
+    }
+
+	/** 
+	 * For the given action store it in the event type mapping
+     * for each of the given types.
+	 * 
+	 * @param action Action to store.
+	 * @param clazzes Array of types to store it under.
+	 * @param storage The place to store the association.
+	 */
+    private void putAction(AntAction action, Class[] clazzes, Map storage) {
+        if(clazzes == null) return;
+
+        for(int i = 0; i < clazzes.length; i++) {
+            List values = (List) storage.get(clazzes[i]);
+            if(values == null) {
+                values = new ArrayList(1);
+                storage.put(clazzes[i], values);
+            }
+
+            values.add(action);
+        }
+    }
+	/** 
+	 * For the given event change the state of any actions that 
+     * have been registered as needing a transition as a result of
+     * the event.
+	 * 
+	 * @param event The event to apply.
+	 */
+    public void applyEvent(EventObject event) {
+        if(event == null) return;
+
+        List vals = null;
+
+        vals = (List) _enableOn.get(event.getClass());
+        changeState(vals, true);
+
+        vals = (List) _disableOn.get(event.getClass());
+        changeState(vals, false);
+    }
+
+	/** 
+	 * Set the enabled state of the given actions.
+	 * 
+	 * @param actions List of AntActions to set state for.
+	 * @param state The state to set them to.
+	 */
+    private void changeState(List actions, boolean state) {
+        if(actions == null) return;
+
+        for(int i = 0, len = actions.size(); i < len; i++) {
+            AntAction action = (AntAction) actions.get(i);
+            action.setEnabled(state);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectManager.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectManager.java
new file mode 100644
index 0000000..5105b6f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectManager.java
@@ -0,0 +1,384 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.ProjectHelper;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.gui.acs.*;
+import org.apache.tools.ant.gui.event.BuildEventType;
+import java.io.*;
+import java.net.URL;
+import java.net.URLConnection;
+import java.util.*;
+
+/**
+ * This class is responsible for managing the currently open projects,
+ * and the loading of new projects.
+ * 
+ * XXX need to add property change listeners support.
+ *
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class ProjectManager {
+
+    /** Set of open projects. */
+    private List _projects = new ArrayList(1);
+    /** List of build listeners to register when build starts. */
+    private List _buildListeners = new LinkedList();
+    /** The current thread executing a build. */
+    private Thread _buildThread = null;
+
+    public ProjectManager() {
+    }
+
+    /** 
+     * Get all the open projects.
+     * 
+     * @return an array of all open projects.
+     */
+    public ACSProjectElement[] getOpen() {
+        ACSProjectElement[] retval = new ACSProjectElement[_projects.size()];
+        _projects.toArray(retval);
+        return retval;
+    }
+
+    /** 
+     * Save the given project.
+     * 
+     * @param project Project to save.
+     */
+    public void save(ACSProjectElement project) throws IOException {
+        saveAs(project, null);
+    }
+
+
+    /** 
+     * Save the given project to the given location.
+     * 
+     * @param project Project to save.
+     * @param location Location to save to.
+     */
+    public void saveAs(ACSProjectElement project, URL location) 
+        throws IOException {
+
+        if(location == null) {
+            location = project.getLocation();
+        }
+        if(location == null) {
+            // This shouldn't happen.
+            throw new IOException("Logic error: Save location mising.");
+        }
+
+        Writer out = null;
+        try {
+            // XXX for some reason the URLConnection for protocol type "file"
+            // doesn't support output (at least that is what the exception
+            // says. I don't know if I'm doing something wrong or not, but 
+            // since we need to handle files differently (which is fine
+            // right now since files are all we really support anyway.
+            if(location.getProtocol().equals("file")) {
+                out = new FileWriter(location.getFile());
+            }
+            else {
+                // XXX This is here for future support of FTP/HTTP and
+                // the like. JDBC will have to be dealt with differently.
+                URLConnection connection = location.openConnection();
+                connection.setDoInput(false);
+                connection.setDoOutput(true);
+                out = new OutputStreamWriter(connection.getOutputStream());
+            }
+
+            // Persist the project.
+            project.write(out);
+            out.flush();
+            project.setLocation(location);
+        }
+        finally {
+            try { out.close(); } catch(Exception ex) {}
+        }
+    }
+
+    /** 
+     * Open the project persisted at the given location
+     * 
+     * @param location Location of project file.
+     * @return Successfully loaded project.
+     * @throws IOException thrown if there is a problem opening the project.
+     */
+    public ACSProjectElement open(File location) throws IOException {
+        return open(new URL("file", null, location.getPath()));
+    }
+
+    /** 
+     * Open the project persisted at the given location
+     * 
+     * @param location Location of project file.
+     * @return Successfully loaded project.
+     * @throws IOException thrown if there is a problem opening the project.
+     */
+    public ACSProjectElement open(URL location) throws IOException {
+        ACSProjectElement retval = null;
+        retval = ACSFactory.getInstance().load(location);
+        retval.setLocation(location);
+        _projects.add(retval);
+        return retval;
+    }
+
+    /** 
+     * Create a new, unpopulated project.
+     * 
+     * @return Unpopulated project.
+     */
+    public ACSProjectElement createNew() {
+        ACSProjectElement retval = ACSFactory.getInstance().createProject();
+        _projects.add(retval);
+        return retval;
+    }
+
+    /** 
+     * Remove the given project from the set of active projects. 
+     * 
+     * @param project Project to close.
+     */
+    public void close(ACSProjectElement project) {
+        _projects.remove(project);
+    }
+
+	/** 
+	 * Build the project with the given target (or the default target
+     * if none is selected.  Build occurs on a separate thread, so method
+     * returns immediately.
+	 * 
+     * @param project Project to build.
+     * @param targets Targets to build in project.
+	 */
+    public void build(ACSProjectElement project, ACSTargetElement[] targets) 
+        throws BuildException {
+        _buildThread = new Thread(new BuildRunner(project, targets));
+        _buildThread.start();
+    }
+
+	/** 
+	 * Add a build listener.
+	 * 
+	 * @param l Listener to add.
+	 */
+    public void addBuildListener(BuildListener l) {
+        synchronized(_buildListeners) {
+            _buildListeners.add(l);
+        }
+    }
+
+	/** 
+	 * Remove a build listener.
+	 * 
+	 * @param l Listener to remove.
+	 */
+    public void removeBuildListener(BuildListener l) {
+        synchronized(_buildListeners) {
+            _buildListeners.remove(l);
+        }
+    }
+
+	/** 
+	 * Determine if the given BuildListener is registered.
+	 * 
+	 * @param l Listener to test for.
+	 * @return True if listener has been added, false if unknown.
+	 */
+    public boolean isRegisteredBuildListener(BuildListener l) {
+        synchronized(_buildListeners) {
+            return _buildListeners.contains(l);
+        }
+    }
+
+	/** 
+	 * Get the set of current build listeners.
+	 * 
+     * @return Set of current build listeners.
+	 */
+    public BuildListener[] getBuildListeners() {
+        synchronized(_buildListeners) {
+            BuildListener[] retval = new BuildListener[_buildListeners.size()];
+            _buildListeners.toArray(retval);
+            return retval;
+        }
+    }
+
+    /** Class for executing the build in a separate thread. */
+    private class BuildRunner implements Runnable {
+        /** The project to execute build on. */
+        private ACSProjectElement _project = null;
+        /** Targets to build. */
+        private ACSTargetElement[] _targets = null;
+        /** The Ant core representation of a project. */
+        private Project _antProject = null;
+
+        /** 
+         * Standard ctor.
+         * 
+         * @param project Project to execute build on.
+         * @param targets Targets to build. 
+         */
+        public BuildRunner(ACSProjectElement project, 
+                           ACSTargetElement[] targets) throws BuildException {
+            _project = project;
+            _targets = targets;
+
+            URL location = _project.getLocation();
+            if(location == null) {
+                // XXX this needs to be changed so that if the project is
+                // not saved, or the persistence mechanism is remote
+                // then a temporary version is saved first.
+                throw new BuildException("Project must be saved first");
+            }
+
+            // XXX hopefully we will eventually be able to save
+            // project files to any type of URL. Right now the Ant core
+            // only supports Files.
+            if(!location.getProtocol().equals("file")) {
+                throw new IllegalArgumentException(
+                    "The Ant core only supports building from locally " +
+                    "stored build files.");
+            }
+
+            File f = new File(location.getFile());
+
+            _antProject = new Project();
+            _antProject.init();
+            // XXX there is a bunch of stuff in the class
+            // org.apache.tools.ant.Main that needs to be
+            // refactored out so that it doesn't have to be
+            // replicated here.
+            
+            // XXX need to provide a way to pass in externally
+            // defined properties.  Perhaps define an external
+            // Antidote properties file. JAVA_HOME may have to be set, 
+            // as well as checking the .ant.properties
+            _antProject.setUserProperty(
+                "ant.file" , f.getAbsolutePath());
+            ProjectHelper.configureProject(_antProject, f);
+        }
+
+        /** 
+         * Convenience method for causeing the project to fire a build event.
+         * Implemented because the corresponding method in the Project class
+         * is not publically accessible.
+         * 
+         * @param event Event to fire.
+         */
+        private void fireBuildEvent(BuildEvent event, BuildEventType type) {
+            Enumeration enum = _antProject.getBuildListeners().elements();
+            while(enum.hasMoreElements()) {
+                BuildListener l = (BuildListener) enum.nextElement();
+                type.fireEvent(event, l);
+            }
+        }
+
+        /** 
+         * Run the build.
+         * 
+         */
+        public void run() {
+            synchronized(_antProject) {
+                // Add the build listeners
+                BuildListener[] listeners = getBuildListeners();
+                for(int i = 0; i < listeners.length; i++) {
+                    _antProject.addBuildListener(listeners[i]);
+                }
+                
+                try {
+                    
+                    fireBuildEvent(new BuildEvent(
+                        _antProject), BuildEventType.BUILD_STARTED);
+                    
+                    
+                    Vector targetNames = new Vector();
+                    if(_targets == null || _targets.length == 0) {
+                        targetNames.add(_antProject.getDefaultTarget());
+                    }
+                    else {
+                        for(int i = 0; i < _targets.length; i++) {
+                            targetNames.add(_targets[i].getName());
+                        }
+                    }
+                    
+                    // Execute build on selected targets. XXX It would be 
+                    // nice if the Project API supported passing in target 
+                    // objects rather than String names.
+                    _antProject.executeTargets(targetNames);
+                }
+                catch(BuildException ex) {
+                    BuildEvent errorEvent = new BuildEvent(_antProject);
+                    errorEvent.setException(ex);
+                    errorEvent.setMessage(ex.getMessage(), Project.MSG_ERR);
+                    fireBuildEvent(errorEvent, BuildEventType.MESSAGE_LOGGED);
+                }
+                finally {
+                    fireBuildEvent(new BuildEvent(
+                        _antProject), BuildEventType.BUILD_FINISHED);
+                    
+                    // Remove the build listeners.
+                    for(int i = 0; i < listeners.length; i++) {
+                        _antProject.removeBuildListener(listeners[i]);
+                    }
+                }
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectSelectionMenu.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectSelectionMenu.java
new file mode 100644
index 0000000..c81256e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ProjectSelectionMenu.java
@@ -0,0 +1,177 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import javax.swing.*;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.util.*;
+import java.beans.PropertyChangeEvent;
+
+/**
+ * Specialization of JMenu providing selectability of the currently
+ * open projects.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class ProjectSelectionMenu extends JMenu {
+    /** Application context. */
+    private AppContext _context = null;
+    /** Current set of menus. */
+    private Map _menus = new HashMap();
+        
+
+    /** 
+     * Standard ctor.
+     * 
+     * @param context Application context.
+     */
+    public ProjectSelectionMenu(AppContext context) {
+        super(context.getResources().getString(
+            ProjectSelectionMenu.class, "name"), true);
+        _context = context;
+        _context.getEventBus().addMember(
+            EventBus.MONITORING, new ProjectListener());
+        setMnemonic(getText().charAt(0));
+    }
+
+    /** 
+     * Replace or add the JMenu called "Projects" with this.
+     * 
+     * @param menuBar Menu bar to insert into.
+     */
+    public void insertInto(JMenuBar menuBar) {
+        // Iterate of the menu items looking for the one with the same name
+        // as ours.
+        int count = menuBar.getComponentCount();
+        for(int i = 0; i < count; i++) {
+            JMenuItem menu = (JMenuItem) menuBar.getComponent(i);
+            if(menu.getText().equals(getText())) {
+                menuBar.remove(menu);
+                menuBar.add(this, i);
+                return;
+            }
+        }
+
+        // Getting here we didn't find a menu with the same name.
+        add(this);
+    }
+
+
+    /** Listener for updating the contents of the menu. */
+    private class ProjectListener implements BusMember {
+        /** Event filter. */
+        private final Filter _filter = new Filter();
+        /** Action handler. */
+        private final ActionHandler _handler = new ActionHandler();
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            // Clear out our existing members
+            removeAll();
+            _menus.clear();
+
+            ACSProjectElement[] projects = 
+                _context.getProjectManager().getOpen();
+            for(int i = 0; i < projects.length; i++) {
+                JMenuItem menu = new JMenuItem(projects[i].getName());
+                menu.addActionListener(_handler);
+                _menus.put(menu, projects[i]);
+                add(menu);
+            }
+            return true;
+        }
+    }
+
+    /** Filter for project related events. */
+    private static class Filter implements BusFilter {
+        public boolean accept(EventObject event) {
+            // We want events related to projects.
+            return event instanceof ProjectSelectedEvent ||
+                event instanceof ProjectClosedEvent || 
+                (event instanceof PropertyChangeEvent && 
+                 ((PropertyChangeEvent)event).getSource() 
+                 instanceof ACSProjectElement);
+        }
+    }
+
+    /** Handler for selecting the project. */
+    private class ActionHandler implements ActionListener {
+        public void actionPerformed(ActionEvent e) {
+            ACSProjectElement project = 
+                (ACSProjectElement) _menus.get(e.getSource());
+            _context.getEventBus().postEvent(
+                new ProjectSelectedEvent(_context, project));
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ResourceManager.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ResourceManager.java
new file mode 100644
index 0000000..61e3a0a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/ResourceManager.java
@@ -0,0 +1,322 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import java.util.*;
+import java.text.MessageFormat;
+import javax.swing.ImageIcon;
+import java.net.URL;
+import java.io.File;
+
+/**
+ * Singleton class for accessing various resources by the application.
+ * Relies on the resource bundles for resource values.
+ *
+ * @version $Revision: 1.6 $ 
+ * @author Simeon H.K. Fitch 
+ */
+public class ResourceManager {
+
+    /** Path to default resources. */
+    private static final String RESOURCE_PKG = 
+        "org.apache.tools.ant.gui.resources";
+    /** Path to default resources. */
+    private static final String DEF_PROPERTIES = 
+        RESOURCE_PKG + ".antidote";
+
+    /** Image path. */
+    private static final String IMG_PATH = 
+        '/' + RESOURCE_PKG.replace('.', '/');
+
+    /** Resources to reference. */
+    private ResourceBundle _resources = null;
+
+    /** 
+     * Default ctor. Uses the default properties file for antidote.
+     * 
+     */
+    public ResourceManager() {
+        this(DEF_PROPERTIES);
+    }
+
+    /** 
+     * Standard ctor.
+     * 
+     * @param propName Fully qualified name of the resources to use.
+     */
+    public ResourceManager(String propName) {
+        _resources = ResourceBundle.getBundle(propName);
+    }
+
+    /** 
+     * Generate a composit key from the given class and key name.
+     * 
+     * @param clazz Class to find resource for.
+     * @param name Name of the resource.
+     * @return Composite key.
+     */
+    private String getKey(Class clazz, String name) {
+        name = name == null ? "" : name;
+
+        return clazz == null ? name : clazz.getName() + "." + name;
+    }
+
+    /** 
+     * Get non-qualified String resource.
+     * 
+     * @param name Name of the resource.
+     * @return Value of the resource.
+     */
+    public String getString(String name) {
+        return getString(null, name);
+    }
+
+    /** 
+     * Get a string resource for the given class.
+     * 
+     * @param clazz Class to get resource for.
+     * @param name Name of the string resource.
+     * @return String resource for the given class.
+     */
+    public String getString(Class clazz, String name) {
+        if(name == null) {
+            return null;
+        }
+
+        try {
+            return _resources.getString(getKey(clazz, name));
+        }
+        catch(MissingResourceException ex) {
+            return null;
+        }
+    }
+
+    /** 
+     * Get a non-qualified array of string resources for the given class.
+     * 
+     * @param name Name of the string resource.
+     * @return Array of string resources for the given class.
+     */
+    public String[] getStringArray(String name) {
+        return getStringArray(null, name);
+    }
+    /** 
+     * Get an array of string resources for the given class.
+     * 
+     * @param clazz Class to get resource for.
+     * @param name Name of the string resource.
+     * @return Array of string resources for the given class.
+     */
+    public String[] getStringArray(Class clazz, String name) {
+        if(name == null) {
+            return null;
+        }
+
+        String key = getKey(clazz, name);
+
+        String toTok = null;
+        try {
+            toTok = _resources.getString(key);
+        }
+        catch(MissingResourceException ex) {
+            // Ignore as we are doing a cascading lookup.
+        }
+
+        if(toTok == null) {
+            try {
+                return _resources.getStringArray(key);
+            }
+            catch(MissingResourceException ex) {
+                return null;
+            }
+        }
+        else {
+            StringTokenizer tok = new StringTokenizer(toTok, ", ");
+            String[] retval = new String[tok.countTokens()];
+            for(int i = 0; i < retval.length; i++) {
+                retval[i] = tok.nextToken();
+            }
+            return retval;
+        }
+    }
+
+    /** 
+     * Get the boolean resource for the given name. Case
+     * insensitive values of "yes" or "true" evaluate to TRUE.
+     * All others, including undefined resources evaluate to FALSE.
+     * 
+     * @param name Name of the boolean resource.
+     * @return True if defined as true, false otherwise.
+     */
+    public boolean getBoolean(String name) {
+        return getBoolean(null, name);
+    }
+
+    /** 
+     * Get the boolean resource for the given class. Case
+     * insensitive values of "yes" or "true" evaluate to TRUE.
+     * All others, including undefined resources evaluate to FALSE.
+     * 
+     * @param clazz Class to get resource for.
+     * @param name Name of the boolean resource.
+     * @return True if defined as true, false otherwise.
+     */
+    public boolean getBoolean(Class clazz, String name) {
+        if(name == null) {
+            return false;
+        }
+
+        String key = getKey(clazz, name);
+
+        String value = "";
+        try {
+            value = _resources.getString(key);
+        }
+        catch(MissingResourceException ex) {
+            return false;
+        }
+
+        return value.equalsIgnoreCase("true") || value.equalsIgnoreCase("yes");
+    }
+
+    /** 
+     * Get the non-qualified Class type resource for the given key.
+     * 
+     * @param name Name of the resourdce.
+     * @return Class associated with the key name.
+     */
+    public Class getClass(String name) 
+        throws ClassNotFoundException {
+        return getClass(null, name);
+    }
+
+    /** 
+     * Get the Class type resource for the given class and key name.
+     * 
+     * @param clazz Class requesting the resource.
+     * @param name Name of the resource.
+     * @return Class associated with the key name.
+     */
+    public Class getClass(Class clazz, String name) 
+        throws ClassNotFoundException {
+
+        String key = getKey(clazz, name);
+        try {
+            String value = _resources.getString(key);
+            return Class.forName(value);
+        }
+        catch(MissingResourceException ex) {
+            return null;
+        }
+
+    }
+
+
+    /** 
+     * Generate a localized message using the given set of arguments to 
+     * format the message with.
+     * 
+     * @param name Name of the message.
+     * @param arguments Arguments to the message.
+     * @return The formatted message.
+     */
+    public String getMessage(String name, Object[] arguments) {
+        return getMessage(null, name, arguments);
+    }
+
+    /** 
+     * Generate a localized message using the given set of arguments to 
+     * format the message with.
+     * 
+     * @param clazz Class to get message resource for.
+     * @param name Name of the message.
+     * @param arguments Arguments to the message.
+     * @return The formatted message.
+     */
+    public String getMessage(Class clazz, String name, Object[] arguments) {
+        String format = getString(clazz, name);
+        return MessageFormat.format(format, arguments);
+    }
+
+    /** 
+     * Get the image as an ImageIcon assigned to the given class with the
+     * given key.
+     * 
+     * @param clazz The class to load icon for.
+     * @param key The key for looking up the icon.
+     * @return Image as an ImageIcon, or null if not found.
+     */
+    public ImageIcon getImageIcon(Class clazz, String key) {
+        return loadImageIcon(getString(clazz, key));
+    }
+
+    /** 
+     * Get the image as an ImageIcon with the given file name. 
+     * For example "open.gif". The image is loaded from the resources package.
+     * 
+     * @param fileName Image file to load.
+     * @return Image as an ImageIcon, or null if not found.
+     */
+    public ImageIcon loadImageIcon(String fileName) {
+        if(fileName == null) return null;
+
+        ImageIcon icon = null;
+        URL location = getClass().getResource(IMG_PATH + "/" + fileName);
+        if(location != null) {
+            icon = new ImageIcon(location);
+        }
+        return icon;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/SelectionManager.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/SelectionManager.java
new file mode 100644
index 0000000..e1fef11
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/SelectionManager.java
@@ -0,0 +1,147 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.command.*;
+import org.apache.tools.ant.gui.acs.*;
+import java.util.EventObject;
+import java.awt.event.ActionEvent;
+import javax.swing.*;
+
+/**
+ * State management class for keeping track of what build file elements are
+ * currently selected. It monitors the EventBus for selection events and
+ * Records the current state. It should be registered with the EventBus
+ * at the MONITORING level.
+ *
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class SelectionManager implements BusMember {
+    /** The filter for getting the correct events.*/
+    private final Filter _filter = new Filter();
+
+    /** The currently selected project. */
+    private ACSProjectElement _project = null;
+    /** The current set of selected targets. */
+    private ACSTargetElement[] _targets = null;
+    /** The current set of selected elements. */
+    private ACSElement[] _elements = null;
+
+    public SelectionManager() {
+    }
+
+    /** 
+     * Get the filter to that is used to determine if an event should
+     * to to the member.
+     * 
+     * @return Filter to use.
+     */
+    public BusFilter getBusFilter() {
+        return _filter;
+    }
+    
+
+    /** 
+     * Get the currently selected project.
+     * 
+     * @return Current project.
+     */
+    public ACSProjectElement getSelectedProject() {
+        return _project;
+    }
+
+    /** 
+     * Get the selected elements that are targets.
+     * 
+     */
+    public ACSTargetElement[] getSelectedTargets() {
+        return _targets;
+    }
+
+    /** 
+     * Get the selected elements.
+     * 
+     */
+    public ACSElement[] getSelectedElements() {
+        return _elements;
+    }
+
+    /** 
+     * Called when an event is to be posed to the member.
+     * 
+     * @param event Event to post.
+     * @return true if event should be propogated, false if
+     * it should be cancelled.
+     */
+    public boolean eventPosted(EventObject event) {
+        _elements = ((ElementSelectionEvent)event).getSelectedElements();
+
+        if(event instanceof TargetSelectionEvent) {
+            _targets = ((TargetSelectionEvent)event).getSelectedTargets();
+        }
+        else if(event instanceof ProjectSelectedEvent) {
+            _project = ((ProjectSelectedEvent)event).getSelectedProject();
+        }
+        return true;
+    }
+
+    /** Filter for ElementSelectionEvent objects. */
+    private static class Filter implements BusFilter {
+        public boolean accept(EventObject event) {
+            return event instanceof ElementSelectionEvent;
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/XMLFileFilter.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/XMLFileFilter.java
new file mode 100644
index 0000000..4edf532
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/core/XMLFileFilter.java
@@ -0,0 +1,102 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.core;
+
+import javax.swing.filechooser.FileFilter;
+import java.io.File;
+
+/**
+ * FileFilter for showing only XML files.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class XMLFileFilter extends FileFilter {
+
+    /** Text description of filter. */
+    private String _description = null;
+
+
+    /** 
+     * Standard constructor.
+     * 
+     * @param resources Access to text resources.
+     */
+    public XMLFileFilter(ResourceManager resources) {
+        _description = resources.getString(getClass(), "description");
+    }
+
+    /** 
+     * Accept files that end with ".xml".
+     * 
+     * @param f File to test.
+     * @return True if accepted, false otherwise.
+     */
+    public boolean accept(File f) {
+        if(f.isDirectory()) return true;
+
+        String name = f.getName().toLowerCase();
+        return name.endsWith(".xml");
+    }
+
+    /** 
+     * Human readable description of filter.
+     * 
+     * @return Description.
+     */
+    public String getDescription() {
+        return _description;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/.wrapper b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/.wrapper
new file mode 100644
index 0000000..5995815
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/.wrapper
@@ -0,0 +1,28 @@
+#!/bin/sh 
+# Wrapper script for launching Java files without having to type the 
+# package prefix. To use make a link to this file with the same name
+# as the class you want to run.
+
+# Edit this line to represent the package that your class belongs to.
+PACKAGE=org.apache.tools.ant.gui.customizer
+
+# Set your application's classpath here.
+CLASSPATH=$HOME/build/antidote/classes:$HOME/build/ant/lib/ant.jar
+
+# Compose the fully qualified class name.
+START=$PACKAGE.`basename $0`
+
+# Java runtime path.
+EXE=/usr/java1.3/bin/java
+
+# Set any runtime options here
+OPTS="-classpath $CLASSPATH"
+
+# Turn the JIT off if the variable "DEBUG" is set in the environment.
+if [ ! -z $DEBUG ]; then 
+	OPTS="$OPTS -Djava.compiler=NONE"
+fi
+
+# Launch the program.
+#echo $EXE $OPTS $START $*
+exec $EXE $OPTS $START $*
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/AbstractPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/AbstractPropertyEditor.java
new file mode 100644
index 0000000..49d1bfd
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/AbstractPropertyEditor.java
@@ -0,0 +1,246 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import java.beans.*;
+import java.awt.Graphics;
+import java.awt.Component;
+import java.awt.Rectangle;
+import java.awt.Dimension;
+import javax.swing.JComponent;
+import java.awt.event.FocusEvent;
+import java.awt.event.FocusAdapter;
+
+/**
+ * Abstract base class for the custom type property editors.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class AbstractPropertyEditor implements PropertyEditor {
+
+    /** Bean property change property name. */
+    public static final String BEAN_PROP = "BeanEditorProperty";
+    /** Event listener support. */
+    private PropertyChangeSupport _listeners = new PropertyChangeSupport(this);
+
+    /** 
+     * Default constructor.
+     * 
+     */
+    protected AbstractPropertyEditor() {
+    }
+
+    /**
+     * Paint a representation of the value into a given area of screen
+     * real estate.  Note that the propertyEditor is responsible for doing
+     * its own clipping so that it fits into the given rectangle.
+     * <p>
+     * If the PropertyEditor doesn't honor paint requests (see isPaintable)
+     * this method should be a silent noop.
+     * <p>
+     * The given Graphics object will have the default font, color, etc of
+     * the parent container.  The PropertyEditor may change graphics attributes
+     * such as font and color and doesn't need to restore the old values.
+     *
+     * @param gfx  Graphics object to paint into.
+     * @param box  Rectangle within graphics object into which we should paint.
+     */
+    public void paintValue(Graphics gfx, Rectangle box) {
+        Object o = getValue();
+        String s = o == null ? "<null>" : o.toString();
+        gfx.drawString(s, box.x, box.y);
+    }
+
+
+    /** 
+     * Fire a property change event to listeners.
+     * 
+     * @param oldValue Old value.
+     * @param newValue New value.
+     */
+    public void firePropertyChange(Object oldValue, Object newValue) {
+        _listeners.firePropertyChange(BEAN_PROP, oldValue, newValue);
+    }
+
+    /** 
+     * Add a property change listener. XXX This may cause undesired
+     * side affects with merging property changes with JPanel class.
+     * Need to test for a while.
+     * 
+     * @param l Change listener.
+     */
+    public void addPropertyChangeListener(PropertyChangeListener l) {
+        _listeners.addPropertyChangeListener(l);
+    }
+
+    /** 
+     * Remove a property change listener. 
+     * 
+     * @param l Change listener.
+     */
+    public void removePropertyChangeListener(PropertyChangeListener l) {
+        _listeners.removePropertyChangeListener(l);
+    }
+
+    /**
+     * @return  True if the class will honor the paintValue method.
+     */
+    public boolean isPaintable() {
+        return true;
+    }
+
+    /**
+     * If the property value must be one of a set of known tagged values, 
+     * then this method should return an array of the tags.  This can
+     * be used to represent (for example) enum values.  If a PropertyEditor
+     * supports tags, then it should support the use of setAsText with
+     * a tag value as a way of setting the value and the use of getAsText
+     * to identify the current value.
+     *
+     * @return The tag values for this property.  May be null if this 
+     *   property cannot be represented as a tagged value.
+     *  
+     */
+    public String[] getTags() {
+        return null;
+    }
+
+    /**
+     * A PropertyEditor may choose to make available a full custom Component
+     * that edits its property value.  It is the responsibility of the
+     * PropertyEditor to hook itself up to its editor Component itself and
+     * to report property value changes by firing a PropertyChange event.
+     * <P>
+     * The higher-level code that calls getCustomEditor may either embed
+     * the Component in some larger property sheet, or it may put it in
+     * its own individual dialog, or ...
+     *
+     * @return A java.awt.Component that will allow a human to directly
+     *      edit the current property value.  May be null if this is
+     *      not supported.
+     */
+    public Component getCustomEditor() {
+        return getChild();
+    }
+
+    /**
+     * @return  True if the propertyEditor can provide a custom editor.
+     */
+    public boolean supportsCustomEditor() {
+        return true;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return "";
+    }
+
+    /** 
+     * Get the child editing component. 
+     * 
+     * @return Child editing component.
+     */
+    protected abstract Component getChild();
+
+    /** Helper class for detecting changes and generating change events
+     *  on a focus lost event. */
+    protected static class FocusHandler extends FocusAdapter {
+        /** Last value of the editor. */
+        private Object _value = null;
+        /** Editor of interest. */
+        private AbstractPropertyEditor _editor = null;
+
+        /** 
+         * Standard constructor.
+         * 
+         * @param editor Editor of interest.
+         */
+        public FocusHandler(AbstractPropertyEditor editor) {
+            _editor = editor;
+        }
+
+        /** 
+         * Called when focus is gained.
+         * 
+         * @param e Focus event.
+         */
+        public void focusGained(FocusEvent e) {
+            _value = _editor.getValue();
+        }
+        
+        /** 
+         * Called when focus is lost. Checks to see if value changed and
+         * fires a change event if needed.
+         * 
+         * @param e Focus event.
+         */
+        public void focusLost(FocusEvent e) {
+            if((_value != null && !_value.equals(_editor.getValue())) ||
+               (_value == null && _editor.getValue() != null)) {
+                _editor.firePropertyChange(_value, _editor.getValue());
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DoublePropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DoublePropertyEditor.java
new file mode 100644
index 0000000..b5b570d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DoublePropertyEditor.java
@@ -0,0 +1,170 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import java.awt.Component;
+
+/**
+ * Custom property editor for editing double values.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class DoublePropertyEditor extends AbstractPropertyEditor {
+    /** Editing widget. */
+    private JTextField _widget = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public DoublePropertyEditor() {
+        _widget = new JTextField();
+        _widget.addFocusListener(new FocusHandler(this));
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _widget;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return "new Double(" + getAsText() + ")";
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        Object old = _widget.getText();
+        if(!(value instanceof Double)) {
+            value = new Double(0);
+        }
+
+        _widget.setText(value.toString());
+    }
+
+    /**
+     * @return The value of the property.  Builtin types such as "int" will
+     * be wrapped as the corresponding object type such as "java.lang.Integer".
+     */
+    public Object getValue() {
+        Double retval = null;
+        try {
+            retval = new Double(_widget.getText());
+        }
+        catch(NumberFormatException ex) {
+            retval = new Double(0);
+            _widget.setText(retval.toString());
+        }
+        return retval;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) {
+        Object old = _widget.getText();
+        Double val = null;
+        try {
+            val = new Double(text);
+        }
+        catch(NumberFormatException ex) {
+            val = new Double(0);
+        }
+        text = val.toString();
+        _widget.setText(text);
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return _widget.getText();
+    } 
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DynamicCustomizer.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DynamicCustomizer.java
new file mode 100644
index 0000000..300f04a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/DynamicCustomizer.java
@@ -0,0 +1,608 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import org.apache.tools.ant.gui.util.LabelFieldGBC;
+import java.lang.reflect.*;
+import java.beans.*;
+import javax.swing.*;
+import java.util.*;
+import java.io.File;
+import java.awt.*;
+
+/**
+ * Widget for dynamically constructing a property editor based on the 
+ * an Object's BeanInfo. Essentially a property sheet.
+ * 
+ * @version $Revision: 1.9 $ 
+ * @author Simeon Fitch 
+ */
+public class DynamicCustomizer extends JPanel implements Customizer, Scrollable {
+	static {
+		PropertyEditorManager.registerEditor(
+			String.class, StringPropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			String[].class, StringArrayPropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			int.class, IntegerPropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			Integer.class, IntegerPropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			double.class, DoublePropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			Double.class, DoublePropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			Properties.class, PropertiesPropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			File.class, FilePropertyEditor.class);
+		PropertyEditorManager.registerEditor(
+			Object.class, ObjectPropertyEditor.class);
+	}
+
+    /** Property name that PropertyDescriptors can save in their property
+     *  dictionaries for for specifiying a display sorting order. The value
+     *  sould be of type Integer. */
+    public static final String SORT_ORDER = "sortOrder";
+
+	/** The type that this editor instance can handle. */
+	private Class _type = null;
+	/** The value currently being edited. */
+	private Object _value = null;
+	/** Mapping from PropertyDescriptor to PropertyEditor. */
+	private Map _prop2Editor = new HashMap();
+	/** Mapping from PropertyEditor to field PropertyDescriptor. */
+	private Map _editor2Prop = new HashMap();
+	/** Listener for receiving change events from the editors. */
+	private EditorChangeListener _eListener = new EditorChangeListener();
+    /** Read-only flag. */
+    private boolean _readOnly = false;
+    /** List of property change listeners interested when the bean
+     *  being edited has been changed. */
+    private java.util.List _changeListeners = new LinkedList();
+    /** Flag to trun off event propogation. */
+    private boolean _squelchChangeEvents = false;
+
+	/** 
+     * Standard constructor.
+     *
+     * @param type Type that you are going to be creating and editor for.
+     */
+    public DynamicCustomizer(Class type) {
+        this(type, false);
+    }
+
+	/** 
+     * Standard constructor.
+     *
+     * @param type Type that you are going to be creating and editor for.
+     * @param readOnly Set to true to create a read-only customizer.
+     */
+    public DynamicCustomizer(Class type, boolean readOnly) {
+        super(new GridBagLayout());
+        _readOnly = readOnly;
+        _type = type;
+        
+        LabelFieldGBC gbc = new LabelFieldGBC();
+        try {
+            BeanInfo info = Introspector.getBeanInfo(type);
+            // Set up pretty display stuff.
+            setBorder(BorderFactory.createTitledBorder(
+                info.getBeanDescriptor().getDisplayName()));
+            setToolTipText(info.getBeanDescriptor().getShortDescription());
+
+            // Get the properties and sort them.
+            PropertyDescriptor[] props = info.getPropertyDescriptors();
+            Arrays.sort(props, new PropertyComparator());
+            for(int i = 0; i < props.length; i++) {
+                // Ignore the "class" property, if it is provided.
+                if(props[i].getName().equals("class")) continue;
+                // Create a label for the field.
+                JLabel label = new JLabel(props[i].getDisplayName() + ":");
+                
+                // Lookup the editor.
+                PropertyEditor editor = getEditorForProperty(props[i]);
+
+                // Add a listener to the editor so we know when to update
+                // the bean's fields.
+                editor.addPropertyChangeListener(_eListener);
+                
+                // XXX What we need to do right here is provide a component
+                // that makes use of the "paintable" capability of the editor.
+                Component comp = editor.getCustomEditor();
+                if(comp == null) {
+                    comp = new JLabel("<No editor available.>");
+                    ((JLabel)comp).setBorder(BorderFactory.createEtchedBorder());
+                }
+                
+                // See if it is a read-only property. If so, then just
+                // display it.
+                if(_readOnly || props[i].getWriteMethod() == null) {
+                    comp.setEnabled(false);
+                }
+
+                // Setup the accellerator key.
+                label.setLabelFor(comp);
+                label.setDisplayedMnemonic(label.getText().charAt(0));
+
+                // Set the tool tip text, if any.
+                String tip = props[i].getShortDescription();
+                if(tip != null) {
+                    label.setToolTipText(tip);
+                    if(comp instanceof JComponent) {
+                        ((JComponent)comp).setToolTipText(tip);
+                    }
+                }
+
+                // Add the label and fields.
+                add(label, gbc.forLabel());
+                add(comp, gbc.forField());
+
+                // Set the mappings between editor and property, etc. for
+                // quick lookup later.
+                _prop2Editor.put(props[i], editor);
+                _editor2Prop.put(editor, props[i]);
+            }
+            // Filler...
+            add(new JLabel(), gbc.forLastLabel());
+
+        }
+        catch(Exception ex) {
+            ex.printStackTrace();
+        }
+    }
+
+
+    /** 
+     * Set the object to be edited.
+     * 
+     * @param value The object to be edited.
+     */
+    public void setObject(Object value) {
+        if(!(_type.isInstance(value))) {
+            throw new IllegalArgumentException(
+                value.getClass() + " is not of type " + _type);
+        } 
+        _value = value;
+        
+        // Disable event generation.
+        _squelchChangeEvents = true;
+
+        // Iterate over each property, doing a lookup on the associated editor
+        // and setting the editor's value to the value of the property.
+        Iterator it = _prop2Editor.keySet().iterator();
+        while(it.hasNext()) {
+            PropertyDescriptor desc = (PropertyDescriptor) it.next();
+            PropertyEditor editor = (PropertyEditor) _prop2Editor.get(desc);
+            Method reader = desc.getReadMethod();
+            if(reader != null) {
+                try {
+                    Object val = reader.invoke(_value, null);
+                    editor.setValue(val);
+                }
+                catch(IllegalAccessException ex) {
+                    ex.printStackTrace();
+                }
+                catch(InvocationTargetException ex) {
+                    ex.getTargetException().printStackTrace();
+                }
+            }
+        }
+
+        // Enable event generation.
+        _squelchChangeEvents = false;
+
+    }
+
+	/** 
+	 * Get the appropriate editor for the given property.
+	 * 
+	 * @param prop Property to get editor for.
+	 * @return Editor to use, or null if none found.
+	 */
+    private PropertyEditor getEditorForProperty(PropertyDescriptor prop) {
+        PropertyEditor retval = null;
+        Class type = prop.getPropertyEditorClass();
+        if(type != null) {
+            try {
+                retval = (PropertyEditor) type.newInstance();
+            }
+            catch(Exception ex) {
+                ex.printStackTrace();
+            }
+        }
+        // Handle case where there is no special editor
+        // associated with the property. In that case we ask the 
+        // PropertyEditor manager for the editor registered for the
+        // given property type.
+        if(retval == null) {
+            Class t = prop.getPropertyType();
+            if(t != null) {
+                retval = PropertyEditorManager.findEditor(t);
+            }
+        }
+
+        // In the worse case we resort to the generic editor for Object types.
+        if(retval == null) {
+            retval = PropertyEditorManager.findEditor(Object.class);
+        }
+
+        return retval;
+    }
+
+	/** 
+	 * Add the given listener. Will receive a change event for 
+     * changes to the bean being edited.
+	 * 
+	 * @param l Listner to add.
+	 */
+    public void addPropertyChangeListener(PropertyChangeListener l) {
+        _changeListeners.add(l);
+    }
+
+
+	/** 
+	 * Remove the given property change listener.
+	 * 
+	 * @param l Listener to remove.
+	 */
+    public void removePropertyChangeListener(PropertyChangeListener l) {
+        _changeListeners.remove(l);
+    }
+
+	/** 
+	 * Fire a property change event to each listener.
+	 * 
+	 * @param bean Bean being edited. 
+	 * @param propName Name of the property.
+	 * @param oldValue Old value.
+	 * @param newValue New value.
+	 */
+    protected void firePropertyChange(Object bean, String propName, 
+                                      Object oldValue, Object newValue) {
+
+        PropertyChangeEvent e = new PropertyChangeEvent(
+            bean, propName, oldValue, newValue);
+
+        Iterator it = _changeListeners.iterator();
+        while(it.hasNext()) {
+            PropertyChangeListener l = (PropertyChangeListener) it.next();
+            l.propertyChange(e);
+        }
+    }
+
+    /**
+     * Returns the preferred size of the viewport for a view component.
+     * For example the preferredSize of a JList component is the size
+     * required to acommodate all of the cells in its list however the
+     * value of preferredScrollableViewportSize is the size required for
+     * JList.getVisibleRowCount() rows.   A component without any properties
+     * that would effect the viewport size should just return 
+     * getPreferredSize() here.
+     * 
+     * @return The preferredSize of a JViewport whose view is this Scrollable.
+     * @see JViewport#getPreferredSize
+     */
+    public Dimension getPreferredScrollableViewportSize() {
+        Dimension size = getPreferredSize();
+        Dimension retval = new Dimension();
+        retval.width = size.width > 600 ? 600 : size.width;
+        retval.height = size.height > 400 ? 400 : size.height;
+        return retval;
+    }
+
+
+    /**
+     * Components that display logical rows or columns should compute
+     * the scroll increment that will completely expose one new row
+     * or column, depending on the value of orientation.  Ideally, 
+     * components should handle a partially exposed row or column by 
+     * returning the distance required to completely expose the item.
+     * <p>
+     * Scrolling containers, like JScrollPane, will use this method
+     * each time the user requests a unit scroll.
+     * 
+     * @param visibleRect The view area visible within the viewport
+     * @param orientation Either SwingConstants.VERTICAL or 
+     *                    SwingConstants.HORIZONTAL.
+     * @param direction Less than zero to scroll up/left, 
+     *                  greater than zero for down/right.
+     * @return The "unit" increment for scrolling in the specified direction
+     * @see JScrollBar#setUnitIncrement
+     */
+    public int getScrollableUnitIncrement(Rectangle visibleRect, 
+                                          int orientation, int direction) {
+        return 1;
+    }
+
+
+    /**
+     * Components that display logical rows or columns should compute
+     * the scroll increment that will completely expose one block
+     * of rows or columns, depending on the value of orientation. 
+     * <p>
+     * Scrolling containers, like JScrollPane, will use this method
+     * each time the user requests a block scroll.
+     * 
+     * @param visibleRect The view area visible within the viewport
+     * @param orientation Either SwingConstants.VERTICAL or 
+     *                    SwingConstants.HORIZONTAL.
+     * @param direction Less than zero to scroll up/left, 
+     *                  greater than zero for down/right.
+     * @return The "block" increment for scrolling in the specified direction.
+     * @see JScrollBar#setBlockIncrement
+     */
+    public int getScrollableBlockIncrement(Rectangle visibleRect, 
+                                           int orientation, int direction) {
+        return orientation == SwingConstants.VERTICAL ? 
+            visibleRect.height / 2 : visibleRect.width / 2;
+    }
+    
+
+    /**
+     * Return true if a viewport should always force the width of this 
+     * Scrollable to match the width of the viewport.  For example a noraml 
+     * text view that supported line wrapping would return true here, since it
+     * would be undesirable for wrapped lines to disappear beyond the right
+     * edge of the viewport.  Note that returning true for a Scrollable
+     * whose ancestor is a JScrollPane effectively disables horizontal
+     * scrolling.
+     * <p>
+     * Scrolling containers, like JViewport, will use this method each 
+     * time they are validated.  
+     * 
+     * @return True if a viewport should force the Scrollables 
+     *         width to match its own.
+     */
+    public boolean getScrollableTracksViewportWidth() {
+        return true;
+    }
+
+    /**
+     * Return true if a viewport should always force the height of this 
+     * Scrollable to match the height of the viewport.  For example a 
+     * columnar text view that flowed text in left to right columns 
+     * could effectively disable vertical scrolling by returning
+     * true here.
+     * <p>
+     * Scrolling containers, like JViewport, will use this method each 
+     * time they are validated.  
+     * 
+     * @return True if a viewport should force the Scrollables 
+     *         height to match its own.
+     */
+    public boolean getScrollableTracksViewportHeight() {
+        return false;
+    }
+
+
+    /** Class for receiving change events from the PropertyEditor objects. */
+    private class EditorChangeListener implements PropertyChangeListener {
+        public void propertyChange(PropertyChangeEvent e) {
+            if(_squelchChangeEvents) return;
+
+            PropertyEditor editor = (PropertyEditor) e.getSource();
+            PropertyDescriptor prop =
+                (PropertyDescriptor) _editor2Prop.get(editor);
+            Method writer = prop.getWriteMethod();
+            if(writer != null) {
+                try {
+                    Object[] params = { editor.getValue() };
+                    writer.invoke(_value, params);
+                    setObject(_value);
+                    firePropertyChange(
+                        _value, prop.getName(), null, editor.getValue());
+                }
+                catch(IllegalAccessException ex) {
+                    ex.printStackTrace();
+                }
+                catch(InvocationTargetException ex) {
+                    ex.getTargetException().printStackTrace();
+                }
+            }
+        }
+    }
+
+
+    /** Comparator for sorting PropertyDescriptor values. */
+    private static class PropertyComparator implements Comparator {
+        public int compare(Object o1, Object o2) {
+            PropertyDescriptor p1 = (PropertyDescriptor)o1;
+            PropertyDescriptor p2 = (PropertyDescriptor)o2;
+
+            Integer i1 = (Integer) p1.getValue(SORT_ORDER);
+            Integer i2 = (Integer) p2.getValue(SORT_ORDER);
+            
+            if(i1 == null && i2 == null) {
+                return p1.getName().compareTo(p2.getName());
+            }
+            else if(i1 != null) {
+                return i1.compareTo(i2);
+            }
+            else {
+                return i2.compareTo(i1) * -1;
+            }
+        }
+    }
+
+
+    /*----------------------------------------------------------------------*/
+
+    /** Class for testing this. */
+    private static class TestClass implements Cloneable {
+        private String _String = "This string is my name.";
+        private String[] _StringArray = { "one", "two", "three" };
+        private int _int = Integer.MIN_VALUE;
+        private Integer _Integer = new Integer(Integer.MAX_VALUE);
+        private double _double = Double.MIN_VALUE;
+        private Double _Double = new Double(Double.MAX_VALUE);
+        private Properties _Properties = System.getProperties();
+        private File _File = new File("/");
+        private Object _Object = new Font("Monospaced", Font.PLAIN, 12);
+        private JButton _button = new JButton("I'm a button!");
+
+        public void setName(String string) {
+            _String = string;
+        }
+        public String getName() {
+            return _String;
+        }
+
+        public void setStringArray(String[] array) {
+            _StringArray = array;
+        }
+        public String[] getStringArray() {
+            return _StringArray;
+        }
+
+        public void setInt(int val) {
+            _int = val;
+        }
+        public int getInt() {
+            return _int;
+        }
+
+        public void setInteger(Integer val) {
+            _Integer = val;
+        }
+        public Integer getInteger() {
+            return _Integer;
+        }
+
+        public void setDoub(double val) {
+            _double = val;
+        }
+        public double getDoub() {
+            return _double;
+        }
+
+        public void setDouble(Double val) {
+            _Double = val;
+        }
+        public Double getDouble() {
+            return _Double;
+        }
+
+        public void setProperties(Properties props) {
+            _Properties = props;
+        }
+        public Properties getProperties() {
+            return _Properties;
+        }
+
+        public void setFile(File f) {
+            _File = f;
+        }
+        public File getFile() {
+            return _File;
+        }
+        
+        public void setButton(JButton button) {
+            _button = button;
+        }
+
+        public JButton getButton() {
+            return _button;
+        }
+
+        public void setObject(Object o) {
+            _Object = o;
+        }
+
+        public Object getObject() {
+            return _Object;
+        }
+
+        public Object clone() {
+            try {
+                return super.clone();
+            }
+            catch(CloneNotSupportedException ex) {
+                return null;
+            }
+        }
+    }
+
+
+    /** 
+     * Test code.
+     * 
+     * @param args First arg is the class name to create
+     */
+    public static void main(String[] args) {
+
+        try {
+            Class type = null;
+            Object instance = null;
+            if(args.length > 0) {
+                type = Class.forName(args[0]);
+                instance = type.newInstance();
+            }
+            else {
+                type = TestClass.class;
+                instance = new TestClass();
+                ((TestClass)instance).setObject(new TestClass());
+            }
+
+            JFrame f = new JFrame(type.getName());
+            DynamicCustomizer custom = new DynamicCustomizer(type);
+            custom.setObject(instance);
+            f.getContentPane().add(new JScrollPane(custom));
+            f.pack();
+            f.setVisible(true);
+        }
+        catch(Exception ex) {
+            ex.printStackTrace();
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/FilePropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/FilePropertyEditor.java
new file mode 100644
index 0000000..3e31f95
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/FilePropertyEditor.java
@@ -0,0 +1,215 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import javax.swing.filechooser.FileFilter;
+import java.awt.Component;
+import java.awt.BorderLayout;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+import javax.swing.border.BevelBorder;
+import java.io.File;
+
+
+/**
+ * Custom property editor for File types.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class FilePropertyEditor extends AbstractPropertyEditor {
+    /** Area for typing in the file name. */
+    private JTextField _widget = null;
+    /** Container for the editor. */
+    private JPanel _container = null;
+    /** File filter to use. */
+    private FileFilter _filter = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public FilePropertyEditor() {
+        _container = new JPanel(new BorderLayout());
+
+        _widget = new JTextField();
+
+        _widget.addFocusListener(new FocusHandler(this));
+
+        _container.add(_widget, BorderLayout.CENTER);
+
+        JButton b = new JButton("Browse...");
+        b.addActionListener(new ActionHandler());
+        _container.add(b, BorderLayout.EAST);
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _container;
+    }
+
+    /** 
+     * File filter to use with chooser.
+     * 
+     * @param filter File filter.
+     */
+    public void setFileFilter(FileFilter filter) {
+        _filter = filter;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return "new File(" + getAsText() + ")";
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        if(value == null) {
+            value = new File("");
+        }
+
+        if(!(value instanceof File)) {
+            throw new IllegalArgumentException(
+                value.getClass().getName() + " is not of type File");
+        }
+
+        Object old = _widget.getText();
+
+        _widget.setText(((File)value).getPath());
+    }
+
+    /**
+     * @return The value of the property.  Builtin types
+     * such as "int" will be wrapped as the corresponding
+     * object type such as "java.lang.Integer".  */
+    public Object getValue() {
+        File retval = null;
+        retval = new File(_widget.getText());
+        return retval;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) throws IllegalArgumentException {
+        File f = new File(text);
+        _widget.setText(f.getPath());
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return new File(_widget.getText()).getAbsolutePath();
+    } 
+
+    /** Handler for presses of the browse button. */
+    private class ActionHandler implements ActionListener {
+        public void actionPerformed(ActionEvent e) {
+            JFileChooser chooser = null;
+            chooser = new JFileChooser();
+            chooser.setSelectedFile((File) getValue());
+
+
+            _filter = (_filter == null ? 
+                       chooser.getAcceptAllFileFilter() : _filter);
+            chooser.setFileFilter(_filter);
+            chooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
+            if(chooser.showDialog(getChild(), "Select") == 
+               JFileChooser.APPROVE_OPTION) {
+                Object oldValue = getValue();
+                Object newValue = chooser.getSelectedFile();
+
+                setValue(newValue);
+                firePropertyChange(oldValue, newValue);
+            }
+        }
+    }
+
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/IntegerPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/IntegerPropertyEditor.java
new file mode 100644
index 0000000..1208c86
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/IntegerPropertyEditor.java
@@ -0,0 +1,172 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import java.awt.Component;
+
+/**
+ * Custom property editor for integer types.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class IntegerPropertyEditor extends AbstractPropertyEditor {
+    /** Editing widget. */
+    private JTextField _widget = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public IntegerPropertyEditor() {
+        _widget = new JTextField();
+        _widget.addFocusListener(new FocusHandler(this));
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _widget;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return "new Integer(" + getAsText() + ")";
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        Object old = _widget.getText();
+        if(!(value instanceof Integer)) {
+            value = new Integer(0);
+        }
+
+        _widget.setText(value.toString());
+    }
+
+    /**
+     * @return The value of the property.  Builtin types such as "int" will
+     * be wrapped as the corresponding object type such as "java.lang.Integer".
+     */
+    public Object getValue() {
+        Integer retval = null;
+        try {
+            retval = new Integer(_widget.getText());
+        }
+        catch(NumberFormatException ex) {
+            retval = new Integer(0);
+            _widget.setText(retval.toString());
+        }
+        return retval;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) {
+        Object old = _widget.getText();
+        Integer val = null;
+        try {
+            val = new Integer(text);
+        }
+        catch(NumberFormatException ex) {
+            val = new Integer(0);
+        }
+        text = val.toString();
+        _widget.setText(text);
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return _widget.getText();
+    } 
+
+
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/ObjectPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/ObjectPropertyEditor.java
new file mode 100644
index 0000000..9e87f66
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/ObjectPropertyEditor.java
@@ -0,0 +1,313 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import java.awt.*;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+import java.lang.reflect.Method;
+import javax.swing.border.BevelBorder;
+
+/**
+ * Custom property editor for generic Object types. Useful for 
+ * complex objects where using the DynamicCustomizer may be useful.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class ObjectPropertyEditor extends AbstractPropertyEditor {
+    /** Area for typing in the file name. */
+    private JTextField _widget = null;
+    /** Container for the editor. */
+    private JPanel _container = null;
+    /** The current object value. */
+    private Object _value = null;
+    /** The editing button. */
+    private JButton _button = null;
+    /** Flag to indicate that cancellation of editing is supported. */
+    private boolean _supportCancel = true;
+    /** Original value. Only used if _supportCancel is true. */
+    private Object _original = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public ObjectPropertyEditor() {
+        _container = new JPanel(new BorderLayout());
+        
+        _widget = new JTextField(25);
+        _widget.setEditable(false);
+        _widget.addFocusListener(new FocusHandler(this));
+        _widget.setBorder(
+            BorderFactory.createBevelBorder(BevelBorder.LOWERED));
+
+        _container.add(_widget, BorderLayout.CENTER);
+
+        _button = new JButton("Edit...");
+        _button.addActionListener(new ActionHandler());
+        _container.add(_button, BorderLayout.EAST);
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _container;
+    }
+
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return null;
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     * @exception IllegalArgumentException thrown if value can't be cloned.
+     */
+    public void setValue(Object value) {
+
+        if(_supportCancel && value != _value) {
+            try {
+                _value = makeClone(value);
+            }
+            catch(CloneNotSupportedException ex){
+                // If cloning doesn't work then we can't support a "cancel"
+                // option on the editing dialog.
+                _supportCancel = false;
+            }
+            _original = value;
+        }
+        
+        _value = value;
+
+        _button.setEnabled(_value != null);
+
+        _widget.setText(getAsString(_value));
+    }
+
+    /** 
+     * Convert the given value into some appropriate string. NB: This method
+     * can be continually improved to be made more and more smart over time.
+     * 
+     * @param value Value to convert.
+     * @return String value to display.
+     */
+    private String getAsString(Object value) {
+        String retval = null;
+        if(value == null) {
+            retval = "<null>";
+        }
+
+        // We try to be smart by querying for various, logical string 
+        // representation of the value.
+        if(retval == null) {
+            try {
+                Method m = value.getClass().getMethod("getName", null);
+                retval = (String) m.invoke(value, null);
+            }
+            catch(Exception ex) {
+            }
+        }
+        if(retval == null) {
+            try {
+                Method m = value.getClass().getMethod("getLabel", null);
+                retval = (String) m.invoke(value, null);
+            }
+            catch(Exception ex) {
+            }
+            
+        }
+        if(retval == null) {
+            try {
+                Method m = value.getClass().getMethod("getText", null);
+                retval = (String) m.invoke(value, null);
+            }
+            catch(Exception ex) {
+            }
+        }
+
+        if(retval == null) {
+            retval = value.toString();
+        }
+
+        if(retval.length() > 256) {
+            retval = retval.substring(0, 253) + "...";
+        }
+
+        return retval;
+    }
+
+    /** 
+     * Attampt to make a clone of the given value.
+     * 
+     * @param value Value to clone.
+     * @return Cloned value, or null if value given was null.
+     * @exception IllegalArgumentException thrown if value can't be cloned.
+     */
+    private Object makeClone(Object value) throws CloneNotSupportedException {
+        Object retval = null;
+        if(value != null) {
+            try {
+                Method m = value.getClass().getMethod("clone", null);
+                retval = m.invoke(value, null);
+            }
+            catch(Throwable ex) {
+                throw new CloneNotSupportedException(
+                    "This editor only supports types that have publically " +
+                    "accessible clone() methods.\n" + 
+                    value.getClass().getName() + 
+                    " does not have such a method.");
+            }
+        }
+        return retval;
+    }
+
+    /**
+     * @return The value of the property.  Builtin types
+     * such as "int" will be wrapped as the corresponding
+     * object type such as "java.lang.Integer".  */
+    public Object getValue() {
+        return _value;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) throws IllegalArgumentException {
+        throw new IllegalArgumentException("String conversion not supported.");
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return null;
+    } 
+
+    /** Handler for presses of the edit button. */
+    private class ActionHandler implements ActionListener {
+        public void actionPerformed(ActionEvent e) {
+            if(_value == null) return;
+            Class type = _value.getClass();
+            DynamicCustomizer c = new DynamicCustomizer(type);
+            c.setObject(_value);
+
+            int returnVal = JOptionPane.OK_OPTION;
+            if(_supportCancel) {
+                returnVal = JOptionPane.showConfirmDialog(
+                    getChild(), new JScrollPane(c), "Editing...", 
+                    JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);
+            }
+            else {
+                JOptionPane.showMessageDialog(
+                    getChild(), new JScrollPane(c), "Editing...",
+                    JOptionPane.PLAIN_MESSAGE);
+                returnVal = JOptionPane.OK_OPTION;
+            }
+
+            if(returnVal == JOptionPane.OK_OPTION) {
+                Object oldValue = _original;
+                Object newValue = _value;
+
+                setValue(newValue);
+                firePropertyChange(oldValue, newValue);
+            } 
+            else {
+                try {
+                    _value = makeClone(_original);
+                }
+                catch(CloneNotSupportedException ex) {
+                    // XXX log me. Shouldn't have gotten here as
+                    // the test for cloneability should have already been done.
+                    ex.printStackTrace();
+                    _supportCancel = false;
+                }
+            }
+        }
+    }
+
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/PropertiesPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/PropertiesPropertyEditor.java
new file mode 100644
index 0000000..caba65a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/PropertiesPropertyEditor.java
@@ -0,0 +1,308 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import javax.swing.table.AbstractTableModel;
+import java.awt.Component;
+import java.awt.Dimension;
+import java.awt.BorderLayout;
+import java.util.*;
+
+/**
+ * Custom property editor for the Properties class.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class PropertiesPropertyEditor extends AbstractPropertyEditor {
+    /** Recommended size for widgets inside a JScrollPane, as communicated
+     *  through the setPreferredScrollableViewportSize() method. */
+    protected static final Dimension VIEWPORT_SIZE = new Dimension(200, 50);
+
+    /** Container. */
+    private JPanel _widget = null;
+    /* The current properties being edited. */
+    private Properties _properties = null;
+    /** The table editor for the properties. */
+    private JTable _table = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public PropertiesPropertyEditor() {
+        _widget = new JPanel(new BorderLayout());
+        _widget.addFocusListener(new FocusHandler(this));
+
+        _table = new JTable();
+        _table.setPreferredScrollableViewportSize(VIEWPORT_SIZE);
+        JScrollPane scroller = new JScrollPane(_table);
+        _widget.add(BorderLayout.CENTER, scroller);
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _widget;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return "new Properties()";
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        if(value == null) {
+            value = new Properties();
+        }
+
+        if(!(value instanceof Properties)) {
+            throw new IllegalArgumentException(
+                value.getClass().getName() + " is not of type Properties.");
+        }
+
+        Object old = _properties;
+        _properties = (Properties) ((Properties) value).clone();
+
+        PropertiesTableModel model = new PropertiesTableModel();
+        _table.setModel(model);
+        _table.clearSelection();
+    }
+
+    /**
+     * @return The value of the property.  Builtin types
+     * such as "int" will be wrapped as the corresponding
+     * object type such as "java.lang.Integer".  
+     */
+    public Object getValue() {
+        return _properties;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) throws IllegalArgumentException {
+        throw new IllegalArgumentException("Cannot be expressed as a String");
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return null;
+    } 
+
+    /** Table model view of the Properties object. */
+    private class PropertiesTableModel extends AbstractTableModel {
+        private static final int NAME = 0;
+        private static final int VALUE = 1;
+
+        private List _keys = null;
+
+        public PropertiesTableModel() {
+            // We need to store the property keys in an array
+            // so that the ordering is preserved.
+            _keys = new ArrayList(_properties.keySet());
+            Collections.sort(_keys);
+        }
+
+        /** 
+         * Get the number of rows. 
+         * 
+         * @return Number of rows.
+         */
+        public int getRowCount() {
+            return _properties.size() + 1;
+        }
+
+        /** 
+         * Get the number of columns.
+         * 
+         * @return 2
+         */
+        public int getColumnCount() {
+            return 2;
+        }
+
+        /** 
+         * Get the editing and display class of the given column.
+         * 
+         * @return String.class
+         */
+        public Class getColumnClass(int column) {
+            return String.class;
+        }
+
+        /** 
+         * Get the header name of the column.
+         * 
+         * @param column Column index.
+         * @return Name of the column.
+         */
+        public String getColumnName(int column) {
+            // XXX fix me.
+            return column == NAME ? "Name" : "Value";
+        }
+
+        /** 
+         * Determine if the given cell is editable.
+         * 
+         * @param row Cell row.
+         * @param column Cell column.
+         * @return true
+         */
+        public boolean isCellEditable(int row, int column) {
+            return true;
+        }
+
+        /** 
+         * Get the object at the given table coordinates.
+         * 
+         * @param row Table row.
+         * @param column Table column.
+         * @return Object at location, or null if none.
+         */
+        public Object getValueAt(int row, int column) {
+            if(row < _properties.size()) {
+                switch(column) {
+                  case NAME: 
+                      return _keys.get(row);
+                  case VALUE: 
+                      return _properties.getProperty((String)_keys.get(row));
+                }
+            }
+            return null;
+        }
+        /** 
+         * Set the table value at the given location.
+         * 
+         * @param value Value to set.
+         * @param row Row.
+         * @param column Column.
+         */
+        public void setValueAt(Object value, int row, int column) {
+            String k = null;
+            String v = null;
+
+            String currKey = (String) getValueAt(row, NAME);
+            switch(column) {
+              case NAME: 
+                  k = String.valueOf(value);
+                  if(row < _keys.size()) {
+                      _keys.set(row, k);
+                  }
+                  else {
+                      _keys.add(k);
+                  }
+                  String currValue = null;
+                  if(currKey != null) {
+                      currValue = _properties.getProperty(currKey);
+                      _properties.remove(currKey);
+                  }
+                  v = currValue == null ? "" : currValue;
+                  break;
+              case VALUE:
+                  v = String.valueOf(value);
+                  k = currKey;
+                  if(k == null || k.length() == 0) {
+                      k = "key-for-" + v;
+                  }
+                  break;
+            }
+
+            if(k.length() > 0) {
+                _properties.setProperty(k, v);
+            }
+
+            fireTableRowsUpdated(row, row);
+            // Fire change in outer class.
+            firePropertyChange(null, _properties);
+        }
+    }
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringArrayPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringArrayPropertyEditor.java
new file mode 100644
index 0000000..89817dd
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringArrayPropertyEditor.java
@@ -0,0 +1,179 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import javax.swing.border.BevelBorder;
+import java.awt.Component;
+import java.util.StringTokenizer;
+
+/**
+ * Custom property editor for String arrays.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class StringArrayPropertyEditor extends AbstractPropertyEditor {
+    private JTextField _widget = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public StringArrayPropertyEditor() {
+        _widget = new JTextField() ;
+        _widget.setBorder(
+            BorderFactory.createBevelBorder(BevelBorder.LOWERED));
+        _widget.addFocusListener(new FocusHandler(this));
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _widget;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return getAsText();
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        if(value == null) {
+            value = new String[0];
+        }
+        if(!(value instanceof String[])) {
+            throw new IllegalArgumentException(
+                "Value must be of type String[].");
+        }
+        String old = _widget.getText();
+
+        String[] vals = (String[]) value;
+        StringBuffer buf = new StringBuffer();
+
+        for(int i = 0; i < vals.length; i++) {
+            buf.append(vals[i]);
+            if(i < vals.length - 1) {
+                buf.append(", ");
+            }
+        }
+        _widget.setText(buf.toString());
+    }
+
+    /**
+     * @return The value of the property.  Builtin types such as "int" will
+     * be wrapped as the corresponding object type such as "java.lang.Integer".
+     */
+    public Object getValue() {
+        String vals = _widget.getText();
+        StringTokenizer tok = new StringTokenizer(vals,",");
+        String[] retval = new String[tok.countTokens()];
+        for(int i = 0; i < retval.length; i++) {
+            retval[i] = tok.nextToken().trim();
+        }
+
+        return retval;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) throws IllegalArgumentException {
+        Object old = _widget.getText();
+        _widget.setText(text);
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return _widget.getText();
+    } 
+
+
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringPropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringPropertyEditor.java
new file mode 100644
index 0000000..ef36346
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/customizer/StringPropertyEditor.java
@@ -0,0 +1,165 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.customizer;
+
+import javax.swing.*;
+import java.awt.Component;
+import javax.swing.border.BevelBorder;
+
+/**
+ * Custom property editor for string types.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class StringPropertyEditor extends AbstractPropertyEditor {
+    private JTextArea _widget = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public StringPropertyEditor() {
+        _widget = new JTextArea() {
+                public boolean isManagingFocus() {
+                    return false;
+                }
+            };
+
+        _widget.setLineWrap(true);
+        _widget.addFocusListener(new FocusHandler(this));
+        _widget.setBorder(
+            BorderFactory.createBevelBorder(BevelBorder.LOWERED));
+    }
+
+    /** 
+     * Get the child editing component. Uses JComponent so we can have tool
+     * tips, etc.
+     * 
+     * @return Child editing component.
+     */
+    protected Component getChild() {
+        return _widget;
+    }
+
+    /**
+     * This method is intended for use when generating Java code to set
+     * the value of the property.  It should return a fragment of Java code
+     * that can be used to initialize a variable with the current property
+     * value.
+     * <p>
+     * Example results are "2", "new Color(127,127,34)", "Color.orange", etc.
+     *
+     * @return A fragment of Java code representing an initializer for the
+     *      current value.
+     */
+    public String getJavaInitializationString() {
+        return getAsText();
+    }
+
+    /**
+     * Set (or change) the object that is to be edited.  Builtin types such
+     * as "int" must be wrapped as the corresponding object type such as
+     * "java.lang.Integer".
+     *
+     * @param value The new target object to be edited.  Note that this
+     *     object should not be modified by the PropertyEditor, rather 
+     *     the PropertyEditor should create a new object to hold any
+     *     modified value.
+     */
+    public void setValue(Object value) {
+        if(value == null) {
+            value = "";
+        }
+
+        Object old = _widget.getText();
+        _widget.setText(String.valueOf(value));
+    }
+
+    /**
+     * @return The value of the property.  Builtin types
+     * such as "int" will be wrapped as the corresponding
+     * object type such as "java.lang.Integer".  */
+    public Object getValue() {
+        String retval = _widget.getText();
+        return retval;
+    }
+
+    /**
+     * Set the property value by parsing a given String.  May raise
+     * java.lang.IllegalArgumentException if either the String is
+     * badly formatted or if this kind of property can't be expressed
+     * as text.
+     * @param text  The string to be parsed.
+     */
+    public void setAsText(String text) throws IllegalArgumentException {
+        Object old = _widget.getText();
+        _widget.setText(text);
+    }
+
+    /**
+     * @return The property value as a human editable string.
+     * <p>   Returns null if the value can't be expressed 
+     *       as an editable string.
+     * <p>   If a non-null value is returned, then the PropertyEditor should
+     *       be prepared to parse that string back in setAsText().
+     */
+    public String getAsText() {
+        return _widget.getText();
+    } 
+
+
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntBuildEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntBuildEvent.java
new file mode 100644
index 0000000..81caf70
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntBuildEvent.java
@@ -0,0 +1,129 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.gui.util.StackFrame;
+import org.apache.tools.ant.gui.command.Command;
+import org.apache.tools.ant.gui.command.NoOpCmd;
+import org.apache.tools.ant.gui.core.AppContext;
+import java.util.EventObject;
+
+/**
+ * Wrapper event for the events generated during an Ant build.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class AntBuildEvent extends AntEvent {
+
+    /** The original event we are wrapping. */
+    private BuildEvent _buildEvent = null;
+    /** The type of event we are wrapping. */
+    private BuildEventType _type = null;
+
+    /**
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+	 */
+    public AntBuildEvent(AppContext context, 
+                         BuildEvent buildEvent, BuildEventType type) {
+        super(context);
+        _buildEvent = buildEvent;
+        _type = type;
+
+        if(_buildEvent == null || _type == null) {
+            throw new IllegalArgumentException("Null parameter passed");
+        }
+    }
+
+	/** 
+	 * Get the wrapped build event.
+	 * 
+	 * @return Build event.
+	 */
+    public BuildEvent getEvent() {
+        return _buildEvent;
+    }
+
+	/** 
+	 * Get the build event type.
+	 * 
+	 * @return Event type.
+	 */
+    public BuildEventType getType() {
+        return _type;
+    }
+
+	/** 
+	 * Create a string representation of this.
+	 * 
+	 * @return String representation.
+	 */
+    public String toString() {
+        StringBuffer buf = new StringBuffer();
+
+        if(_buildEvent.getMessage() != null) {
+            buf.append(_buildEvent.getMessage());
+            buf.append('\n');
+        }
+
+        if(_buildEvent.getException() != null) {
+            buf.append(StackFrame.toString(_buildEvent.getException()));
+        }
+
+        return buf.toString();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntEvent.java
new file mode 100644
index 0000000..8042a1c
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/AntEvent.java
@@ -0,0 +1,99 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.command.Command;
+import org.apache.tools.ant.gui.command.NoOpCmd;
+import org.apache.tools.ant.gui.core.AppContext;
+import java.util.EventObject;
+
+/**
+ * Base class for all Ant specific events. Details TBD.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class AntEvent extends EventObject {
+
+	/** Flag indicating that the event has been cancelled. */
+	private boolean _cancelled = false;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+	 */
+    protected AntEvent(AppContext context) {
+        super(context);
+    }
+
+	/** 
+	 * Get the application context.
+	 * 
+	 * @return Application context.
+	 */
+    protected AppContext getContext() {
+        return (AppContext) getSource();
+    }
+
+
+	/** 
+	 * Override to create the appropriate default response
+	 * command to this event.
+	 * 
+	 * @return Command representing an appropriate response to this event.  
+     */
+    public Command createDefaultCmd() {
+        return new NoOpCmd(getContext());
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildEventType.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildEventType.java
new file mode 100644
index 0000000..edb3564
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildEventType.java
@@ -0,0 +1,208 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.BuildEvent;
+import java.lang.reflect.Method;
+
+/**
+ * Enumeration class of the different contexts in which Ant will generate
+ * a BuildEvent.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildEventType {
+    /** Enum value. */
+    private int _value = 0;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param value Index value.
+	 */
+    private BuildEventType(int value) {
+        _value = value;
+    }
+
+	/** 
+	 * Get the enumeration value.
+	 * 
+	 * @return 
+	 */
+    public int getValue() {
+        return _value;
+    }
+
+	/** 
+	 * Pseudo abstract method for firing an event to a build listener
+     * based on our enumation value. I overridded by the individual instances.
+	 * 
+	 * @param e Event to fire.
+	 * @param l Listener to send event to.
+	 */
+    public void fireEvent(BuildEvent e, BuildListener l) {
+        try {
+            Method method = 
+                BuildListener.class.getMethod(_methodNameMap[_value], 
+                                              _listenerMethodParam);
+            method.invoke(l, new Object[] { e });
+        }
+        catch(Exception ex) {
+            // XXX log me.
+            ex.printStackTrace();
+        }
+    }
+
+	/** 
+	 * Get the enumeration value with the given index value.
+	 * 
+	 * @param value Index value.
+	 * @return Enumeration value.
+	 */
+    public static BuildEventType fromInt(int value) {
+        return _objectMap[value];
+    }
+
+	/** 
+	 * Determine if the given object is logically equal to this one.
+	 * 
+	 * @param o Object to compare to 
+	 * @return True if equal, false otherwise.
+	 */
+    public boolean equals(Object o) {
+        if(o instanceof BuildEventType) {
+            return ((BuildEventType)o)._value == _value;
+        }
+        return false;
+    }
+	/** 
+	 * Generate a hash value.
+	 * 
+	 * @return Hash value.
+	 */
+    public int hashValue() {
+        return _value;
+    }
+
+	/** 
+	 * Provide a string representation of this. 
+	 * 
+	 * @return String representation.
+	 */
+    public String toString() {
+        return _stringMap[_value];
+    }
+
+
+    /* Index values. */ 
+    public static final int BUILD_STARTED_VAL = 0;
+    public static final int BUILD_FINISHED_VAL = 1;
+    public static final int TARGET_STARTED_VAL = 2;
+    public static final int TARGET_FINISHED_VAL = 3;
+    public static final int TASK_STARTED_VAL = 4;
+    public static final int TASK_FINISHED_VAL = 5;
+    public static final int MESSAGE_LOGGED_VAL = 6;
+
+    /* Enumeration values. */ 
+    public static final BuildEventType BUILD_STARTED = 
+      new BuildEventType(BUILD_STARTED_VAL);
+    public static final BuildEventType BUILD_FINISHED = 
+      new BuildEventType(BUILD_FINISHED_VAL);
+    public static final BuildEventType TARGET_STARTED = 
+      new BuildEventType(TARGET_STARTED_VAL);
+    public static final BuildEventType TARGET_FINISHED = 
+      new BuildEventType(TARGET_FINISHED_VAL);
+    public static final BuildEventType TASK_STARTED = 
+      new BuildEventType(TASK_STARTED_VAL);
+    public static final BuildEventType TASK_FINISHED = 
+      new BuildEventType(TASK_FINISHED_VAL);
+    public static final BuildEventType MESSAGE_LOGGED = 
+      new BuildEventType(MESSAGE_LOGGED_VAL);
+
+    /** Index to object mapping. */
+    private static final BuildEventType[] _objectMap = {
+        BUILD_STARTED,
+        BUILD_FINISHED,
+        TARGET_STARTED,
+        TARGET_FINISHED,
+        TASK_STARTED,
+        TASK_FINISHED,
+        MESSAGE_LOGGED
+    };
+
+    /** String map. XXX needs to be localized. */
+    private static final String[] _stringMap = {
+        "Build Started",
+        "Build Finished",
+        "Target Started",
+        "Target Finished",
+        "Task Started",
+        "Task Finished",
+        "Message Logged"
+    };
+
+    /** Map of corresponding method names in the BuildListener intereface. */
+    private static final String[] _methodNameMap = {
+        "buildStarted",
+        "buildFinished",
+        "targetStarted",
+        "targetFinished",
+        "taskStarted",
+        "taskFinished",
+        "messageLogged"
+    };
+
+    private static final Class[] _listenerMethodParam = { BuildEvent.class };
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildFinishedEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildFinishedEvent.java
new file mode 100644
index 0000000..3865d77
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildFinishedEvent.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.gui.core.AppContext;
+
+
+/**
+ * Build finished. This event is a duplication of the information posted as
+ * an AntBuildEvent when a build finishes.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildFinishedEvent extends AntEvent {
+
+    /** The originating event from Ant. */
+    private BuildEvent _orig = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context The application context.
+	 * @param orig The originating event.
+	 */
+    public BuildFinishedEvent(AppContext context, BuildEvent orig) {
+        super(context);
+        _orig = orig;
+    }
+
+	/** 
+	 * Get the originating event.
+	 * 
+	 * @return Originating event.
+	 */
+    public BuildEvent getBuildEvent() {
+        return _orig;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildStartedEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildStartedEvent.java
new file mode 100644
index 0000000..0e161f4
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BuildStartedEvent.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.gui.core.AppContext;
+
+
+/**
+ * Build started. This event is a duplication of the information posted as
+ * an AntBuildEvent when a build starts.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildStartedEvent extends AntEvent {
+
+    /** The originating event from Ant. */
+    private BuildEvent _orig = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context The application context.
+	 * @param orig The originating event.
+	 */
+    public BuildStartedEvent(AppContext context, BuildEvent orig) {
+        super(context);
+        _orig = orig;
+    }
+
+	/** 
+	 * Get the originating event.
+	 * 
+	 * @return Originating event.
+	 */
+    public BuildEvent getBuildEvent() {
+        return _orig;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusFilter.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusFilter.java
new file mode 100644
index 0000000..d5da326
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusFilter.java
@@ -0,0 +1,73 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import java.util.EventObject;
+
+
+/**
+ * Interace for determining whether an event should be given to a BusMember
+ * instance.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public interface BusFilter {
+	/** 
+	 * Determines if the given event should be accepted.
+	 * 
+	 * @param event Event to test.
+	 * @return True if event should be given to BusMember, false otherwise.
+	 */
+    boolean accept(EventObject event);
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusMember.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusMember.java
new file mode 100644
index 0000000..7028824
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/BusMember.java
@@ -0,0 +1,82 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+
+import java.util.EventObject;
+
+/**
+ * Interface for classes that want to be a member of the EventBus.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public interface BusMember {
+	/** 
+	 * Get the filter to that is used to determine if an event should
+     * to to the member.
+	 * 
+	 * @return Filter to use.
+	 */
+    BusFilter getBusFilter();
+
+	/** 
+	 * Called when an event is to be posed to the member.
+	 * 
+	 * @param event Event to post.
+     * @return true if event should be propogated, false if
+     * it should be cancelled.
+     */
+    boolean eventPosted(EventObject event);
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ElementSelectionEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ElementSelectionEvent.java
new file mode 100644
index 0000000..0f732d2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ElementSelectionEvent.java
@@ -0,0 +1,160 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.*;
+import org.apache.tools.ant.gui.command.Command;
+import org.apache.tools.ant.gui.command.DisplayErrorCmd;
+import org.apache.tools.ant.gui.core.AppContext;
+
+import java.lang.reflect.Array;
+import java.util.*;
+
+/**
+ * Event indicating that the current set of selected targets has changed.
+ * 
+ * @version $Revision: 1.6 $ 
+ * @author Simeon Fitch 
+ */
+public class ElementSelectionEvent extends AntEvent {
+
+    /** New set of selected elements. */
+    private ACSElement[] _selected = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param selected the selected Elements.
+	 */
+    protected ElementSelectionEvent(AppContext context, 
+                                    ACSElement[] selected) {
+        super(context);
+        _selected = selected;
+    }
+
+	/** 
+	 * Current set of selected elements.
+	 * 
+     * @return selected element set.
+	 */
+    public ACSElement[] getSelectedElements() {
+        return _selected;
+    }
+
+
+    /** 
+     * Get only those events of a specific type.
+     * 
+     * @param type Specific type to get values for, or null if none.
+     */
+    protected ACSElement[] getFiltered(Class type) {
+        ACSElement[] retval = null;
+        List vals = new ArrayList(1);
+        if(_selected != null) {
+            for(int i = 0; i < _selected.length; i++) {
+                if(type.isInstance(_selected[i])) {
+                    vals.add(_selected[i]);
+                }
+            }
+        }
+
+        if(vals.size() > 0) {
+            retval = (ACSElement[]) Array.newInstance(type, vals.size());
+            vals.toArray(retval);
+        }
+        return retval;
+    }
+
+	/** 
+	 * Factory method for creating the appropriate specialization of this
+     * for communicating an element selection.
+	 * 
+	 * @param context App context.
+	 * @param selected The set of selected events. The last elemetn in the 
+     *                 array is used to determine the specialization of this
+     *                 that should be returned.
+	 * @return Event to communicate selection to.
+	 */
+    public static ElementSelectionEvent createEvent(AppContext context, 
+                                                    ACSElement[] selected) {
+        ElementSelectionEvent retval = null;
+
+        if(selected != null && selected.length > 0) {
+            Class type = selected[selected.length - 1].getClass();
+            if(type.isAssignableFrom(ACSTargetElement.class)) {
+                retval = new TargetSelectionEvent(context, selected);
+            }
+            else if(type.isAssignableFrom(ACSTaskElement.class)) {
+                retval = new TaskSelectionEvent(context, selected);
+            }
+            else if(type.isAssignableFrom(ACSPropertyElement.class)) {
+                retval = new PropertySelectionEvent(context, selected);
+            }
+            else if(type.isAssignableFrom(ACSProjectElement.class)) {
+                retval = new ProjectSelectedEvent(
+                    context, (ACSProjectElement) selected[0]);
+            }
+            else {
+                // For elements without a specific event
+                // type just send and instance of this.
+                retval = new ElementSelectionEvent(context, selected);
+            }
+        }
+        else {
+            retval = new NullSelectionEvent(context);
+        }
+
+        return retval;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ErrorEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ErrorEvent.java
new file mode 100644
index 0000000..50ac392
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ErrorEvent.java
@@ -0,0 +1,134 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.command.DisplayErrorCmd;
+import org.apache.tools.ant.gui.command.Command;
+import org.apache.tools.ant.gui.util.StackFrame;
+
+
+/**
+ * Event fired whenever there is an error of any sort.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class ErrorEvent extends AntEvent {
+    /** Text description of error. */
+    private String _message = null;
+    /** Throwable associated with the error. */
+    private Throwable _ex = null;
+
+	/** 
+	 * Standard constructor.
+	 * 
+	 * @param context Application context.
+	 * @param message Message about the error.
+	 * @param ex Throwable associated with the error.
+	 */
+    public ErrorEvent(AppContext context, String message, Throwable ex) {
+        super(context);
+        _message = message;
+        _ex = ex;
+    }
+
+	/** 
+	 * Message centric constructor.
+	 * 
+	 * @param context Application context.
+	 * @param message Message to display.
+	 */
+    public ErrorEvent(AppContext context, String message) { 
+        this(context, message, null);
+    }
+
+	/** 
+	 * Throwable centric constructor.
+	 * 
+	 * @param context Application context.
+	 * @param ex Throwable behind the error.
+	 */
+    public ErrorEvent(AppContext context, Throwable ex) {
+        this(context, ex.getMessage(), ex);
+    }
+
+	/** 
+	 * Create the appropriate response command to this event.
+	 * 
+	 * @return Command representing an appropriate response to this event.
+	 */
+    public Command createDefaultCmd() {
+        Command retval = new DisplayErrorCmd(getContext(), _message, _ex);
+        return retval;
+    }
+
+	/** 
+	 * Create human readable version of this.
+	 * 
+	 * @return String representation.a
+	 */
+    public String toString() {
+        StringBuffer buf = new StringBuffer("Error: ");
+
+        if(_message != null) {
+            buf.append(_message);
+            buf.append('\n');
+        }
+        if(_ex != null) {
+            buf.append(StackFrame.toString(_ex));
+        }
+        return buf.toString();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/EventBus.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/EventBus.java
new file mode 100644
index 0000000..48acc2a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/EventBus.java
@@ -0,0 +1,197 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+
+import java.util.*;
+import javax.swing.SwingUtilities;
+/**
+ * An event "bus" providing a centralized place for posting
+ * and recieving generic application events. To receive events a class must 
+ * implement the "BusMember" interface. When registering as a member, an
+ * "interrupt level" is provided, which specifies a relative ordering level
+ * that the member wishes to receive events for. By convention, a member
+ * can be registered at the MONITORING, VETOING, or RESPONDING levels, which
+ * correspond to recieving events first to receiving events last. If a member
+ * receives an event, the event is of type AntEvent, and the member calls the 
+ * AntEvent.cancel() method, the event is not then delivered
+ * to subsequent members. Members also indicate interest in an event
+ * by providing an instance of the BusFilter interface.<BR>
+ *
+ * NB: This class is overly simple right now, but will eventually
+ * be expanded to do better event filtering, interrupt levels, etc. 
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+*/
+public class EventBus {
+	/** The default "vetoing" interrupt level, used by bus members
+	 *  whose role is to veto request events or otherwise handle an
+	 *  event before it is processed by the default handler. */
+	public static final int VETOING = 1;
+	/** The default "monitoring" interrupt level, used by members who
+	 * are only listeners/monitors of events. */
+	public static final int MONITORING = 5;
+	/** The default "responding" interrupt level, for members who service
+	 *  events in a default manner. */
+	public static final int RESPONDING = 10;
+
+	/** The maximum valid interrupt value. */
+	public static final int MAX_INTERRUPT = 15;
+
+    /** Set of bus members, with a list for each interrupt level. */
+    private List[] _memberSet = new List[MAX_INTERRUPT];
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+    public EventBus() {
+    }
+
+	/** 
+	 * Add a member to the bus. 
+	 * 
+	 * @param intLevel Interrupt level.
+	 * @param member Member to add.
+	 */
+    public void addMember(int intLevel, BusMember member) {
+		if(intLevel < 1 || intLevel > MAX_INTERRUPT) {
+			throw new IllegalArgumentException(
+				"Invalid interrupt level: " + intLevel);
+		}
+        synchronized(_memberSet) {
+			List list = _memberSet[intLevel - 1];
+			if(list == null) {
+				list = new LinkedList();
+				_memberSet[intLevel - 1] = list;
+			}
+            list.add(member);
+        }
+    }
+
+
+	/** 
+	 * Remove a member from the bus.
+	 * 
+	 * @param member Member to remove.
+	 */
+    public void removeMember(BusMember member) {
+        synchronized(_memberSet) {
+			// XXX lets hope we don't do too much removing. Yuck...
+			for(int i = 0; i < _memberSet.length; i++) {
+				if(_memberSet[i] == null) continue;
+				_memberSet[i].remove(member);
+			}
+        }
+    }
+
+	/** 
+	 * Method used for sending an event to the bus.
+	 * 
+	 * @param event Event to post.
+	 */
+    public void postEvent(EventObject event) {
+        EventDispatcher disp = new EventDispatcher(event);
+
+        // Events need to be dispatched on the AWTEvent thread, as the UI
+        // components assume that.
+        if(SwingUtilities.isEventDispatchThread()) {
+            disp.run();
+        }
+        else {
+            SwingUtilities.invokeLater(disp);
+        }
+    }
+
+    /** Class that performs the duty of dispatching events to the members. */
+    private class EventDispatcher implements Runnable {
+        /** Event to dispatch. */
+        private EventObject _event = null;
+        
+        /** 
+         * Standard ctor.
+         * 
+         * @param event Event to dispatch.
+         */
+        public EventDispatcher(EventObject event) {
+            _event = event;
+        }
+
+        /** 
+         * Perform dispatching.
+         * 
+         */
+        public void run() {
+            synchronized(_memberSet) {
+              outerLoop:
+                for(int i = 0; i < _memberSet.length; i++) {
+                    if(_memberSet[i] == null) continue;
+                    
+                    Iterator it = _memberSet[i].iterator();
+                    while(it.hasNext()) {
+                        BusMember next = (BusMember) it.next();
+                        BusFilter filter = next.getBusFilter();
+                        if(filter == null || filter.accept(_event)) {
+                            // If false then callee canceled the event
+                            // propogation.
+                            if(!next.eventPosted(_event)) {
+                                break outerLoop;
+                            }
+                        }
+                    }
+                }
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewElementEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewElementEvent.java
new file mode 100644
index 0000000..67692b0
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewElementEvent.java
@@ -0,0 +1,70 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+/**
+ * Tag interface for indicating that an event is related to creating new
+ * build definition elements.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public interface NewElementEvent {
+    /** 
+     * Get the element that has been added.
+     * 
+     * @return New element.
+     */
+    ACSElement getNewElement();
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewProjectEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewProjectEvent.java
new file mode 100644
index 0000000..33b0d43
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewProjectEvent.java
@@ -0,0 +1,95 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import org.apache.tools.ant.gui.acs.ACSElement;
+
+/**
+ * Event providing notification that a new project has been
+ * created or opened and selected. NB: Still not convinced that
+ * subclassing ProjectSelectedEvent is the correct thing to
+ * do, but it saves some time right now. It basically
+ * assumes that any new project added to the project manager
+ * is then selected.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class NewProjectEvent extends ProjectSelectedEvent 
+    implements NewElementEvent {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+	 */
+    public NewProjectEvent(
+        AppContext context, ACSProjectElement project) {
+        super(context, project);
+        if(project == null) {
+            throw new IllegalArgumentException("A new project can't be null.");
+        }
+    }
+
+    /** 
+     * Get the newly added project.
+     * 
+     * @return New project.
+     */
+    public ACSElement getNewElement() {
+        return getSelectedProject();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewPropertyEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewPropertyEvent.java
new file mode 100644
index 0000000..ed245b4
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewPropertyEvent.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSPropertyElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when a new property is created.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class NewPropertyEvent extends PropertySelectionEvent 
+    implements NewElementEvent {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param prop the new property.
+	 */
+    public NewPropertyEvent(AppContext context, 
+                            ACSPropertyElement prop) {
+        super(context, new ACSElement[] { prop });
+        if(prop == null) {
+            throw new IllegalArgumentException(
+                "A new property can't be null.");
+        }
+    }
+
+    /** 
+     * Get the newly added task.
+     * 
+     * @return New task.
+     */
+    public ACSElement getNewElement() {
+        return getSelectedProperties()[0];
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTargetEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTargetEvent.java
new file mode 100644
index 0000000..1faf4e0
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTargetEvent.java
@@ -0,0 +1,90 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when a new target is created.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class NewTargetEvent extends TargetSelectionEvent 
+    implements NewElementEvent {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param target the new target.
+	 */
+    public NewTargetEvent(AppContext context, 
+                          ACSTargetElement target) {
+        super(context, new ACSElement[] { target });
+        if(target == null) {
+            throw new IllegalArgumentException("A new target can't be null.");
+        }
+    }
+
+    /** 
+     * Get the newly added target.
+     * 
+     * @return New target.
+     */
+    public ACSElement getNewElement() {
+        return getSelectedTargets()[0];
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTaskEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTaskEvent.java
new file mode 100644
index 0000000..149620e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NewTaskEvent.java
@@ -0,0 +1,90 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTaskElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when a new target is created.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class NewTaskEvent extends TaskSelectionEvent 
+    implements NewElementEvent {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param target the new task.
+	 */
+    public NewTaskEvent(AppContext context, 
+                        ACSTaskElement task) {
+        super(context, new ACSElement[] { task });
+        if(task == null) {
+            throw new IllegalArgumentException("A new task can't be null.");
+        }
+    }
+
+    /** 
+     * Get the newly added task.
+     * 
+     * @return New task.
+     */
+    public ACSElement getNewElement() {
+        return getSelectedTasks()[0];
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NullSelectionEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NullSelectionEvent.java
new file mode 100644
index 0000000..d34db25
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/NullSelectionEvent.java
@@ -0,0 +1,74 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when no elements are selected.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class NullSelectionEvent extends ElementSelectionEvent {
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param selected the selected Elements.
+	 */
+    public NullSelectionEvent(AppContext context) {
+        super(context, null);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/OpenRequestEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/OpenRequestEvent.java
new file mode 100644
index 0000000..5a60874
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/OpenRequestEvent.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.command.Command;
+import org.apache.tools.ant.gui.command.LoadFileCmd;
+
+import java.io.File;
+/**
+ * Event for requesting that the given file be opened.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class OpenRequestEvent extends AntEvent {
+    /** The file to open. */
+    private File _file = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context Application context.
+	 * @param file File to be opened.
+	 */
+    public OpenRequestEvent(AppContext context, File file) {
+        super(context);
+        _file = file;
+    }
+
+	/** 
+	 * Create the appropriate response command to this event, which is to
+     * load in a build file.
+	 * 
+	 * @return Load command.
+	 */
+    public Command createDefaultCmd() {
+        LoadFileCmd load = new LoadFileCmd(getContext());
+        load.setFile(_file);
+        return load;
+    }
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectClosedEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectClosedEvent.java
new file mode 100644
index 0000000..4d1b718
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectClosedEvent.java
@@ -0,0 +1,74 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.core.AppContext;
+
+
+/**
+ * Provides notification that the project was closed.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class ProjectClosedEvent extends AntEvent {
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context The application context.
+	 */
+    public ProjectClosedEvent(AppContext context) {
+        super(context);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectSelectedEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectSelectedEvent.java
new file mode 100644
index 0000000..f52f7ad
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/ProjectSelectedEvent.java
@@ -0,0 +1,89 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.acs.ACSProjectElement;
+import org.apache.tools.ant.gui.acs.ACSElement;
+
+/**
+ * Event providing notification of a change in the currently selected project.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class ProjectSelectedEvent extends ElementSelectionEvent {
+    /** The selected project. */
+    private ACSProjectElement _project = null;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+	 */
+    public ProjectSelectedEvent(
+        AppContext context, ACSProjectElement project) {
+        super(context, new ACSElement[] { project });
+        _project = project;
+    }
+
+    /** 
+     * Get the selected project, or null if there are no
+     * open projects.
+     * 
+     * @return Selected project, or null if no projects selected.
+     */
+    public ACSProjectElement getSelectedProject() {
+        return _project;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/PropertySelectionEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/PropertySelectionEvent.java
new file mode 100644
index 0000000..f607fb3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/PropertySelectionEvent.java
@@ -0,0 +1,85 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSPropertyElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when one or more tasks are selected.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class PropertySelectionEvent extends ElementSelectionEvent {
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param selected the selected Elements.
+	 */
+    public PropertySelectionEvent(AppContext context, 
+                              ACSElement[] selected) {
+        super(context, selected);
+    }
+
+    /** 
+     * Get the selected properties.
+     * 
+     */
+    public ACSPropertyElement[] getSelectedProperties() {
+        return (ACSPropertyElement[]) getFiltered(ACSPropertyElement.class);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TargetSelectionEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TargetSelectionEvent.java
new file mode 100644
index 0000000..1405f00
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TargetSelectionEvent.java
@@ -0,0 +1,85 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when one or more targets are selected.
+ * 
+ * @version $Revision: 1.7 $ 
+ * @author Simeon Fitch 
+ */
+public class TargetSelectionEvent extends ElementSelectionEvent {
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param selected the selected Elements.
+	 */
+    public TargetSelectionEvent(AppContext context, 
+                                ACSElement[] selected) {
+        super(context, selected);
+    }
+
+    /** 
+     * Get the selected targets.
+     * 
+     */
+    public ACSTargetElement[] getSelectedTargets() {
+        return (ACSTargetElement[]) getFiltered(ACSTargetElement.class);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TaskSelectionEvent.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TaskSelectionEvent.java
new file mode 100644
index 0000000..bcd4b24
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/event/TaskSelectionEvent.java
@@ -0,0 +1,85 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.event;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTaskElement;
+import org.apache.tools.ant.gui.core.AppContext;
+
+/**
+ * Event fired when one or more tasks are selected.
+ * 
+ * @version $Revision: 1.4 $ 
+ * @author Simeon Fitch 
+ */
+public class TaskSelectionEvent extends ElementSelectionEvent {
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param context application context.
+     * @param selected the selected Elements.
+	 */
+    public TaskSelectionEvent(AppContext context, 
+                              ACSElement[] selected) {
+        super(context, selected);
+    }
+
+    /** 
+     * Get the selected tasks.
+     * 
+     */
+    public ACSTaskElement[] getSelectedTasks() {
+        return (ACSTaskElement[]) getFiltered(ACSTaskElement.class);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/EmacsNotifier.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/EmacsNotifier.java
new file mode 100644
index 0000000..6df20b7
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/EmacsNotifier.java
@@ -0,0 +1,106 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.gui.ide;
+
+import org.apache.tools.ant.taskdefs.ExecTask;
+import org.apache.tools.ant.Project;
+import java.util.StringTokenizer;
+import java.io.File;
+
+/**
+ * FileErrorNotifier specialization for sending file error
+ * messages to emacs via the emacsclient command. This
+ * command <i>must</i> be in the runtime path of the JVM for
+ * it to be found.  
+ * <p> Install the notifier by running Ant as follows:<br> 
+ * <code> 
+ * &nbsp;&nbsp;ant -listener net.noemis.ant.EmacsNotifier 
+ * </code>
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author <a href="mailto:simeon@fitch.net">Simeon H.K. Fitch</a> */
+public class EmacsNotifier extends FileErrorNotifier {
+    /** Command to run to communicate with emacs. */
+	// XXX This should only be a default. A property should be checked
+	// for the actual version. Should Project.getProperty() or 
+	// Project.getUserProperty() be used???
+    private static final String EMACS = "emacsclient";
+
+	/** 
+	 * Called when a message has been logged indicating that
+	 * there is an error of some sort at the given file and
+	 * line number.  Sends a message bto emacs to make emacs
+	 * visit the file and place the mark at the source of
+	 * the error.
+	 * 
+	 * @param file File containing the error.
+	 * @param lineNum Line number of error.  
+	 */
+	protected void fireFileErrorNotification(
+		Project project, File file, int lineNum) {
+		// Launch our command using the built in exec support.
+		ExecTask exec = (ExecTask) project.createTask("exec");
+		// Construct the command to communicate with emacs.
+		// Command has the form:
+		//     emacsclient [-n] [--no-wait] [+LINENUMBER] FILENAME
+		exec.setExecutable(EMACS);
+		exec.createArg().setValue("-n");
+		exec.createArg().setValue("--no-wait");
+		exec.createArg().setValue("+" + lineNum);
+		exec.createArg().setValue(file.toString());
+		exec.setFailonerror(false);
+		exec.execute();
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/FileErrorNotifier.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/FileErrorNotifier.java
new file mode 100644
index 0000000..46667b4
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/ide/FileErrorNotifier.java
@@ -0,0 +1,146 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.gui.ide;
+
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.Project;
+import java.util.StringTokenizer;
+import java.io.File;
+
+/**
+ * Abstract base class for BuildListener specializations interested
+ * in notification of build errors in source files.
+ *
+ * @version $Revision: 1.2 $ 
+ * @author <a href="mailto:simeon@fitch.net">Simeon H.K. Fitch</a>
+ */
+abstract class FileErrorNotifier implements BuildListener {
+    /** Command to run to communicate with emacs. */
+    private static final String EMACS = "emacsclient";
+
+    /**
+     * Fired whenever a message is logged. Parses error messages looking
+     * for a filename and line number specification, which when found
+	 * is then sent to the method <code>fireFileErrorNotification()</code>
+     * source of the error. Only the first error is processed.
+     *
+	 * @param event Incoming event that is filtered for error messages.
+     */
+    public void messageLogged(BuildEvent event) {
+        if(event.getPriority() == Project.MSG_ERR ||
+           event.getPriority() == Project.MSG_WARN) {
+            StringTokenizer tok = new StringTokenizer(event.getMessage(), ":");
+            File file = null;
+            int line = -1;
+            
+            if(tok.hasMoreTokens()) {
+                file = new File(tok.nextToken());
+                if(tok.hasMoreTokens()) {
+                    try {
+                        line = Integer.parseInt(tok.nextToken());
+                    }
+                    catch(NumberFormatException ex) {
+                        // Allow execption to fall through as we test
+                        // success by the value of 'line' below.
+                    }
+                }
+            }
+
+            // Test for successful filename and line number detection.
+            if(file != null && line > 0 && file.exists()) {
+                // Since we only want to trigger on the first error, 
+                // remove ourself from being notified of others.
+				// XXX are there any reasons this should occur after
+				// notification?
+                event.getProject().removeBuildListener(this);
+
+				// Send notification.
+				fireFileErrorNotification(event.getProject(), file, line);
+            }
+        }
+    }
+
+	/** 
+	 * Called when a message has been logged indicating that there
+	 * is an error of some sort at the given file and line number.
+	 * 
+	 * @param file File containing the error.
+	 * @param lineNum Line number of error.
+	 */
+	protected abstract void fireFileErrorNotification(
+		Project project, File file, int lineNum);
+
+    // Event types that are ignored. Looks like we really need a
+    //  BuildAdapter class...
+    /** Ignored */
+    public void buildStarted(BuildEvent event) {
+    }
+    /** Ignored */
+    public void buildFinished(BuildEvent event) {
+    }
+    /** Ignored */
+    public void targetStarted(BuildEvent event) {
+    }
+    /** Ignored */
+    public void targetFinished(BuildEvent event) {
+    }
+    /** Ignored */
+    public void taskStarted(BuildEvent event) {
+    }
+    /** Ignored */
+    public void taskFinished(BuildEvent event) {
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/TargetMonitor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/TargetMonitor.java
new file mode 100644
index 0000000..5d016d3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/TargetMonitor.java
@@ -0,0 +1,185 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules;
+import org.apache.tools.ant.gui.core.*;
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.acs.ACSElement;
+import org.apache.tools.ant.gui.acs.ACSTargetElement;
+import org.apache.tools.ant.gui.acs.ElementTreeSelectionModel;
+import javax.swing.*;
+import javax.swing.plaf.ComponentUI;
+import javax.swing.text.Document;
+import java.awt.BorderLayout;
+import java.awt.Insets;
+import java.awt.Dimension;
+import java.util.EventObject;
+
+/**
+ * A widget for displaying the currently selected targets.
+ * 
+ * @version $Revision: 1.3.2.1 $ 
+ * @author Simeon Fitch 
+ */
+public class TargetMonitor extends AntModule {
+        
+    /** Place to display selected targets. */
+    private JLabel _text = null;
+
+    /** Default text. */
+    private String _defText = null;
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public TargetMonitor() {
+    }
+
+    /** 
+     * Using the given AppContext, initialize the display.
+     * 
+     * @param context Application context.
+     */
+    public void contextualize(AppContext context) {
+        setContext(context);
+        context.getEventBus().addMember(EventBus.RESPONDING, new Handler());
+
+        setLayout(new BorderLayout());
+
+        _text = new JLabel();
+        _text.setForeground(UIManager.getColor("TextField.foreground"));
+        add(BorderLayout.NORTH, _text);
+
+
+        _defText = context.getResources().getString(getClass(), "defText");
+        setText(_defText);
+    }
+
+    /** 
+     * Set the displayed text. 
+     * 
+     * @param text Text to display.
+     */
+    private void setText(String text) {
+        _text.setText("<html>&nbsp;&nbsp;" + text + "</html>");
+    }
+
+
+    /** Class for handling project events. */
+    private class Handler implements BusMember {
+        private final Filter _filter = new Filter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            ElementSelectionEvent e = (ElementSelectionEvent) event;
+            String text = _defText;
+            ACSElement[] selected = e.getSelectedElements();
+
+            if(selected != null && selected.length > 0) {
+                StringBuffer buf = new StringBuffer();
+                String name = null;
+
+                for(int i = 0; i < selected.length; i++) {
+                    if(selected[i] instanceof ACSTargetElement) {
+                        name = ((ACSTargetElement)selected[i]).getName();
+                        if( buf.toString().indexOf( name ) < 0 ) {
+                            if(buf.length() > 0) {
+                                buf.append(", ");
+                            }
+                            buf.append( name );
+                        }
+                    }
+                }
+
+                if(buf.length() > 0) {
+                    text = buf.toString();
+                }
+            }
+
+            setText(text);
+
+            return true;
+        }
+    }
+
+    /** Class providing filtering for project events. */
+    private static class Filter implements BusFilter {
+        /** 
+         * Determines if the given event should be accepted.
+         * 
+         * @param event Event to test.
+         * @return True if event should be given to BusMember, false otherwise.
+         */
+        public boolean accept(EventObject event) {
+            return event instanceof ElementSelectionEvent;
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/BuildConsole.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/BuildConsole.java
new file mode 100644
index 0000000..6880395
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/BuildConsole.java
@@ -0,0 +1,336 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules.console;
+
+import org.apache.tools.ant.gui.core.AntModule;
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.*;
+import javax.swing.*;
+import javax.swing.plaf.ComponentUI;
+import javax.swing.text.*;
+import java.awt.BorderLayout;
+import java.awt.FlowLayout;
+import java.awt.Dimension;
+import java.awt.Color;
+import java.util.EventObject;
+import java.util.Date;
+
+/**
+ * Logging console display.
+ * 
+ * @version $Revision: 1.4.2.1 $ 
+ * @author Simeon Fitch 
+ */
+public class BuildConsole extends AntModule {
+    /** Area where messages are printed. */
+    private JTextPane _text = null;
+    /** Selection of logging levels. */
+    private JComboBox _logLevel = null;
+    /** Display styles. */
+    private ConsoleStyleContext _styles = null;
+	/** ClearLog Button. */
+	private JButton _clearLog = null;
+    
+	/** 
+	 * Default ctor.
+	 */
+    public BuildConsole() {
+    }
+
+
+	/** 
+	 * Using the given AppContext, initialize the display.
+	 * 
+	 * @param context Application context.
+	 */
+    public void contextualize(AppContext context) {
+        setContext(context);
+        context.getEventBus().addMember(EventBus.MONITORING, new Handler());
+        setLayout(new BorderLayout());
+
+        _styles = new ConsoleStyleContext();
+        _text = new JTextPane(_styles.getStyledDocument());
+        _text.setEditable(false);
+        JScrollPane scroller = new JScrollPane(_text);
+        scroller.setVerticalScrollBarPolicy(
+            JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
+        add(BorderLayout.CENTER, scroller);
+
+        JPanel controls = new JPanel(new FlowLayout(FlowLayout.LEFT));
+        JLabel label = new JLabel(
+            context.getResources().getString(getClass(), "logLevel"));
+        controls.add(label);
+        _logLevel = new JComboBox(LogLevelEnum.getValues());
+        _logLevel.setSelectedItem(LogLevelEnum.INFO);
+        controls.add(_logLevel);
+        
+        // Padding.
+        controls.add(Box.createHorizontalStrut(10));
+		_clearLog = new JButton(
+            context.getResources().getString(
+                getClass(), "clearLog"));
+		_clearLog.addActionListener(new ActionHandler());
+		controls.add(_clearLog);
+
+        add(BorderLayout.NORTH, controls);
+
+    }
+
+
+    /** 
+     * Clear the contents of the console.
+     * 
+     */
+    private void clearDisplay() {
+        Document doc = _text.getDocument();
+        try {
+            doc.remove(0, doc.getLength());
+        }
+        catch(Exception ex) {
+            // Intentionally ignored.
+        }
+    }
+
+    /** Class for handling project events. */
+    private class Handler implements BusMember {
+        private final Filter _filter = new Filter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            if(event instanceof ProjectSelectedEvent) {
+                return true;
+            }
+
+            AntBuildEvent buildEvent = (AntBuildEvent) event;
+            Style style = null;
+            String text = null;
+
+            switch(buildEvent.getType().getValue()) {
+              case BuildEventType.BUILD_STARTED_VAL:
+
+              case BuildEventType.BUILD_FINISHED_VAL:
+                  text = buildEvent.getType().toString() + 
+                      " (" + new Date().toString() + ")";
+                  style = _styles.getHeadingStyle();
+                  break;
+              case BuildEventType.TARGET_STARTED_VAL:
+                  text = buildEvent.getEvent().getTarget().getName() + ":";
+                  style = _styles.getSubheadingStyle();
+                  break;
+              case BuildEventType.TARGET_FINISHED_VAL:
+              case BuildEventType.TASK_STARTED_VAL:
+              case BuildEventType.TASK_FINISHED_VAL:
+                  break;
+              case BuildEventType.MESSAGE_LOGGED_VAL:
+                  // Filter out events that are below our
+                  // selected filterint level.
+                  LogLevelEnum level = 
+                      (LogLevelEnum) _logLevel.getSelectedItem();
+                  int priority = buildEvent.getEvent().getPriority();
+                  if(priority <= level.getValue()) {
+                      text = buildEvent.toString();
+                      style = _styles.getStyle(LogLevelEnum.fromInt(priority));
+                  }
+                  break;
+            }
+
+            if(text != null) {
+                try {
+                    Document doc = _text.getDocument();
+                    doc.insertString(doc.getLength(), text, style);
+                    doc.insertString(doc.getLength(), "\n", null);
+                }
+                catch(Exception ex) {
+                    // XXX log me.
+                    ex.printStackTrace();
+                }
+            }
+
+            return true;
+        }
+    }
+
+	/** Handles press of the ClearLog button. */
+	private class ActionHandler implements java.awt.event.ActionListener {
+		public void actionPerformed(java.awt.event.ActionEvent e) {
+			if (e.getSource() == _clearLog)	clearDisplay();
+		}
+	}
+
+    /** Class providing filtering for project events. */
+    private static class Filter implements BusFilter {
+        /** 
+         * Determines if the given event should be accepted.
+         * 
+         * @param event Event to test.
+         * @return True if event should be given to BusMember, false otherwise.
+         */
+        public boolean accept(EventObject event) {
+            return event instanceof AntBuildEvent ||
+                event instanceof ProjectSelectedEvent;
+        }
+    }
+
+    /** Style set for pretty display of the console messages. */
+    private static class ConsoleStyleContext extends StyleContext {
+        /** Name of the style used for headings. */
+        public static final String HEADING_STYLE = "headingStyle";
+        /** Name of the style used for subheadings. */
+        public static final String SUBHEADING_STYLE = "subheadingStyle";
+
+        /** XXX temporary list of style colors. To go away once a real set of
+         *  properties is implemented... */
+        private static final Color[] _colors = {
+            Color.red,
+            Color.magenta,
+            Color.black,
+            Color.darkGray,
+            Color.blue
+        };
+
+        /** 
+         * Default ctor.
+         * 
+         */
+        public ConsoleStyleContext() {
+            Style defaultStyle = getStyle(DEFAULT_STYLE);
+            StyleConstants.setFontSize(defaultStyle, 12);
+
+            Style msgBase = addStyle("msgBase", defaultStyle);
+            StyleConstants.setFontFamily(msgBase, "Monospaced");
+
+            LogLevelEnum[] levels = LogLevelEnum.getValues();
+            for(int i = 0; i < levels.length; i++) {
+                Style curr = addStyle(levels[i].toString(), msgBase);
+                StyleConstants.setFontSize(curr, 10);
+                StyleConstants.setForeground(curr, _colors[i]);
+            }
+
+            Style heading = addStyle(HEADING_STYLE, defaultStyle);
+            StyleConstants.setFontFamily(heading, "SansSerif");
+            StyleConstants.setBold(heading, true);
+            StyleConstants.setUnderline(heading, true);
+
+            Style subheading = addStyle(SUBHEADING_STYLE, heading);
+            StyleConstants.setFontSize(subheading, 10);
+            StyleConstants.setUnderline(subheading, false);
+        }
+
+        /** 
+         * Get the style to use for the given logging level.
+         * 
+         * @param level Logging level.
+         * @return Style to use for display.
+         */
+        Style getStyle(LogLevelEnum level) {
+            Style retval = getStyle(level.toString());
+            return retval == null ? getDefaultStyle() : retval;
+        }
+
+        /** 
+         * Get the default style.
+         * 
+         * @return Default style.
+         */
+        Style getDefaultStyle() {
+            return getStyle(DEFAULT_STYLE);
+        }
+
+        /** 
+         * Get the style to use for headings.
+         * 
+         * @return Heading style.
+         */
+        Style getHeadingStyle() {
+            return getStyle(HEADING_STYLE);
+        }
+
+        /** 
+         * Get the style to use for subheadings.
+         * 
+         * @return Subheading style.
+         */
+        Style getSubheadingStyle() {
+            return getStyle(SUBHEADING_STYLE);
+        }
+
+        /** 
+         * Get a StyledDocument initialized with this.
+         * 
+         * @return SytledDocument.
+         */
+        StyledDocument getStyledDocument() {
+            DefaultStyledDocument retval = new DefaultStyledDocument(this);
+            retval.setLogicalStyle(0, getDefaultStyle());
+            return retval;
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/LogLevelEnum.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/LogLevelEnum.java
new file mode 100644
index 0000000..4b8df46
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/console/LogLevelEnum.java
@@ -0,0 +1,163 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules.console;
+
+/**
+ * Enumeration class of the different log levels.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class LogLevelEnum {
+    /** Enum value. */
+    private int _value = 0;
+
+	/** 
+	 * Standard ctor.
+	 * 
+	 * @param value Index value.
+	 */
+    private LogLevelEnum(int value) {
+        _value = value;
+    }
+
+	/** 
+	 * Get the enumeration value.
+	 * 
+	 * @return 
+	 */
+    public int getValue() {
+        return _value;
+    }
+
+	/** 
+	 * Get the enumeration value with the given index value.
+	 * 
+	 * @param value Index value.
+	 * @return Enumeration value.
+	 */
+    public static LogLevelEnum fromInt(int value) {
+        return _objectMap[value];
+    }
+
+	/** 
+	 * Get the set of enumeration values.
+	 * 
+	 * @return Value set.
+	 */
+    public static LogLevelEnum[] getValues() {
+        return _objectMap;
+    }
+
+	/** 
+	 * Determine if the given object is logically equal to this one.
+	 * 
+	 * @param o Object to compare to 
+	 * @return True if equal, false otherwise.
+	 */
+    public boolean equals(Object o) {
+        if(o instanceof LogLevelEnum) {
+            return ((LogLevelEnum)o)._value == _value;
+        }
+        return false;
+    }
+	/** 
+	 * Generate a hash value.
+	 * 
+	 * @return Hash value.
+	 */
+    public int hashValue() {
+        return _value;
+    }
+
+	/** 
+	 * Provide a string representation of this. 
+	 * 
+	 * @return String representation.
+	 */
+    public String toString() {
+        return _stringMap[_value];
+    }
+
+
+    /* Index values. */ 
+    public static final int ERROR_VAL = 0;
+    public static final int WARNING_VAL = 1;
+    public static final int INFO_VAL = 2;
+    public static final int VERBOSE_VAL = 3;
+    public static final int DEBUG_VAL = 4;
+
+    /* Enumeration values. */ 
+    public static final LogLevelEnum ERROR = 
+      new LogLevelEnum(ERROR_VAL);
+    public static final LogLevelEnum WARNING = 
+      new LogLevelEnum(WARNING_VAL);
+    public static final LogLevelEnum INFO = 
+      new LogLevelEnum(INFO_VAL);
+    public static final LogLevelEnum VERBOSE = 
+      new LogLevelEnum(VERBOSE_VAL);
+    public static final LogLevelEnum DEBUG = 
+      new LogLevelEnum(DEBUG_VAL);
+
+    /** Index to object mapping. */
+    private static final LogLevelEnum[] _objectMap = {
+        ERROR, WARNING, INFO, VERBOSE, DEBUG
+    };
+
+    /** String map. XXX needs to be localized. */
+    private static final String[] _stringMap = {
+        "Error", "Warning", "Info", "Verbose", "Debug"
+    };
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementNavigator.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementNavigator.java
new file mode 100644
index 0000000..98c61c5
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementNavigator.java
@@ -0,0 +1,224 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules.edit;
+import org.apache.tools.ant.gui.core.*;
+import org.apache.tools.ant.gui.event.*;
+import org.apache.tools.ant.gui.acs.*;
+import javax.swing.*;
+import javax.swing.tree.*;
+import javax.swing.event.*;
+import java.awt.GridLayout;
+import java.awt.Dimension;
+import java.awt.event.MouseAdapter;
+import java.awt.event.MouseEvent;
+import java.util.EventObject;
+import java.beans.PropertyChangeEvent;
+
+/**
+ * Module for navigating build file elemenets.
+ * 
+ * @version $Revision: 1.5 $ 
+ * @author Simeon Fitch 
+ */
+public class ElementNavigator extends AntModule {
+
+    /** Navigation via a tree widget. */
+    private JTree _tree = null;
+    /** The selection model being used. */
+    private ElementTreeSelectionModel _selections = null;
+
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+	public ElementNavigator() {
+    }
+
+	/** 
+	 * Using the given AppContext, initialize the display.
+	 * 
+	 * @param context Application context.
+	 */
+    public void contextualize(AppContext context) {
+        setContext(context);
+        context.getEventBus().addMember(EventBus.MONITORING, new Handler());
+
+        setLayout(new GridLayout(1,1));
+
+        _tree = new JTree();
+        _tree.setModel(null);
+        _tree.setCellRenderer(new ElementTreeCellRenderer());
+        _tree.addMouseListener(new PopupHandler());
+        _tree.putClientProperty("JTree.lineStyle", "Angled");
+        _tree.setShowsRootHandles(true);
+        JScrollPane scroller = new JScrollPane(_tree);
+        add(scroller);
+
+        setPreferredSize(new Dimension(250, 100));
+        setMinimumSize(new Dimension(200, 100));
+
+	}
+
+    /** Class for handling project events. */
+    private class Handler implements BusMember {
+        private final Filter _filter = new Filter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+        
+        /** 
+         * Called when an event is to be posed to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean eventPosted(EventObject event) {
+            ElementTreeModel model = (ElementTreeModel)_tree.getModel();
+            // XXX This crap needs cleaning up. Type switching is lazy...
+            if(event instanceof PropertyChangeEvent) {
+                // The project node has changed.
+                model.fireNodeChanged((ACSElement)event.getSource());
+            }
+            else if(event instanceof NewElementEvent && model != null) {
+                ACSElement element = ((NewElementEvent)event).getNewElement();
+                model.fireNodeAdded(element);
+                TreePath path = new TreePath(model.getPathToRoot(element));
+                _selections.setSelectionPath(path);
+                _tree.scrollPathToVisible(path);
+            }
+            else {
+                ACSProjectElement project = null;
+                if(event instanceof ProjectSelectedEvent) {
+                    ProjectSelectedEvent e = (ProjectSelectedEvent) event;
+                    project = e.getSelectedProject();
+                }
+                
+                if(project == null) {
+                    // The project has been closed.
+                    // XXX this needs to be tested against 
+                    // different version of Swing...
+                    _tree.setModel(null);
+                    _tree.setSelectionModel(null);
+                    // Send an empty selection event to notify others that
+                    // nothing is selected.
+                    ElementSelectionEvent.createEvent(getContext(), null);
+                }
+                else {
+                    _tree.setModel(new ElementTreeModel(project));
+                    _selections = new ElementTreeSelectionModel();
+                    _selections.addTreeSelectionListener(
+                        new SelectionForwarder());
+                    _tree.setSelectionModel(_selections);
+                }
+            }
+            return true;
+        }
+    }
+
+    /** Forwards selection events to the event bus. */
+    private class SelectionForwarder implements TreeSelectionListener {
+        public void valueChanged(TreeSelectionEvent e) {
+            getContext().getEventBus().postEvent(
+                ElementSelectionEvent.createEvent(
+                    getContext(), _selections.getSelectedElements()));
+        }
+    }
+
+    /** Class providing filtering for project events. */
+    private static class Filter implements BusFilter {
+        /** 
+         * Determines if the given event should be accepted.
+         * 
+         * @param event Event to test.
+         * @return True if event should be given to BusMember, false otherwise.
+         */
+        public boolean accept(EventObject event) {
+            return event instanceof ProjectSelectedEvent ||
+                event instanceof ProjectClosedEvent ||
+                event instanceof NewElementEvent ||
+                event instanceof PropertyChangeEvent;
+        }
+    }
+
+    /** Mouse listener for showing popup menu. */
+    private class PopupHandler extends MouseAdapter {
+        private void handle(MouseEvent e) {
+            if(e.isPopupTrigger()) {
+                ActionManager mgr = getContext().getActions();
+                JPopupMenu menu = mgr.createPopup(
+                    getContext().getResources().getStringArray(
+                        ElementNavigator.class, "popupActions"));
+                menu.show((JComponent)e.getSource(), e.getX(), e.getY());
+            }
+        }
+
+        public void mousePressed(MouseEvent e) {
+            handle(e);
+        }
+        public void mouseReleased(MouseEvent e) {
+            handle(e);
+        }
+        public void mouseClicked(MouseEvent e) {
+            handle(e);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementTreeCellRenderer.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementTreeCellRenderer.java
new file mode 100644
index 0000000..c29ba79
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/ElementTreeCellRenderer.java
@@ -0,0 +1,101 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules.edit;
+
+import org.apache.tools.ant.gui.acs.ACSElement;
+import javax.swing.tree.DefaultTreeCellRenderer;
+import javax.swing.JTree;
+import javax.swing.ImageIcon;
+import java.awt.Component;
+import java.awt.Image;
+import java.beans.*;
+
+/**
+ * Cell renderer for displaying the Ant XML file in a JTree.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class ElementTreeCellRenderer extends DefaultTreeCellRenderer {
+
+    public Component getTreeCellRendererComponent(JTree tree,
+                                                  Object value,
+                                                  boolean sel,
+                                                  boolean expanded,
+                                                  boolean leaf,
+                                                  int row,
+                                                  boolean hasFocus) {
+        super.getTreeCellRendererComponent(tree, value, sel, expanded,
+                                           leaf, row, hasFocus);
+
+        try {
+            BeanInfo info = Introspector.getBeanInfo(value.getClass());
+            Image icon = info.getIcon(BeanInfo.ICON_COLOR_16x16);
+            setIcon(icon == null ? null : new ImageIcon(icon));
+
+            if(value instanceof ACSElement) {
+                setText(((ACSElement)value).getDisplayName());
+            }
+            else {
+               setText(info.getBeanDescriptor().getDisplayName());
+            }
+        }
+        catch(IntrospectionException ex) {
+            // XXX log me.
+            ex.printStackTrace();
+        }
+
+        return this;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/PropertyEditor.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/PropertyEditor.java
new file mode 100644
index 0000000..c34d01d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/modules/edit/PropertyEditor.java
@@ -0,0 +1,197 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.modules.edit;
+
+import org.apache.tools.ant.gui.customizer.DynamicCustomizer;
+import org.apache.tools.ant.gui.core.*;
+import org.apache.tools.ant.gui.acs.*;
+import org.apache.tools.ant.gui.event.*;
+import javax.swing.*;
+import java.util.*;
+import java.beans.*;
+import java.io.StringReader;
+import java.io.IOException;
+import java.awt.BorderLayout;
+import java.awt.Component;
+import java.awt.Point;
+
+/**
+ * Stub for a property editor.
+ *
+ * @version $Revision: 1.6 $ 
+ * @author Simeon H.K. Fitch 
+ */
+public class PropertyEditor extends AntModule {
+
+    /** The editor for current bean.*/
+    private Customizer _customizer = null;
+    /** Container for the customizer. */
+    private JPanel _container = null;
+    /** Scroll area containing contents. */
+    private JScrollPane _scroller = null;
+    /** Property change forwarder. */
+    private PropertyChangeForwarder _forwarder = new PropertyChangeForwarder();
+
+    /** 
+     * Default ctor.
+     * 
+     */
+    public PropertyEditor() {
+    }
+
+    /** 
+     * Using the given AppContext, initialize the display.
+     * 
+     * @param context Application context.
+     */
+    public void contextualize(AppContext context) {
+        setContext(context);
+        context.getEventBus().addMember(EventBus.MONITORING, new Handler());
+        setLayout(new BorderLayout());
+        _container = new JPanel(new BorderLayout());
+        add(_scroller = new JScrollPane(_container));
+    }
+
+    /** 
+     * Update the display for the current items. 
+     * 
+     * @param items Current items to display.
+     */
+    private void updateDisplay(ACSElement[] items) {
+        if(_customizer != null) {
+            _customizer.removePropertyChangeListener(_forwarder);
+            _container.remove((Component)_customizer);
+            _customizer = null;
+        }
+
+        if(items != null && items.length > 0) {
+            // The last selection element is the the one the
+            // user most recently selected.
+            ACSElement item = items[items.length - 1];
+
+            try {
+                BeanInfo info = Introspector.getBeanInfo(item.getClass());
+                _customizer = (Customizer) info.getBeanDescriptor().
+                    getCustomizerClass().newInstance();
+                _customizer.setObject(item);
+                _container.add(BorderLayout.CENTER, (Component) _customizer);
+                _customizer.addPropertyChangeListener(_forwarder);
+            }
+            catch(Exception ex) {
+                // XXX log me.
+                ex.printStackTrace();
+            }
+        }
+
+        _container.validate();
+        _container.repaint();
+    }
+
+
+    /** Class for handling project events. */
+    private class Handler implements BusMember {
+        private final Filter _filter = new Filter();
+
+        /** 
+         * Get the filter to that is used to determine if an event should
+         * to to the member.
+         * 
+         * @return Filter to use.
+         */
+        public BusFilter getBusFilter() {
+            return _filter;
+        }
+
+        /** 
+         * Called when an event is to be posted to the member.
+         * 
+         * @param event Event to post.
+         * @return true if event should be propogated, false if
+         * it should be cancelled.
+         */
+        public boolean  eventPosted(EventObject event) {
+            if(event instanceof ProjectClosedEvent) {
+                updateDisplay(null);
+            }
+            else {
+                ElementSelectionEvent e = (ElementSelectionEvent) event;
+                ACSElement[] elements = e.getSelectedElements();
+                updateDisplay(elements);
+            }
+            return true;
+        }
+
+    }
+    /** Class providing filtering for project events. */
+    private static class Filter implements BusFilter {
+        /** 
+         * Determines if the given event should be accepted.
+         * 
+         * @param event Event to test.
+         * @return True if event should be given to BusMember, false otherwise.
+         */
+        public boolean accept(EventObject event) {
+            return event instanceof ElementSelectionEvent || 
+                event instanceof ProjectClosedEvent;
+        }
+    }
+
+    /** Class for forwarding property change events to the event bus. */
+    private class PropertyChangeForwarder implements PropertyChangeListener {
+        public void propertyChange(PropertyChangeEvent e) {
+            getContext().getEventBus().postEvent(e);
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/action.properties b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/action.properties
new file mode 100644
index 0000000..8302340
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/action.properties
@@ -0,0 +1,151 @@
+# Define the primary menubar items.
+menus=File, Build, Projects, Help
+
+# Declare the list of known actions.
+actions=\
+    new, open, save, saveas, close, exit, about, \
+    newTarget, newTask, newProperty \
+    startBuild, stopBuild
+
+# Configure the decalred actions.
+new.name=New Project...
+new.shortDescription=Create a new project
+new.parentMenuName=File
+new.icon=new-project.gif
+new.accelerator=control N
+new.enabled=true
+new.command=org.apache.tools.ant.gui.command.NewProjectCmd
+
+open.name=Open...
+open.shortDescription=Open an existing project
+open.parentMenuName=File
+open.icon=open.gif
+open.accelerator=control O
+open.enabled=true
+open.command=org.apache.tools.ant.gui.command.OpenCmd
+
+save.name=Save
+save.shortDescription=Save the current project
+save.parentMenuName=File
+save.icon=save.gif
+save.accelerator=control S
+save.command=org.apache.tools.ant.gui.command.SaveCmd
+save.enabled=false
+save.disableOn= \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.BuildStartedEvent
+save.enableOn= \
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent, \
+    org.apache.tools.ant.gui.event.BuildFinishedEvent
+
+saveas.name=Save As...
+saveas.shortDescription=Save to a specific file
+saveas.parentMenuName=File
+saveas.command=org.apache.tools.ant.gui.command.SaveAsCmd
+saveas.enabled=false
+saveas.disableOn= \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.BuildStartedEvent
+saveas.enableOn= \
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent, \
+    org.apache.tools.ant.gui.event.BuildFinishedEvent
+
+close.name=Close
+close.shortDescription=Close the current project
+close.parentMenuName=File
+close.command=org.apache.tools.ant.gui.command.CloseCmd
+close.enabled=false
+close.disableOn= \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.BuildStartedEvent
+close.enableOn= \
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent, \
+    org.apache.tools.ant.gui.event.BuildFinishedEvent
+
+exit.name=Exit
+exit.shortDescription=Quit the application
+exit.parentMenuName=File
+exit.separator=true
+exit.command=org.apache.tools.ant.gui.command.ExitCmd
+exit.enabled=true
+
+about.name=About...
+about.shortDescription=About this application
+about.parentMenuName=Help
+about.separator=true;
+about.enabled=true
+about.command=org.apache.tools.ant.gui.command.AboutCmd
+
+startBuild.name=Start Build
+startBuild.shortDescription=Start build of selected target
+startBuild.parentMenuName=Build
+startBuild.icon=start.gif
+startBuild.separator=true
+startBuild.accelerator=control B
+startBuild.command=org.apache.tools.ant.gui.command.BuildCmd
+startBuild.enabled=false
+startBuild.enableOn=\
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent, \
+    org.apache.tools.ant.gui.event.BuildFinishedEvent
+startBuild.disableOn=\
+    org.apache.tools.ant.gui.event.BuildStartedEvent, \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent
+
+stopBuild.name=Stop Build
+stopBuild.shortDescription=Stop the current build
+stopBuild.parentMenuName=Build
+stopBuild.icon=stop.gif
+stopBuild.accelerator=control K
+stopBuild.enabled=false
+stopBuild.enableOn=\
+    org.apache.tools.ant.gui.event.BuildStartedEvent
+stopBuild.disableOn=\
+    org.apache.tools.ant.gui.event.BuildFinishedEvent
+
+newTarget.name=New Target
+newTarget.shortDescription=Create a new target
+newTarget.icon=new-target.gif
+newTarget.enabled=false
+newTarget.separator=true
+newTarget.command=org.apache.tools.ant.gui.command.NewTargetCmd
+newTarget.enableOn=\
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent
+newTarget.disableOn=\
+    org.apache.tools.ant.gui.event.TargetSelectionEvent, \
+    org.apache.tools.ant.gui.event.TaskSelectionEvent, \
+    org.apache.tools.ant.gui.event.PropertySelectionEvent, \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.NullSelectionEvent
+
+newTask.name=New Task
+newTask.shortDescription=Create a new task under the selected target
+newTask.icon=new-task.gif
+newTask.enabled=false
+newTask.command=org.apache.tools.ant.gui.command.NewTaskCmd
+newTask.enableOn=\
+    org.apache.tools.ant.gui.event.TargetSelectionEvent
+newTask.disableOn=\
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.TaskSelectionEvent, \
+    org.apache.tools.ant.gui.event.PropertySelectionEvent, \
+    org.apache.tools.ant.gui.event.NullSelectionEvent
+
+newProperty.name=New Property
+newProperty.shortDescription=Create a new property under the selected element
+newProperty.icon=new-property.gif
+newProperty.command=org.apache.tools.ant.gui.command.NewPropertyCmd
+newProperty.enabled=false
+newProperty.enableOn=\
+    org.apache.tools.ant.gui.event.ProjectSelectedEvent, \
+    org.apache.tools.ant.gui.event.NewProjectEvent, \
+    org.apache.tools.ant.gui.event.TargetSelectionEvent, \
+    org.apache.tools.ant.gui.event.TaskSelectionEvent
+newProperty.disableOn=\
+    org.apache.tools.ant.gui.event.PropertySelectionEvent, \
+    org.apache.tools.ant.gui.event.ProjectClosedEvent, \
+    org.apache.tools.ant.gui.event.NullSelectionEvent
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/antidote.properties b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/antidote.properties
new file mode 100644
index 0000000..60cc2f8
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/antidote.properties
@@ -0,0 +1,121 @@
+# This is the general properties file for the Antidote application.
+
+#debug=true
+
+# The following four module properties configure those properties that
+# should be initialized and displayed by default by the GUI. If more
+# than one module is configured for a property (as indicated providing
+# class names as a comma delimited list), then each module will appear
+# in its own tab in a JTabbedPane.
+
+# Configure the modules that appear on the right of the UI.
+org.apache.tools.ant.gui.Antidote.right.modules=\
+	org.apache.tools.ant.gui.modules.edit.PropertyEditor
+
+# Configure the modules that appear on the left of the UI.
+org.apache.tools.ant.gui.Antidote.left.modules=\
+	org.apache.tools.ant.gui.modules.edit.ElementNavigator
+
+# Configure the modules that appear on the bottom of the UI.
+org.apache.tools.ant.gui.Antidote.bottom.modules=\
+	org.apache.tools.ant.gui.modules.console.BuildConsole
+
+# Configure the modules that appear on the top of the UI.
+org.apache.tools.ant.gui.Antidote.top.modules=\
+	org.apache.tools.ant.gui.modules.TargetMonitor
+
+org.apache.tools.ant.gui.modules.edit.PropertyEditor.name=Properties
+
+org.apache.tools.ant.gui.modules.edit.ElementNavigator.name=Project
+org.apache.tools.ant.gui.modules.edit.ElementNavigator.popupActions=\
+    newTarget, newTask, newProperty
+
+org.apache.tools.ant.gui.modules.TargetMonitor.name=Selected Target(s)
+org.apache.tools.ant.gui.modules.TargetMonitor.defText=[none]
+
+org.apache.tools.ant.gui.modules.console.BuildConsole.name=Console
+org.apache.tools.ant.gui.modules.console.BuildConsole.clearLog=\
+    Clear Log
+org.apache.tools.ant.gui.modules.console.BuildConsole.logLevel=\
+    Log message level:
+
+org.apache.tools.ant.gui.core.XMLFileFilter.description=XML Files
+
+org.apache.tools.ant.gui.core.ProjectSelectionMenu.name=Projects
+
+org.apache.tools.ant.gui.command.LoadFileCmd.noFile=\
+    The file "{0}" was not found.
+org.apache.tools.ant.gui.command.LoadFileCmd.loadError=\
+    The file "{0}" could not be loaded.
+org.apache.tools.ant.gui.command.DisplayErrorCmd.title=Antidote Error...
+org.apache.tools.ant.gui.command.DisplayErrorCmd.expand=Details >>
+
+org.apache.tools.ant.gui.command.SaveCmd.saveError=Could not save to "{0}".
+org.apache.tools.ant.gui.command.SaveCmd.noProject=No project to save.
+org.apache.tools.ant.gui.command.SaveCmd.title=Overwrite?
+org.apache.tools.ant.gui.command.SaveCmd.overwrite=Overwrite file "{0}"?
+
+# Properties file for BeanInfo strings
+
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.beanName=Target
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.beanDescription=\
+    An executable target in the build.
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.name=Name
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.description=Description
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.depends=Dependencies
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.if=if Clause
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.unless=unless Clause
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.xmlString=XML Code
+org.apache.tools.ant.gui.acs.ACSTargetElementBeanInfo.icon=target.gif
+
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.beanName=Project
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.beanDescription=\
+    The top level project in the build definition.
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.name=Name
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.description=Description
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.basedir=Base Directory
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.default=Default Target
+org.apache.tools.ant.gui.acs.ACSProjectElementBeanInfo.icon=project.gif
+
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.beanName=Property
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.beanDescription=\
+    A scoped property
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.name=Name
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.value=Value
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.file=File
+org.apache.tools.ant.gui.acs.ACSPropertyElementBeanInfo.icon=property.gif
+
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.beanName=Task
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.beanDescription=\
+    A scoped property
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.taskType=Type
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.namedValues=Attributes
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.xmlString=XML Code
+org.apache.tools.ant.gui.acs.ACSTaskElementBeanInfo.icon=task.gif
+
+
+org.apache.tools.ant.gui.command.NewProjectCmd.defName=New Project
+org.apache.tools.ant.gui.command.NewTargetCmd.defName=New Target
+
+#----------------------------------------------------------------------------
+# About Description (NB: this is only a temporary approach).
+#----------------------------------------------------------------------------
+
+org.apache.tools.ant.gui.About.title=About
+org.apache.tools.ant.gui.About.ok=OK
+org.apache.tools.ant.gui.About.message=\
+	<html><h1>Antidote</h1> \
+	<p>Copyright &copy; 2000 The Apache Software Foundation. <br>\
+    All rights reserved.</p><br> \
+    <p>Visit http://jakarta.apache.org/ant for more information.</p><br> \
+    <table> \
+	<tr><td align="right"><b>Version</b>:</td><td>{0}</td></tr> \
+	<tr><td align="right"><b>Date</b>:</td><td>{1}</td></tr> \
+    </table> \
+	<hr> \
+    <p>Icons Copyright &copy; 1998 Dean S. Jones (deansjones@hotmail.com)<br> \
+    http://jfa.javalobby.org/projects/icons</p> \
+	</html>
+
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/args.properties b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/args.properties
new file mode 100644
index 0000000..15297f9
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/args.properties
@@ -0,0 +1,7 @@
+# Property file for the command-line strings used by the Args class.
+
+usage=usage: antidote [-help] [-wizzard] [-debug] [build-file]\n\
+\nReport bugs to http://jakarta.apache.org/site/bugs.html\n\
+Copyright (C) 2001 Apache Software Foundation. All rights reserved.
+
+invalidArg=Unrecognized argument: "{0}"
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/buildFileWizard.properties b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/buildFileWizard.properties
new file mode 100644
index 0000000..7d5842e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/buildFileWizard.properties
@@ -0,0 +1,88 @@
+# Property file for the wizard used to create a new build file.
+
+###########################################################
+# Define required properties for wizard.
+###########################################################
+next=Next >>
+back=<< Back
+cancel=Cancel
+finish=Finish
+progress=Progress
+help=Help
+
+###########################################################
+# Define the steps the comprise the wizard.
+###########################################################
+steps=start, type, setup, compile, jar, javadoc, finish
+
+###########################################################
+# Step: start
+###########################################################
+start.editor=org.apache.tools.ant.gui.wizard.InstructionStep
+start.title=Create new build file
+start.description=This wizard will step you through the process of creating \
+a basic Ant build file for your project.
+
+start.instructions=Welcome to the Ant build file wizard!\n\
+You will be asked a series of questions about the project you wish to create\
+and the types of build options you want included.\n\n\
+Click "Next >>" to proceed.
+
+###########################################################
+# Step: type
+###########################################################
+
+type.editor=org.apache.tools.ant.gui.wizard.build.ProjectTypeStep
+type.title=Select project type
+type.description=Select "New" if you want the buile environment \
+directory structure defined and created for you \
+in addition to the build file. Select "Import" if you want \
+a build file created for an existing project.
+
+type.isNewLabel=New project
+type.isImportLabel=Import existing project
+
+###########################################################
+# Step: setup
+###########################################################
+
+setup.editor=org.apache.tools.ant.gui.wizard.build.ProjectSetupStep
+setup.title=Setup project
+setup.description=Give the project a name, and select the features you \
+wish to be included in the project file, such as JavaDoc and JAR creation.
+setup.fileLabel=Build File:
+setup.nameLabel=Project Name:
+setup.optionsLabel=Options
+setup.compile.label=Compiled Java code (.class files)
+setup.jar.label=Executable JAR file
+setup.javadoc.label=JavaDoc
+
+###########################################################
+# Step: compile
+###########################################################
+compile.title=Setup Java source compilation
+compile.description=Need help?
+compile.editor=org.apache.tools.ant.gui.wizard.build.CompileStep
+
+###########################################################
+# Step: jar
+###########################################################
+jar.title=Setup executable JAR creation
+jar.description=Need help?
+jar.editor=org.apache.tools.ant.gui.wizard.build.JARStep
+
+###########################################################
+# Step: javadoc
+###########################################################
+javadoc.title=Setup JavaDoc creation
+javadoc.description=Need help?
+javadoc.editor=org.apache.tools.ant.gui.wizard.build.JavaDocStep
+
+###########################################################
+# Step: finish
+###########################################################
+finish.editor=org.apache.tools.ant.gui.wizard.build.FinishStep
+finish.title=Complete build file
+finish.description=Click "Finish" to save your build file definition.
+finish.instructions=You are done!\n\nClick "Finish" to complete your new\
+build file.
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/default.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/default.gif
new file mode 100644
index 0000000..46261fc
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/default.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/icon-small.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/icon-small.gif
new file mode 100644
index 0000000..72878f3
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/icon-small.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-project.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-project.gif
new file mode 100644
index 0000000..9fadc87
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-project.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-property.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-property.gif
new file mode 100644
index 0000000..6e82de7
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-property.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-target.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-target.gif
new file mode 100644
index 0000000..107fa6a
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-target.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-task.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-task.gif
new file mode 100644
index 0000000..4309cf3
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new-task.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new.gif
new file mode 100644
index 0000000..462ae4c
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/new.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/open.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/open.gif
new file mode 100644
index 0000000..3bd72be
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/open.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/project.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/project.gif
new file mode 100644
index 0000000..3a2bed6
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/project.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/property.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/property.gif
new file mode 100644
index 0000000..08058a8
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/property.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/save.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/save.gif
new file mode 100644
index 0000000..fc7fc05
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/save.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/start.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/start.gif
new file mode 100644
index 0000000..0728615
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/start.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/stop.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/stop.gif
new file mode 100644
index 0000000..063dc3c
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/stop.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/target.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/target.gif
new file mode 100644
index 0000000..3488dd3
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/target.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/task.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/task.gif
new file mode 100644
index 0000000..8c09186
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/task.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/unknown.gif b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/unknown.gif
new file mode 100644
index 0000000..cd94e5f
Binary files /dev/null and b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/resources/unknown.gif differ
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/ChangeLookAndFeel.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/ChangeLookAndFeel.java
new file mode 100644
index 0000000..1359622
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/ChangeLookAndFeel.java
@@ -0,0 +1,160 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.gui.util;
+
+import org.apache.tools.ant.gui.core.AppContext;
+import org.apache.tools.ant.gui.event.ErrorEvent;
+import org.apache.tools.ant.gui.util.WindowUtils;
+
+import javax.swing.*;
+import java.io.IOException;
+import java.util.*;
+import java.awt.*;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+
+/**
+ * Dialog for changing the current Look and Feel
+ *
+ * @version $Revision: 1.2 $
+ * @author Erik Meade
+ */
+public class ChangeLookAndFeel extends JDialog {
+
+	private AppContext _context;
+
+	private JList lookAndFeels;
+	/**
+	 * Standard ctor.
+	 *
+	 * @param context Application context.
+	 */
+	public ChangeLookAndFeel(AppContext context) {
+		super(context.getParentFrame(), true);
+		_context = context;
+		setDefaultCloseOperation(DISPOSE_ON_CLOSE);
+
+		setTitle(context.getResources().getString(
+			getClass(), "title"));
+
+		// Add the OK button.
+		JButton ok = new JButton(
+			context.getResources().getString(getClass(), "ok"));
+		ok.addActionListener(new ActionHandler());
+		JPanel p = new JPanel();
+		p.add(ok);
+		Container contentPane = getContentPane();
+        getRootPane().setDefaultButton(ok);
+        p.setPreferredSize(new Dimension(150, p.getPreferredSize().height));
+		contentPane.add(BorderLayout.SOUTH, p);
+
+		// Add the list of look and feels
+		p = new JPanel(new BorderLayout());
+        p.setBorder(BorderFactory.createTitledBorder(
+            context.getResources().getString(getClass(), "border")));
+
+		UIManager.LookAndFeelInfo[] lookAndFeelInfos = 
+            UIManager.getInstalledLookAndFeels();
+		String[] lookAndFeelNames = new String[lookAndFeelInfos.length];
+		for (int i = 0; i < lookAndFeelInfos.length; i++) {
+			lookAndFeelNames[i] = lookAndFeelInfos[i].getName();
+		}
+
+		lookAndFeels = new JList(lookAndFeelNames);
+		lookAndFeels.setSelectedValue(
+            UIManager.getLookAndFeel().getName(), true);
+		p.add(lookAndFeels);
+		contentPane.add(BorderLayout.CENTER, p);
+
+		// Just go ahead and show it...
+		pack();
+		WindowUtils.centerWindow(context.getParentFrame(), this);
+		setVisible(true);
+	}
+
+	/** Handles press of the OK button. */
+	private class ActionHandler implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			try {
+				UIManager.setLookAndFeel(getLookAndFeelClass(
+                    (String)lookAndFeels.getSelectedValue()));
+				SwingUtilities.updateComponentTreeUI(
+                    _context.getParentFrame());
+			} catch (Exception ex) {
+                _context.getEventBus().postEvent(
+                    new ErrorEvent(
+                        _context, _context.getResources().getString(
+                            ChangeLookAndFeel.class, "error") + ex));
+			}
+			WindowUtils.sendCloseEvent(ChangeLookAndFeel.this);
+		}
+	}
+
+	/** 
+	 * Get the Look and Feel class for the given name.
+	 * 
+	 * @param lookAndFeelName Name of the look and feel.
+	 * @return Class name to load.
+	 */
+	private String getLookAndFeelClass(String lookAndFeelName) {
+		UIManager.LookAndFeelInfo[] lookAndFeelInfos = 
+            UIManager.getInstalledLookAndFeels();
+		for (int i = 0; i < lookAndFeelInfos.length; i++) {
+			if (lookAndFeelInfos[i].getName().equals(lookAndFeelName))
+				return lookAndFeelInfos[i].getClassName();
+		}
+		return null;
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/LabelFieldGBC.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/LabelFieldGBC.java
new file mode 100644
index 0000000..f6fc320
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/LabelFieldGBC.java
@@ -0,0 +1,144 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.util;
+
+import java.awt.GridBagConstraints;
+import java.awt.Insets;
+import java.awt.Container;
+import javax.swing.JLabel;
+
+/**
+ * Convenience specialization of the GridBagConstraints for laying
+ * out label:field pairs.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class LabelFieldGBC extends GridBagConstraints {
+
+	/** 
+	 * Default ctor. Sets up the default settings.
+	 * 
+	 */
+	public LabelFieldGBC() {
+		// Add small abount of padding.
+		insets = new Insets(1,3,1,3);
+		// All vertical layout is relative
+		gridy = RELATIVE;
+		// Grid dimensions are equal (one label field pair per row).
+		gridheight = 1;
+		gridwidth = 1;
+	}
+
+	/** 
+	 * Set up constraint values for placing a label before a field.
+	 * 
+	 * @return Constraints for a label.
+	 */
+	public LabelFieldGBC forLabel() {
+		// Labels should only take up as much room as needed. 
+		fill = NONE;
+		// Set location to left side.
+		gridx = 0;
+		// Move it over to be as close to field as possible.
+		anchor = NORTHEAST;
+		// Don't take up any extra.
+		weightx = 0.0;
+		return this;
+	}
+
+	/** 
+	 * Provide the same setup as forLabel(), but allow it to expand vertically
+	 * to use up any extra space there may be.
+	 * 
+	 * @return Constraints for label that sucks up vertical space.
+	 */
+	public LabelFieldGBC forLastLabel() {
+		forLabel();
+		fill = VERTICAL;
+		weighty = 1.0;
+		return this;
+	}
+
+	/** 
+	 * Set up constraint values for placing a field after a label.
+	 * 
+	 * @return Constraints for a field.
+	 */
+	public LabelFieldGBC forField() {
+		// The field should take up as much space as is necessary.
+		fill = HORIZONTAL;
+		// Set the location to the right side.
+		gridx = 1;
+		// Center the field in the space available (a noop in this case).
+		anchor = CENTER;
+		// Take up any extra space.
+		weightx = 1.0;
+		return this;
+	}
+
+	/** 
+	 * Provide the same setup as forField(), but allow it to expand vertically
+	 *
+	 * 
+	 * @return Constraintes for field that sucks up vertical space.
+	 */
+	public LabelFieldGBC forLastField() {
+		forField();
+		fill = BOTH;
+		weighty = 1.0;
+		return this;
+	}
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/StackFrame.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/StackFrame.java
new file mode 100644
index 0000000..0bb11e8
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/StackFrame.java
@@ -0,0 +1,208 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.util;
+
+import java.io.StringWriter;
+import java.io.PrintWriter;
+import java.util.StringTokenizer;
+
+/*
+ * Class for parsing the stack frame information from a Throwable's stack frame
+ * dump. Probably only suitable for debugging, as it depends on the specific 
+ * output format of the stack dump, which could change with JVM releases.
+ *
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch
+ */
+public class StackFrame {
+	private String _method = null;
+	private int _line = -1;
+	private String _clazz = null;
+
+	/** 
+	 * Default ctor. Gets the stack frame info for the calling method.
+	 * 
+	 */
+	public StackFrame() {
+		this(1);
+	}
+
+    public StackFrame(int frame) {
+		if(frame < 0) {
+			throw new IllegalArgumentException("Frame number must be <= 0");
+		}
+		// Add a stack frame for this method and for 
+		// the fillInStackTrace method.
+		frame += 2;
+
+		Throwable t = new Throwable();
+		t.fillInStackTrace();
+		String text = toString(t);
+
+		// Extract the line that has the stack frame info we want on it.
+		StringTokenizer tok = new StringTokenizer(text, "\n");
+		// Ignore the first line as it just has the exception type on it.
+		tok.nextToken();
+		String hit = null;
+		while(tok.hasMoreTokens() && frame-- >= 0) {
+			hit = tok.nextToken();
+		}
+
+		// This should always pass. '4' is the number of characters to get
+		// to the start of the class name ("\tat ").
+		if(hit != null && hit.length() > 4) {
+			int idx = hit.indexOf('(');
+			if(idx > 4) {
+				String before = hit.substring(4, idx);
+				String after = hit.substring(idx + 1, hit.length() - 1);
+
+				// Extract the method name and class name.
+				idx = before.lastIndexOf('.');
+				if(idx >= 0) {
+					_clazz = before.substring(0, idx);
+					_method = before.substring(
+						idx + 1, before.length());
+				}
+				idx = after.lastIndexOf(':');
+				// Extract the line number. If it fails in any way
+				// then just leave the value at -1 which is a valid value.
+				try {
+					_line = Integer.parseInt(
+						after.substring(idx + 1, after.length()));
+				}
+				catch(Exception ex) {
+                    // Ignore.
+                }
+			}
+		}
+    }
+
+	/** 
+	 * Utility method for converting a throwable object to a string.
+	 * 
+	 * @param t Throwable to convert.
+	 * @return String representation.
+	 */
+	public static String toString(Throwable t) {
+		StringWriter writer = new StringWriter();
+		t.printStackTrace(new PrintWriter(writer));
+		return writer.toString();
+	}
+
+	/** 
+	 * Get the stack frame class.
+	 * 
+	 * @return 
+	 */
+	public String getClassName() {
+		return _clazz;
+	}
+
+	/** 
+	 * Get the name of the stack frame method 
+	 * 
+	 * @return 
+	 */
+	public String getMethodName() {
+		return _method;
+	}
+
+	/** 
+	 * Get the line number for the frame call.
+	 * 
+	 * @return Line number, or -1 if unknown.
+	 */
+	public int getLineNumber() {
+		return _line;
+	}
+
+	public String toString() {
+		return getClassName() + "." + getMethodName() + "(line " + 
+			(getLineNumber() >= 0 ? 
+			 String.valueOf(getLineNumber()) : "unknown") + ")";
+	}
+
+	/** 
+	 * Test code.
+	 * 
+	 * @param args Ignored.
+	 */
+/*
+	public static void main(String[] args) {
+		//Test class for generating a bunch of stack frames.
+		class Test {
+			public Test() {
+				System.out.println("Main method: " + new StackFrame(2));
+				recurse(20);
+			}
+
+			private void recurse(int val) {
+				if(val == 0) {
+					System.out.println("Recurse method: " + new StackFrame());
+				}
+				else if(val % 2 == 0) {
+					recurse(val - 1);
+				}
+				else {
+					recurse(val - 1);
+				}
+			}
+		}
+
+		new Test();
+	}
+*/
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/WindowUtils.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/WindowUtils.java
new file mode 100644
index 0000000..5510223
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/WindowUtils.java
@@ -0,0 +1,108 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.util;
+
+import java.awt.Window;
+import java.awt.Rectangle;
+import java.awt.Dimension;
+import java.awt.event.WindowEvent;
+
+/**
+ * Function container for various window operations.
+ * 
+ * @version $Revision: 1.3 $ 
+ * @author Simeon Fitch 
+ */
+public class WindowUtils {
+	/** 
+	 * Default ctor.
+	 * 
+	 */
+	private WindowUtils() {}
+
+	/** 
+	 * Send a close event to the given window.
+	 * 
+	 * @param window Window to send close event to.
+	 */
+	public static void sendCloseEvent(Window window) {
+        window.dispatchEvent(
+            new WindowEvent(window, WindowEvent.WINDOW_CLOSING));
+	}
+
+	/** 
+	 * Center the given child window with repsect to the parent window.
+	 * 
+	 * @param parent Window to base centering on.
+	 * @param child Window to center.
+	 */
+	public static void centerWindow(Window parent, Window child) {
+		Rectangle bounds = parent.getBounds();
+		Dimension size = child.getSize();
+		child.setLocation(bounds.x + (bounds.width - size.width)/2,
+						  bounds.y + (bounds.height - size.height)/2);
+	}
+
+	/** 
+	 * Center the given child window with repsect to the root.
+	 * 
+	 * @param child Window to center.
+	 */
+	public static void centerWindow(Window child) {
+        Dimension rsize = child.getToolkit().getScreenSize();
+        Dimension size = child.getSize();
+        child.setLocation((rsize.width - size.width)/2,
+                          (rsize.height - size.height)/2);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/XMLHelper.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/XMLHelper.java
new file mode 100644
index 0000000..3a70ff5
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/util/XMLHelper.java
@@ -0,0 +1,74 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.util;
+
+/**
+ * Placeholder for XML related duties.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class XMLHelper {
+    public static void init() {
+        try {
+            Class.forName("javax.xml.parsers.SAXParserFactory");
+        } 
+        catch(Exception ex) {
+            System.err.println("No JAXP compliant XML parser found. " +
+                               "See http://java.sun.com/xml for the\n" +
+                               "reference implementation.");
+            ex.printStackTrace();
+        } 
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/version.txt b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/version.txt
new file mode 100644
index 0000000..b6b2f8d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/version.txt
@@ -0,0 +1,2 @@
+VERSION=@VERSION@
+DATE=@DATE@
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/AbstractWizardStep.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/AbstractWizardStep.java
new file mode 100644
index 0000000..b2655ae
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/AbstractWizardStep.java
@@ -0,0 +1,230 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import org.apache.tools.ant.gui.core.ResourceManager;
+import javax.swing.JComponent;
+
+
+/**
+ * Abstract class implementing the basic support for the WizardStep interface.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public abstract class  AbstractWizardStep extends JComponent 
+    implements WizardStep {
+    
+    /** Flag to indicate whether or not init has been called. */
+    private boolean _initialized = false;
+    /** Resources. */
+    private ResourceManager _resources = null;
+    /** Step id. */
+    private String _id = null;
+    /** Step display title. */
+    private String _title = null;
+    /** Description of the step. */
+    private String _description = null;
+    /** Data model. */
+    private WizardData _model = null;
+
+    /** 
+     * Called when the instance should initialize its contents, e.g.
+     * create the widgets, etc. When this is called then all
+     * data values, including the ResourceManager, have been setup.
+     * 
+     */
+    protected abstract void init();
+
+    /** 
+     * Set the step's resources.
+     * 
+     */
+    public void setResources(ResourceManager resources) {
+        _resources = resources;
+    }
+
+    /** 
+     * Get the step's resources.
+     * 
+     * @return Resources.
+     */
+    protected ResourceManager getResources() {
+        return _resources;
+    }
+
+    /** 
+     * Set the step id. The id must be unique among steps within the wizard.
+     * 
+     * @param id Wizard id.
+     */
+    public void setID(String id) {
+        _id = id;
+    }
+
+    /** 
+     * Get the step id.
+     * 
+     * @return Step id.
+     */
+    public String getID() {
+        return _id;
+    }
+
+    /** 
+     * Set the step title.
+     * 
+     * @param title Step title.
+     */
+    public void setTitle(String title) {
+        _title = title;
+    }
+
+    /** 
+     * Get the step title.
+     * 
+     * @return Step title.
+     */
+    public String getTitle() {
+        return _title;
+    }
+
+    /** 
+     * Set the step description.
+     * 
+     * @param desc Step description.
+     */
+    public void setDescription(String desc) {
+        _description = desc;
+    }
+
+    /** 
+     * Get the step description.
+     * 
+     * @return Step description.
+     */
+    public String getDescription() {
+        return _description;
+    }
+
+
+    /** 
+     * Set the data model object that the step will edit. It is assumed 
+     * that all steps initialized within a single wizard agree on the
+     * data model type.
+     * 
+     * @param model Data model to edit.
+     */
+    public void setDataModel(WizardData model) {
+        _model = model;
+    }
+
+    /** 
+     * Get the data model that should be passeed on to the next step.
+     * 
+     * @return Current data model.
+     */
+    public WizardData getDataModel() {
+        return _model;
+    }
+
+    /** 
+     * Get the component that should be displayed to the user for
+     * editing the model. This component should <b>not</b> include the
+     * title and text display, which is handled by the wizard container.
+     * 
+     * @return Editing component.
+     */
+    public JComponent getEditorComponent() {
+        if(!_initialized) {
+            init();
+            _initialized = true;
+        }
+
+        return this;
+    }
+
+    /** 
+     * Get the id of the next step.
+     * 
+     * @return ID of next step.
+     */
+    public String getNext() {
+        return getDataModel().getStateMachine().getNext(
+            this, getDataModel());
+    }
+
+    /** 
+     * Get the id of the previous step.
+     * 
+     * @return Previous step.
+     */
+    public String getPrevious() {
+        return getDataModel().getStateMachine().getPrevious(
+            this, getDataModel());
+    }
+
+    /** 
+     * Get a string representation of this.
+     * 
+     * @return String representation.
+     */
+    public String toString() {
+        StringBuffer buf = new StringBuffer(getClass().getName());
+        buf.append("[id=");
+        buf.append(getID());
+        buf.append("]");
+        return buf.toString();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/ButtonNavigator.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/ButtonNavigator.java
new file mode 100644
index 0000000..2780aed
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/ButtonNavigator.java
@@ -0,0 +1,197 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import org.apache.tools.ant.gui.core.ResourceManager;
+import javax.swing.*;
+import java.awt.event.ActionListener;
+import java.awt.event.ActionEvent;
+import java.awt.FlowLayout;
+import java.util.*;
+
+class ButtonNavigator extends JComponent implements WizardNavigator {
+    public static final String NEXT = "next";
+    public static final String BACK = "back";
+    public static final String CANCEL = "cancel";
+    public static final String FINISH = "finish";
+
+    /** Resources. */
+    private ResourceManager _resources = null;
+    /** Event listeners. */
+    private List _listeners = new ArrayList();
+
+    /* Buttons. */
+    private JButton _next = null;
+    private JButton _back = null;
+    private JButton _cancel = null;
+    private JButton _finish = null;
+
+    /** Action handler. */
+    private ActionHandler _handler = new ActionHandler();
+
+    public ButtonNavigator(ResourceManager resources) {
+        _resources = resources;
+        setLayout(new FlowLayout(FlowLayout.RIGHT));
+        
+        _back = new JButton(_resources.getString(BACK));
+        _next = new JButton(_resources.getString(NEXT));
+        _finish = new JButton(_resources.getString(FINISH));
+        _cancel = new JButton(_resources.getString(CANCEL));
+
+        _back.setActionCommand(BACK);
+        _next.setActionCommand(NEXT);
+        _finish.setActionCommand(FINISH);
+        _cancel.setActionCommand(CANCEL);
+
+        _back.addActionListener(_handler);
+        _next.addActionListener(_handler);
+        _finish.addActionListener(_handler);
+        _cancel.addActionListener(_handler);
+
+        _back.setEnabled(false);
+        _next.setEnabled(false);
+        _finish.setEnabled(false);
+        _cancel.setEnabled(true);
+
+        add(_back);
+        add(_next);
+        add(_finish);
+        add(_cancel);
+    }
+
+    /** 
+     * Add a navigator listener. 
+     * 
+     * @param l Listener to add.
+     */
+    public void addNavigatorListener(NavigatorListener l) {
+        _listeners.add(l);
+    }
+
+    /** 
+     * Remove a navigator listener.
+     * 
+     * @param l Listener to remove.
+     */
+    public void removeNavigatorListener(NavigatorListener l) {
+        _listeners.remove(l);
+    }
+
+    /** 
+     * Set the enabled state of the back button.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    public void setBackEnabled(boolean state) {
+        _back.setEnabled(state);
+    }
+    /** 
+     * Set the enabled state of the next button.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    public void setNextEnabled(boolean state) {
+        _next.setEnabled(state);
+    }
+    /** 
+     * Set the enabled state of the finished button.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    public void setFinishEnabled(boolean state) {
+        _finish.setEnabled(state);
+    }
+
+    /** Handler of the button presses. */
+    private class ActionHandler implements ActionListener {
+        public void actionPerformed(ActionEvent e) {
+            Object source = e.getSource();
+
+            // Predetermine which method to call so that 
+            // we don't traverse if statements for each iteration.
+            int idx = -1;
+            if(source == _next) {
+                idx = 0;
+            }
+            else if(source == _back) {
+                idx = 1;
+            }
+            else if(source == _cancel) {
+                idx = 2;
+            }
+            else if(source == _finish) {
+                idx = 3;
+            }
+
+            Iterator it = _listeners.iterator();
+            while(it.hasNext()) {
+                NavigatorListener l = (NavigatorListener) it.next();
+                switch(idx) {
+                  case 0:
+                      l.nextStep();
+                      break;
+                  case 1:
+                      l.backStep();
+                      break;
+                  case 2:
+                      l.cancel();
+                      break;
+                  case 3:
+                      l.finish();
+                      break;
+                }
+
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/DefaultStateMachine.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/DefaultStateMachine.java
new file mode 100644
index 0000000..119b7bd
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/DefaultStateMachine.java
@@ -0,0 +1,108 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import org.apache.tools.ant.gui.core.ResourceManager;
+import java.util.*;
+
+/**
+ * A simple state machine based on the defined ordering of steps
+ * in the resources.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class DefaultStateMachine implements StateMachine {
+
+    /** 
+     * Get the list of step IDs defined in the resources as a list.
+     * 
+     * @param data Current wizard state.
+     * @return List of step IDs
+     */
+    protected List getStepList(WizardData data) {
+        return Arrays.asList(data.getResources().getStringArray("steps"));
+    }
+
+    /** 
+     * Get the next step.
+     * 
+     * @param curr The current step.
+     * @param data The current state of the wizard.
+     * @return The ID of next step, or null if there currently isn't one.
+     */
+    public String getNext(WizardStep curr, WizardData data) {
+        List steps = getStepList(data);
+        int nextIndex = steps.indexOf(curr.getID()) + 1;
+        if(nextIndex > 0 && nextIndex < steps.size()) {
+            return (String) steps.get(nextIndex);
+        }
+        return null;
+    }
+
+    /** 
+     * Get the previous step.
+     * 
+     * @param curr The current step.
+     * @param data The current state of the wizard.
+     * @return The ID of previous step, or null if there currently isn't one.
+     */
+    public String getPrevious(WizardStep curr, WizardData data) {
+        List steps = getStepList(data);
+        int nextIndex = steps.indexOf(curr.getID()) - 1;
+        if(nextIndex > 0 && nextIndex < steps.size()) {
+            return (String) steps.get(nextIndex);
+        }
+        return null;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/InstructionStep.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/InstructionStep.java
new file mode 100644
index 0000000..ad69804
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/InstructionStep.java
@@ -0,0 +1,102 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import javax.swing.*;
+import java.awt.BorderLayout;
+import java.awt.Font;
+import java.awt.Insets;
+
+/**
+ * Wizard step whose only purpose is to display some text.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public class InstructionStep extends AbstractWizardStep {
+
+    /** 
+     * Initialize the contents of the container.
+     * 
+     */
+    protected void init() {
+        setLayout(new BorderLayout());
+        String msg = getResources().getString(getID() + ".instructions");
+
+        JTextArea text = new JTextArea(msg);
+        text.setMargin(new Insets(30, 20, 5, 5));
+        text.setOpaque(false);
+        text.setFont(new Font("Serif", Font.PLAIN, 18));
+        text.setEditable(false);
+        text.setLineWrap(true);
+        text.setWrapStyleWord(true);
+        add(text);
+    }
+
+    /** 
+     * Called when the step should refresh its display based on the 
+     * current model setting.
+     * 
+     */
+    public void updateDisplay() {
+        // NOOP
+    }
+    /** 
+     * Called when the step should update the data model based on the
+     * settings of its widgets.
+     * 
+     */
+    public void updateDataModel() {
+        // NOOP
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/NavigatorListener.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/NavigatorListener.java
new file mode 100644
index 0000000..06ae423
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/NavigatorListener.java
@@ -0,0 +1,89 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+
+/**
+ * Interface for classes interested in events from the WizardNavigator.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public interface NavigatorListener {
+    /** 
+     * Called when the wizard should show the next step.
+     * 
+     */
+    void nextStep();
+    /** 
+     * Called when the wizard should show the previous step.
+     * 
+     */
+    void backStep();
+    /** 
+     * Called when the wizard should show the step with the given id.
+     * 
+     * @param stepID ID of step to show.
+     */
+    void gotoStep(String stepID);
+    /** 
+     * Called when the wizard activity shold be cancelled.
+     * 
+     */
+    void cancel();
+    /** 
+     * Called when the wizard is finished.
+     * 
+     */
+    void finish();
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/StateMachine.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/StateMachine.java
new file mode 100644
index 0000000..3b449be
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/StateMachine.java
@@ -0,0 +1,82 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+
+/**
+ * Interface for the wizard state machine, responsible for determining the
+ * next step in the wizard.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public interface StateMachine {
+
+    /** 
+     * Get the next step.
+     * 
+     * @param curr The current step.
+     * @param data The current state of the wizard.
+     * @return The next step, or null if there currently isn't one.
+     */
+    String getNext(WizardStep curr, WizardData data);
+
+    /** 
+     * Get the previous step.
+     * 
+     * @param curr The current step.
+     * @param data The current state of the wizard.
+     * @return The previous step, or null if there currently isn't one.
+     */
+    String getPrevious(WizardStep curr, WizardData data);
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/Wizard.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/Wizard.java
new file mode 100644
index 0000000..2f4edb9
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/Wizard.java
@@ -0,0 +1,261 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import org.apache.tools.ant.gui.core.ResourceManager;
+
+import javax.swing.*;
+import javax.swing.border.TitledBorder;
+import java.awt.BorderLayout;
+import java.awt.CardLayout;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.Insets;
+import java.util.*;
+
+/**
+ * Top level container and controller for wizard-type GUI.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public class Wizard extends JComponent {
+    /** The data model to pass on to each step. */
+    private WizardData _data = null;
+    /** Container for the step editors. */
+    private JPanel _stepContainer = null;
+    /** Layout manager for all the step panels. */
+    private CardLayout _layout = null;
+    /** Set initialized steps. */
+    private Map _steps = new HashMap();
+    /** Steps saved in a list to preserve ordering. */
+    private List _stepOrdering = new ArrayList();
+    /** Description text. XXX should probably change to some other widget. */
+    private JTextArea _description = null;
+    /** Progress meter. */
+    private JProgressBar _progress = null;
+    /** Widget for navigating through steps. */
+    private WizardNavigator _nav = null;
+    /** The current Wizard step. */
+    private WizardStep _curr = null;
+    /** The set of wizard listeners. */
+    private List _listeners = new ArrayList(1);
+
+    /** 
+     * Standard ctor.
+     * 
+     * @param data Data for the wizard.
+     */
+    public Wizard(WizardData data) {
+        setLayout(new BorderLayout());
+        _data = data;
+
+        _progress = new JProgressBar();
+        _progress.setBorder(BorderFactory.createTitledBorder(
+            _data.getResources().getString("progress")));
+        _progress.setStringPainted(true);
+        add(_progress, BorderLayout.NORTH);
+
+        _description = new JTextArea();
+        _description.setMargin(new Insets(5, 5, 5, 5));
+        _description.setPreferredSize(new Dimension(100, 100));
+        _description.setOpaque(true);
+        _description.setFont(new Font("Serif", Font.PLAIN, 12));
+        _description.setEditable(false);
+        _description.setLineWrap(true);
+        _description.setWrapStyleWord(true);
+
+        JScrollPane scroller = new JScrollPane(
+            _description, 
+            JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED, 
+            JScrollPane.HORIZONTAL_SCROLLBAR_NEVER); 
+
+        scroller.setBorder(BorderFactory.createTitledBorder(
+            _data.getResources().getString("help")));
+        add(scroller, BorderLayout.WEST);
+
+        _stepContainer = new JPanel(_layout = new CardLayout());
+        _stepContainer.setBorder(BorderFactory.createEtchedBorder());
+        _stepContainer.setPreferredSize(new Dimension(400, 400));
+
+
+        add(_stepContainer, BorderLayout.CENTER);
+
+        _nav = new ButtonNavigator(_data.getResources());
+        _nav.addNavigatorListener(new NavHandler());
+        ((ButtonNavigator)_nav).setBorder(BorderFactory.createEtchedBorder());
+        add((ButtonNavigator)_nav, BorderLayout.SOUTH);
+
+        String[] steps = _data.getResources().getStringArray("steps");
+        _progress.setMaximum(steps.length - 1);
+        try {
+            for(int i = 0; i < steps.length; i++) {
+                Class type = _data.getResources().getClass(steps[i] + ".editor");
+                WizardStep step = (WizardStep) type.newInstance();
+                step.setResources(_data.getResources());
+                step.setID(steps[i]);
+                step.setTitle(
+                    _data.getResources().getString(steps[i]+ ".title"));
+                step.setDescription(
+                    _data.getResources().getString(steps[i]+ ".description"));
+
+                _steps.put(steps[i], step);
+                _stepOrdering.add(step);
+                _stepContainer.add(step.getEditorComponent(), steps[i]);
+            }
+            // Initialize the first screen with the data model.
+            if(steps.length > 0) {
+                WizardStep first = (WizardStep)_steps.get(steps[0]);
+                first.setDataModel(_data);
+                _curr = first;
+                showStep(first);
+            }
+        }
+        catch(Exception ex) {
+            // If we get here then the wizard didn't initialize properly.
+            // XXX log me.
+            ex.printStackTrace();
+        }
+
+    }
+
+    /** 
+     * Add a wizard listener.
+     * 
+     * @param l Listener to add.
+     */
+    public void addWizardListener(WizardListener l) {
+        _listeners.add(l);
+    }
+
+    /** 
+     * Remove a wizard listener.
+     * 
+     * @param l Listener to remove.
+     */
+    public void removeWizardListener(WizardListener l) {
+        _listeners.remove(l);
+    }
+
+    /** 
+     * Go to the given step.
+     * 
+     * @param step Step to go to.
+     */
+    private void showStep(WizardStep step) {
+        if(step == null) return;
+
+        step.setDataModel(_curr.getDataModel());
+        
+        // Update the title and description.
+        _stepContainer.setBorder(
+            BorderFactory.createCompoundBorder(
+                BorderFactory.createTitledBorder(step.getTitle()),
+                BorderFactory.createEmptyBorder(5, 15, 5, 15))); 
+        _description.setText(step.getDescription());
+
+        _nav.setBackEnabled(step.getPrevious() != null);
+        _nav.setNextEnabled(step.getNext() != null);
+        _nav.setFinishEnabled(step.getNext() == null);
+        _progress.setValue(_stepOrdering.indexOf(step));
+
+        // Tell the step to refresh its display based on the data model.
+        step.updateDisplay();
+
+        // Display the step.
+        _layout.show(_stepContainer, step.getID());
+
+        _curr = step;
+    }
+
+    /** Handler for actions invoked by wizard. */
+    private class NavHandler implements NavigatorListener {
+        public void nextStep() {
+            // Called to give data model chance to make changes to what is next.
+            _curr.updateDataModel();
+            String nextID = _curr.getNext();
+            if(nextID != null) {
+                showStep((WizardStep)_steps.get(nextID));
+            }
+        }
+        public void backStep() {
+            // Called to give data model chance to make changes to what is 
+            // before.
+            _curr.updateDataModel();
+            String prevID = _curr.getPrevious();
+            if(prevID != null) {
+                showStep((WizardStep)_steps.get(prevID));
+            }
+        }
+        public void gotoStep(String stepID){
+            _curr.updateDataModel();
+            showStep((WizardStep) _steps.get(stepID));
+        }
+        public void cancel() {
+            _curr.updateDataModel();
+            Iterator it = _listeners.iterator();
+            while(it.hasNext()) {
+                WizardListener l = (WizardListener) it.next();
+                l.canceled();
+            }
+        }
+        public void finish() {
+            _curr.updateDataModel();
+            Iterator it = _listeners.iterator();
+            while(it.hasNext()) {
+                WizardListener l = (WizardListener) it.next();
+                l.finished(_curr.getDataModel());
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardData.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardData.java
new file mode 100644
index 0000000..9b5f9ba
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardData.java
@@ -0,0 +1,89 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+
+import org.apache.tools.ant.gui.core.ResourceManager;
+
+/**
+ * Interface for the wizard data model.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public interface WizardData {
+    /** 
+     * Get access to the resources for the wizard.
+     * 
+     * @return Wizard resources.
+     */
+    ResourceManager getResources();
+
+    /** 
+     * Get the class the determines what the next step should be.
+     * 
+     * @return State machine.
+     */
+    StateMachine getStateMachine();
+
+    
+    /** 
+     * Get any listeners to register with the wizard controller.
+     * 
+     * @return WizardListener instances to register for control events, or null
+     *  for none.
+     */
+    // XXX not sure about this yet.
+    //WizardListener[] getWizardListeners();
+
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardListener.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardListener.java
new file mode 100644
index 0000000..0d40884
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardListener.java
@@ -0,0 +1,77 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+
+
+/**
+ * Interface for classes desiring notifiction of when the user
+ * completes his/her use of wizard.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public interface WizardListener {
+    /** 
+     * Called when the user has clicked the finish button.
+     * 
+     * @param model Last state of the object model.
+     */
+    void finished(Object model);
+
+    /** 
+     * Called when the user has clicked the cancel button.
+     * 
+     */
+    void canceled();  
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardNavigator.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardNavigator.java
new file mode 100644
index 0000000..ee80e75
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardNavigator.java
@@ -0,0 +1,95 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+
+/**
+ * Interface for classes that control the movement from one step of a 
+ * wizard to another.
+ * 
+ * @version $Revision: 1.1 $ 
+ * @author Simeon Fitch 
+ */
+public interface WizardNavigator {
+    /** 
+     * Add a navigator listener. 
+     * 
+     * @param l Listener to add.
+     */
+    void addNavigatorListener(NavigatorListener l);
+    /** 
+     * Remove a navigator listener.
+     * 
+     * @param l Listener to remove.
+     */
+    void removeNavigatorListener(NavigatorListener l);
+
+    /** 
+     * Set the enabled state of the back control.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    void setBackEnabled(boolean state);
+    /** 
+     * Set the enabled state of the next control.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    void setNextEnabled(boolean state);
+    /** 
+     * Set the enabled state of the finished control.
+     * 
+     * @param state True for enabled, false for disabled.
+     */
+    void setFinishEnabled(boolean state);
+}
diff --git a/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardStep.java b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardStep.java
new file mode 100644
index 0000000..fe023a9
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/antidote/org/apache/tools/ant/gui/wizard/WizardStep.java
@@ -0,0 +1,165 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.gui.wizard;
+import org.apache.tools.ant.gui.core.ResourceManager;
+import javax.swing.JComponent;
+
+
+/**
+ * Interface for classes defining a step in a wizard.
+ * 
+ * @version $Revision: 1.2 $ 
+ * @author Simeon Fitch 
+ */
+public interface WizardStep {
+    /** 
+     * Set the step's resources.
+     * 
+     */
+    void setResources(ResourceManager resources);
+
+    /** 
+     * Set the step id. The id must be unique among steps within the wizard.
+     * 
+     * @param id Wizard id.
+     */
+    void setID(String id);
+
+    /** 
+     * Get the step id.
+     * 
+     * @return Step id.
+     */
+    String getID();
+
+    /** 
+     * Set the step title.
+     * 
+     * @param title Step title.
+     */
+    void setTitle(String title);
+    /** 
+     * Get the step title.
+     * 
+     * @return Step title.
+     */
+    String getTitle();
+
+    /** 
+     * Set the step description.
+     * 
+     * @param desc Step description.
+     */
+    void setDescription(String desc);
+    /** 
+     * Get the step description.
+     * 
+     * @return Step description.
+     */
+    String getDescription();
+
+    /** 
+     * Set the data model object that the step will edit. It is assumed 
+     * that all steps initialized within a single wizard agree on the
+     * data model type.
+     * 
+     * @param model Data model to edit.
+     */
+    void setDataModel(WizardData model);
+
+    /** 
+     * Get the data model that should be passeed on to the next step.
+     * 
+     * @return Current data model.
+     */
+    WizardData getDataModel();
+
+    /** 
+     * Get the component that should be displayed to the user for
+     * editing the model. This component should <b>not</b> include the
+     * title and text display, which is handled by the wizard container.
+     * 
+     * @return Editing component.
+     */
+    JComponent getEditorComponent();
+
+    /** 
+     * Called when the step should refresh its display based on the 
+     * current model setting.
+     * 
+     */
+    void updateDisplay();
+
+    /** 
+     * Called when the step should update the data model based on the
+     * settings of its widgets.
+     * 
+     */
+    void updateDataModel();
+
+    /** 
+     * Get the id of the next step.
+     * 
+     * @return ID of next step.
+     */
+    String getNext();
+
+    /** 
+     * Get the id of the previous step.
+     * 
+     * @return Previous step.
+     */
+    String getPrevious();
+
+}
diff --git a/jakarta-ant-1.2-src/src/bin/lcp.bat b/jakarta-ant-1.2-src/src/bin/lcp.bat
deleted file mode 100644
index 8feb0d0..0000000
--- a/jakarta-ant-1.2-src/src/bin/lcp.bat
+++ /dev/null
@@ -1,2 +0,0 @@
-set LOCALCLASSPATH=%LOCALCLASSPATH%;%1
-
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.inc b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.inc
new file mode 100644
index 0000000..3332925
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.inc
@@ -0,0 +1,3 @@
+<target name="test1">
+    <echo message="from included entity"/>
+</target>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.xml b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.xml
new file mode 100644
index 0000000..f5879f2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/include.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+
+<!DOCTYPE project [
+  <!ENTITY include SYSTEM "file:./include.inc">
+]>
+
+<project name="include-test" basedir="." default="test1">
+    &include;
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/relative.xml b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/relative.xml
new file mode 100644
index 0000000..bcdf7ee
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/basic/relative.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+
+<!DOCTYPE project [
+  <!ENTITY include SYSTEM "./include.inc">
+]>
+
+<project name="include-test" basedir="." default="test1">
+    &include;
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.inc b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.inc
new file mode 100644
index 0000000..3332925
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.inc
@@ -0,0 +1,3 @@
+<target name="test1">
+    <echo message="from included entity"/>
+</target>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.xml b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.xml
new file mode 100644
index 0000000..5dbeff6
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/include.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+
+<!DOCTYPE project [
+  <!ENTITY include SYSTEM "file:include.inc">
+]>
+
+<project name="include-test" basedir="." default="test1">
+    &include;
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/relative.xml b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/relative.xml
new file mode 100644
index 0000000..f71ed40
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/relative.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+
+<!DOCTYPE project [
+  <!ENTITY include SYSTEM "include.inc">
+]>
+
+<project name="include-test" basedir="." default="test1">
+    &include;
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/simple.xml b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/simple.xml
new file mode 100644
index 0000000..acdff54
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/core/include/frag#ment/simple.xml
@@ -0,0 +1,6 @@
+<?xml version="1.0"?>
+<project name="include-test" basedir="." default="test1">
+<target name="test1">
+    <echo message="from simple buildfile"/>
+</target>
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/ant.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/ant.xml
index ca96b4e..b8bf9ed 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/ant.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/ant.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="ant-test" basedir=".">
+<project name="ant-test" basedir="." default="test1">
 
   <target name="all" depends="test1,test2,test3,test4"/>
 
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/antstructure.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/antstructure.xml
index 61da256..8d49ad9 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/antstructure.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/antstructure.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="antstructure-test" basedir=".">
+<project name="antstructure-test" basedir="." default="test1">
 
   <target name="test1">
     <antstructure/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/available.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/available.xml
index 57dbc6f..9ad3bc5 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/available.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/available.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="available-test" basedir=".">
+<project name="available-test" basedir="." default="test1">
 
   <target name="test1">
     <available/>
@@ -26,12 +26,12 @@
 
   <target name="test6">
     <available property="test" 
-               resource="/org/apache/tools/ant/taskdefs/this_resource_does_not_exist"/>
+               resource="org/apache/tools/ant/taskdefs/this_resource_does_not_exist"/>
   </target>
 
   <target name="test7">
     <available property="test" 
-               resource="/org/apache/tools/ant/taskdefs/defaults.properties"/>
+               resource="org/apache/tools/ant/taskdefs/defaults.properties"/>
   </target>
 
   <target name="test8">
@@ -47,14 +47,14 @@
   <target name="test10">
     <available property="test" 
                file="available.xml"
-               resource="/org/apache/tools/ant/taskdefs/defaults.properties"
+               resource="org/apache/tools/ant/taskdefs/defaults.properties"
                classname="org.apache.tools.ant.taskdefs.Ant"/>
   </target>
   
   <target name="test11">
     <available property="test" 
                file="src/etc/testcases/taskdefs/available.xml"
-               resource="/org/apache/tools/ant/taskdefs/defaults.properties"
+               resource="org/apache/tools/ant/taskdefs/defaults.properties"
                classname="org.apache.tools.ant.taskdefs.this_class_does_not_exist"/>
   </target>  
   
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copy.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copy.xml
new file mode 100644
index 0000000..cd2469b
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copy.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+
+<project name="copy-test" basedir="." default="test1">
+
+  <target name="test1">
+    <copy file="copy.xml" todir="." overwrite="true"/>
+  </target>
+
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copydir.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copydir.xml
index 87128f2..10c5742 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copydir.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copydir.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="copydir-test" basedir=".">
+<project name="copydir-test" basedir="." default="test1">
 
   <target name="test1">
     <copydir/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copyfile.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copyfile.xml
index 60e6149..4aca33e 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copyfile.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/copyfile.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="copyfile-test" basedir=".">
+<project name="copyfile-test" basedir="." default="test1">
 
   <target name="test1">
     <copyfile/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/delete.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/delete.xml
index 06610dc..ea10eee 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/delete.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/delete.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="delete-test" basedir=".">
+<project name="delete-test" basedir="." default="test1">
 
   <target name="test1">
     <delete/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/deltree.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/deltree.xml
index 4a0c32d..23fc663 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/deltree.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/deltree.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="deltree-test" basedir=".">
+<project name="deltree-test" basedir="." default="test1">
 
   <target name="test1">
     <deltree/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/echo.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/echo.xml
index 147c37f..7898104 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/echo.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/echo.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="echo-test" basedir=".">
+<project name="echo-test" basedir="." default="test1">
 
   <target name="test1">
     <echo/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/fail.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/fail.xml
index 88ce615..3f8b815 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/fail.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/fail.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="fail-test" basedir=".">
+<project name="fail-test" basedir="." default="test1">
 
   <target name="test1">
     <fail/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/filter.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/filter.xml
index 5925e97..a41a843 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/filter.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/filter.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="filter-test" basedir=".">
+<project name="filter-test" basedir="." default="test1">
 
   <target name="test1">
     <filter/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/get.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/get.xml
index f10b644..025cb98 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/get.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/get.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <get/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gunzip.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gunzip.xml
index cc94c64..f4e7556 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gunzip.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gunzip.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <gunzip/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gzip.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gzip.xml
index da965e0..7fadfd6 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gzip.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/gzip.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <gzip/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/jar.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/jar.xml
new file mode 100644
index 0000000..064c1fe
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/jar.xml
@@ -0,0 +1,42 @@
+<?xml version="1.0"?>
+
+<project name="jar-test" basedir="." default="test1">
+
+  <target name="test1">
+    <jar/>
+  </target>
+
+  <target name="test2">
+    <jar
+    	jarfile="jar.tmp"
+    	manifest="none"
+    />
+  </target>
+
+  <target name="test3">
+    <jar
+    	jarfile="jar.tmp"
+	whenempty="format C: /y" 
+    />
+  </target>
+
+  <target name="test4">
+   <!-- delete the tmp.jar or the next test will fail -->
+   <delete file="tmp.jar"/>
+   <jar
+    	jarfile="tmp.jar"
+	basedir="."
+	includes="jar.xml"
+    />
+  </target>
+
+  <!-- This test is to make sure upToDate is working -->
+  <target name="test5">
+    <jar
+    	jarfile="tmp.jar"
+	basedir="."
+	includes="jar.xml"
+    />
+  </target>
+
+</project>
\ No newline at end of file
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/mkdir.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/mkdir.xml
index 6c14ab9..d0e168b 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/mkdir.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/mkdir.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <mkdir/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.g b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.g
new file mode 100644
index 0000000..641b968
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.g
@@ -0,0 +1,60 @@
+class CalcParser extends Parser;
+options {
+	buildAST = true;	// uses CommonAST by default
+}
+
+expr
+	:	mexpr (PLUS^ mexpr)* SEMI!
+	;
+
+mexpr
+	:	atom (STAR^ atom)*
+	;
+
+atom:	INT
+	;
+
+class CalcLexer extends Lexer;
+
+WS	:	(' '
+	|	'\t'
+	|	'\n'
+	|	'\r')
+		{ _ttype = Token.SKIP; }
+	;
+
+LPAREN:	'('
+	;
+
+RPAREN:	')'
+	;
+
+STAR:	'*'
+	;
+
+PLUS:	'+'
+	;
+
+SEMI:	';'
+	;
+
+protected
+DIGIT
+	:	'0'..'9'
+	;
+
+INT	:	(DIGIT)+
+	;
+
+class CalcTreeWalker extends TreeParser;
+
+expr returns [float r]
+{
+	float a,b;
+	r=0;
+}
+	:	#(PLUS a=expr b=expr)	{r = a+b;}
+	|	#(STAR a=expr b=expr)	{r = a*b;}
+	|	i:INT			{r = (float)Integer.parseInt(i.getText());}
+	;
+
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.xml
new file mode 100644
index 0000000..1dec35f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/antlr.xml
@@ -0,0 +1,51 @@
+<?xml version="1.0"?>
+
+<project name="antlr-test" basedir="." default="test1">
+
+  <property name="tmp.dir" value="antlr.tmp"/>
+
+
+  <target name="test1">
+    <antlr/>
+  </target>
+
+  <target name="test2">
+    <!-- delete the tmp directory, it may exists if a previous ANTLR test
+         failed.  This in turn will cause this test to fail, as it tests
+         the build exception when the outputdirectory is invalid. -->
+    <deltree dir="${tmp.dir}"/>
+    <antlr target="antlr.g" outputdirectory="${tmp.dir}"/>
+  </target>
+
+  <target name="test3">
+    <mkdir dir="${tmp.dir}"/>
+    <antlr target="antlr.g" outputdirectory="${tmp.dir}"/>
+  </target>
+
+  <target name="test4">
+    <deltree dir="${tmp.dir}"/>
+    <mkdir dir="${tmp.dir}"/>
+    <antlr target="java.g" outputdirectory="${tmp.dir}"/>
+    <antlr target="java.tree.g" outputdirectory="${tmp.dir}"/>
+  </target>
+
+  <target name="test5">
+    <antlr target="java.tree.g" outputdirectory="${tmp.dir}" fork="yes"/>
+  </target>
+
+  <target name="test6">
+    <deltree dir="${tmp.dir}"/>
+    <!-- This tmp.dir needs to be deleted by the build file which executes this test. -->
+    <mkdir dir="${tmp.dir}"/>
+    <antlr target="java.g" outputdirectory="${tmp.dir}" />
+    <antlr dir="${tmp.dir}"
+           target="java.tree.g"
+           outputdirectory="${tmp.dir}"
+           fork="yes"/>
+  </target>
+
+  <target name="test7">
+    <antlr target="antlr.xml"/>
+  </target>    
+
+</project>
\ No newline at end of file
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.g b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.g
new file mode 100644
index 0000000..4d664e2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.g
@@ -0,0 +1,1166 @@
+/** Java 1.2 Recognizer
+ *
+ * Run 'java Main <directory full of java files>'
+ *
+ * Contributing authors:
+ *		John Mitchell		johnm@non.net
+ *		Terence Parr		parrt@magelang.com
+ *		John Lilley			jlilley@empathy.com
+ *		Scott Stanchfield	thetick@magelang.com
+ *		Markus Mohnen       mohnen@informatik.rwth-aachen.de
+ *		Peter Williams		pwilliams@netdynamics.com
+ *
+ * Version 1.00 December 9, 1997 -- initial release
+ * Version 1.01 December 10, 1997
+ *		fixed bug in octal def (0..7 not 0..8)
+ * Version 1.10 August 1998 (parrt)
+ *		added tree construction
+ *		fixed definition of WS,comments for mac,pc,unix newlines
+ *		added unary plus
+ * Version 1.11 (Nov 20, 1998)
+ *		Added "shutup" option to turn off last ambig warning.
+ *		Fixed inner class def to allow named class defs as statements
+ *		synchronized requires compound not simple statement
+ *		add [] after builtInType DOT class in primaryExpression
+ *		"const" is reserved but not valid..removed from modifiers
+ * Version 1.12 (Feb 2, 1999)
+ *		Changed LITERAL_xxx to xxx in tree grammar.
+ *		Updated java.g to use tokens {...} now for 2.6.0 (new feature).
+ *
+ * Version 1.13 (Apr 23, 1999)
+ *		Didn't have (stat)? for else clause in tree parser.
+ *		Didn't gen ASTs for interface extends.  Updated tree parser too.
+ *		Updated to 2.6.0.
+ * Version 1.14 (Jun 20, 1999)
+ *		Allowed final/abstract on local classes.
+ *		Removed local interfaces from methods
+ *		Put instanceof precedence where it belongs...in relationalExpr
+ *			It also had expr not type as arg; fixed it.
+ *		Missing ! on SEMI in classBlock
+ *		fixed: (expr) + "string" was parsed incorrectly (+ as unary plus).
+ *		fixed: didn't like Object[].class in parser or tree parser
+ * Version 1.15 (Jun 26, 1999)
+ *		Screwed up rule with instanceof in it. :(  Fixed.
+ *		Tree parser didn't like (expr).something; fixed.
+ *		Allowed multiple inheritance in tree grammar. oops.
+ * Version 1.16 (August 22, 1999)
+ *		Extending an interface built a wacky tree: had extra EXTENDS.
+ *		Tree grammar didn't allow multiple superinterfaces.
+ *		Tree grammar didn't allow empty var initializer: {}
+ * Version 1.17 (October 12, 1999)
+ *		ESC lexer rule allowed 399 max not 377 max.
+ *		java.tree.g didn't handle the expression of synchronized
+ *			statements.
+ *
+ * Version tracking now done with following ID:
+ *
+ * $Id: java.g,v 1.1 2000/11/06 12:35:13 bodewig Exp $
+ *
+ * BUG:
+ * 		Doesn't like boolean.class!
+ *
+ * class Test {
+ *   public static void main( String args[] ) {
+ *     if (boolean.class.equals(boolean.class)) {
+ *       System.out.println("works");
+ *     }
+ *   }
+ * }
+ *
+ * This grammar is in the PUBLIC DOMAIN
+ */
+class JavaRecognizer extends Parser;
+options {
+	k = 2;                           // two token lookahead
+	exportVocab=Java;                // Call its vocabulary "Java"
+	codeGenMakeSwitchThreshold = 2;  // Some optimizations
+	codeGenBitsetTestThreshold = 3;
+	defaultErrorHandler = false;     // Don't generate parser error handlers
+	buildAST = true;
+}
+
+tokens {
+	BLOCK; MODIFIERS; OBJBLOCK; SLIST; CTOR_DEF; METHOD_DEF; VARIABLE_DEF; 
+	INSTANCE_INIT; STATIC_INIT; TYPE; CLASS_DEF; INTERFACE_DEF; 
+	PACKAGE_DEF; ARRAY_DECLARATOR; EXTENDS_CLAUSE; IMPLEMENTS_CLAUSE;
+	PARAMETERS; PARAMETER_DEF; LABELED_STAT; TYPECAST; INDEX_OP; 
+	POST_INC; POST_DEC; METHOD_CALL; EXPR; ARRAY_INIT; 
+	IMPORT; UNARY_MINUS; UNARY_PLUS; CASE_GROUP; ELIST; FOR_INIT; FOR_CONDITION; 
+	FOR_ITERATOR; EMPTY_STAT; FINAL="final"; ABSTRACT="abstract";
+}
+	
+// Compilation Unit: In Java, this is a single file.  This is the start
+//   rule for this parser
+compilationUnit
+	:	// A compilation unit starts with an optional package definition
+		(	packageDefinition
+		|	/* nothing */
+		)
+
+		// Next we have a series of zero or more import statements
+		( importDefinition )*
+
+		// Wrapping things up with any number of class or interface
+		//    definitions
+		( typeDefinition )*
+
+		EOF!
+	;
+
+
+// Package statement: "package" followed by an identifier.
+packageDefinition
+	options {defaultErrorHandler = true;} // let ANTLR handle errors
+	:	p:"package"^ {#p.setType(PACKAGE_DEF);} identifier SEMI!
+	;
+
+
+// Import statement: import followed by a package or class name
+importDefinition
+	options {defaultErrorHandler = true;}
+	:	i:"import"^ {#i.setType(IMPORT);} identifierStar SEMI!
+	;
+
+// A type definition in a file is either a class or interface definition.
+typeDefinition
+	options {defaultErrorHandler = true;}
+	:	m:modifiers!
+		( classDefinition[#m]
+		| interfaceDefinition[#m]
+		)
+	|	SEMI!
+	;
+
+/** A declaration is the creation of a reference or primitive-type variable
+ *  Create a separate Type/Var tree for each var in the var list.
+ */
+declaration!
+	:	m:modifiers t:typeSpec[false] v:variableDefinitions[#m,#t]
+		{#declaration = #v;}
+	;
+
+// A list of zero or more modifiers.  We could have used (modifier)* in
+//   place of a call to modifiers, but I thought it was a good idea to keep
+//   this rule separate so they can easily be collected in a Vector if
+//   someone so desires
+modifiers
+	:	( modifier )*
+		{#modifiers = #([MODIFIERS, "MODIFIERS"], #modifiers);}
+	;
+
+
+// A type specification is a type name with possible brackets afterwards
+//   (which would make it an array type).
+typeSpec[boolean addImagNode]
+	: classTypeSpec[addImagNode]
+	| builtInTypeSpec[addImagNode]
+	;
+
+// A class type specification is a class type with possible brackets afterwards
+//   (which would make it an array type).
+classTypeSpec[boolean addImagNode]
+	:	identifier (lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);} RBRACK!)*
+		{
+			if ( addImagNode ) {
+				#classTypeSpec = #(#[TYPE,"TYPE"], #classTypeSpec);
+			}
+		}
+	;
+
+// A builtin type specification is a builtin type with possible brackets
+// afterwards (which would make it an array type).
+builtInTypeSpec[boolean addImagNode]
+	:	builtInType (lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);} RBRACK!)*
+		{
+			if ( addImagNode ) {
+				#builtInTypeSpec = #(#[TYPE,"TYPE"], #builtInTypeSpec);
+			}
+		}
+	;
+
+// A type name. which is either a (possibly qualified) class name or
+//   a primitive (builtin) type
+type
+	:	identifier
+	|	builtInType
+	;
+
+// The primitive types.
+builtInType
+	:	"void"
+	|	"boolean"
+	|	"byte"
+	|	"char"
+	|	"short"
+	|	"int"
+	|	"float"
+	|	"long"
+	|	"double"
+	;
+
+// A (possibly-qualified) java identifier.  We start with the first IDENT
+//   and expand its name by adding dots and following IDENTS
+identifier
+	:	IDENT  ( DOT^ IDENT )*
+	;
+
+identifierStar
+	:	IDENT
+		( DOT^ IDENT )*
+		( DOT^ STAR  )?
+	;
+
+
+// modifiers for Java classes, interfaces, class/instance vars and methods
+modifier
+	:	"private"
+	|	"public"
+	|	"protected"
+	|	"static"
+	|	"transient"
+	|	"final"
+	|	"abstract"
+	|	"native"
+	|	"threadsafe"
+	|	"synchronized"
+//	|	"const"			// reserved word; leave out
+	|	"volatile"
+	;
+
+
+// Definition of a Java class
+classDefinition![AST modifiers]
+	:	"class" IDENT
+		// it _might_ have a superclass...
+		sc:superClassClause
+		// it might implement some interfaces...
+		ic:implementsClause
+		// now parse the body of the class
+		cb:classBlock
+		{#classDefinition = #(#[CLASS_DEF,"CLASS_DEF"],
+							   modifiers,IDENT,sc,ic,cb);}
+	;
+
+superClassClause!
+	:	( "extends" id:identifier )?
+		{#superClassClause = #(#[EXTENDS_CLAUSE,"EXTENDS_CLAUSE"],id);}
+	;
+
+// Definition of a Java Interface
+interfaceDefinition![AST modifiers]
+	:	"interface" IDENT
+		// it might extend some other interfaces
+		ie:interfaceExtends
+		// now parse the body of the interface (looks like a class...)
+		cb:classBlock
+		{#interfaceDefinition = #(#[INTERFACE_DEF,"INTERFACE_DEF"],
+									modifiers,IDENT,ie,cb);}
+	;
+
+
+// This is the body of a class.  You can have fields and extra semicolons,
+// That's about it (until you see what a field is...)
+classBlock
+	:	LCURLY!
+			( field | SEMI! )*
+		RCURLY!
+		{#classBlock = #([OBJBLOCK, "OBJBLOCK"], #classBlock);}
+	;
+
+// An interface can extend several other interfaces...
+interfaceExtends
+	:	(
+		e:"extends"!
+		identifier ( COMMA! identifier )*
+		)?
+		{#interfaceExtends = #(#[EXTENDS_CLAUSE,"EXTENDS_CLAUSE"],
+							#interfaceExtends);}
+	;
+
+// A class can implement several interfaces...
+implementsClause
+	:	(
+			i:"implements"! identifier ( COMMA! identifier )*
+		)?
+		{#implementsClause = #(#[IMPLEMENTS_CLAUSE,"IMPLEMENTS_CLAUSE"],
+								 #implementsClause);}
+	;
+
+// Now the various things that can be defined inside a class or interface...
+// Note that not all of these are really valid in an interface (constructors,
+//   for example), and if this grammar were used for a compiler there would
+//   need to be some semantic checks to make sure we're doing the right thing...
+field!
+	:	// method, constructor, or variable declaration
+		mods:modifiers
+		(	h:ctorHead s:compoundStatement // constructor
+			{#field = #(#[CTOR_DEF,"CTOR_DEF"], mods, h, s);}
+
+		|	cd:classDefinition[#mods]       // inner class
+			{#field = #cd;}
+			
+		|	id:interfaceDefinition[#mods]   // inner interface
+			{#field = #id;}
+
+		|	t:typeSpec[false]  // method or variable declaration(s)
+			(	IDENT  // the name of the method
+
+				// parse the formal parameter declarations.
+				LPAREN! param:parameterDeclarationList RPAREN!
+
+				rt:returnTypeBrackersOnEndOfMethodHead[#t]
+
+				// get the list of exceptions that this method is declared to throw
+				(tc:throwsClause)?
+
+				( s2:compoundStatement | SEMI )
+				{#field = #(#[METHOD_DEF,"METHOD_DEF"],
+						     mods,
+							 #(#[TYPE,"TYPE"],rt),
+							 IDENT,
+							 param,
+							 tc,
+							 s2);}
+			|	v:variableDefinitions[#mods,#t] SEMI
+//				{#field = #(#[VARIABLE_DEF,"VARIABLE_DEF"], v);}
+				{#field = #v;}
+			)
+		)
+
+    // "static { ... }" class initializer
+	|	"static" s3:compoundStatement
+		{#field = #(#[STATIC_INIT,"STATIC_INIT"], s3);}
+
+    // "{ ... }" instance initializer
+	|	s4:compoundStatement
+		{#field = #(#[INSTANCE_INIT,"INSTANCE_INIT"], s4);}
+	;
+
+variableDefinitions[AST mods, AST t]
+	:	variableDeclarator[getASTFactory().dupTree(mods),
+						   getASTFactory().dupTree(t)]
+		(	COMMA!
+			variableDeclarator[getASTFactory().dupTree(mods),
+							   getASTFactory().dupTree(t)]
+		)*
+	;
+
+/** Declaration of a variable.  This can be a class/instance variable,
+ *   or a local variable in a method
+ * It can also include possible initialization.
+ */
+variableDeclarator![AST mods, AST t]
+	:	id:IDENT d:declaratorBrackets[t] v:varInitializer
+		{#variableDeclarator = #(#[VARIABLE_DEF,"VARIABLE_DEF"], mods, #(#[TYPE,"TYPE"],d), id, v);}
+	;
+
+declaratorBrackets[AST typ]
+	:	{#declaratorBrackets=typ;}
+		(lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);} RBRACK!)*
+	;
+
+varInitializer
+	:	( ASSIGN^ initializer )?
+	;
+
+// This is an initializer used to set up an array.
+arrayInitializer
+	:	lc:LCURLY^ {#lc.setType(ARRAY_INIT);}
+			(	initializer
+				(
+					// CONFLICT: does a COMMA after an initializer start a new
+					//           initializer or start the option ',' at end?
+					//           ANTLR generates proper code by matching
+					//			 the comma as soon as possible.
+					options {
+						warnWhenFollowAmbig = false;
+					}
+				:
+					COMMA! initializer
+				)*
+				(COMMA!)?
+			)?
+		RCURLY!
+	;
+
+
+// The two "things" that can initialize an array element are an expression
+//   and another (nested) array initializer.
+initializer
+	:	expression
+	|	arrayInitializer
+	;
+
+// This is the header of a method.  It includes the name and parameters
+//   for the method.
+//   This also watches for a list of exception classes in a "throws" clause.
+ctorHead
+	:	IDENT  // the name of the method
+
+		// parse the formal parameter declarations.
+		LPAREN! parameterDeclarationList RPAREN!
+
+		// get the list of exceptions that this method is declared to throw
+		(throwsClause)?
+	;
+
+// This is a list of exception classes that the method is declared to throw
+throwsClause
+	:	"throws"^ identifier ( COMMA! identifier )*
+	;
+
+
+returnTypeBrackersOnEndOfMethodHead[AST typ]
+	:	{#returnTypeBrackersOnEndOfMethodHead = typ;}
+		(lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);} RBRACK!)*
+	;
+
+// A list of formal parameters
+parameterDeclarationList
+	:	( parameterDeclaration ( COMMA! parameterDeclaration )* )?
+		{#parameterDeclarationList = #(#[PARAMETERS,"PARAMETERS"],
+									#parameterDeclarationList);}
+	;
+
+// A formal parameter.
+parameterDeclaration!
+	:	pm:parameterModifier t:typeSpec[false] id:IDENT
+		pd:parameterDeclaratorBrackets[#t]
+		{#parameterDeclaration = #(#[PARAMETER_DEF,"PARAMETER_DEF"],
+									pm, #([TYPE,"TYPE"],pd), id);}
+	;
+
+parameterDeclaratorBrackets[AST t]
+	:	{#parameterDeclaratorBrackets = t;}
+		(lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);} RBRACK!)*
+	;
+
+parameterModifier
+	:	(f:"final")?
+		{#parameterModifier = #(#[MODIFIERS,"MODIFIERS"], f);}
+	;
+
+// Compound statement.  This is used in many contexts:
+//   Inside a class definition prefixed with "static":
+//      it is a class initializer
+//   Inside a class definition without "static":
+//      it is an instance initializer
+//   As the body of a method
+//   As a completely indepdent braced block of code inside a method
+//      it starts a new scope for variable definitions
+
+compoundStatement
+	:	lc:LCURLY^ {#lc.setType(SLIST);}
+			// include the (possibly-empty) list of statements
+			(statement)*
+		RCURLY!
+	;
+
+
+statement
+	// A list of statements in curly braces -- start a new scope!
+	:	compoundStatement
+
+	// class definition
+	|	classDefinition[#[MODIFIERS, "MODIFIERS"]]
+
+	// final class definition
+	|	"final"! classDefinition[#(#[MODIFIERS, "MODIFIERS"],#[FINAL,"final"])]
+
+	// abstract class definition
+	|	"abstract"! classDefinition[#(#[MODIFIERS, "MODIFIERS"],#[ABSTRACT,"abstract"])]
+
+	// declarations are ambiguous with "ID DOT" relative to expression
+	// statements.  Must backtrack to be sure.  Could use a semantic
+	// predicate to test symbol table to see what the type was coming
+	// up, but that's pretty hard without a symbol table ;)
+	|	(declaration)=> declaration SEMI!
+
+	// An expression statement.  This could be a method call,
+	// assignment statement, or any other expression evaluated for
+	// side-effects.
+	|	expression SEMI!
+
+	// Attach a label to the front of a statement
+	|	IDENT c:COLON^ {#c.setType(LABELED_STAT);} statement
+
+	// If-else statement
+	|	"if"^ LPAREN! expression RPAREN! statement
+		(
+			// CONFLICT: the old "dangling-else" problem...
+			//           ANTLR generates proper code matching
+			//			 as soon as possible.  Hush warning.
+			options {
+				warnWhenFollowAmbig = false;
+			}
+		:
+			"else"! statement
+		)?
+
+	// For statement
+	|	"for"^
+			LPAREN!
+				forInit SEMI!   // initializer
+				forCond	SEMI!   // condition test
+				forIter         // updater
+			RPAREN!
+			statement                     // statement to loop over
+
+	// While statement
+	|	"while"^ LPAREN! expression RPAREN! statement
+
+	// do-while statement
+	|	"do"^ statement "while"! LPAREN! expression RPAREN! SEMI!
+
+	// get out of a loop (or switch)
+	|	"break"^ (IDENT)? SEMI!
+
+	// do next iteration of a loop
+	|	"continue"^ (IDENT)? SEMI!
+
+	// Return an expression
+	|	"return"^ (expression)? SEMI!
+
+	// switch/case statement
+	|	"switch"^ LPAREN! expression RPAREN! LCURLY!
+			( casesGroup )*
+		RCURLY!
+
+	// exception try-catch block
+	|	tryBlock
+
+	// throw an exception
+	|	"throw"^ expression SEMI!
+
+	// synchronize a statement
+	|	"synchronized"^ LPAREN! expression RPAREN! compoundStatement
+
+	// empty statement
+	|	s:SEMI {#s.setType(EMPTY_STAT);}
+	;
+
+
+casesGroup
+	:	(	// CONFLICT: to which case group do the statements bind?
+			//           ANTLR generates proper code: it groups the
+			//           many "case"/"default" labels together then
+			//           follows them with the statements
+			options {
+				warnWhenFollowAmbig = false;
+			}
+			:
+			aCase
+		)+
+		caseSList
+		{#casesGroup = #([CASE_GROUP, "CASE_GROUP"], #casesGroup);}
+	;
+
+aCase
+	:	("case"^ expression | "default") COLON!
+	;
+
+caseSList
+	:	(statement)*
+		{#caseSList = #(#[SLIST,"SLIST"],#caseSList);}
+	;
+
+// The initializer for a for loop
+forInit
+		// if it looks like a declaration, it is
+	:	(	(declaration)=> declaration
+		// otherwise it could be an expression list...
+		|	expressionList
+		)?
+		{#forInit = #(#[FOR_INIT,"FOR_INIT"],#forInit);}
+	;
+
+forCond
+	:	(expression)?
+		{#forCond = #(#[FOR_CONDITION,"FOR_CONDITION"],#forCond);}
+	;
+
+forIter
+	:	(expressionList)?
+		{#forIter = #(#[FOR_ITERATOR,"FOR_ITERATOR"],#forIter);}
+	;
+
+// an exception handler try/catch block
+tryBlock
+	:	"try"^ compoundStatement
+		(handler)*
+		( "finally"^ compoundStatement )?
+	;
+
+
+// an exception handler
+handler
+	:	"catch"^ LPAREN! parameterDeclaration RPAREN! compoundStatement
+	;
+
+
+// expressions
+// Note that most of these expressions follow the pattern
+//   thisLevelExpression :
+//       nextHigherPrecedenceExpression
+//           (OPERATOR nextHigherPrecedenceExpression)*
+// which is a standard recursive definition for a parsing an expression.
+// The operators in java have the following precedences:
+//    lowest  (13)  = *= /= %= += -= <<= >>= >>>= &= ^= |=
+//            (12)  ?:
+//            (11)  ||
+//            (10)  &&
+//            ( 9)  |
+//            ( 8)  ^
+//            ( 7)  &
+//            ( 6)  == !=
+//            ( 5)  < <= > >=
+//            ( 4)  << >>
+//            ( 3)  +(binary) -(binary)
+//            ( 2)  * / %
+//            ( 1)  ++ -- +(unary) -(unary)  ~  !  (type)
+//                  []   () (method call)  . (dot -- identifier qualification)
+//                  new   ()  (explicit parenthesis)
+//
+// the last two are not usually on a precedence chart; I put them in
+// to point out that new has a higher precedence than '.', so you
+// can validy use
+//     new Frame().show()
+// 
+// Note that the above precedence levels map to the rules below...
+// Once you have a precedence chart, writing the appropriate rules as below
+//   is usually very straightfoward
+
+
+
+// the mother of all expressions
+expression
+	:	assignmentExpression
+		{#expression = #(#[EXPR,"EXPR"],#expression);}
+	;
+
+
+// This is a list of expressions.
+expressionList
+	:	expression (COMMA! expression)*
+		{#expressionList = #(#[ELIST,"ELIST"], expressionList);}
+	;
+
+
+// assignment expression (level 13)
+assignmentExpression
+	:	conditionalExpression
+		(	(	ASSIGN^
+            |   PLUS_ASSIGN^
+            |   MINUS_ASSIGN^
+            |   STAR_ASSIGN^
+            |   DIV_ASSIGN^
+            |   MOD_ASSIGN^
+            |   SR_ASSIGN^
+            |   BSR_ASSIGN^
+            |   SL_ASSIGN^
+            |   BAND_ASSIGN^
+            |   BXOR_ASSIGN^
+            |   BOR_ASSIGN^
+            )
+			assignmentExpression
+		)?
+	;
+
+
+// conditional test (level 12)
+conditionalExpression
+	:	logicalOrExpression
+		( QUESTION^ assignmentExpression COLON! conditionalExpression )?
+	;
+
+
+// logical or (||)  (level 11)
+logicalOrExpression
+	:	logicalAndExpression (LOR^ logicalAndExpression)*
+	;
+
+
+// logical and (&&)  (level 10)
+logicalAndExpression
+	:	inclusiveOrExpression (LAND^ inclusiveOrExpression)*
+	;
+
+
+// bitwise or non-short-circuiting or (|)  (level 9)
+inclusiveOrExpression
+	:	exclusiveOrExpression (BOR^ exclusiveOrExpression)*
+	;
+
+
+// exclusive or (^)  (level 8)
+exclusiveOrExpression
+	:	andExpression (BXOR^ andExpression)*
+	;
+
+
+// bitwise or non-short-circuiting and (&)  (level 7)
+andExpression
+	:	equalityExpression (BAND^ equalityExpression)*
+	;
+
+
+// equality/inequality (==/!=) (level 6)
+equalityExpression
+	:	relationalExpression ((NOT_EQUAL^ | EQUAL^) relationalExpression)*
+	;
+
+
+// boolean relational expressions (level 5)
+relationalExpression
+	:	shiftExpression
+		(	(	(	LT^
+				|	GT^
+				|	LE^
+				|	GE^
+				)
+				shiftExpression
+			)*
+		|	"instanceof"^ typeSpec[true]
+		)
+	;
+
+
+// bit shift expressions (level 4)
+shiftExpression
+	:	additiveExpression ((SL^ | SR^ | BSR^) additiveExpression)*
+	;
+
+
+// binary addition/subtraction (level 3)
+additiveExpression
+	:	multiplicativeExpression ((PLUS^ | MINUS^) multiplicativeExpression)*
+	;
+
+
+// multiplication/division/modulo (level 2)
+multiplicativeExpression
+	:	unaryExpression ((STAR^ | DIV^ | MOD^ ) unaryExpression)*
+	;
+
+unaryExpression
+	:	INC^ unaryExpression
+	|	DEC^ unaryExpression
+	|	MINUS^ {#MINUS.setType(UNARY_MINUS);} unaryExpression
+	|	PLUS^  {#PLUS.setType(UNARY_PLUS);} unaryExpression
+	|	unaryExpressionNotPlusMinus
+	;
+
+unaryExpressionNotPlusMinus
+	:	BNOT^ unaryExpression
+	|	LNOT^ unaryExpression
+
+	|	(	// subrule allows option to shut off warnings
+			options {
+				// "(int" ambig with postfixExpr due to lack of sequence
+				// info in linear approximate LL(k).  It's ok.  Shut up.
+				generateAmbigWarnings=false;
+			}
+		:	// If typecast is built in type, must be numeric operand
+			// Also, no reason to backtrack if type keyword like int, float...
+			lpb:LPAREN^ {#lpb.setType(TYPECAST);} builtInTypeSpec[true] RPAREN!
+			unaryExpression
+
+			// Have to backtrack to see if operator follows.  If no operator
+			// follows, it's a typecast.  No semantic checking needed to parse.
+			// if it _looks_ like a cast, it _is_ a cast; else it's a "(expr)"
+		|	(LPAREN classTypeSpec[true] RPAREN unaryExpressionNotPlusMinus)=>
+			lp:LPAREN^ {#lp.setType(TYPECAST);} classTypeSpec[true] RPAREN!
+			unaryExpressionNotPlusMinus
+
+		|	postfixExpression
+		)
+	;
+
+// qualified names, array expressions, method invocation, post inc/dec
+postfixExpression
+	:	primaryExpression // start with a primary
+
+		(	// qualified id (id.id.id.id...) -- build the name
+			DOT^ ( IDENT
+				| "this"
+				| "class"
+				| newExpression
+				| "super" LPAREN ( expressionList )? RPAREN
+				)
+			// the above line needs a semantic check to make sure "class"
+			//   is the _last_ qualifier.
+
+			// allow ClassName[].class
+		|	( lbc:LBRACK^ {#lbc.setType(ARRAY_DECLARATOR);} RBRACK! )+
+			DOT^ "class"
+
+			// an array indexing operation
+		|	lb:LBRACK^ {#lb.setType(INDEX_OP);} expression RBRACK!
+
+			// method invocation
+			// The next line is not strictly proper; it allows x(3)(4) or
+			//  x[2](4) which are not valid in Java.  If this grammar were used
+			//  to validate a Java program a semantic check would be needed, or
+			//   this rule would get really ugly...
+		|	lp:LPAREN^ {#lp.setType(METHOD_CALL);}
+				argList
+			RPAREN!
+		)*
+
+		// possibly add on a post-increment or post-decrement.
+		// allows INC/DEC on too much, but semantics can check
+		(	in:INC^ {#in.setType(POST_INC);}
+	 	|	de:DEC^ {#de.setType(POST_DEC);}
+		|	// nothing
+		)
+
+		// look for int.class and int[].class
+	|	builtInType 
+		( lbt:LBRACK^ {#lbt.setType(ARRAY_DECLARATOR);} RBRACK! )*
+		DOT^ "class"
+	;
+
+// the basic element of an expression
+primaryExpression
+	:	IDENT
+	|	newExpression
+	|	constant
+	|	"super"
+	|	"true"
+	|	"false"
+	|	"this"
+	|	"null"
+	|	LPAREN! assignmentExpression RPAREN!
+	;
+
+/** object instantiation.
+ *  Trees are built as illustrated by the following input/tree pairs:
+ *  
+ *  new T()
+ *  
+ *  new
+ *   |
+ *   T --  ELIST
+ *           |
+ *          arg1 -- arg2 -- .. -- argn
+ *  
+ *  new int[]
+ *
+ *  new
+ *   |
+ *  int -- ARRAY_DECLARATOR
+ *  
+ *  new int[] {1,2}
+ *
+ *  new
+ *   |
+ *  int -- ARRAY_DECLARATOR -- ARRAY_INIT
+ *                                  |
+ *                                EXPR -- EXPR
+ *                                  |      |
+ *                                  1      2
+ *  
+ *  new int[3]
+ *  new
+ *   |
+ *  int -- ARRAY_DECLARATOR
+ *                |
+ *              EXPR
+ *                |
+ *                3
+ *  
+ *  new int[1][2]
+ *  
+ *  new
+ *   |
+ *  int -- ARRAY_DECLARATOR
+ *               |
+ *         ARRAY_DECLARATOR -- EXPR
+ *               |              |
+ *             EXPR             1
+ *               |
+ *               2
+ *  
+ */
+newExpression
+	:	"new"^ type
+		(	LPAREN! argList RPAREN! (classBlock)?
+
+			//java 1.1
+			// Note: This will allow bad constructs like
+			//    new int[4][][3] {exp,exp}.
+			//    There needs to be a semantic check here...
+			// to make sure:
+			//   a) [ expr ] and [ ] are not mixed
+			//   b) [ expr ] and an init are not used together
+
+		|	newArrayDeclarator (arrayInitializer)?
+		)
+	;
+
+argList
+	:	(	expressionList
+		|	/*nothing*/
+			{#argList = #[ELIST,"ELIST"];}
+		)
+	;
+
+newArrayDeclarator
+	:	(
+			// CONFLICT:
+			// newExpression is a primaryExpression which can be
+			// followed by an array index reference.  This is ok,
+			// as the generated code will stay in this loop as
+			// long as it sees an LBRACK (proper behavior)
+			options {
+				warnWhenFollowAmbig = false;
+			}
+		:
+			lb:LBRACK^ {#lb.setType(ARRAY_DECLARATOR);}
+				(expression)?
+			RBRACK!
+		)+
+	;
+
+constant
+	:	NUM_INT
+	|	CHAR_LITERAL
+	|	STRING_LITERAL
+	|	NUM_FLOAT
+	;
+
+
+//----------------------------------------------------------------------------
+// The Java scanner
+//----------------------------------------------------------------------------
+class JavaLexer extends Lexer;
+
+options {
+	exportVocab=Java;      // call the vocabulary "Java"
+	testLiterals=false;    // don't automatically test for literals
+	k=4;                   // four characters of lookahead
+}
+
+
+
+// OPERATORS
+QUESTION		:	'?'		;
+LPAREN			:	'('		;
+RPAREN			:	')'		;
+LBRACK			:	'['		;
+RBRACK			:	']'		;
+LCURLY			:	'{'		;
+RCURLY			:	'}'		;
+COLON			:	':'		;
+COMMA			:	','		;
+//DOT			:	'.'		;
+ASSIGN			:	'='		;
+EQUAL			:	"=="	;
+LNOT			:	'!'		;
+BNOT			:	'~'		;
+NOT_EQUAL		:	"!="	;
+DIV				:	'/'		;
+DIV_ASSIGN		:	"/="	;
+PLUS			:	'+'		;
+PLUS_ASSIGN		:	"+="	;
+INC				:	"++"	;
+MINUS			:	'-'		;
+MINUS_ASSIGN	:	"-="	;
+DEC				:	"--"	;
+STAR			:	'*'		;
+STAR_ASSIGN		:	"*="	;
+MOD				:	'%'		;
+MOD_ASSIGN		:	"%="	;
+SR				:	">>"	;
+SR_ASSIGN		:	">>="	;
+BSR				:	">>>"	;
+BSR_ASSIGN		:	">>>="	;
+GE				:	">="	;
+GT				:	">"		;
+SL				:	"<<"	;
+SL_ASSIGN		:	"<<="	;
+LE				:	"<="	;
+LT				:	'<'		;
+BXOR			:	'^'		;
+BXOR_ASSIGN		:	"^="	;
+BOR				:	'|'		;
+BOR_ASSIGN		:	"|="	;
+LOR				:	"||"	;
+BAND			:	'&'		;
+BAND_ASSIGN		:	"&="	;
+LAND			:	"&&"	;
+SEMI			:	';'		;
+
+
+// Whitespace -- ignored
+WS	:	(	' '
+		|	'\t'
+		|	'\f'
+		// handle newlines
+		|	(	"\r\n"  // Evil DOS
+			|	'\r'    // Macintosh
+			|	'\n'    // Unix (the right way)
+			)
+			{ newline(); }
+		)
+		{ _ttype = Token.SKIP; }
+	;
+
+// Single-line comments
+SL_COMMENT
+	:	"//"
+		(~('\n'|'\r'))* ('\n'|'\r'('\n')?)
+		{$setType(Token.SKIP); newline();}
+	;
+
+// multiple-line comments
+ML_COMMENT
+	:	"/*"
+		(	/*	'\r' '\n' can be matched in one alternative or by matching
+				'\r' in one iteration and '\n' in another.  I am trying to
+				handle any flavor of newline that comes in, but the language
+				that allows both "\r\n" and "\r" and "\n" to all be valid
+				newline is ambiguous.  Consequently, the resulting grammar
+				must be ambiguous.  I'm shutting this warning off.
+			 */
+			options {
+				generateAmbigWarnings=false;
+			}
+		:
+			{ LA(2)!='/' }? '*'
+		|	'\r' '\n'		{newline();}
+		|	'\r'			{newline();}
+		|	'\n'			{newline();}
+		|	~('*'|'\n'|'\r')
+		)*
+		"*/"
+		{$setType(Token.SKIP);}
+	;
+
+
+// character literals
+CHAR_LITERAL
+	:	'\'' ( ESC | ~'\'' ) '\''
+	;
+
+// string literals
+STRING_LITERAL
+	:	'"' (ESC|~('"'|'\\'))* '"'
+	;
+
+
+// escape sequence -- note that this is protected; it can only be called
+//   from another lexer rule -- it will not ever directly return a token to
+//   the parser
+// There are various ambiguities hushed in this rule.  The optional
+// '0'...'9' digit matches should be matched here rather than letting
+// them go back to STRING_LITERAL to be matched.  ANTLR does the
+// right thing by matching immediately; hence, it's ok to shut off
+// the FOLLOW ambig warnings.
+protected
+ESC
+	:	'\\'
+		(	'n'
+		|	'r'
+		|	't'
+		|	'b'
+		|	'f'
+		|	'"'
+		|	'\''
+		|	'\\'
+		|	('u')+ HEX_DIGIT HEX_DIGIT HEX_DIGIT HEX_DIGIT 
+		|	('0'..'3')
+			(
+				options {
+					warnWhenFollowAmbig = false;
+				}
+			:	('0'..'7')
+				(	
+					options {
+						warnWhenFollowAmbig = false;
+					}
+				:	'0'..'7'
+				)?
+			)?
+		|	('4'..'7')
+			(
+				options {
+					warnWhenFollowAmbig = false;
+				}
+			:	('0'..'9')
+			)?
+		)
+	;
+
+
+// hexadecimal digit (again, note it's protected!)
+protected
+HEX_DIGIT
+	:	('0'..'9'|'A'..'F'|'a'..'f')
+	;
+
+
+// a dummy rule to force vocabulary to be all characters (except special
+//   ones that ANTLR uses internally (0 to 2)
+protected
+VOCAB
+	:	'\3'..'\377'
+	;
+
+
+// an identifier.  Note that testLiterals is set to true!  This means
+// that after we match the rule, we look in the literals table to see
+// if it's a literal or really an identifer
+IDENT
+	options {testLiterals=true;}
+	:	('a'..'z'|'A'..'Z'|'_'|'$') ('a'..'z'|'A'..'Z'|'_'|'0'..'9'|'$')*
+	;
+
+
+// a numeric literal
+NUM_INT
+	{boolean isDecimal=false;}
+	:	'.' {_ttype = DOT;}
+			(('0'..'9')+ (EXPONENT)? (FLOAT_SUFFIX)? { _ttype = NUM_FLOAT; })?
+	|	(	'0' {isDecimal = true;} // special case for just '0'
+			(	('x'|'X')
+				(											// hex
+					// the 'e'|'E' and float suffix stuff look
+					// like hex digits, hence the (...)+ doesn't
+					// know when to stop: ambig.  ANTLR resolves
+					// it correctly by matching immediately.  It
+					// is therefor ok to hush warning.
+					options {
+						warnWhenFollowAmbig=false;
+					}
+				:	HEX_DIGIT
+				)+
+			|	('0'..'7')+									// octal
+			)?
+		|	('1'..'9') ('0'..'9')*  {isDecimal=true;}		// non-zero decimal
+		)
+		(	('l'|'L')
+		
+		// only check to see if it's a float if looks like decimal so far
+		|	{isDecimal}?
+			(	'.' ('0'..'9')* (EXPONENT)? (FLOAT_SUFFIX)?
+			|	EXPONENT (FLOAT_SUFFIX)?
+			|	FLOAT_SUFFIX
+			)
+			{ _ttype = NUM_FLOAT; }
+		)?
+	;
+
+
+// a couple protected methods to assist in matching floating point numbers
+protected
+EXPONENT
+	:	('e'|'E') ('+'|'-')? ('0'..'9')+
+	;
+
+
+protected
+FLOAT_SUFFIX
+	:	'f'|'F'|'d'|'D'
+	;
+
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.tree.g b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.tree.g
new file mode 100644
index 0000000..dc81cb9
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/optional/antlr/java.tree.g
@@ -0,0 +1,314 @@
+/** Java 1.2 AST Recognizer Grammar
+ *
+ * Author:
+ *	Terence Parr	parrt@jguru.com
+ *
+ * Version tracking now done with following ID:
+ *
+ * $Id: java.tree.g,v 1.1 2000/11/06 12:35:13 bodewig Exp $
+ *
+ * This grammar is in the PUBLIC DOMAIN
+ *
+ * BUGS
+ */
+class JavaTreeParser extends TreeParser;
+
+options {
+	importVocab = Java;
+}
+
+compilationUnit
+	:	(packageDefinition)?
+		(importDefinition)*
+		(typeDefinition)*
+	;
+
+packageDefinition
+	:	#( PACKAGE_DEF identifier )
+	;
+
+importDefinition
+	:	#( IMPORT identifierStar )
+	;
+
+typeDefinition
+	:	#(CLASS_DEF modifiers IDENT extendsClause implementsClause objBlock )
+	|	#(INTERFACE_DEF modifiers IDENT extendsClause interfaceBlock )
+	;
+
+typeSpec
+	:	#(TYPE typeSpecArray)
+	;
+
+typeSpecArray
+	:	#( ARRAY_DECLARATOR typeSpecArray )
+	|	type
+	;
+
+type:	identifier
+	|	builtInType
+	;
+
+builtInType
+    :   "void"
+    |   "boolean"
+    |   "byte"
+    |   "char"
+    |   "short"
+    |   "int"
+    |   "float"
+    |   "long"
+    |   "double"
+    ;
+
+modifiers
+	:	#( MODIFIERS (modifier)* )
+	;
+
+modifier
+    :   "private"
+    |   "public"
+    |   "protected"
+    |   "static"
+    |   "transient"
+    |   "final"
+    |   "abstract"
+    |   "native"
+    |   "threadsafe"
+    |   "synchronized"
+    |   "const"
+    |   "volatile"
+    ;
+
+extendsClause
+	:	#(EXTENDS_CLAUSE (identifier)* )
+	;
+
+implementsClause
+	:	#(IMPLEMENTS_CLAUSE (identifier)* )
+	;
+
+
+interfaceBlock
+	:	#(	OBJBLOCK
+			(	methodDecl
+			|	variableDef
+			)*
+		)
+	;
+	
+objBlock
+	:	#(	OBJBLOCK
+			(	ctorDef
+			|	methodDef
+			|	variableDef
+			|	typeDefinition
+			|	#(STATIC_INIT slist)
+			|	#(INSTANCE_INIT slist)
+			)*
+		)
+	;
+
+ctorDef
+	:	#(CTOR_DEF modifiers methodHead slist)
+	;
+
+methodDecl
+	:	#(METHOD_DEF modifiers typeSpec methodHead)
+	;
+
+methodDef
+	:	#(METHOD_DEF modifiers typeSpec methodHead (slist)?)
+	;
+
+variableDef
+	:	#(VARIABLE_DEF modifiers typeSpec variableDeclarator varInitializer)
+	;
+
+parameterDef
+	:	#(PARAMETER_DEF modifiers typeSpec IDENT )
+	;
+
+objectinitializer
+	:	#(INSTANCE_INIT slist)
+	;
+
+variableDeclarator
+	:	IDENT
+	|	LBRACK variableDeclarator
+	;
+
+varInitializer
+	:	#(ASSIGN initializer)
+	|
+	;
+
+initializer
+	:	expression
+	|	arrayInitializer
+	;
+
+arrayInitializer
+	:	#(ARRAY_INIT (initializer)*)
+	;
+
+methodHead
+	:	IDENT #( PARAMETERS (parameterDef)* ) (throwsClause)?
+	;
+
+throwsClause
+	:	#( "throws" (identifier)* )
+	;
+
+identifier
+	:	IDENT
+	|	#( DOT identifier IDENT )
+	;
+
+identifierStar
+	:	IDENT
+	|	#( DOT identifier (STAR|IDENT) )
+	;
+
+slist
+	:	#( SLIST (stat)* )
+	;
+
+stat:	typeDefinition
+	|	variableDef
+	|	expression
+	|	#(LABELED_STAT IDENT stat)
+	|	#("if" expression stat (stat)? )
+	|	#(	"for"
+			#(FOR_INIT (variableDef | elist)?)
+			#(FOR_CONDITION (expression)?)
+			#(FOR_ITERATOR (elist)?)
+			stat
+		)
+	|	#("while" expression stat)
+	|	#("do" stat expression)
+	|	#("break" (IDENT)? )
+	|	#("continue" (IDENT)? )
+	|	#("return" (expression)? )
+	|	#("switch" expression (caseGroup)*)
+	|	#("throw" expression)
+	|	#("synchronized" expression stat)
+	|	tryBlock
+	|	slist // nested SLIST
+	|	EMPTY_STAT
+	;
+
+caseGroup
+	:	#(CASE_GROUP (#("case" expression) | "default")+ slist)
+	;
+
+tryBlock
+	:	#( "try" slist (handler)* (#("finally" slist))? )
+	;
+
+handler
+	:	#( "catch" parameterDef slist )
+	;
+
+elist
+	:	#( ELIST (expression)* )
+	;
+
+expression
+	:	#(EXPR expr)
+	;
+
+expr:	#(QUESTION expr expr expr)	// trinary operator
+	|	#(ASSIGN expr expr)			// binary operators...
+	|	#(PLUS_ASSIGN expr expr)
+	|	#(MINUS_ASSIGN expr expr)
+	|	#(STAR_ASSIGN expr expr)
+	|	#(DIV_ASSIGN expr expr)
+	|	#(MOD_ASSIGN expr expr)
+	|	#(SR_ASSIGN expr expr)
+	|	#(BSR_ASSIGN expr expr)
+	|	#(SL_ASSIGN expr expr)
+	|	#(BAND_ASSIGN expr expr)
+	|	#(BXOR_ASSIGN expr expr)
+	|	#(BOR_ASSIGN expr expr)
+	|	#(LOR expr expr)
+	|	#(LAND expr expr)
+	|	#(BOR expr expr)
+	|	#(BXOR expr expr)
+	|	#(BAND expr expr)
+	|	#(NOT_EQUAL expr expr)
+	|	#(EQUAL expr expr)
+	|	#(LT expr expr)
+	|	#(GT expr expr)
+	|	#(LE expr expr)
+	|	#(GE expr expr)
+	|	#(SL expr expr)
+	|	#(SR expr expr)
+	|	#(BSR expr expr)
+	|	#(PLUS expr expr)
+	|	#(MINUS expr expr)
+	|	#(DIV expr expr)
+	|	#(MOD expr expr)
+	|	#(STAR expr expr)
+	|	#(INC expr)
+	|	#(DEC expr)
+	|	#(POST_INC expr)
+	|	#(POST_DEC expr)
+	|	#(BNOT expr)
+	|	#(LNOT expr)
+	|	#("instanceof" expr expr)
+	|	#(UNARY_MINUS expr)
+	|	#(UNARY_PLUS expr)
+	|	primaryExpression
+	;
+
+primaryExpression
+    :   IDENT
+    |   #(	DOT
+			(	expr
+				(	IDENT
+				|	arrayIndex
+				|	"this"
+				|	"class"
+				|	#( "new" IDENT elist )
+				)
+			|	#(ARRAY_DECLARATOR type)
+			|	builtInType ("class")?
+			)
+		)
+	|	arrayIndex
+	|	#(METHOD_CALL primaryExpression elist)
+	|	#(TYPECAST typeSpec expr)
+	|   newExpression
+	|   constant
+    |   "super"
+    |   "true"
+    |   "false"
+    |   "this"
+    |   "null"
+	|	typeSpec // type name used with instanceof
+	;
+
+arrayIndex
+	:	#(INDEX_OP primaryExpression expression)
+	;
+
+constant
+    :   NUM_INT
+    |   CHAR_LITERAL
+    |   STRING_LITERAL
+    |   NUM_FLOAT
+    ;
+
+newExpression
+	:	#(	"new" type
+			(	newArrayDeclarator (arrayInitializer)?
+			|	elist
+			)
+		)
+			
+	;
+
+newArrayDeclarator
+	:	#( ARRAY_DECLARATOR (newArrayDeclarator)? (expression)? )
+	;
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/property.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/property.xml
new file mode 100644
index 0000000..fdc601e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/property.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+
+<project name="property-test" basedir="." default="test1">
+
+  <target name="test1">
+    <property environment="testenv"/>
+  </target>
+</project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/rename.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/rename.xml
index 1a70679..73db635 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/rename.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/rename.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <rename/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/replace.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/replace.xml
index 7424289..e7cf195 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/replace.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/replace.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <replace/>
@@ -23,4 +23,22 @@
              token="dont_want_to_really_replace_something"/>
   </target>
 
+  <target name="test6">
+    <replace file="template.xml">
+      <replacefilter />
+    </replace>
+  </target>
+
+  <target name="test7">
+    <replace file="template.xml">
+      <replacefilter token="" />
+    </replace>
+  </target>
+
+  <target name="test8">
+    <replace file="template.xml">
+      <replacefilter token="dont_want_to_really_replace_something" />
+    </replace>
+  </target>
+
 </project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/tar.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/tar.xml
index 666b702..06935fb 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/tar.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/tar.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="tar-test" basedir="." default="test1">
 
   <target name="test1">
     <tar/>
@@ -14,4 +14,14 @@
     <tar basedir=""/>
   </target>
 
+  <target name="test4">
+    <touch file="test4.tar"/>
+    <tar tarfile="test4.tar"
+         basedir="."/>
+  </target>
+
+  
+  <target name="cleanup"> 
+    <delete file="test4.tar"/>
+  </target>
 </project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/taskdef.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/taskdef.xml
index 94d76ec..ff52701 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/taskdef.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/taskdef.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <taskdef/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/template.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/template.xml
index 02a0f47..e2aef3e 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/template.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/template.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
   </target>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/unzip.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/unzip.xml
index e203523..0e462db 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/unzip.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/unzip.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="xxx-test" basedir="." default="test1">
 
   <target name="test1">
     <unzip/>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/zip.xml b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/zip.xml
index d3988c2..1c8c63e 100644
--- a/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/zip.xml
+++ b/jakarta-ant-1.2-src/src/etc/testcases/taskdefs/zip.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 
-<project name="xxx-test" basedir=".">
+<project name="zip-test" basedir="." default="test1">
 
   <target name="test1">
     <zip/>
@@ -10,4 +10,24 @@
     <zip zipfile="zip.tmp"/>
   </target>
 
+  <!-- Test when the zip file includes itself
+  when target file exists before the zip task is run -->
+  <target name="test3">
+    <touch file="test3.zip"/>
+    <zip zipfile="test3.zip"
+         basedir="."/>
+  </target>
+
+  <!-- Test when the zip file includes itself
+  when target file does not exist before the zip task is run -->
+  <target name="test4">
+     <zip zipfile="test4.zip"
+         basedir="."/>
+  </target>
+
+
+  <target name="cleanup">
+    <delete file="test3.zip"/>
+    <delete file="test4.zip"/>
+  </target>
 </project>
diff --git a/jakarta-ant-1.2-src/src/etc/testcases/types/mapper.xml b/jakarta-ant-1.2-src/src/etc/testcases/types/mapper.xml
new file mode 100644
index 0000000..e9a8eed
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/etc/testcases/types/mapper.xml
@@ -0,0 +1,19 @@
+<?xml version="1.0"?>
+
+<project name="copy-test" basedir="." default="test1">
+
+  <target name="test1">
+    <delete dir="copytest" />
+    <mkdir dir="copytest" />
+    <copy todir="copytest">
+      <fileset dir="../../../main">
+        <include name="**/taskdefs/*.java" />
+      </fileset>
+      <fileset dir="../../../testcases">
+        <include name="**/taskdefs/*.java" />
+      </fileset>
+      <mapper type="flatten" />
+    </copy>
+  </target>
+
+</project>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/AntClassLoader.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/AntClassLoader.java
index 4b74d39..c9efb8a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/AntClassLoader.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/AntClassLoader.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * Copyright (c) 2000-2001 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,6 +54,7 @@
 
 package org.apache.tools.ant;
 
+import java.lang.reflect.*;
 import java.util.*;
 import java.util.zip.*;
 import java.io.*;
@@ -65,7 +66,8 @@ import org.apache.tools.ant.types.Path;
  * system classpath by using the forceLoadClass method. Any subsequent classes loaded by that
  * class will then use this loader rather than the system class loader.
  *
- * @author Conor MacNeill
+ * @author <a href="mailto:conor@cortexebusiness.com.au">Conor MacNeill</a>
+ * @author <a href="mailto:Jesse.Glick@netbeans.com">Jesse Glick</a>
  */
 public class AntClassLoader  extends ClassLoader {
     /**
@@ -101,15 +103,36 @@ public class AntClassLoader  extends ClassLoader {
      */
     private Vector loaderPackages = new Vector();
     
+    /**
+     * This flag indicates that the classloader will ignore the base
+     * classloader if it can;t find a class.
+     */
+    private boolean ignoreBase = false;
+    
+    private static Method getProtectionDomain = null;
+    private static Method defineClassProtectionDomain = null;
+    static {
+        try {
+            getProtectionDomain = Class.class.getMethod("getProtectionDomain", new Class[0]);
+            Class protectionDomain = Class.forName("java.security.ProtectionDomain");
+            Class[] args = new Class[] {String.class, byte[].class, Integer.TYPE, Integer.TYPE, protectionDomain};
+            defineClassProtectionDomain = ClassLoader.class.getDeclaredMethod("defineClass", args);
+        }
+        catch (Exception e) {}
+    }
+
+
     /**
      * Create a classloader for the given project using the classpath given.
      *
      * @param project the project to ehich this classloader is to belong.
-     * @param classpath the classpath to use to load the classes.
+     * @param classpath the classpath to use to load the classes.  This
+     *                is combined with the system classpath in a manner
+     *                determined by the value of ${build.sysclasspath}
      */
     public AntClassLoader(Project project, Path classpath) {
         this.project = project;
-        this.classpath = classpath;
+        this.classpath = classpath.concatSystemClasspath("ignore");
 
         // JDK > 1.1 should add these by default, but some VMs don't
         addSystemPackageRoot("java");
@@ -126,6 +149,16 @@ public class AntClassLoader  extends ClassLoader {
         this(project, classpath);
         this.systemFirst = systemFirst;
     }
+
+    /**
+     * Set this classloader to run in isolated mode. In isolated mode, classes not
+     * found on the given classpath will not be referred to the base class loader
+     * but will cause a classNotFoundException.
+     */
+    public void setIsolated(boolean isolated) {
+        ignoreBase = isolated;
+    }
+    
     
     /**
      * Add a package root to the list of packages which must be loaded on the 
@@ -196,7 +229,7 @@ public class AntClassLoader  extends ClassLoader {
         Class theClass = findLoadedClass(classname);
 
         if (theClass == null) {
-            theClass = findSystemClass(classname);
+            theClass = findBaseClass(classname);
         }
         
         return theClass;
@@ -323,7 +356,7 @@ public class AntClassLoader  extends ClassLoader {
         if (theClass == null) {
             if (useSystemFirst) {
                 try {
-                    theClass = findSystemClass(classname);
+                    theClass = findBaseClass(classname);
                     project.log("Class " + classname + " loaded from system loader", Project.MSG_DEBUG);
                 }
                 catch (ClassNotFoundException cnfe) {
@@ -337,7 +370,10 @@ public class AntClassLoader  extends ClassLoader {
                     project.log("Class " + classname + " loaded from ant loader", Project.MSG_DEBUG);
                 }
                 catch (ClassNotFoundException cnfe) {
-                    theClass = findSystemClass(classname);
+                    if (ignoreBase) {
+                        throw cnfe;
+                    }
+                    theClass = findBaseClass(classname);
                     project.log("Class " + classname + " loaded from system loader", Project.MSG_DEBUG);
                 }
             }
@@ -385,10 +421,33 @@ public class AntClassLoader  extends ClassLoader {
         
         byte[] classData = baos.toByteArray();
 
-        return defineClass(classname, classData, 0, classData.length); 
+        // Simply put:
+        // defineClass(classname, classData, 0, classData.length, Project.class.getProtectionDomain());
+        // Made more elaborate to be 1.1-safe.
+        if (defineClassProtectionDomain != null) {
+            try {
+                Object domain = getProtectionDomain.invoke(Project.class, new Object[0]);
+                Object[] args = new Object[] {classname, classData, new Integer(0), new Integer(classData.length), domain};
+                return (Class)defineClassProtectionDomain.invoke(this, args);
+            }
+            catch (InvocationTargetException ite) {
+                Throwable t = ite.getTargetException();
+                if (t instanceof ClassFormatError) {
+                    throw (ClassFormatError)t;
+                }
+                else {
+                    throw new IOException(t.toString());
+                }
+            }
+            catch (Exception e) {
+                throw new IOException(e.toString());
+            }
+        }
+        else {
+            return defineClass(classname, classData, 0, classData.length); 
+        }
     }
 
-
     /**
      * Search for and load a class on the classpath of this class loader.
      *
@@ -445,4 +504,17 @@ public class AntClassLoader  extends ClassLoader {
             catch (IOException e) {}
         }
     }
+
+    /**
+     * Find a system class (which should be loaded from the same classloader as the Ant core).
+     */
+    private Class findBaseClass(String name) throws ClassNotFoundException {
+        ClassLoader base = AntClassLoader.class.getClassLoader();
+        if (base == null) {
+            return findSystemClass(name);
+        }
+        else {
+            return base.loadClass(name);
+        }
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildEvent.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildEvent.java
index 42b604b..359c1ff 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildEvent.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildEvent.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,7 +51,6 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant;
 
 import java.util.EventObject;
@@ -64,7 +63,6 @@ public class BuildEvent extends EventObject {
     private int priority = Project.MSG_VERBOSE;
     private Throwable exception;
 
-    
     /**
      * Construct a BuildEvent for a project level event
      *
@@ -163,4 +161,4 @@ public class BuildEvent extends EventObject {
     public Throwable getException() {
         return exception;
     }
-}
\ No newline at end of file
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildException.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildException.java
index 5e88198..efbda74 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildException.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildException.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * Copyright (c) 1999-2001 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,15 +51,16 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant;
 
+
+import java.io.*;
+
 /**
  * Signals an error condition during a build.
  *
  * @author James Duncan Davidson
  */
-
 public class BuildException extends RuntimeException {
 
     /** Exception that might have caused this one. */
@@ -71,18 +72,16 @@ public class BuildException extends RuntimeException {
     /**
      * Constructs a build exception with no descriptive information.
      */
-
     public BuildException() {
-	super();
+        super();
     }
 
     /**
      * Constructs an exception with the given descriptive message.
      * @param msg Description of or information about the exception.
      */
-
     public BuildException(String msg) {
-	super(msg);
+        super(msg);
     }
 
     /**
@@ -91,10 +90,9 @@ public class BuildException extends RuntimeException {
      * @param msg Description of or information about the exception.
      * @param cause Throwable that might have cause this one.
      */
-
     public BuildException(String msg, Throwable cause) {
-	super(msg);
-	this.cause = cause;
+        super(msg);
+        this.cause = cause;
     }
 
     /**
@@ -104,20 +102,18 @@ public class BuildException extends RuntimeException {
      * @param cause Exception that might have cause this one.
      * @param location Location in the project file where the error occured.
      */
-
     public BuildException(String msg, Throwable cause, Location location) {
         this(msg, cause);
-	this.location = location;
+        this.location = location;
     }
 
     /**
      * Constructs an exception with the given exception as a root cause.
      * @param cause Exception that might have caused this one.
      */
-
     public BuildException(Throwable cause) {
-	super(cause.toString());
-	this.cause = cause;
+        super(cause.toString());
+        this.cause = cause;
     }
 
     /**
@@ -126,10 +122,9 @@ public class BuildException extends RuntimeException {
      * @param msg Description of or information about the exception.
      * @param location Location in the project file where the error occured.
      */
-
     public BuildException(String msg, Location location) {
-	super(msg);
-	this.location = location;
+        super(msg);
+        this.location = location;
     }
 
     /**
@@ -138,10 +133,9 @@ public class BuildException extends RuntimeException {
      * @param cause Exception that might have cause this one.
      * @param location Location in the project file where the error occured.
      */
-
     public BuildException(Throwable cause, Location location) {
         this(cause);
-	this.location = location;
+        this.location = location;
     }
 
     /**
@@ -171,4 +165,29 @@ public class BuildException extends RuntimeException {
     public Location getLocation() {
         return location;
     }
+
+    // Override stack trace methods to show original cause:
+    public void printStackTrace() {
+        printStackTrace(System.err);
+    }
+    
+    public void printStackTrace(PrintStream ps) {
+        synchronized (ps) {
+            ps.println(this);
+            if (cause != null) {
+                ps.println("--- Nested Exception ---");
+                cause.printStackTrace(ps);
+            }
+        }
+    }
+    
+    public void printStackTrace(PrintWriter pw) {
+        synchronized (pw) {
+            pw.println(this);
+            if (cause != null) {
+                pw.println("--- Nested Exception ---");
+                cause.printStackTrace(pw);
+            }
+        }
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildListener.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildListener.java
index a560147..1f4f591 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildListener.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildListener.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildLogger.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildLogger.java
index 068c71e..96c8adb 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildLogger.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/BuildLogger.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -70,6 +70,10 @@ public interface BuildLogger extends BuildListener {
      *
      * Only messages with a message level lower than or equal to the given level are 
      * output to the log.
+     * <P>
+     * Constants for the message levels are in Project.java. The order of
+     * the levels, from least to most verbose, is MSG_ERR, MSG_WARN,
+     * MSG_INFO, MSG_VERBOSE, MSG_DEBUG.
      *
      * @param level the logging level for the logger.
      */
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Constants.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Constants.java
new file mode 100644
index 0000000..4bda035
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Constants.java
@@ -0,0 +1,16 @@
+/*
+ * Copyright (C) The Apache Software Foundation. All rights reserved.
+ *
+ * This software is published under the terms of the Apache Software License
+ * version 1.1, a copy of which has been included with this distribution in
+ * the LICENSE file.
+ */
+package org.apache.tools.ant;
+
+/**
+ * Abstract interface to hold constants.
+ * 
+ * @author <a href="mailto:donaldp@apache.org">Peter Donald</a>
+ */
+interface Constants {
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DefaultLogger.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DefaultLogger.java
index 5803aa8..4ceabcc 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DefaultLogger.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DefaultLogger.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -66,9 +66,9 @@ public class DefaultLogger implements BuildLogger {
 
     protected PrintStream out;
     protected PrintStream err;
-    protected int msgOutputLevel;
+    protected int msgOutputLevel = Project.MSG_ERR;
     private long startTime = System.currentTimeMillis();
-	
+
     protected static String lSep = System.getProperty("line.separator");
 
     protected boolean emacsMode = false;
@@ -78,6 +78,12 @@ public class DefaultLogger implements BuildLogger {
      *
      * Only messages with a message level lower than or equal to the given level are 
      * output to the log.
+     * <P>
+     * Constants for the message levels are in Project.java. The order of
+     * the levels, from least to most verbose, is MSG_ERR, MSG_WARN,
+     * MSG_INFO, MSG_VERBOSE, MSG_DEBUG.
+     *
+     * The default message level for DefaultLogger is Project.MSG_ERR.
      *
      * @param level the logging level for the logger.
      */
@@ -132,24 +138,14 @@ public class DefaultLogger implements BuildLogger {
         else {
             err.println(lSep + "BUILD FAILED" + lSep);
 
-            if (error instanceof BuildException) {
-                err.println(error.toString());
-
-                Throwable nested = ((BuildException)error).getException();
-                if (nested != null) {
-                    nested.printStackTrace(err);
-                }
-            }
-            else {
-                error.printStackTrace(err);
-            }
+            error.printStackTrace(err);
         }
 
         out.println(lSep + "Total time: " + formatTime(System.currentTimeMillis() - startTime));
     }
 
     public void targetStarted(BuildEvent event) {
-        if (msgOutputLevel <= Project.MSG_INFO) {
+        if (Project.MSG_INFO <= msgOutputLevel) {
             out.println(lSep + event.getTarget().getName() + ":");
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DesirableFilter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DesirableFilter.java
index 0bd5641..9b051b2 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DesirableFilter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DesirableFilter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,8 +55,8 @@
 package org.apache.tools.ant;
 
 import java.io.File;
-import java.io.IOException;
 import java.io.FilenameFilter;
+import java.io.IOException;
 
 /**
  * Filters filenames to determine whether or not the file is desirable.
@@ -64,7 +64,6 @@ import java.io.FilenameFilter;
  * @author Jason Hunter [jhunter@servlets.com]
  * @author james@x180.com
  */
-
 public class DesirableFilter implements FilenameFilter {
 
     /**
@@ -73,40 +72,40 @@ public class DesirableFilter implements FilenameFilter {
      */
 
     public boolean accept(File dir, String name) {
-
-	// emacs save file
-	if (name.endsWith("~")) {
-	    return false;
-	}
-
-	// emacs autosave file
-	if (name.startsWith("#") && name.endsWith("#")) {
-	    return false;
-	}
-
-	// openwindows text editor does this I think
-	if (name.startsWith("%") && name.endsWith("%")) {
-	    return false;
-	}
-
-	/* CVS stuff -- hopefully there won't be a case with
-	 * an all cap file/dir named "CVS" that somebody wants
-	 * to keep around...
-	 */
-	
-	if (name.equals("CVS")) {
-	    return false;
-	}
-	
-    /* If we are going to ignore CVS might as well ignore 
-     * this one as well...
-     */
-    if (name.equals(".cvsignore")){
-        return false;
-    }
+        
+        // emacs save file
+        if (name.endsWith("~")) {
+            return false;
+        }
+
+        // emacs autosave file
+        if (name.startsWith("#") && name.endsWith("#")) {
+            return false;
+        }
+
+        // openwindows text editor does this I think
+        if (name.startsWith("%") && name.endsWith("%")) {
+            return false;
+        }
+
+        /* CVS stuff -- hopefully there won't be a case with
+         * an all cap file/dir named "CVS" that somebody wants
+         * to keep around...
+         */
+        
+        if (name.equals("CVS")) {
+            return false;
+        }
+        
+        /* If we are going to ignore CVS might as well ignore 
+         * this one as well...
+         */
+        if (name.equals(".cvsignore")){
+            return false;
+        }
     
-	// default
-	return true;
+        // default
+        return true;
     }
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DirectoryScanner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DirectoryScanner.java
index eb46a77..f2ca44e 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DirectoryScanner.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/DirectoryScanner.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -145,7 +145,7 @@ public class DirectoryScanner implements FileScanner {
         "**/#*#",
         "**/%*%",
         "**/CVS",
-        "**/CVS/*",
+        "**/CVS/**",
         "**/.cvsignore"
     };
 
@@ -736,7 +736,7 @@ strLoop:
              * (2) an IO error occurred (why doesn't it throw an exception 
              *     then???)
              */
-            throw new BuildException("IO error scanning directory"
+            throw new BuildException("IO error scanning directory "
                                      + dir.getAbsolutePath());
         }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/FileScanner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/FileScanner.java
index faa80af..f973ac0 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/FileScanner.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/FileScanner.java
@@ -1,3 +1,56 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.tools.ant;
 
 import java.io.*;
@@ -7,96 +60,96 @@ import java.io.*;
  * directory scanner.
  */
 public interface FileScanner {
-	/**
-	 * Adds an array with default exclusions to the current exclusions set.
-	 *
-	 */
-	public void addDefaultExcludes();
-	/**
-	 * Gets the basedir that is used for scanning. This is the directory that
-	 * is scanned recursively.
-	 *
-	 * @return the basedir that is used for scanning
-	 */
-	public File getBasedir();
-	/**
-	 * Get the names of the directories that matched at least one of the include
-	 * patterns, an matched also at least one of the exclude patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the directories
-	 */
-	public String[] getExcludedDirectories();
-	/**
-	 * Get the names of the files that matched at least one of the include
-	 * patterns, an matched also at least one of the exclude patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the files
-	 */
-	public String[] getExcludedFiles();
-	/**
-	 * Get the names of the directories that matched at least one of the include
-	 * patterns, an matched none of the exclude patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the directories
-	 */
-	public String[] getIncludedDirectories();
-	/**
-	 * Get the names of the files that matched at least one of the include
-	 * patterns, an matched none of the exclude patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the files
-	 */
-	public String[] getIncludedFiles();
-	/**
-	 * Get the names of the directories that matched at none of the include
-	 * patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the directories
-	 */
-	public String[] getNotIncludedDirectories();
-	/**
-	 * Get the names of the files that matched at none of the include patterns.
-	 * The names are relative to the basedir.
-	 *
-	 * @return the names of the files
-	 */
-	public String[] getNotIncludedFiles();
-	/**
-	 * Scans the base directory for files that match at least one include
-	 * pattern, and don't match any exclude patterns.
-	 *
-	 * @exception IllegalStateException when basedir was set incorrecly
-	 */
-	public void scan();
-	/**
-	 * Sets the basedir for scanning. This is the directory that is scanned
-	 * recursively. 
-	 *
-	 * @param basedir the (non-null) basedir for scanning
-	 */
-	public void setBasedir(String basedir);
-	/**
-	 * Sets the basedir for scanning. This is the directory that is scanned
-	 * recursively.
-	 *
-	 * @param basedir the basedir for scanning
-	 */
-	public void setBasedir(File basedir);
-	/**
-	 * Sets the set of exclude patterns to use.
-	 *
-	 * @param excludes list of exclude patterns
-	 */
-	public void setExcludes(String[] excludes);
-	/**
-	 * Sets the set of include patterns to use.
-	 *
-	 * @param includes list of include patterns
-	 */
-	public void setIncludes(String[] includes);
-}
\ No newline at end of file
+    /**
+     * Adds an array with default exclusions to the current exclusions set.
+     *
+     */
+    public void addDefaultExcludes();
+    /**
+     * Gets the basedir that is used for scanning. This is the directory that
+     * is scanned recursively.
+     *
+     * @return the basedir that is used for scanning
+     */
+    public File getBasedir();
+    /**
+     * Get the names of the directories that matched at least one of the include
+     * patterns, an matched also at least one of the exclude patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the directories
+     */
+    public String[] getExcludedDirectories();
+    /**
+     * Get the names of the files that matched at least one of the include
+     * patterns, an matched also at least one of the exclude patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the files
+     */
+    public String[] getExcludedFiles();
+    /**
+     * Get the names of the directories that matched at least one of the include
+     * patterns, an matched none of the exclude patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the directories
+     */
+    public String[] getIncludedDirectories();
+    /**
+     * Get the names of the files that matched at least one of the include
+     * patterns, an matched none of the exclude patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the files
+     */
+    public String[] getIncludedFiles();
+    /**
+     * Get the names of the directories that matched at none of the include
+     * patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the directories
+     */
+    public String[] getNotIncludedDirectories();
+    /**
+     * Get the names of the files that matched at none of the include patterns.
+     * The names are relative to the basedir.
+     *
+     * @return the names of the files
+     */
+    public String[] getNotIncludedFiles();
+    /**
+     * Scans the base directory for files that match at least one include
+     * pattern, and don't match any exclude patterns.
+     *
+     * @exception IllegalStateException when basedir was set incorrecly
+     */
+    public void scan();
+    /**
+     * Sets the basedir for scanning. This is the directory that is scanned
+     * recursively. 
+     *
+     * @param basedir the (non-null) basedir for scanning
+     */
+    public void setBasedir(String basedir);
+    /**
+     * Sets the basedir for scanning. This is the directory that is scanned
+     * recursively.
+     *
+     * @param basedir the basedir for scanning
+     */
+    public void setBasedir(File basedir);
+    /**
+     * Sets the set of exclude patterns to use.
+     *
+     * @param excludes list of exclude patterns
+     */
+    public void setExcludes(String[] excludes);
+    /**
+     * Sets the set of include patterns to use.
+     *
+     * @param includes list of include patterns
+     */
+    public void setIncludes(String[] includes);
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/IntrospectionHelper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/IntrospectionHelper.java
index 8e85afd..e358e37 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/IntrospectionHelper.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/IntrospectionHelper.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Location.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Location.java
index dcd14a5..5562ca3 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Location.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Location.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -55,57 +55,57 @@
 package org.apache.tools.ant;
 
 /**
- *	Stores the file name and line number in a file.
+ * Stores the file name and line number in a file.
  */
 public class Location {
-	private String fileName;
-	private int lineNumber;
-	private int columnNumber;
+    private String fileName;
+    private int lineNumber;
+    private int columnNumber;
 
-	public static final Location UNKNOWN_LOCATION = new Location();
+    public static final Location UNKNOWN_LOCATION = new Location();
 
-	/**
-	 *	Creates an "unknown" location.
-	 */
-	private Location() {
-		this(null, 0, 0);
-	}
+    /**
+     * Creates an "unknown" location.
+     */
+    private Location() {
+        this(null, 0, 0);
+    }
 
-	/**
-	 *	Creates a location consisting of a file name but no line number.
-	 */
-	public Location(String fileName) {
-		this(fileName, 0, 0);
-	}
+    /**
+     * Creates a location consisting of a file name but no line number.
+     */
+    public Location(String fileName) {
+        this(fileName, 0, 0);
+    }
 
-	/**
-	 *	Creates a location consisting of a file name and line number.
-	 */
-	public Location(String fileName, int lineNumber, int columnNumber) {
-		this.fileName = fileName;
-		this.lineNumber = lineNumber;
-		this.columnNumber = columnNumber;
-	}
+    /**
+     * Creates a location consisting of a file name and line number.
+     */
+    public Location(String fileName, int lineNumber, int columnNumber) {
+        this.fileName = fileName;
+        this.lineNumber = lineNumber;
+        this.columnNumber = columnNumber;
+    }
 
-	/**
-	 *	Returns the file name, line number and a trailing space. An error
-	 *	message can be appended easily. For unknown locations, returns
-	 *	an empty string.
-	 */
-	public String toString() {
-		StringBuffer buf = new StringBuffer();
+    /**
+     * Returns the file name, line number and a trailing space. An error
+     * message can be appended easily. For unknown locations, returns
+     * an empty string.
+     */
+    public String toString() {
+        StringBuffer buf = new StringBuffer();
 
-		if (fileName != null) {
-			buf.append(fileName);
+        if (fileName != null) {
+            buf.append(fileName);
 
-			if (lineNumber != 0) {
-				buf.append(":");
-				buf.append(lineNumber);
-			}
+            if (lineNumber != 0) {
+                buf.append(":");
+                buf.append(lineNumber);
+            }
 
-			buf.append(": ");
-		}
+            buf.append(": ");
+        }
 
-		return buf.toString();
-	}
-}
\ No newline at end of file
+        return buf.toString();
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Main.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Main.java
index 53f6268..43a5007 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Main.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Main.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -161,6 +161,8 @@ public class Main {
 
     protected Main(String[] args) throws BuildException {
 
+        String searchForThis = null;
+
         // cycle through given args
 
         for (int i = 0; i < args.length; i++) {
@@ -238,7 +240,7 @@ public class Main {
                 if (posEq > 0) {
                     value = name.substring(posEq+1);
                     name = name.substring(0, posEq);
-                } else if (i < args.length)
+                } else if (i < args.length-1)
                     value = args[++i];
 
                 definedProps.put(name, value);
@@ -253,9 +255,16 @@ public class Main {
             } else if (arg.equals("-projecthelp")) {
                 // set the flag to display the targets and quit
                 projectHelp = true;
+            } else if (arg.equals("-find")) {
+                // eat up next arg if present, default to build.xml
+                if (i < args.length-1) {
+                    searchForThis = args[++i];
+                } else {
+                    searchForThis = DEFAULT_BUILD_FILENAME;
+                }
             } else if (arg.startsWith("-")) {
                 // we don't have any more args to recognize!
-                String msg = "Unknown arg: " + arg;
+                String msg = "Unknown argument: " + arg;
                 System.out.println(msg);
                 printUsage();
                 return;
@@ -267,9 +276,13 @@ public class Main {
         }
 
         // if buildFile was not specified on the command line,
-        // then search for it
         if (buildFile == null) {
-            buildFile = findBuildFile(DEFAULT_BUILD_FILENAME);
+            // but -find then search for it
+            if (searchForThis != null) {
+                buildFile = findBuildFile(".", searchForThis);
+            } else {
+                buildFile = new File(DEFAULT_BUILD_FILENAME);
+            }
         }
 
         // make sure buildfile exists
@@ -289,18 +302,6 @@ public class Main {
         readyToRun = true;
     }
 
-    /**
-     * Helper to get the parent file for a given filename.
-     *
-     * <P>Added to simulate File.getParentFile() from JDK 1.2.
-     *
-     * @param filename  File name
-     * @return          Parent file or null if none
-     */
-    private File getParentFile(String filename) {
-        return getParentFile(new File(filename));
-    }
-
     /**
      * Helper to get the parent file for a given file.
      *
@@ -334,12 +335,12 @@ public class Main {
      *
      * @exception BuildException    Failed to locate a build file
      */
-    private File findBuildFile(String suffix) throws BuildException {
+    private File findBuildFile(String start, String suffix) throws BuildException {
         if (msgOutputLevel >= Project.MSG_INFO) {
             System.out.println("Searching for " + suffix + " ...");
         }
 
-        File parent = getParentFile(suffix);
+        File parent = new File(new File(start).getAbsolutePath());
         File file = new File(parent, suffix);
         
         // check if the target file exists in the current directory
@@ -503,6 +504,8 @@ public class Main {
         msg.append("  -listener <classname>  add an instance of class as a project listener" + lSep);
         msg.append("  -buildfile <file>      use given buildfile" + lSep);
         msg.append("  -D<property>=<value>   use value for given property" + lSep);
+        msg.append("  -find <file>           search for buildfile towards the root of the" + lSep);
+        msg.append("                         filesystem and use it" + lSep);
         System.out.println(msg.toString());
     }
 
@@ -558,11 +561,11 @@ public class Main {
                 int pos = findTargetPosition(topNames, targetName);
                 topNames.insertElementAt(targetName, pos);
                 topDescriptions.insertElementAt(targetDescription, pos);
-            if (targetName.length() > maxLength) {
-                maxLength = targetName.length();
+                if (targetName.length() > maxLength) {
+                    maxLength = targetName.length();
+                }
             }
         }
-        }
         printTargets(topNames, topDescriptions, "Main targets:", maxLength);
         printTargets(subNames, null, "Subtargets:", 0);
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/NoBannerLogger.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/NoBannerLogger.java
new file mode 100644
index 0000000..5a4cbf4
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/NoBannerLogger.java
@@ -0,0 +1,89 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant;
+
+/**
+ * Extends DefaultLogger to strip out empty targets.
+ *
+ * @author <a href="mailto:donaldp@apache.org">Peter Donald</a>
+ */
+public class NoBannerLogger extends DefaultLogger {
+
+    protected String targetName;
+
+    public void targetStarted(BuildEvent event) {
+        targetName = event.getTarget().getName();
+    }
+
+    public void targetFinished(BuildEvent event) {
+        targetName = null;
+    }
+
+    public void messageLogged(BuildEvent event) {
+
+        if( event.getPriority() > msgOutputLevel ||
+                null == event.getMessage() || 
+            "".equals( event.getMessage().trim() ) ) {
+            return;
+        }
+
+        if( null != targetName ) {
+            out.println(lSep + targetName + ":");
+            targetName = null;
+        }
+
+        super.messageLogged( event );
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/PathTokenizer.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/PathTokenizer.java
index 5e59cdd..95daea9 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/PathTokenizer.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/PathTokenizer.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Project.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Project.java
index f82dc95..4219dcd 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Project.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Project.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -107,6 +107,9 @@ public class Project {
 
     private Vector listeners = new Vector();
 
+    private static java.lang.reflect.Method setLastModified = null;
+    private static Object lockReflection = new Object();
+
     static {
 
         // Determine the Java version by looking at available classes
@@ -285,6 +288,7 @@ public class Project {
     }
 
     public void setName(String name) {
+        setUserProperty("ant.project.name",  name);
         this.name = name;
     }
 
@@ -316,7 +320,7 @@ public class Project {
 
     public void setBaseDir(File baseDir) {
         this.baseDir = baseDir;
-	setProperty( "basedir", baseDir.getAbsolutePath());
+        setProperty( "basedir", baseDir.getAbsolutePath());
         String msg = "Project base dir set to: " + baseDir;
         log(msg, MSG_VERBOSE);
     }
@@ -429,7 +433,7 @@ public class Project {
     public Task createTask(String taskType) throws BuildException {
         Class c = (Class) taskClassDefinitions.get(taskType);
 
-	if (c == null)
+        if (c == null)
             return null;
         try {
             Object o = c.newInstance();
@@ -462,7 +466,7 @@ public class Project {
     public Object createDataType(String typeName) throws BuildException {
         Class c = (Class) dataClassDefinitions.get(typeName);
 
-	if (c == null)
+        if (c == null)
             return null;
 
         try {
@@ -671,6 +675,22 @@ public class Project {
                  overwrite);
     }
 
+     /**
+     * Convienence method to copy a file from a source to a
+     * destination specifying if token filtering must be used, if
+     * source files may overwrite newer destination files and the
+     * last modified time of <code>destFile</code> file should be made equal
+     * to the last modified time of <code>sourceFile</code>.
+     *
+     * @throws IOException 
+     */
+    public void copyFile(String sourceFile, String destFile, boolean filtering,
+                         boolean overwrite, boolean preserveLastModified)
+        throws IOException {
+        copyFile(new File(sourceFile), new File(destFile), filtering, 
+                 overwrite, preserveLastModified);
+    }
+
     /**
      * Convienence method to copy a file from a source to a destination.
      * No filtering is performed.
@@ -688,8 +708,7 @@ public class Project {
      * @throws IOException
      */
     public void copyFile(File sourceFile, File destFile, boolean filtering)
-        throws IOException
-    {
+        throws IOException {
         copyFile(sourceFile, destFile, filtering, false);
     }
 
@@ -702,10 +721,25 @@ public class Project {
      */
     public void copyFile(File sourceFile, File destFile, boolean filtering,
                          boolean overwrite) throws IOException {
+        copyFile(sourceFile, destFile, filtering, overwrite, false);
+    }
 
+    /**
+     * Convienence method to copy a file from a source to a
+     * destination specifying if token filtering must be used, if
+     * source files may overwrite newer destination files and the
+     * last modified time of <code>destFile</code> file should be made equal
+     * to the last modified time of <code>sourceFile</code>.
+     *
+     * @throws IOException 
+     */
+    public void copyFile(File sourceFile, File destFile, boolean filtering,
+                         boolean overwrite, boolean preserveLastModified)
+        throws IOException {
+        
         if (overwrite ||
             destFile.lastModified() < sourceFile.lastModified()) {
-            log("Copy: " + sourceFile.getAbsolutePath() + " > "
+            log("Copy: " + sourceFile.getAbsolutePath() + " -> "
                     + destFile.getAbsolutePath(), MSG_VERBOSE);
 
             // ensure that parent dir of dest file exists!
@@ -749,6 +783,52 @@ public class Project {
                 in.close();
                 out.close();
             }
+
+            if (preserveLastModified) {
+                setFileLastModified(destFile, sourceFile.lastModified());
+            }
+        }
+    }
+
+    /**
+     * Calls File.setLastModified(long time) in a Java 1.1 compatible way.
+     */
+    void setFileLastModified(File file, long time) throws BuildException {
+        if (getJavaVersion() == JAVA_1_1) {
+            log("Cannot change the modification time of " + file
+                + " in JDK 1.1", Project.MSG_WARN);
+            return;
+        }
+        if (setLastModified == null) {
+            synchronized (lockReflection) {
+                if (setLastModified == null) {
+                    try {
+                        setLastModified = 
+                            java.io.File.class.getMethod("setLastModified", 
+                                                         new Class[] {Long.TYPE});
+                    } catch (NoSuchMethodException nse) {
+                        throw new BuildException("File.setlastModified not in JDK > 1.1?",
+                                                 nse);
+                    }
+                }
+            }
+        }
+        Long[] times = new Long[1];
+        if (time < 0) {
+            times[0] = new Long(System.currentTimeMillis());
+        } else {
+            times[0] = new Long(time);
+        }
+        try {
+            log("Setting modification time for " + file, MSG_VERBOSE);
+            setLastModified.invoke(file, times);
+        } catch (java.lang.reflect.InvocationTargetException ite) {
+            Throwable nested = ite.getTargetException();
+            throw new BuildException("Exception setting the modification time "
+                                     + "of " + file, nested);
+        } catch (Throwable other) {
+            throw new BuildException("Exception setting the modification time "
+                                     + "of " + file, other);
         }
     }
 
@@ -835,7 +915,7 @@ public class Project {
      * @exception BuildException if there is a cyclic dependency among the
      * Targets, or if a Target does not exist.
      */
-    private final Vector topoSort(String root, Hashtable targets)
+    public final Vector topoSort(String root, Hashtable targets)
         throws BuildException {
         Vector ret = new Vector();
         Hashtable state = new Hashtable();
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/ProjectHelper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/ProjectHelper.java
index 027b33c..5e60d1a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/ProjectHelper.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/ProjectHelper.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -98,10 +98,23 @@ public class ProjectHelper {
      * Parses the project file.
      */
     private void parse() throws BuildException {
+        FileInputStream inputStream = null;
+        InputSource inputSource = null;
+        
         try {
             SAXParser saxParser = getParserFactory().newSAXParser();
             parser = saxParser.getParser();
-            saxParser.parse(buildFile, new RootHandler());
+
+            String uri = "file:" + buildFile.getAbsolutePath().replace('\\', '/');
+            for (int index = uri.indexOf('#'); index != -1; index = uri.indexOf('#')) {
+                uri = uri.substring(0, index) + "%23" + uri.substring(index+1);
+            }
+            
+            inputStream = new FileInputStream(buildFile);
+            inputSource = new InputSource(inputStream);
+            inputSource.setSystemId(uri);
+            project.log("parsing buildfile " + buildFile + " with URI = " + uri, Project.MSG_VERBOSE);
+            saxParser.parse(inputSource, new RootHandler());
         }
         catch(ParserConfigurationException exc) {
             throw new BuildException("Parser has not been configured correctly", exc);
@@ -134,6 +147,16 @@ public class ProjectHelper {
         catch(IOException exc) {
             throw new BuildException("Error reading project file", exc);
         }
+        finally {
+            if (inputStream != null) {
+                try {
+                    inputStream.close();
+                }
+                catch (IOException ioe) {
+                    // ignore this
+                }
+            }
+        }
     }
 
     /**
@@ -170,8 +193,15 @@ public class ProjectHelper {
             }
         }
 
+        /**
+         * Called when this element and all elements nested into it have been
+         * handeled.
+         */
+        protected void finished() {}
+
         public void endElement(String name) throws SAXException {
 
+            finished();
             // Let parent resume handling SAX events
             parser.setDocumentHandler(parentHandler);
         }
@@ -187,16 +217,37 @@ public class ProjectHelper {
          */
         public InputSource resolveEntity(String publicId,
                                          String systemId) {
-
+        
+            project.log("resolving systemId: " + systemId, Project.MSG_VERBOSE);
+        
             if (systemId.startsWith("file:")) {
                 String path = systemId.substring(5);
+                int index = path.indexOf("file:");
+                
+                // we only have to handle these for backward compatibility
+                // since they are in the FAQ.
+                while (index != -1) {
+                    path = path.substring(0, index) + path.substring(index + 5);
+                    index = path.indexOf("file:");
+                }
+                
+                String entitySystemId = path;
+                index = path.indexOf("%23");
+                // convert these to #
+                while (index != -1) {
+                    path = path.substring(0, index) + "#" + path.substring(index + 3);
+                    index = path.indexOf("%23");
+                }
+
                 File file = new File(path);
                 if (!file.isAbsolute()) {
                     file = new File(buildFileParent, path);
                 }
                 
                 try {
-                    return new InputSource(new FileInputStream(file));
+                    InputSource inputSource = new InputSource(new FileInputStream(file));
+                    inputSource.setSystemId("file:" + entitySystemId);
+                    return inputSource;
                 } catch (FileNotFoundException fne) {
                     project.log(file.getAbsolutePath()+" could not be found", 
                                 Project.MSG_WARN);
@@ -250,10 +301,18 @@ public class ProjectHelper {
                 }
             }
 
+            if (def == null) {
+                throw new SAXParseException("The default attribute of project is required", 
+                                            locator);
+            }
+            
+
             project.setDefaultTarget(def);
 
-            project.setName(name);
-            if (name != null) project.addReference(name, project);
+            if (name != null) {
+                project.setName(name);
+                project.addReference(name, project);
+            }
 
             if (id != null) project.addReference(id, project);
 
@@ -289,11 +348,11 @@ public class ProjectHelper {
         }
 
         private void handleTaskdef(String name, AttributeList attrs) throws SAXParseException {
-            new TaskHandler(this, null).init(name, attrs);
+            (new TaskHandler(this, null)).init(name, attrs);
         }
 
         private void handleProperty(String name, AttributeList attrs) throws SAXParseException {
-            new TaskHandler(this, null).init(name, attrs);
+            (new TaskHandler(this, null)).init(name, attrs);
         }
 
         private void handleTarget(String tag, AttributeList attrs) throws SAXParseException {
@@ -303,6 +362,7 @@ public class ProjectHelper {
         private void handleDataType(String name, AttributeList attrs) throws SAXParseException {
             new DataTypeHandler(this).init(name, attrs);
         }
+
     }
 
     /**
@@ -414,6 +474,11 @@ public class ProjectHelper {
             } else {
                 task.init();
                 configure(task, attrs, project);
+            }
+        }
+
+        protected void finished() {
+            if (task != null && target == null) {
                 task.execute();
             }
         }
@@ -548,7 +613,7 @@ public class ProjectHelper {
 
         for (int i = 0; i < attrs.getLength(); i++) {
             // reflect these into the target
-            String value=replaceProperties(attrs.getValue(i), 
+            String value=replaceProperties(project, attrs.getValue(i), 
                                            project.getProperties() );
             try {
                 ih.setAttribute(project, target, 
@@ -590,7 +655,7 @@ public class ProjectHelper {
 
     /** Replace ${NAME} with the property value
      */
-    public static String replaceProperties( String value, Hashtable keys )
+    public static String replaceProperties(Project project, String value, Hashtable keys )
         throws BuildException
     {
         // XXX use Map instead of proj, it's too heavy
@@ -619,8 +684,12 @@ public class ProjectHelper {
                                              value );
                 }
                 String n=value.substring( pos+2, endName );
-                String v= (keys.containsKey(n)) ? (String) keys.get( n ) 
-                    : "${"+n+"}";
+                if (!keys.containsKey(n)) {
+                    project.log("Property ${" + n + "} has not been set", Project.MSG_VERBOSE);
+                }
+                
+                String v = (keys.containsKey(n)) ? (String) keys.get(n) : "${"+n+"}"; 
+                
                 //System.out.println("N: " + n + " " + " V:" + v);
                 sb.append( v );
                 prev=endName+1;
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/RuntimeConfigurable.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/RuntimeConfigurable.java
index cec31e1..998ed84 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/RuntimeConfigurable.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/RuntimeConfigurable.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Target.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Target.java
index 92a6351..7ce29bd 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Target.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Target.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -102,6 +102,17 @@ public class Target {
         tasks.addElement(task);
     }
 
+	/** 
+	 * Get the current set of tasks to be executed by this target.
+	 * 
+     * @return The current set of tasks.
+	 */
+    public Task[] getTasks() {
+        Task[] retval = new Task[tasks.size()];
+        tasks.copyInto(retval);
+        return retval;
+    }
+
     public void addDependency(String dependency) {
         dependencies.addElement(dependency);
     }
@@ -139,9 +150,9 @@ public class Target {
                 try {
                     project.fireTaskStarted(task);
                     task.maybeConfigure();
-               	    task.execute();
+                    task.execute();
                     project.fireTaskFinished(task, null);
-		}
+                }
                 catch(RuntimeException exc) {
                     if (exc instanceof BuildException) {
                         BuildException be = (BuildException) exc;
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Task.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Task.java
index e7e5eaa..563eb86 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Task.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Task.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -160,26 +160,29 @@ public abstract class Task {
      *  what we are doing.
      */
     public void setDescription( String desc ) {
-	description=desc;
+        description=desc;
     }
 
     public String getDescription() {
-	return description;
+        return description;
     }
 
     /**
-     * Called by the project to let the task initialize properly. Normally it does nothing.
+     * Called by the project to let the task initialize properly. 
      *
      * @throws BuildException if someting goes wrong with the build
      */
     public void init() throws BuildException {}
 
     /**
-     * Called by the project to let the task do it's work. Normally it does nothing.
+     * Called by the project to let the task do it's work. This method may be 
+     * called more than once, if the task is invoked more than once. For example, 
+     * if target1 and target2 both depend on target3, then running 
+     * "ant target1 target2" will run all tasks in target3 twice.
      *
      * @throws BuildException if someting goes wrong with the build
      */
-    public void execute() throws BuildException {};
+    public void execute() throws BuildException {}
 
     /**
      * Returns the file location where this task was defined.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/TaskAdapter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/TaskAdapter.java
index 852efae..557bc14 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/TaskAdapter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/TaskAdapter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -71,20 +71,20 @@ public class TaskAdapter extends Task {
      * Do the execution.
      */
     public void execute() throws BuildException {
-	Method executeM=null;
-	try {
-	    Class c=proxy.getClass();
-	    executeM=c.getMethod( "execute", new Class[0] );
-	    if( executeM == null ) {
-		log("No execute in " + proxy.getClass(), Project.MSG_ERR);
-		throw new BuildException("No execute in " + proxy.getClass());
-	    }
-	    executeM.invoke(proxy, null);
-	    return; 
-	} catch( Exception ex ) {
-	    log("Error in " + proxy.getClass(), Project.MSG_ERR);
-	    throw new BuildException( ex );
-	}
+        Method executeM=null;
+        try {
+            Class c=proxy.getClass();
+            executeM=c.getMethod( "execute", new Class[0] );
+            if( executeM == null ) {
+                log("No execute in " + proxy.getClass(), Project.MSG_ERR);
+                throw new BuildException("No execute in " + proxy.getClass());
+            }
+            executeM.invoke(proxy, null);
+            return; 
+        } catch( Exception ex ) {
+            log("Error in " + proxy.getClass(), Project.MSG_ERR);
+            throw new BuildException( ex );
+        }
 
     }
     
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/UnknownElement.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/UnknownElement.java
index 1aa8c4b..c3f130f 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/UnknownElement.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/UnknownElement.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -82,12 +82,14 @@ public class UnknownElement extends Task {
     public void maybeConfigure() throws BuildException {
         realTask = project.createTask(elementName);
         if (realTask == null) {
-            throw new BuildException("Could not create task of type: "+elementName+
-                                     " because I can\'t find it in the list of task"+
-                                     " class definitions.  Common solutions are: 1"+
-                                     " execute bin/bootstrap. 2 use taskdef to declare"+
-                                     " your task. 3 add the task to defaults.properties."
-                                     , location);
+            log("Could not create task of type: " + elementName + " Common solutions" +
+                " are adding the task to defaults.properties and executing bin/bootstrap",
+                Project.MSG_DEBUG);
+            throw new BuildException("Could not create task of type: " + elementName +
+                                     ". Common solutions are to use taskdef to declare" +
+                                     " your task, or, if this is an optional task," +
+                                     " to put the optional.jar in the lib directory of" +
+                                     " your ant installation (ANT_HOME).", location);
         }
 
         realTask.setLocation(location);
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/XmlLogger.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/XmlLogger.java
index 34580ef..96b9ea2 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/XmlLogger.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/XmlLogger.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -58,6 +58,7 @@ import java.io.*;
 import java.util.*;
 import javax.xml.parsers.*;
 import org.w3c.dom.*;
+import org.apache.tools.ant.util.DOMElementWriter;
 
 /**
  *  Generates a "log.xml" file in the current directory with
@@ -134,7 +135,7 @@ public class XmlLogger implements BuildListener {
 
             Writer out = new FileWriter(outFilename);
             out.write("<?xml:stylesheet type=\"text/xsl\" href=\"log.xsl\"?>\n\n");
-            write(buildElement, out, 0);
+            (new DOMElementWriter()).write(buildElement, out, 0, "\t");
             out.flush();
             out.close();
             
@@ -228,63 +229,4 @@ public class XmlLogger implements BuildListener {
         }
     }
 
-    /**
-     *  Writes a DOM element to a file.
-     */
-    private static void write(Element element, Writer out, int indent) throws IOException {
-
-        // Write indent characters
-        for (int i = 0; i < indent; i++) {
-            out.write("\t");
-        }
-
-        // Write element
-        out.write("<");
-        out.write(element.getTagName());
-
-        // Write attributes
-        NamedNodeMap attrs = element.getAttributes();
-        for (int i = 0; i < attrs.getLength(); i++) {
-            Attr attr = (Attr) attrs.item(i);
-            out.write(" ");
-            out.write(attr.getName());
-            out.write("=\"");
-            out.write(attr.getValue());
-            out.write("\"");
-        }
-        out.write(">");
-
-        // Write child attributes and text
-        boolean hasChildren = false;
-        NodeList children = element.getChildNodes();
-        for (int i = 0; i < children.getLength(); i++) {
-            Node child = children.item(i);
-
-            if (child.getNodeType() == Node.ELEMENT_NODE) {
-                if (!hasChildren) {
-                    out.write("\n");
-                    hasChildren = true;
-                }
-                write((Element)child, out, indent + 1);
-            }
-
-            if (child.getNodeType() == Node.TEXT_NODE) {
-                out.write(((Text)child).getData());
-            }
-        }
-
-        // If we had child elements, we need to indent before we close
-        // the element, otherwise we're on the same line and don't need
-        // to indent
-        if (hasChildren) {
-            for (int i = 0; i < indent; i++) {
-                out.write("\t");
-            }
-        }
-
-        // Write element close
-        out.write("</");
-        out.write(element.getTagName());
-        out.write(">\n");
-    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Ant.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Ant.java
index db406f7..bc78c5f 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Ant.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Ant.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -238,9 +238,9 @@ public class Ant extends Task {
             reinit();
         }
 
-	Property p=(Property)p1.createTask("property");
-	p.setUserProperty(true);
-	properties.addElement( p );
-	return p;
+        Property p=(Property)p1.createTask("property");
+        p.setUserProperty(true);
+        properties.addElement( p );
+        return p;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/AntStructure.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/AntStructure.java
index 1c18722..4c632eb 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/AntStructure.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/AntStructure.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Available.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Available.java
index ae77885..0ff188a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Available.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Available.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * Copyright (c) 1999-2001 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -129,9 +129,20 @@ public class Available extends Task {
             this.loader = new AntClassLoader(project, classpath, false);
         }
 
-        if ((classname != null) && !checkClass(classname)) return;
-        if ((file != null) && !checkFile(file)) return;
-        if ((resource != null) && !checkResource(resource)) return;
+        if ((classname != null) && !checkClass(classname)) {
+            log("Unable to load class " + classname + " to set property " + property, Project.MSG_VERBOSE);
+            return;
+        }
+        
+        if ((file != null) && !checkFile(file)) {
+            log("Unable to find file " + file + " to set property " + property, Project.MSG_VERBOSE);
+            return;
+        }
+        
+        if ((resource != null) && !checkResource(resource)) {
+            log("Unable to load resource " + resource + " to set property " + property, Project.MSG_VERBOSE);
+            return;
+        }
 
         this.project.setProperty(property, value);
     }
@@ -144,7 +155,13 @@ public class Available extends Task {
         if (loader != null) {
             return (loader.getResourceAsStream(resource) != null);
         } else {
-            return (this.getClass().getResourceAsStream(resource) != null);
+            ClassLoader cL = this.getClass().getClassLoader();
+            if (cL != null) {
+                return (cL.getResourceAsStream(resource) != null);
+            } else {
+                return 
+                    (ClassLoader.getSystemResourceAsStream(resource) != null);
+            }
         }
     }
 
@@ -164,7 +181,8 @@ public class Available extends Task {
             }
             return true;
         } catch (ClassNotFoundException e) {
-            log(e.toString(), Project.MSG_VERBOSE);
+            return false;
+        } catch (NoClassDefFoundError e) {
             return false;
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CallTarget.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CallTarget.java
index b6dd416..f767bb8 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CallTarget.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CallTarget.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Chmod.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Chmod.java
index b7a6f69..21d07e4 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Chmod.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Chmod.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CompileTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CompileTask.java
index ddc936c..ee50300 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CompileTask.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/CompileTask.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copy.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copy.java
index 3d947e7..6a94a8a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copy.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copy.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -56,6 +56,7 @@ package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
 import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.util.*;
 
 import java.io.*;
 import java.util.*;
@@ -71,6 +72,7 @@ import java.util.*;
  * copyfile/copydir tasks.</p>
  *
  * @author Glenn McAllister <a href="mailto:glennm@ca.ibm.com">glennm@ca.ibm.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 public class Copy extends Task {
     protected File file = null;     // the source file 
@@ -79,6 +81,7 @@ public class Copy extends Task {
     protected Vector filesets = new Vector();
 
     protected boolean filtering = false;
+    protected boolean preserveLastModified = false;
     protected boolean forceOverwrite = false;
     protected boolean flatten = false;
     protected int verbosity = Project.MSG_VERBOSE;
@@ -87,6 +90,8 @@ public class Copy extends Task {
     protected Hashtable fileCopyMap = new Hashtable();
     protected Hashtable dirCopyMap = new Hashtable();
 
+    protected Mapper mapperElement = null;
+
     /**
      * Sets a single source file to copy.
      */
@@ -108,6 +113,13 @@ public class Copy extends Task {
         this.destDir = destDir;
     }
 
+    /**
+     * Give the copied files the same last modified time as the original files.
+     */
+    public void setPreserveLastModified(String preserve) {
+        preserveLastModified = Project.toBoolean(preserve);
+    }
+
     /**
      * Sets filtering.
      */
@@ -158,6 +170,18 @@ public class Copy extends Task {
         filesets.addElement(set);
     }
 
+    /**
+     * Defines the FileNameMapper to use (nested mapper element).
+     */
+    public Mapper createMapper() throws BuildException {
+        if (mapperElement != null) {
+            throw new BuildException("Cannot define more than one mapper",
+                                     location);
+        }
+        mapperElement = new Mapper(project);
+        return mapperElement;
+    }
+
     /**
      * Performs the copy operation.
      */
@@ -167,13 +191,17 @@ public class Copy extends Task {
 
         // deal with the single file
         if (file != null) {
-            if (destFile == null) {
-                destFile = new File(destDir, file.getName());
-            }
-
-            if (forceOverwrite || 
-                (file.lastModified() > destFile.lastModified())) {
-                fileCopyMap.put(file.getAbsolutePath(), destFile.getAbsolutePath());
+            if (file.exists()) {
+                if (destFile == null) {
+                    destFile = new File(destDir, file.getName());
+                }
+                
+                if (forceOverwrite || 
+                    (file.lastModified() > destFile.lastModified())) {
+                    fileCopyMap.put(file.getAbsolutePath(), destFile.getAbsolutePath());
+                }
+            } else {
+                log("Could not find file " + file.getAbsolutePath() + " to copy.");
             }
         }
 
@@ -240,36 +268,44 @@ public class Copy extends Task {
      * copied.
      */
     protected void scan(File fromDir, File toDir, String[] files, String[] dirs) {
-        for (int i = 0; i < files.length; i++) {
-            String filename = files[i];
-            File src = new File(fromDir, filename);
-            File dest;
-            if (flatten) {
-                dest = new File(toDir, new File(filename).getName());
-            } else {
-                dest = new File(toDir, filename);
-            }
-            if (forceOverwrite ||
-                (src.lastModified() > dest.lastModified())) {
-                fileCopyMap.put(src.getAbsolutePath(),
-                                 dest.getAbsolutePath());
-            }
+        FileNameMapper mapper = null;
+        if (mapperElement != null) {
+            mapper = mapperElement.getImplementation();
+        } else if (flatten) {
+            mapper = new FlatFileNameMapper();
+        } else {
+            mapper = new IdentityMapper();
         }
 
+        buildMap(fromDir, toDir, files, mapper, fileCopyMap);
+
         if (includeEmpty) {
-            for (int i = 0; i < dirs.length; i++) {
-                String dname = dirs[i];
-                File sd = new File(fromDir, dname);
-                File dd;
-                if (flatten) {
-                    dd = new File(toDir, new File(dname).getName());
-                } else {
-                    dd = new File(toDir, dname);
-                }
-                if (forceOverwrite || (sd.lastModified() > dd.lastModified())) {
-                    dirCopyMap.put(sd.getAbsolutePath(), dd.getAbsolutePath());
+            buildMap(fromDir, toDir, dirs, mapper, dirCopyMap);
+        }
+    }
+
+    protected void buildMap(File fromDir, File toDir, String[] names,
+                            FileNameMapper mapper, Hashtable map) {
+
+        String[] toCopy = null;
+        if (forceOverwrite) {
+            Vector v = new Vector();
+            for (int i=0; i<names.length; i++) {
+                if (mapper.mapFileName(names[i]) != null) {
+                    v.addElement(names[i]);
                 }
             }
+            toCopy = new String[v.size()];
+            v.copyInto(toCopy);
+        } else {
+            SourceFileScanner ds = new SourceFileScanner(this);
+            toCopy = ds.restrict(names, fromDir, toDir, mapper);
+        }
+        
+        for (int i = 0; i < toCopy.length; i++) {
+            File src = new File(fromDir, toCopy[i]);
+            File dest = new File(toDir, mapper.mapFileName(toCopy[i])[0]);
+            map.put( src.getAbsolutePath(), dest.getAbsolutePath() );
         }
     }
 
@@ -279,20 +315,28 @@ public class Copy extends Task {
      */
     protected void doFileOperations() {
         if (fileCopyMap.size() > 0) {
-            log("Copying " + fileCopyMap.size() + " files to " + 
-                destDir.getAbsolutePath() );
+            log("Copying " + fileCopyMap.size() + 
+                " file" + (fileCopyMap.size() == 1 ? "" : "s") + 
+                " to " + destDir.getAbsolutePath() );
 
             Enumeration e = fileCopyMap.keys();
             while (e.hasMoreElements()) {
                 String fromFile = (String) e.nextElement();
                 String toFile = (String) fileCopyMap.get(fromFile);
 
+                if( fromFile.equals( toFile ) ) {
+                    log("Skipping self-copy of " + fromFile, verbosity);
+                    continue;
+                }
+
                 try {
                     log("Copying " + fromFile + " to " + toFile, verbosity);
+                    
                     project.copyFile(fromFile, 
                                      toFile, 
                                      filtering, 
-                                     forceOverwrite);
+                                     forceOverwrite,
+                                     preserveLastModified);
                 } catch (IOException ioe) {
                     String msg = "Failed to copy " + fromFile + " to " + toFile
                         + " due to " + ioe.getMessage();
@@ -316,7 +360,10 @@ public class Copy extends Task {
             }
 
             if (count > 0) {
-                log("Copied " + count + " empty directories to " + destDir.getAbsolutePath());
+                log("Copied " + count + 
+                    " empty director" + 
+                    (count==1?"y":"ies") + 
+                    " to " + destDir.getAbsolutePath());
             }
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copydir.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copydir.java
index 2e5643a..68ffbf1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copydir.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copydir.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,10 +54,9 @@
 
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
-
 import java.io.*;
 import java.util.*;
+import org.apache.tools.ant.*;
 
 /**
  * Copies a directory.
@@ -84,16 +83,16 @@ public class Copydir extends MatchingTask {
         destDir = dest;
     }
 
-    public void setFiltering(String filter) {
-        filtering = Project.toBoolean(filter);
+    public void setFiltering(boolean filter) {
+        filtering = filter;
     }
 
     public void setFlatten(boolean flatten) {
         this.flatten = flatten;
     }
 
-    public void setForceoverwrite(String force) {
-        forceOverwrite = Project.toBoolean(force);
+    public void setForceoverwrite(boolean force) {
+        forceOverwrite = force;
     }
 
     public void execute() throws BuildException {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copyfile.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copyfile.java
index 97b8cdd..4e363d0 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copyfile.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Copyfile.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,10 +54,9 @@
 
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
-
 import java.io.*;
 import java.util.*;
+import org.apache.tools.ant.*;
 
 /**
  * Copies a file.
@@ -78,8 +77,8 @@ public class Copyfile extends Task {
         srcFile = src;
     }
 
-    public void setForceoverwrite(String force) {
-        forceOverwrite = Project.toBoolean(force);
+    public void setForceoverwrite(boolean force) {
+        forceOverwrite = force;
     }
 
     public void setDest(File dest) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Cvs.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Cvs.java
index cbfcce5..736ef95 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Cvs.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Cvs.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Delete.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Delete.java
index 5af6365..495f480 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Delete.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Delete.java
@@ -1,37 +1,37 @@
 /*
  * The Apache Software License, Version 1.1
- * 
- * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
  * reserved.
- * 
+ *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
  * are met:
- * 
+ *
  * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- * 
+ *    notice, this list of conditions and the following disclaimer. 
+ *
  * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- * 
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
  * 3. The end-user documentation included with the redistribution, if
- * any, must include the following acknowlegement:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowlegement may appear in the software itself,
- * if and wherever such third-party acknowlegements normally appear.
- * 
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
- * Foundation" must not be used to endorse or promote products derived
- * from this software without prior written permission. For written
- * permission, please contact apache@apache.org.
- * 
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
  * 5. Products derived from this software may not be called "Apache"
- * nor may "Apache" appear in their names without prior written
- * permission of the Apache Group.
- * 
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
@@ -45,12 +45,13 @@
  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  * SUCH DAMAGE.
  * ====================================================================
- * 
+ *
  * This software consists of voluntary contributions made by many
  * individuals on behalf of the Apache Software Foundation.  For more
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
@@ -68,17 +69,20 @@ import java.util.*;
  * to provide backwards compatibility for a release.  The future position
  * is to use nested filesets exclusively.</p>
  * 
- * @author stefano@apache.org
+ * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
  * @author Tom Dimock <a href="mailto:tad1@cornell.edu">tad1@cornell.edu</a>
  * @author Glenn McAllister <a href="mailto:glennm@ca.ibm.com">glennm@ca.ibm.com</a>
+ * @author Jon S. Stevens <a href="mailto:jon@latchkey.com">jon@latchkey.com</a>
  */
 public class Delete extends MatchingTask {
     protected File file = null;
     protected File dir = null;
     protected Vector filesets = new Vector();
     protected boolean usedMatchingTask = false;
+    protected boolean includeEmpty = false;	// by default, remove matching empty dirs
 
     private int verbosity = Project.MSG_VERBOSE;
+    private boolean quiet = false;
 
     /**
      * Set the name of a single file to be removed.
@@ -112,6 +116,26 @@ public class Delete extends MatchingTask {
     } 
 
     /**
+     * If the file does not exist, do not display a diagnostic 
+     * message or modify the exit status to reflect an error.
+     * This means that if a file or directory cannot be deleted,
+     * then no error is reported. This setting emulates the 
+     * -f option to the Unix &quot;rm&quot; command.
+     * Default is false meaning things are &quot;noisy&quot;
+     * @param quiet "true" or "on"
+     */
+    public void setQuiet(boolean quiet) {
+        this.quiet = quiet;
+    } 
+
+    /**
+     * Used to delete empty directories.
+     */
+    public void setIncludeEmptyDirs(boolean includeEmpty) {
+        this.includeEmpty = includeEmpty;
+    }
+
+   /**
      * Adds a set of files (nested fileset attribute).
      */
     public void addFileset(FileSet set) {
@@ -218,7 +242,7 @@ public class Delete extends MatchingTask {
                 } else {
                     log("Deleting: " + file.getAbsolutePath());
   
-                    if (!file.delete()) {
+                    if (!file.delete() && !quiet) {
                         throw new BuildException("Unable to delete file " + file.getAbsolutePath());
                     } 
                 } 
@@ -229,7 +253,15 @@ public class Delete extends MatchingTask {
 
         // delete the directory
         if (dir != null && dir.exists() && dir.isDirectory() && !usedMatchingTask) {
-            log("Deleting directory " + dir.getAbsolutePath());
+            /*
+               If verbosity is MSG_VERBOSE, that mean we are doing regular logging
+               (backwards as that sounds).  In that case, we want to print one 
+               message about deleting the top of the directory tree.  Otherwise, 
+               the removeDir method will handle messages for _all_ directories.
+             */
+            if (verbosity == Project.MSG_VERBOSE) {
+                log("Deleting directory " + dir.getAbsolutePath());
+            }
             removeDir(dir);
         }
 
@@ -238,14 +270,16 @@ public class Delete extends MatchingTask {
             FileSet fs = (FileSet) filesets.elementAt(i);
             DirectoryScanner ds = fs.getDirectoryScanner(project);
             String[] files = ds.getIncludedFiles();
-            removeFiles(fs.getDir(project), files);
+            String[] dirs = ds.getIncludedDirectories();
+            removeFiles(fs.getDir(project), files, dirs);
         }
 
         // delete the files from the default fileset
         if (usedMatchingTask && dir != null) {
             DirectoryScanner ds = super.getDirectoryScanner(dir);
-            String [] files = ds.getIncludedFiles();
-            removeFiles(dir, files);
+            String[] files = ds.getIncludedFiles();
+            String[] dirs = ds.getIncludedDirectories();
+            removeFiles(dir, files, dirs);
         }
     } 
 
@@ -255,6 +289,7 @@ public class Delete extends MatchingTask {
 
     protected void removeDir(File d) {
         String[] list = d.list();
+        if (list == null) list = new String[0];
         for (int i = 0; i < list.length; i++) {
             String s = list[i];
             File f = new File(d, s);
@@ -262,28 +297,50 @@ public class Delete extends MatchingTask {
                 removeDir(f);
             } else {
                 log("Deleting " + f.getAbsolutePath(), verbosity);
-                if (!f.delete()) {
+                if (!f.delete() && !quiet) {
                     throw new BuildException("Unable to delete file " + f.getAbsolutePath());
                 }
             }
         }
         log("Deleting directory " + d.getAbsolutePath(), verbosity);
-        if (!d.delete()) {
+        if (!d.delete() && !quiet) {
             throw new BuildException("Unable to delete directory " + dir.getAbsolutePath());
         }
     }
 
-    protected void removeFiles(File d, String[] files) {
+    protected void removeFiles(File d, String[] files, String[] dirs) {
         if (files.length > 0) {
             log("Deleting " + files.length + " files from " + d.getAbsolutePath());
             for (int j=0; j<files.length; j++) {
                 File f = new File(d, files[j]);
                 log("Deleting " + f.getAbsolutePath(), verbosity);
-                if (!f.delete()) {
+                if (!f.delete() && !quiet) {
                     throw new BuildException("Unable to delete file " + f.getAbsolutePath());
                 }
             }
         }
+
+        if (dirs.length > 0 && includeEmpty) {
+            int dirCount = 0;
+            for (int j=0; j<dirs.length; j++) {
+                File dir = new File(d, dirs[j]);
+                String[] dirFiles = dir.list();
+                if (dirFiles == null || dirFiles.length == 0) {
+                    log("Deleting " + dir.getAbsolutePath(), verbosity);
+                    if (!dir.delete() && !quiet) {
+                        throw new BuildException("Unable to delete directory " + dir.getAbsolutePath());
+                    } else {
+                        dirCount++;
+                    }
+                }
+            }
+
+            if (dirCount > 0) {
+                log("Deleted " + dirCount + " director" + 
+                    (dirCount==1 ? "y" : "ies") + 
+                    " from " + d.getAbsolutePath());
+            }
+        }
     }
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Deltree.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Deltree.java
index 751f4cd..0c81a23 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Deltree.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Deltree.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Echo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Echo.java
index 8c480fd..6f881dd 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Echo.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Echo.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,6 +55,7 @@
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.EnumeratedAttribute;
 import java.io.*;
 /**
  * Echo
@@ -62,9 +63,12 @@ import java.io.*;
  * @author costin@dnt.ro
  */
 public class Echo extends Task {
-    private String message = ""; // required
-    private File file = null;
-    private boolean append = false;
+    protected String message = ""; // required
+    protected File file = null;
+    protected boolean append = false;
+    
+    // by default, messages are always displayed
+    protected int logLevel = Project.MSG_WARN;   
     
     /**
      * Does the work.
@@ -73,7 +77,7 @@ public class Echo extends Task {
      */
     public void execute() throws BuildException {
         if (file == null) {
-            System.out.println(message);
+            log(message, logLevel);
         } else {
             FileWriter out = null;
             try {
@@ -97,7 +101,7 @@ public class Echo extends Task {
      * @param msg Sets the value for the message variable.
      */
     public void setMessage(String msg) {
-	this.message = msg;
+        this.message = msg;
     }
 
     /**
@@ -119,6 +123,40 @@ public class Echo extends Task {
      */
     public void addText(String msg) {
         message += 
-            ProjectHelper.replaceProperties(msg, project.getProperties());
+            ProjectHelper.replaceProperties(project, msg, project.getProperties());
+    }
+
+    /**
+     * Set the logging level to one of
+     * <ul>
+     *  <li>error</li>
+     *  <li>warning</li>
+     *  <li>info</li>
+     *  <li>verbose</li>
+     *  <li>debug</li>
+     * <ul>
+     * <p>The default is &quot;warning&quot; to ensure that messages are
+     * displayed by default when using the -quiet command line option.</p>
+     */
+    public void setLevel(EchoLevel echoLevel) {
+        String option = echoLevel.getValue();
+        if (option.equals("error")) {
+            logLevel = Project.MSG_ERR;
+        } else if (option.equals("warning")) {
+            logLevel = Project.MSG_WARN;
+        } else if (option.equals("info")) {
+            logLevel = Project.MSG_INFO;
+        } else if (option.equals("verbose")) {
+            logLevel = Project.MSG_VERBOSE;
+        } else {
+            // must be "debug"
+            logLevel = Project.MSG_DEBUG;
+        }
+    }
+
+    public static class EchoLevel extends EnumeratedAttribute {
+        public String[] getValues() {
+            return new String[] {"error", "warning", "info", "verbose", "debug"};
+        }
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exec.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exec.java
index fc39f21..e13259c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exec.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exec.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -182,8 +182,8 @@ public class Exec extends Task {
         this.out = out;
     }
 
-    public void setFailonerror(String fail) {
-        failOnError = Project.toBoolean(fail);
+    public void setFailonerror(boolean fail) {
+        failOnError = fail;
     }
 
     protected void outputLog(String line, int messageLevel) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecTask.java
index 181d2ab..0a4fcaa 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecTask.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecTask.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -65,7 +65,7 @@ import java.io.*;
  * @author duncan@x180.com
  * @author rubys@us.ibm.com
  * @author thomas.haas@softwired-inc.com
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  * @author <a href="mailto:mariusz@rakiura.org">Mariusz Nowostawski</a> 
  */
 public class ExecTask extends Task {
@@ -74,6 +74,7 @@ public class ExecTask extends Task {
     private File out;
     private File dir;
     protected boolean failOnError = false;
+    protected boolean newEnvironment = false;
     private Integer timeout = null;
     private Environment env = new Environment();
     protected Commandline cmdl = new Commandline();
@@ -101,7 +102,7 @@ public class ExecTask extends Task {
     }
 
     /**
-     * Only execute the process if <code>os.name</code> includes this string.
+     * Only execute the process if <code>os.name</code> is included in this string.
      */
     public void setOs(String os) {
         this.os = os;
@@ -131,6 +132,13 @@ public class ExecTask extends Task {
         failOnError = fail;
     }
 
+    /**
+     * Use a completely new environment
+     */
+    public void setNewenvironment(boolean newenv) {
+        newEnvironment = newenv;
+    }
+
     /**
      * Add a nested env element - an environment variable.
      */
@@ -162,6 +170,12 @@ public class ExecTask extends Task {
         if (cmdl.getExecutable() == null) {
             throw new BuildException("no executable specified", location);
         }
+        if (dir != null && !dir.exists()) {
+        	throw new BuildException("The directory you specified does not exist");
+        }
+        if (dir != null && !dir.isDirectory()) {
+        	throw new BuildException("The directory you specified is not a directory");
+        }
     }
 
     /**
@@ -198,6 +212,7 @@ public class ExecTask extends Task {
                     Project.MSG_VERBOSE);
             }
         }
+        exe.setNewenvironment(newEnvironment);
         exe.setEnvironment(environment);
         return exe;
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Execute.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Execute.java
index 31d7716..a599338 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Execute.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Execute.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -63,9 +63,12 @@ import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.io.BufferedReader;
+import java.io.StringReader;
+import java.io.ByteArrayOutputStream;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
-
+import java.util.Vector;
 
 /**
  * Runs an external program.
@@ -84,9 +87,11 @@ public class Execute {
     private ExecuteWatchdog watchdog;
     private File workingDirectory = null;
     private Project project = null;
+    private boolean newEnvironment = false;
 
     private static String antWorkingDirectory = System.getProperty("user.dir");
     private static CommandLauncher launcher = createCommandLauncher();
+    private static Vector procEnvironment = null;
 
     /** 
      * Builds a command launcher for the OS and JVM we are running under
@@ -138,6 +143,73 @@ public class Execute {
         }
     }
 
+    /**
+     * Find the list of environment variables for this process.
+     */
+    public static synchronized Vector getProcEnvironment() {
+        if (procEnvironment != null) return procEnvironment;
+
+        procEnvironment = new Vector();
+        try {
+            ByteArrayOutputStream out = new ByteArrayOutputStream();
+            Execute exe = new Execute(new PumpStreamHandler(out));
+            exe.setCommandline(getProcEnvCommand());
+            // Make sure we do not recurse forever
+            exe.setNewenvironment(true);
+            int retval = exe.execute();
+            if ( retval != 0 ) {
+                // Just try to use what we got
+            }
+
+            BufferedReader in = 
+                new BufferedReader(new StringReader(out.toString()));
+            String line;
+            while ((line = in.readLine()) != null) {
+                procEnvironment.addElement(line);
+            }
+        } 
+        catch (java.io.IOException exc) {
+            exc.printStackTrace();
+            // Just try to see how much we got
+        }
+        return procEnvironment;
+    }
+
+    private static String[] getProcEnvCommand() {
+        String osname = System.getProperty("os.name").toLowerCase();
+        if ( osname.indexOf("mac os") >= 0 ) {
+            // Mac
+            // TODO: I have no idea how to get it, someone must fix it
+            String[] cmd = null;
+            return cmd;
+        }
+        else if ( osname.indexOf("os/2") >= 0 ) {
+            // OS/2 - use same mechanism as Windows 2000
+            // Not sure
+            String[] cmd = {"cmd", "/c", "set" };
+            return cmd;
+        }
+        else if ( osname.indexOf("indows") >= 0 ) {
+            // Determine if we're running under 2000/NT or 98/95
+            if ( osname.indexOf("nt") >= 0 || osname.indexOf("2000") >= 0 ) {
+                // Windows 2000/NT
+                String[] cmd = {"cmd", "/c", "set" };
+                return cmd;
+            }
+            else {
+                // Windows 98/95 - need to use an auxiliary script
+                String[] cmd = {"command.com", "/c", "set" };
+                return cmd;
+            }
+        }
+        else {
+            // Generic UNIX
+            // Alternatively one could use: /bin/sh -c env
+            String[] cmd = {"/usr/bin/env"};
+            return cmd;
+        }
+    }
+
     /**
      * Creates a new execute object using <code>PumpStreamHandler</code> for
      * stream handling.
@@ -191,12 +263,22 @@ public class Execute {
     }
 
     /**
-     * Returns the commandline used to create a subprocess.
+     * Set whether to propagate the default environment or not.
      *
-     * @return the commandline used to create a subprocess
+     * @param newenv whether to propagate the process environment.
+     */
+    public void setNewenvironment(boolean newenv) {
+        newEnvironment = newenv;
+    }
+
+    /**
+     * Returns the environment used to create a subprocess.
+     *
+     * @return the environment used to create a subprocess
      */
     public String[] getEnvironment() {
-        return env;
+        if (env == null || newEnvironment) return env;
+        return patchEnvironment();
     }
 
 
@@ -221,10 +303,10 @@ public class Execute {
      * @param wd the working directory of the process.
      */
     public void setWorkingDirectory(File wd) {
-	if (wd == null || wd.getAbsolutePath().equals(antWorkingDirectory))
-	    workingDirectory = null;
-	else
-	    workingDirectory = wd;
+        if (wd == null || wd.getAbsolutePath().equals(antWorkingDirectory))
+            workingDirectory = null;
+        else
+            workingDirectory = wd;
     }
 
     /**
@@ -273,10 +355,34 @@ public class Execute {
         exitValue = value;
     }
 
-    protected int getExitValue() {
+    public int getExitValue() {
         return exitValue;
     }
 
+    /**
+     * Patch the current environment with the new values from the user.
+     * @return the patched environment
+     */
+    private String[] patchEnvironment() {
+        Vector osEnv = (Vector) getProcEnvironment().clone();
+        for (int i = 0; i < env.length; i++) {
+            int pos = env[i].indexOf('=');
+            // Get key including "="
+            String key = env[i].substring(0, pos+1);
+            int size = osEnv.size();
+            for (int j = 0; j < size; j++) {
+                if (((String)osEnv.elementAt(j)).startsWith(key)) {
+                    osEnv.removeElementAt(j);
+                    break;
+                }
+            }
+            osEnv.addElement(env[i]);
+        }
+        String[] result = new String[osEnv.size()];
+        osEnv.copyInto(result);
+        return result;
+    }
+
     /**
      * A utility method that runs an external command.  Writes the output and
      * error streams of the command to the project log.
@@ -322,6 +428,10 @@ public class Execute {
          */
         public Process exec(Project project, String[] cmd, String[] env) throws IOException
         {
+            if (project != null) {
+                project.log("Execute:CommandLauncher: " +
+                            Commandline.toString(cmd), Project.MSG_DEBUG);
+            }                            
             return Runtime.getRuntime().exec(cmd, env);
         }
 
@@ -363,6 +473,10 @@ public class Execute {
             for ( int i = 0; i < cmd.length; i++ ) {
                 newcmd[i] = Commandline.quoteArgument(cmd[i]);
             }
+            if (project != null) {
+                project.log("Execute:Java11CommandLauncher: " +
+                            Commandline.toString(newcmd), Project.MSG_DEBUG);
+            }                            
             return Runtime.getRuntime().exec(newcmd, env);
         }
     }
@@ -383,11 +497,16 @@ public class Execute {
          * Launches the given command in a new process, in the given working
          * directory
          */
-        public Process exec(Project project, String[] cmd, String[] env, File workingDir) throws IOException
+        public Process exec(Project project, String[] cmd, String[] env, File workingDir) 
+            throws IOException
         {
- 	    try {
-		Object[] arguments = { cmd, env, workingDir };
-		return (Process)_execWithCWD.invoke(Runtime.getRuntime(), arguments);
+            try {
+                if (project != null) {
+                    project.log("Execute:Java13CommandLauncher: " +
+                                Commandline.toString(cmd), Project.MSG_DEBUG);
+                }                                
+                Object[] arguments = { cmd, env, workingDir };
+                return (Process)_execWithCWD.invoke(Runtime.getRuntime(), arguments);
             } 
             catch ( InvocationTargetException exc ) {
                 Throwable realexc = exc.getTargetException();
@@ -400,16 +519,16 @@ public class Execute {
                 else {
                     throw new IOException(realexc.getMessage());
                 }
-	    } 
+            } 
             catch ( Exception exc ) {
-		// IllegalAccess, IllegalArgument, ClassCast
-		throw new IOException(exc.getMessage());
-	    }
+                // IllegalAccess, IllegalArgument, ClassCast
+                throw new IOException(exc.getMessage());
+            }
         }
-
+        
         private Method _execWithCWD;
     }
-
+    
     /**
      * A command launcher that proxies another command launcher.  
      *
@@ -458,13 +577,16 @@ public class Execute {
 
             // Use cmd.exe to change to the specified directory before running
             // the command
-	    String[] newcmd = new String[cmd.length+5];
-	    newcmd[0] = "cmd";
-	    newcmd[1] = "/c";
-	    newcmd[2] = "cd";
-	    newcmd[3] = workingDir.getAbsolutePath();
-	    newcmd[4] = "&&";
-	    System.arraycopy(cmd, 0, newcmd, 5, cmd.length);
+            final int preCmdLength = 6;
+            String[] newcmd = new String[cmd.length + preCmdLength];
+            newcmd[0] = "cmd";
+            newcmd[1] = "/c";
+            newcmd[2] = "cd";
+            newcmd[3] = "/d";
+            newcmd[4] = workingDir.getAbsolutePath();
+            newcmd[5] = "&&";
+            System.arraycopy(cmd, 0, newcmd, preCmdLength, cmd.length);
+
             return exec(project, newcmd, env);
         }
     }
@@ -490,13 +612,13 @@ public class Execute {
                 return exec(project, cmd, env);
             }
 
-	    System.getProperties().put("user.dir", workingDir.getAbsolutePath());
-	    try {
-		return exec(project, cmd, env);
-	    } 
+            System.getProperties().put("user.dir", workingDir.getAbsolutePath());
+            try {
+                return exec(project, cmd, env);
+            } 
             finally {
                 System.getProperties().put("user.dir", antWorkingDirectory);
-	    }
+            }
         }
     }
 
@@ -533,11 +655,11 @@ public class Execute {
             String antRun = project.resolveFile(antHome + File.separator + _script).toString();
 
             // Build the command
-	    String[] newcmd = new String[cmd.length + 2];
-	    newcmd[0] = antRun;
-	    newcmd[1] = workingDir.getAbsolutePath();
-	    System.arraycopy(cmd, 0, newcmd, 2, cmd.length);
-
+            String[] newcmd = new String[cmd.length + 2];
+            newcmd[0] = antRun;
+            newcmd[1] = workingDir.getAbsolutePath();
+            System.arraycopy(cmd, 0, newcmd, 2, cmd.length);
+            
             return exec(project, newcmd, env);
         }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteJava.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteJava.java
index 3be7020..030f1c9 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteJava.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteJava.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -64,16 +64,19 @@ import org.apache.tools.ant.types.Path;
 
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
+import java.io.*;
 
 /*
  *
  * @author thomas.haas@softwired-inc.com
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 public class ExecuteJava {
 
     private Commandline javaCommand = null;
     private Path classpath = null;
     private CommandlineJava.SysProperties sysProperties = null;
+    private PrintStream out;
 
     public void setJavaCommand(Commandline javaCommand) {
         this.javaCommand = javaCommand;
@@ -87,7 +90,18 @@ public class ExecuteJava {
         sysProperties = s;
     }
 
+    /**
+     * All output (System.out as well as System.err) will be written
+     * to this Stream.
+     */
+    public void setOutput(PrintStream out) {
+        this.out = out;
+    }
+
     public void execute(Project project) throws BuildException{
+        PrintStream sOut = System.out;
+        PrintStream sErr = System.err;
+
         final String classname = javaCommand.getExecutable();
         final Object[] argument = { javaCommand.getArguments() };
         try {
@@ -95,12 +109,18 @@ public class ExecuteJava {
                 sysProperties.setSystem();
             }
 
+            if (out != null) {
+                System.setErr(out);
+                System.setOut(out);
+            }
+
             final Class[] param = { Class.forName("[Ljava.lang.String;") };
             Class target = null;
             if (classpath == null) {
                 target = Class.forName(classname);
             } else {
-                AntClassLoader loader = new AntClassLoader(project, classpath);
+                AntClassLoader loader = new AntClassLoader(project, classpath, false);
+                loader.setIsolated(true);
                 target = loader.forceLoadClass(classname);
             }
             final Method main = target.getMethod("main", param);
@@ -123,6 +143,11 @@ public class ExecuteJava {
             if (sysProperties != null) {
                 sysProperties.restoreSystem();
             }
+            if (out != null) {
+                System.setOut(sOut);
+                System.setErr(sErr);
+                out.close();
+            }
         }
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteOn.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteOn.java
index 56863c2..154ef0c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteOn.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteOn.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -64,7 +64,7 @@ import java.io.IOException;
 /**
  * Executes a given command, supplying a set of files as arguments. 
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  * @author <a href="mailto:mariusz@rakiura.org">Mariusz Nowostawski</a> 
  */
 public class ExecuteOn extends ExecTask {
@@ -72,6 +72,7 @@ public class ExecuteOn extends ExecTask {
     protected Vector filesets = new Vector();
     private boolean parallel = false;
     protected String type = "file";
+    protected Commandline.Marker srcFilePos = null;
 
     /**
      * Adds a set of files (nested fileset attribute).
@@ -94,6 +95,19 @@ public class ExecuteOn extends ExecTask {
         this.type = type.getValue();
     }
 
+    /**
+     * Marker that indicates where the name of the source file should
+     * be put on the command line.
+     */
+    public Commandline.Marker createSrcfile() {
+        if (srcFilePos != null) {
+            throw new BuildException(taskType + " doesn\'t support multiple srcfile elements.",
+                                     location);
+        }
+        srcFilePos = cmdl.createMarker();
+        return srcFilePos;
+    }
+
     protected void checkConfiguration() {
         super.checkConfiguration();
         if (filesets.size() == 0) {
@@ -104,51 +118,36 @@ public class ExecuteOn extends ExecTask {
     protected void runExec(Execute exe) throws BuildException {
         try {
 
-            Vector v = new Vector();
             for (int i=0; i<filesets.size(); i++) {
+                Vector v = new Vector();
                 FileSet fs = (FileSet) filesets.elementAt(i);
+                File base = fs.getDir(project);
                 DirectoryScanner ds = fs.getDirectoryScanner(project);
 
                 if (!"dir".equals(type)) {
-                    String[] s = ds.getIncludedFiles();
+                    String[] s = getFiles(base, ds);
                     for (int j=0; j<s.length; j++) {
-                        v.addElement(new File(fs.getDir(project), s[j]).getAbsolutePath());
+                        v.addElement(s[j]);
                     }
                 }
 
                 if (!"file".equals(type)) {
-                    String[] s = ds.getIncludedDirectories();
+                    String[] s = getDirs(base, ds);;
                     for (int j=0; j<s.length; j++) {
-                        v.addElement(new File(fs.getDir(project), s[j]).getAbsolutePath());
+                        v.addElement(s[j]);
                     }
                 }
-            }
 
-            String[] s = new String[v.size()];
-            v.copyInto(s);
-
-            int err = -1;
-            String myos = System.getProperty("os.name");
-
-            if (parallel) {
-                cmdl.addArguments(s);
-                exe.setCommandline(cmdl.getCommandline());
-                err = exe.execute();
-                if (err != 0) {
-                    if (failOnError) {
-                        throw new BuildException("Exec returned: "+err, 
-                                                 location);
-                    } else {
-                        log("Result: " + err, Project.MSG_ERR);
-                    }
-                }
+                String[] s = new String[v.size()];
+                v.copyInto(s);
 
-            } else {
-                String[] cmd = new String[cmdl.size()+1];
-                System.arraycopy(cmdl.getCommandline(), 0, cmd, 0, cmdl.size());
-                for (int i=0; i<s.length; i++) {
-                    cmd[cmdl.size()] = s[i];
-                    exe.setCommandline(cmd);
+                int err = -1;
+                
+                if (parallel) {
+                    String[] command = getCommandline(s, base);
+                    log("Executing " + Commandline.toString(command), 
+                        Project.MSG_VERBOSE);
+                    exe.setCommandline(command);
                     err = exe.execute();
                     if (err != 0) {
                         if (failOnError) {
@@ -158,6 +157,23 @@ public class ExecuteOn extends ExecTask {
                             log("Result: " + err, Project.MSG_ERR);
                         }
                     }
+
+                } else {
+                    for (int j=0; j<s.length; j++) {
+                        String[] command = getCommandline(s[j], base);
+                        log("Executing " + Commandline.toString(command), 
+                            Project.MSG_VERBOSE);
+                        exe.setCommandline(command);
+                        err = exe.execute();
+                        if (err != 0) {
+                            if (failOnError) {
+                                throw new BuildException("Exec returned: "+err, 
+                                                         location);
+                            } else {
+                                log("Result: " + err, Project.MSG_ERR);
+                            }
+                        }
+                    }
                 }
             }
 
@@ -169,6 +185,57 @@ public class ExecuteOn extends ExecTask {
         }
     }
 
+    /**
+     * Construct the command line for parallel execution.
+     *
+     * @param srcFiles The filenames to add to the commandline
+     * @param baseDir filenames are relative to this dir
+     */
+    protected String[] getCommandline(String[] srcFiles, File baseDir) {
+        String[] orig = cmdl.getCommandline();
+        String[] result = new String[orig.length+srcFiles.length];
+
+        int index = orig.length;
+        if (srcFilePos != null) {
+            index = srcFilePos.getPosition();
+        }
+        System.arraycopy(orig, 0, result, 0, index);
+
+        for (int i=0; i < srcFiles.length; i++) {
+            result[index+i] = (new File(baseDir, srcFiles[i])).getAbsolutePath();
+        }
+        
+        System.arraycopy(orig, index, result, index+srcFiles.length, 
+                         orig.length-index);
+        return result;
+    }
+
+    /**
+     * Construct the command line for serial execution.
+     *
+     * @param srcFile The filename to add to the commandline
+     * @param baseDir filename is relative to this dir
+     */
+    protected String[] getCommandline(String srcFile, File baseDir) {
+        return getCommandline(new String[] {srcFile}, baseDir);
+    }
+
+    /**
+     * Return the list of files from this DirectoryScanner that should
+     * be included on the command line.
+     */
+    protected String[] getFiles(File basedir, DirectoryScanner ds) {
+        return ds.getIncludedFiles();
+    }
+
+    /**
+     * Return the list of Directories from this DirectoryScanner that
+     * should be included on the command line.
+     */
+    protected String[] getDirs(File basedir, DirectoryScanner ds) {
+        return ds.getIncludedDirectories();
+    }
+
     /**
      * Enumerated attribute with the values "file", "dir" and "both"
      * for the type attribute.  
@@ -178,5 +245,4 @@ public class ExecuteOn extends ExecTask {
             return new String[] {"file", "dir", "both"};
         }
     }
-
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteStreamHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteStreamHandler.java
index 80bfae0..1025fb7 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteStreamHandler.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteStreamHandler.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteWatchdog.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteWatchdog.java
index f50359d..7a97664 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteWatchdog.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/ExecuteWatchdog.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -58,21 +58,42 @@ import org.apache.tools.ant.BuildException;
 
 /**
  * Destroys a process running for too long.
- *
+ * For example:
+ * <pre>
+ * ExecuteWatchdog watchdog = new ExecuteWatchdog(30000);
+ * Execute exec = new Execute(myloghandler, watchdog);
+ * exec.setCommandLine(mycmdline);
+ * int exitvalue = exec.execute();
+ * if (exitvalue != SUCCESS && watchdog.killedProcess()){
+ *              // it was killed on purpose by the watchdog
+ * }
+ * </pre>
+ 
  * @author thomas.haas@softwired-inc.com
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ * @see Execute
  */
 public class ExecuteWatchdog implements Runnable {
-
+        
+    /** the process to execute and watch for duration */
     private Process process;
+
+    /** timeout duration. Once the process running time exceeds this it should be killed */
     private int timeout;
-    private boolean watch = true;
+
+    /** say whether or not the watchog is currently monitoring a process */
+    private boolean watch = false;
+        
+    /** exception that might be thrown during the process execution */
     private Exception caught = null;
 
+    /** say whether or not the process was killed due to running overtime */
+    private boolean     killedProcess = false;
 
     /**
-     * Creates a new watchdog.
+     * Creates a new watchdog with a given timeout.
      *
-     * @param timeout the timeout for the process.
+     * @param timeout the timeout for the process in milliseconds. It must be greather than 0.
      */
     public ExecuteWatchdog(int timeout) {
         if (timeout < 1) {
@@ -81,11 +102,11 @@ public class ExecuteWatchdog implements Runnable {
         this.timeout = timeout;
     }
 
-
     /**
-     * Watches the given process and terminates it, if it runs for to long.
-     *
-     * @param process the process to watch.
+     * Watches the given process and terminates it, if it runs for too long.
+     * All information from the previous run are reset.
+     * @param process the process to monitor. It cannot be <tt>null</tt>
+     * @throws IllegalStateException    thrown if a process is still being monitored.
      */
     public synchronized void start(Process process) {
         if (process == null) {
@@ -94,21 +115,21 @@ public class ExecuteWatchdog implements Runnable {
         if (this.process != null) {
             throw new IllegalStateException("Already running.");
         }
-        watch = true;
+        this.caught = null;
+        this.killedProcess = false;
+        this.watch = true;
         this.process = process;
         final Thread thread = new Thread(this, "WATCHDOG");
         thread.setDaemon(true);
         thread.start();
     }
 
-
     /**
-     * Stops the watcher.
+     * Stops the watcher. It will notify all threads possibly waiting on this object.
      */
     public synchronized void stop() {
         watch = false;
         notifyAll();
-        process = null;
     }
 
 
@@ -116,30 +137,76 @@ public class ExecuteWatchdog implements Runnable {
      * Watches the process and terminates it, if it runs for to long.
      */
     public synchronized void run() {
-	try {
-	    // This isn't a Task, don't have a Project object to log.
-	    // project.log("ExecuteWatchdog: timeout = "+timeout+" msec",  Project.MSG_VERBOSE);
-	    final long until = System.currentTimeMillis() + timeout;
-	    long now;
-	    while (watch && until > (now = System.currentTimeMillis())) {
-		try {
-		    wait(until - now);
-		} catch (InterruptedException e) {}
-	    }
-	    if (watch) {
-		process.destroy();
-	    }
-	    stop();
-	} catch(Exception e) {
+        try {
+            // This isn't a Task, don't have a Project object to log.
+            // project.log("ExecuteWatchdog: timeout = "+timeout+" msec",  Project.MSG_VERBOSE);
+            final long until = System.currentTimeMillis() + timeout;
+            long now;
+            while (watch && until > (now = System.currentTimeMillis())) {
+                try {
+                    wait(until - now);
+                } catch (InterruptedException e) {}
+            }
+
+            // if we are here, either someone stopped the watchdog,
+            // we are on timeout and the process must be killed, or
+            // we are on timeout and the process has already stopped.
+            try {
+                // We must check if the process was not stopped
+                // before being here
+                process.exitValue();
+            } catch (IllegalThreadStateException e){
+                // the process is not terminated, if this is really
+                // a timeout and not a manual stop then kill it.
+                if (watch){
+                    killedProcess = true;
+                    process.destroy();
+                }
+            }
+        } catch(Exception e) {
             caught = e;
+        } finally {
+            cleanUp();
         }
     }
 
+    /**
+     * reset the monitor flag and the process.
+     */
+    protected void cleanUp() {
+        watch = false;
+        process = null;
+    }
+
+    /**
+     * This method will rethrow the exception that was possibly caught during the
+     * run of the process. It will only remains valid once the process has been
+     * terminated either by 'error', timeout or manual intervention. Information
+     * will be discarded once a new process is ran.
+     * @throws  BuildException  a wrapped exception over the one that was silently
+     * swallowed and stored during the process run.
+     */
     public void checkException() throws BuildException {
         if (caught != null) {
             throw new BuildException("Exception in ExecuteWatchdog.run: "
                                      + caught.getMessage(), caught);
         }
     }
+
+    /**
+     * Indicates whether or not the watchdog is still monitoring the process.
+     * @return  <tt>true</tt> if the process is still running, otherwise <tt>false</tt>.
+     */
+    public boolean isWatching(){
+        return watch;
+    }
+
+    /**
+     * Indicates whether the last process run was killed on timeout or not.
+     * @return  <tt>true</tt> if the process was killed otherwise <tt>false</tt>.
+     */
+    public boolean killedProcess(){
+        return killedProcess;
+    }
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exit.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exit.java
index 8dfd60a..113f0fe 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exit.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Exit.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Expand.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Expand.java
index a137db1..a2798ac 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Expand.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Expand.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -110,58 +110,57 @@ public class Expand extends MatchingTask {
 
     private void expandFile(Touch touch, File srcF, File dir) {
         ZipInputStream zis = null;
-	try {
-	    
-	    log("Expanding: " + srcF + " into " + dir, Project.MSG_INFO);
-	    // code from WarExpand
-	    zis = new ZipInputStream(new FileInputStream(srcF));
-	    ZipEntry ze = null;
-	    
-	    while ((ze = zis.getNextEntry()) != null) {
-		File f = new File(dir, project.translatePath(ze.getName()));
-		try {
-		    log("expand-file " + ze.getName() , Project.MSG_VERBOSE );
-		    // create intermediary directories - sometimes zip don't add them
-		    File dirF=new File(f.getParent());
-		    dirF.mkdirs();
-		    
-		    if (ze.isDirectory()) {
-			f.mkdirs(); 
-		    } else {
-			byte[] buffer = new byte[1024];
-			int length = 0;
-			FileOutputStream fos = new FileOutputStream(f);
-			
-			while ((length = zis.read(buffer)) >= 0) {
-			    fos.write(buffer, 0, length);
-			}
-			
-			fos.close();
-		    }
+        try {
+            log("Expanding: " + srcF + " into " + dir, Project.MSG_INFO);
+            // code from WarExpand
+            zis = new ZipInputStream(new FileInputStream(srcF));
+            ZipEntry ze = null;
 
+            while ((ze = zis.getNextEntry()) != null) {
+                File f = new File(dir, project.translatePath(ze.getName()));
+                try {
+                    log("expand-file " + ze.getName() , Project.MSG_VERBOSE );
+                    // create intermediary directories - sometimes zip don't add them
+                    File dirF=new File(f.getParent());
+                    dirF.mkdirs();
+                    
+                    if (ze.isDirectory()) {
+                        f.mkdirs(); 
+                    } else {
+                        byte[] buffer = new byte[1024];
+                        int length = 0;
+                        FileOutputStream fos = new FileOutputStream(f);
+                        
+                        while ((length = zis.read(buffer)) >= 0) {
+                            fos.write(buffer, 0, length);
+                        }
+                        
+                        fos.close();
+                    }
+                    
                     if (project.getJavaVersion() != Project.JAVA_1_1) {
                         touch.setFile(f);
                         touch.setMillis(ze.getTime());
                         touch.touch();
                     }
-
-		} catch( FileNotFoundException ex ) {
-		    log("Unable to expand to file " + f.getPath(), Project.MSG_WARN);
-		}
-	    }
-	    log("expand complete", Project.MSG_VERBOSE );
-	} catch (IOException ioe) {
-	    throw new BuildException("Error while expanding " + srcF.getPath(), ioe);
-	} finally {
-	    if (zis != null) {
-	        try {
-	            zis.close();
-	        }
-	        catch (IOException e) {}
-	    }
-	}
+                    
+                } catch( FileNotFoundException ex ) {
+                    log("Unable to expand to file " + f.getPath(), Project.MSG_WARN);
+                }
+            }
+            log("expand complete", Project.MSG_VERBOSE );
+        } catch (IOException ioe) {
+            throw new BuildException("Error while expanding " + srcF.getPath(), ioe);
+        } finally {
+            if (zis != null) {
+                try {
+                    zis.close();
+                }
+                catch (IOException e) {}
+            }
+        }
     }
-
+    
     /**
      * Set the destination directory. File will be unzipped into the
      * destination directory.
@@ -169,7 +168,7 @@ public class Expand extends MatchingTask {
      * @param d Path to the directory.
      */
     public void setDest(File d) {
-	this.dest=d;
+        this.dest=d;
     }
 
     /**
@@ -178,6 +177,6 @@ public class Expand extends MatchingTask {
      * @param s Path to zip-file.
      */
     public void setSrc(File s) {
-	this.source = s;
+        this.source = s;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Filter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Filter.java
index c2e6c02..a6581a8 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Filter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Filter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -114,7 +114,7 @@ public class Filter extends Task {
 
             Project proj = getProject();
 
-            Enumeration enum = props.propertyNames();		
+            Enumeration enum = props.propertyNames();
             while (enum.hasMoreElements()) {
                 String strPropName = (String)enum.nextElement();
                 String strValue = props.getProperty(strPropName);
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/FixCRLF.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/FixCRLF.java
index 7092e9c..465e738 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/FixCRLF.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/FixCRLF.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GUnzip.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GUnzip.java
index 9d35744..4a0a1d1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GUnzip.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GUnzip.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GZip.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GZip.java
index bafad40..bc06589 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GZip.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GZip.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -103,17 +103,17 @@ public class GZip extends Task {
         } catch (IOException ioe) {
             String msg = "Problem creating gzip " + ioe.getMessage();
             throw new BuildException(msg, ioe, location);
-	} finally {
-	    if (zOut != null) {
-	        try {
+        } finally {
+            if (zOut != null) {
+                try {
                     // close up
-	            zOut.close();
-	        }
-	        catch (IOException e) {}
-	    }
+                    zOut.close();
+                }
+                catch (IOException e) {}
+            }
         }
     }
-
+    
     private void zipFile(InputStream in, GZIPOutputStream zOut)
         throws IOException
     {        
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GenerateKey.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GenerateKey.java
index e61b403..c1f0820 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GenerateKey.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/GenerateKey.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -53,15 +53,15 @@
  */
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
-import org.apache.tools.ant.types.Commandline;
 import java.util.Enumeration;
 import java.util.Vector;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
 
 /**
  * Generates a key.
  * 
- * @author Peter Donald <a href="mailto:donaldp@mad.scientist.com">donaldp@mad.scientist.com</a>
+ * @author <a href="mailto:donaldp@apache.org">Peter Donald</a>
  */
 public class GenerateKey extends Task {
 
@@ -104,46 +104,46 @@ public class GenerateKey extends Task {
         }
 
         public String toString() {
-		  final int size = params.size();
-		  final StringBuffer sb = new StringBuffer();
-		  boolean firstPass = true;
-
-		  for( int i = 0; i < size; i++ ) {
-			  if( !firstPass ) {
-				sb.append(" ,");
-			  }
-			  firstPass = false;
-
-			  final DnameParam param = (DnameParam)params.elementAt( i );
-			  sb.append( encode( param.getName() ) );
-			  sb.append( '=' );
-			  sb.append( encode( param.getValue() ) );
-		  }
-			
-		  return sb.toString();
+            final int size = params.size();
+            final StringBuffer sb = new StringBuffer();
+            boolean firstPass = true;
+
+            for( int i = 0; i < size; i++ ) {
+                if( !firstPass ) {
+                    sb.append(" ,");
+                }
+                firstPass = false;
+
+                final DnameParam param = (DnameParam)params.elementAt( i );
+                sb.append( encode( param.getName() ) );
+                sb.append( '=' );
+                sb.append( encode( param.getValue() ) );
+            }
+                        
+            return sb.toString();
         }
 
-	  public String encode( final String string ) {
-		int end = string.indexOf(',');
-
-		if( -1 == end ) return string;
-		
-		final StringBuffer sb = new StringBuffer();
-		
-		int start = 0;
-
-		while( -1 != end )
-		  {
-			sb.append( string.substring( start, end ) );
-			sb.append( "\\," );
-			start = end + 1;
-			end = string.indexOf( ',', start );
-		  }
-
-		sb.append( string.substring( start ) );
-		
-		return sb.toString();		
-	  }
+        public String encode( final String string ) {
+            int end = string.indexOf(',');
+
+            if( -1 == end ) return string;
+                
+            final StringBuffer sb = new StringBuffer();
+                
+            int start = 0;
+
+            while( -1 != end )
+            {
+                sb.append( string.substring( start, end ) );
+                sb.append( "\\," );
+                start = end + 1;
+                end = string.indexOf( ',', start );
+            }
+
+            sb.append( string.substring( start ) );
+                
+            return sb.toString();                
+        }
     }
 
     /**
@@ -168,20 +168,22 @@ public class GenerateKey extends Task {
     protected boolean verbose;
 
     public DistinguishedName createDname() throws BuildException {
-	    if( null != expandedDname ) {
-		  throw new BuildException("DName sub-element can only be specified once.");
-		}
-		if( null != dname ) {
-		  throw new BuildException("It is not possible to specify dname both as attribute and element.");
-		}
-		expandedDname = new DistinguishedName();
-		return expandedDname;
+        if( null != expandedDname ) {
+            throw new BuildException( "DName sub-element can only be specified once." );
+        }
+        if( null != dname ) {
+            throw new BuildException( "It is not possible to specify dname both " +
+                                      "as attribute and element." );
+        }
+        expandedDname = new DistinguishedName();
+        return expandedDname;
     }
   
     public void setDname(final String dname) {
-	    if( null != expandedDname ) {
-		  throw new BuildException("It is not possible to specify dname both as attribute and element.");
-		}
+        if( null != expandedDname ) {
+            throw new BuildException( "It is not possible to specify dname both " +
+                                      "as attribute and element." );
+        }
         this.dname = dname;
     } 
 
@@ -214,40 +216,41 @@ public class GenerateKey extends Task {
     } 
 
     public void setKeysize(final String keysize) throws BuildException {
-	  try { this.keysize = Integer.parseInt(keysize); }
-	  catch(final NumberFormatException nfe) 
-		{
-		  throw new BuildException( "KeySize attribute should be a integer" );
-		}
+        try { this.keysize = Integer.parseInt(keysize); }
+        catch(final NumberFormatException nfe) 
+        {
+            throw new BuildException( "KeySize attribute should be a integer" );
+        }
     } 
 
     public void setValidity(final String validity) throws BuildException {
-	  try { this.validity = Integer.parseInt(validity); }
-	  catch(final NumberFormatException nfe) 
-		{
-		  throw new BuildException( "Validity attribute should be a integer" );
-		}
+        try { this.validity = Integer.parseInt(validity); }
+        catch(final NumberFormatException nfe) 
+        {
+            throw new BuildException( "Validity attribute should be a integer" );
+        }
     } 
 
-    public void setVerbose(final String verbose) {
-        this.verbose = project.toBoolean(verbose);
+    public void setVerbose(final boolean verbose) {
+        this.verbose = verbose;
     } 
 
     public void execute() throws BuildException {
         if (project.getJavaVersion().equals(Project.JAVA_1_1)) {
-            throw new BuildException("The genkey task is only available on JDK versions 1.2 or greater");
+            throw new BuildException( "The genkey task is only available on JDK" +
+                                      " versions 1.2 or greater" );
         } 
 
         if (null == alias) {
-            throw new BuildException("alias attribute must be set");
+            throw new BuildException( "alias attribute must be set" );
         } 
 
         if (null == storepass) {
-            throw new BuildException("storepass attribute must be set");
+            throw new BuildException( "storepass attribute must be set" );
         } 
 
         if (null == dname && null == expandedDname) {
-            throw new BuildException("dname must be set");
+            throw new BuildException( "dname must be set" );
         } 
 
         final StringBuffer sb = new StringBuffer();
@@ -258,9 +261,9 @@ public class GenerateKey extends Task {
             sb.append("-v ");
         } 
 
-		sb.append("-alias \"");
-		sb.append(alias);
-		sb.append("\" ");
+        sb.append("-alias \"");
+        sb.append(alias);
+        sb.append("\" ");
 
         if (null != dname) {
             sb.append("-dname \"");
@@ -275,9 +278,9 @@ public class GenerateKey extends Task {
         } 
 
         if (null != keystore) {
-		    sb.append("-keystore \"");
+            sb.append("-keystore \"");
             sb.append(keystore);
-			sb.append("\" ");
+            sb.append("\" ");
         }
 
         if (null != storepass) {
@@ -292,14 +295,14 @@ public class GenerateKey extends Task {
             sb.append("\" ");
         } 
 
-		sb.append("-keypass \"");
+        sb.append("-keypass \"");
         if (null != keypass) {
             sb.append(keypass);
         } 
-		else {
+        else {
             sb.append(storepass);
-		}
-		sb.append("\" ");
+        }
+        sb.append("\" ");
 
         if (null != sigalg) {
             sb.append("-sigalg \"");
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Get.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Get.java
index f97a68c..cda40ac 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Get.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Get.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -54,10 +54,10 @@
 
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
 import java.io.*;
 import java.net.*;
 import java.util.*;
+import org.apache.tools.ant.*;
 
 /**
  * Get a particular file from a URL source. 
@@ -100,14 +100,14 @@ public class Get extends Task {
 
         try {
 
-	    log("Getting: " + source);
+            log("Getting: " + source);
 
-	    //set the timestamp to the file date.
-	    long timestamp=0;
+            //set the timestamp to the file date.
+            long timestamp=0;
 
             boolean hasTimestamp=false;
-	    if(useTimestamp && dest.exists()) {
-	        timestamp=dest.lastModified();
+            if(useTimestamp && dest.exists()) {
+                timestamp=dest.lastModified();
                 if (verbose)  {
                     Date t=new Date(timestamp);
                     log("local file date : "+t.toString());
@@ -115,7 +115,7 @@ public class Get extends Task {
                 
                 hasTimestamp=true;
             }
-	
+        
             //set up the URL connection
             URLConnection connection=source.openConnection();
             //modify the headers
@@ -128,7 +128,7 @@ public class Get extends Task {
             connection.connect();
             //next test for a 304 result (HTTP only)
             if(connection instanceof HttpURLConnection)  {
-           	HttpURLConnection httpConnection=(HttpURLConnection)connection;
+                HttpURLConnection httpConnection=(HttpURLConnection)connection;
                 if(httpConnection.getResponseCode()==HttpURLConnection.HTTP_NOT_MODIFIED)  {
                     //not modified so no file download. just return instead
                     //and trace out something so the user doesn't think that the 
@@ -141,45 +141,45 @@ public class Get extends Task {
             //REVISIT: at this point even non HTTP connections may support the if-modified-since
             //behaviour -we just check the date of the content and skip the write if it is not
             //newer. Some protocols (FTP) dont include dates, of course. 
-           	
-	    FileOutputStream fos = new FileOutputStream(dest);
+                   
+            FileOutputStream fos = new FileOutputStream(dest);
 
-	    InputStream is=null;
-	    for( int i=0; i< 3 ; i++ ) {
-		try {
-		    is = connection.getInputStream();
-		    break;
-		} catch( IOException ex ) {
-		    log( "Error opening connection " + ex );
-		}
-	    }
-	    if( is==null ) {
-		log( "Can't get " + source + " to " + dest);
-		if(ignoreErrors) 
+            InputStream is=null;
+            for( int i=0; i< 3 ; i++ ) {
+                try {
+                    is = connection.getInputStream();
+                    break;
+                } catch( IOException ex ) {
+                    log( "Error opening connection " + ex );
+                }
+            }
+            if( is==null ) {
+                log( "Can't get " + source + " to " + dest);
+                if(ignoreErrors) 
                     return;
-		throw new BuildException( "Can't get " + source + " to " + dest,
+                throw new BuildException( "Can't get " + source + " to " + dest,
                                           location);
-	    }
-		
-	    byte[] buffer = new byte[100 * 1024];
-	    int length;
-	    
-	    while ((length = is.read(buffer)) >= 0) {
-		fos.write(buffer, 0, length);
-		if (verbose) System.out.print(".");
-	    }
-	    if(verbose) System.out.println();
-	    fos.close();
-	    is.close();
+            }
+                
+            byte[] buffer = new byte[100 * 1024];
+            int length;
+            
+            while ((length = is.read(buffer)) >= 0) {
+                fos.write(buffer, 0, length);
+                if (verbose) System.out.print(".");
+            }
+            if(verbose) System.out.println();
+            fos.close();
+            is.close();
            
             //if (and only if) the use file time option is set, then the 
             //saved file now has its timestamp set to that of the downloaded file
             if(useTimestamp)  {
-           	long remoteTimestamp=connection.getLastModified();
+                long remoteTimestamp=connection.getLastModified();
                 if (verbose)  {
                     Date t=new Date(remoteTimestamp);
                     log("last modified = "+t.toString()
-                   	+((remoteTimestamp==0)?" - using current time instead":""));
+                        +((remoteTimestamp==0)?" - using current time instead":""));
                 }
                 if(remoteTimestamp!=0)
                     touchFile(dest,remoteTimestamp);
@@ -187,12 +187,12 @@ public class Get extends Task {
 
            
 
-	} catch (IOException ioe) {
-	    log("Error getting " + source + " to " + dest );
-	    if(ignoreErrors) 
+        } catch (IOException ioe) {
+            log("Error getting " + source + " to " + dest );
+            if(ignoreErrors) 
                 return;
-	    throw new BuildException(ioe, location);
-	}
+            throw new BuildException(ioe, location);
+        }
     }
     
     /** 
@@ -221,7 +221,7 @@ public class Get extends Task {
         } else {
             return false;
         }
-    }	
+    }        
 
     /**
      * Set the URL.
@@ -229,7 +229,7 @@ public class Get extends Task {
      * @param u URL for the file.
      */
     public void setSrc(URL u) {
-	this.source = u;
+        this.source = u;
     }
 
     /**
@@ -238,7 +238,7 @@ public class Get extends Task {
      * @param dest Path to file.
      */
     public void setDest(File dest) {
-	this.dest = dest;
+        this.dest = dest;
     }
 
     /**
@@ -247,7 +247,7 @@ public class Get extends Task {
      * @param v if "true" then be verbose
      */
     public void setVerbose(boolean v) {
-	verbose = v;
+        verbose = v;
     }
 
     /**
@@ -256,7 +256,7 @@ public class Get extends Task {
      * @param v if "true" then don't report download errors up to ant
      */
     public void setIgnoreErrors(boolean v) {
-	ignoreErrors = v;
+        ignoreErrors = v;
     }
 
     /**
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jar.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jar.java
index 29fdd73..6d1dcd4 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jar.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jar.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,6 +55,7 @@
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.ZipFileSet;
 
 import java.io.*;
 import java.util.zip.*;
@@ -68,83 +69,74 @@ import java.util.zip.*;
 public class Jar extends Zip {
 
     private File manifest;    
-    
+    private boolean manifestAdded;    
+
     public Jar() {
         super();
-	archiveType = "jar";
+        archiveType = "jar";
         emptyBehavior = "create";
     }
 
     public void setJarfile(File jarFile) {
-	super.setZipfile(jarFile);
+        super.setZipfile(jarFile);
     }
-    
+
     public void setManifest(File manifestFile) {
-	manifest = manifestFile;
+        manifest = manifestFile;
+        if (!manifest.exists())
+            throw new BuildException("Manifest file: " + manifest + " does not exist.");
+
+        // Create a ZipFileSet for this file, and pass it up.
+        ZipFileSet fs = new ZipFileSet();
+        fs.setDir(new File(manifest.getParent()));
+        fs.setIncludes(manifest.getName());
+        fs.setFullpath("META-INF/MANIFEST.MF");
+        super.addFileset(fs);
     }
 
+
     protected void initZipOutputStream(ZipOutputStream zOut)
-	throws IOException, BuildException
+        throws IOException, BuildException
     {
-	// add manifest first
-	if (manifest != null) {
-            zipDir(new File(manifest.getParent()), zOut, "META-INF/");
-	    super.zipFile(manifest, zOut, "META-INF/MANIFEST.MF");
-	} else {
-	    String s = "/org/apache/tools/ant/defaultManifest.mf";
-	    InputStream in = this.getClass().getResourceAsStream(s);
+        // If no manifest is specified, add the default one.
+        if (manifest == null) {
+            String s = "/org/apache/tools/ant/defaultManifest.mf";
+            InputStream in = this.getClass().getResourceAsStream(s);
             if ( in == null )
-		throw new BuildException ( "Could not find: " + s );
-	    zipDir(null, zOut, "META-INF/");
-	    zipFile(in, zOut, "META-INF/MANIFEST.MF", System.currentTimeMillis());
- 	}
-     }
-
-    protected boolean isUpToDate(FileScanner[] scanners, File zipFile) throws BuildException
-    {
-        File[] files = grabFiles(scanners);
-
-        if (manifest != null) {
-            // just add the manifest file to the mix
-
-            DirectoryScanner ds = new DirectoryScanner();
-            ds.setBasedir(new File(manifest.getParent()));
-            ds.setIncludes(new String[] {manifest.getName()});
-            ds.scan();
-
-            FileScanner[] myScanners = new FileScanner[scanners.length+1];
-            System.arraycopy(scanners, 0, myScanners, 0, scanners.length);
-            myScanners[scanners.length] = ds;
-
-            boolean retval = super.isUpToDate(myScanners, zipFile);
-            if (!retval && files.length == 0) {
-                log("Note: creating empty "+archiveType+" archive " + zipFile, 
-                    Project.MSG_INFO);
-            }
-            return retval;
-
-        } else if (emptyBehavior.equals("create") && files.length == 0) {
-
-            log("Note: creating empty "+archiveType+" archive " + zipFile, 
-                Project.MSG_INFO);
-            return false;
-
-        } else {
-            // all other cases are handled correctly by Zip's method
-            return super.isUpToDate(scanners, zipFile);
+                throw new BuildException ( "Could not find: " + s );
+            zipDir(null, zOut, "META-INF/");
+            zipFile(in, zOut, "META-INF/MANIFEST.MF", System.currentTimeMillis());
         }
+
+        super.initZipOutputStream(zOut);
     }
 
     protected void zipFile(File file, ZipOutputStream zOut, String vPath)
         throws IOException
     {
-        // We already added a META-INF/MANIFEST.MF
-        if (!vPath.equalsIgnoreCase("META-INF/MANIFEST.MF")) {
-            super.zipFile(file, zOut, vPath);
+        // If the file being added is META-INF/MANIFEST.MF, we warn if it's not the
+        // one specified in the "manifest" attribute - or if it's being added twice, 
+        // meaning the same file is specified by the "manifeset" attribute and in
+        // a <fileset> element.
+        if (vPath.equalsIgnoreCase("META-INF/MANIFEST.MF"))  {
+            if (manifest == null || !manifest.equals(file) || manifestAdded) {
+                log("Warning: selected "+archiveType+" files include a META-INF/MANIFEST.MF which will be ignored " +
+                    "(please use manifest attribute to "+archiveType+" task)", Project.MSG_WARN);
+            } else {
+                super.zipFile(file, zOut, vPath);
+                manifestAdded = true;
+            }
         } else {
-            log("Warning: selected "+archiveType+" files include a META-INF/MANIFEST.MF which will be ignored " +
-                "(please use manifest attribute to "+archiveType+" task)", Project.MSG_WARN);
+            super.zipFile(file, zOut, vPath);
         }
     }
 
+    /**
+     * Make sure we don't think we already have a MANIFEST next time this task
+     * gets executed.
+     */
+    protected void cleanUp() {
+        manifestAdded = false;
+        super.cleanUp();
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Java.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Java.java
index f928bc5..2576a3b 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Java.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Java.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -60,8 +60,7 @@ import org.apache.tools.ant.Project;
 import org.apache.tools.ant.Task;
 import org.apache.tools.ant.types.*;
 
-import java.io.File;
-import java.io.IOException;
+import java.io.*;
 import java.lang.reflect.*;
 import java.util.*;
 
@@ -70,12 +69,14 @@ import java.util.*;
  * for the called application thus resulting in much faster operation.
  *
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 public class Java extends Task {
 
     private CommandlineJava cmdl = new CommandlineJava();
     private boolean fork = false;
     private File dir = null;
+    private File out;
     private boolean failOnError = false;
     
     /**
@@ -221,6 +222,13 @@ public class Java extends Task {
         this.dir = d;
     }
 
+    /**
+     * File the output of the process is redirected to.
+     */
+    public void setOutput(File out) {
+        this.out = out;
+    }
+
     /**
      * -mx or -Xmx depending on VM version
      */
@@ -241,6 +249,13 @@ public class Java extends Task {
         exe.setJavaCommand(command.getJavaCommand());
         exe.setClasspath(command.getClasspath());
         exe.setSystemProperties(command.getSystemProperties());
+        if (out != null) {
+            try {
+                exe.setOutput(new PrintStream(new FileOutputStream(out)));
+            } catch (IOException io) {
+                throw new BuildException(io, location);
+            }
+        }
         
         exe.execute(project);
     }
@@ -249,27 +264,41 @@ public class Java extends Task {
      * Executes the given classname with the given arguments in a separate VM.
      */
     private int run(String[] command) throws BuildException {
-        Execute exe = new Execute(new LogStreamHandler(this, Project.MSG_INFO,
+        FileOutputStream fos = null;
+        try {
+            Execute exe = null;
+            if (out == null) {
+                exe = new Execute(new LogStreamHandler(this, Project.MSG_INFO,
                                                        Project.MSG_WARN), 
                                   null);
-        
-        
-        exe.setAntRun(project);
-
-        if (dir == null) {
-            dir = project.getBaseDir();
-        } else if (!dir.exists() || !dir.isDirectory()) {
-            throw new BuildException(dir.getAbsolutePath()+" is not a valid directory",
-                                     location);
-        }
-
-        exe.setWorkingDirectory(dir);
-
-        exe.setCommandline(command);
-        try {
-            return exe.execute();
-        } catch (IOException e) {
-            throw new BuildException(e, location);
+            } else {
+                fos = new FileOutputStream(out);
+                exe = new Execute(new PumpStreamHandler(fos), null);
+            }
+            
+            exe.setAntRun(project);
+            
+            if (dir == null) {
+                dir = project.getBaseDir();
+            } else if (!dir.exists() || !dir.isDirectory()) {
+                throw new BuildException(dir.getAbsolutePath()+" is not a valid directory",
+                                         location);
+            }
+            
+            exe.setWorkingDirectory(dir);
+            
+            exe.setCommandline(command);
+            try {
+                return exe.execute();
+            } catch (IOException e) {
+                throw new BuildException(e, location);
+            }
+        } catch (IOException io) {
+            throw new BuildException(io, location);
+        } finally {
+            if (fos != null) {
+                try {fos.close();} catch (IOException io) {}
+            }
         }
     }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javac.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javac.java
index 754c3b1..7917f84 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javac.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javac.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -58,11 +58,10 @@ import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.DirectoryScanner;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.util.*;
+import org.apache.tools.ant.taskdefs.compilers.*;
 
-import java.lang.reflect.Method;
-import java.lang.reflect.Constructor;
-import java.io.*;
-import java.util.*;
+import java.io.File;
 
 /**
  * Task to compile Java source files. This task can take the following
@@ -80,6 +79,9 @@ import java.util.*;
  * <li>target
  * <li>depend
  * <li>vebose
+ * <li>failonerror
+ * <li>includeantruntime
+ * <li>includejavaruntime
  * </ul>
  * Of these arguments, the <b>sourcedir</b> and <b>destdir</b> are required.
  * <p>
@@ -89,16 +91,14 @@ import java.util.*;
  *
  * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
  * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
  */
 
 public class Javac extends MatchingTask {
 
-    /**
-     * Integer returned by the "Modern" jdk1.3 compiler to indicate success.
-     */
-    private static final int
-        MODERN_COMPILER_SUCCESS = 0;
-    private static final String FAIL_MSG = "Compile failed, messages should have been provided.";
+    private static final String FAIL_MSG 
+        = "Compile failed, messages should have been provided.";
 
     private Path src;
     private File destDir;
@@ -112,9 +112,11 @@ public class Javac extends MatchingTask {
     private String target;
     private Path bootclasspath;
     private Path extdirs;
-    private static String lSep = System.getProperty("line.separator");
+    private boolean includeAntRuntime = true;
+    private boolean includeJavaRuntime = false;
 
-    protected Vector compileList = new Vector();
+    protected boolean failOnError = true;
+    protected File[] compileList = new File[0];
 
     /**
      * Create a nested <src ...> element for multiple source path
@@ -140,6 +142,11 @@ public class Javac extends MatchingTask {
         }
     }
 
+    /** Gets the source dirs to find the source java files. */
+    public Path getSrcdir() {
+        return src;
+    }
+
     /**
      * Set the destination directory into which the Java source
      * files should be compiled.
@@ -148,6 +155,14 @@ public class Javac extends MatchingTask {
         this.destDir = destDir;
     }
 
+    /** 
+     * Gets the destination directory into which the java source files
+     * should be compiled.
+     */
+    public File getDestdir() {
+        return destDir;
+    }
+
     /**
      * Set the classpath to be used for this compilation.
      */
@@ -159,6 +174,11 @@ public class Javac extends MatchingTask {
         }
     }
 
+    /** Gets the classpath to be used for this compilation. */
+    public Path getClasspath() {
+        return compileClasspath;
+    }
+
     /**
      * Maybe creates a nested classpath element.
      */
@@ -188,6 +208,14 @@ public class Javac extends MatchingTask {
         }
     }
 
+    /**
+     * Gets the bootclasspath that will be used to compile the classes
+     * against.
+     */
+    public Path getBootclasspath() {
+        return bootclasspath;
+    }
+
     /**
      * Maybe creates a nested classpath element.
      */
@@ -217,6 +245,14 @@ public class Javac extends MatchingTask {
         }
     }
 
+    /**
+     * Gets the extension directories that will be used during the
+     * compilation.
+     */
+    public Path getExtdirs() {
+        return extdirs;
+    }
+
     /**
      * Maybe creates a nested classpath element.
      */
@@ -227,6 +263,27 @@ public class Javac extends MatchingTask {
         return extdirs.createPath();
     }
 
+    /**
+     * Throw a BuildException if compilation fails
+     */
+    public void setFailonerror(boolean fail) {
+        failOnError = fail;
+    }
+
+    /**
+     * Proceed if compilation fails
+     */
+    public void setProceed(boolean proceed) {
+        failOnError = !proceed;
+    }
+
+    /**
+     * Gets the failonerror flag.
+     */
+    public boolean getFailonerror() {
+        return failOnError;
+    }
+
     /**
      * Set the deprecation flag.
      */
@@ -234,6 +291,11 @@ public class Javac extends MatchingTask {
         this.deprecation = deprecation;
     }
 
+    /** Gets the deprecation flag. */
+    public boolean getDeprecation() {
+        return deprecation;
+    }
+
     /**
      * Set the Java source file encoding name.
      */
@@ -241,6 +303,11 @@ public class Javac extends MatchingTask {
         this.encoding = encoding;
     }
 
+    /** Gets the java source file encoding name. */
+    public String getEncoding() {
+        return encoding;
+    }
+
     /**
      * Set the debug flag.
      */
@@ -248,26 +315,46 @@ public class Javac extends MatchingTask {
         this.debug = debug;
     }
 
+    /** Gets the debug flag. */
+    public boolean getDebug() {
+        return debug;
+    }
+
     /**
      * Set the optimize flag.
      */
-     public void setOptimize(boolean optimize) {
-         this.optimize = optimize;
-     }
+    public void setOptimize(boolean optimize) {
+        this.optimize = optimize;
+    }
+
+    /** Gets the optimize flag. */
+    public boolean getOptimize() {
+        return optimize;
+    }
 
     /** 
      * Set the depend flag.
      */ 
-     public void setDepend(boolean depend) {
-         this.depend = depend;
-     }  
+    public void setDepend(boolean depend) {
+        this.depend = depend;
+    }  
+
+    /** Gets the depend flag. */
+    public boolean getDepend() {
+        return depend;
+    }
 
     /** 
      * Set the verbose flag.
      */ 
-     public void setVerbose(boolean verbose) {
-         this.verbose = verbose;
-     }  
+    public void setVerbose(boolean verbose) {
+        this.verbose = verbose;
+    }
+
+    /** Gets the verbose flag. */
+    public boolean getVerbose() {
+        return verbose;
+    }
 
     /**
      * Sets the target VM that the classes will be compiled for. Valid
@@ -277,6 +364,42 @@ public class Javac extends MatchingTask {
         this.target = target;
     }
 
+    /** Gets the target VM that the classes will be compiled for. */
+    public String getTarget() {
+        return target;
+    }
+
+    /**
+     * Include ant's own classpath in this task's classpath?
+     */
+    public void setIncludeantruntime( boolean include ) {
+        includeAntRuntime = include;
+    }
+
+    /**
+     * Gets whether or not the ant classpath is to be included in the
+     * task's classpath.
+     */
+    public boolean getIncludeantruntime() {
+        return includeAntRuntime;
+    }
+
+    /**
+     * Sets whether or not to include the java runtime libraries to this
+     * task's classpath.
+     */
+    public void setIncludejavaruntime( boolean include ) {
+        includeJavaRuntime = include;
+    }
+
+    /**
+     * Gets whether or not the java runtime should be included in this
+     * task's classpath.
+     */
+    public boolean getIncludejavaruntime() {
+        return includeJavaRuntime;
+    }
+
     /**
      * Executes the task.
      */
@@ -295,7 +418,7 @@ public class Javac extends MatchingTask {
             throw new BuildException("destination directory \"" + destDir + "\" does not exist or is not a directory", location);
         }
 
-        // scan source directories and dest directory to build up both copy lists and
+        // scan source directories and dest directory to build up 
         // compile lists
         resetFileLists();
         for (int i=0; i<list.length; i++) {
@@ -322,23 +445,26 @@ public class Javac extends MatchingTask {
             }
         }
 
-        if (compileList.size() > 0) {
-            log("Compiling " + compileList.size() + 
+        if (compileList.length > 0) {
+
+            CompilerAdapter adapter = CompilerAdapterFactory.getCompiler(
+              compiler, this );
+            log("Compiling " + compileList.length + 
                 " source file"
-                + (compileList.size() == 1 ? "" : "s")
+                + (compileList.length == 1 ? "" : "s")
                 + (destDir != null ? " to " + destDir : ""));
 
-            if (compiler.equalsIgnoreCase("classic")) {
-                doClassicCompile();
-            } else if (compiler.equalsIgnoreCase("modern")) {
-                doModernCompile();
-            } else if (compiler.equalsIgnoreCase("jikes")) {
-                doJikesCompile();
-            } else if (compiler.equalsIgnoreCase("jvc")) {
-                doJvcCompile();
-            } else {
-                String msg = "Don't know how to use compiler " + compiler;
-                throw new BuildException(msg, location);
+            // now we need to populate the compiler adapter
+            adapter.setJavac( this );
+            
+            // finally, lets execute the compiler!!
+            if (!adapter.execute()) {
+                if (failOnError) {
+                    throw new BuildException(FAIL_MSG, location);
+                }
+                else {
+                    log(FAIL_MSG, Project.MSG_ERR);
+                }
             }
         }
     }
@@ -347,560 +473,34 @@ public class Javac extends MatchingTask {
      * Clear the list of files to be compiled and copied.. 
      */
     protected void resetFileLists() {
-        compileList.removeAllElements();
+        compileList = new File[0];
     }
 
     /**
      * Scans the directory looking for source files to be compiled.  
      * The results are returned in the class variable compileList
      */
-
     protected void scanDir(File srcDir, File destDir, String files[]) {
-
-        long now = (new Date()).getTime();
-
-        for (int i = 0; i < files.length; i++) {
-            File srcFile = new File(srcDir, files[i]);
-            if (files[i].endsWith(".java")) {
-                File classFile = new File(destDir, files[i].substring(0,
-                                          files[i].indexOf(".java")) + ".class");
-
-                if (srcFile.lastModified() > now) {
-                    log("Warning: file modified in the future: " +
-                        files[i], Project.MSG_WARN);
-                }
-
-                if (!classFile.exists() || srcFile.lastModified() > classFile.lastModified()) {
-                    if (!classFile.exists()) {
-                        log("Compiling " + srcFile.getPath() + " because class file " 
-                                + classFile.getPath() + " does not exist", Project.MSG_DEBUG);
-                    }
-                    else {
-                        log("Compiling " + srcFile.getPath() + " because it is out of date with respect to " 
-                                + classFile.getPath(), Project.MSG_DEBUG);
-                    }                                                        
-                    compileList.addElement(srcFile.getAbsolutePath());
-                }
-            }
-        }
-    }
-
-    // XXX
-    // we need a way to not use the current classpath.
-
-    /**
-     * Builds the compilation classpath.
-     *
-     * @param addRuntime Shall <code>rt.jar</code> or
-     * <code>classes.zip</code> be added to the classpath.  
-     */
-    protected Path getCompileClasspath(boolean addRuntime) {
-        Path classpath = new Path(project);
-
-        // add dest dir to classpath so that previously compiled and
-        // untouched classes are on classpath
-
-        if (destDir != null) {
-            classpath.setLocation(destDir);
-        }
-
-        // add our classpath to the mix
-
-        if (compileClasspath != null) {
-            classpath.addExisting(compileClasspath);
-        }
-
-        // add the system classpath
-
-        classpath.addExisting(Path.systemClasspath);
-        if (addRuntime) {
-            if (System.getProperty("java.vendor").toLowerCase().indexOf("microsoft") >= 0) {
-                // Pull in *.zip from packages directory
-                FileSet msZipFiles = new FileSet();
-                msZipFiles.setDir(new File(System.getProperty("java.home") + File.separator + "Packages"));
-                msZipFiles.setIncludes("*.ZIP");
-                classpath.addFileset(msZipFiles);
-            }
-            else if (Project.getJavaVersion() == Project.JAVA_1_1) {
-                classpath.addExisting(new Path(null,
-                                                System.getProperty("java.home")
-                                                + File.separator + "lib"
-                                                + File.separator 
-                                                + "classes.zip"));
-            } else {
-                // JDK > 1.1 seems to set java.home to the JRE directory.
-                classpath.addExisting(new Path(null,
-                                                System.getProperty("java.home")
-                                                + File.separator + "lib"
-                                                + File.separator + "rt.jar"));
-                // Just keep the old version as well and let addExistingToPath
-                // sort it out.
-                classpath.addExisting(new Path(null,
-                                                System.getProperty("java.home")
-                                                + File.separator +"jre"
-                                                + File.separator + "lib"
-                                                + File.separator + "rt.jar"));
-            }
-        }
-            
-        return classpath;
-    }
-
-    /**
-     * Peforms a compile using the classic compiler that shipped with
-     * JDK 1.1 and 1.2.
-     */
-
-    private void doClassicCompile() throws BuildException {
-        log("Using classic compiler", Project.MSG_VERBOSE);
-        Commandline cmd = setupJavacCommand();
-
-        // Use reflection to be able to build on all JDKs
-        /*
-        // provide the compiler a different message sink - namely our own
-        sun.tools.javac.Main compiler =
-                new sun.tools.javac.Main(new LogOutputStream(this, Project.MSG_WARN), "javac");
-
-        if (!compiler.compile(cmd.getArguments())) {
-            throw new BuildException("Compile failed");
-        }
-        */
-        try {
-            // Create an instance of the compiler, redirecting output to
-            // the project log
-            OutputStream logstr = new LogOutputStream(this, Project.MSG_WARN);
-            Class c = Class.forName("sun.tools.javac.Main");
-            Constructor cons = c.getConstructor(new Class[] { OutputStream.class, String.class });
-            Object compiler = cons.newInstance(new Object[] { logstr, "javac" });
-
-            // Call the compile() method
-            Method compile = c.getMethod("compile", new Class [] { String[].class });
-            Boolean ok = (Boolean)compile.invoke(compiler, new Object[] {cmd.getArguments()});
-            if (!ok.booleanValue()) {
-                throw new BuildException(FAIL_MSG, location);
-            }
-        }
-        catch (ClassNotFoundException ex) {
-            throw new BuildException("Cannot use classic compiler, as it is not available", location);
-        }
-        catch (Exception ex) {
-            if (ex instanceof BuildException) {
-                throw (BuildException) ex;
-            } else {
-                throw new BuildException("Error starting classic compiler: ", ex, location);
-            }
-        }
-    }
-
-    /**
-     * Performs a compile using the newer compiler that ships with JDK 1.3
-     */
-
-    private void doModernCompile() throws BuildException {
-        try {
-            Class.forName("com.sun.tools.javac.Main");
-        } catch (ClassNotFoundException cnfe) {
-            log("Modern compiler is not available - using classic compiler", Project.MSG_WARN);
-            doClassicCompile();
-            return;
-        }
-
-        log("Using modern compiler", Project.MSG_VERBOSE);
-        Commandline cmd = setupJavacCommand();
-
-        PrintStream err = System.err;
-        PrintStream out = System.out;
-
-        // Use reflection to be able to build on all JDKs >= 1.1:
-        try {
-            PrintStream logstr = 
-                new PrintStream(new LogOutputStream(this, Project.MSG_WARN));
-            System.setOut(logstr);
-            System.setErr(logstr);
-            Class c = Class.forName ("com.sun.tools.javac.Main");
-            Object compiler = c.newInstance ();
-            Method compile = c.getMethod ("compile",
-                new Class [] {(new String [] {}).getClass ()});
-            int result = ((Integer) compile.invoke
-                          (compiler, new Object[] {cmd.getArguments()})) .intValue ();
-            if (result != MODERN_COMPILER_SUCCESS) {
-                throw new BuildException(FAIL_MSG, location);
-            }
-        } catch (Exception ex) {
-            if (ex instanceof BuildException) {
-                throw (BuildException) ex;
-            } else {
-                throw new BuildException("Error starting modern compiler", ex, location);
-            }
-        } finally {
-            System.setErr(err);
-            System.setOut(out);
-        }
-    }
-
-    /**
-     * Does the command line argument processing common to classic and
-     * modern.  
-     */
-    private Commandline setupJavacCommand() {
-        Commandline cmd = new Commandline();
-        Path classpath = getCompileClasspath(false);
-
-        if (deprecation == true) {
-            cmd.createArgument().setValue("-deprecation");
-        }
-
-        if (destDir != null) {
-            cmd.createArgument().setValue("-d");
-            cmd.createArgument().setFile(destDir);
-        }
-        
-        cmd.createArgument().setValue("-classpath");
-        // Just add "sourcepath" to classpath ( for JDK1.1 )
-        if (Project.getJavaVersion().startsWith("1.1")) {
-            cmd.createArgument().setValue(classpath.toString() 
-                                          + File.pathSeparator 
-                                          + src.toString());
-        } else {
-            cmd.createArgument().setPath(classpath);
-            cmd.createArgument().setValue("-sourcepath");
-            cmd.createArgument().setPath(src);
-            if (target != null) {
-                cmd.createArgument().setValue("-target");
-                cmd.createArgument().setValue(target);
-            }
-        }
-        if (encoding != null) {
-            cmd.createArgument().setValue("-encoding");
-            cmd.createArgument().setValue(encoding);
-        }
-        if (debug) {
-            cmd.createArgument().setValue("-g");
-        }
-        if (optimize) {
-            cmd.createArgument().setValue("-O");
-        }
-        if (bootclasspath != null) {
-            cmd.createArgument().setValue("-bootclasspath");
-            cmd.createArgument().setPath(bootclasspath);
-        }
-        if (extdirs != null) {
-            cmd.createArgument().setValue("-extdirs");
-            cmd.createArgument().setPath(extdirs);
-        }
-
-        if (depend) {
-            if (Project.getJavaVersion().startsWith("1.1")) {
-                cmd.createArgument().setValue("-depend");
-            } else if (Project.getJavaVersion().startsWith("1.2")) {
-                cmd.createArgument().setValue("-Xdepend");
-            } else {
-                log("depend attribute is not supported by the modern compiler",
-                    Project.MSG_WARN);
-            }
-        }
-
-        if (verbose) {
-            cmd.createArgument().setValue("-verbose");
-        }
-
-        logAndAddFilesToCompile(cmd);
-        return cmd;
-    }
-
-    /**
-     * Logs the compilation parameters, adds the files to compile and logs the 
-     * &qout;niceSourceList&quot;
-     */
-    protected void logAndAddFilesToCompile(Commandline cmd) {
-        log("Compilation args: " + cmd.toString(),
-            Project.MSG_VERBOSE);
-
-        StringBuffer niceSourceList = new StringBuffer("File");
-        if (compileList.size() != 1) {
-            niceSourceList.append("s");
-        }
-        niceSourceList.append(" to be compiled:");
-
-        niceSourceList.append(lSep);
-
-        Enumeration enum = compileList.elements();
-        while (enum.hasMoreElements()) {
-            String arg = (String)enum.nextElement();
-            cmd.createArgument().setValue(arg);
-            niceSourceList.append("    " + arg + lSep);
-        }
-
-        log(niceSourceList.toString(), Project.MSG_VERBOSE);
-    }
-
-    /**
-     * Performs a compile using the Jikes compiler from IBM..
-     * Mostly of this code is identical to doClassicCompile()
-     * However, it does not support all options like
-     * bootclasspath, extdirs, deprecation and so on, because
-     * there is no option in jikes and I don't understand
-     * what they should do.
-     *
-     * It has been successfully tested with jikes >1.10
-     *
-     * @author skanthak@muehlheim.de
-     */
-
-    private void doJikesCompile() throws BuildException {
-        log("Using jikes compiler", Project.MSG_VERBOSE);
-
-        Path classpath = new Path(project);
-
-        // Jikes doesn't support bootclasspath dir (-bootclasspath)
-        // so we'll emulate it for compatibility and convenience.
-        if (bootclasspath != null) {
-            classpath.append(bootclasspath);
-        }
-
-        // Jikes doesn't support an extension dir (-extdir)
-        // so we'll emulate it for compatibility and convenience.
-        addExtdirsToClasspath(classpath);
-
-        classpath.append(getCompileClasspath(true));
-
-        // Jikes has no option for source-path so we
-        // will add it to classpath.
-        classpath.append(src);
-
-        // if the user has set JIKESPATH we should add the contents as well
-        String jikesPath = System.getProperty("jikes.class.path");
-        if (jikesPath != null) {
-            classpath.append(new Path(project, jikesPath));
-        }
+        GlobPatternMapper m = new GlobPatternMapper();
+        m.setFrom("*.java");
+        m.setTo("*.class");
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        File[] newFiles = sfs.restrictAsFiles(files, srcDir, destDir, m);
         
-        Commandline cmd = new Commandline();
-        cmd.setExecutable("jikes");
-
-        if (deprecation == true)
-            cmd.createArgument().setValue("-deprecation");
-
-        if (destDir != null) {
-            cmd.createArgument().setValue("-d");
-            cmd.createArgument().setFile(destDir);
-        }
-        
-        cmd.createArgument().setValue("-classpath");
-        cmd.createArgument().setPath(classpath);
-
-        if (encoding != null) {
-            cmd.createArgument().setValue("-encoding");
-            cmd.createArgument().setValue(encoding);
-        }
-        if (debug) {
-            cmd.createArgument().setValue("-g");
-        }
-        if (optimize) {
-            cmd.createArgument().setValue("-O");
-        }
-        if (verbose) {
-            cmd.createArgument().setValue("-verbose");
-        }
-        if (depend) {
-            cmd.createArgument().setValue("-depend");
-        } 
-        /**
-         * XXX
-         * Perhaps we shouldn't use properties for these
-         * three options (emacs mode, warnings and pedantic),
-         * but include it in the javac directive?
-         */
-
-        /**
-         * Jikes has the nice feature to print error
-         * messages in a form readable by emacs, so
-         * that emacs can directly set the cursor
-         * to the place, where the error occured.
-         */
-        String emacsProperty = project.getProperty("build.compiler.emacs");
-        if (emacsProperty != null && Project.toBoolean(emacsProperty)) {
-            cmd.createArgument().setValue("+E");
-        }
-
-        /**
-         * Jikes issues more warnings that javac, for
-         * example, when you have files in your classpath
-         * that don't exist. As this is often the case, these
-         * warning can be pretty annoying.
-         */
-        String warningsProperty = project.getProperty("build.compiler.warnings");
-        if (warningsProperty != null && !Project.toBoolean(warningsProperty)) {
-            cmd.createArgument().setValue("-nowarn");
-        }
-
-        /**
-         * Jikes can issue pedantic warnings. 
-         */
-        String pedanticProperty = project.getProperty("build.compiler.pedantic");
-        if (pedanticProperty != null && Project.toBoolean(pedanticProperty)) {
-            cmd.createArgument().setValue("+P");
-        }
- 
-        /**
-         * Jikes supports something it calls "full dependency
-         * checking", see the jikes documentation for differences
-         * between -depend and +F.
-         */
-        String fullDependProperty = project.getProperty("build.compiler.fulldepend");
-        if (fullDependProperty != null && Project.toBoolean(fullDependProperty)) {
-            cmd.createArgument().setValue("+F");
-        }
-
-        int firstFileName = cmd.size();
-        logAndAddFilesToCompile(cmd);
-
-        if (executeJikesCompile(cmd.getCommandline(), firstFileName) != 0) {
-            throw new BuildException(FAIL_MSG, location);
-        }
-    }
-
-    /**
-     * Do the compile with the specified arguments.
-     * @param args - arguments to pass to process on command line
-     * @param firstFileName - index of the first source file in args
-     */
-    protected int executeJikesCompile(String[] args, int firstFileName) {
-        String[] commandArray = null;
-        File tmpFile = null;
-
-        try {
-            /*
-             * Many system have been reported to get into trouble with 
-             * long command lines - no, not only Windows ;-).
-             *
-             * POSIX seems to define a lower limit of 4k, so use a temporary 
-             * file if the total length of the command line exceeds this limit.
-             */
-            if (Commandline.toString(args).length() > 4096) {
-                PrintWriter out = null;
-                try {
-                    tmpFile = new File("jikes"+(new Random(System.currentTimeMillis())).nextLong());
-                    out = new PrintWriter(new FileWriter(tmpFile));
-                    for (int i = firstFileName; i < args.length; i++) {
-                        out.println(args[i]);
-                    }
-                    out.flush();
-                    commandArray = new String[firstFileName+1];
-                    System.arraycopy(args, 0, commandArray, 0, firstFileName);
-                    commandArray[firstFileName] = "@" + tmpFile.getAbsolutePath();
-                } catch (IOException e) {
-                    throw new BuildException("Error creating temporary file", e, location);
-                } finally {
-                    if (out != null) {
-                        try {out.close();} catch (Throwable t) {}
-                    }
-                }
-            } else {
-                commandArray = args;
-            }
-            
-            try {
-                Execute exe = new Execute(new LogStreamHandler(this, 
-                                                               Project.MSG_INFO,
-                                                               Project.MSG_WARN));
-                exe.setAntRun(project);
-                exe.setWorkingDirectory(project.getBaseDir());
-                exe.setCommandline(commandArray);
-                exe.execute();
-                return exe.getExitValue();
-            } catch (IOException e) {
-                throw new BuildException("Error running Jikes compiler", e, location);
-            }
-        } finally {
-            if (tmpFile != null) {
-                tmpFile.delete();
-            }
+        if (newFiles.length > 0) {
+            File[] newCompileList = new File[compileList.length +
+                newFiles.length];
+            System.arraycopy(compileList, 0, newCompileList, 0,
+                    compileList.length);
+            System.arraycopy(newFiles, 0, newCompileList,
+                    compileList.length, newFiles.length);
+            compileList = newCompileList;
         }
     }
 
-    /**
-     * Emulation of extdirs feature in java >= 1.2.
-     * This method adds all files in the given
-     * directories (but not in sub-directories!) to the classpath,
-     * so that you don't have to specify them all one by one.
-     * @param classpath - Path to append files to
-     */
-    protected void addExtdirsToClasspath(Path classpath) {
-        if (extdirs == null) {
-            String extProp = System.getProperty("java.ext.dirs");
-            if (extProp != null) {
-                extdirs = new Path(project, extProp);
-            } else {
-                return;
-            }
-        }
-
-        String[] dirs = extdirs.list();
-        for (int i=0; i<dirs.length; i++) {
-            if (!dirs[i].endsWith(File.separator)) {
-                dirs[i] += File.separator;
-            }
-            File dir = project.resolveFile(dirs[i]);
-            FileSet fs = new FileSet();
-            fs.setDir(dir);
-            fs.setIncludes("*");
-            classpath.addFileset(fs);
-        }
+    /** Gets the list of files to be compiled. */
+    public File[] getFileList() {
+        return compileList;
     }
 
-    private void doJvcCompile() throws BuildException {
-        log("Using jvc compiler", Project.MSG_VERBOSE);
-
-        Path classpath = new Path(project);
-
-        // jvc doesn't support bootclasspath dir (-bootclasspath)
-        // so we'll emulate it for compatibility and convenience.
-        if (bootclasspath != null) {
-            classpath.append(bootclasspath);
-        }
-
-        // jvc doesn't support an extension dir (-extdir)
-        // so we'll emulate it for compatibility and convenience.
-        addExtdirsToClasspath(classpath);
-
-        classpath.append(getCompileClasspath(true));
-
-        // jvc has no option for source-path so we
-        // will add it to classpath.
-        classpath.append(src);
-
-        Commandline cmd = new Commandline();
-        cmd.setExecutable("jvc");
-
-        if (destDir != null) {
-            cmd.createArgument().setValue("/d");
-            cmd.createArgument().setFile(destDir);
-        }
-        
-        // Add the Classpath before the "internal" one.
-        cmd.createArgument().setValue("/cp:p");
-        cmd.createArgument().setPath(classpath);
-
-        // Enable MS-Extensions and ...
-        cmd.createArgument().setValue("/x-");
-        // ... do not display a Message about this.
-        cmd.createArgument().setValue("/nomessage");
-        // Do not display Logo
-        cmd.createArgument().setValue("/nologo");
-
-        if (debug) {
-            cmd.createArgument().setValue("/g");
-        }
-        if (optimize) {
-            cmd.createArgument().setValue("/O");
-        }
-
-        int firstFileName = cmd.size();
-        logAndAddFilesToCompile(cmd);
-
-        if (executeJikesCompile(cmd.getCommandline(), firstFileName) != 0) {
-            throw new BuildException(FAIL_MSG, location);
-        }
-    }
 }
-
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JavacOutputStream.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JavacOutputStream.java
index 0f75c33..75dfb85 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JavacOutputStream.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JavacOutputStream.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javadoc.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javadoc.java
index 7a30b0d..ab2e02c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javadoc.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Javadoc.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,19 +51,15 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs;
 
+import java.io.*;
+import java.util.*;
 import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.DirectoryScanner;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.Task;
-import org.apache.tools.ant.types.Commandline;
-import org.apache.tools.ant.types.Path;
-import org.apache.tools.ant.types.Reference;
-
-import java.io.*;
-import java.util.*;
+import org.apache.tools.ant.types.*;
 
 /**
  * This task makes it easy to generate Javadoc documentation for a collection
@@ -90,6 +86,7 @@ import java.util.*;
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
  * @author Patrick Chanezon <a href="mailto:chanezon@netscape.com">chanezon@netscape.com</a>
  * @author Ernst de Haan <a href="mailto:ernst@jollem.com">ernst@jollem.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
 public class Javadoc extends Task {
@@ -178,6 +175,19 @@ public class Javadoc extends Task {
         }
     }
 
+    private void add12ArgIfNotEmpty(String key, String value) {
+        if (!javadoc1) {
+            if (value != null && value.length() != 0) {
+                cmd.createArgument().setValue(key);
+                cmd.createArgument().setValue(value);
+            } else {
+                project.log(this, 
+                            "Warning: Leaving out empty argument '" + key + "'", 
+                            Project.MSG_WARN);
+            }
+        } 
+    }
+
     private void add11ArgIf(boolean b, String arg) {
         if (javadoc1 && b) {
             cmd.createArgument().setValue(arg);
@@ -191,10 +201,12 @@ public class Javadoc extends Task {
     }
 
     private boolean foundJavaFile = false;
+    private boolean failOnError = false;
     private Path sourcePath = null;
     private File destDir = null;
     private String sourceFiles = null;
     private String packageNames = null;
+	private String excludePackageNames = null;
     private boolean author = true;
     private boolean version = true;
     private DocletInfo doclet = null;
@@ -205,6 +217,18 @@ public class Javadoc extends Task {
     private String packageList = null;
     private Vector links = new Vector(2);
     private Vector groups = new Vector(2);
+	private boolean useDefaultExcludes = true;
+
+    /**
+     * Sets whether default exclusions should be used or not.
+     *
+     * @param useDefaultExcludes "true"|"on"|"yes" when default exclusions 
+     *                           should be used, "false"|"off"|"no" when they
+     *                           shouldn't be used.
+     */
+    public void setDefaultexcludes(boolean useDefaultExcludes) {
+       this.useDefaultExcludes = useDefaultExcludes;
+    }
 
     public void setMaxmemory(String max){
         if(javadoc1){
@@ -215,7 +239,7 @@ public class Javadoc extends Task {
     }
 
     public void setAdditionalparam(String add){
-        cmd.createArgument().setValue(add);
+        cmd.createArgument().setLine(add);
     }
     
     public void setSourcepath(Path src) {
@@ -241,6 +265,8 @@ public class Javadoc extends Task {
 
     public void setDestdir(File dir) {
         destDir = dir;
+        cmd.createArgument().setValue("-d");
+        cmd.createArgument().setFile(destDir);
     }
     public void setSourcefiles(String src) {
         sourceFiles = src;
@@ -248,6 +274,11 @@ public class Javadoc extends Task {
     public void setPackagenames(String src) {
         packageNames = src;
     }
+
+	public void setExcludePackageNames(String src) {
+		excludePackageNames = src;
+	}
+
     public void setOverview(File f) {
         if (!javadoc1) {
             cmd.createArgument().setValue("-overview");
@@ -369,41 +400,29 @@ public class Javadoc extends Task {
         add12ArgIf(b, "-splitindex");
     }
     public void setWindowtitle(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-windowtitle");
-            cmd.createArgument().setValue(src);
-        }
+        add12ArgIfNotEmpty("-windowtitle", src);
     }
     public void setDoctitle(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-doctitle");
-            cmd.createArgument().setValue(src);
-        }
+        add12ArgIfNotEmpty("-doctitle", src);
     }
     public void setHeader(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-header");
-            cmd.createArgument().setValue(src);
-        }
+        add12ArgIfNotEmpty("-header", src);
     }
+
     public void setFooter(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-footer");
-            cmd.createArgument().setValue(src);
-        }
+        add12ArgIfNotEmpty("-footer", src);
     }
+
     public void setBottom(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-bottom");
-            cmd.createArgument().setValue(src);
-        }
+        add12ArgIfNotEmpty("-bottom", src);
     }
+
     public void setLinkoffline(String src) {
         if (!javadoc1) {
             LinkArgument le = createLink();
             le.setOffline(true);
             String linkOfflineError = "The linkoffline attribute must include a URL and " + 
-                                      "a package-list file location separated by a space";
+                "a package-list file location separated by a space";
             if (src.trim().length() == 0) {
                 throw new BuildException(linkOfflineError);
             }                
@@ -535,10 +554,17 @@ public class Javadoc extends Task {
     }
     
     public void setCharset(String src) {
-        if (!javadoc1) {
-            cmd.createArgument().setValue("-charset");
-            cmd.createArgument().setValue(src);
-        }
+        this.add12ArgIfNotEmpty("-charset", src);
+    }
+
+    /**
+     * Should the build process fail if javadoc fails (as indicated by
+     * a non zero return code)?
+     *
+     * <p>Default is false.</p>
+     */
+    public void setFailonerror(boolean b) {
+        failOnError = b;
     }
 
     public void execute() throws BuildException {
@@ -559,6 +585,8 @@ public class Javadoc extends Task {
 // ------------------------------------------------ general javadoc arguments
         if (classpath == null)
             classpath = Path.systemClasspath;
+        else
+            classpath = classpath.concatSystemClasspath("ignore");
 
         if (!javadoc1) {
             toExecute.createArgument().setValue("-classpath");
@@ -568,7 +596,7 @@ public class Javadoc extends Task {
         } else {
             toExecute.createArgument().setValue("-classpath");
             toExecute.createArgument().setValue(sourcePath.toString() +
-                System.getProperty("path.separator") + classpath.toString());
+                                                System.getProperty("path.separator") + classpath.toString());
         }
 
         if (version && doclet == null)
@@ -581,9 +609,8 @@ public class Javadoc extends Task {
                 String msg = "destDir attribute must be set!";
                 throw new BuildException(msg);
             }
-            toExecute.createArgument().setValue("-d");
-            toExecute.createArgument().setFile(destDir);
         }
+        
 
 // --------------------------------- javadoc2 arguments for default doclet
 
@@ -659,15 +686,15 @@ public class Javadoc extends Task {
             if (group != null) {
                 StringTokenizer tok = new StringTokenizer(group, ",", false);
                 while (tok.hasMoreTokens()) {
-                  String grp = tok.nextToken().trim();
-                  int space = grp.indexOf(" ");
-                  if (space > 0){
-                    String name = grp.substring(0, space);
-                    String pkgList = grp.substring(space + 1);
-                    toExecute.createArgument().setValue("-group");
-                    toExecute.createArgument().setValue(name);
-                    toExecute.createArgument().setValue(pkgList);
-                  }
+                    String grp = tok.nextToken().trim();
+                    int space = grp.indexOf(" ");
+                    if (space > 0){
+                        String name = grp.substring(0, space);
+                        String pkgList = grp.substring(space + 1);
+                        toExecute.createArgument().setValue("-group");
+                        toExecute.createArgument().setValue(name);
+                        toExecute.createArgument().setValue(pkgList);
+                    }
                 }
             }
             
@@ -699,8 +726,16 @@ public class Javadoc extends Task {
                     toExecute.createArgument().setValue(name);
                 }
             }
+
+			Vector excludePackages = new Vector();
+			if ((excludePackageNames != null) && (excludePackageNames.length() > 0)) {
+				StringTokenizer exTok = new StringTokenizer(excludePackageNames, ",", false);
+				while (exTok.hasMoreTokens()) {
+					excludePackages.addElement(exTok.nextToken().trim());
+				}
+			}
             if (packages.size() > 0) {
-                evaluatePackages(toExecute, sourcePath, packages);
+                evaluatePackages(toExecute, sourcePath, packages, excludePackages);
             }
         }
 
@@ -711,7 +746,7 @@ public class Javadoc extends Task {
             }
         }
 
-         if (packageList != null) {
+        if (packageList != null) {
             toExecute.createArgument().setValue("@" + packageList);
         }
         log("Javadoc args: " + toExecute, Project.MSG_VERBOSE);
@@ -725,7 +760,10 @@ public class Javadoc extends Task {
         exe.setWorkingDirectory(project.getBaseDir());
         try {
             exe.setCommandline(toExecute.getCommandline());
-            exe.execute();
+            int ret = exe.execute();
+            if (ret != 0 && failOnError) {
+                throw new BuildException("Javadoc returned "+ret, location);
+            }
         } catch (IOException e) {
             throw new BuildException("Javadoc failed: " + e, e, location);
         } finally {
@@ -744,42 +782,70 @@ public class Javadoc extends Task {
      * patterns.
      */
     private void evaluatePackages(Commandline toExecute, Path sourcePath, 
-                                  Vector packages) {
+                                  Vector packages, Vector excludePackages) {
         log("Source path = " + sourcePath.toString(), Project.MSG_VERBOSE);
         log("Packages = " + packages, Project.MSG_VERBOSE);
+		log("Exclude Packages = " + excludePackages, Project.MSG_VERBOSE);
 
         Vector addedPackages = new Vector();
+
         String[] list = sourcePath.list();
+        if (list == null) list = new String[0];
+
+        FileSet fs = new FileSet();
+        fs.setDefaultexcludes(useDefaultExcludes);
+
+        Enumeration e = packages.elements();
+        while (e.hasMoreElements()) {
+            String pkg = (String)e.nextElement();
+            pkg = pkg.replace('.','/');
+            if (pkg.endsWith("*")) {
+                pkg += "*";
+            }
+
+            fs.createInclude().setName(pkg);
+        } // while
+
+		e = excludePackages.elements();
+		while (e.hasMoreElements()) {
+			String pkg = (String)e.nextElement();
+			pkg = pkg.replace('.','/');
+			if (pkg.endsWith("*")) {
+				pkg += "*";
+			}
+
+			fs.createExclude().setName(pkg);
+		}
+
         for (int j=0; j<list.length; j++) {
             File source = project.resolveFile(list[j]);
-            Vector foundPackages = findPackages(source);
-
-            Enumeration e = foundPackages.elements();
-            while (e.hasMoreElements()) {
-                String pack = (String) e.nextElement();
-                for (int i = 0; i < packages.size(); i++) {
-                    if (matches(pack, (String) packages.elementAt(i))) {
-                        if (!addedPackages.contains(pack)) {
-                            toExecute.createArgument().setValue(pack);
-                            addedPackages.addElement(pack);
+            fs.setDir(source);
+
+            DirectoryScanner ds = fs.getDirectoryScanner(project);
+            String[] packageDirs = ds.getIncludedDirectories();
+
+            for (int i=0; i<packageDirs.length; i++) {
+                File pd = new File(source, packageDirs[i]);
+                String[] files = pd.list(new FilenameFilter () {
+                    public boolean accept(File dir1, String name) {
+                        if (name.endsWith(".java")) {
+                            return true;
                         }
-                        break;
+                        return false;	// ignore dirs
+                    }
+                });
+
+                if (files.length > 0) {
+                    String pkgDir = packageDirs[i].replace('/','.').replace('\\','.');
+                    if (!addedPackages.contains(pkgDir)) {
+                        toExecute.createArgument().setValue(pkgDir);
+                        addedPackages.addElement(pkgDir);
                     }
                 }
             }
         }
     }
 
-    /**
-     * Implements the pattern matching. For now it's only able to
-     * guarantee that "aaa.bbb.ccc" matches "aaa.*" and "aaa.bbb.*"
-     * FIXME: this code needs much improvement.
-     */
-    private boolean matches(String string, String pattern) {
-        return string.startsWith(pattern.substring(0, pattern.length() - 2));
-    }
-
-
     private class JavadocOutputStream extends LogOutputStream {
         JavadocOutputStream(int level) {
             super(Javadoc.this, level);
@@ -818,49 +884,4 @@ public class Javadoc extends Task {
         }
     }
 
-    protected Vector findPackages(File srcDir) {
-    	Vector foundPkgs = new Vector();
-    	
-    	if ((srcDir != null) && (srcDir.isDirectory())) {
-    		scan(srcDir, "", foundPkgs);
-    	}
-    	
-    	return foundPkgs;
-    }
-
-    protected void scan(File srcDir, String vpath, Vector pkgs) {
-    	foundJavaFile = false;
-    	File dir = new File(srcDir, vpath);
-    	
-    	if (!dir.isDirectory()) {
-    		return;
-    	}
-    
-    	String[] files = dir.list(new FilenameFilter () {
-    			public boolean accept(File dir1, String name) {
-    				if (name.endsWith(".java")) {
-    					foundJavaFile = true;
-    					return false;
-    				}
-    				File d = new File(dir1, name);
-    				if (d.isDirectory() 
-                                    && d.getName().indexOf("-") == -1) {
-    					return true;
-    				}
-    				return false;
-    			}
-    		});
-    
-    	if (foundJavaFile && vpath.length() > 0) {
-    		String newPkg = vpath.substring(1).replace(File.separatorChar, '.');
-    		if (!pkgs.contains(newPkg)) {
-    			pkgs.addElement(newPkg);
-    		}
-    	}
-    	
-    	for (int i=0; i<files.length; i++) {
-    		scan(srcDir, vpath + File.separator + files[i], pkgs);
-    	}
-    	return;
-    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jikes.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jikes.java
index 94fc865..fb046f5 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jikes.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Jikes.java
@@ -1,3 +1,56 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.tools.ant.taskdefs;
 
 import java.io.*;
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JikesOutputParser.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JikesOutputParser.java
index 11b65ee..0191643 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JikesOutputParser.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/JikesOutputParser.java
@@ -1,3 +1,56 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
@@ -57,8 +110,8 @@ public class JikesOutputParser implements ExecuteStreamHandler {
      * @param task - task in whichs context we are called
      */
     protected JikesOutputParser(Task task, boolean emacsMode) {
-	super();
-	this.task = task;
+        super();
+        this.task = task;
         this.emacsMode = emacsMode;
     }
 
@@ -74,24 +127,24 @@ public class JikesOutputParser implements ExecuteStreamHandler {
     }
 
     private void parseStandardOutput(BufferedReader reader) throws IOException {
-	String line;
-	String lower;
-	// We assume, that every output, jike does, stands for an error/warning
-	// XXX 
-	// Is this correct?
-
+        String line;
+        String lower;
+        // We assume, that every output, jike does, stands for an error/warning
+        // XXX 
+        // Is this correct?
+        
         // TODO:
         // A warning line, that shows code, which contains a variable
         // error will cause some trouble. The parser should definitely
         // be much better.
 
-	while ((line = reader.readLine()) != null) {
-	    lower = line.toLowerCase();
-	    if (line.trim().equals(""))
-		continue;
-	    if (lower.indexOf("error") != -1)
-		setError(true);
-	    else if (lower.indexOf("warning") != -1)
+        while ((line = reader.readLine()) != null) {
+            lower = line.toLowerCase();
+            if (line.trim().equals(""))
+                continue;
+            if (lower.indexOf("error") != -1)
+                setError(true);
+            else if (lower.indexOf("warning") != -1)
                 setError(false);
             else {
                 // If we don't know the type of the line
@@ -104,7 +157,7 @@ public class JikesOutputParser implements ExecuteStreamHandler {
                     setError(true);
             }
             log(line);
-	}
+        }
     }
 
     private void parseEmacsOutput(BufferedReader reader) throws IOException {
@@ -130,6 +183,6 @@ public class JikesOutputParser implements ExecuteStreamHandler {
      * @return if errors ocured
      */
     protected boolean getErrorFlag() {
-	return errorFlag;
+        return errorFlag;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/KeySubst.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/KeySubst.java
index 91ba077..5d3486b 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/KeySubst.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/KeySubst.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogOutputStream.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogOutputStream.java
index 4e62b2b..da66050 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogOutputStream.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogOutputStream.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogStreamHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogStreamHandler.java
index 57513bc..f5a739a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogStreamHandler.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/LogStreamHandler.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/MatchingTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/MatchingTask.java
index a115c29..08da310 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/MatchingTask.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/MatchingTask.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -68,7 +68,7 @@ import java.util.*;
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
  * @author Sam Ruby <a href="mailto:rubys@us.ibm.com">rubys@us.ibm.com</a>
  * @author Jon S. Stevens <a href="mailto:jon@clearink.com">jon@clearink.com</a>
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
 public abstract class MatchingTask extends Task {
@@ -119,7 +119,7 @@ public abstract class MatchingTask extends Task {
             "Please use the includes attribute.",
             Project.MSG_WARN);
         if (itemString == null || itemString.equals("*") 
-				               || itemString.equals(".")) {
+            || itemString.equals(".")) {
             createInclude().setName("**");
         } else {
             StringTokenizer tok = new StringTokenizer(itemString, ", ");
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Mkdir.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Mkdir.java
index e34e455..cfb6903 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Mkdir.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Mkdir.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -74,9 +74,9 @@ public class Mkdir extends Task {
         }
 
         if (dir.isFile()) {
-            log("Warning: Specified directory is a file: " + dir.getAbsolutePath());
+            throw new BuildException("Unable to create directory as a file already exists with that name: " + dir.getAbsolutePath());
         }
-	
+        
         if (!dir.exists()) {
 	    boolean result = dir.mkdirs();
 	    if (result == false) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Move.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Move.java
index 577bba2..3050461 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Move.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Move.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Patch.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Patch.java
index 9b920cb..51df7ee 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Patch.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Patch.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Property.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Property.java
index 962b7ae..f6148dc 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Property.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Property.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -55,6 +55,7 @@
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Path;
 import org.apache.tools.ant.types.Reference;
 import java.io.*;
 import java.util.*;
@@ -73,6 +74,8 @@ public class Property extends Task {
     protected String value;
     protected File file;
     protected String resource;
+    protected Path classpath;
+    protected String env;
     protected Reference ref = null;
 
     protected boolean userProperty=false; // set read-only properties
@@ -121,6 +124,33 @@ public class Property extends Task {
         return resource;
     }
 
+    public void setEnvironment(String env) {
+        this.env = env;
+    }
+
+    public String getEnvironment() {
+        return env;
+    }
+
+    public void setClasspath(Path classpath) {
+        if (this.classpath == null) {
+            this.classpath = classpath;
+        } else {
+            this.classpath.append(classpath);
+        }
+    }
+    
+    public Path createClasspath() {
+        if (this.classpath == null) {
+            this.classpath = new Path(project);
+        }
+        return this.classpath.createPath();
+    }
+    
+    public void setClasspathRef(Reference r) {
+        createClasspath().setRefid(r);
+    }
+
     public void setUserProperty(boolean userProperty) {
         this.userProperty = userProperty;
     }
@@ -139,6 +169,8 @@ public class Property extends Task {
 
             if (resource != null) loadResource(resource);
 
+            if (env != null) loadEnvironment(env);
+
             if ((name != null) && (ref != null)) {
                 Object obj = ref.getReferencedObject(getProject());
                 if (obj != null) {
@@ -178,23 +210,57 @@ public class Property extends Task {
         Properties props = new Properties();
         log("Resource Loading " + name, Project.MSG_VERBOSE);
         try {
-            InputStream is = this.getClass().getResourceAsStream(name);
+            ClassLoader cL = null; 
+            InputStream is = null;
+
+            if (classpath != null) { 
+                cL = new AntClassLoader(project, classpath, false); 
+            } else { 
+                cL = this.getClass().getClassLoader(); 
+            } 
+
+            if (cL == null) {
+                is = ClassLoader.getSystemResourceAsStream(name);
+            } else {
+                is = cL.getResourceAsStream(name);
+            }
+            
             if (is != null) {
                 props.load(is);
                 addProperties(props);
+            } else {
+                log("Unable to find resource " + name, Project.MSG_WARN);
             }
         } catch (Exception ex) {
             ex.printStackTrace();
         }
     }
 
+    protected void loadEnvironment( String prefix ) {
+        Properties props = new Properties();
+        if (!prefix.endsWith(".")) prefix += ".";
+        log("Loading Environment " + prefix, Project.MSG_VERBOSE);
+        try {
+            Vector osEnv = Execute.getProcEnvironment();
+            for (Enumeration e = osEnv.elements(); e.hasMoreElements(); ) {
+                String entry = (String)e.nextElement();
+                int pos = entry.indexOf('=');
+                props.put(prefix + entry.substring(0, pos), 
+                          entry.substring(pos + 1));
+            }
+            addProperties(props);
+        } catch (Exception ex) {
+            throw new BuildException(ex, location);
+        }
+    }
+
     protected void addProperties(Properties props) {
         resolveAllProperties(props);
         Enumeration e = props.keys();
         while (e.hasMoreElements()) {
             String name = (String) e.nextElement();
             String value = (String) props.getProperty(name);
-            String v = ProjectHelper.replaceProperties(value, project.getProperties());
+            String v = ProjectHelper.replaceProperties(project, value, project.getProperties());
             addProperty(name, value);
         }
     }
@@ -251,9 +317,9 @@ public class Property extends Task {
                 }
     
                 if (!resolved) {
-                    value = ProjectHelper.replaceProperties(value,
+                    value = ProjectHelper.replaceProperties(project, value,
                                                                project.getProperties());
-                    value = ProjectHelper.replaceProperties(value, props);
+                    value = ProjectHelper.replaceProperties(project, value, props);
                     props.put(name, value);
                 }    
             }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/PumpStreamHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/PumpStreamHandler.java
index c8902ae..f4e9ba2 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/PumpStreamHandler.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/PumpStreamHandler.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rename.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rename.java
index f2757d4..db1fa03 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rename.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rename.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Replace.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Replace.java
index 004baa2..559e156 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Replace.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Replace.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,15 +55,17 @@
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
 import java.io.*;
 import java.util.*;
 
 /**
- * Replaces all the occurrences of the given string token with the given
- * string value of the indicated files.
+ * Replaces all occurrences of one or more string tokens with given
+ * values in the indicated files. Each value can be either a string 
+ * or the value of a property available in a designated property file.
  *
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
- * @author <a href="mailto:erik@desknetinc.com">Erik Langenbach</a> 
+ * @author <a href="mailto:erik@desknetinc.com">Erik Langenbach</a>
  */
 public class Replace extends MatchingTask {
     
@@ -71,8 +73,13 @@ public class Replace extends MatchingTask {
     private NestedString token = null;
     private NestedString value = new NestedString();
 
+    private File propertyFile = null;
+    private Properties properties = null;
+    private Vector replacefilters = new Vector();
+
     private File dir = null;
-    
+   
+    //Inner class
     public class NestedString {
 
         private StringBuffer buf = new StringBuffer();
@@ -86,49 +93,184 @@ public class Replace extends MatchingTask {
         }
     }
 
+    //Inner class
+    public class Replacefilter
+    {
+        private String token;
+        private String value;
+        private String property;
+
+        public void validate() throws BuildException {
+            //Validate mandatory attributes
+            if (token == null) {
+                String message = "token is a mandatory attribute " + "of replacefilter.";
+                throw new BuildException(message);
+            }
+
+            if ("".equals(token)) {
+                String message ="The token attribute must not be an empty string.";
+                throw new BuildException(message);
+            }
+
+            //value and property are mutually exclusive attributes
+            if ((value != null) && (property != null)) {
+                String message = "Either value or property " + "can be specified, but a replacefilter " + "element cannot have both.";
+                throw new BuildException(message);
+            }
+
+            if ((property != null)) {
+                //the property attribute must have access to a property file
+                if (propertyFile == null) {
+                    String message = "The replacefilter's property attribute " + "can only be used with the replacetask's " + "propertyFile attribute.";
+                    throw new BuildException(message);
+                }
+
+                //Make sure property exists in property file
+                if (properties == null ||
+                        properties.getProperty(property) == null) {
+                    String message = "property \"" + property + "\" was not found in " + propertyFile.getPath();
+                    throw new BuildException(message);
+                }
+            }
+        }
+
+        public String getReplaceValue()
+        {
+            if (property != null) {
+                return (String)properties.getProperty(property);
+            }
+            else if (value != null) {
+                return value;
+            }
+            else if (Replace.this.value != null) {
+                return Replace.this.value.getText();
+            }
+            else {
+                //Default is empty string
+                return new String("");
+            }
+        }
+
+        public void setToken(String token) {
+            this.token = token;
+        }
+
+        public String getToken() {
+            return token;
+        }
+
+        public void setValue(String value) {
+            this.value = value;
+        }
+
+        public String getValue() {
+            return value;
+        }
+
+        public void setProperty(String property) {
+            this.property = property;
+        }
+
+        public String getProperty() {
+            return property;
+        }
+    }
+
     /**
      * Do the execution.
      */
     public void execute() throws BuildException {
-        
-        if (token == null) {
-            throw new BuildException("replace token must not be null", location);
-        }
+        validateAttributes();
 
-        if (token.getText().equals("")) {
-            throw new BuildException("replace token must not be empty", location);
+        if (propertyFile != null) {
+            properties = getProperties(propertyFile);
         }
 
-        if (src == null && dir == null) {
-            throw new BuildException("Either the file or the dir attribute must be specified", location);
-        }
-        
-        log("Replacing " + token.getText() + " --> " + value.getText());
+        validateReplacefilters();
 
         if (src != null) {
             processFile(src);
         }
-        
+
         if (dir != null) {
-	    DirectoryScanner ds = super.getDirectoryScanner(dir);
+        DirectoryScanner ds = super.getDirectoryScanner(dir);
             String[] srcs = ds.getIncludedFiles();
 
             for(int i=0; i<srcs.length; i++) {
-                File file = new File(dir,srcs[i]); 
+                File file = new File(dir,srcs[i]);
                 processFile(file);
             }
         }
     }
+    
+    /**
+     * Validate attributes provided for this task in .xml build file.
+     *
+     * @exception BuildException if any supplied attribute is invalid or any
+     * mandatory attribute is missing
+     */
+    public void validateAttributes() throws BuildException {
+        if (src == null && dir == null) {
+            String message = "Either the file or the dir attribute " + "must be specified";
+            throw new BuildException(message, location);
+        }
+        if (propertyFile != null && !propertyFile.exists()) {
+            String message = "Property file " + propertyFile.getPath() + " does not exist.";
+            throw new BuildException(message, location);
+        }
+        if (token == null && replacefilters.size() == 0) {
+            String message = "Either token or a nested replacefilter "
+                + "must be specified";
+            throw new BuildException(message, location);
+        }
+        if (token != null && "".equals(token.getText())) {
+            String message ="The token attribute must not be an empty string.";
+            throw new BuildException(message, location);
+        }
+    }
+
+    /**
+     * Validate nested elements.
+     *
+     * @exception BuildException if any supplied attribute is invalid or any
+     * mandatory attribute is missing
+     */
+    public void validateReplacefilters()
+            throws BuildException {
+        for (int i = 0; i < replacefilters.size(); i++) {
+            Replacefilter element = (Replacefilter) replacefilters.elementAt(i);
+            element.validate();
+        }
+    }
+
+    public Properties getProperties(File propertyFile) throws BuildException {
+        Properties properties = new Properties();
+
+        try {
+            properties.load(new FileInputStream(propertyFile));
+        }
+        catch (FileNotFoundException e) {
+            String message = "Property file (" + propertyFile.getPath() + ") not found.";
+            throw new BuildException(message);
+        }
+        catch (IOException e) {
+            String message = "Property file (" + propertyFile.getPath() + ") cannot be loaded.";
+            throw new BuildException(message);
+        }
+
+        return properties;
+    }
 
     /**
      * Perform the replacement on the given file.
      *
-     * The replacement is performed on a temporary file which then replaces the original file.
+     * The replacement is performed on a temporary file which then
+     * replaces the original file.
      *
      * @param src the source file
      */
     private void processFile(File src) throws BuildException {
-        if (!src.exists()) { 
+        if (!src.exists()) {
             throw new BuildException("Replace: source file " + src.getPath() + " doesn't exist", location);
         }
 
@@ -155,27 +297,39 @@ public class Replace extends MatchingTask {
             // create a String so we can use indexOf
             String buf = new String(tmpBuf);
 
-            // line separators in values and tokens are "\n"
-            // in order to compare with the file contents, replace them
-            // as needed
-            String linesep = System.getProperty("line.separator");
-            String val = stringReplace(value.getText(), "\n", linesep);
-            String tok = stringReplace(token.getText(), "\n", linesep);
+            //Preserve original string (buf) so we can compare the result
+            String newString = new String(buf);
+
+            if (token != null)
+            {
+                // line separators in values and tokens are "\n"
+                // in order to compare with the file contents, replace them
+                // as needed
+                String linesep = System.getProperty("line.separator");
+                String val = stringReplace(value.getText(), "\n", linesep);
+                String tok = stringReplace(token.getText(), "\n", linesep);
+
+                // for each found token, replace with value
+                log("Replacing in " + src.getPath() + ": " + token.getText() + " --> " + value.getText(), Project.MSG_VERBOSE);
+                newString = stringReplace(newString, tok, val);
+            }
 
-            // for each found token, replace with value
-            String  newString = stringReplace(buf, tok, val);
-            boolean changes   = !newString.equals(buf);
+            if (replacefilters.size() > 0) {
+                newString = processReplacefilters(newString, src.getPath());
+            }
 
+            boolean changes = !newString.equals(buf);
             if (changes) {
                 bw.write(newString,0,newString.length());
                 bw.flush();
             }
-            
+
             // cleanup
             bw.close();
             br.close();
 
-            // If there were changes, move the new one to the old one, otherwise, delete the new one
+            // If there were changes, move the new one to the old one;
+            // otherwise, delete the new one
             if (changes) {
                 src.delete();
                 temp.renameTo(src);
@@ -185,7 +339,21 @@ public class Replace extends MatchingTask {
         } catch (IOException ioe) {
             ioe.printStackTrace();
             throw new BuildException(ioe, location);
-        }       
+        }
+    }
+
+    private String processReplacefilters(String buffer, String filename) {
+        String newString = new String(buffer);
+
+        for (int i = 0; i < replacefilters.size(); i++) {
+            Replacefilter filter = (Replacefilter) replacefilters.elementAt(i);
+
+            //for each found token, replace with value
+            log("Replacing in " + filename + ": " + filter.getToken() + " --> " + filter.getReplaceValue(), Project.MSG_VERBOSE);
+            newString = stringReplace(newString, filter.getToken(), filter.getReplaceValue());
+        }
+
+        return newString;
     }
 
 
@@ -234,6 +402,22 @@ public class Replace extends MatchingTask {
         return value;
     }
 
+    /**
+     * Sets a file to be searched for property values.
+     */
+    public void setPropertyFile(String filename) {
+        propertyFile = project.resolveFile(filename);
+    }
+
+    /**
+     * Add nested <replacefilter> element.
+     */
+    public Replacefilter createReplacefilter() {
+        Replacefilter filter = new Replacefilter();
+        replacefilters.addElement(filter);
+        return filter;
+    }
+
     /**
      * Replace occurrences of str1 in string str with str2
      */    
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rmic.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rmic.java
index 2a1ef7a..a020fd1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rmic.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Rmic.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,11 +54,14 @@
 
 package org.apache.tools.ant.taskdefs;
 
+import org.apache.tools.ant.AntClassLoader;
 import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.DirectoryScanner;
 import org.apache.tools.ant.Project;
+import org.apache.tools.ant.types.Commandline;
 import org.apache.tools.ant.types.Path;
 import org.apache.tools.ant.types.Reference;
+import org.apache.tools.ant.util.*;
 
 import java.io.*;
 import java.util.StringTokenizer;
@@ -74,6 +77,10 @@ import java.util.Date;
  * <li>stubVersion: The version of the stub prototol to use (1.1, 1.2, compat)
  * <li>sourceBase: The base directory for the generated stubs and skeletons
  * <li>classpath: Additional classpath, appended before the system classpath
+ * <li>iiop: Generate IIOP compatable output 
+ * <li>iiopopts: Include IIOP options 
+ * <li>idl: Generate IDL output 
+ * <li>idlopts: Include IDL options 
  * </ul>
  * Of these arguments, <b>base</b> is required.
  * <p>
@@ -84,29 +91,38 @@ import java.util.Date;
  * @author duncan@x180.com
  * @author ludovic.claude@websitewatchers.co.uk
  * @author David Maclean <a href="mailto:david@cm.co.za">david@cm.co.za</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 
 public class Rmic extends MatchingTask {
 
-    private String base;
+    private File baseDir;
     private String classname;
-    private String sourceBase;
+    private File sourceBase;
     private String stubVersion;
     private Path compileClasspath;
     private boolean verify = false;
     private boolean filtering = false;
 
+    private boolean iiop = false;
+    private String  iiopopts;
+    private boolean idl  = false;
+    private String  idlopts;
+    private boolean debug  = false;
+
     private Vector compileList = new Vector();
 
-    public void setBase(String base) {
-        this.base = base;
+    private ClassLoader loader = null;
+
+    public void setBase(File base) {
+        this.baseDir = base;
     }
 
     public void setClassname(String classname) {
         this.classname = classname;
     }
 
-    public void setSourceBase(String sourceBase) {
+    public void setSourceBase(File sourceBase) {
         this.sourceBase = sourceBase;
     }
 
@@ -118,6 +134,10 @@ public class Rmic extends MatchingTask {
         filtering = filter;
     }
 
+    public void setDebug(boolean debug) {
+        this.debug = debug;
+    }
+
     /**
      * Set the classpath to be used for this compilation.
      */
@@ -154,8 +174,39 @@ public class Rmic extends MatchingTask {
         this.verify = verify;
     }
 
+    /**
+     * Indicates that IIOP compatible stubs should
+     * be generated.  This defaults to false 
+     * if not set.  
+     */
+    public void setIiop(boolean iiop) {
+        this.iiop = iiop;
+    }
+
+    /**
+     * pass additional arguments for iiop 
+     */
+    public void setIiopopts(String iiopopts) {
+        this.iiopopts = iiopopts;
+    }
+
+    /**
+     * Indicates that IDL output should be 
+     * generated.  This defaults to false 
+     * if not set.  
+     */
+    public void setIdl(boolean idl) {
+        this.idl = idl;
+    }
+
+    /**
+     * pass additional arguments for idl compile 
+     */
+    public void setIdlopts(String idlopts) {
+        this.idlopts = idlopts;
+    }
+
     public void execute() throws BuildException {
-        File baseDir = project.resolveFile(base);
         if (baseDir == null) {
             throw new BuildException("base attribute must be set!", location);
         }
@@ -166,71 +217,91 @@ public class Rmic extends MatchingTask {
         if (verify) {
             log("Verify has been turned on.", Project.MSG_INFO);
         }
-        File sourceBaseFile = null;
-        if (null != sourceBase) {
-            sourceBaseFile = project.resolveFile(sourceBase);
+        if (iiop) {
+            log("IIOP has been turned on.", Project.MSG_INFO);
+            if( iiopopts != null ) {
+                log("IIOP Options: " + iiopopts, Project.MSG_INFO );
+            }
         }
+        if (idl) {
+            log("IDL has been turned on.", Project.MSG_INFO);
+            if( idlopts != null ) {
+                log("IDL Options: " + idlopts, Project.MSG_INFO );
+            }
+        }
+
         Path classpath = getCompileClasspath(baseDir);
+        loader = new AntClassLoader(project, classpath);
 
         // scan base dirs to build up compile lists only if a
         // specific classname is not given
         if (classname == null) {
             DirectoryScanner ds = this.getDirectoryScanner(baseDir);
             String[] files = ds.getIncludedFiles();
-            scanDir(baseDir, files, verify);
+            scanDir(baseDir, files);
+        } else {
+            // otherwise perform a timestamp comparison - at least
+            scanDir(baseDir, 
+                    new String[] {classname.replace('.', File.separatorChar) + ".class"});
         }
         
         // XXX
         // need to provide an input stream that we read in from!
 
-        sun.rmi.rmic.Main compiler = new sun.rmi.rmic.Main(System.out, "rmic");
-        int argCount = 5;
-        int i = 0;
-        if (null != stubVersion) argCount++;
-        if (null != sourceBase) argCount++;
-        if (compileList.size() > 0) argCount += compileList.size() - 1;
-        String[] args = new String[argCount];
-        args[i++] = "-d";
-        args[i++] = baseDir.getAbsolutePath();
-        args[i++] = "-classpath";
-        args[i++] = classpath.toString();
+        OutputStream logstr = new LogOutputStream(this, Project.MSG_WARN);
+        sun.rmi.rmic.Main compiler = new sun.rmi.rmic.Main(logstr, "rmic");
+        Commandline cmd = new Commandline();
+        
+        cmd.createArgument().setValue("-d");
+        cmd.createArgument().setFile(baseDir);
+        cmd.createArgument().setValue("-classpath");
+        cmd.createArgument().setPath(classpath);
         if (null != stubVersion) {
             if ("1.1".equals(stubVersion))
-                args[i++] = "-v1.1";
+                cmd.createArgument().setValue("-v1.1");
             else if ("1.2".equals(stubVersion))
-                args[i++] = "-v1.2";
+                cmd.createArgument().setValue("-v1.2");
             else
-                args[i++] = "-vcompat";
+                cmd.createArgument().setValue("-vcompat");
         }
-        if (null != sourceBase) args[i++] = "-keepgenerated";
+        if (null != sourceBase)
+            cmd.createArgument().setValue("-keepgenerated");
 
-        if (classname != null) {
-            if (shouldCompile(new File(baseDir, classname.replace('.', File.separatorChar) + ".class"))) {
-                args[i++] = classname;
-                compiler.compile(args);
-            }
-        } else {
-            if (compileList.size() > 0) {
-                log("RMI Compiling " + compileList.size() +
-                    " classes to " + baseDir, Project.MSG_INFO);
+        if( iiop ) {
+            cmd.createArgument().setValue("-iiop");
+            if( iiopopts != null ) 
+                cmd.createArgument().setValue(iiopopts);
+        }
 
-                for (int j = 0; j < compileList.size(); j++) {
-                    args[i++] = (String) compileList.elementAt(j);
-                }
-                compiler.compile(args);
+        if( idl )  {
+            cmd.createArgument().setValue("-idl");
+            if( idlopts != null ) 
+                cmd.createArgument().setValue(idlopts);
+        }
+        if( debug )  {
+            cmd.createArgument().setValue("-g");
+        }
+
+        int fileCount = compileList.size();
+        if (fileCount > 0) {
+            log("RMI Compiling " + fileCount +
+                " class"+ (fileCount > 1 ? "es" : "")+" to " + baseDir, 
+                Project.MSG_INFO);
+            
+            for (int j = 0; j < fileCount; j++) {
+                cmd.createArgument().setValue((String) compileList.elementAt(j));
             }
+            log("Compilation args: " + cmd.toString(), Project.MSG_VERBOSE);
+            compiler.compile(cmd.getArguments());
         }
 
         // Move the generated source file to the base directory
         if (null != sourceBase) {
-            if (classname != null) {
-                moveGeneratedFile(baseDir, sourceBaseFile, classname);
-            } else {
-                for (int j = 0; j < compileList.size(); j++) {
-                    moveGeneratedFile(baseDir, sourceBaseFile, (String) compileList.elementAt(j));
-                }
+            for (int j = 0; j < fileCount; j++) {
+                moveGeneratedFile(baseDir, sourceBase, (String) compileList.elementAt(j));
             }
         }
+        compileList.removeAllElements();
     }
 
     /**
@@ -271,97 +342,17 @@ public class Rmic extends MatchingTask {
      * The result is returned in the class variable compileList.
      */
 
-    protected void scanDir(File baseDir, String files[], boolean shouldVerify) {
-        compileList.removeAllElements();
-        for (int i = 0; i < files.length; i++) {
-            File baseFile = new File(baseDir, files[i]);
-            if (files[i].endsWith(".class") &&
-                !files[i].endsWith("_Stub.class") &&
-                !files[i].endsWith("_Skel.class")) {
-                if (shouldCompile(baseFile)) {
-                    String classname = files[i].replace(File.separatorChar, '.');
-                    classname = classname.substring(0, classname.indexOf(".class"));
-                    boolean shouldAdd = true;
-                    if (shouldVerify) {
-                        try {
-                            Class testClass = Class.forName(classname);
-                            // One cannot RMIC an interface
-                            if (testClass.isInterface() || !isValidRmiRemote(testClass)) {
-                                shouldAdd = false;
-                            }
-                        } catch (ClassNotFoundException e) {
-                            log("Unable to verify class " + classname + 
-                                    ". It could not be found.", Project.MSG_WARN);
-                        } catch (NoClassDefFoundError e) {
-                            log("Unable to verify class " + classname + 
-                                        ". It is not defined.", Project.MSG_WARN);
-                        }
-                    }
-                    if (shouldAdd) {
-                        log("Adding: " + classname + " to compile list",
-                            Project.MSG_VERBOSE);
-                        compileList.addElement(classname);
-                    }
-                }
-            }
+    protected void scanDir(File baseDir, String files[]) {
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        String[] newFiles = sfs.restrict(files, baseDir, baseDir,
+                                         new RmicFileNameMapper());
+        for (int i = 0; i < newFiles.length; i++) {
+            String classname = newFiles[i].replace(File.separatorChar, '.');
+            classname = classname.substring(0, classname.indexOf(".class"));
+            compileList.addElement(classname);
         }
     }
-
  
-    /**
-     * Check to see if the class or superclasses/interfaces implement
-     * java.rmi.Remote.
-     */
-    private boolean isValidRmiRemote (Class testClass) {
-        Class rmiRemote = java.rmi.Remote.class;
-        
-        if (rmiRemote.equals(testClass)) {
-            // This class is java.rmi.Remote
-            return true;
-        }
-        
-        Class [] interfaces = testClass.getInterfaces();
-        if (interfaces != null) {
-            for (int i = 0; i < interfaces.length; i++) {
-                if (rmiRemote.equals(interfaces[i])) {
-                    // This class directly implements java.rmi.Remote
-                    return true;
-                }
-                if (isValidRmiRemote(interfaces[i])) {
-                    return true;
-                }
-            }
-        }
-        return false;
-    }
-
-    /**
-     * Determine whether the class needs to be RMI compiled. It looks at the _Stub.class
-     * and _Skel.class files' last modification date and compares it with the class' class file.
-     */
-    private boolean shouldCompile (File classFile) {
-        long now = (new Date()).getTime();
-        File stubFile = new File(classFile.getAbsolutePath().substring(0,
-                classFile.getAbsolutePath().indexOf(".class")) + "_Stub.class");
-        File skelFile = new File(classFile.getAbsolutePath().substring(0,
-                classFile.getAbsolutePath().indexOf(".class")) + "_Skel.class");
-        if (classFile.exists()) {
-            if (classFile.lastModified() > now) {
-                log("Warning: file modified in the future: " +
-                    classFile, Project.MSG_WARN);
-            }
-
-            if (classFile.lastModified() > stubFile.lastModified()) {
-                return true;
-            } else if (classFile.lastModified() > skelFile.lastModified()) {
-                return true;
-            } else {
-                return false;
-            }
-        }
-        return true;
-    }
-
     /**
      * Builds the compilation classpath.
      */
@@ -374,15 +365,14 @@ public class Rmic extends MatchingTask {
         // untouched classes are on classpath
         Path classpath = new Path(project, baseFile.getAbsolutePath());
 
-        // add our classpath to the mix
-
-        if (compileClasspath != null) {
-            classpath.addExisting(compileClasspath);
+        // Combine the build classpath with the system classpath, in an 
+        // order determined by the value of build.classpath
+        if (compileClasspath == null) {
+            classpath.addExisting(Path.systemClasspath);
+        } else {
+            classpath.addExisting(compileClasspath.concatSystemClasspath());
         }
 
-        // add the system classpath
-        classpath.addExisting(Path.systemClasspath);
-
         // in jdk 1.2, the system classes are not on the visible classpath.
         if (Project.getJavaVersion().startsWith("1.2")) {
             String bootcp = System.getProperty("sun.boot.class.path");
@@ -393,5 +383,102 @@ public class Rmic extends MatchingTask {
         return classpath;
     }
 
+    /**
+     * Mapper that possibly returns two file names, *_Stub and *_Skel.
+     */
+    private class RmicFileNameMapper implements FileNameMapper {
+
+        private GlobPatternMapper stubMapper;
+        private GlobPatternMapper skelMapper;
+
+        RmicFileNameMapper() {
+            stubMapper = new GlobPatternMapper();
+            stubMapper.setFrom("*.class");
+            stubMapper.setTo("*_Stub.class");
+
+            // no _Skel file in stub version 1.2
+            if (!"1.2".equals(stubVersion)) {
+                skelMapper = new GlobPatternMapper();
+                skelMapper.setFrom("*.class");
+                skelMapper.setTo("*_Skel.class");
+            }
+        }
+
+        /**
+         * Empty implementation.
+         */
+        public void setFrom(String s) {}
+        /**
+         * Empty implementation.
+         */
+        public void setTo(String s) {}
+
+        public String[] mapFileName(String name) {
+            String[] stubName = stubMapper.mapFileName(name);
+
+            if (stubName == null || name.endsWith("_Stub.class") 
+                || name.endsWith("_Skel.class")) {
+                // Not a .class file
+                return null;
+            }
+
+            String classname = name.replace(File.separatorChar, '.');
+            classname = classname.substring(0, classname.indexOf(".class"));
+            if (verify) {
+                try {
+                    Class testClass = loader.loadClass(classname);
+                    // One cannot RMIC an interface
+                    if (testClass.isInterface() || 
+                        !isValidRmiRemote(testClass)) {
+                        return null;
+                    }
+                } catch (ClassNotFoundException e) {
+                    log("Unable to verify class " + classname + 
+                        ". It could not be found.", Project.MSG_WARN);
+                } catch (NoClassDefFoundError e) {
+                    log("Unable to verify class " + classname + 
+                        ". It is not defined.", Project.MSG_WARN);
+                }
+            }
+
+            if (skelMapper != null) {
+                return new String[] {
+                    stubName[0], 
+                    skelMapper.mapFileName(name)[0]
+                };
+            } else {
+                return stubName;
+            }
+        }
+
+        /**
+         * Check to see if the class or superclasses/interfaces implement
+         * java.rmi.Remote.
+         */
+        private boolean isValidRmiRemote (Class testClass) {
+            Class rmiRemote = java.rmi.Remote.class;
+            
+            if (rmiRemote.equals(testClass)) {
+                // This class is java.rmi.Remote
+                return true;
+            }
+            
+            Class [] interfaces = testClass.getInterfaces();
+            if (interfaces != null) {
+                for (int i = 0; i < interfaces.length; i++) {
+                    if (rmiRemote.equals(interfaces[i])) {
+                        // This class directly implements java.rmi.Remote
+                        return true;
+                    }
+                    if (isValidRmiRemote(interfaces[i])) {
+                        return true;
+                    }
+                }
+            }
+            return false;
+        }
+        
+    }
+
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SQLExec.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SQLExec.java
index bb516ca..78d7173 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SQLExec.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SQLExec.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -325,12 +325,14 @@ public class SQLExec extends Task {
         try {
             Class dc;
             if (classpath != null) {
-		log("Loading " + driver + " using AntClassLoader with classpath " + classpath, Project.MSG_VERBOSE);
+                log( "Loading " + driver + " using AntClassLoader with classpath " + classpath, 
+                     Project.MSG_VERBOSE );
+
                 loader = new AntClassLoader(project, classpath, false);
                 dc = loader.loadClass(driver);
             }
             else {
-		log("Loading " + driver + " using system loader.", Project.MSG_VERBOSE);
+                log("Loading " + driver + " using system loader.", Project.MSG_VERBOSE);
                 dc = Class.forName(driver);
             }
             driverInstance = (Driver) dc.newInstance();
@@ -360,16 +362,30 @@ public class SQLExec extends Task {
 
             statement = conn.createStatement();
 
-            // Process all transactions
-            for (Enumeration e = transactions.elements(); 
-                 e.hasMoreElements();) {
-                ((Transaction) e.nextElement()).runTransaction();
-                if (!autocommit) {
-                    log("Commiting transaction", Project.MSG_VERBOSE);
-                    conn.commit();
+            
+            PrintStream out = System.out;
+            try {
+                if (output != null) {
+                    log("Opening PrintStream to output file " + output, Project.MSG_VERBOSE);
+                    out = new PrintStream(new BufferedOutputStream(new FileOutputStream(output)));
+                }
+                        
+                // Process all transactions
+                for (Enumeration e = transactions.elements(); 
+                     e.hasMoreElements();) {
+                       
+                    ((Transaction) e.nextElement()).runTransaction(out);
+                    if (!autocommit) {
+                        log("Commiting transaction", Project.MSG_VERBOSE);
+                        conn.commit();
+                    }
+                }
+            }
+            finally {
+                if (out != null && out != System.out) {
+                    out.close();
                 }
             }
-            
         } catch(IOException e){
             if (!autocommit && conn != null && onError.equals("abort")) {
                 try {
@@ -401,7 +417,7 @@ public class SQLExec extends Task {
             " SQL statements executed successfully");
     }
 
-    protected void runStatements(Reader reader) throws SQLException, IOException {
+    protected void runStatements(Reader reader, PrintStream out) throws SQLException, IOException {
         String sql = "";
         String line = "";
  
@@ -422,14 +438,14 @@ public class SQLExec extends Task {
 
                 if (sql.endsWith(";")){
                     log("SQL: " + sql, Project.MSG_VERBOSE);
-                    execSQL(sql.substring(0, sql.length()-1));
+                    execSQL(sql.substring(0, sql.length()-1), out);
                     sql = "";
                 }
             }
  
             // Catch any statements not followed by ;
             if(!sql.equals("")){
-                execSQL(sql);
+                execSQL(sql, out);
             }
         }catch(SQLException e){
             throw e;
@@ -481,7 +497,7 @@ public class SQLExec extends Task {
     /**
      * Exec the sql statement.
      */
-    protected void execSQL(String sql) throws SQLException {
+    protected void execSQL(String sql, PrintStream out) throws SQLException {
         // Check and ignore empty statements
         if ("".equals(sql.trim())) return;
         
@@ -493,7 +509,7 @@ public class SQLExec extends Task {
             }
             
             if (print) {
-                printResults();
+                printResults(out);
             }
             
             SQLWarning warning = conn.getWarnings();
@@ -514,48 +530,47 @@ public class SQLExec extends Task {
     /**
      * print any results in the statement.
      */
-    protected void printResults() throws java.sql.SQLException {
+    protected void printResults(PrintStream out) throws java.sql.SQLException {
         ResultSet rs = null;
-        PrintStream out = System.out;
-        try {
-            if (output != null) {
-		log("Opening PrintStream to output file " + output, Project.MSG_VERBOSE);
-                out = new PrintStream(new BufferedOutputStream(new FileOutputStream(output)));
-            }
-            while ((rs = statement.getResultSet()) != null) {
-		log("Processing new result set.", Project.MSG_VERBOSE);
+        do {
+            rs = statement.getResultSet();
+            if (rs != null) {
+      	        log("Processing new result set.", Project.MSG_VERBOSE);
                 ResultSetMetaData md = rs.getMetaData();
                 int columnCount = md.getColumnCount();
                 StringBuffer line = new StringBuffer();
                 if (showheaders) {
                     for (int col = 1; col < columnCount; col++) {
-                        line.append(md.getColumnName(col));
-                        line.append(",");
+                         line.append(md.getColumnName(col));
+                         line.append(",");
                     }
                     line.append(md.getColumnName(columnCount));
                     out.println(line);
                     line.setLength(0);
                 }
                 while (rs.next()) {
-                    for (int col = 1; col < columnCount; col++) {
-                        line.append(rs.getString(col).trim());
-                        line.append(",");
+                    boolean first = true;
+                    for (int col = 1; col <= columnCount; col++) {
+                        String columnValue = rs.getString(col);
+                        if (columnValue != null) {
+                            columnValue = columnValue.trim();
+                        }
+                         
+                        if (first) {
+                            first = false;
+                        }
+                        else {
+                            line.append(",");
+                        }
+                        line.append(columnValue);
                     }
-                    line.append(rs.getString(columnCount).trim());
                     out.println(line);
                     line.setLength(0);
                 }
-                statement.getMoreResults();
-            }
-        }
-        catch (IOException ioe) {
-            throw new BuildException("Error writing " + output.getAbsolutePath(), ioe, location);
-        }
-        finally {
-            if (out != null && out != System.out) {
-                out.close();
             }
         }
+        while (statement.getMoreResults());
+        out.println();
     }
 
     /**
@@ -586,16 +601,18 @@ public class SQLExec extends Task {
             this.tSqlCommand += sql;
         }
 
-        private void runTransaction() throws IOException, SQLException {
+        private void runTransaction(PrintStream out) throws IOException, SQLException {
             if (tSqlCommand.length() != 0) {
                 log("Executing commands", Project.MSG_INFO);
-                runStatements(new StringReader(tSqlCommand));
+                runStatements(new StringReader(tSqlCommand), out);
             }
       
             if (tSrcFile != null) {
                 log("Executing file: " + tSrcFile.getAbsolutePath(), 
                     Project.MSG_INFO);
-                runStatements(new FileReader(tSrcFile));
+                FileReader reader = new FileReader(tSrcFile);
+                runStatements(reader, out);
+                reader.close();
             }
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SendEmail.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SendEmail.java
index 6a64584..f345044 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SendEmail.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SendEmail.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SignJar.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SignJar.java
index 16f409f..3e85034 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SignJar.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/SignJar.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -53,14 +53,14 @@
  */
 package org.apache.tools.ant.taskdefs;
 
+import java.io.File;
 import org.apache.tools.ant.*;
 import org.apache.tools.ant.types.Commandline;
-import java.io.File;
 
 /**
  * Sign a archive.
  * 
- * @author Peter Donald <a href="mailto:donaldp@mad.scientist.com">donaldp@mad.scientist.com</a>
+ * @author Peter Donald <a href="mailto:donaldp@apache.org">donaldp@apache.org</a>
  */
 public class SignJar extends Task {
 
@@ -119,16 +119,16 @@ public class SignJar extends Task {
         this.signedjar = signedjar;
     } 
 
-    public void setVerbose(final String verbose) {
-        this.verbose = project.toBoolean(verbose);
+    public void setVerbose(final boolean verbose) {
+        this.verbose = verbose;
     } 
 
-    public void setInternalsf(final String internalsf) {
-        this.internalsf = project.toBoolean(internalsf);
+    public void setInternalsf(final boolean internalsf) {
+        this.internalsf = internalsf;
     } 
 
-    public void setSectionsonly(final String sectionsonly) {
-        this.sectionsonly = project.toBoolean(sectionsonly);
+    public void setSectionsonly(final boolean sectionsonly) {
+        this.sectionsonly = sectionsonly;
     } 
 
     public void execute() throws BuildException {
@@ -148,72 +148,81 @@ public class SignJar extends Task {
             throw new BuildException("storepass attribute must be set");
         } 
 
-        final StringBuffer sb = new StringBuffer();
+        if(isUpToDate()) return;
 
-        sb.append("jarsigner ");
+        final StringBuffer sb = new StringBuffer();
 
+        final ExecTask cmd = (ExecTask) project.createTask("exec");
+        cmd.setExecutable("jarsigner");
+        
         if (null != keystore) {
-            sb.append("-keystore \"");
-            sb.append(keystore);
-            sb.append("\" ");
+            cmd.createArg().setValue("-keystore");
+            cmd.createArg().setValue(keystore);
         } 
 
         if (null != storepass) {
-            sb.append("-storepass \"");
-            sb.append(storepass);
-            sb.append("\" ");
+            cmd.createArg().setValue("-storepass");
+            cmd.createArg().setValue(storepass);
         } 
 
         if (null != storetype) {
-            sb.append("-storetype \"");
-            sb.append(storetype);
-            sb.append("\" ");
+            cmd.createArg().setValue("-storetype");
+            cmd.createArg().setValue(storetype);
         } 
 
         if (null != keypass) {
-            sb.append("-keypass \"");
-            sb.append(keypass);
-            sb.append("\" ");
+            cmd.createArg().setValue("-keypass");
+            cmd.createArg().setValue(keypass);
         } 
 
         if (null != sigfile) {
-            sb.append("-sigfile \"");
-            sb.append(sigfile);
-            sb.append("\" ");
+            cmd.createArg().setValue("-sigfile");
+            cmd.createArg().setValue(sigfile);
         } 
 
         if (null != signedjar) {
-            sb.append("-signedjar \"");
-            sb.append(signedjar);
-            sb.append("\" ");
+            cmd.createArg().setValue("-signedjar");
+            cmd.createArg().setValue(signedjar);
         } 
 
         if (verbose) {
-            sb.append("-verbose ");
+            cmd.createArg().setValue("-verbose");
         } 
 
         if (internalsf) {
-            sb.append("-internalsf ");
+            cmd.createArg().setValue("-internalsf");
         } 
 
         if (sectionsonly) {
-            sb.append("-sectionsonly ");
+            cmd.createArg().setValue("-sectionsonly");
         } 
 
-        sb.append('\"');
-        sb.append(jar);
-        sb.append("\" ");
+        cmd.createArg().setValue(jar);
         
-        sb.append('\"');
-        sb.append(alias);
-        sb.append("\" ");
+
+        cmd.createArg().setValue(alias);
 
         log("Signing Jar : " + (new File(jar)).getAbsolutePath());
-        final ExecTask cmd = (ExecTask) project.createTask("exec");
-        cmd.setCommand(new Commandline(sb.toString()));
         cmd.setFailonerror(true);
         cmd.setTaskName( getTaskName() );
         cmd.execute();
-    } 
+    }
+
+    protected boolean isUpToDate() {
+
+        if( null != jar && null != signedjar ) {
+
+            final File jarFile = new File(jar);
+            final File signedjarFile = new File(signedjar);
+            
+            if(!jarFile.exists()) return false;
+            if(!signedjarFile.exists()) return false;
+            if(jarFile.equals(signedjarFile)) return false;
+            if(signedjarFile.lastModified() > jarFile.lastModified())
+                return true;
+        }
+
+        return false;
+    }
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/StreamPumper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/StreamPumper.java
index 5ccc083..be4ad79 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/StreamPumper.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/StreamPumper.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tar.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tar.java
index 8d174b8..da11839 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tar.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tar.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,32 +55,82 @@
 package org.apache.tools.ant.taskdefs;
 
 import java.io.*;
+import java.util.*;
 import org.apache.tools.ant.*;
+import org.apache.tools.ant.util.*;
 import org.apache.tools.tar.*;
+import org.apache.tools.ant.types.*;
 
 /**
  * Creates a TAR archive.
  *
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
 public class Tar extends MatchingTask {
 
+    // permissable values for longfile attribute
+    static public final String WARN = "warn";
+    static public final String FAIL = "fail";
+    static public final String TRUNCATE = "truncate";
+    static public final String GNU = "gnu";
+    static public final String OMIT = "omit";
+
+    private String[] validModes = new String[] {WARN, FAIL, TRUNCATE, GNU, OMIT};
+
     File tarFile;
     File baseDir;
     
+    String longFileMode = WARN;
+    
+    Vector filesets = new Vector();
+    Vector fileSetFiles = new Vector();
+    
+    /**
+     * Indicates whether the user has been warned about long files already.
+     */
+    private boolean longWarningGiven = false;
+
+    public TarFileSet createTarFileSet() {
+        TarFileSet fileset = new TarFileSet();
+        filesets.addElement(fileset);
+        return fileset;
+    }
+    
+    
     /**
      * This is the name/location of where to create the tar file.
      */
-    public void setTarfile(String tarFilename) {
-        tarFile = project.resolveFile(tarFilename);
+    public void setTarfile(File tarFile) {
+        this.tarFile = tarFile;
     }
     
     /**
      * This is the base directory to look in for things to tar.
      */
-    public void setBasedir(String baseDirname) {
-        baseDir = project.resolveFile(baseDirname);
+    public void setBasedir(File baseDir) {
+        this.baseDir = baseDir;
+    }
+    
+    /**
+     * Set how to handle long files.
+     *
+     * Allowable values are
+     *   truncate - paths are truncated to the maximum length
+     *   fail - patsh greater than the maximim cause a build exception
+     *   warn - paths greater than the maximum cause a warning and GNU is used
+     *   gnu - GNU extensions are used for any paths greater than the maximum.
+     *   omit - paths greater than the maximum are omitted from the archive
+     */
+    public void setLongfile(String mode) {
+        for (int i = 0; i < validModes.length; ++i) {
+            if (mode.equalsIgnoreCase(validModes[i])) {
+                this.longFileMode = mode;
+                return;
+            }
+        }
+        throw new BuildException("The longfile value " + mode + " is not a valid value");
     }
 
     public void execute() throws BuildException {
@@ -89,53 +139,134 @@ public class Tar extends MatchingTask {
                                      location);
         }
 
-        if (baseDir == null) {
-            throw new BuildException("basedir attribute must be set!", 
+        if (tarFile.exists() && tarFile.isDirectory()) {
+            throw new BuildException("tarfile is a directory!", 
                                      location);
         }
-        if (!baseDir.exists()) {
-            throw new BuildException("basedir does not exist!", location);
+
+        if (tarFile.exists() && !tarFile.canWrite()) {
+            throw new BuildException("Can not write to the specified tarfile!", 
+                                     location);
         }
 
-        log("Building tar: "+ tarFile.getAbsolutePath());
+        if (baseDir != null) {
+            if (!baseDir.exists()) {
+                throw new BuildException("basedir does not exist!", location);
+            }
+            
+            // add the main fileset to the list of filesets to process.
+            TarFileSet mainFileSet = new TarFileSet(fileset);
+            mainFileSet.setDir(baseDir);
+            mainFileSet.setDefaultexcludes(useDefaultExcludes);
+            filesets.addElement(mainFileSet);
+        }
+        
+        if (filesets.size() == 0) {
+            throw new BuildException("You must supply either a basdir attribute or some nested filesets.", 
+                                     location);
+        }
+        
+        // check if tr is out of date with respect to each
+        // fileset
+        boolean upToDate = true;
+        for (Enumeration e = filesets.elements(); e.hasMoreElements();) {
+            TarFileSet fs = (TarFileSet)e.nextElement();
+            String[] files = fs.getFiles(project);
+            
+            if (!archiveIsUpToDate(files)) {
+                upToDate = false;
+            }
+            
+            for (int i = 0; i < files.length; ++i) {
+                if (tarFile.equals(new File(fs.getDir(project), files[i]))) {
+                    throw new BuildException("A tar file cannot include itself", location);
+                }
+            }
+        }
 
-        DirectoryScanner ds = super.getDirectoryScanner(baseDir);
+        if (upToDate) {
+            log("Nothing to do: "+tarFile.getAbsolutePath()+" is up to date.",
+                Project.MSG_INFO);
+            return;
+        }
 
-        String[] files = ds.getIncludedFiles();
+        log("Building tar: "+ tarFile.getAbsolutePath(), Project.MSG_INFO);
 
         TarOutputStream tOut = null;
         try {
             tOut = new TarOutputStream(new FileOutputStream(tarFile));
             tOut.setDebug(true);
-
-            for (int i = 0; i < files.length; i++) {
-                File f = new File(baseDir,files[i]);
-                String name = files[i].replace(File.separatorChar,'/');
-                tarFile(f, tOut, name);
+            if (longFileMode.equalsIgnoreCase(TRUNCATE)) {
+                tOut.setLongFileMode(TarOutputStream.LONGFILE_TRUNCATE);
+            }
+            else if (longFileMode.equalsIgnoreCase(FAIL) ||
+                     longFileMode.equalsIgnoreCase(OMIT)) {
+                tOut.setLongFileMode(TarOutputStream.LONGFILE_ERROR);
+            }
+            else {
+                // warn or GNU
+                tOut.setLongFileMode(TarOutputStream.LONGFILE_GNU);
+            }
+        
+            longWarningGiven = false;
+            for (Enumeration e = filesets.elements(); e.hasMoreElements();) {
+                TarFileSet fs = (TarFileSet)e.nextElement();
+                String[] files = fs.getFiles(project);
+                for (int i = 0; i < files.length; i++) {
+                    File f = new File(baseDir,files[i]);
+                    String name = files[i].replace(File.separatorChar,'/');
+                    tarFile(f, tOut, name, fs);
+                }
             }
         } catch (IOException ioe) {
             String msg = "Problem creating TAR: " + ioe.getMessage();
             throw new BuildException(msg, ioe, location);
-	} finally {
-	    if (tOut != null) {
-	        try {
+        } finally {
+            if (tOut != null) {
+                try {
                     // close up
-	            tOut.close();
-	        }
-	        catch (IOException e) {}
-	    }
+                    tOut.close();
+                }
+                catch (IOException e) {}
+            }
         }
     }
 
-    protected void tarFile(File file, TarOutputStream tOut, String vPath)
+    protected void tarFile(File file, TarOutputStream tOut, String vPath,
+                           TarFileSet tarFileSet)
         throws IOException
     {
         FileInputStream fIn = new FileInputStream(file);
 
         try {
+            if (vPath.length() >= TarConstants.NAMELEN) {
+                if (longFileMode.equalsIgnoreCase(OMIT)) {
+                    log("Omitting: "+ vPath, Project.MSG_INFO);
+                    return;
+                } else if (longFileMode.equalsIgnoreCase(WARN)) {
+                    log("Entry: "+ vPath + " longer than " + 
+                        TarConstants.NAMELEN + " characters.", Project.MSG_WARN);
+                    if (!longWarningGiven) {                        
+                        log("Resulting tar file can only be processed successfully"
+                            + " by GNU compatible tar commands", Project.MSG_WARN);
+                        longWarningGiven = true;
+                    }
+                } else if (longFileMode.equalsIgnoreCase(FAIL)) {
+                    throw new BuildException(
+                        "Entry: "+ vPath + " longer than " + 
+                        TarConstants.NAMELEN + "characters.", location);
+                }
+            }
+
             TarEntry te = new TarEntry(vPath);
             te.setSize(file.length());
             te.setModTime(file.lastModified());
+            if (!file.isDirectory()) {
+                te.setMode(tarFileSet.getMode());
+            }
+            te.setUserName(tarFileSet.getUserName());
+            te.setGroupName(tarFileSet.getGroup());
+            
             tOut.putNextEntry(te);
             
             byte[] buffer = new byte[8 * 1024];
@@ -150,4 +281,63 @@ public class Tar extends MatchingTask {
             fIn.close();
         }
     }
+
+    protected boolean archiveIsUpToDate(String[] files) {
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        MergingMapper mm = new MergingMapper();
+        mm.setTo(tarFile.getAbsolutePath());
+        return sfs.restrict(files, baseDir, null, mm).length == 0;
+    }
+
+    static public class TarFileSet extends FileSet {
+        private String[] files = null;
+        
+        private int mode = 0100644;
+        
+        private String userName = "";
+        private String groupName = "";
+        
+           
+        public TarFileSet(FileSet fileset) {
+            super(fileset);
+        }
+        
+        public TarFileSet() {
+            super();
+        }
+        
+        public String[] getFiles(Project p) {
+            if (files == null) {
+                DirectoryScanner ds = getDirectoryScanner(p);
+                files = ds.getIncludedFiles();
+            }
+            
+            return files;
+        }
+        
+        public void setMode(String octalString) {
+            this.mode = 0100000 | Integer.parseInt(octalString, 8);
+        }
+            
+        public int getMode() {
+            return mode;
+        }
+        
+        public void setUserName(String userName) {
+            this.userName = userName;
+        }
+        
+        public String getUserName() {
+            return userName;
+        }
+        
+        public void setGroup(String groupName) {
+            this.groupName = groupName;
+        }
+        
+        public String getGroup() {
+            return groupName;
+        }
+        
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/TaskOutputStream.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/TaskOutputStream.java
index 70750ec..b15d54a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/TaskOutputStream.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/TaskOutputStream.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Taskdef.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Taskdef.java
index fcb5bb7..c728f2a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Taskdef.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Taskdef.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -87,52 +87,52 @@ public class Taskdef extends Task {
     }
 
     public void execute() throws BuildException {
-	    if (name==null || value==null ) {
-		String msg = "name or classname attributes of taskdef element "
-		    + "are undefined";
-		throw new BuildException(msg);
-	    }
-	    try {
-                ClassLoader loader = null;
-                if (classpath != null) {
-                    AntClassLoader al = new AntClassLoader(project, classpath,
-                                                           false);
-                    // need to load Task via system classloader or the new
-                    // task we want to define will never be a Task but always
-                    // be wrapped into a TaskAdapter.
-                    al.addSystemPackageRoot("org.apache.tools.ant");
-                    loader = al;
-                } else {
-                    loader = this.getClass().getClassLoader();
-                }
+        if (name==null || value==null ) {
+            String msg = "name or classname attributes of taskdef element "
+                + "are undefined";
+            throw new BuildException(msg);
+        }
+        try {
+            ClassLoader loader = null;
+            if (classpath != null) {
+                AntClassLoader al = new AntClassLoader(project, classpath,
+                                                       false);
+                // need to load Task via system classloader or the new
+                // task we want to define will never be a Task but always
+                // be wrapped into a TaskAdapter.
+                al.addSystemPackageRoot("org.apache.tools.ant");
+                loader = al;
+            } else {
+                loader = this.getClass().getClassLoader();
+            }
 
-                Class taskClass = null;
-                if (loader != null) {
-                    taskClass = loader.loadClass(value);
-                } else {
-                    taskClass = Class.forName(value);
-                }
-                project.addTaskDefinition(name, taskClass);
-	    } catch (ClassNotFoundException cnfe) {
-		String msg = "taskdef class " + value +
-		    " cannot be found";
-		throw new BuildException(msg, cnfe, location);
-	    } catch (NoClassDefFoundError ncdfe) {
-		String msg = "taskdef class " + value +
-		    " cannot be found";
-		throw new BuildException(msg, ncdfe, location);
-	    }
+            Class taskClass = null;
+            if (loader != null) {
+                taskClass = loader.loadClass(value);
+            } else {
+                taskClass = Class.forName(value);
+            }
+            project.addTaskDefinition(name, taskClass);
+        } catch (ClassNotFoundException cnfe) {
+            String msg = "taskdef class " + value +
+                " cannot be found";
+            throw new BuildException(msg, cnfe, location);
+        } catch (NoClassDefFoundError ncdfe) {
+            String msg = "taskdef class " + value +
+                " cannot be found";
+            throw new BuildException(msg, ncdfe, location);
+        }
     }
     
     public void setName( String name) {
-	this.name = name;
+        this.name = name;
     }
 
     public String getClassname() {
-	return value;
+        return value;
     }
 
     public void setClassname(String v) {
-	value = v;
+        value = v;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Touch.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Touch.java
index 1d158be..b12fc02 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Touch.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Touch.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Transform.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Transform.java
new file mode 100644
index 0000000..c489282
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Transform.java
@@ -0,0 +1,246 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs;
+
+import java.io.File;
+import java.util.Hashtable;
+import java.util.Vector;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.util.*;
+
+/**
+ * Executes a given command, supplying a set of files as arguments. 
+ *
+ * <p>Only those files that are newer than their corresponding target
+ * files will be handeled, the rest will be ignored.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class Transform extends ExecuteOn {
+
+    protected Commandline.Marker targetFilePos = null;
+    protected Mapper mapperElement = null;
+    protected FileNameMapper mapper = null;
+    protected File destDir = null;
+
+    /**
+     * Has &lt;srcfile&gt; been specified before &lt;targetfile&gt;
+     */
+    protected boolean srcIsFirst = true;
+
+    /**
+     * Set the destination directory.
+     */
+    public void setDest(File destDir) {
+        this.destDir = destDir;
+    }
+
+    /**
+     * Marker that indicates where the name of the target file should
+     * be put on the command line.
+     */
+    public Commandline.Marker createTargetfile() {
+        if (targetFilePos != null) {
+            throw new BuildException(taskType + " doesn\'t support multiple targetfile elements.",
+                                     location);
+        }
+        targetFilePos = cmdl.createMarker();
+        srcIsFirst = (srcFilePos != null);
+        return targetFilePos;
+    }
+
+    /**
+     * Defines the FileNameMapper to use (nested mapper element).
+     */
+    public Mapper createMapper() throws BuildException {
+        if (mapperElement != null) {
+            throw new BuildException("Cannot define more than one mapper",
+                                     location);
+        }
+        mapperElement = new Mapper(project);
+        return mapperElement;
+    }
+
+    protected void checkConfiguration() {
+        super.checkConfiguration();
+        if (mapperElement == null) {
+            throw new BuildException("no mapper specified", location);
+        }
+        if (destDir == null) {
+            throw new BuildException("no dest attribute specified", location);
+        }
+
+        mapper = mapperElement.getImplementation();
+    }
+
+    /**
+     * Return the list of files from this DirectoryScanner that should
+     * be included on the command line - i.e. only those that are
+     * newer than the corresponding target files.
+     */
+    protected String[] getFiles(File baseDir, DirectoryScanner ds) {
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        return sfs.restrict(ds.getIncludedFiles(), baseDir, destDir, mapper);
+    }
+
+    /**
+     * Return the list of Directories from this DirectoryScanner that
+     * should be included on the command line - i.e. only those that
+     * are newer than the corresponding target files.
+     */
+    protected String[] getDirs(File baseDir, DirectoryScanner ds) {
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        return sfs.restrict(ds.getIncludedDirectories(), baseDir, destDir, 
+                            mapper);
+    }
+
+    /**
+     * Construct the command line for parallel execution.
+     *
+     * @param srcFiles The filenames to add to the commandline
+     * @param baseDir filenames are relative to this dir
+     */
+    protected String[] getCommandline(String[] srcFiles, File baseDir) {
+        if (targetFilePos == null) {
+            return super.getCommandline(srcFiles, baseDir);
+        }
+
+        Vector targets = new Vector();
+        Hashtable addedFiles = new Hashtable();
+        for (int i=0; i<srcFiles.length; i++) {
+            String[] subTargets = mapper.mapFileName(srcFiles[i]);
+            if (subTargets != null) {
+                for (int j=0; j<subTargets.length; j++) {
+                    String name = (new File(destDir, subTargets[j])).getAbsolutePath();
+                    if (!addedFiles.contains(name)) {
+                        targets.addElement(name);
+                        addedFiles.put(name, name);
+                    }
+                }
+            }
+        }
+        String[] targetFiles = new String[targets.size()];
+        targets.copyInto(targetFiles);
+        
+        String[] orig = cmdl.getCommandline();
+        String[] result = new String[orig.length+srcFiles.length+targetFiles.length];
+
+        int srcIndex = orig.length;
+        if (srcFilePos != null) {
+            srcIndex = srcFilePos.getPosition();
+        }
+        int targetIndex = targetFilePos.getPosition();
+
+        if (srcIndex < targetIndex || (srcIndex == targetIndex && srcIsFirst)) {
+            // 0 --> srcIndex
+            System.arraycopy(orig, 0, result, 0, srcIndex);
+
+            // srcIndex --> targetIndex
+            System.arraycopy(orig, srcIndex, result, 
+                             srcIndex + srcFiles.length,
+                             targetIndex - srcIndex);
+
+            // targets are already absolute file names
+            System.arraycopy(targetFiles, 0, result, 
+                             targetIndex + srcFiles.length, 
+                             targetFiles.length);
+
+            // targetIndex --> end
+            System.arraycopy(orig, targetIndex, result, 
+                             targetIndex + srcFiles.length + targetFiles.length,
+                             orig.length - targetIndex);
+        } else {
+            // 0 --> targetIndex
+            System.arraycopy(orig, 0, result, 0, targetIndex);
+
+            // targets are already absolute file names
+            System.arraycopy(targetFiles, 0, result, 
+                             targetIndex,
+                             targetFiles.length);
+
+            // targetIndex --> srcIndex
+            System.arraycopy(orig, targetIndex, result, 
+                             targetIndex + targetFiles.length,
+                             srcIndex - targetIndex);
+
+            // srcIndex --> end
+            System.arraycopy(orig, srcIndex, result, 
+                             srcIndex + srcFiles.length + targetFiles.length,
+                             orig.length - srcIndex);
+            srcIndex += targetFiles.length;
+        }
+
+
+        for (int i=0; i < srcFiles.length; i++) {
+            result[srcIndex+i] = 
+                (new File(baseDir, srcFiles[i])).getAbsolutePath();
+        }
+        return result;
+        
+    }
+
+    /**
+     * Construct the command line for serial execution.
+     *
+     * @param srcFile The filename to add to the commandline
+     * @param baseDir filename is relative to this dir
+     */
+    protected String[] getCommandline(String srcFile, File baseDir) {
+        return getCommandline(new String[] {srcFile}, baseDir);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tstamp.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tstamp.java
index 985dddf..a994cb0 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tstamp.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Tstamp.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -64,8 +64,12 @@ import java.text.*;
  *
  * @author costin@dnt.ro
  * @author stefano@apache.org
+ * @author roxspring@yahoo.com
+ * @author conor@cognet.com.au
  */
 public class Tstamp extends Task {
+    
+    private Vector customFormats = new Vector();
 
     public void execute() throws BuildException {
         try {
@@ -79,8 +83,100 @@ public class Tstamp extends Task {
 
             SimpleDateFormat today  = new SimpleDateFormat ("MMMM d yyyy", Locale.US);
             project.setProperty("TODAY", today.format(d));
+            
+            Enumeration i = customFormats.elements();
+            while(i.hasMoreElements())
+            {
+                CustomFormat cts = (CustomFormat)i.nextElement();
+                cts.execute(project,d, location);
+            }
+            
         } catch (Exception e) {
             throw new BuildException(e);
         }
     }
+    
+    public CustomFormat createFormat()
+    {
+        CustomFormat cts = new CustomFormat();
+        customFormats.addElement(cts);
+        return cts;
+    }
+    
+    public class CustomFormat
+    {
+        private String propertyName;
+        private String pattern;
+        private int offset = 0;
+        private int field = Calendar.DATE;
+        
+        public CustomFormat()
+        {
+        }
+        
+        public void setProperty(String propertyName)
+        {
+            this.propertyName = propertyName;
+        }
+        
+        public void setPattern(String pattern)
+        {
+            this.pattern = pattern;
+        }
+        
+        public void setOffset(int offset) {
+            this.offset = offset;
+        }
+        
+        public void setUnit(String unit) {
+            if (unit.equalsIgnoreCase("millisecond")) {
+                field = Calendar.MILLISECOND;
+            }
+            else if (unit.equalsIgnoreCase("second")) {
+                field = Calendar.SECOND;
+            }
+            else if (unit.equalsIgnoreCase("minute")) {
+                field = Calendar.MINUTE;
+            }
+            else if (unit.equalsIgnoreCase("hour")) {
+                field = Calendar.HOUR_OF_DAY;
+            }
+            else if (unit.equalsIgnoreCase("day")) {
+                field = Calendar.DATE;
+            }
+            else if (unit.equalsIgnoreCase("week")) {
+                field = Calendar.WEEK_OF_YEAR;
+            }
+            else if (unit.equalsIgnoreCase("month")) {
+                field = Calendar.MONTH;
+            }
+            else if (unit.equalsIgnoreCase("year")) {
+                field = Calendar.YEAR;
+            }
+            else {
+                throw new BuildException(unit + " is not a unit supported by the tstamp task");
+            }
+        }            
+        
+        public void execute(Project project, Date date, Location location)
+        {
+            if (propertyName == null) {
+                throw new BuildException("property attribute must be provided", location);
+            }
+            
+            if (pattern == null) {
+                throw new BuildException("pattern attribute must be provided", location);
+            }
+            
+            SimpleDateFormat sdf = new SimpleDateFormat (pattern);
+            if (offset != 0) {
+                Calendar calendar = Calendar.getInstance();
+                calendar.setTime(date);
+                calendar.add(field, offset);
+                date = calendar.getTime();
+            }
+
+            project.setProperty(propertyName, sdf.format(date));
+        }
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Untar.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Untar.java
index 1622314..5952e85 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Untar.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Untar.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -136,7 +136,7 @@ public class Untar extends Task {
                 }
             }
         } catch (IOException ioe) {
-	    throw new BuildException("Error while expanding " + srcF.getPath(),
+            throw new BuildException("Error while expanding " + srcF.getPath(),
                                      ioe, location);
 	} finally {
 	    if (tis != null) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/UpToDate.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/UpToDate.java
index 9f515ba..9574c9a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/UpToDate.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/UpToDate.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -56,6 +56,7 @@ package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
 import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.util.*;
 import java.io.*;
 import java.util.Enumeration;
 import java.util.Date;
@@ -67,7 +68,7 @@ import java.util.Vector;
  *
  * @author William Ferguson <a href="mailto:williamf@mincom.com">williamf@mincom.com</a> 
  * @author Hiroaki Nakamura <a href="mailto:hnakamur@mc.neweb.ne.jp">hnakamur@mc.neweb.ne.jp</a>
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
 public class UpToDate extends MatchingTask {
@@ -76,6 +77,8 @@ public class UpToDate extends MatchingTask {
     private File _targetFile;
     private Vector sourceFileSets = new Vector();
 
+    protected Mapper mapperElement = null;
+
     /**
      * The property to set if the target file is more up to date than each of
      * the source files.
@@ -97,15 +100,27 @@ public class UpToDate extends MatchingTask {
     }
 
     /**
-     * Nested <srcfiles> element.
+     * Nested &lt;srcfiles&gt; element.
      */
     public void addSrcfiles(FileSet fs) {
         sourceFileSets.addElement(fs);
     }
 
     /**
-     * Sets property to true if target file has a more recent timestamp than
-     * each of the source files.
+     * Defines the FileNameMapper to use (nested mapper element).
+     */
+    public Mapper createMapper() throws BuildException {
+        if (mapperElement != null) {
+            throw new BuildException("Cannot define more than one mapper",
+                                     location);
+        }
+        mapperElement = new Mapper(project);
+        return mapperElement;
+    }
+
+    /**
+     * Sets property to true if target files have a more recent timestamp than
+     * each of the corresponding source files.
      */
     public void execute() throws BuildException {
 
@@ -113,50 +128,44 @@ public class UpToDate extends MatchingTask {
           throw new BuildException("At least one <srcfiles> element must be set");
         }
 
-        if (_targetFile == null) {
-          throw new BuildException("The targetfile attribute must be set");
+        if (_targetFile == null && mapperElement == null) {
+          throw new BuildException("The targetfile attribute or a nested mapper element must be set");
         }
 
         // if not there then it can't be up to date
-        if (!_targetFile.exists()) return; 
+        if (_targetFile != null && !_targetFile.exists()) return; 
 
         Enumeration enum = sourceFileSets.elements();
         boolean upToDate = true;
         while (upToDate && enum.hasMoreElements()) {
             FileSet fs = (FileSet) enum.nextElement();
             DirectoryScanner ds = fs.getDirectoryScanner(project);
-            upToDate = upToDate && scanDir(fs.getDir(project), _targetFile, 
+            upToDate = upToDate && scanDir(fs.getDir(project), 
                                            ds.getIncludedFiles());
         }
 
         if (upToDate) {
             this.project.setProperty(_property, "true");
-            log("File \"" + _targetFile.getAbsolutePath() + "\" is up to date.",
-                Project.MSG_VERBOSE);
+            if (mapperElement == null) {
+                log("File \"" + _targetFile.getAbsolutePath() + "\" is up to date.",
+                    Project.MSG_VERBOSE);
+            } else {
+                log("All target files have been up to date.",
+                    Project.MSG_VERBOSE);
+            }
         }
     }
 
-    protected boolean scanDir(File srcDir, File destFile, String files[]) {
-        long destLastModified = destFile.lastModified();
-        long now = (new Date()).getTime();
-        if (destLastModified > now) {
-            log("Warning: destfile modified in the future: " +
-                destFile.getPath(), Project.MSG_WARN);
-        }
-
-        for (int i = 0; i < files.length; i++) {
-            File srcFile = new File(srcDir, files[i]);
-
-            long srcLastModified = srcFile.lastModified();
-            if (srcLastModified > now) {
-                log("Warning: file modified in the future: " +
-                    files[i], Project.MSG_WARN);
-            }
-
-            if (srcLastModified > destLastModified) {
-                return false;
-            }
+    protected boolean scanDir(File srcDir, String files[]) {
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        FileNameMapper mapper = null;
+        if (mapperElement == null) {
+            MergingMapper mm = new MergingMapper();
+            mm.setTo(_targetFile.getAbsolutePath());
+            mapper = mm;
+        } else {
+            mapper = mapperElement.getImplementation();
         }
-        return true;
+        return sfs.restrict(files, srcDir, null, mapper).length == 0;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/War.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/War.java
index f8e881e..98f23bc 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/War.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/War.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,7 +55,7 @@
 package org.apache.tools.ant.taskdefs;
 
 import org.apache.tools.ant.*;
-import org.apache.tools.ant.types.FileSet;
+import org.apache.tools.ant.types.ZipFileSet;
 
 import java.io.*;
 import java.util.Vector;
@@ -64,131 +64,91 @@ import java.util.zip.*;
 /**
  * Creates a WAR archive.
  * 
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 public class War extends Jar {
 
     private File deploymentDescriptor;
-
-    private Vector libFileSets = new Vector();
-    private Vector classesFileSets = new Vector();
-    private Vector webInfFileSets = new Vector();
+    private boolean descriptorAdded;    
 
     public War() {
         super();
-	archiveType = "war";
+        archiveType = "war";
         emptyBehavior = "create";
     }
 
     public void setWarfile(File warFile) {
-	super.setZipfile(warFile);
+        super.setZipfile(warFile);
     }
     
     public void setWebxml(File descr) {
-        deploymentDescriptor = descr;
+        deploymentDescriptor = descr; 
+        if (!deploymentDescriptor.exists())
+            throw new BuildException("Deployment descriptor: " + deploymentDescriptor + " does not exist.");
+
+        // Create a ZipFileSet for this file, and pass it up.
+        ZipFileSet fs = new ZipFileSet();
+        fs.setDir(new File(deploymentDescriptor.getParent()));
+        fs.setIncludes(deploymentDescriptor.getName());
+        fs.setFullpath("WEB-INF/web.xml");
+        super.addFileset(fs);
     }
 
-    public void addLib(FileSet fs) {
-        libFileSets.addElement(fs);
+    public void addLib(ZipFileSet fs) {
+        // We just set the prefix for this fileset, and pass it up.
+        fs.setPrefix("WEB-INF/lib/");
+        super.addFileset(fs);
     }
 
-    public void addClasses(FileSet fs) {
-        classesFileSets.addElement(fs);
+    public void addClasses(ZipFileSet fs) {
+        // We just set the prefix for this fileset, and pass it up.
+        fs.setPrefix("WEB-INF/classes/");
+        super.addFileset(fs);
     }
 
-    public void addWebinf(FileSet fs) {
-        webInfFileSets.addElement(fs);
+    public void addWebinf(ZipFileSet fs) {
+        // We just set the prefix for this fileset, and pass it up.
+        fs.setPrefix("WEB-INF/");
+        super.addFileset(fs);
     }
 
-    /**
-     * Add the deployment descriptor as well as all files added the
-     * special way of nested lib, classes or webinf filesets.  
-     */
     protected void initZipOutputStream(ZipOutputStream zOut)
-	throws IOException, BuildException
-    {
-	// add deployment descriptor first
-	if (deploymentDescriptor != null) {
-            zipDir(new File(deploymentDescriptor.getParent()), zOut, 
-                   "WEB-INF/");
-	    super.zipFile(deploymentDescriptor, zOut, "WEB-INF/web.xml");
-	} else {
-            throw new BuildException("webxml attribute is required", location);
- 	}
-
-        addFiles(libFileSets, zOut, "WEB-INF/lib/");
-        addFiles(classesFileSets, zOut, "WEB-INF/classes/");
-        addFiles(webInfFileSets, zOut, "WEB-INF/");
-
-        super.initZipOutputStream(zOut);
-     }
-
-    protected boolean isUpToDate(FileScanner[] scanners, File zipFile) throws BuildException
+        throws IOException, BuildException
     {
+        // If no webxml file is specified, it's an error.
         if (deploymentDescriptor == null) {
             throw new BuildException("webxml attribute is required", location);
         }
         
-        // just add some Scanners for our filesets and web.xml and let
-        // Jar/Zip do the rest of the work
-
-        FileScanner[] myScanners = new FileScanner[scanners.length
-                                                  + 1 // web.xml
-                                                  + libFileSets.size()
-                                                  + classesFileSets.size()
-                                                  + webInfFileSets.size()];
-
-        System.arraycopy(scanners, 0, myScanners, 0, scanners.length);
-
-        DirectoryScanner ds = new DirectoryScanner();
-        ds.setBasedir(new File(deploymentDescriptor.getParent()));
-        ds.setIncludes(new String[] {deploymentDescriptor.getName()});
-        ds.scan();
-        myScanners[scanners.length] = ds;
-        
-        addScanners(myScanners, scanners.length+1, libFileSets);
-        addScanners(myScanners, scanners.length+1+libFileSets.size(), 
-                    classesFileSets);
-        addScanners(myScanners, scanners.length+1+libFileSets.size()+classesFileSets.size(), 
-                    webInfFileSets);
-
-        return super.isUpToDate(myScanners, zipFile);
+        super.initZipOutputStream(zOut);
     }
 
     protected void zipFile(File file, ZipOutputStream zOut, String vPath)
         throws IOException
     {
-        // We already added a WEB-INF/web.xml
-        if (!vPath.equalsIgnoreCase("WEB-INF/web.xml")) {
-            super.zipFile(file, zOut, vPath);
+        // If the file being added is WEB-INF/web.xml, we warn if it's not the
+        // one specified in the "webxml" attribute - or if it's being added twice, 
+        // meaning the same file is specified by the "webxml" attribute and in
+        // a <fileset> element.
+        if (vPath.equalsIgnoreCase("WEB-INF/web.xml"))  {
+            if (deploymentDescriptor == null || !deploymentDescriptor.equals(file) || descriptorAdded) {
+                log("Warning: selected "+archiveType+" files include a WEB-INF/web.xml which will be ignored " +
+                    "(please use webxml attribute to "+archiveType+" task)", Project.MSG_WARN);
+            } else {
+                super.zipFile(file, zOut, vPath);
+                descriptorAdded = true;
+            }
         } else {
-            log("Warning: selected "+archiveType+" files include a WEB-INF/web.xml which will be ignored " +
-                "(please use webxml attribute to "+archiveType+" task)", Project.MSG_WARN);
-        }
-    }
-
-    /**
-     * Add a DirectoryScanner for each FileSet included in fileSets to scanners
-     * starting with index startIndex.
-     */
-    protected void addScanners(FileScanner[] scanners, int startIndex, 
-                               Vector fileSets) {
-        for (int i=0; i<fileSets.size(); i++) {
-            FileSet fs = (FileSet) fileSets.elementAt(i);
-            scanners[startIndex+i] = fs.getDirectoryScanner(project);
+            super.zipFile(file, zOut, vPath);
         }
     }
 
     /**
-     * Iterate over the given Vector of filesets and add all files to the
-     * ZipOutputStream using the given prefix.
+     * Make sure we don't think we already have a web.xml next time this task
+     * gets executed.
      */
-    protected void addFiles(Vector v, ZipOutputStream zOut, String prefix)
-        throws IOException {
-        for (int i=0; i<v.size(); i++) {
-            FileSet fs = (FileSet) v.elementAt(i);
-            DirectoryScanner ds = fs.getDirectoryScanner(project);
-            addFiles(ds, zOut, prefix);
-        }
+    protected void cleanUp() {
+        descriptorAdded = false;
+        super.cleanUp();
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTLiaison.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTLiaison.java
index b297066..c33a15a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTLiaison.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTLiaison.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -59,12 +59,14 @@ import org.apache.tools.ant.*;
 /**
  *
  * @author <a href="mailto:rubys@us.ibm.com">Sam Ruby</a>
- * @version $Revision: 1.1 $ $Date: 2000/06/23 16:47:04 $
+ * @version $Revision: 1.3 $ $Date: 2001/01/03 14:18:31 $
  */
 public interface XSLTLiaison {
 
     public void setStylesheet(String fileName) throws Exception;
 
+    public void addParam(String name, String expression) throws Exception;
+
     public void transform(String infile, String outfile) throws Exception;
 
 } //-- XSLTLiaison
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTProcess.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTProcess.java
index e857e25..f635e98 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTProcess.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/XSLTProcess.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,13 +54,13 @@
 
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
 
 import java.io.*;
 import java.util.Enumeration;
 import java.util.Hashtable;
 import java.util.StringTokenizer;
 import java.util.Vector;
+import org.apache.tools.ant.*;
 
 
 /**
@@ -84,7 +84,7 @@ import java.util.Vector;
  * @author <a href="mailto:kvisco@exoffice.com">Keith Visco</a>
  * @author <a href="mailto:rubys@us.ibm.com">Sam Ruby</a>
  * @author <a href="mailto:russgold@acm.org">Russell Gold</a>
- * @version $Revision: 1.8 $ $Date: 2000/08/03 09:34:03 $
+ * @version $Revision: 1.13 $ $Date: 2001/01/11 09:12:44 $
  */
 public class XSLTProcess extends MatchingTask {
 
@@ -95,12 +95,17 @@ public class XSLTProcess extends MatchingTask {
     private File xslFile = null;
 
     private String targetExtension = ".html";
+    private Vector params = new Vector();
+ 
+    private File inFile = null;
+ 
+    private File outFile = null;
 
     private XSLTLiaison liaison;
 
     /**
      * Creates a new XSLTProcess Task.
-    **/
+     **/
     public XSLTProcess() {
     } //-- XSLTProcess
 
@@ -109,35 +114,41 @@ public class XSLTProcess extends MatchingTask {
      */
 
     public void execute() throws BuildException {
-	DirectoryScanner scanner;
-	String[]         list;
-	String[]         dirs;
+        DirectoryScanner scanner;
+        String[]         list;
+        String[]         dirs;
 
-	if (baseDir == null)
-	    baseDir = project.resolveFile(".");
+        if (baseDir == null) {
+            baseDir = project.resolveFile(".");
+        }
+        
         //-- make sure Source directory exists...
-	if (destDir == null ) {
-	    String msg = "destdir attributes must be set!";
-	    throw new BuildException(msg);
-	}
-	scanner = getDirectoryScanner(baseDir);
-	log("Transforming into "+destDir, Project.MSG_INFO);
-
-        // if processor wasn't specified, default it to xslp or xalan,
-        // depending on which is in the classpath
+        if (destDir == null ) {
+            String msg = "destdir attributes must be set!";
+            throw new BuildException(msg);
+        }
+        scanner = getDirectoryScanner(baseDir);
+        log("Transforming into "+destDir, Project.MSG_INFO);
+
+        // if processor wasn't specified, see if TraX is available.  If not,
+        // default it to xslp or xalan, depending on which is in the classpath
         if (liaison == null) {
-           try {
-               setProcessor("xslp");
-           } catch (Throwable e1) {
-               try {
-                   setProcessor("xalan");
-               } catch (Throwable e2) {
-                   throw new BuildException(e2);
-               }
-           }
+            try {
+                setProcessor("trax");
+            } catch (Throwable e1) {
+                try {
+                    setProcessor("xslp");
+                } catch (Throwable e2) {
+                    try {
+                        setProcessor("xalan");
+                    } catch (Throwable e3) {
+                        throw new BuildException(e1);
+                    }
+                }
+            }
         }
 
-	log("Using "+liaison.getClass().toString(), Project.MSG_VERBOSE);
+        log("Using "+liaison.getClass().toString(), Project.MSG_VERBOSE);
 
         long styleSheetLastModified = 0;
         if (xslFile != null) {
@@ -147,30 +158,40 @@ public class XSLTProcess extends MatchingTask {
                 styleSheetLastModified = file.lastModified();
                 log( "Loading stylesheet " + file, Project.MSG_INFO);
                 liaison.setStylesheet( file.toString() );
+                for(Enumeration e = params.elements();e.hasMoreElements();) {
+                    Param p = (Param)e.nextElement();
+                    liaison.addParam( p.getName(), p.getExpression() );
+                }
             } catch (Exception ex) {
                 log("Failed to read stylesheet " + xslFile, Project.MSG_INFO);
                 throw new BuildException(ex);
             }
         }
 
-	// Process all the files marked for styling
-	list = scanner.getIncludedFiles();
-	for (int i = 0;i < list.length; ++i) {
+        // if we have an in file and out then process them
+        if (inFile != null && outFile != null) {
+            process(inFile, outFile, styleSheetLastModified);
+            return;
+        }
+
+        // Process all the files marked for styling
+        list = scanner.getIncludedFiles();
+        for (int i = 0;i < list.length; ++i) {
             process( baseDir, list[i], destDir, styleSheetLastModified );
-	}
+        }
         
-	// Process all the directoried marked for styling
-	dirs = scanner.getIncludedDirectories();
-	for (int j = 0;j < dirs.length;++j){
-	    list=new File(baseDir,dirs[j]).list();
-	    for (int i = 0;i < list.length;++i)
+        // Process all the directoried marked for styling
+        dirs = scanner.getIncludedDirectories();
+        for (int j = 0;j < dirs.length;++j){
+            list=new File(baseDir,dirs[j]).list();
+            for (int i = 0;i < list.length;++i)
                 process( baseDir, list[i], destDir, styleSheetLastModified );
-	}
+        }
     } //-- execute
 
     /**
      * Set the base directory.
-    **/
+     **/
     public void setBasedir(File dir) {
         baseDir = dir;
     } //-- setSourceDir
@@ -179,7 +200,7 @@ public class XSLTProcess extends MatchingTask {
      * Set the destination directory into which the XSL result
      * files should be copied to
      * @param dirName the name of the destination directory
-    **/
+     **/
     public void setDestdir(File dir) {
         destDir = dir;
     } //-- setDestDir
@@ -187,16 +208,16 @@ public class XSLTProcess extends MatchingTask {
     /**
      * Set the desired file extension to be used for the target
      * @param name the extension to use
-    **/
+     **/
     public void setExtension(String name) {
-	    targetExtension = name;
+            targetExtension = name;
     } //-- setDestDir
 
     /**
      * Sets the file to use for styling relative to the base directory.
      */
     public void setStyle(String xslFile) {
-	this.xslFile = new File(xslFile);
+        this.xslFile = new File(xslFile);
     }
 
     /**
@@ -204,119 +225,97 @@ public class XSLTProcess extends MatchingTask {
      */
     public void setProcessor(String processor) throws Exception {
 
-	if (processor.equals("xslp")) {
-            liaison = (XSLTLiaison) Class.forName("org.apache.tools.ant.taskdefs.optional.XslpLiaison").newInstance();
-	} else if (processor.equals("xalan")) {
-            liaison = (XSLTLiaison) Class.forName("org.apache.tools.ant.taskdefs.optional.XalanLiaison").newInstance();
+        if (processor.equals("trax")) {
+            final Class clazz = 
+                Class.forName("org.apache.tools.ant.taskdefs.optional.TraXLiaison");
+            liaison = (XSLTLiaison)clazz.newInstance();
+        } else if (processor.equals("xslp")) {
+            final Class clazz = 
+                Class.forName("org.apache.tools.ant.taskdefs.optional.XslpLiaison");
+            liaison = (XSLTLiaison) clazz.newInstance();
+        } else if (processor.equals("xalan")) {
+            final Class clazz = 
+                Class.forName("org.apache.tools.ant.taskdefs.optional.XalanLiaison");
+            liaison = (XSLTLiaison)clazz.newInstance();
         } else {
             liaison = (XSLTLiaison) Class.forName(processor).newInstance();
         }
 
     }
 
-    /*
-    private void process(File sourceDir, File destDir)
-        throws BuildException
-    {
-
-        
-        if (!sourceDir.isDirectory()) {
-            throw new BuildException(sourceDir.getName() +
-                " is not a directory!");
-        }
-        else if (!destDir.isDirectory()) {
-            throw new BuildException(destDir.getName() +
-                " is not a directory!");
-        }
+    /**
+     * Sets an out file
+     */
+    public void setOut(File outFile){
+        this.outFile = outFile;
+    }
 
-	    String[] list = sourceDir.list(new DesirableFilter());
-
-	    if (list == null) {
-	        return;  //-- nothing to do
-	    }
-
-	    for (int i = 0; i < list.length; i++) {
-
-    	    String filename = list[i];
-
-    	    File inFile  = new File(sourceDir, filename);
-
-	        //-- if inFile is a directory, recursively process it
-    	    if (inFile.isDirectory()) {
-		if (!excluded(filename)) {
-		new File(destDir, filename).mkdir();
-		process(inFile, new File(destDir, filename));
-		}
-	    }
-	    //-- process XML files
-	    else if (hasXMLFileExtension(filename) && ! excluded(filename)) {
-
-	            //-- replace extension with the target extension
-	            int idx = filename.lastIndexOf('.');
-
-		        File outFile = new File(destDir,
-		            filename.substring(0,idx) + targetExt);
-
-		        if ((inFile.lastModified() > outFile.lastModified()) ||
-			    (xslFile != null && xslFile.lastModified() > outFile.lastModified()))
-		        {
-			    processXML(inFile, outFile);
-		        }
-		    }
-		    else {
-		        File outFile = new File(destDir, filename);
-		        if (inFile.lastModified() > outFile.lastModified()) {
-		            try {
-		                copyFile(inFile, outFile);
-		            }
-		            catch(java.io.IOException ex) {
-		                String err = "error copying file: ";
-		                err += inFile.getAbsolutePath();
-		                err += "; " + ex.getMessage();
-		                throw new BuildException(err, ex);
-		            }
-			        //filecopyList.put(srcFile.getAbsolutePath(),
-					    //destFile.getAbsolutePath());
-		        }
-		    }
-		} //-- </for>
-    } //-- process(File, File)
-    */
+    /**
+     * Sets an input xml file to be styled
+     */
+    public void setIn(File inFile){
+        this.inFile = inFile;
+    }
 
     /**
      * Processes the given input XML file and stores the result
      * in the given resultFile.
-    **/
+     **/
     private void process(File baseDir, String xmlFile, File destDir, 
                          long styleSheetLastModified)
         throws BuildException {
 
-	String fileExt=targetExtension;
-	File   outFile=null;
-	File   inFile=null;
-
-	try {
-	    inFile = new File(baseDir,xmlFile);
-	    outFile = new File(destDir,xmlFile.substring(0,xmlFile.lastIndexOf('.'))+fileExt);
-	    if (inFile.lastModified() > outFile.lastModified() ||
+        String fileExt=targetExtension;
+        File   outFile=null;
+        File   inFile=null;
+
+        try {
+            inFile = new File(baseDir,xmlFile);
+            int dotPos = xmlFile.lastIndexOf('.');
+            if(dotPos>0){
+                outFile = new File(destDir,xmlFile.substring(0,xmlFile.lastIndexOf('.'))+fileExt);
+            }else{
+                outFile = new File(destDir,xmlFile+fileExt);
+            }
+            if (inFile.lastModified() > outFile.lastModified() ||
                 styleSheetLastModified > outFile.lastModified()) {
                 ensureDirectoryFor( outFile );
-		//-- command line status
-		log("Processing " + xmlFile + " to " + outFile, Project.MSG_VERBOSE);
+                log("Transforming into "+destDir);
 
-		liaison.transform(inFile.toString(), outFile.toString());
-	    }
+                liaison.transform(inFile.toString(), outFile.toString());
+            }
         }
         catch (Exception ex) {
-	    // If failed to process document, must delete target document,
-	    // or it will not attempt to process it the second time
-	    log("Failed to process " + inFile, Project.MSG_INFO);
-	    outFile.delete();
+            // If failed to process document, must delete target document,
+            // or it will not attempt to process it the second time
+            log("Failed to process " + inFile, Project.MSG_INFO);
+            if (outFile != null) {
+                outFile.delete();
+            }
+        
             throw new BuildException(ex);
         }
 
     } //-- processXML
 
+    private void process(File inFile, File outFile, long styleSheetLastModified) throws BuildException {
+        try{
+            log("In file "+inFile+" time: " + inFile.lastModified() , Project.MSG_DEBUG);
+            log("Out file "+outFile+" time: " + outFile.lastModified() , Project.MSG_DEBUG);
+            log("Style file "+xslFile+" time: " + styleSheetLastModified , Project.MSG_DEBUG);
+            if (inFile.lastModified() > outFile.lastModified() ||
+                styleSheetLastModified > outFile.lastModified()) {
+                ensureDirectoryFor( outFile );
+                log("Processing " + inFile + " to " + outFile, Project.MSG_INFO);
+                liaison.transform(inFile.toString(), outFile.toString());
+            }
+        }catch (Exception ex) {
+            log("Failed to process " + inFile, Project.MSG_INFO);
+            if(outFile!=null)outFile.delete();
+            throw new BuildException(ex);
+        }
+    }
+
     private void ensureDirectoryFor( File targetFile ) throws BuildException {
         File directory = new File( targetFile.getParent() );
         if (!directory.exists()) {
@@ -326,4 +325,33 @@ public class XSLTProcess extends MatchingTask {
             }
         }
     }
+    
+    public Param createParam() {
+        Param p = new Param();
+        params.addElement(p);
+        return p;
+    }
+
+    public class Param {
+        private String name=null;
+        private String expression=null;
+        
+        public void setName(String name){
+            this.name = name;
+        }
+        
+        public void setExpression(String expression){
+            this.expression = expression;
+        }
+        
+        public String getName() throws BuildException{
+            if(name==null)throw new BuildException("Name attribute is missing.");
+            return name;
+        }
+        
+        public String getExpression() throws BuildException{
+            if(expression==null)throw new BuildException("Expression attribute is missing.");
+            return expression;
+        }
+    }
 } //-- XSLTProcess
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Zip.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Zip.java
index 9e9cb86..fc00505 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Zip.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/Zip.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -51,12 +51,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs;
 
-import org.apache.tools.ant.*;
-import org.apache.tools.ant.types.*;
-
 import java.io.*;
 import java.util.Enumeration;
 import java.util.Hashtable;
@@ -64,14 +60,17 @@ import java.util.Stack;
 import java.util.StringTokenizer;
 import java.util.Vector;
 import java.util.zip.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.util.*;
 
 /**
  * Create a ZIP archive.
  *
  * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
  * @author Jon S. Stevens <a href="mailto:jon@clearink.com">jon@clearink.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
-
 public class Zip extends MatchingTask {
 
     private File zipFile;
@@ -83,7 +82,7 @@ public class Zip extends MatchingTask {
     protected String emptyBehavior = "skip";
     private Vector filesets = new Vector ();
     private Hashtable addedDirs = new Hashtable();
-    
+
     /**
      * This is the name/location of where to 
      * create the .zip file.
@@ -96,15 +95,15 @@ public class Zip extends MatchingTask {
      * This is the base directory to look in for 
      * things to zip.
      */
-    public void setBasedir(String baseDirname) {
-        baseDir = project.resolveFile(baseDirname);
+    public void setBasedir(File baseDir) {
+        this.baseDir = baseDir;
     }
 
     /**
      * Sets whether we want to compress the files or only store them.
      */
-    public void setCompress(String compress) {
-        doCompress = Project.toBoolean(compress);
+    public void setCompress(boolean c) {
+        doCompress = c;
     }
 
     /**
@@ -114,6 +113,15 @@ public class Zip extends MatchingTask {
         filesets.addElement(set);
     }
 
+    /**
+     * Adds a set of files (nested zipfileset attribute) that can be
+     * read from an archive and be given a prefix/fullpath.
+     */
+    public void addZipfileset(ZipFileSet set) {
+        filesets.addElement(set);
+    }
+
+
     /**
      * Sets behavior of the task when no files match.
      * Possible values are: <code>fail</code> (throw an exception
@@ -132,13 +140,16 @@ public class Zip extends MatchingTask {
     }
 
     public void execute() throws BuildException {
-        if (baseDir == null && filesets.size() == 0 && "zip".equals(archiveType))
-            throw new BuildException("basedir attribute must be set, or at least one fileset must be given!");
+        if (baseDir == null && filesets.size() == 0 && "zip".equals(archiveType)) {
+            throw new BuildException( "basedir attribute must be set, or at least " + 
+                                      "one fileset must be given!" );
+        }
 
         if (zipFile == null) {
-            throw new BuildException("You must specify the " + archiveType + "file to create!");
+            throw new BuildException("You must specify the " + archiveType + " file to create!");
         }
 
+        // Create the scanners to pass to isUpToDate().
         Vector dss = new Vector ();
         if (baseDir != null)
             dss.addElement(getDirectoryScanner(baseDir));
@@ -146,7 +157,8 @@ public class Zip extends MatchingTask {
             FileSet fs = (FileSet) filesets.elementAt(i);
             dss.addElement (fs.getDirectoryScanner(project));
         }
-        FileScanner[] scanners = new FileScanner[dss.size()];
+        int dssSize = dss.size();
+        FileScanner[] scanners = new FileScanner[dssSize];
         dss.copyInto(scanners);
 
         // quick exit if the target is up to date
@@ -155,31 +167,51 @@ public class Zip extends MatchingTask {
 
         log("Building "+ archiveType +": "+ zipFile.getAbsolutePath());
 
-	try {
-	    ZipOutputStream zOut = new ZipOutputStream(new FileOutputStream(zipFile));
-	    try {
-		if (doCompress) {
-		    zOut.setMethod(ZipOutputStream.DEFLATED);
-		} else {
-		    zOut.setMethod(ZipOutputStream.STORED);
-		}
-		initZipOutputStream(zOut);
-                                
-                for (int j = 0; j < scanners.length; j++) {
-                    addFiles(scanners[j], zOut, "");
+        try {
+            boolean success = false;
+            ZipOutputStream zOut = 
+              new ZipOutputStream(new FileOutputStream(zipFile));
+            try {
+                if (doCompress) {
+                    zOut.setMethod(ZipOutputStream.DEFLATED);
+                } else {
+                    zOut.setMethod(ZipOutputStream.STORED);
+                }
+                initZipOutputStream(zOut);
+
+                // Add the implicit fileset to the archive.
+                if (baseDir != null)
+                    addFiles(getDirectoryScanner(baseDir), zOut, "", "");
+                // Add the explicit filesets to the archive.
+                addFiles(filesets, zOut);
+                success = true;
+            } finally {
+                // Close the output stream.
+                try {
+                    if (zOut != null)
+                        zOut.close ();
+                } catch(IOException ex) {
+                    // If we're in this finally clause because of an exception, we don't 
+                    // really care if there's an exception when closing the stream. E.g. if it
+                    // throws "ZIP file must have at least one entry", because an exception happened
+                    // before we added any files, then we must swallow this exception. Otherwise,
+                    // the error that's reported will be the close() error, which is not the real 
+                    // cause of the problem.
+                    if (success)
+                        throw ex;
                 }
-	    } finally {
-		zOut.close ();
-	    }
-	} catch (IOException ioe) {
-	    String msg = "Problem creating " + archiveType + ": " + ioe.getMessage();
+            }
+        } catch (IOException ioe) {
+            String msg = "Problem creating " + archiveType + ": " + ioe.getMessage();
 
             // delete a bogus ZIP file
-	    if (!zipFile.delete()) {
-		msg += " (and the archive is probably corrupt but I could not delete it)";
-	    }
+            if (!zipFile.delete()) {
+                msg += " (and the archive is probably corrupt but I could not delete it)";
+            }
 
             throw new BuildException(msg, ioe, location);
+        } finally {
+            cleanUp();
         }
     }
 
@@ -190,11 +222,16 @@ public class Zip extends MatchingTask {
      * <p>Ensure parent directories have been added as well.  
      */
     protected void addFiles(FileScanner scanner, ZipOutputStream zOut, 
-                            String prefix) throws IOException {
+                            String prefix, String fullpath) throws IOException {
+        if (prefix.length() > 0 && fullpath.length() > 0)
+             throw new BuildException("Both prefix and fullpath attributes may not be set on the same fileset.");
+
         File thisBaseDir = scanner.getBasedir();
 
         // directories that matched include patterns
         String[] dirs = scanner.getIncludedDirectories();
+        if (dirs.length > 0 && fullpath.length() > 0)
+            throw new BuildException("fullpath attribute may only be specified for filesets that specify a single file.");
         for (int i = 0; i < dirs.length; i++) {
             String name = dirs[i].replace(File.separatorChar,'/');
             if (!name.endsWith("/")) {
@@ -205,11 +242,43 @@ public class Zip extends MatchingTask {
 
         // files that matched include patterns
         String[] files = scanner.getIncludedFiles();
+         if (files.length > 1 && fullpath.length() > 0)
+            throw new BuildException("fullpath attribute may only be specified for filesets that specify a single file.");
         for (int i = 0; i < files.length; i++) {
             File f = new File(thisBaseDir, files[i]);
-            String name = files[i].replace(File.separatorChar,'/');
-            addParentDirs(thisBaseDir, name, zOut, prefix);
-            zipFile(f, zOut, prefix+name);
+            if (fullpath.length() > 0)
+            {
+                // Add this file at the specified location.
+                addParentDirs(null, fullpath, zOut, "");
+                zipFile(f, zOut, fullpath);
+            }
+            else
+            {
+                // Add this file with the specified prefix.
+                String name = files[i].replace(File.separatorChar,'/');
+                addParentDirs(thisBaseDir, name, zOut, prefix);
+                zipFile(f, zOut, prefix+name);
+            }
+        }
+    }
+
+    protected void addZipEntries(ZipFileSet fs, DirectoryScanner ds,
+      ZipOutputStream zOut, String prefix)
+        throws IOException
+    {
+        ZipScanner zipScanner = (ZipScanner) ds;
+        File zipSrc = fs.getSrc();
+
+        ZipEntry entry;
+        ZipInputStream in = new ZipInputStream(new FileInputStream(zipSrc));
+        while ((entry = in.getNextEntry()) != null) {
+            String vPath = entry.getName();
+            if (zipScanner.match(vPath)) {
+                addParentDirs(null, vPath, zOut, prefix);
+                if (! entry.isDirectory()) {
+                  zipFile(in, zOut, prefix+vPath, entry.getTime());
+                }
+            }
         }
     }
 
@@ -228,7 +297,8 @@ public class Zip extends MatchingTask {
      */
     protected boolean isUpToDate(FileScanner[] scanners, File zipFile) throws BuildException
     {
-        File[] files = grabFiles(scanners);
+        String[][] fileNames = grabFileNames(scanners);
+        File[] files = grabFiles(scanners, fileNames);
         if (files.length == 0) {
             if (emptyBehavior.equals("skip")) {
                 log("Warning: skipping "+archiveType+" archive " + zipFile +
@@ -264,10 +334,20 @@ public class Zip extends MatchingTask {
                 return true;
             }
         } else {
-            // Probably unnecessary but just for clarity:
+            for (int i = 0; i < files.length; ++i) {
+                if (files[i].equals(zipFile)) {
+                    throw new BuildException("A zip file cannot include itself", location);
+                }
+            }
+
             if (!zipFile.exists()) return false;
-            for (int i=0; i<files.length; i++) {
-                if (files[i].lastModified() > zipFile.lastModified()) {
+
+            SourceFileScanner sfs = new SourceFileScanner(this);
+            MergingMapper mm = new MergingMapper();
+            mm.setTo(zipFile.getAbsolutePath());
+            for (int i=0; i<scanners.length; i++) {
+                if (sfs.restrict(fileNames[i], scanners[i].getBasedir(), null,
+                                 mm).length > 0) {
                     return false;
                 }
             }
@@ -276,18 +356,34 @@ public class Zip extends MatchingTask {
     }
 
     protected static File[] grabFiles(FileScanner[] scanners) {
-        Vector files = new Vector ();
-        for (int i = 0; i < scanners.length; i++) {
+        return grabFiles(scanners, grabFileNames(scanners));
+    }
+
+    protected static File[] grabFiles(FileScanner[] scanners, 
+                                      String[][] fileNames) {
+        Vector files = new Vector();
+        for (int i = 0; i < fileNames.length; i++) {
             File thisBaseDir = scanners[i].getBasedir();
-            String[] ifiles = scanners[i].getIncludedFiles();
-            for (int j = 0; j < ifiles.length; j++)
-                files.addElement(new File(thisBaseDir, ifiles[j]));
+            for (int j = 0; j < fileNames[i].length; j++)
+                files.addElement(new File(thisBaseDir, fileNames[i][j]));
         }
         File[] toret = new File[files.size()];
         files.copyInto(toret);
         return toret;
     }
 
+    protected static String[][] grabFileNames(FileScanner[] scanners) {
+        String[][] result = new String[scanners.length][];
+        for (int i=0; i<scanners.length; i++) {
+            String[] files = scanners[i].getIncludedFiles();
+            String[] dirs = scanners[i].getIncludedDirectories();
+            result[i] = new String[files.length + dirs.length];
+            System.arraycopy(files, 0, result[i], 0, files.length);
+            System.arraycopy(dirs, 0, result[i], files.length, dirs.length);
+        }
+        return result;
+    }
+
     protected void zipDir(File dir, ZipOutputStream zOut, String vPath)
         throws IOException
     {
@@ -298,13 +394,13 @@ public class Zip extends MatchingTask {
         }
         addedDirs.put(vPath, vPath);
         
-	ZipEntry ze = new ZipEntry (vPath);
-	if (dir != null) ze.setTime (dir.lastModified ());
-	ze.setSize (0);
-	ze.setMethod (ZipEntry.STORED);
-	// This is faintly ridiculous:
-	ze.setCrc (emptyCrc);
-	zOut.putNextEntry (ze);
+        ZipEntry ze = new ZipEntry (vPath);
+        if (dir != null) ze.setTime (dir.lastModified ());
+        ze.setSize (0);
+        ze.setMethod (ZipEntry.STORED);
+        // This is faintly ridiculous:
+        ze.setCrc (emptyCrc);
+        zOut.putNextEntry (ze);
     }
 
     protected void zipFile(InputStream in, ZipOutputStream zOut, String vPath,
@@ -369,6 +465,10 @@ public class Zip extends MatchingTask {
     protected void zipFile(File file, ZipOutputStream zOut, String vPath)
         throws IOException
     {
+        if (file.equals(zipFile)) {
+            throw new BuildException("A zip file cannot include itself", location);
+        }
+
         FileInputStream fIn = new FileInputStream(file);
         try {
             zipFile(fIn, zOut, vPath, file.lastModified());
@@ -397,8 +497,65 @@ public class Zip extends MatchingTask {
 
         while (!directories.isEmpty()) {
             String dir = (String) directories.pop();
-            File f = new File(baseDir, dir);
+            File f = null;
+            if (baseDir != null) {
+                f = new File(baseDir, dir);
+            } else {
+                f = new File(dir);
+            }
             zipDir(f, zOut, prefix+dir);
         }
     }
+
+    /**
+     * Iterate over the given Vector of (zip)filesets and add
+     * all files to the ZipOutputStream using the given prefix.
+     */
+    protected void addFiles(Vector filesets, ZipOutputStream zOut)
+        throws IOException {
+        // Add each fileset in the Vector.
+        for (int i = 0; i<filesets.size(); i++) {
+            FileSet fs = (FileSet) filesets.elementAt(i);
+            DirectoryScanner ds = fs.getDirectoryScanner(project);
+
+            String prefix = "";
+            String fullpath = "";
+            if (fs instanceof ZipFileSet) {
+                ZipFileSet zfs = (ZipFileSet) fs;
+                prefix = zfs.getPrefix();
+                fullpath = zfs.getFullpath();
+            }
+            
+            if (prefix.length() > 0 
+                && !prefix.endsWith("/")
+                && !prefix.endsWith("\\")) {
+                prefix += "/";
+            }
+
+            // Need to manually add either fullpath's parent directory, or 
+            // the prefix directory, to the archive. 
+            if (prefix.length() > 0) {
+                addParentDirs(null, prefix, zOut, "");
+                zipDir(null, zOut, prefix);
+            } else if (fullpath.length() > 0) {
+                addParentDirs(null, fullpath, zOut, "");
+            }
+
+            if (fs instanceof ZipFileSet
+                && ((ZipFileSet) fs).getSrc() != null) {
+                addZipEntries((ZipFileSet) fs, ds, zOut, prefix);
+            } else {
+                // Add the fileset.
+                addFiles(ds, zOut, prefix, fullpath);
+            }
+        }
+    }
+
+    /**
+     * Do any clean up necessary to allow this instance to be used again.
+     *
+     * <p>When we get here, the Zip file has been closed and all we
+     * need to do is to reset some globals.</p>
+     */
+    protected void cleanUp() {}
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapter.java
new file mode 100644
index 0000000..82c79fd
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapter.java
@@ -0,0 +1,86 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.taskdefs.Javac;
+
+/**
+ * The interface that all compiler adapters must adher to.  
+ *
+ * <p>A compiler adapter is an adapter that interprets the javac's
+ * parameters in preperation to be passed off to the compier this
+ * adapter represents.  As all the necessary values are stored in the
+ * Javac task itself, the only thing all adapters need is the javac
+ * task, the execute command and a parameterless constructor (for
+ * reflection).</p>
+ *
+ * @author Jay Dickon Glanville <a href="mailto:jayglanville@home.com">jayglanville@home.com</a>
+ */
+
+public interface CompilerAdapter {
+
+    /**
+     * Sets the compiler attributes, which are stored in the Javac task.
+     */
+    public void setJavac( Javac attributes );
+
+    /**
+     * Executes the task.
+     *
+     * @return has the compilation been successful
+     */
+    public boolean execute() throws BuildException;
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapterFactory.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapterFactory.java
new file mode 100644
index 0000000..ed3dcfb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/CompilerAdapterFactory.java
@@ -0,0 +1,151 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.Project;
+
+/**
+ * Creates the necessary compiler adapter, given basic criteria.
+ *
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public class CompilerAdapterFactory {
+
+    /** This is a singlton -- can't create instances!! */
+    private CompilerAdapterFactory() {
+    }
+
+    /**
+     * Based on the parameter passed in, this method creates the necessary
+     * factory desired.
+     *
+     * The current mapping for compiler names are as follows:
+     * <ul><li>jikes = jikes compiler
+     * <li>classic, javac1.1, javac1.2 = the standard compiler from JDK
+     * 1.1/1.2
+     * <li>modern, javac1.3 = the new compiler of JDK 1.3
+     * <li>jvc, microsoft = the command line compiler from Microsoft's SDK
+     * for Java / Visual J++
+     * <li><i>a fully quallified classname</i> = the name of a compiler
+     * adapter
+     * </ul>
+     *
+     * @param compilerType either the name of the desired compiler, or the
+     * full classname of the compiler's adapter.
+     * @param task a task to log through.
+     * @throws BuildException if the compiler type could not be resolved into
+     * a compiler adapter.
+     */
+    public static CompilerAdapter getCompiler( String compilerType, Task task ) 
+        throws BuildException {
+            /* If I've done things right, this should be the extent of the
+             * conditional statements required.
+             */
+            if ( compilerType.equalsIgnoreCase("jikes") ) {
+                return new Jikes();
+            }
+            if ( compilerType.equalsIgnoreCase("classic") ||
+                    compilerType.equalsIgnoreCase("javac1.1") ||
+                    compilerType.equalsIgnoreCase("javac1.2")) {
+                return new Javac12();
+            }
+            if ( compilerType.equalsIgnoreCase("modern") ||
+                    compilerType.equalsIgnoreCase("javac1.3")) {
+                // does the modern compiler exist?
+                try {
+                    Class.forName("com.sun.tools.javac.Main");
+                } catch (ClassNotFoundException cnfe) {
+                    task.log("Modern compiler is not available - using "
+                            + "classic compiler", Project.MSG_WARN);
+                    return new Javac12();
+                }
+                return new Javac13();
+            }
+            if ( compilerType.equalsIgnoreCase("jvc") ||
+                    compilerType.equalsIgnoreCase("microsoft")) {
+                return new Jvc();
+            }
+            return resolveClassName( compilerType );
+        }
+
+    /**
+     * Tries to resolve the given classname into a compiler adapter.
+     * Throws a fit if it can't.
+     *
+     * @param className The fully qualified classname to be created.
+     * @throws BuildException This is the fit that is thrown if className
+     * isn't an instance of CompilerAdapter.
+     */
+    private static CompilerAdapter resolveClassName( String className )
+        throws BuildException {
+        try {
+            Class c = Class.forName( className );
+            Object o = c.newInstance();
+            return (CompilerAdapter) o;
+        } catch ( ClassNotFoundException cnfe ) {
+            throw new BuildException( className + " can\'t be found.", cnfe );
+        } catch ( ClassCastException cce ) {
+            throw new BuildException(className + " isn\'t the classname of "
+                    + "a compiler adapter.", cce);
+        } catch ( Throwable t ) {
+            // for all other possibilities
+            throw new BuildException(className + " caused an interesting "
+                    + "exception.", t);
+        }
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/DefaultCompilerAdapter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/DefaultCompilerAdapter.java
new file mode 100644
index 0000000..867cb3a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/DefaultCompilerAdapter.java
@@ -0,0 +1,373 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+
+import java.io.*;
+import java.util.Random;
+
+/**
+ * This is the default implementation for the CompilerAdapter interface.
+ * Currently, this is a cut-and-paste of the original javac task.
+ *
+ * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
+ * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public abstract class DefaultCompilerAdapter implements CompilerAdapter {
+
+    /* jdg - TODO - all these attributes are currently protected, but they
+     * should probably be private in the near future.
+     */
+
+    protected Path src;
+    protected File destDir;
+    protected String encoding;
+    protected boolean debug = false;
+    protected boolean optimize = false;
+    protected boolean deprecation = false;
+    protected boolean depend = false;
+    protected boolean verbose = false;
+    protected String target;
+    protected Path bootclasspath;
+    protected Path extdirs;
+    protected Path compileClasspath;
+    protected Project project;
+    protected Location location;
+    protected boolean includeAntRuntime;
+    protected boolean includeJavaRuntime;
+
+    protected File[] compileList;
+    protected static String lSep = System.getProperty("line.separator");
+    protected Javac attributes;
+
+    public void setJavac( Javac attributes ) {
+        this.attributes = attributes;
+        src = attributes.getSrcdir();
+        destDir = attributes.getDestdir();
+        encoding = attributes.getEncoding();
+        debug = attributes.getDebug();
+        optimize = attributes.getOptimize();
+        deprecation = attributes.getDeprecation();
+        depend = attributes.getDepend();
+        verbose = attributes.getVerbose();
+        target = attributes.getTarget();
+        bootclasspath = attributes.getBootclasspath();
+        extdirs = attributes.getExtdirs();
+        compileList = attributes.getFileList();
+        compileClasspath = attributes.getClasspath();
+        project = attributes.getProject();
+        location = attributes.getLocation();
+        includeAntRuntime = attributes.getIncludeantruntime();
+        includeJavaRuntime = attributes.getIncludejavaruntime();
+    }
+
+    public Javac getJavac() {
+        return attributes;
+    }
+
+    /**
+     * Builds the compilation classpath.
+     *
+     */
+    protected Path getCompileClasspath() {
+        Path classpath = new Path(project);
+
+        // add dest dir to classpath so that previously compiled and
+        // untouched classes are on classpath
+
+        if (destDir != null) {
+            classpath.setLocation(destDir);
+        }
+
+        // Combine the build classpath with the system classpath, in an 
+        // order determined by the value of build.classpath
+
+        if (compileClasspath == null) {
+            if ( includeAntRuntime ) {
+                classpath.addExisting(Path.systemClasspath);
+            }
+        } else {
+            if ( includeAntRuntime ) {
+                classpath.addExisting(compileClasspath.concatSystemClasspath("last"));
+            } else {
+                classpath.addExisting(compileClasspath.concatSystemClasspath("ignore"));
+            }
+        }
+
+        if (includeJavaRuntime) {
+            if (System.getProperty("java.vendor").toLowerCase().indexOf("microsoft") >= 0) {
+                // Pull in *.zip from packages directory
+                FileSet msZipFiles = new FileSet();
+                msZipFiles.setDir(new File(System.getProperty("java.home") + File.separator + "Packages"));
+                msZipFiles.setIncludes("*.ZIP");
+                classpath.addFileset(msZipFiles);
+            }
+            else if (Project.getJavaVersion() == Project.JAVA_1_1) {
+                classpath.addExisting(new Path(null,
+                                                System.getProperty("java.home")
+                                                + File.separator + "lib"
+                                                + File.separator 
+                                                + "classes.zip"));
+            } else {
+                // JDK > 1.1 seems to set java.home to the JRE directory.
+                classpath.addExisting(new Path(null,
+                                                System.getProperty("java.home")
+                                                + File.separator + "lib"
+                                                + File.separator + "rt.jar"));
+                // Just keep the old version as well and let addExistingToPath
+                // sort it out.
+                classpath.addExisting(new Path(null,
+                                                System.getProperty("java.home")
+                                                + File.separator +"jre"
+                                                + File.separator + "lib"
+                                                + File.separator + "rt.jar"));
+            }
+        }
+            
+        return classpath;
+    }
+
+    /**
+     * Does the command line argument processing common to classic and
+     * modern.  
+     */
+    protected Commandline setupJavacCommand() {
+        Commandline cmd = new Commandline();
+        Path classpath = getCompileClasspath();
+
+        if (deprecation == true) {
+            cmd.createArgument().setValue("-deprecation");
+        }
+
+        if (destDir != null) {
+            cmd.createArgument().setValue("-d");
+            cmd.createArgument().setFile(destDir);
+        }
+        
+        cmd.createArgument().setValue("-classpath");
+        // Just add "sourcepath" to classpath ( for JDK1.1 )
+        if (Project.getJavaVersion().startsWith("1.1")) {
+            cmd.createArgument().setValue(classpath.toString() 
+                                          + File.pathSeparator 
+                                          + src.toString());
+        } else {
+            cmd.createArgument().setPath(classpath);
+            cmd.createArgument().setValue("-sourcepath");
+            cmd.createArgument().setPath(src);
+            if (target != null) {
+                cmd.createArgument().setValue("-target");
+                cmd.createArgument().setValue(target);
+            }
+        }
+        if (encoding != null) {
+            cmd.createArgument().setValue("-encoding");
+            cmd.createArgument().setValue(encoding);
+        }
+        if (debug) {
+            cmd.createArgument().setValue("-g");
+        }
+        if (optimize) {
+            cmd.createArgument().setValue("-O");
+        }
+        if (bootclasspath != null) {
+            cmd.createArgument().setValue("-bootclasspath");
+            cmd.createArgument().setPath(bootclasspath);
+        }
+        if (extdirs != null) {
+            cmd.createArgument().setValue("-extdirs");
+            cmd.createArgument().setPath(extdirs);
+        }
+
+        if (depend) {
+            if (Project.getJavaVersion().startsWith("1.1")) {
+                cmd.createArgument().setValue("-depend");
+            } else if (Project.getJavaVersion().startsWith("1.2")) {
+                cmd.createArgument().setValue("-Xdepend");
+            } else {
+                attributes.log("depend attribute is not supported by the modern compiler",
+                    Project.MSG_WARN);
+            }
+        }
+
+        if (verbose) {
+            cmd.createArgument().setValue("-verbose");
+        }
+
+        logAndAddFilesToCompile(cmd);
+        return cmd;
+    }
+
+    /**
+     * Logs the compilation parameters, adds the files to compile and logs the 
+     * &qout;niceSourceList&quot;
+     */
+    protected void logAndAddFilesToCompile(Commandline cmd) {
+        attributes.log("Compilation args: " + cmd.toString(),
+            Project.MSG_VERBOSE);
+
+        StringBuffer niceSourceList = new StringBuffer("File");
+        if (compileList.length != 1) {
+            niceSourceList.append("s");
+        }
+        niceSourceList.append(" to be compiled:");
+
+        niceSourceList.append(lSep);
+
+        for (int i=0; i < compileList.length; i++) {
+            String arg = compileList[i].getAbsolutePath();
+            cmd.createArgument().setValue(arg);
+            niceSourceList.append("    " + arg + lSep);
+        }
+
+        attributes.log(niceSourceList.toString(), Project.MSG_VERBOSE);
+    }
+
+    /**
+     * Do the compile with the specified arguments.
+     * @param args - arguments to pass to process on command line
+     * @param firstFileName - index of the first source file in args
+     */
+    protected int executeExternalCompile(String[] args, int firstFileName) {
+        String[] commandArray = null;
+        File tmpFile = null;
+
+        try {
+            /*
+             * Many system have been reported to get into trouble with 
+             * long command lines - no, not only Windows ;-).
+             *
+             * POSIX seems to define a lower limit of 4k, so use a temporary 
+             * file if the total length of the command line exceeds this limit.
+             */
+            if (Commandline.toString(args).length() > 4096) {
+                PrintWriter out = null;
+                try {
+                    tmpFile = new File("jikes"+(new Random(System.currentTimeMillis())).nextLong());
+                    out = new PrintWriter(new FileWriter(tmpFile));
+                    for (int i = firstFileName; i < args.length; i++) {
+                        out.println(args[i]);
+                    }
+                    out.flush();
+                    commandArray = new String[firstFileName+1];
+                    System.arraycopy(args, 0, commandArray, 0, firstFileName);
+                    commandArray[firstFileName] = "@" + tmpFile.getAbsolutePath();
+                } catch (IOException e) {
+                    throw new BuildException("Error creating temporary file", e, location);
+                } finally {
+                    if (out != null) {
+                        try {out.close();} catch (Throwable t) {}
+                    }
+                }
+            } else {
+                commandArray = args;
+            }
+            
+            try {
+                Execute exe = new Execute(new LogStreamHandler(attributes, 
+                                                               Project.MSG_INFO,
+                                                               Project.MSG_WARN));
+                exe.setAntRun(project);
+                exe.setWorkingDirectory(project.getBaseDir());
+                exe.setCommandline(commandArray);
+                exe.execute();
+                return exe.getExitValue();
+            } catch (IOException e) {
+                throw new BuildException("Error running " + args[0] 
+                        + " compiler", e, location);
+            }
+        } finally {
+            if (tmpFile != null) {
+                tmpFile.delete();
+            }
+        }
+    }
+
+    /**
+     * Emulation of extdirs feature in java >= 1.2.
+     * This method adds all files in the given
+     * directories (but not in sub-directories!) to the classpath,
+     * so that you don't have to specify them all one by one.
+     * @param classpath - Path to append files to
+     */
+    protected void addExtdirsToClasspath(Path classpath) {
+        if (extdirs == null) {
+            String extProp = System.getProperty("java.ext.dirs");
+            if (extProp != null) {
+                extdirs = new Path(project, extProp);
+            } else {
+                return;
+            }
+        }
+
+        String[] dirs = extdirs.list();
+        for (int i=0; i<dirs.length; i++) {
+            if (!dirs[i].endsWith(File.separator)) {
+                dirs[i] += File.separator;
+            }
+            File dir = project.resolveFile(dirs[i]);
+            FileSet fs = new FileSet();
+            fs.setDir(dir);
+            fs.setIncludes("*");
+            classpath.addFileset(fs);
+        }
+    }
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac12.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac12.java
new file mode 100644
index 0000000..aca48f7
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac12.java
@@ -0,0 +1,108 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.taskdefs.LogOutputStream;
+import org.apache.tools.ant.types.Commandline;
+
+import java.io.*;
+import java.lang.reflect.Constructor;
+import java.lang.reflect.Method;
+
+/**
+ * The implementation of the javac compiler for JDK 1.2
+ * This is primarily a cut-and-paste from the original javac task before it
+ * was refactored.
+ *
+ * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
+ * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public class Javac12 extends DefaultCompilerAdapter {
+
+    public boolean execute() throws BuildException {
+        attributes.log("Using classic compiler", Project.MSG_VERBOSE);
+        Commandline cmd = setupJavacCommand();
+
+        try {
+            // Create an instance of the compiler, redirecting output to
+            // the project log
+            OutputStream logstr = new LogOutputStream(attributes, Project.MSG_WARN);
+            Class c = Class.forName("sun.tools.javac.Main");
+            Constructor cons = c.getConstructor(new Class[] { OutputStream.class, String.class });
+            Object compiler = cons.newInstance(new Object[] { logstr, "javac" });
+
+            // Call the compile() method
+            Method compile = c.getMethod("compile", new Class [] { String[].class });
+            Boolean ok = (Boolean)compile.invoke(compiler, new Object[] {cmd.getArguments()});
+            return ok.booleanValue();
+        }
+        catch (ClassNotFoundException ex) {
+            throw new BuildException("Cannot use classic compiler, as it is not available"+
+                                                         " A common solution is to set the environment variable"+
+                                     " JAVA_HOME to your jdk directory.", location);
+        }
+        catch (Exception ex) {
+            if (ex instanceof BuildException) {
+                throw (BuildException) ex;
+            } else {
+                throw new BuildException("Error starting classic compiler: ", ex, location);
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac13.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac13.java
new file mode 100644
index 0000000..a50713f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Javac13.java
@@ -0,0 +1,113 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.taskdefs.LogOutputStream;
+import org.apache.tools.ant.types.Commandline;
+
+import java.lang.reflect.Method;
+import java.io.*;
+
+/**
+ * The implementation of the javac compiler for JDK 1.3
+ * This is primarily a cut-and-paste from the original javac task before it
+ * was refactored.
+ *
+ * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
+ * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public class Javac13 extends DefaultCompilerAdapter {
+
+    /**
+     * Integer returned by the "Modern" jdk1.3 compiler to indicate success.
+     */
+    private static final int MODERN_COMPILER_SUCCESS = 0;
+
+    public boolean execute() throws BuildException {
+        attributes.log("Using modern compiler", Project.MSG_VERBOSE);
+        Commandline cmd = setupJavacCommand();
+
+        PrintStream err = System.err;
+        PrintStream out = System.out;
+
+        // Use reflection to be able to build on all JDKs >= 1.1:
+        try {
+            PrintStream logstr = 
+                new PrintStream(new LogOutputStream(attributes, Project.MSG_WARN));
+            System.setOut(logstr);
+            System.setErr(logstr);
+            Class c = Class.forName ("com.sun.tools.javac.Main");
+            Object compiler = c.newInstance ();
+            Method compile = c.getMethod ("compile",
+                new Class [] {(new String [] {}).getClass ()});
+            int result = ((Integer) compile.invoke
+                          (compiler, new Object[] {cmd.getArguments()})) .intValue ();
+            return (result == MODERN_COMPILER_SUCCESS);
+        } catch (Exception ex) {
+            if (ex instanceof BuildException) {
+                throw (BuildException) ex;
+            } else {
+                throw new BuildException("Error starting modern compiler", ex, location);
+            }
+        } finally {
+            System.setErr(err);
+            System.setOut(out);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jikes.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jikes.java
new file mode 100644
index 0000000..fbc4e12
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jikes.java
@@ -0,0 +1,205 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.types.*;
+
+/**
+ * The implementation of the jikes compiler.
+ * This is primarily a cut-and-paste from the original javac task before it
+ * was refactored.
+ *
+ * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
+ * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public class Jikes extends DefaultCompilerAdapter {
+
+    /**
+     * Performs a compile using the Jikes compiler from IBM..
+     * Mostly of this code is identical to doClassicCompile()
+     * However, it does not support all options like
+     * bootclasspath, extdirs, deprecation and so on, because
+     * there is no option in jikes and I don't understand
+     * what they should do.
+     *
+     * It has been successfully tested with jikes >1.10
+     *
+     * @author skanthak@muehlheim.de
+     */
+    public boolean execute() throws BuildException {
+        attributes.log("Using jikes compiler", Project.MSG_VERBOSE);
+
+        Path classpath = new Path(project);
+
+        // Jikes doesn't support bootclasspath dir (-bootclasspath)
+        // so we'll emulate it for compatibility and convenience.
+        if (bootclasspath != null) {
+            classpath.append(bootclasspath);
+        }
+
+        // Jikes doesn't support an extension dir (-extdir)
+        // so we'll emulate it for compatibility and convenience.
+        addExtdirsToClasspath(classpath);
+
+        if ( (bootclasspath == null) || (bootclasspath.size() == 0) ) {
+            // no bootclasspath, therefore, get one from the java runtime
+            includeJavaRuntime = true;
+        } else {
+            // there is a bootclasspath stated.  By default, the
+            // includeJavaRuntime is false.  If the user has stated a
+            // bootclasspath and said to include the java runtime, it's on
+            // their head!
+        }
+        classpath.append(getCompileClasspath());
+
+        // Jikes has no option for source-path so we
+        // will add it to classpath.
+        classpath.append(src);
+
+        // if the user has set JIKESPATH we should add the contents as well
+        String jikesPath = System.getProperty("jikes.class.path");
+        if (jikesPath != null) {
+            classpath.append(new Path(project, jikesPath));
+        }
+        
+        Commandline cmd = new Commandline();
+        cmd.setExecutable("jikes");
+
+        if (deprecation == true)
+            cmd.createArgument().setValue("-deprecation");
+
+        if (destDir != null) {
+            cmd.createArgument().setValue("-d");
+            cmd.createArgument().setFile(destDir);
+        }
+        
+        cmd.createArgument().setValue("-classpath");
+        cmd.createArgument().setPath(classpath);
+
+        if (encoding != null) {
+            cmd.createArgument().setValue("-encoding");
+            cmd.createArgument().setValue(encoding);
+        }
+        if (debug) {
+            cmd.createArgument().setValue("-g");
+        }
+        if (optimize) {
+            cmd.createArgument().setValue("-O");
+        }
+        if (verbose) {
+            cmd.createArgument().setValue("-verbose");
+        }
+        if (depend) {
+            cmd.createArgument().setValue("-depend");
+        } 
+        /**
+         * XXX
+         * Perhaps we shouldn't use properties for these
+         * three options (emacs mode, warnings and pedantic),
+         * but include it in the javac directive?
+         */
+
+        /**
+         * Jikes has the nice feature to print error
+         * messages in a form readable by emacs, so
+         * that emacs can directly set the cursor
+         * to the place, where the error occured.
+         */
+        String emacsProperty = project.getProperty("build.compiler.emacs");
+        if (emacsProperty != null && Project.toBoolean(emacsProperty)) {
+            cmd.createArgument().setValue("+E");
+        }
+
+        /**
+         * Jikes issues more warnings that javac, for
+         * example, when you have files in your classpath
+         * that don't exist. As this is often the case, these
+         * warning can be pretty annoying.
+         */
+        String warningsProperty = project.getProperty("build.compiler.warnings");
+        if (warningsProperty != null && !Project.toBoolean(warningsProperty)) {
+            cmd.createArgument().setValue("-nowarn");
+        }
+
+        /**
+         * Jikes can issue pedantic warnings. 
+         */
+        String pedanticProperty = project.getProperty("build.compiler.pedantic");
+        if (pedanticProperty != null && Project.toBoolean(pedanticProperty)) {
+            cmd.createArgument().setValue("+P");
+        }
+ 
+        /**
+         * Jikes supports something it calls "full dependency
+         * checking", see the jikes documentation for differences
+         * between -depend and +F.
+         */
+        String fullDependProperty = project.getProperty("build.compiler.fulldepend");
+        if (fullDependProperty != null && Project.toBoolean(fullDependProperty)) {
+            cmd.createArgument().setValue("+F");
+        }
+
+        int firstFileName = cmd.size();
+        logAndAddFilesToCompile(cmd);
+
+        return executeExternalCompile(cmd.getCommandline(), firstFileName) == 0;
+    }
+
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jvc.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jvc.java
new file mode 100644
index 0000000..e78788d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/compilers/Jvc.java
@@ -0,0 +1,137 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.compilers;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.types.*;
+
+/**
+ * The implementation of the jvc compiler from microsoft.
+ * This is primarily a cut-and-paste from the original javac task before it
+ * was refactored.
+ *
+ * @author James Davidson <a href="mailto:duncan@x180.com">duncan@x180.com</a>
+ * @author Robin Green <a href="mailto:greenrd@hotmail.com">greenrd@hotmail.com</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:jayglanville@home.com">J D Glanville</a>
+ */
+public class Jvc extends DefaultCompilerAdapter {
+
+    public boolean execute() throws BuildException {
+        attributes.log("Using jvc compiler", Project.MSG_VERBOSE);
+
+        Path classpath = new Path(project);
+
+        // jvc doesn't support bootclasspath dir (-bootclasspath)
+        // so we'll emulate it for compatibility and convenience.
+        if (bootclasspath != null) {
+            classpath.append(bootclasspath);
+        }
+
+        // jvc doesn't support an extension dir (-extdir)
+        // so we'll emulate it for compatibility and convenience.
+        addExtdirsToClasspath(classpath);
+
+        if ( (bootclasspath == null) || (bootclasspath.size() == 0) ) {
+            // no bootclasspath, therefore, get one from the java runtime
+            includeJavaRuntime = true;
+        } else {
+            // there is a bootclasspath stated.  By default, the
+            // includeJavaRuntime is false.  If the user has stated a
+            // bootclasspath and said to include the java runtime, it's on
+            // their head!
+        }
+        classpath.append(getCompileClasspath());
+
+        // jvc has no option for source-path so we
+        // will add it to classpath.
+        classpath.append(src);
+
+        Commandline cmd = new Commandline();
+        cmd.setExecutable("jvc");
+
+        if (destDir != null) {
+            cmd.createArgument().setValue("/d");
+            cmd.createArgument().setFile(destDir);
+        }
+        
+        // Add the Classpath before the "internal" one.
+        cmd.createArgument().setValue("/cp:p");
+        cmd.createArgument().setPath(classpath);
+
+        // Enable MS-Extensions and ...
+        cmd.createArgument().setValue("/x-");
+        // ... do not display a Message about this.
+        cmd.createArgument().setValue("/nomessage");
+        // Do not display Logo
+        cmd.createArgument().setValue("/nologo");
+
+        if (debug) {
+            cmd.createArgument().setValue("/g");
+        }
+        if (optimize) {
+            cmd.createArgument().setValue("/O");
+        }
+        if (verbose) {
+            cmd.createArgument().setValue("/verbose");
+        }
+
+        int firstFileName = cmd.size();
+        logAndAddFilesToCompile(cmd);
+
+        return executeExternalCompile(cmd.getCommandline(), firstFileName) == 0;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/defaults.properties b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/defaults.properties
index 7c703be..02f9758 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/defaults.properties
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/defaults.properties
@@ -42,6 +42,7 @@ mail=org.apache.tools.ant.taskdefs.SendEmail
 fail=org.apache.tools.ant.taskdefs.Exit
 war=org.apache.tools.ant.taskdefs.War
 uptodate=org.apache.tools.ant.taskdefs.UpToDate
+apply=org.apache.tools.ant.taskdefs.Transform
 
 # optional tasks
 script=org.apache.tools.ant.taskdefs.optional.Script
@@ -56,14 +57,38 @@ ejbjar=org.apache.tools.ant.taskdefs.optional.ejb.EjbJar
 mparse=org.apache.tools.ant.taskdefs.optional.metamata.MParse
 junit=org.apache.tools.ant.taskdefs.optional.junit.JUnitTask
 cab=org.apache.tools.ant.taskdefs.optional.Cab
-ftp=org.apache.tools.ant.taskdefs.optional.FTP
+ftp=org.apache.tools.ant.taskdefs.optional.net.FTP
 javacc=org.apache.tools.ant.taskdefs.optional.javacc.JavaCC
 jjtree=org.apache.tools.ant.taskdefs.optional.javacc.JJTree
 starteam=org.apache.tools.ant.taskdefs.optional.scm.AntStarTeamCheckOut
 wljspc=org.apache.tools.ant.taskdefs.optional.jsp.WLJspc
 jlink=org.apache.tools.ant.taskdefs.optional.jlink.JlinkTask
 native2ascii=org.apache.tools.ant.taskdefs.optional.Native2Ascii
-perforce=org.apache.tools.ant.taskdefs.optional.perforce.P4sync
+propertyfile=org.apache.tools.ant.taskdefs.optional.PropertyFile
+depend=org.apache.tools.ant.taskdefs.optional.depend.Depend
+antlr=org.apache.tools.ant.taskdefs.optional.ANTLR
+vajload=org.apache.tools.ant.taskdefs.optional.ide.VAJLoadProjects
+vajexport=org.apache.tools.ant.taskdefs.optional.ide.VAJExport
+vajimport=org.apache.tools.ant.taskdefs.optional.ide.VAJImport
+telnet=org.apache.tools.ant.taskdefs.optional.net.TelnetTask
+csc=org.apache.tools.ant.taskdefs.optional.dotnet.CSharp
+ilasm=org.apache.tools.ant.taskdefs.optional.dotnet.Ilasm
+stylebook=org.apache.tools.ant.taskdefs.optional.StyleBook
+test=org.apache.tools.ant.taskdefs.optional.Test
+p4change=org.apache.tools.ant.taskdefs.optional.perforce.P4Change
+p4label=org.apache.tools.ant.taskdefs.optional.perforce.P4Label
+p4have=org.apache.tools.ant.taskdefs.optional.perforce.P4Have
+p4sync=org.apache.tools.ant.taskdefs.optional.perforce.P4Sync
+p4edit=org.apache.tools.ant.taskdefs.optional.perforce.P4Edit
+p4submit=org.apache.tools.ant.taskdefs.optional.perforce.P4Submit
+javah=org.apache.tools.ant.taskdefs.optional.Javah
+ccupdate=org.apache.tools.ant.taskdefs.optional.clearcase.CCUpdate
+cccheckout=org.apache.tools.ant.taskdefs.optional.clearcase.CCCheckout
+cccheckin=org.apache.tools.ant.taskdefs.optional.clearcase.CCCheckin
+ccuncheckout=org.apache.tools.ant.taskdefs.optional.clearcase.CCUnCheckout
+sound=org.apache.tools.ant.taskdefs.optional.sound.SoundTask
+junitreport=org.apache.tools.ant.taskdefs.optional.junit.XMLResultAggregator
+vsslabel=org.apache.tools.ant.taskdefs.optional.vss.MSVSSLABEL
 
 # deprecated ant tasks (kept for back compatibility)
 javadoc2=org.apache.tools.ant.taskdefs.Javadoc
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ANTLR.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ANTLR.java
new file mode 100644
index 0000000..781de16
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ANTLR.java
@@ -0,0 +1,173 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional;
+
+import java.io.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+/**
+ * @author Erik Meade, emeade@geekfarm.org
+ */
+public class ANTLR extends Task {
+
+    private CommandlineJava commandline = new CommandlineJava();
+    private File target;
+    private File outputDirectory;
+    private boolean fork = false;
+    private File dir;
+
+    public ANTLR() {
+        commandline.setVm("java");
+        commandline.setClassname("antlr.Tool");
+    }
+
+    public void setTarget(File target) {
+        log("Setting target to: " + target.toString(), Project.MSG_VERBOSE);
+        this.target = target;
+    }
+
+    public void setOutputdirectory(File outputDirectory) {
+        log("Setting output directory to: " + outputDirectory.toString(), Project.MSG_VERBOSE);
+        this.outputDirectory = outputDirectory;
+    }
+
+    public void setFork(boolean s) {
+        this.fork = s;
+    }
+
+    /**
+     * The working directory of the process
+     */
+    public void setDir(File d) {
+        this.dir = d;
+    }
+
+
+    public void execute() throws BuildException {
+        validateAttributes();
+
+        //TODO: use ANTLR to parse the grammer file to do this.
+        if (target.lastModified() > getGeneratedFile().lastModified()) {
+            commandline.createArgument().setValue("-o");
+            commandline.createArgument().setValue(outputDirectory.toString());
+            commandline.createArgument().setValue(target.toString());
+
+            if (fork) {
+                log("Forking " + commandline.toString(), Project.MSG_VERBOSE);
+                int err = run(commandline.getCommandline());
+                if (err == 1) {
+                    throw new BuildException("ANTLR returned: "+err, location);
+                }
+            }
+            else {
+                Execute.runCommand(this, commandline.getCommandline());
+            }
+        }
+    }
+
+    private void validateAttributes() throws BuildException{
+        if (target == null || !target.isFile()) {
+            throw new BuildException("Invalid target: " + target);
+        }
+
+        // if no output directory is specified, used the target's directory
+        if (outputDirectory == null) {
+            String fileName = target.toString();
+            setOutputdirectory(new File(target.getParent()));
+        }
+        if (!outputDirectory.isDirectory()) {
+            throw new BuildException("Invalid output directory: " + outputDirectory);
+        }
+        if (fork && (dir == null || !dir.isDirectory())) {
+            throw new BuildException("Invalid working directory: " + dir);
+        }
+    }
+
+    private File getGeneratedFile() throws BuildException {
+        String generatedFileName = null;
+        try {
+            BufferedReader in = new BufferedReader(new FileReader(target));
+            String line;
+            while ((line = in.readLine()) != null) {
+                int extendsIndex = line.indexOf(" extends ");
+                if (line.startsWith("class ") &&  extendsIndex > -1) {
+                    generatedFileName = line.substring(6, extendsIndex).trim();
+                    break;
+                }
+            }
+            in.close();
+        } catch (Exception e) {
+            throw new BuildException("Unable to determine generated class");
+        }
+        if (generatedFileName == null) {
+            throw new BuildException("Unable to determine generated class");
+        }
+        return new File(outputDirectory, generatedFileName + ".java");
+    }
+
+    private int run(String[] command) throws BuildException {
+        Execute exe = new Execute(new LogStreamHandler(this, Project.MSG_INFO,
+                                                       Project.MSG_WARN), null);
+        exe.setAntRun(project);
+        exe.setWorkingDirectory(dir);
+        exe.setCommandline(command);
+        try {
+            return exe.execute();
+        } catch (IOException e) {
+            throw new BuildException(e, location);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Cab.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Cab.java
index 8de2d30..1ea8b9c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Cab.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Cab.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -295,50 +295,66 @@ public class Cab extends MatchingTask {
     }
 
     public void execute() throws BuildException {
-        // we must be on Windows to continue
-        if (!isWindows)
-        {
-            log("cannot run on non-Windows platforms: " + myos,
-                Project.MSG_VERBOSE);
-            return;
-        }
-        
+
         checkConfiguration();
 
         Vector files = getFileList();
-        
+    
         // quick exit if the target is up to date
         if (isUpToDate(files)) return;
 
         log("Building "+ archiveType +": "+ cabFile.getAbsolutePath());
 
-        try {
-            File listFile = createListFile(files);
-            ExecTask exec = createExec();
-            File outFile = null;
+        // we must be on Windows to continue
+        if (!isWindows) {
+            log("Using listcab/libcabinet", Project.MSG_VERBOSE);
             
-            // die if cabarc fails
-            exec.setFailonerror(true);
-            exec.setDir(baseDir);
+            StringBuffer sb = new StringBuffer();
             
-            if (!doVerbose)
-            {
-                outFile = createTempFile("ant", null);
-                exec.setOutput(outFile);
+            Enumeration fileEnum = files.elements();
+            
+            while (fileEnum.hasMoreElements()) {
+                sb.append(fileEnum.nextElement()).append("\n");
             }
+            sb.append("\n").append(cabFile.getAbsolutePath()).append("\n");
+            
+            try {
+                Process p = Runtime.getRuntime().exec("listcab");
+                OutputStream out = p.getOutputStream();
+                out.write(sb.toString().getBytes());
+                out.flush();
+                out.close();
+            } catch (IOException ex) {
+                String msg = "Problem creating " + cabFile + " " + ex.getMessage();
+                throw new BuildException(msg);
+            }
+        } else {
+            try {
+                File listFile = createListFile(files);
+                ExecTask exec = createExec();
+                File outFile = null;
                 
-            exec.setCommand(createCommand(listFile));
-            exec.execute();
-
-            if (outFile != null)
-            {
-                outFile.delete();
+                // die if cabarc fails
+                exec.setFailonerror(true);
+                exec.setDir(baseDir);
+                
+                if (!doVerbose) {
+                    outFile = createTempFile("ant", null);
+                    exec.setOutput(outFile);
+                }
+                    
+                exec.setCommand(createCommand(listFile));
+                exec.execute();
+    
+                if (outFile != null) {
+                    outFile.delete();
+                }
+                
+                listFile.delete();
+            } catch (IOException ioe) {
+                String msg = "Problem creating " + cabFile + " " + ioe.getMessage();
+                throw new BuildException(msg);
             }
-            
-            listFile.delete();
-        } catch (IOException ioe) {
-            String msg = "Problem creating " + cabFile + " " + ioe.getMessage();
-            throw new BuildException(msg);
         }
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Javah.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Javah.java
new file mode 100644
index 0000000..7818978
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Javah.java
@@ -0,0 +1,466 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.DirectoryScanner;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.taskdefs.LogOutputStream;
+import org.apache.tools.ant.types.*;
+
+import java.lang.reflect.Method;
+import java.lang.reflect.Constructor;
+import java.io.*;
+import java.util.*;
+
+/**
+ * Task to generate JNI header files using javah. This task can take the following
+ * arguments:
+ * <ul>
+ * <li>classname - the fully-qualified name of a class</li>
+ * <li>outputFile - Concatenates the resulting header or source files for all
+ *     the classes listed into this file</li>
+ * <li>destdir - Sets the directory where javah saves the header files or the
+ *     stub files</li>
+ * <li>classpath</li>
+ * <li>bootclasspath</li>
+ * <li>force - Specifies that output files should always be written
+       (JDK1.2 only)</li>
+ * <li>old - Specifies that old JDK1.0-style header files should be generated
+ *     (otherwise output file contain JNI-style native method
+ *      function prototypes) (JDK1.2 only)</li>
+ * <li>stubs - generate C declarations from the Java object file (used with old)</li>
+ * <li>verbose - causes javah to print a message to stdout concerning the status
+ *     of the generated files</li>
+ * <li>extdirs - Override location of installed extensions</li>
+ * </ul>
+ * Of these arguments, either <b>outputFile</b> or <b>destdir</b> is required,
+ * but not both. More than one classname may be specified, using a comma-separated
+ * list or by using <code>&lt;class name="xxx"&gt;</code> elements within the task.
+ * <p>
+ * When this task executes, it will generate C header and source files that
+ * are needed to implement native methods.
+ *
+ * @author Rick Beton <a href="mailto:richard.beton@physics.org">richard.beton@physics.org</a>
+ */
+
+public class Javah extends Task {
+
+    private static final String FAIL_MSG = "Compile failed, messages should have been provided.";
+
+    private Vector classes = new Vector(2);
+    private String cls;
+    private File destDir;
+    private Path classpath = null;
+    private String outputFile = null;
+    private boolean verbose = false;
+    private boolean force   = false;
+    private boolean old     = false;
+    private boolean stubs   = false;
+    private Path bootclasspath;
+    //private Path extdirs;
+    private static String lSep = System.getProperty("line.separator");
+
+    public void setClass(String cls) {
+        this.cls = cls;
+    }
+
+    public ClassArgument createClass() {
+        ClassArgument ga = new ClassArgument();
+        classes.addElement(ga);
+        return ga;
+    }
+
+    public class ClassArgument {
+        private String name;
+
+        public ClassArgument() {
+        }
+
+        public void setName(String name) {
+            this.name = name;
+            log("ClassArgument.name="+name);
+        }
+
+        public String getName() {
+            return name;
+        }
+    }
+
+    /**
+     * Set the destination directory into which the Java source
+     * files should be compiled.
+     */
+    public void setDestdir(File destDir) {
+        this.destDir = destDir;
+    }
+
+    public void setClasspath(Path src) {
+        if (classpath == null) {
+            classpath = src;
+        } else {
+            classpath.append(src);
+        }
+    }
+    public Path createClasspath() {
+        if (classpath == null) {
+            classpath = new Path(project);
+        }
+        return classpath.createPath();
+    }
+
+    /**
+     * Adds a reference to a CLASSPATH defined elsewhere.
+     */
+    public void setClasspathRef(Reference r) {
+        createClasspath().setRefid(r);
+    }
+
+    public void setBootclasspath(Path src) {
+        if (bootclasspath == null) {
+            bootclasspath = src;
+        } else {
+            bootclasspath.append(src);
+        }
+    }
+    public Path createBootclasspath() {
+        if (bootclasspath == null) {
+            bootclasspath = new Path(project);
+        }
+        return bootclasspath.createPath();
+    }
+
+    /**
+     * Adds a reference to a CLASSPATH defined elsewhere.
+     */
+    public void setBootClasspathRef(Reference r) {
+        createBootclasspath().setRefid(r);
+    }
+
+    ///**
+    // * Sets the extension directories that will be used during the
+    // * compilation.
+    // */
+    //public void setExtdirs(Path extdirs) {
+    //    if (this.extdirs == null) {
+    //        this.extdirs = extdirs;
+    //    } else {
+    //        this.extdirs.append(extdirs);
+    //    }
+    //}
+
+    ///**
+    // * Maybe creates a nested classpath element.
+    // */
+    //public Path createExtdirs() {
+    //    if (extdirs == null) {
+    //        extdirs = new Path(project);
+    //    }
+    //    return extdirs.createPath();
+    //}
+
+    /**
+     * Set the output file name.
+     */
+    public void setOutputFile(String outputFile) {
+        this.outputFile = outputFile;
+    }
+
+    /**
+     * Set the force-write flag.
+     */
+    public void setForce(boolean force) {
+        this.force = force;
+    }
+
+    /**
+     * Set the old flag.
+     */
+    public void setOld(boolean old) {
+        this.old = old;
+    }
+
+    /**
+     * Set the stubs flag.
+     */
+    public void setStubs(boolean stubs) {
+        this.stubs = stubs;
+    }
+
+    /**
+     * Set the verbose flag.
+     */
+    public void setVerbose(boolean verbose) {
+        this.verbose = verbose;
+    }
+
+    /**
+     * Executes the task.
+     */
+    public void execute() throws BuildException {
+        // first off, make sure that we've got a srcdir
+
+        if ((cls == null) && (classes.size() == 0)) {
+            throw new BuildException("class attribute must be set!", location);
+        }
+
+        if ((cls != null) && (classes.size() > 0)) {
+            throw new BuildException("set class attribute or class element, not both.", location);
+        }
+
+        if (destDir != null) {
+            if (!destDir.isDirectory()) {
+                throw new BuildException("destination directory \"" + destDir + "\" does not exist or is not a directory", location);
+            }
+            if (outputFile != null) {
+                throw new BuildException("destdir and outputFile are mutually exclusive", location);
+            }
+        }
+
+        if (classpath == null) {
+            classpath = Path.systemClasspath;
+        }
+
+        String compiler = project.getProperty("build.compiler");
+        if (compiler == null) {
+            if (Project.getJavaVersion().startsWith("1.3")) {
+                compiler = "modern";
+            } else {
+                compiler = "classic";
+            }
+        }
+
+        doClassicCompile();
+    }
+
+    // XXX
+    // we need a way to not use the current classpath.
+
+    /**
+     * Peforms a compile using the classic compiler that shipped with
+     * JDK 1.1 and 1.2.
+     */
+
+    private void doClassicCompile() throws BuildException {
+        Commandline cmd = setupJavahCommand();
+
+        // Use reflection to be able to build on all JDKs
+        /*
+        // provide the compiler a different message sink - namely our own
+        sun.tools.javac.Main compiler =
+                new sun.tools.javac.Main(new LogOutputStream(this, Project.MSG_WARN), "javac");
+
+        if (!compiler.compile(cmd.getArguments())) {
+            throw new BuildException("Compile failed");
+        }
+        */
+        PrintStream err = System.err;
+        PrintStream out = System.out;
+
+        try {
+            // Javac uses logstr to change the output stream and calls
+            // the constructor's invoke method to create a compiler instance
+            // dynamically. However, javah has a different interface and this
+            // makes it harder, so here's a simple alternative.
+            //------------------------------------------------------------------
+            PrintStream logstr = 
+                new PrintStream(new LogOutputStream(this, Project.MSG_WARN));
+            System.setOut(logstr);
+            System.setErr(logstr);
+            com.sun.tools.javah.Main main = new com.sun.tools.javah.Main( cmd.getArguments() );
+            main.run();
+        }
+        //catch (ClassNotFoundException ex) {
+        //    throw new BuildException("Cannot use javah because it is not available"+
+        //                             " A common solution is to set the environment variable"+
+        //                             " JAVA_HOME to your jdk directory.", location);
+        //}
+        catch (Exception ex) {
+            if (ex instanceof BuildException) {
+                throw (BuildException) ex;
+            } else {
+                throw new BuildException("Error starting javah: ", ex, location);
+            }
+        } finally {
+            System.setErr(err);
+            System.setOut(out);
+        }
+    }
+
+    /**
+     * Does the command line argument processing common to classic and
+     * modern.
+     */
+    private Commandline setupJavahCommand() {
+        Commandline cmd = new Commandline();
+
+        if (destDir != null) {
+            cmd.createArgument().setValue("-d");
+            cmd.createArgument().setFile(destDir);
+        }
+
+        if (outputFile != null) {
+            cmd.createArgument().setValue("-o");
+            cmd.createArgument().setValue(outputFile);
+        }
+
+        if (classpath != null) {
+            cmd.createArgument().setValue("-classpath");
+            cmd.createArgument().setPath(classpath);
+        }
+
+        // JDK1.1 is rather simpler than JDK1.2
+        if (Project.getJavaVersion().startsWith("1.1")) {
+            if (verbose) {
+                cmd.createArgument().setValue("-v");
+            }
+        } else {
+            if (verbose) {
+                cmd.createArgument().setValue("-verbose");
+            }
+            if (old) {
+                cmd.createArgument().setValue("-old");
+            }
+            if (force) {
+                cmd.createArgument().setValue("-force");
+            }
+        }
+
+        if (stubs) {
+            if (!old) {
+                throw new BuildException("stubs only available in old mode.", location);
+            }
+            cmd.createArgument().setValue("-stubs");
+        }
+        if (bootclasspath != null) {
+            cmd.createArgument().setValue("-bootclasspath");
+            cmd.createArgument().setPath(bootclasspath);
+        }
+
+        logAndAddFilesToCompile(cmd);
+        return cmd;
+    }
+
+    /**
+     * Logs the compilation parameters, adds the files to compile and logs the
+     * &qout;niceSourceList&quot;
+     */
+    protected void logAndAddFilesToCompile(Commandline cmd) {
+        int n = 0;
+        log("Compilation args: " + cmd.toString(),
+            Project.MSG_VERBOSE);
+
+        StringBuffer niceClassList = new StringBuffer();
+        if (cls != null) {
+            StringTokenizer tok = new StringTokenizer(cls, ",", false);
+            while (tok.hasMoreTokens()) {
+                String aClass = tok.nextToken().trim();
+                cmd.createArgument().setValue(aClass);
+                niceClassList.append("    " + aClass + lSep);
+                n++;
+            }
+        }
+
+        Enumeration enum = classes.elements();
+        while (enum.hasMoreElements()) {
+            ClassArgument arg = (ClassArgument)enum.nextElement();
+            String aClass = arg.getName();
+            cmd.createArgument().setValue(aClass);
+            niceClassList.append("    " + aClass + lSep);
+            n++;
+        }
+
+        StringBuffer prefix = new StringBuffer("Class");
+        if (n > 1) {
+            prefix.append("es");
+        }
+        prefix.append(" to be compiled:");
+        prefix.append(lSep);
+
+        log(prefix.toString() + niceClassList.toString(), Project.MSG_VERBOSE);
+    }
+
+    ///**
+    // * Emulation of extdirs feature in java >= 1.2.
+    // * This method adds all files in the given
+    // * directories (but not in sub-directories!) to the classpath,
+    // * so that you don't have to specify them all one by one.
+    // * @param classpath - Path to append files to
+    // */
+    //protected void addExtdirsToClasspath(Path classpath) {
+    //    if (extdirs == null) {
+    //        String extProp = System.getProperty("java.ext.dirs");
+    //        if (extProp != null) {
+    //            extdirs = new Path(project, extProp);
+    //        } else {
+    //            return;
+    //        }
+    //    }
+    //
+    //    String[] dirs = extdirs.list();
+    //    for (int i=0; i<dirs.length; i++) {
+    //        if (!dirs[i].endsWith(File.separator)) {
+    //            dirs[i] += File.separator;
+    //        }
+    //        File dir = project.resolveFile(dirs[i]);
+    //        FileSet fs = new FileSet();
+    //        fs.setDir(dir);
+    //        fs.setIncludes("*");
+    //        classpath.addFileset(fs);
+    //    }
+    //}
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Native2Ascii.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Native2Ascii.java
index dd180fc..870a364 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Native2Ascii.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Native2Ascii.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -59,7 +59,8 @@ import org.apache.tools.ant.DirectoryScanner;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.taskdefs.MatchingTask;
 import org.apache.tools.ant.types.Commandline;
-import org.apache.tools.ant.types.Commandline.Argument;
+import org.apache.tools.ant.types.Mapper;
+import org.apache.tools.ant.util.*;
 
 import java.io.File;
 
@@ -67,6 +68,7 @@ import java.io.File;
  * Convert files from native encodings to ascii.
  *
  * @author Drew Sudell <asudell@acm.org>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 public class Native2Ascii extends MatchingTask {
 
@@ -76,6 +78,7 @@ public class Native2Ascii extends MatchingTask {
     private File destDir = null;      // Where to put output files
     private String extension = null;  // Extension of output files if different
 
+    private Mapper mapper;
 
     /**
      * Flag the conversion to run in the reverse sense,
@@ -128,6 +131,18 @@ public class Native2Ascii extends MatchingTask {
         this.extension = ext;
     }
 
+    /**
+     * Defines the FileNameMapper to use (nested mapper element).
+     */
+    public Mapper createMapper() throws BuildException {
+        if (mapper != null) {
+            throw new BuildException("Cannot define more than one mapper",
+                                     location);
+        }
+        mapper = new Mapper(project);
+        return mapper;
+    }
+
     public void execute() throws BuildException {
 
         Commandline baseCmd = null;      // the common portion of our cmd line
@@ -147,16 +162,35 @@ public class Native2Ascii extends MatchingTask {
         // if src and dest dirs are the same, require the extension
         // to be set, so we don't stomp every file.  One could still
         // include a file with the same extension, but ....
-        if (srcDir.equals(destDir) && (extension == null)){
-            throw new BuildException("The ext attribut must be set if"
+        if (srcDir.equals(destDir) && extension == null && mapper == null){
+            throw new BuildException("The ext attribute or a mapper must be set if"
                                      + " src and dest dirs are the same.");
         }
 
+        FileNameMapper m = null;
+        if (mapper == null) {
+            if (extension == null) {
+                m = new IdentityMapper();
+            } else {
+                m = new ExtMapper();
+            }
+        } else {
+            m = mapper.getImplementation();
+        }
+        
         scanner = getDirectoryScanner(srcDir);
-        log("Converting files from " + srcDir + " to " + destDir);
         files = scanner.getIncludedFiles();
+        SourceFileScanner sfs = new SourceFileScanner(this);
+        files = sfs.restrict(files, srcDir, destDir, m);
+        int count = files.length;
+        if (count == 0) {
+            return;
+        }
+        String message = "Converting "+ count + " file"
+            + (count != 1 ? "s" : "") + " from ";
+        log(message + srcDir + " to " + destDir);
         for (int i = 0; i < files.length; i++){
-            convert(files[i]);
+            convert(files[i], m.mapFileName(files[i])[0]);
         }
     }
 
@@ -165,7 +199,7 @@ public class Native2Ascii extends MatchingTask {
      *
      * @param fileName Name of the file to convert (relative to srcDir).
      */
-    private void convert(String fileName) throws BuildException {
+    private void convert(String srcName, String destName) throws BuildException {
 
         Commandline cmd = new Commandline();  // Command line to run
         File srcFile;                         // File to convert
@@ -182,49 +216,49 @@ public class Native2Ascii extends MatchingTask {
             cmd.createArgument().setValue(encoding);
         }
 
-        // Build the full file names, substuting the extension on the
-        // destination file if needed.
-        srcFile = new File(srcDir, fileName);
-
-        if (extension != null){
-            destFile
-                = new File(destDir,
-                           fileName.substring(0, fileName.lastIndexOf('.'))
-                           + extension);
-        }else{
-            destFile = new File(destDir, fileName);
-        }
-        
+        // Build the full file names
+        srcFile = new File(srcDir, srcName);
+        destFile = new File(destDir, destName);
+
         cmd.createArgument().setFile(srcFile);
         cmd.createArgument().setFile(destFile);
+        // Make sure we're not about to clobber something
+        if (srcFile.equals(destFile)){
+            throw new BuildException("file " + srcFile 
+                                     + " would overwrite its self");
+        }
 
-        // Only process if dest not newer than src
-        if (! destFile.exists()
-            || (destFile.lastModified() < srcFile.lastModified())){
-
-            // Make sure we're not about to clobber something
-            if (srcFile.equals(destFile)){
-                throw new BuildException("file " + srcFile 
-                                         + " would overwrite its self");
-            }
-
-            // Make intermediate directories if needed
-            // XXX JDK 1.1 dosen't have File.getParentFile,
-            String parentName = destFile.getParent();
-            if (parentName != null){
-                File parentFile = new File(parentName);
-             
-                if ((! parentFile.exists()) && ( ! parentFile.mkdirs())){
-                    throw new BuildException("cannot create parent directory "
-                                             + parentName);
-                }
+        // Make intermediate directories if needed
+        // XXX JDK 1.1 dosen't have File.getParentFile,
+        String parentName = destFile.getParent();
+        if (parentName != null){
+            File parentFile = new File(parentName);
+            
+            if ((! parentFile.exists()) && ( ! parentFile.mkdirs())){
+                throw new BuildException("cannot create parent directory "
+                                         + parentName);
             }
+        }
                         
-            log("converting " + fileName, Project.MSG_VERBOSE);
-            sun.tools.native2ascii.Main n2a
-                = new sun.tools.native2ascii.Main();
-            if(! n2a.convert(cmd.getArguments())){
-                throw new BuildException("conversion failed");
+        log("converting " + srcName, Project.MSG_VERBOSE);
+        sun.tools.native2ascii.Main n2a
+            = new sun.tools.native2ascii.Main();
+        if(! n2a.convert(cmd.getArguments())){
+            throw new BuildException("conversion failed");
+        }
+    }
+
+    private class ExtMapper implements FileNameMapper {
+
+        public void setFrom(String s) {}
+        public void setTo(String s) {}
+
+        public String[] mapFileName(String fileName) {
+            int lastDot = fileName.lastIndexOf('.');
+            if (lastDot >= 0) {
+                return new String[] {fileName.substring(0, lastDot) + extension};
+            } else {
+                return new String[] {fileName + extension};
             }
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/NetRexxC.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/NetRexxC.java
index 38b3197..4af0a02 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/NetRexxC.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/NetRexxC.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,17 +51,14 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs.optional;
 
-import org.apache.tools.ant.*;
-import org.apache.tools.ant.taskdefs.*;
-
-import netrexx.lang.Rexx;
-
 import java.io.*;
 import java.lang.reflect.*;
 import java.util.*;
+import netrexx.lang.Rexx;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
 
 /**
  * Task to compile NetRexx source files. This task can take the following
@@ -154,8 +151,8 @@ public class NetRexxC extends MatchingTask {
     /**
      * Set whether literals are treated as binary, rather than NetRexx types
      */
-    public void setBinary(String binary) {
-        this.binary = Project.toBoolean(binary);
+    public void setBinary(boolean binary) {
+        this.binary = binary;
     }
 
     /**
@@ -170,17 +167,17 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false
      */
-    public void setComments(String comments) {
-        this.comments = Project.toBoolean(comments);
+    public void setComments(boolean comments) {
+        this.comments = comments;
     }
 
-   /**
+    /**
      * Set whether error messages come out in compact or verbose format.
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false
      */
-    public void setCompact(String compact) {
-        this.compact = Project.toBoolean(compact);
+    public void setCompact(boolean compact) {
+        this.compact = compact;
     }
 
     /**
@@ -189,8 +186,8 @@ public class NetRexxC extends MatchingTask {
      * The default value is true.
      * Setting this flag to false, will automatically set the keep flag to true.
      */
-    public void setCompile(String compile) {
-        this.compile = Project.toBoolean(compile);
+    public void setCompile(boolean compile) {
+        this.compile = compile;
         if (!this.compile && !this.keep) this.keep = true;
     }
 
@@ -199,15 +196,15 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is true.
      */
-    public void setConsole(String console) {
-        this.console = Project.toBoolean(console);
+    public void setConsole(boolean console) {
+        this.console = console;
     }
 
     /**
      * Whether variable cross references are generated
      */
-    public void setCrossref(String crossref) {
-        this.crossref = Project.toBoolean(crossref);
+    public void setCrossref(boolean crossref) {
+        this.crossref = crossref;
     }
 
     /**
@@ -216,8 +213,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is true.
      */
-    public void setDecimal(String decimal) {
-        this.decimal = Project.toBoolean(decimal);
+    public void setDecimal(boolean decimal) {
+        this.decimal = decimal;
     }
 
     /**
@@ -231,8 +228,8 @@ public class NetRexxC extends MatchingTask {
     /**
      * Whether diagnostic information about the compile is generated
      */
-    public void setDiag(String diag) {
-        this.diag = Project.toBoolean(diag);
+    public void setDiag(boolean diag) {
+        this.diag = diag;
     }
 
     /**
@@ -240,16 +237,16 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setExplicit(String explicit) {
-        this.explicit = Project.toBoolean(explicit);
+    public void setExplicit(boolean explicit) {
+        this.explicit = explicit;
     }
 
     /**
      * Whether the generated java code is formatted nicely or left to match NetRexx
      * line numbers for call stack debugging
      */
-    public void setFormat(String format) {
-        this.format = Project.toBoolean(format);
+    public void setFormat(boolean format) {
+        this.format = format;
     }
 
     /**
@@ -257,8 +254,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setJava(String java) {
-        this.java = Project.toBoolean(java);
+    public void setJava(boolean java) {
+        this.java = java;
     }
 
 
@@ -268,24 +265,24 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setKeep(String keep) {
-        this.keep = Project.toBoolean(keep);
+    public void setKeep(boolean keep) {
+        this.keep = keep;
     }
 
     /**
      * Whether the compiler text logo is displayed when compiling
      */
-    public void setLogo(String logo) {
-        this.logo = Project.toBoolean(logo);
+    public void setLogo(boolean logo) {
+        this.logo = logo;
     }
 
-     /**
+    /**
      * Whether the generated .java file should be replaced when compiling
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setReplace(String replace) {
-        this.replace = Project.toBoolean(replace);
+    public void setReplace(boolean replace) {
+        this.replace = replace;
     }
 
     /**
@@ -294,8 +291,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setSavelog(String savelog) {
-        this.savelog = Project.toBoolean(savelog);
+    public void setSavelog(boolean savelog) {
+        this.savelog = savelog;
     }
 
     /**
@@ -304,8 +301,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is true.
      */
-    public void setSourcedir(String sourcedir) {
-        this.sourcedir = Project.toBoolean(sourcedir);
+    public void setSourcedir(boolean sourcedir) {
+        this.sourcedir = sourcedir;
     }
 
     /**
@@ -322,22 +319,22 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setStrictargs(String strictargs) {
-        this.strictargs = Project.toBoolean(strictargs);
+    public void setStrictargs(boolean strictargs) {
+        this.strictargs = strictargs;
     }
 
     /**
      * Tells the NetRexx compile that assignments must match exactly on type
      */
-    public void setStrictassign(String strictassign) {
-        this.strictassign = Project.toBoolean(strictassign);
+    public void setStrictassign(boolean strictassign) {
+        this.strictassign = strictassign;
     }
 
     /**
      * Specifies whether the NetRexx compiler should be case sensitive or not
      */
-    public void setStrictcase(String strictcase) {
-        this.strictcase = Project.toBoolean(strictcase);
+    public void setStrictcase(boolean strictcase) {
+        this.strictcase = strictcase;
     }
 
     /**
@@ -347,8 +344,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setStrictimport(String strictimport) {
-        this.strictimport = Project.toBoolean(strictimport);
+    public void setStrictimport(boolean strictimport) {
+        this.strictimport = strictimport;
     }
 
     /**
@@ -356,16 +353,16 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setStrictprops(String strictprops) {
-        this.strictprops = Project.toBoolean(strictprops);
+    public void setStrictprops(boolean strictprops) {
+        this.strictprops = strictprops;
     }
 
 
     /**
      * Whether the compiler should force catching of exceptions by explicitly named types
      */
-    public void setStrictsignal(String strictsignal) {
-        this.strictsignal = Project.toBoolean(strictsignal);
+    public void setStrictsignal(boolean strictsignal) {
+        this.strictsignal = strictsignal;
     }
 
     /**
@@ -373,8 +370,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setSymbols(String symbols) {
-        this.symbols = Project.toBoolean(symbols);
+    public void setSymbols(boolean symbols) {
+        this.symbols = symbols;
     }
 
     /**
@@ -382,8 +379,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setTime(String time) {
-        this.time = Project.toBoolean(time);
+    public void setTime(boolean time) {
+        this.time = time;
     }
 
     /**
@@ -393,9 +390,9 @@ public class NetRexxC extends MatchingTask {
      */
     public void setTrace(String trace) {
         if (trace.equalsIgnoreCase("trace")
-        || trace.equalsIgnoreCase("trace1")
-        || trace.equalsIgnoreCase("trace2")
-        || trace.equalsIgnoreCase("notrace")) {
+            || trace.equalsIgnoreCase("trace1")
+            || trace.equalsIgnoreCase("trace2")
+            || trace.equalsIgnoreCase("notrace")) {
             this.trace = trace;
         } else {
             throw new BuildException("Unknown trace value specified: '" + trace + "'");
@@ -407,8 +404,8 @@ public class NetRexxC extends MatchingTask {
      * Valid true values are "on" or "true". Anything else sets the flag to false.
      * The default value is false.
      */
-    public void setUtf8(String utf8) {
-        this.utf8 = Project.toBoolean(utf8);
+    public void setUtf8(boolean utf8) {
+        this.utf8 = utf8;
     }
 
     /**
@@ -463,7 +460,10 @@ public class NetRexxC extends MatchingTask {
             // if it's a source file, see if the destination class file
             // needs to be recreated via compilation
             if (filename.toLowerCase().endsWith(".nrx")) {
-                File classFile = new File(destDir, filename.substring(0, filename.lastIndexOf('.')) + ".class");
+                File classFile = 
+                    new File(destDir, 
+                             filename.substring(0, filename.lastIndexOf('.')) + ".class");
+
                 if (!compile || srcFile.lastModified() > classFile.lastModified()) {
                     filecopyList.put(srcFile.getAbsolutePath(), destFile.getAbsolutePath());
                     compileList.addElement(destFile.getAbsolutePath());
@@ -492,7 +492,7 @@ public class NetRexxC extends MatchingTask {
                     project.copyFile(fromFile, toFile);
                 } catch (IOException ioe) {
                     String msg = "Failed to copy " + fromFile + " to " + toFile
-                    + " due to " + ioe.getMessage();
+                        + " due to " + ioe.getMessage();
                     throw new BuildException(msg, ioe);
                 }
             }
@@ -554,8 +554,8 @@ public class NetRexxC extends MatchingTask {
 
         try {
             StringWriter out = new StringWriter(); 
-            int rc = COM.ibm.netrexx.process.NetRexxC.main(
-               new Rexx(compileArgs), new PrintWriter(out));
+            int rc = COM.ibm.netrexx.process.NetRexxC.
+                main(new Rexx(compileArgs), new PrintWriter(out));
 
             if (rc > 1) { // 1 is warnings from real NetRexxC
                 log(out.toString(), Project.MSG_ERR);
@@ -644,7 +644,7 @@ public class NetRexxC extends MatchingTask {
      */
     private void addExistingToClasspath(StringBuffer target,String source) {
         StringTokenizer tok = new StringTokenizer(source,
-        System.getProperty("path.separator"), false);
+                                                  System.getProperty("path.separator"), false);
         while (tok.hasMoreTokens()) {
             File f = project.resolveFile(tok.nextToken());
 
@@ -653,7 +653,7 @@ public class NetRexxC extends MatchingTask {
                 target.append(f.getAbsolutePath());
             } else {
                 log("Dropping from classpath: "+
-                f.getAbsolutePath(), Project.MSG_VERBOSE);
+                    f.getAbsolutePath(), Project.MSG_VERBOSE);
             }
         }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/PropertyFile.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/PropertyFile.java
new file mode 100644
index 0000000..89ecd21
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/PropertyFile.java
@@ -0,0 +1,639 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000-2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ */
+
+package org.apache.tools.ant.taskdefs.optional;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
+import java.io.*;
+import java.lang.reflect.InvocationTargetException;
+import java.lang.reflect.Method;
+import java.util.*;
+import java.text.*;
+
+/**
+ *PropertyFile task uses java.util.Properties to modify integer, String and
+ *Date settings in a property file.<p>
+ *
+ *
+ *The following is an example of its usage:
+ *    <ul>&lt;target name="setState"&gt;<br>
+ *    <ul>&lt;property<br>
+ *        <ul>name="header"<br>
+ *        value="##Generated file - do not modify!"/&gt;<br>
+ *      &lt;propertyfile file="apropfile.properties" comment="${header}"&gt;<br>
+ *        &lt;entry key="product.version.major" type="int"  value="5"/&gt;<br>
+ *        &lt;entry key="product.version.minor" type="int"  value="0"/&gt;<br>
+ *        &lt;entry key="product.build.major"   type="int"  value="0" /&gt;<br>
+ *        &lt;entry key="product.build.minor"   type="int"  operation="+" /&gt;<br>
+ *        &lt;entry key="product.build.date"    type="date" operation="now" /&gt;<br>
+ *        &lt;entry key="intSet" type="int" operation="=" value="681"/&gt;<br>
+ *        &lt;entry key="intDec" type="int" operation="-"/&gt;<br>
+ *        &lt;entry key="NeverDate" type="date" operation="never"/&gt;<br>
+ *        &lt;entry key="StringEquals" type="string" value="testValue"/&gt;<br>
+ *        &lt;entry key="NowDate" type="date" operation="now"/&gt;<br></ul>
+ *     &lt;/propertyfile&gt;<br></ul>
+ *   &lt;/target&gt;</ul><p>
+ *
+ *The &lt;propertyfile&gt; task must have:<br>
+ *    <ul><li>file</li></ul>
+ *Other parameters are:<br>
+ *    <ul><li>comment, key, operation, type and value (the final four being eliminated shortly)</li></ul>
+ *
+ *The &lt;entry&gt; task must have:<br>
+ *    <ul><li>key</li></ul>
+ *Other parameters are:<br>
+ *    <ul><li>operation</li>
+ *        <li>type</li>
+ *        <li>value</li>
+ *        <li>offset</li></ul>
+ *
+ *If type is unspecified, it defaults to string
+ *
+ *Parameter values:<br>
+ *    <ul><li>operation:</li>
+ *        <ul><li>"=" (set -- default)</li>
+ *        <li>"-" (dec)</li>
+ *        <li>"+" (inc)</li>
+ *
+ *    <li>type:</li>
+ *        <ul><li>"int"</li>
+ *        <li>"date"</li>
+ *        <li>"string"</li></ul></ul>
+ *
+ *    <li>value:</li>
+ *      <ul><li>holds the default value, if the property
+ *              was not found in property file</li>
+ *          <li>"now" In case of type "date", the
+ *              value "now" will be replaced by the current
+ *              date/time and used even if a valid date was
+ *              found in the property file.</li></ul>
+ *
+ *    <li>offset:<br>valid for "-" or "+", the offset (default
+ *    set to 1) will be added or subtracted from "int" or
+ *    "date" type value.</li>
+ *    </ul>
+ *
+ *String property types can only use the "=" operation.
+ *Date property types can only use the "never" or "now" operations.
+ *Int property types can only use the "=", "-" or "+" operations.<p>
+ *
+ *The message property is used for the property file header, with "\\" being
+ *a newline delimiter charater.
+ *
+ * @author Thomas Christen <a href="mailto:chr@active.ch">chr@active.ch</a>
+ * @author Jeremy Mawson <a href="mailto:jem@loftinspace.com.au>jem@loftinspace.com.au</a>
+*/
+public class PropertyFile extends Task
+{
+
+    /* ========================================================================
+    *
+    * Static variables.
+    */
+
+    private static final String NEWLINE = System.getProperty("line.separator");
+
+
+    /* ========================================================================
+    *
+    * Instance variables.
+    */
+
+    // Use this to prepend a message to the properties file
+    private String              m_comment;
+
+    private Properties          m_properties;
+    private File                m_propertyfile;
+
+    private Vector entries = new Vector();
+
+    /* ========================================================================
+    *
+    * Constructors
+    */
+
+    /* ========================================================================
+    *
+    * Methods
+    */
+
+    public void execute() throws BuildException
+    {
+        checkParameters();
+        readFile();
+        executeOperation();
+        writeFile();
+    }
+
+    public Entry createEntry()
+    {
+        Entry e = new Entry();
+        entries.addElement(e);
+        return e;
+    }
+
+    private void executeOperation() throws BuildException
+    {
+        for (Enumeration e = entries.elements(); e.hasMoreElements(); )
+        {
+            Entry entry = (Entry)e.nextElement();
+            entry.executeOn(m_properties);
+        }
+    }
+
+    private void readFile() throws BuildException
+    {
+        // Create the PropertyFile
+        m_properties = new Properties();
+        try
+        {
+            if (m_propertyfile.exists())
+            {
+                log("Updating property file: "+m_propertyfile.getAbsolutePath());
+                m_properties.load(new BufferedInputStream(
+                                    new FileInputStream(m_propertyfile)));
+            }
+            else
+            {
+                log("Creating new property file: "+
+                    m_propertyfile.getAbsolutePath());
+                FileOutputStream out = new FileOutputStream(m_propertyfile.getAbsolutePath());
+                out.flush();
+                out.close();
+            }
+        }
+        catch(IOException ioe)
+        {
+            throw new BuildException(ioe.toString());
+        }
+    }
+
+    private void checkParameters() throws BuildException
+    {
+        if (!checkParam(m_propertyfile))
+        {
+            throw new BuildException("file token must not be null.", location);
+        }
+    }
+
+    public void setFile(File file)
+    {
+        m_propertyfile = file;
+    }
+
+    public void setComment(String hdr)
+    {
+        m_comment = hdr;
+    }
+
+    private void writeFile() throws BuildException
+    {
+        BufferedOutputStream bos = null;
+        try
+        {
+            bos = new BufferedOutputStream(new FileOutputStream(m_propertyfile));
+
+            // Properties.store is not available in JDK 1.1
+            Method m =
+                Properties.class.getMethod("store",
+                                           new Class[] {
+                                               OutputStream.class,
+                                               String.class}
+                                           );
+            m.invoke(m_properties, new Object[] {bos, m_comment});
+
+        } catch (NoSuchMethodException nsme) {
+            m_properties.save(bos, m_comment);
+        } catch (InvocationTargetException ite) {
+            Throwable t = ite.getTargetException();
+            throw new BuildException(t, location);
+        } catch (IllegalAccessException iae) {
+            // impossible
+            throw new BuildException(iae, location);
+        }
+        catch (IOException ioe)
+        {
+            throw new BuildException(ioe, location);
+        }
+        finally {
+            if (bos != null) {
+                try {
+                    bos.close();
+                } catch (IOException ioex) {}
+            }
+        }
+    }
+
+    /*
+    * Returns whether the given parameter has been defined.
+    */
+    private boolean checkParam(String param)
+    {
+        return !((param == null) || (param.equals("null")));
+    }
+
+    private boolean checkParam(File param)
+    {
+        return !(param == null);
+    }
+
+    /**
+     * Instance of this class represents nested elements of
+     * a task propertyfile.
+     */
+    public static class Entry
+    {
+
+        static final String NOW_VALUE_ =        "now";
+        static final String NULL_VALUE_ =       "never";
+
+        private static final int    DEFAULT_INT_VALUE =     1;
+        private static final GregorianCalendar
+            DEFAULT_DATE_VALUE = new GregorianCalendar();
+
+        private String              m_key = null;
+        private int                 m_type = Type.STRING_TYPE;
+        private int                 m_operation = Operation.EQUALS_OPER;
+        private String              m_value ="1";
+        private String              m_default = null;
+        private String              m_pattern = null;
+
+        public void setKey(String value)
+        {
+            this.m_key = value;
+        }
+        public void setValue(String value)
+        {
+            this.m_value = value;
+        }
+        public void setOperation(Operation value)
+        {
+            int newOperation = Operation.toOperation(value.getValue());
+            if (newOperation == Operation.NOW_VALUE) {
+                this.m_operation = Operation.EQUALS_OPER;
+                this.setValue(this.NOW_VALUE_);
+            }
+            else if (newOperation == Operation.NULL_VALUE) {
+                this.m_operation = Operation.EQUALS_OPER;
+                this.setValue(this.NULL_VALUE_);
+            }
+            else {
+                this.m_operation = newOperation;
+            }
+        }
+        public void setType(Type value)
+        {
+            this.m_type = Type.toType(value.getValue());
+        }
+        public void setDefault(String value)
+        {
+            this.m_default = value;
+        }
+        public void setPattern(String value)
+        {
+            this.m_pattern = value;
+        }
+
+        protected void executeOn(Properties props) throws BuildException
+        {
+            checkParameters();
+
+            // m_type may be null because it wasn't set
+            try {
+                if (m_type == Type.INTEGER_TYPE)
+                {
+                    executeInteger((String)props.get(m_key));
+                }
+                else if (m_type == Type.DATE_TYPE)
+                {
+                    executeDate((String)props.get(m_key));
+                }
+                else if (m_type == Type.STRING_TYPE)
+                {
+                    executeString((String)props.get(m_key));
+                }
+                else
+                {
+                    throw new BuildException("Unknown operation type: "+m_type+"");
+                }
+            } catch (NullPointerException npe) {
+                // Default to string type
+                // which means do nothing
+                npe.printStackTrace();
+            }
+            // Insert as a string by default
+            props.put(m_key, m_value);
+
+        }
+
+        /**
+        * Handle operations for type <code>date</code>.
+        *
+        * @param oldValue the current value read from the property file or
+        *                 <code>null</code> if the <code>key</code> was
+        *                 not contained in the property file.
+        */
+        private void executeDate(String oldValue) throws BuildException
+        {
+            GregorianCalendar value = new GregorianCalendar();
+            GregorianCalendar newValue = new GregorianCalendar();
+
+            if (m_pattern == null) m_pattern = "yyyy/MM/dd HH:mm";
+            DateFormat fmt = new SimpleDateFormat(m_pattern);
+
+            if (m_value != null) {
+                if (NOW_VALUE_.equals(m_value.toLowerCase())) {
+                    value.setTime(new Date());
+                }
+                else if (NULL_VALUE_.equals(m_value.toLowerCase())) {
+                    value = null;
+                }
+                else {
+                    try {
+                        value.setTime(fmt.parse(m_value));
+                    }
+                    catch (Exception ex) {
+                        // obviously not a date, try a simple int
+                        try {
+                            int offset = Integer.parseInt(m_value);
+                            value.clear();
+                            value.set(Calendar.DAY_OF_YEAR, offset);
+                        }
+                        catch (Exception ex_) {
+                            value.clear();
+                            value.set(Calendar.DAY_OF_YEAR, 1);
+                        }
+                    }
+
+                }
+            }
+
+            // special case
+            if (m_default != null &&
+                NOW_VALUE_.equals(m_default.toLowerCase()) &&
+                (m_operation == Operation.INCREMENT_OPER ||
+                 m_operation == Operation.DECREMENT_OPER) ) {
+                oldValue = null;
+            }
+
+            if (oldValue != null) {
+                try {
+                    newValue.setTime(fmt.parse(oldValue));
+                }
+                catch (ParseException pe)  { /* swollow */ }
+            }
+            else {
+                if (m_default != null) {
+                    if (NOW_VALUE_.equals(m_default.toLowerCase())) {
+                        newValue.setTime(new Date());
+                    }
+                    else if (NULL_VALUE_.equals(m_default.toLowerCase())) {
+                        newValue = null;
+                    }
+                    else {
+                        try {
+                            newValue.setTime(fmt.parse(m_default));
+                        }
+                        catch (ParseException pe)  { /* swollow */ }
+                    }
+                }
+            }
+
+            if (m_operation == Operation.EQUALS_OPER) {
+                newValue = value;
+            }
+            else if (m_operation == Operation.INCREMENT_OPER) {
+                newValue.add(Calendar.SECOND, value.get(Calendar.SECOND));
+                newValue.add(Calendar.MINUTE, value.get(Calendar.MINUTE));
+                newValue.add(Calendar.HOUR_OF_DAY, value.get(Calendar.HOUR_OF_DAY));
+                newValue.add(Calendar.DAY_OF_YEAR, value.get(Calendar.DAY_OF_YEAR));
+            }
+            else if (m_operation == Operation.DECREMENT_OPER) {
+                newValue.add(Calendar.SECOND, -1 * value.get(Calendar.SECOND));
+                newValue.add(Calendar.MINUTE, -1 * value.get(Calendar.MINUTE));
+                newValue.add(Calendar.HOUR_OF_DAY, -1 * value.get(Calendar.HOUR_OF_DAY));
+                newValue.add(Calendar.DAY_OF_YEAR, -1 * value.get(Calendar.DAY_OF_YEAR));
+            }
+            if (newValue != null) {
+                m_value = fmt.format(newValue.getTime());
+            }
+            else {
+                m_value = "";
+            }
+        }
+
+
+        /**
+        * Handle operations for type <code>int</code>.
+        *
+        * @param oldValue the current value read from the property file or
+        *                 <code>null</code> if the <code>key</code> was
+        *                 not contained in the property file.
+        */
+        private void executeInteger(String oldValue) throws BuildException
+        {
+            int value = 0;
+            int newValue  = 0;
+
+            DecimalFormat fmt = (m_pattern != null) ? new DecimalFormat(m_pattern)
+                                                    : new DecimalFormat();
+
+            if (m_value != null) {
+                try {
+                    value = fmt.parse(m_value).intValue();
+                }
+                catch (NumberFormatException nfe) { /* swollow */ }
+                catch (ParseException pe)  { /* swollow */ }
+            }
+            if (oldValue != null) {
+                try {
+                    newValue = fmt.parse(oldValue).intValue();
+                }
+                catch (NumberFormatException nfe) { /* swollow */ }
+                catch (ParseException pe)  { /* swollow */ }
+            }
+            else if (m_default != null) {
+                try {
+                    newValue = fmt.parse(m_default).intValue();
+                }
+                catch (NumberFormatException nfe) { /* swollow */ }
+                catch (ParseException pe)  { /* swollow */ }
+            }
+
+            if (m_operation == Operation.EQUALS_OPER) {
+                newValue = value;
+            }
+            else if (m_operation == Operation.INCREMENT_OPER) {
+                newValue += value;
+            }
+            else if (m_operation == Operation.DECREMENT_OPER) {
+                newValue -= value;
+            }
+            m_value = fmt.format(newValue);
+        }
+
+        /**
+        * Handle operations for type <code>string</code>.
+        *
+        * @param oldValue the current value read from the property file or
+        *                 <code>null</code> if the <code>key</code> was
+        *                 not contained in the property file.
+        */
+        private void executeString(String oldValue) throws BuildException
+        {
+            String value = "";
+            String newValue  = "";
+
+            if (m_value != null) {
+                value = m_value;
+            }
+            if (oldValue != null) {
+                newValue = oldValue;
+            }
+            else if (m_default != null) {
+                newValue = m_default;
+            }
+
+            if (m_operation == Operation.EQUALS_OPER) {
+                newValue = value;
+            }
+            else if (m_operation == Operation.INCREMENT_OPER) {
+                newValue += value;
+            }
+            m_value = newValue;
+        }
+
+        /**
+         * Check if parameter combinations can be supported
+         */
+        private void checkParameters() throws BuildException {
+            if (m_type == Type.STRING_TYPE &&
+                m_operation == Operation.DECREMENT_OPER) {
+                throw new BuildException("- is not suported for string properties (key:" + m_key + ")");
+            }
+            if (m_value == null) {
+                throw new BuildException("value is mandatory (key:" + m_key + ")");
+            }
+            if (m_key == null) {
+                throw new BuildException("key is mandatory");
+            }
+            if (m_type == Type.STRING_TYPE &&
+                m_pattern != null) {
+                throw new BuildException("pattern is not suported for string properties (key:" + m_key + ")");
+            }
+        }
+
+        /**
+         * Enumerated attribute with the values "+", "-", "=", "now" and "never".
+         */
+        public static class Operation extends EnumeratedAttribute {
+
+            // Property type operations
+            public static final int INCREMENT_OPER =   0;
+            public static final int DECREMENT_OPER =   1;
+            public static final int EQUALS_OPER =      2;
+
+            // Special values
+            public static final int NOW_VALUE =        3;
+            public static final int NULL_VALUE =       4;
+
+            public String[] getValues() {
+                return new String[] {"+", "-", "=", NOW_VALUE_, NULL_VALUE_};
+            }
+
+            public static int toOperation(String oper) {
+                if ("+".equals(oper)) {
+                    return INCREMENT_OPER;
+                }
+                else if ("-".equals(oper)) {
+                    return DECREMENT_OPER;
+                }
+                else if (NOW_VALUE_.equals(oper)) {
+                    return NOW_VALUE;
+                }
+                else if (NULL_VALUE_.equals(oper)) {
+                    return NULL_VALUE;
+                }
+                return EQUALS_OPER;
+            }
+        }
+
+        /**
+         * Enumerated attribute with the values "int", "date" and "string".
+         */
+        public static class Type extends EnumeratedAttribute {
+
+            // Property types
+            public static final int INTEGER_TYPE =     0;
+            public static final int DATE_TYPE =        1;
+            public static final int STRING_TYPE =      2;
+
+            public String[] getValues() {
+                return new String[] {"int", "date", "string"};
+            }
+
+            public static int toType(String type) {
+                if ("int".equals(type)) {
+                    return INTEGER_TYPE;
+                }
+                else if ("date".equals(type)) {
+                    return DATE_TYPE;
+                }
+                return STRING_TYPE;
+            }
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/RenameExtensions.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/RenameExtensions.java
index e7f32a7..e486ab1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/RenameExtensions.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/RenameExtensions.java
@@ -1,5 +1,6 @@
 /*
  * The Apache Software License, Version 1.1
+ * 
  * Copyright (c) 1999 The Apache Software Foundation.  All rights
  * reserved.
  *
@@ -22,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -58,9 +59,6 @@
  * <li>srcDir: </li>
  * <li>replace: </li>
  * </ul>
- *
- * @author dIon Gillard <a href="mailto:dion@multitask.com.au">dion@multitask.com.au</a>
- * @version 1.2
  */
 
 package org.apache.tools.ant.taskdefs.optional;
@@ -69,10 +67,13 @@ import java.io.*;
 import java.util.*;
 import org.apache.tools.ant.*;
 import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.Mapper;
 
 /**
  *
- * @author  dion
+ * @author dIon Gillard <a href="mailto:dion@multitask.com.au">dion@multitask.com.au</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ * @version 1.2
  */
 public class RenameExtensions extends MatchingTask {
 
@@ -81,10 +82,14 @@ public class RenameExtensions extends MatchingTask {
     private boolean replace = false;
     private File srcDir;
 
+    private Mapper.MapperType globType;
+
 
     /** Creates new RenameExtensions */
     public RenameExtensions() {
         super();
+        globType = new Mapper.MapperType();
+        globType.setValue("glob");
     }
 
     /** store fromExtension **/
@@ -101,15 +106,15 @@ public class RenameExtensions extends MatchingTask {
      * store replace attribute - this determines whether the target file
      * should be overwritten if present
      */
-    public void setReplace(String replaceString) {
-        replace = Project.toBoolean(replaceString);
+    public void setReplace(boolean replace) {
+        this.replace = replace;
     }
 
     /**
      * Set the source dir to find the files to be renamed.
      */
-    public void setSrcDir(String srcDirName) {
-        srcDir = project.resolveFile(srcDirName);
+    public void setSrcDir(File srcDir) {
+        this.srcDir = srcDir;
     }
 
     /**
@@ -119,45 +124,39 @@ public class RenameExtensions extends MatchingTask {
 
         // first off, make sure that we've got a from and to extension
         if (fromExtension == null || toExtension == null || srcDir == null) {
-            throw new BuildException("srcDir, fromExtension and toExtension attributes must be set!");
+            throw new BuildException( "srcDir, fromExtension and toExtension " +
+                                      "attributes must be set!" );
         }
 
-        // scan source and dest dirs to build up rename list
-        DirectoryScanner ds = getDirectoryScanner(srcDir);
-
-        String[] files = ds.getIncludedFiles();
-
-        Hashtable renameList = scanDir(srcDir, files);
-
-        Enumeration e = renameList.keys();
-        File fromFile = null;
-        File toFile = null;
-        while (e.hasMoreElements()) {
-            fromFile = (File)e.nextElement();
-            toFile = (File)renameList.get(fromFile);
-            if (toFile.exists() && replace) toFile.delete();
-            if (!fromFile.renameTo(toFile)) throw new BuildException("Rename from: '" + fromFile + "' to '" + toFile + "' failed.");
-        }
-
-    }
-    private Hashtable scanDir(File srcDir, String[] files) {
-        Hashtable list = new Hashtable();
-        for (int i = 0; i < files.length; i++) {
-            File srcFile = new File(srcDir, files[i]);
-            String filename = files[i];
-            // if it's a file that ends in the fromExtension, copy to the rename list
-            if (filename.toLowerCase().endsWith(fromExtension)) {
-                File destFile = new File(srcDir, filename.substring(0, filename.lastIndexOf(fromExtension)) + toExtension);
-                if (replace || !destFile.exists()) {
-                    list.put(srcFile, destFile);
-                } else {
-                    log("Rejecting file: '" + srcFile + "' for rename as replace is false and file exists", Project.MSG_VERBOSE);
-                }
-            } else {
-                log("File '"+ filename + "' doesn't match fromExtension: '" + fromExtension + "'", Project.MSG_VERBOSE);
-            }
-        }
-        return list;
+        log("DEPRECATED - The renameext task is deprecated.  Use move instead.",
+            Project.MSG_WARN);
+        log("Replace this with:", Project.MSG_INFO);
+        log("<move todir=\""+srcDir+"\" overwrite=\""+replace+"\">", 
+            Project.MSG_INFO);
+        log("  <fileset dir=\""+srcDir+"\" />", Project.MSG_INFO);
+        log("  <mapper type=\"glob\"", Project.MSG_INFO);
+        log("          from=\"*"+fromExtension+"\"", Project.MSG_INFO);
+        log("          to=\"*"+toExtension+"\" />", Project.MSG_INFO);
+        log("</move>", Project.MSG_INFO);
+        log("using the same patterns on <fileset> as you\'ve used here", 
+            Project.MSG_INFO);
+
+        Move move = (Move)project.createTask("move");
+        move.setOwningTarget(target);
+        move.setTaskName(getTaskName());
+        move.setLocation(getLocation());
+        move.setTodir(srcDir);
+        move.setOverwrite(replace);
+
+        fileset.setDir(srcDir);
+        move.addFileset(fileset);
+
+        Mapper me = move.createMapper();
+        me.setType(globType);
+        me.setFrom("*"+fromExtension);
+        me.setTo("*"+toExtension);
+
+        move.execute();
     }
 
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Script.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Script.java
index 9ef133d..3be6b14 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Script.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Script.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -51,13 +51,12 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs.optional;
 
-import org.apache.tools.ant.*;
+import com.ibm.bsf.*;
 import java.io.*;
 import java.util.*;
-import com.ibm.bsf.*;
+import org.apache.tools.ant.*;
 
 /**
  * Execute a script
@@ -76,7 +75,7 @@ public class Script extends Task {
         for (Enumeration e=dictionary.keys(); e.hasMoreElements(); ) {
             String key = (String)e.nextElement();
 
-	    boolean isValid = key.length()>0 &&
+            boolean isValid = key.length()>0 &&
                 Character.isJavaIdentifierStart(key.charAt(0));
 
             for (int i=1; isValid && i<key.length(); i++)
@@ -109,7 +108,7 @@ public class Script extends Task {
             // execute the script
             manager.exec(language, "<ANT>", 0, 0, script);
         } catch (BSFException be) {
-	    Throwable t = be;
+            Throwable t = be;
             Throwable te = be.getTargetException();
             if (te != null) {
                 if  (te instanceof BuildException) {
@@ -128,7 +127,7 @@ public class Script extends Task {
      * @param msg Sets the value for the script variable.
      */
     public void setLanguage(String language) {
-	this.language = language;
+        this.language = language;
     }
 
     /**
@@ -151,7 +150,7 @@ public class Script extends Task {
         } catch (IOException e) {
             throw new BuildException(e);
         }
-	
+        
         script += new String(data);
     }
 
@@ -161,6 +160,6 @@ public class Script extends Task {
      * @param msg Sets the value for the script variable.
      */
     public void addText(String text) {
-	this.script += text;
+        this.script += text;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/StyleBook.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/StyleBook.java
new file mode 100644
index 0000000..d13f03f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/StyleBook.java
@@ -0,0 +1,116 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional;
+
+import java.io.File; 
+import org.apache.tools.ant.BuildException; 
+import org.apache.tools.ant.types.CommandlineJava; 
+import org.apache.tools.ant.types.Path; 
+import org.apache.tools.ant.Task; 
+import org.apache.tools.ant.taskdefs.Java; 
+
+/** 
+ * Basic task for apache stylebook.
+ * 
+ * @author <a href="mailto:donaldp@apache.org">Peter Donald</a> 
+ */ 
+public class StyleBook 
+    extends Java 
+{ 
+    protected File                   m_targetDirectory;
+    protected File                   m_skinDirectory;
+    protected File                   m_book;
+
+    public StyleBook() {
+        setClassname( "org.apache.stylebook.StyleBook" );
+        setFork( true );
+        setFailonerror( true );
+    }
+
+    public void setBook( final File book ) {
+        m_book = book;
+    } 
+ 
+    public void setSkinDirectory( final File skinDirectory ) {
+        m_skinDirectory = skinDirectory;
+    } 
+
+    public void setTargetDirectory( final File targetDirectory ) {
+        m_targetDirectory = targetDirectory;
+    } 
+    
+    public void execute()  
+        throws BuildException  { 
+
+        if( null == m_targetDirectory ) {
+            throw new BuildException( "TargetDirectory attribute not set." );
+        }
+
+        if( null == m_skinDirectory ) {
+            throw new BuildException( "SkinDirectory attribute not set." );
+        }
+
+        if( null == m_book ) {
+            throw new BuildException( "book attribute not set." );
+        } 
+
+        createArg().setValue( "targetDirectory=" + m_targetDirectory );
+        createArg().setValue( m_book.toString() );
+        createArg().setValue( m_skinDirectory.toString() );
+
+        super.execute();
+    } 
+} 
+ 
+ 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Test.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Test.java
new file mode 100644
index 0000000..2e68a9e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/Test.java
@@ -0,0 +1,121 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional;
+ 
+import org.apache.tools.ant.BuildException; 
+import org.apache.tools.ant.taskdefs.Java; 
+import java.util.Vector; 
+ 
+/** 
+ * 
+ * @author <a href="mailto:donaldp@apache.org">Peter Donald</a> 
+ */ 
+public class Test 
+    extends Java {
+ 
+    protected Vector                          m_tests            = new Vector();
+
+    protected static final class TestletEntry {
+
+        protected String m_testname = "";
+
+        public void addText( final String testname ) {
+            m_testname += testname;
+        }
+
+        public String toString() {
+            return m_testname;
+        }
+    }
+
+    public Test() {
+        setClassname( "org.apache.testlet.engine.TextTestEngine" );
+    }
+
+    public TestletEntry createTestlet() {
+        final TestletEntry entry = new TestletEntry();
+        m_tests.addElement( entry );
+        return entry;
+    }
+ 
+    public void setShowSuccess( final boolean showSuccess ) {
+        createArg().setValue( "-s=" + showSuccess );
+    } 
+ 
+    public void setShowBanner( final String showBanner ) { 
+        createArg().setValue( "-b=" + showBanner );
+    } 
+ 
+    public void setShowTrace( final boolean showTrace ) {
+         createArg().setValue( "-t=" + showTrace );
+    } 
+ 
+    public void setForceShowTrace( final boolean forceShowTrace ) { 
+        createArg().setValue( "-f=" + forceShowTrace );
+    } 
+ 
+    public void execute() 
+        throws BuildException  { 
+
+        final int size = m_tests.size();
+
+        for( int i = 0; i < size; i ++ ) {
+            createArg().setValue( m_tests.elementAt( i ).toString() );
+        }
+
+        super.execute();
+    } 
+} 
+ 
+ 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/TraXLiaison.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/TraXLiaison.java
new file mode 100644
index 0000000..b949527
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/TraXLiaison.java
@@ -0,0 +1,109 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional;
+
+import java.io.FileOutputStream;
+
+import org.apache.tools.ant.taskdefs.XSLTLiaison;
+
+import javax.xml.transform.TransformerFactory;
+import javax.xml.transform.Transformer;
+import javax.xml.transform.Templates;
+import javax.xml.transform.stream.StreamResult;
+import javax.xml.transform.stream.StreamSource;
+
+/**
+ *
+ * @author <a href="mailto:rubys@us.ibm.com">Sam Ruby</a>
+ * @author <a href="mailto:dims@yahoo.com">Davanum Srinivas</a>
+ * @version $Revision: 1.1 $ $Date: 2001/01/03 16:48:39 $
+ */
+public class TraXLiaison implements XSLTLiaison {
+
+    protected final static String FILEURL = "file:";
+
+    /** The trax TransformerFactory */
+    private TransformerFactory tfactory = null;
+
+    /** Stylesheet template */
+    private Templates templates = null;
+
+    /** The trax Transformer itself */
+    private Transformer transformer;
+
+    public TraXLiaison() throws Exception {
+        tfactory = TransformerFactory.newInstance();
+    }
+
+    public void setStylesheet(String fileName) throws Exception {
+        templates = tfactory.newTemplates(new StreamSource(normalize(fileName)));
+        transformer = templates.newTransformer();
+    };
+
+    public void transform(String infile, String outfile) throws Exception {
+        transformer.transform(new StreamSource(normalize(infile)), new StreamResult(new FileOutputStream(outfile)));
+    }
+
+    protected String normalize(String fileName) {
+        if(fileName != null && !fileName.startsWith(FILEURL)) {
+            return FILEURL + fileName;
+        }
+        return fileName;
+    }
+    
+    public void addParam(String name, String value){
+        transformer.setParameter(name, value);
+    }
+} //-- TraXLiaison
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XalanLiaison.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XalanLiaison.java
index bd4d039..91b6e8c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XalanLiaison.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XalanLiaison.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -64,7 +64,7 @@ import org.apache.xalan.xslt.XSLTResultTarget;
 /**
  *
  * @author <a href="mailto:rubys@us.ibm.com">Sam Ruby</a>
- * @version $Revision: 1.3 $ $Date: 2000/08/03 09:34:05 $
+ * @version $Revision: 1.5 $ $Date: 2001/01/03 14:18:35 $
  */
 public class XalanLiaison implements XSLTLiaison {
 
@@ -92,4 +92,8 @@ public class XalanLiaison implements XSLTLiaison {
         }
         return fileName;
     }
+    
+    public void addParam(String name, String value){
+        processor.setStylesheetParam(name, value);
+    }
 } //-- XalanLiaison
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XslpLiaison.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XslpLiaison.java
index ec7973d..7c294ee 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XslpLiaison.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/XslpLiaison.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -65,7 +65,7 @@ import com.kvisco.xsl.XSLStylesheet;
 /**
  *
  * @author <a href="mailto:rubys@us.ibm.com">Sam Ruby</a>
- * @version $Revision: 1.2 $ $Date: 2000/06/23 21:18:07 $
+ * @version $Revision: 1.4 $ $Date: 2001/01/03 14:18:36 $
  */
 public class XslpLiaison implements XSLTLiaison {
 
@@ -85,4 +85,8 @@ public class XslpLiaison implements XSLTLiaison {
       processor.process(infile, xslSheet, new FileWriter(outfile));
     }
 
+    public void addParam(String name, String expression){
+      processor.setProperty(name, expression);
+    }
+
 } //-- XSLPLiaison
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckin.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckin.java
new file mode 100644
index 0000000..c6de9fa
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckin.java
@@ -0,0 +1,371 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.clearcase;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
+import org.apache.tools.ant.types.Path;
+
+import java.io.File;
+
+/**
+ * Task to perform Checkin command to ClearCase.
+ * <p>
+ * The following attributes are interpreted:
+ * <table border="1">
+ *   <tr>
+ *     <th>Attribute</th>
+ *     <th>Values</th>
+ *     <th>Required</th>
+ *   </tr>
+ *   <tr>
+ *      <td>viewpath</td>
+ *      <td>Path to the ClearCase view file or directory that the command will operate on</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>comment</td>
+ *      <td>Specify a comment. Only one of comment or cfile may be used.</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>commentfile</td>
+ *      <td>Specify a file containing a comment. Only one of comment or cfile may be used.</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>nowarn</td>
+ *      <td>Suppress warning messages</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>preservetime</td>
+ *      <td>Preserve the modification time</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>keepcopy</td>
+ *      <td>Keeps a copy of the file with a .keep extension</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>identical</td>
+ *      <td>Allows the file to be checked in even if it is identical to the original</td>
+ *      <td>No</td>
+ *   <tr>
+ * </table>
+ *
+ * @author Curtis White
+ */
+public class CCCheckin extends ClearCase {
+    private String m_Comment = null;
+    private String m_Cfile = null;
+    private boolean m_Nwarn = false;
+    private boolean m_Ptime = false;
+    private boolean m_Keep = false;
+    private boolean m_Identical = true;
+
+    /**
+     * Executes the task.
+     * <p>
+     * Builds a command line to execute cleartool and then calls Exec's run method
+     * to execute the command line.
+     */
+    public void execute() throws BuildException {
+        Commandline commandLine = new Commandline();
+        Project aProj = getProject();
+        int result = 0;
+
+        // Default the viewpath to basedir if it is not specified
+        if (getViewPath() == null) {
+            setViewPath(aProj.getBaseDir().getPath());
+        }
+
+        // build the command line from what we got. the format is
+        // cleartool checkin [options...] [viewpath ...]
+        // as specified in the CLEARTOOL.EXE help
+        commandLine.setExecutable(getClearToolCommand());
+        commandLine.createArgument().setValue(COMMAND_CHECKIN);
+
+        checkOptions(commandLine);
+
+        result = run(commandLine);
+        if ( result != 0 ) {
+            String msg = "Failed executing: " + commandLine.toString();
+            throw new BuildException(msg, location);
+        }
+    }
+
+
+    /**
+     * Check the command line options.
+     */
+    private void checkOptions(Commandline cmd) {
+        if (getComment() != null) {
+            // -c
+            getCommentCommand(cmd);
+        } else {
+            if (getCommentFile() != null) {
+                // -cfile
+                getCommentFileCommand(cmd);
+            } else {
+                cmd.createArgument().setValue(FLAG_NOCOMMENT);
+            }
+        }
+
+        if (getNoWarn()) {
+            // -nwarn
+            cmd.createArgument().setValue(FLAG_NOWARN);
+        }
+
+        if (getPreserveTime()) {
+            // -ptime
+            cmd.createArgument().setValue(FLAG_PRESERVETIME);
+        }
+
+        if (getKeepCopy()) {
+            // -keep
+            cmd.createArgument().setValue(FLAG_KEEPCOPY);
+        }
+
+        if (getIdentical()) {
+            // -identical
+            cmd.createArgument().setValue(FLAG_IDENTICAL);
+        }
+
+        // viewpath
+        cmd.createArgument().setValue(getViewPath());
+    }
+
+
+    /**
+     * Set comment string
+     *
+     * @param comment the comment string
+     */
+    public void setComment(String comment) {
+        m_Comment = comment;
+    }
+
+    /**
+     * Get comment string
+     *
+     * @return String containing the comment
+     */
+    public String getComment() {
+        return m_Comment;
+    }
+
+    /**
+     * Set comment file
+     *
+     * @param cfile the path to the comment file
+     */
+    public void setCommentFile(String cfile) {
+        m_Cfile = cfile;
+    }
+
+    /**
+     * Get comment file
+     *
+     * @return String containing the path to the comment file
+     */
+    public String getCommentFile() {
+        return m_Cfile;
+    }
+
+    /**
+     * Set the nowarn flag
+     *
+     * @param nwarn the status to set the flag to
+     */
+    public void setNoWarn(boolean nwarn) {
+        m_Nwarn = nwarn;
+    }
+
+    /**
+     * Get nowarn flag status
+     *
+     * @return boolean containing status of nwarn flag
+     */
+    public boolean getNoWarn() {
+        return m_Nwarn;
+    }
+
+    /**
+     * Set preservetime flag
+     *
+     * @param ptime the status to set the flag to
+     */
+    public void setPreserveTime(boolean ptime) {
+        m_Ptime = ptime;
+    }
+
+    /**
+     * Get preservetime flag status
+     *
+     * @return boolean containing status of preservetime flag
+     */
+    public boolean getPreserveTime() {
+        return m_Ptime;
+    }
+
+    /**
+     * Set the keepcopy flag
+     *
+     * @param keep the status to set the flag to
+     */
+    public void setKeepCopy(boolean keep) {
+        m_Keep = keep;
+    }
+
+    /**
+     * Get keepcopy flag status
+     *
+     * @return boolean containing status of keepcopy flag
+     */
+    public boolean getKeepCopy() {
+        return m_Keep;
+    }
+
+    /**
+     * Set the identical flag
+     *
+     * @param identical the status to set the flag to
+     */
+    public void setIdentical(boolean identical) {
+        m_Identical = identical;
+    }
+
+    /**
+     * Get identical flag status
+     *
+     * @return boolean containing status of identical flag
+     */
+    public boolean getIdentical() {
+        return m_Identical;
+    }
+
+
+    /**
+     * Get the 'comment' command
+     *
+     * @return the 'comment' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the comment flag and string appended
+     */
+    private void getCommentCommand(Commandline cmd) {
+        if (getComment() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_COMMENT);
+            cmd.createArgument().setValue(getComment());
+        }
+    }
+
+    /**
+     * Get the 'commentfile' command
+     *
+     * @return the 'commentfile' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the commentfile flag and file appended
+     */
+    private void getCommentFileCommand(Commandline cmd) {
+        if (getCommentFile() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_COMMENTFILE);
+            cmd.createArgument().setValue(getCommentFile());
+        }
+    }
+
+
+        /**
+     * -c flag -- comment to attach to the file
+     */
+    public static final String FLAG_COMMENT = "-c";
+        /**
+     * -cfile flag -- file containing a comment to attach to the file
+     */
+    public static final String FLAG_COMMENTFILE = "-cfile";
+        /**
+     * -nc flag -- no comment is specified
+     */
+    public static final String FLAG_NOCOMMENT = "-nc";
+        /**
+     * -nwarn flag -- suppresses warning messages
+     */
+    public static final String FLAG_NOWARN = "-nwarn";
+        /**
+     * -ptime flag -- preserves the modification time
+     */
+    public static final String FLAG_PRESERVETIME = "-ptime";
+        /**
+     * -keep flag -- keeps a copy of the file with a .keep extension
+     */
+    public static final String FLAG_KEEPCOPY = "-keep";
+        /**
+     * -identical flag -- allows the file to be checked in even if it is identical to the original
+     */
+    public static final String FLAG_IDENTICAL = "-identical";
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckout.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckout.java
new file mode 100644
index 0000000..31be966
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCCheckout.java
@@ -0,0 +1,483 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.clearcase;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
+import org.apache.tools.ant.types.Path;
+
+import java.io.File;
+
+/**
+ * Task to perform Checkout command to ClearCase.
+ * <p>
+ * The following attributes are interpretted:
+ * <table border="1">
+ *   <tr>
+ *     <th>Attribute</th>
+ *     <th>Values</th>
+ *     <th>Required</th>
+ *   </tr>
+ *   <tr>
+ *      <td>viewpath</td>
+ *      <td>Path to the ClearCase view file or directory that the command will operate on</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>reserved</td>
+ *      <td>Specifies whether to check out the file as reserved or not</td>
+ *      <td>Yes</td>
+ *   <tr>
+ *   <tr>
+ *      <td>out</td>
+ *      <td>Creates a writable file under a different filename</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>nodata</td>
+ *      <td>Checks out the file but does not create an editable file containing its data</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>branch</td>
+ *      <td>Specify a branch to check out the file to</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>version</td>
+ *      <td>Allows checkout of a version other than main latest</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>nowarn</td>
+ *      <td>Suppress warning messages</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>comment</td>
+ *      <td>Specify a comment. Only one of comment or cfile may be used.</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>commentfile</td>
+ *      <td>Specify a file containing a comment. Only one of comment or cfile may be used.</td>
+ *      <td>No</td>
+ *   <tr>
+ * </table>
+ *
+ * @author Curtis White
+ */
+public class CCCheckout extends ClearCase {
+    private boolean m_Reserved = true;
+    private String m_Out = null;
+    private boolean m_Ndata = false;
+    private String m_Branch = null;
+    private boolean m_Version = false;
+    private boolean m_Nwarn = false;
+    private String m_Comment = null;
+    private String m_Cfile = null;
+
+    /**
+     * Executes the task.
+     * <p>
+     * Builds a command line to execute cleartool and then calls Exec's run method
+     * to execute the command line.
+     */
+    public void execute() throws BuildException {
+        Commandline commandLine = new Commandline();
+        Project aProj = getProject();
+        int result = 0;
+
+        // Default the viewpath to basedir if it is not specified
+        if (getViewPath() == null) {
+            setViewPath(aProj.getBaseDir().getPath());
+        }
+
+        // build the command line from what we got the format is
+        // cleartool checkout [options...] [viewpath ...]
+        // as specified in the CLEARTOOL.EXE help
+        commandLine.setExecutable(getClearToolCommand());
+        commandLine.createArgument().setValue(COMMAND_CHECKOUT);
+
+        checkOptions(commandLine);
+
+        result = run(commandLine);
+        if ( result != 0 ) {
+            String msg = "Failed executing: " + commandLine.toString();
+            throw new BuildException(msg, location);
+        }
+    }
+
+
+    /**
+     * Check the command line options.
+     */
+    private void checkOptions(Commandline cmd) {
+        // ClearCase items
+        if (getReserved()) {
+            // -reserved
+            cmd.createArgument().setValue(FLAG_RESERVED);
+        } else {
+            // -unreserved
+            cmd.createArgument().setValue(FLAG_UNRESERVED);
+        }
+
+        if (getOut() != null) {
+            // -out
+            getOutCommand(cmd);
+        } else {
+            if (getNoData()) {
+                // -ndata
+                cmd.createArgument().setValue(FLAG_NODATA);
+            }
+
+        }
+
+        if (getBranch() != null) {
+            // -branch
+            getBranchCommand(cmd);
+        } else {
+            if (getVersion()) {
+                // -version
+                cmd.createArgument().setValue(FLAG_VERSION);
+            }
+
+        }
+
+        if (getNoWarn()) {
+            // -nwarn
+            cmd.createArgument().setValue(FLAG_NOWARN);
+        }
+
+        if (getComment() != null) {
+            // -c
+            getCommentCommand(cmd);
+        } else {
+            if (getCommentFile() != null) {
+                // -cfile
+                getCommentFileCommand(cmd);
+            } else {
+                cmd.createArgument().setValue(FLAG_NOCOMMENT);
+            }
+        }
+
+        // viewpath
+        cmd.createArgument().setValue(getViewPath());
+    }
+
+    /**
+     * Set reserved flag status
+     *
+     * @param reserved the status to set the flag to
+     */
+    public void setReserved(boolean reserved) {
+        m_Reserved = reserved;
+    }
+
+    /**
+     * Get reserved flag status
+     *
+     * @return boolean containing status of reserved flag
+     */
+    public boolean getReserved() {
+        return m_Reserved;
+    }
+
+    /**
+     * Set out file
+     *
+     * @param outf the path to the out file
+     */
+    public void setOut(String outf) {
+        m_Out = outf;
+    }
+
+    /**
+     * Get out file
+     *
+     * @return String containing the path to the out file
+     */
+    public String getOut() {
+        return m_Out;
+    }
+
+    /**
+     * Set the nodata flag
+     *
+     * @param ndata the status to set the flag to
+     */
+    public void setNoData(boolean ndata) {
+        m_Ndata = ndata;
+    }
+
+    /**
+     * Get nodata flag status
+     *
+     * @return boolean containing status of ndata flag
+     */
+    public boolean getNoData() {
+        return m_Ndata;
+    }
+
+    /**
+     * Set branch name
+     *
+     * @param branch the name of the branch
+     */
+    public void setBranch(String branch) {
+        m_Branch = branch;
+    }
+
+    /**
+     * Get branch name
+     *
+     * @return String containing the name of the branch
+     */
+    public String getBranch() {
+        return m_Branch;
+    }
+
+    /**
+     * Set the version flag
+     *
+     * @param version the status to set the flag to
+     */
+    public void setVersion(boolean version) {
+        m_Version = version;
+    }
+
+    /**
+     * Get version flag status
+     *
+     * @return boolean containing status of version flag
+     */
+    public boolean getVersion() {
+        return m_Version;
+    }
+
+    /**
+     * Set the nowarn flag
+     *
+     * @param nwarn the status to set the flag to
+     */
+    public void setNoWarn(boolean nwarn) {
+        m_Nwarn = nwarn;
+    }
+
+    /**
+     * Get nowarn flag status
+     *
+     * @return boolean containing status of nwarn flag
+     */
+    public boolean getNoWarn() {
+        return m_Nwarn;
+    }
+
+    /**
+     * Set comment string
+     *
+     * @param comment the comment string
+     */
+    public void setComment(String comment) {
+        m_Comment = comment;
+    }
+
+    /**
+     * Get comment string
+     *
+     * @return String containing the comment
+     */
+    public String getComment() {
+        return m_Comment;
+    }
+
+    /**
+     * Set comment file
+     *
+     * @param cfile the path to the comment file
+     */
+    public void setCommentFile(String cfile) {
+        m_Cfile = cfile;
+    }
+
+    /**
+     * Get comment file
+     *
+     * @return String containing the path to the comment file
+     */
+    public String getCommentFile() {
+        return m_Cfile;
+    }
+
+    /**
+     * Get the 'out' command
+     *
+     * @return the 'out' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the out flag and path appended
+     */
+    private void getOutCommand(Commandline cmd) {
+        if (getOut() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_OUT);
+            cmd.createArgument().setValue(getOut());
+        }
+    }
+
+    /**
+     * Get the 'branch' command
+     *
+     * @return the 'branch' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the branch flag and name appended
+     */
+    private void getBranchCommand(Commandline cmd) {
+        if (getBranch() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_BRANCH);
+            cmd.createArgument().setValue(getBranch());
+        }
+    }
+
+
+    /**
+     * Get the 'comment' command
+     *
+     * @return the 'comment' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the comment flag and string appended
+     */
+    private void getCommentCommand(Commandline cmd) {
+        if (getComment() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_COMMENT);
+            cmd.createArgument().setValue(getComment());
+        }
+    }
+
+    /**
+     * Get the 'cfile' command
+     *
+     * @return the 'cfile' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the cfile flag and file appended
+     */
+    private void getCommentFileCommand(Commandline cmd) {
+        if (getCommentFile() != null) {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_COMMENTFILE);
+            cmd.createArgument().setValue(getCommentFile());
+        }
+    }
+
+        /**
+     *  -reserved flag -- check out the file as reserved
+     */
+    public static final String FLAG_RESERVED = "-reserved";
+        /**
+     *  -reserved flag -- check out the file as unreserved
+     */
+    public static final String FLAG_UNRESERVED = "-unreserved";
+        /**
+     * -out flag -- create a writable file under a different filename
+     */
+    public static final String FLAG_OUT = "-out";
+        /**
+     * -ndata flag -- checks out the file but does not create an editable file containing its data
+     */
+    public static final String FLAG_NODATA = "-ndata";
+        /**
+     * -branch flag -- checks out the file on a specified branch
+     */
+    public static final String FLAG_BRANCH = "-branch";
+        /**
+     * -version flag -- allows checkout of a version that is not main latest
+     */
+    public static final String FLAG_VERSION = "-version";
+        /**
+     * -nwarn flag -- suppresses warning messages
+     */
+    public static final String FLAG_NOWARN = "-nwarn";
+        /**
+     * -c flag -- comment to attach to the file
+     */
+    public static final String FLAG_COMMENT = "-c";
+        /**
+     * -cfile flag -- file containing a comment to attach to the file
+     */
+    public static final String FLAG_COMMENTFILE = "-cfile";
+        /**
+     * -nc flag -- no comment is specified
+     */
+    public static final String FLAG_NOCOMMENT = "-nc";
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUnCheckout.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUnCheckout.java
new file mode 100644
index 0000000..b68f13c
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUnCheckout.java
@@ -0,0 +1,168 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.clearcase;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
+import org.apache.tools.ant.types.Path;
+
+import java.io.File;
+
+/**
+ * Task to perform UnCheckout command to ClearCase.
+ * <p>
+ * The following attributes are interpretted:
+ * <table border="1">
+ *   <tr>
+ *     <th>Attribute</th>
+ *     <th>Values</th>
+ *     <th>Required</th>
+ *   </tr>
+ *   <tr>
+ *      <td>viewpath</td>
+ *      <td>Path to the ClearCase view file or directory that the command will operate on</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>keepcopy</td>
+ *      <td>Specifies whether to keep a copy of the file with a .keep extension or not</td>
+ *      <td>No</td>
+ *   <tr>
+ * </table>
+ *
+ * @author Curtis White
+ */
+public class CCUnCheckout extends ClearCase {
+    private boolean m_Keep = false;
+
+    /**
+     * Executes the task.
+     * <p>
+     * Builds a command line to execute cleartool and then calls Exec's run method
+     * to execute the command line.
+     */
+    public void execute() throws BuildException {
+        Commandline commandLine = new Commandline();
+        Project aProj = getProject();
+        int result = 0;
+
+        // Default the viewpath to basedir if it is not specified
+        if (getViewPath() == null) {
+            setViewPath(aProj.getBaseDir().getPath());
+        }
+
+        // build the command line from what we got the format is
+        // cleartool uncheckout [options...] [viewpath ...]
+        // as specified in the CLEARTOOL.EXE help
+        commandLine.setExecutable(getClearToolCommand());
+        commandLine.createArgument().setValue(COMMAND_UNCHECKOUT);
+
+        checkOptions(commandLine);
+
+        result = run(commandLine);
+        if ( result != 0 ) {
+            String msg = "Failed executing: " + commandLine.toString();
+            throw new BuildException(msg, location);
+        }
+    }
+
+
+    /**
+     * Check the command line options.
+     */
+    private void checkOptions(Commandline cmd) {
+        // ClearCase items
+        if (getKeepCopy()) {
+            // -keep
+            cmd.createArgument().setValue(FLAG_KEEPCOPY);
+        } else {
+            // -rm
+            cmd.createArgument().setValue(FLAG_RM);
+        }
+
+        // viewpath
+        cmd.createArgument().setValue(getViewPath());
+    }
+
+    /**
+     * Set keepcopy flag status
+     *
+     * @param keep the status to set the flag to
+     */
+    public void setKeepCopy(boolean keep) {
+        m_Keep = keep;
+    }
+
+    /**
+     * Get keepcopy flag status
+     *
+     * @return boolean containing status of keep flag
+     */
+    public boolean getKeepCopy() {
+        return m_Keep;
+    }
+
+
+        /**
+     *  -keep flag -- keep a copy of the file with .keep extension
+     */
+    public static final String FLAG_KEEPCOPY = "-keep";
+        /**
+     *  -rm flag -- remove the copy of the file
+     */
+    public static final String FLAG_RM = "-rm";
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUpdate.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUpdate.java
new file mode 100644
index 0000000..8def7fe
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/CCUpdate.java
@@ -0,0 +1,355 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.clearcase;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
+import org.apache.tools.ant.types.Path;
+
+import java.io.File;
+import java.lang.System;
+
+/**
+ * Task to perform an Update command to ClearCase.
+ * <p>
+ * The following attributes are interpretted:
+ * <table border="1">
+ *   <tr>
+ *     <th>Attribute</th>
+ *     <th>Values</th>
+ *     <th>Required</th>
+ *   </tr>
+ *   <tr>
+ *      <td>viewpath</td>
+ *      <td>Path to the ClearCase view file or directory that the command will operate on</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>graphical</td>
+ *      <td>Displays a graphical dialog during the update</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>log</td>
+ *      <td>Specifies a log file for ClearCase to write to</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>overwrite</td>
+ *      <td>Specifies whether to overwrite hijacked files or not</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>rename</td>
+ *      <td>Specifies that hijacked files should be renamed with a .keep extension</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>currenttime</td>
+ *      <td>Specifies that modification time should be written as the current time. Either currenttime or preservetime can be specified.</td>
+ *      <td>No</td>
+ *   <tr>
+ *   <tr>
+ *      <td>preservetime</td>
+ *      <td>Specifies that modification time should preserved from the VOB time. Either currenttime or preservetime can be specified.</td>
+ *      <td>No</td>
+ *   <tr>
+ * </table>
+ *
+ * @author Curtis White
+ */
+public class CCUpdate extends ClearCase {
+    private boolean m_Graphical = false;
+    private boolean m_Overwrite = false;
+    private boolean m_Rename = false;
+    private boolean m_Ctime = false;
+    private boolean m_Ptime = false;
+    private String m_Log = null;
+
+    /**
+     * Executes the task.
+     * <p>
+     * Builds a command line to execute cleartool and then calls Exec's run method
+     * to execute the command line.
+     */
+    public void execute() throws BuildException {
+        Commandline commandLine = new Commandline();
+        Project aProj = getProject();
+        int result = 0;
+
+        // Default the viewpath to basedir if it is not specified
+        if (getViewPath() == null) {
+            setViewPath(aProj.getBaseDir().getPath());
+        }
+
+        // build the command line from what we got the format is
+        // cleartool update [options...] [viewpath ...]
+        // as specified in the CLEARTOOL.EXE help
+        commandLine.setExecutable(getClearToolCommand());
+        commandLine.createArgument().setValue(COMMAND_UPDATE);
+
+        // Check the command line options
+        checkOptions(commandLine);
+
+        // For debugging
+        System.out.println(commandLine.toString());
+
+        result = run(commandLine);
+        if ( result != 0 ) {
+            String msg = "Failed executing: " + commandLine.toString();
+            throw new BuildException(msg, location);
+        }
+    }
+
+    /**
+     * Check the command line options.
+     */
+    private void checkOptions(Commandline cmd) {
+        // ClearCase items
+        if (getGraphical()) {
+            // -graphical
+            cmd.createArgument().setValue(FLAG_GRAPHICAL);
+        } else {
+            if (getOverwrite()) {
+                // -overwrite
+                cmd.createArgument().setValue(FLAG_OVERWRITE);
+            } else {
+                if (getRename()) {
+                    // -rename
+                    cmd.createArgument().setValue(FLAG_RENAME);
+                } else {
+                    // -noverwrite
+                    cmd.createArgument().setValue(FLAG_NOVERWRITE);
+                }
+            }
+
+            if (getCurrentTime()) {
+                // -ctime
+                cmd.createArgument().setValue(FLAG_CURRENTTIME);
+            } else {
+                if (getPreserveTime()) {
+                    // -ptime
+                    cmd.createArgument().setValue(FLAG_PRESERVETIME);
+                }
+            }
+
+            // -log logname
+            getLogCommand(cmd);
+        }
+
+        // viewpath
+        cmd.createArgument().setValue(getViewPath());
+    }
+
+    /**
+     * Set graphical flag status
+     *
+     * @param graphical the status to set the flag to
+     */
+    public void setGraphical(boolean graphical) {
+        m_Graphical = graphical;
+    }
+
+    /**
+     * Get graphical flag status
+     *
+     * @return boolean containing status of graphical flag
+     */
+    public boolean getGraphical() {
+        return m_Graphical;
+    }
+
+    /**
+     * Set overwrite hijacked files status
+     *
+     * @param ow the status to set the flag to
+     */
+    public void setOverwrite(boolean ow) {
+        m_Overwrite = ow;
+    }
+
+    /**
+     * Get overwrite hijacked files status
+     *
+     * @return boolean containing status of overwrite flag
+     */
+    public boolean getOverwrite() {
+        return m_Overwrite;
+    }
+
+    /**
+     * Set rename hijacked files status
+     *
+     * @param ren the status to set the flag to
+     */
+    public void setRename(boolean ren) {
+        m_Rename = ren;
+    }
+
+    /**
+     * Get rename hijacked files status
+     *
+     * @return boolean containing status of rename flag
+     */
+    public boolean getRename() {
+        return m_Rename;
+    }
+
+    /**
+     * Set modified time based on current time
+     *
+     * @param ct the status to set the flag to
+     */
+    public void setCurrentTime(boolean ct) {
+        m_Ctime = ct;
+    }
+
+    /**
+     * Get current time status
+     *
+     * @return boolean containing status of current time flag
+     */
+    public boolean getCurrentTime() {
+        return m_Ctime;
+    }
+
+    /**
+     * Preserve modified time from the VOB time
+     *
+     * @param pt the status to set the flag to
+     */
+    public void setPreserveTime(boolean pt) {
+        m_Ptime = pt;
+    }
+
+    /**
+     * Get preserve time status
+     *
+     * @return boolean containing status of preserve time flag
+     */
+    public boolean getPreserveTime() {
+        return m_Ptime;
+    }
+
+    /**
+     * Set log file where cleartool can record the status of the command
+     *
+     * @param log the path to the log file
+     */
+    public void setLog(String log) {
+        m_Log = log;
+    }
+
+    /**
+     * Get log file
+     *
+     * @return String containing the path to the log file
+     */
+    public String getLog() {
+        return m_Log;
+    }
+
+    /**
+     * Get the 'log' command
+     *
+     * @return the 'log' command if the attribute was specified, otherwise an empty string
+     *
+     * @param CommandLine containing the command line string with or without the log flag and path appended
+     */
+    private void getLogCommand(Commandline cmd) {
+        if (getLog() == null) {
+            return;
+        } else {
+            /* Had to make two separate commands here because if a space is
+               inserted between the flag and the value, it is treated as a
+               Windows filename with a space and it is enclosed in double
+               quotes ("). This breaks clearcase.
+            */
+            cmd.createArgument().setValue(FLAG_LOG);
+            cmd.createArgument().setValue(getLog());
+        }
+    }
+
+        /**
+     *  -graphical flag -- display graphical dialog during update operation
+     */
+    public static final String FLAG_GRAPHICAL = "-graphical";
+        /**
+     * -log flag -- file to log status to
+     */
+    public static final String FLAG_LOG = "-log";
+        /**
+     * -overwrite flag -- overwrite hijacked files
+     */
+    public static final String FLAG_OVERWRITE = "-overwrite";
+        /**
+     * -noverwrite flag -- do not overwrite hijacked files
+     */
+    public static final String FLAG_NOVERWRITE = "-noverwrite";
+        /**
+     * -rename flag -- rename hijacked files with .keep extension
+     */
+    public static final String FLAG_RENAME = "-rename";
+        /**
+     * -ctime flag -- modified time is written as the current time
+     */
+    public static final String FLAG_CURRENTTIME = "-ctime";
+        /**
+     * -ptime flag -- modified time is written as the VOB time
+     */
+    public static final String FLAG_PRESERVETIME = "-ptime";
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/ClearCase.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/ClearCase.java
new file mode 100644
index 0000000..1d12412
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/clearcase/ClearCase.java
@@ -0,0 +1,163 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.clearcase;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.Execute;
+import org.apache.tools.ant.taskdefs.LogStreamHandler;
+import org.apache.tools.ant.types.Commandline;
+
+import java.io.File;
+
+/**
+ * A base class for creating tasks for executing commands on ClearCase.
+ * <p>
+ * The class extends the 'exec' task as it operates by executing the cleartool program
+ * supplied with ClearCase. By default the task expects the cleartool executable to be
+ * in the path, * you can override this be specifying the cleartooldir attribute.
+ * </p>
+ * <p>
+ * This class provides set and get methods for the 'viewpath' attribute. It
+ * also contains constants for the flags that can be passed to cleartool.
+ * </p>
+ *
+ * @author Curtis White
+ */
+public abstract class ClearCase extends Task {
+    private String m_ClearToolDir = "";
+    private String m_viewPath = null;
+
+    /**
+     * Set the directory where the cleartool executable is located
+     *
+     * @param dir the directory containing the cleartool executable
+     */
+    public final void setClearToolDir(String dir) {
+        m_ClearToolDir = project.translatePath(dir);
+    }
+
+    /**
+     * Builds and returns the command string to execute cleartool
+     *
+     * @return String containing path to the executable
+     */
+    protected final String getClearToolCommand() {
+        String toReturn = m_ClearToolDir;
+        if ( !toReturn.equals("") && !toReturn.endsWith("/") ) {
+            toReturn += "/";
+        }
+
+        toReturn += CLEARTOOL_EXE;
+
+        return toReturn;
+    }
+
+    /**
+     * Set the path to the item in a clearcase view to operate on
+     *
+     * @param viewPath Path to the view directory or file
+     */
+    public final void setViewPath(String viewPath) {
+        m_viewPath = viewPath;
+    }
+
+    /**
+     * Get the path to the item in a clearcase view
+     *
+     * @return m_viewPath
+     */
+    public String getViewPath() {
+        return m_viewPath;
+    }
+
+
+    protected int run(Commandline cmd) {
+        try {
+            Project aProj = getProject();
+            Execute exe = new Execute(new LogStreamHandler(this, Project.MSG_INFO, Project.MSG_WARN));
+            exe.setAntRun(aProj);
+            exe.setWorkingDirectory(aProj.getBaseDir());
+            exe.setCommandline(cmd.getCommandline());
+            return exe.execute();
+        }
+        catch (java.io.IOException e) {
+            throw new BuildException(e, location);
+        }
+    }
+
+    /**
+     * Constant for the thing to execute
+     */
+    private static final String CLEARTOOL_EXE = "cleartool";
+
+    /**
+     * The 'Update' command
+     */
+    public static final String COMMAND_UPDATE = "update";
+    /**
+     * The 'Checkout' command
+     */
+    public static final String COMMAND_CHECKOUT = "checkout";
+    /**
+     * The 'Checkin' command
+     */
+    public static final String COMMAND_CHECKIN = "checkin";
+    /**
+     * The 'UndoCheckout' command
+     */
+    public static final String COMMAND_UNCHECKOUT = "uncheckout";
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFile.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFile.java
new file mode 100644
index 0000000..4e9da34
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFile.java
@@ -0,0 +1,158 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend;
+
+import java.io.*;
+import java.lang.reflect.Modifier;
+import java.util.*;
+import org.apache.tools.ant.taskdefs.optional.depend.constantpool.*;
+
+/**
+ * A ClassFile object stores information about a Java class.
+ * 
+ * The class may be read from a DataInputStream.and written
+ * to a DataOutputStream. These are usually streams from a Java
+ * class file or a class file component of a Jar file.
+ * 
+ * @author Conor MacNeill
+ */
+public class ClassFile {
+
+    /**
+     * The Magic Value that marks the start of a Java class file
+     */
+    static private final int CLASS_MAGIC = 0xCAFEBABE;
+
+
+    /**
+     * This class' constant pool.
+     */
+    private ConstantPool constantPool;
+
+
+    /**
+     * The class name for this class.
+     */
+    private String className;
+
+    /**
+     * Read the class from a data stream.
+     * 
+     * This method takes an InputStream as input and
+     * parses the class from the stream.
+     * <p>
+     * 
+     * @param stream an InputStream from which the class will be read
+     * 
+     * @throws IOException if there is a problem reading from the given stream.
+     * @throws ClassFormatError if the class cannot be parsed correctly
+     * 
+     */
+    public void read(InputStream stream) throws IOException, ClassFormatError {
+        DataInputStream classStream = new DataInputStream(stream);
+
+
+        if (classStream.readInt() != CLASS_MAGIC) {
+            throw new ClassFormatError("No Magic Code Found - probably not a Java class file.");
+        } 
+
+        // right we have a good looking class file.
+        int minorVersion = classStream.readUnsignedShort();
+        int majorVersion = classStream.readUnsignedShort();
+
+        // read the constant pool in and resolve it
+        constantPool = new ConstantPool();
+
+        constantPool.read(classStream);
+        constantPool.resolve();
+
+        int accessFlags = classStream.readUnsignedShort();
+        int thisClassIndex = classStream.readUnsignedShort();
+        int superClassIndex = classStream.readUnsignedShort();
+        className = ((ClassCPInfo) constantPool.getEntry(thisClassIndex)).getClassName();
+    } 
+
+
+    /**
+     * Get the classes which this class references.
+     */
+    public Vector getClassRefs() {
+
+        Vector classRefs = new Vector();
+
+        for (int i = 0; i < constantPool.size(); ++i) {
+            ConstantPoolEntry entry = constantPool.getEntry(i);
+
+            if (entry != null && entry.getTag() == ConstantPoolEntry.CONSTANT_Class) {
+                ClassCPInfo classEntry = (ClassCPInfo) entry;
+
+                if (!classEntry.getClassName().equals(className)) {
+                    classRefs.addElement(ClassFileUtils.convertSlashName(classEntry.getClassName()));
+                } 
+            } 
+        } 
+
+        return classRefs;
+    } 
+
+    /**
+     * Get the class' fully qualified name in dot format.
+     * 
+     * @return the class name in dot format (eg. java.lang.Object)
+     */
+    public String getFullClassName() {
+        return ClassFileUtils.convertSlashName(className);
+    } 
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Map.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileIterator.java
similarity index 90%
rename from jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Map.java
rename to jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileIterator.java
index 74907ce..5bae205 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/Map.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileIterator.java
@@ -1,11 +1,7 @@
-
-
-package org.apache.tools.ant;
-import java.util.*;
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -27,7 +23,7 @@ import java.util.*;
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -54,9 +50,11 @@ import java.util.*;
  * individuals on behalf of the Apache Software Foundation.  For more
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
- */ 
+ */
+package org.apache.tools.ant.taskdefs.optional.depend;
+
 
-public interface Map {
+public interface ClassFileIterator {
 
-    public Object get( Object key );
+    public ClassFile getNextClassFile();
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileUtils.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileUtils.java
new file mode 100644
index 0000000..7457999
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/ClassFileUtils.java
@@ -0,0 +1,90 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend;
+
+/**
+ * Utility class file routines.
+ * 
+ * This class porovides a number of static utility methods to convert between the
+ * formats used in the Java class file format and those commonly used in Java
+ * programming.
+ * 
+ * @author Conor MacNeill
+ */
+public class ClassFileUtils {
+
+    /**
+     * Convert a class name from class file slash notation to java source
+     * file dot notation.
+     * 
+     * @param slashName the class name in slash notation (eg. java/lang/Object)
+     * 
+     * @return the class name in dot notation (eg. java.lang.Object).
+     */
+    static public String convertSlashName(String name) {
+        return name.replace('\\', '.').replace( '/', '.' );
+    } 
+
+    /**
+     * Convert a class name from java source file dot notation to class file slash notation..
+     * 
+     * @param dotName the class name in dot notation (eg. java.lang.Object).
+     * 
+     * @return the class name in slash notation (eg. java/lang/Object).
+     */
+    static public String convertDotName(String dotName) {
+        return dotName.replace( '.', '/');
+    } 
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/Depend.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/Depend.java
new file mode 100644
index 0000000..84c4809
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/Depend.java
@@ -0,0 +1,436 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.depend;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
+import org.apache.tools.ant.taskdefs.MatchingTask;
+
+import java.util.*;
+import java.io.*;
+
+import org.apache.tools.ant.taskdefs.optional.depend.*;
+
+/**
+ * Generate a dependency file for a given set of classes 
+ *
+ * @author Conor MacNeill
+ */
+public class Depend extends MatchingTask {
+    static private class ClassFileInfo {
+        public File absoluteFile;
+        public String relativeName;
+        public String className;
+    };
+
+    /**
+     * The path where source files exist
+     */    
+    private Path srcPath;
+
+    /**
+     * The path where compiled class files exist.
+     */
+    private Path destPath;
+    
+    /**
+     * The directory which contains the dependency cache.
+     */
+    private File cache;
+
+    /**
+     * A map which gives for every class a list of te class which it affects.
+     */
+    private Hashtable affectedClassMap;
+
+    /**
+     * A map which gives information about a class
+     */
+    private Hashtable classFileInfoMap;
+
+    /**
+     * The list of classes which are out of date.
+     */
+    private Vector outOfDateClasses;
+     
+    /**
+     * indicates that the dependency relationships should be extended
+     * beyond direct dependencies to include all classes. So if A directly
+     * affects B abd B directly affects C, then A indirectly affects C.
+     */
+    private boolean closure = false;
+
+    private void writeDependencyList(File depFile, Vector dependencyList) throws IOException {
+        // new dependencies so need to write them out to the cache
+        PrintWriter pw = null;
+        try {
+            String parent = depFile.getParent();
+            if (parent != null) {
+                new File(parent).mkdirs(); 
+            }
+            
+            pw = new PrintWriter(new FileWriter(depFile));
+            for (Enumeration deps = dependencyList.elements(); deps.hasMoreElements();) {
+                pw.println(deps.nextElement());
+            }
+        }
+        finally {
+            if (pw != null) { 
+                pw.close();
+            }
+        }
+    }
+
+    private Vector readDependencyList(File depFile) throws IOException {
+        Vector dependencyList = null;
+        BufferedReader in = null;
+        try {
+            in = new BufferedReader(new FileReader(depFile));
+            String line = null;
+            dependencyList = new Vector();
+            while ((line = in.readLine()) != null) {
+                dependencyList.addElement(line);
+            }
+        }
+        finally {
+            if (in != null) { 
+                in.close();
+            }
+        }
+        
+        return dependencyList;
+    }
+
+
+    private void determineDependencies() throws IOException {
+        affectedClassMap = new Hashtable();
+        classFileInfoMap = new Hashtable();
+        for (Enumeration e = getClassFiles(destPath).elements(); e.hasMoreElements(); ) {
+            ClassFileInfo info = (ClassFileInfo)e.nextElement();
+            log("Adding class info for " + info.className, Project.MSG_DEBUG);
+            classFileInfoMap.put(info.className, info);
+            
+            Vector dependencyList = null;
+            
+            if (cache != null) {
+                // try to read the dependency info from the cache if it is not out of date
+                File depFile = new File(cache, info.relativeName + ".dep");
+                if (depFile.exists() && depFile.lastModified() > info.absoluteFile.lastModified()) {
+                    // depFile exists and is newer than the class file
+                    // need to read dependency list from the file.
+                    dependencyList = readDependencyList(depFile);
+                }
+            }
+            
+            if (dependencyList == null) {
+                // not cached - so need to read directly from the class file
+                FileInputStream inFileStream = null;
+                try {
+                    inFileStream = new FileInputStream(info.absoluteFile);
+                    ClassFile classFile = new ClassFile();
+                    classFile.read(inFileStream);
+                    
+                    dependencyList = classFile.getClassRefs();
+                    
+                    if (cache != null) {
+                        // new dependencies so need to write them out to the cache
+                        File depFile = new File(cache, info.relativeName + ".dep");
+                        writeDependencyList(depFile, dependencyList);
+                    }
+                }
+                finally {
+                    if (inFileStream != null) {
+                        inFileStream.close();
+                    }
+                }
+            }
+            
+            // This class depends on each class in the dependency list. For each
+            // one of those, add this class into their affected classes list 
+            
+            for (Enumeration depEnum = dependencyList.elements(); depEnum.hasMoreElements(); ) {
+                String dependentClass = (String)depEnum.nextElement();
+                
+                Hashtable affectedClasses = (Hashtable)affectedClassMap.get(dependentClass);
+                if (affectedClasses == null) {
+                    affectedClasses = new Hashtable();
+                    affectedClassMap.put(dependentClass, affectedClasses);
+                }
+                
+                affectedClasses.put(info.className, info);
+            }
+        }
+    }
+    
+    
+    private void deleteAllAffectedFiles() {
+        for (Enumeration e = outOfDateClasses.elements(); e.hasMoreElements();) {
+            String className = (String)e.nextElement();
+            deleteAffectedFiles(className);
+        }            
+    }
+    
+    private void deleteAffectedFiles(String className) {
+        Hashtable affectedClasses = (Hashtable)affectedClassMap.get(className);
+        if (affectedClasses != null) {
+            for (Enumeration e = affectedClasses.keys(); e.hasMoreElements(); ) {
+                String affectedClassName = (String)e.nextElement();
+                ClassFileInfo affectedClassInfo = (ClassFileInfo)affectedClasses.get(affectedClassName);
+                if (affectedClassInfo.absoluteFile.exists()) {
+                    log("Deleting file " + affectedClassInfo.absoluteFile.getPath() + " since " + 
+                        className + " out of date", Project.MSG_VERBOSE);
+                    affectedClassInfo.absoluteFile.delete();
+                    if (closure) {
+                        deleteAffectedFiles(affectedClassName);
+                    }
+                    else {
+                        // without closure we may delete an inner class but not the
+                        // top level class which would not trigger a recompile.
+                           
+                        if (affectedClassName.indexOf("$") != -1) {
+                            // need to delete the main class
+                            String topLevelClassName 
+                                = affectedClassName.substring(0, affectedClassName.indexOf("$"));
+                            log("Top level class = " + topLevelClassName, Project.MSG_VERBOSE);
+                            ClassFileInfo topLevelClassInfo 
+                                = (ClassFileInfo)classFileInfoMap.get(topLevelClassName);
+                            if (topLevelClassInfo != null &&
+                                topLevelClassInfo.absoluteFile.exists()) {
+                                log("Deleting file " + topLevelClassInfo.absoluteFile.getPath() + " since " + 
+                                    "one of its inner classes was removed", Project.MSG_VERBOSE);
+                                topLevelClassInfo.absoluteFile.delete();
+                                if (closure) {
+                                    deleteAffectedFiles(topLevelClassName);
+                                }
+                            }
+                        }
+                    }
+                }
+            }
+        }
+    }
+
+    /**
+     * Does the work.
+     *
+     * @exception BuildException Thrown in unrecovrable error.
+     */
+    public void execute() throws BuildException {
+        try {
+            long start = System.currentTimeMillis();
+            String [] srcPathList = srcPath.list();
+            if (srcPathList.length == 0) {
+                throw new BuildException("srcdir attribute must be set!", location);
+            }
+        
+            if (destPath == null) {
+                destPath = srcPath;
+            }
+            
+            if (cache != null && cache.exists() && !cache.isDirectory()) {
+                throw new BuildException("The cache, if specified, must point to a directory");
+            }
+        
+            if (cache != null && !cache.exists()) {
+                cache.mkdirs();
+            }
+        
+            determineDependencies();
+ 
+/*            
+            for (Enumeration e = affectedClassMap.keys(); e.hasMoreElements(); ) {
+                String className = (String)e.nextElement();
+                log("Class " + className + " affects:", Project.MSG_DEBUG);
+                Hashtable affectedClasses = (Hashtable)affectedClassMap.get(className);
+                for (Enumeration e2 = affectedClasses.keys(); e2.hasMoreElements(); ) {
+                    String affectedClass = (String)e2.nextElement();
+                    ClassFileInfo info = (ClassFileInfo)affectedClasses.get(affectedClass);
+                    log("   " + affectedClass + " in " + info.absoluteFile.getPath(), Project.MSG_DEBUG);
+                }
+            }
+*/            
+            // we now need to scan for out of date files. When we have the list
+            // we go through and delete all class files which are affected by these files.
+            outOfDateClasses = new Vector();
+            for (int i=0; i<srcPathList.length; i++) {
+                File srcDir = (File)project.resolveFile(srcPathList[i]);
+                if (srcDir.exists()) {
+        
+                    DirectoryScanner ds = this.getDirectoryScanner(srcDir);
+        
+                    String[] files = ds.getIncludedFiles();
+        
+                    scanDir(srcDir, files);
+                }
+            }
+            
+            // we now have a complete list of classes which are out of date
+            // We scan through the affected classes, deleting any affected classes.
+            deleteAllAffectedFiles();
+            
+            log("Duration = " + (System.currentTimeMillis() - start));
+        } catch (Exception e) {
+            throw new BuildException(e);
+        }
+    }
+
+    /**
+     * Scans the directory looking for source files that are newer than their class files.
+     * The results are returned in the class variable compileList
+     */
+    protected void scanDir(File srcDir, String files[]) {
+
+        long now = System.currentTimeMillis();
+
+        for (int i = 0; i < files.length; i++) {
+            File srcFile = new File(srcDir, files[i]);
+            if (files[i].endsWith(".java")) {
+                String filePath = srcFile.getPath();
+                String className = filePath.substring(srcDir.getPath().length() + 1,
+                                                      filePath.length() - ".java".length());
+                className = ClassFileUtils.convertSlashName(className);                                                      
+                ClassFileInfo info = (ClassFileInfo)classFileInfoMap.get(className);
+                if (info == null) {
+                    // there was no class file. add this class to the list
+                    outOfDateClasses.addElement(className);
+                }
+                else {
+                    if (srcFile.lastModified() > info.absoluteFile.lastModified()) {
+                        outOfDateClasses.addElement(className);
+                    }
+                }
+            }
+        }
+    }
+
+
+    /** 
+     * Get the list of class files we are going to analyse.
+     *
+     * @param classLocations a path structure containing all the directories
+     *                       where classes can be found.
+     * @return a vector containing the classes to analyse.
+     */
+    private Vector getClassFiles(Path classLocations) {
+        // break the classLocations into its components.        
+        String[] classLocationsList = classLocations.list();            
+        
+        Vector classFileList = new Vector();
+        
+        for (int i = 0; i < classLocationsList.length; ++i) {
+            File dir = new File(classLocationsList[i]);
+            if (dir.isDirectory()) {
+                addClassFiles(classFileList, dir, dir);
+            }
+        }
+        
+        return classFileList;
+    }
+
+    /** 
+     * Add the list of class files from the given directory to the 
+     * class file vector, including any subdirectories.
+     *
+     * @param classLocations a path structure containing all the directories
+     *                       where classes can be found.
+     * @return a vector containing the classes to analyse.
+     */
+    private void addClassFiles(Vector classFileList, File dir, File root) {
+        String[] filesInDir = dir.list();
+        
+        if (filesInDir != null) {
+            int length = filesInDir.length;
+
+            for (int i = 0; i < length; ++i) {
+                File file = new File(dir, filesInDir[i]);
+                if (file.isDirectory()) {
+                    addClassFiles(classFileList, file, root);
+                }
+                else if (file.getName().endsWith(".class")) {
+                    ClassFileInfo info = new ClassFileInfo();
+                    info.absoluteFile = file;
+                    info.relativeName = file.getPath().substring(root.getPath().length() + 1,
+                                                                 file.getPath().length() - 6);
+                    info.className = ClassFileUtils.convertSlashName(info.relativeName);                                                                 
+                    classFileList.addElement(info);
+                }
+            } 
+        } 
+    }
+    
+    
+    /**
+     * Set the source dirs to find the source Java files.
+     */
+    public void setSrcdir(Path srcPath) {
+        this.srcPath = srcPath;
+    }
+
+    /**
+     * Set the destination directory where the compiled java files exist.
+     */
+    public void setDestDir(Path destPath) {
+        this.destPath = destPath;
+    }
+    
+    public void setCache(File cache) {
+        this.cache = cache;
+    }
+    
+    public void setClosure(boolean closure) {
+        this.closure = closure;
+    }
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/DirectoryIterator.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/DirectoryIterator.java
new file mode 100644
index 0000000..f848249
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/DirectoryIterator.java
@@ -0,0 +1,204 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend;
+
+import java.util.*;
+import java.io.*;
+
+/**
+ * An iterator which iterates through the contents of a java directory.
+ * 
+ * The iterator should be created with the directory at the root of the
+ * Java namespace.
+ * 
+ * @author Conor MacNeill
+ */
+public class DirectoryIterator implements ClassFileIterator {
+
+    /**
+     * This is a stack of current iterators supporting the depth first
+     * traversal of the directory tree.
+     */
+    private Stack enumStack;
+
+    /**
+     * The current directory iterator. As directories encounter lower level
+     * directories, the current iterator is pushed onto the iterator
+     * stack and a new iterator over the sub directory becomes the current
+     * directory. This implements a depth first traversal of the directory namespace.
+     */
+    private Enumeration currentEnum;
+
+    /**
+     * The length of the root directory. This is used to remove the root directory
+     * from full paths.
+     */
+    int rootLength;
+
+    /**
+     * Creates a directory iterator.
+     * 
+     * The directory iterator is created to scan the root directory. If the
+     * changeInto flag is given, then the entries returned will be relative to this
+     * directory and not the current directory.
+     * 
+     * @param rootDirectory the root if the directory namespace which is to be iterated over
+     * @param changeInto if true then the returned entries will be relative to the rootDirectory
+     * and not the current directory.
+     * 
+     * @throws IOException if there is a problem reading the directory information.
+     */
+    public DirectoryIterator(File rootDirectory, boolean changeInto) throws IOException {
+        super();
+
+        enumStack = new Stack();
+
+        if (rootDirectory.isAbsolute() || changeInto) {
+            rootLength = rootDirectory.getPath().length() + 1;
+        } else {
+            rootLength = 0;
+        } 
+
+        Vector filesInRoot = getDirectoryEntries(rootDirectory);
+
+        currentEnum = filesInRoot.elements();
+    }
+
+    /**
+     * Get a vector covering all the entries (files and subdirectories in a directory).
+     * 
+     * @param directory the directory to be scanned.
+     * 
+     * @return a vector containing File objects for each entry in the directory.
+     */
+    private Vector getDirectoryEntries(File directory) {
+        Vector files = new Vector();
+
+        // File[] filesInDir = directory.listFiles();
+        String[] filesInDir = directory.list();
+
+        if (filesInDir != null) {
+            int length = filesInDir.length;
+
+            for (int i = 0; i < length; ++i) {
+                files.addElement(new File(directory, filesInDir[i]));
+            } 
+        } 
+
+        return files;
+    } 
+
+    /**
+     * Template method to allow subclasses to supply elements for the iteration.
+     * 
+     * The directory iterator maintains a stack of iterators covering each level
+     * in the directory hierarchy. The current iterator covers the current directory
+     * being scanned. If the next entry in that directory is a subdirectory, the current
+     * iterator is pushed onto the stack and a new iterator is created for the
+     * subdirectory. If the entry is a file, it is returned as the next element and the
+     * iterator remains valid. If there are no more entries in the current directory,
+     * the topmost iterator on the statck is popped off to become the current iterator.
+     * 
+     * @return the next ClassFile in the iteration.
+     */
+    public ClassFile getNextClassFile() {
+        ClassFile nextElement = null;
+
+        try {
+            while (nextElement == null) {
+                if (currentEnum.hasMoreElements()) {
+                    File element = (File) currentEnum.nextElement();
+
+                    if (element.isDirectory()) {
+
+                        // push the current iterator onto the stack and then
+                        // iterate through this directory.
+                        enumStack.push(currentEnum);
+
+                        Vector files = getDirectoryEntries(element);
+
+                        currentEnum = files.elements();
+                    } else {
+
+                        // we have a file. create a stream for it
+                        FileInputStream inFileStream = new FileInputStream(element);
+
+                        if (element.getName().endsWith(".class")) {
+
+                            // create a data input stream from the jar input stream
+                            ClassFile javaClass = new ClassFile();
+
+                            javaClass.read(inFileStream);
+
+                            nextElement = javaClass;
+                        } 
+                    } 
+                } else {
+                    // this iterator is exhausted. Can we pop one off the stack
+                    if (enumStack.empty()) {
+                        break;
+                    } else {
+                        currentEnum = (Enumeration) enumStack.pop();
+                    } 
+                } 
+            } 
+        } catch (IOException e) {
+            nextElement = null;
+        } 
+
+        return nextElement;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/JarFileIterator.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/JarFileIterator.java
new file mode 100644
index 0000000..99cea2f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/JarFileIterator.java
@@ -0,0 +1,124 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend;
+
+import java.util.zip.*;
+import java.io.*;
+
+/**
+ * A class file iterator which iterates through the contents of a Java jar file.
+ * 
+ * @author Conor MacNeill
+ */
+public class JarFileIterator implements ClassFileIterator {
+    private ZipInputStream jarStream;
+
+    public JarFileIterator(InputStream stream) throws IOException {
+        super();
+
+        jarStream = new ZipInputStream(stream);
+    }
+
+    private byte[] getEntryBytes(InputStream stream) throws IOException {
+        byte[]                buffer = new byte[8192];
+        ByteArrayOutputStream baos = new ByteArrayOutputStream(2048);
+        int                   n;
+
+        while ((n = stream.read(buffer, 0, buffer.length)) != -1) {
+            baos.write(buffer, 0, n);
+        } 
+
+        return baos.toByteArray();
+    } 
+
+    public ClassFile getNextClassFile() {
+        ZipEntry         jarEntry;
+        ClassFile nextElement = null;
+
+        try {
+            jarEntry = jarStream.getNextEntry();
+
+
+            while (nextElement == null && jarEntry != null) {
+                String entryName = jarEntry.getName();
+
+                if (!jarEntry.isDirectory() && entryName.endsWith(".class")) {
+
+                        // create a data input stream from the jar input stream
+                        ClassFile javaClass = new ClassFile();
+
+                        javaClass.read(jarStream);
+
+                        nextElement = javaClass;
+                } else {
+                        
+                    jarEntry = jarStream.getNextEntry();
+                } 
+            } 
+        } catch (IOException e) {
+            String message = e.getMessage();
+            String text = e.getClass().getName();
+
+            if (message != null) {
+                text += ": " + message;
+            } 
+
+            throw new RuntimeException("Problem reading JAR file: " + text);
+        } 
+
+        return nextElement;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ClassCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ClassCPInfo.java
new file mode 100644
index 0000000..d157f5a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ClassCPInfo.java
@@ -0,0 +1,128 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * The constant pool entry which stores class information.
+ * 
+ * @author Conor MacNeill
+ */
+public class ClassCPInfo extends ConstantPoolEntry {
+
+    /**
+     * The class' name. This will be only valid if the entry has been resolved
+     * against the constant pool.
+     */
+    private String className;
+
+    /**
+     * The index into the constant pool where this class' name is stored. If the class
+     * name is changed, this entry is invalid until this entry is connected to a constant
+     * pool.
+     */
+    private int    index;
+
+    /**
+     * Constructor.
+     * 
+     * Sets the tag value for this entry to type Class
+     */
+    public ClassCPInfo() {
+        super(CONSTANT_Class, 1);
+    }
+
+    /**
+     * Read the entry from a stream.
+     * 
+     * @param cpStream the stream containing the constant pool entry to be read.
+     * 
+     * @exception IOException thrown if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        index = cpStream.readUnsignedShort();
+        className = "unresolved";
+    } 
+
+    /**
+     * Generate a string readable version of this entry
+     */
+    public String toString() {
+        return "Class Constant Pool Entry for " + className + "[" + index + "]";
+    } 
+
+    /**
+     * Resolve this class info against the given constant pool.
+     * 
+     * @param constantPool the constant pool with which to resolve the class.
+     */
+    public void resolve(ConstantPool constantPool) {
+        className = ((Utf8CPInfo) constantPool.getEntry(index)).getValue();
+
+        super.resolve(constantPool);
+    } 
+
+    /**
+     * Get the class name of this entry.
+     * 
+     * @return the class' name.
+     */
+    public String getClassName() {
+        return className;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantCPInfo.java
new file mode 100644
index 0000000..f058c40
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantCPInfo.java
@@ -0,0 +1,103 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+
+/**
+ * A Constant Pool entry which represents a constant value.
+ * 
+ * 
+ * @author Conor MacNeill
+ */
+abstract public class ConstantCPInfo extends ConstantPoolEntry {
+
+    /**
+     * The entry's untyped value.
+     * 
+     * Each subclass interprets the constant value based on the subclass's type.
+     * The value here must be compatible.
+     */
+    private Object value;
+
+    /**
+     * Initialise the constant entry.
+     * 
+     * @param tagValue the constant pool entry type to be used.
+     * @param entries the number of constant pool entry slots occupied by this entry.
+     */
+    protected ConstantCPInfo(int tagValue, int entries) {
+        super(tagValue, entries);
+    }
+
+    /**
+     * Get the value of the constant.
+     * 
+     * @return the value of the constant (untyped).
+     */
+    public Object getValue() {
+        return value;
+    } 
+
+    /**
+     * Set the constant value.
+     * 
+     * @param newValue the new untyped value of this constant.
+     */
+    public void setValue(Object newValue) {
+        value = newValue;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPool.java
new file mode 100644
index 0000000..fdd8e4a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPool.java
@@ -0,0 +1,383 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * The constant pool of a Java class.
+ * 
+ * The constant pool is a collection of constants used in a Java class file. It stores
+ * strings, constant values, class names, method names, field names etc.
+ * 
+ * @see <a href="http://java.sun.com/docs/books/vmspec/">The Java Virtual Machine Specification</a>
+ * 
+ * @author Conor MacNeill
+ */
+public class ConstantPool {
+
+    /**
+     * The entries in the constant pool.
+     */
+    private Vector entries;
+
+    /**
+     * A Hashtable of UTF8 entries - used to get constant pool indexes of the UTF8 values quickly
+     */
+    private Hashtable utf8Indexes;
+
+    /**
+     * Initialise the constant pool.
+     */
+    public ConstantPool() {
+        entries = new Vector();
+
+        // The zero index is never present in the constant pool itself so
+        // we add a null entry for it
+        entries.addElement(null);
+
+        utf8Indexes = new Hashtable();
+    }
+
+    /**
+     * Read the constant pool from a class input stream.
+     * 
+     * @param classStream the DataInputStream of a class file.
+     * 
+     * @throws IOException if there is a problem reading the constant pool
+     * from the stream
+     */
+    public void read(DataInputStream classStream) throws IOException {
+        int numEntries = classStream.readUnsignedShort();
+
+        for (int i = 1; i < numEntries; ) {
+            ConstantPoolEntry nextEntry = ConstantPoolEntry.readEntry(classStream);
+
+            i += nextEntry.getNumEntries();
+
+            addEntry(nextEntry);
+        } 
+    } 
+
+    /**
+     * Get the size of the constant pool.
+     */
+    public int size() {
+        return entries.size();
+    }
+    
+    /**
+     * Add an entry to the constant pool.
+     * 
+     * @param entry the new entry to be added to the constant pool.
+     * 
+     * @return the index into the constant pool at which the entry is stored.
+     */
+    public int addEntry(ConstantPoolEntry entry) {
+        int index = entries.size();
+
+        entries.addElement(entry);
+
+        int numSlots = entry.getNumEntries();
+
+        // add null entries for any additional slots required.
+        for (int j = 0; j < numSlots - 1; ++j) {
+            entries.addElement(null);
+        } 
+
+        if (entry instanceof Utf8CPInfo) {
+            Utf8CPInfo utf8Info = (Utf8CPInfo) entry;
+
+            utf8Indexes.put(utf8Info.getValue(), new Integer(index));
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Resolve the entries in the constant pool.
+     * 
+     * Resolution of the constant pool involves transforming indexes to
+     * other constant pool entries into the actual data for that entry.
+     */
+    public void resolve() {
+        for (Enumeration i = entries.elements(); i.hasMoreElements(); ) {
+            ConstantPoolEntry poolInfo = (ConstantPoolEntry) i.nextElement();
+
+            if (poolInfo != null &&!poolInfo.isResolved()) {
+                poolInfo.resolve(this);
+            } 
+        } 
+    } 
+
+
+    /**
+     * Get an constant pool entry at a particular index.
+     * 
+     * @param index the index into the constant pool.
+     * 
+     * @return the constant pool entry at that index.
+     */
+    public ConstantPoolEntry getEntry(int index) {
+        return (ConstantPoolEntry) entries.elementAt(index);
+    } 
+
+    /**
+     * Get the index of a given UTF8 constant pool entry.
+     * 
+     * @param value the string value of the UTF8 entry.
+     * 
+     * @return the index at which the given string occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getUTF8Entry(String value) {
+        int     index = -1;
+        Integer indexInteger = (Integer) utf8Indexes.get(value);
+
+        if (indexInteger != null) {
+            index = indexInteger.intValue();
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given CONSTANT_Class entry in the constant pool.
+     * 
+     * @param className the name of the class for which the class entry index is required.
+     * 
+     * @return the index at which the given class entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getClassEntry(String className) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof ClassCPInfo) {
+                ClassCPInfo classinfo = (ClassCPInfo) element;
+
+                if (classinfo.getClassName().equals(className)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given constant value entry in the constant pool.
+     * 
+     * @param constantValue the constant value for which the index is required.
+     * 
+     * @return the index at which the given value entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getConstantEntry(Object constantValue) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof ConstantCPInfo) {
+                ConstantCPInfo constantEntry = (ConstantCPInfo) element;
+
+                if (constantEntry.getValue().equals(constantValue)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given CONSTANT_MethodRef entry in the constant pool.
+     * 
+     * @param methodClassName the name of the class which contains the method
+     * being referenced.
+     * @param methodName the name of the method being referenced.
+     * @param methodType the type descriptor of the metho dbeing referenced.
+     * 
+     * @return the index at which the given method ref entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getMethodRefEntry(String methodClassName, String methodName, String methodType) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof MethodRefCPInfo) {
+                MethodRefCPInfo methodRefEntry = (MethodRefCPInfo) element;
+
+                if (methodRefEntry.getMethodClassName().equals(methodClassName) 
+                        && methodRefEntry.getMethodName().equals(methodName) && methodRefEntry.getMethodType().equals(methodType)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given CONSTANT_InterfaceMethodRef entry in the constant pool.
+     * 
+     * @param interfaceMethodClassName the name of the interface which contains the method
+     * being referenced.
+     * @param interfaceMethodName the name of the method being referenced.
+     * @param interfaceMethodType the type descriptor of the metho dbeing referenced.
+     * 
+     * @return the index at which the given method ref entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getInterfaceMethodRefEntry(String interfaceMethodClassName, String interfaceMethodName, String interfaceMethodType) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof InterfaceMethodRefCPInfo) {
+                InterfaceMethodRefCPInfo interfaceMethodRefEntry = (InterfaceMethodRefCPInfo) element;
+
+                if (interfaceMethodRefEntry.getInterfaceMethodClassName().equals(interfaceMethodClassName) 
+                        && interfaceMethodRefEntry.getInterfaceMethodName().equals(interfaceMethodName) 
+                        && interfaceMethodRefEntry.getInterfaceMethodType().equals(interfaceMethodType)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given CONSTANT_FieldRef entry in the constant pool.
+     * 
+     * @param fieldClassName the name of the class which contains the field
+     * being referenced.
+     * @param fieldName the name of the field being referenced.
+     * @param fieldType the type descriptor of the field being referenced.
+     * 
+     * @return the index at which the given field ref entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getFieldRefEntry(String fieldClassName, String fieldName, String fieldType) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof FieldRefCPInfo) {
+                FieldRefCPInfo fieldRefEntry = (FieldRefCPInfo) element;
+
+                if (fieldRefEntry.getFieldClassName().equals(fieldClassName) && fieldRefEntry.getFieldName().equals(fieldName) 
+                        && fieldRefEntry.getFieldType().equals(fieldType)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Get the index of a given CONSTANT_NameAndType entry in the constant pool.
+     * 
+     * @param name the name
+     * @param type the type
+     * 
+     * @return the index at which the given NameAndType entry occurs in the
+     * constant pool or -1 if the value does not occur.
+     */
+    public int getNameAndTypeEntry(String name, String type) {
+        int index = -1;
+
+        for (int i = 0; i < entries.size() && index == -1; ++i) {
+            Object element = entries.elementAt(i);
+
+            if (element instanceof NameAndTypeCPInfo) {
+                NameAndTypeCPInfo nameAndTypeEntry = (NameAndTypeCPInfo) element;
+
+                if (nameAndTypeEntry.getName().equals(name) && nameAndTypeEntry.getType().equals(type)) {
+                    index = i;
+                } 
+            } 
+        } 
+
+        return index;
+    } 
+
+    /**
+     * Dump the constant pool to a string.
+     * 
+     * @return the constant pool entries as strings
+     */
+    public String toString() {
+        StringBuffer sb = new StringBuffer("\n");
+        int          size = entries.size();
+
+        for (int i = 0; i < size; ++i) {
+            sb.append("[" + i + "] = " + getEntry(i) + "\n");
+        } 
+
+        return sb.toString();
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPoolEntry.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPoolEntry.java
new file mode 100644
index 0000000..2f7d1fb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/ConstantPoolEntry.java
@@ -0,0 +1,289 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * An entry in the constant pool.
+ * 
+ * This class contains a represenation of the constant pool entries. It is
+ * an abstract base class for all the different forms of constant pool entry.
+ * 
+ * @author Conor MacNeill
+ * @see ConstantPool
+ */
+public abstract class ConstantPoolEntry {
+
+    /**
+     * Tag value for UTF8 entries.
+     */
+    static public final int CONSTANT_Utf8 = 1;
+
+    /**
+     * Tag value for Integer entries.
+     */
+    static public final int CONSTANT_Integer = 3;
+
+    /**
+     * Tag value for Float entries.
+     */
+    static public final int CONSTANT_Float = 4;
+
+    /**
+     * Tag value for Long entries.
+     */
+    static public final int CONSTANT_Long = 5;
+
+    /**
+     * Tag value for Double entries.
+     */
+    static public final int CONSTANT_Double = 6;
+
+    /**
+     * Tag value for Class entries.
+     */
+    static public final int CONSTANT_Class = 7;
+
+    /**
+     * Tag value for String entries.
+     */
+    static public final int CONSTANT_String = 8;
+
+    /**
+     * Tag value for Field Reference entries.
+     */
+    static public final int CONSTANT_FieldRef = 9;
+
+    /**
+     * Tag value for Method Reference entries.
+     */
+    static public final int CONSTANT_MethodRef = 10;
+
+    /**
+     * Tag value for Interface Method Reference entries.
+     */
+    static public final int CONSTANT_InterfaceMethodRef = 11;
+
+    /**
+     * Tag value for Name and Type entries.
+     */
+    static public final int CONSTANT_NameAndType = 12;
+
+    /**
+     * This entry's tag which identifies the type of this constant pool entry.
+     */
+    private int             tag;
+
+    /**
+     * The number of slots in the constant pool, occupied by this entry.
+     */
+    private int             numEntries;
+
+    /**
+     * A flag which indiciates if this entry has been resolved or not.
+     */
+    private boolean         resolved;
+
+    /**
+     * Initialse the constant pool entry.
+     * 
+     * @param tagValue the tag value which identifies which type of constant pool entry this is.
+     * @param entries the number of constant pool entry slots this entry occupies.
+     */
+    public ConstantPoolEntry(int tagValue, int entries) {
+        tag = tagValue;
+        numEntries = entries;
+        resolved = false;
+    }
+
+    /**
+     * Read a constant pool entry from a stream.
+     * 
+     * This is a factory method which reads a constant pool entry
+     * form a stream and returns the appropriate subclass for the
+     * entry.
+     * 
+     * @param cpStream the stream from which the constant pool entry is to be read.
+     * 
+     * @returns the appropriate ConstantPoolEntry subclass representing the
+     * constant pool entry from the stream.
+     * 
+     * @throws IOExcception if there is a problem reading the entry from the stream.
+     */
+    static public ConstantPoolEntry readEntry(DataInputStream cpStream) throws IOException {
+        ConstantPoolEntry cpInfo = null;
+        int               cpTag = cpStream.readUnsignedByte();
+
+        switch (cpTag) {
+
+        case CONSTANT_Utf8:
+            cpInfo = new Utf8CPInfo();
+
+            break;
+
+        case CONSTANT_Integer:
+            cpInfo = new IntegerCPInfo();
+
+            break;
+
+        case CONSTANT_Float:
+            cpInfo = new FloatCPInfo();
+
+            break;
+
+        case CONSTANT_Long:
+            cpInfo = new LongCPInfo();
+
+            break;
+
+        case CONSTANT_Double:
+            cpInfo = new DoubleCPInfo();
+
+            break;
+
+        case CONSTANT_Class:
+            cpInfo = new ClassCPInfo();
+
+            break;
+
+        case CONSTANT_String:
+            cpInfo = new StringCPInfo();
+
+            break;
+
+        case CONSTANT_FieldRef:
+            cpInfo = new FieldRefCPInfo();
+
+            break;
+
+        case CONSTANT_MethodRef:
+            cpInfo = new MethodRefCPInfo();
+
+            break;
+
+        case CONSTANT_InterfaceMethodRef:
+            cpInfo = new InterfaceMethodRefCPInfo();
+
+            break;
+
+        case CONSTANT_NameAndType:
+            cpInfo = new NameAndTypeCPInfo();
+
+            break;
+
+        default:
+            throw new ClassFormatError("Invalid Constant Pool entry Type " + cpTag);
+        }
+
+        cpInfo.read(cpStream);
+
+        return cpInfo;
+    } 
+
+    /**
+     * Indicates whether this entry has been resolved.
+     * 
+     * In general a constant pool entry can reference another constant
+     * pool entry by its index value. Resolution involves replacing this
+     * index value with the constant pool entry at that index.
+     * 
+     * @return true if this entry has been resolved.
+     */
+    public boolean isResolved() {
+        return resolved;
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        resolved = true;
+    } 
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public abstract void read(DataInputStream cpStream) throws IOException;
+
+    /**
+     * Get the Entry's type tag.
+     * 
+     * @return The Tag value of this entry
+     */
+    public int getTag() {
+        return tag;
+    } 
+
+    /**
+     * Get the number of Constant Pool Entry slots within the constant pool occupied by this entry.
+     * 
+     * @return the number of slots used.
+     * 
+     */
+    public final int getNumEntries() {
+        return numEntries;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/DoubleCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/DoubleCPInfo.java
new file mode 100644
index 0000000..49cf516
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/DoubleCPInfo.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.IOException;
+import java.io.DataInputStream;
+import java.io.DataOutputStream;
+
+/**
+ * The constant pool entry subclass used to represent double constant values.
+ * 
+ * @author Conor MacNeill
+ */
+public class DoubleCPInfo extends ConstantCPInfo {
+    public DoubleCPInfo() {
+        super(CONSTANT_Double, 2);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        setValue(new Double(cpStream.readDouble()));
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "Double Constant Pool Entry: " + getValue();
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FieldRefCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FieldRefCPInfo.java
new file mode 100644
index 0000000..2891407
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FieldRefCPInfo.java
@@ -0,0 +1,145 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A FieldRef CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class FieldRefCPInfo extends ConstantPoolEntry {
+    private String fieldClassName;
+    private String fieldName;
+    private String fieldType;
+    private int    classIndex;
+    private int    nameAndTypeIndex;
+
+    /**
+     * Constructor.
+     * 
+     */
+    public FieldRefCPInfo() {
+        super(CONSTANT_FieldRef, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        classIndex = cpStream.readUnsignedShort();
+        nameAndTypeIndex = cpStream.readUnsignedShort();
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        ClassCPInfo fieldClass = (ClassCPInfo) constantPool.getEntry(classIndex);
+
+        fieldClass.resolve(constantPool);
+
+        fieldClassName = fieldClass.getClassName();
+
+        NameAndTypeCPInfo nt = (NameAndTypeCPInfo) constantPool.getEntry(nameAndTypeIndex);
+
+        nt.resolve(constantPool);
+
+        fieldName = nt.getName();
+        fieldType = nt.getType();
+
+        super.resolve(constantPool);
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        String value;
+
+        if (isResolved()) {
+            value = "Field : Class = " + fieldClassName + ", name = " + fieldName + ", type = " + fieldType;
+        } else {
+            value = "Field : Class index = " + classIndex + ", name and type index = " + nameAndTypeIndex;
+        } 
+
+        return value;
+    } 
+
+    public String getFieldClassName() {
+        return fieldClassName;
+    } 
+
+    public String getFieldName() {
+        return fieldName;
+    } 
+
+    public String getFieldType() {
+        return fieldType;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FloatCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FloatCPInfo.java
new file mode 100644
index 0000000..f9aee58
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/FloatCPInfo.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+
+/**
+ * A Float CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class FloatCPInfo extends ConstantCPInfo {
+
+    /**
+     * Constructor.
+     * 
+     */
+    public FloatCPInfo() {
+        super(CONSTANT_Float, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        setValue(new Float(cpStream.readFloat()));
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "Float Constant Pool Entry: " + getValue();
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/IntegerCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/IntegerCPInfo.java
new file mode 100644
index 0000000..6bb1e49
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/IntegerCPInfo.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+
+/**
+ * An Integer CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class IntegerCPInfo extends ConstantCPInfo {
+
+    /**
+     * Constructor.
+     * 
+     */
+    public IntegerCPInfo() {
+        super(CONSTANT_Integer, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        setValue(new Integer(cpStream.readInt()));
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "Integer Constant Pool Entry: " + getValue();
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/InterfaceMethodRefCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/InterfaceMethodRefCPInfo.java
new file mode 100644
index 0000000..fed755c
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/InterfaceMethodRefCPInfo.java
@@ -0,0 +1,147 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A InterfaceMethodRef CP Info
+ * 
+ * 
+ * @author Conor MacNeill
+ */
+public class InterfaceMethodRefCPInfo extends ConstantPoolEntry {
+    private String interfaceMethodClassName;
+    private String interfaceMethodName;
+    private String interfaceMethodType;
+    private int    classIndex;
+    private int    nameAndTypeIndex;
+
+    /**
+     * Constructor.
+     * 
+     */
+    public InterfaceMethodRefCPInfo() {
+        super(CONSTANT_InterfaceMethodRef, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        classIndex = cpStream.readUnsignedShort();
+        nameAndTypeIndex = cpStream.readUnsignedShort();
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        ClassCPInfo interfaceMethodClass = (ClassCPInfo) constantPool.getEntry(classIndex);
+
+        interfaceMethodClass.resolve(constantPool);
+
+        interfaceMethodClassName = interfaceMethodClass.getClassName();
+
+        NameAndTypeCPInfo nt = (NameAndTypeCPInfo) constantPool.getEntry(nameAndTypeIndex);
+
+        nt.resolve(constantPool);
+
+        interfaceMethodName = nt.getName();
+        interfaceMethodType = nt.getType();
+
+        super.resolve(constantPool);
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        String value;
+
+        if (isResolved()) {
+            value = "InterfaceMethod : Class = " + interfaceMethodClassName + ", name = " + interfaceMethodName + ", type = " 
+                    + interfaceMethodType;
+        } else {
+            value = "InterfaceMethod : Class index = " + classIndex + ", name and type index = " + nameAndTypeIndex;
+        } 
+
+        return value;
+    } 
+
+    public String getInterfaceMethodClassName() {
+        return interfaceMethodClassName;
+    } 
+
+    public String getInterfaceMethodName() {
+        return interfaceMethodName;
+    } 
+
+    public String getInterfaceMethodType() {
+        return interfaceMethodType;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/LongCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/LongCPInfo.java
new file mode 100644
index 0000000..2e5aeab
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/LongCPInfo.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+
+/**
+ * A Long CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class LongCPInfo extends ConstantCPInfo {
+
+    /**
+     * Constructor.
+     * 
+     */
+    public LongCPInfo() {
+        super(CONSTANT_Long, 2);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        setValue(new Long(cpStream.readLong()));
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "Long Constant Pool Entry: " + getValue();
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/MethodRefCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/MethodRefCPInfo.java
new file mode 100644
index 0000000..f38e381
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/MethodRefCPInfo.java
@@ -0,0 +1,145 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A MethodRef CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class MethodRefCPInfo extends ConstantPoolEntry {
+    private String methodClassName;
+    private String methodName;
+    private String methodType;
+    private int    classIndex;
+    private int    nameAndTypeIndex;
+
+    /**
+     * Constructor.
+     * 
+     */
+    public MethodRefCPInfo() {
+        super(CONSTANT_MethodRef, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        classIndex = cpStream.readUnsignedShort();
+        nameAndTypeIndex = cpStream.readUnsignedShort();
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        String value;
+
+        if (isResolved()) {
+            value = "Method : Class = " + methodClassName + ", name = " + methodName + ", type = " + methodType;
+        } else {
+            value = "Method : Class index = " + classIndex + ", name and type index = " + nameAndTypeIndex;
+        } 
+
+        return value;
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        ClassCPInfo methodClass = (ClassCPInfo) constantPool.getEntry(classIndex);
+
+        methodClass.resolve(constantPool);
+
+        methodClassName = methodClass.getClassName();
+
+        NameAndTypeCPInfo nt = (NameAndTypeCPInfo) constantPool.getEntry(nameAndTypeIndex);
+
+        nt.resolve(constantPool);
+
+        methodName = nt.getName();
+        methodType = nt.getType();
+
+        super.resolve(constantPool);
+    } 
+
+    public String getMethodClassName() {
+        return methodClassName;
+    } 
+
+    public String getMethodName() {
+        return methodName;
+    } 
+
+    public String getMethodType() {
+        return methodType;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/NameAndTypeCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/NameAndTypeCPInfo.java
new file mode 100644
index 0000000..328b8c6
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/NameAndTypeCPInfo.java
@@ -0,0 +1,130 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A NameAndType CP Info
+ * 
+ * @author Conor MacNeill
+ */
+public class NameAndTypeCPInfo extends ConstantPoolEntry {
+
+    /**
+     * Constructor.
+     * 
+     */
+    public NameAndTypeCPInfo() {
+        super(CONSTANT_NameAndType, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        nameIndex = cpStream.readUnsignedShort();
+        descriptorIndex = cpStream.readUnsignedShort();
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        String value;
+
+        if (isResolved()) {
+            value = "Name = " + name + ", type = " + type;
+        } else {
+            value = "Name index = " + nameIndex + ", descriptor index = " + descriptorIndex;
+        } 
+
+        return value;
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        name = ((Utf8CPInfo) constantPool.getEntry(nameIndex)).getValue();
+        type = ((Utf8CPInfo) constantPool.getEntry(descriptorIndex)).getValue();
+
+        super.resolve(constantPool);
+    } 
+
+    public String getName() {
+        return name;
+    } 
+
+    public String getType() {
+        return type;
+    } 
+
+    private String name;
+    private String type;
+    private int    nameIndex;
+    private int    descriptorIndex;
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/StringCPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/StringCPInfo.java
new file mode 100644
index 0000000..e9b01cb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/StringCPInfo.java
@@ -0,0 +1,113 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A String Constant Pool Entry.
+ * 
+ * The String info contains an index into the constant pool where
+ * a UTF8 string is stored.
+ * 
+ * @author Conor MacNeill
+ */
+public class StringCPInfo extends ConstantCPInfo {
+
+    /**
+     * Constructor.
+     * 
+     */
+    public StringCPInfo() {
+        super(CONSTANT_String, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        index = cpStream.readUnsignedShort();
+
+        setValue("unresolved");
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "String Constant Pool Entry for " + getValue() + "[" + index + "]";
+    } 
+
+    /**
+     * Resolve this constant pool entry with respect to its dependents in
+     * the constant pool.
+     * 
+     * @param constantPool the constant pool of which this entry is a member
+     * and against which this entry is to be resolved.
+     */
+    public void resolve(ConstantPool constantPool) {
+        setValue(((Utf8CPInfo) constantPool.getEntry(index)).getValue());
+        super.resolve(constantPool);
+    } 
+
+    private int index;
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/Utf8CPInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/Utf8CPInfo.java
new file mode 100644
index 0000000..e424c44
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/depend/constantpool/Utf8CPInfo.java
@@ -0,0 +1,100 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.depend.constantpool;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * A UTF8 Constant Pool Entry.
+ * 
+ * @author Conor MacNeill
+ */
+public class Utf8CPInfo extends ConstantPoolEntry {
+    private String value;
+
+    /**
+     * Constructor.
+     * 
+     */
+    public Utf8CPInfo() {
+        super(CONSTANT_Utf8, 1);
+    }
+
+    /**
+     * read a constant pool entry from a class stream.
+     * 
+     * @param cpStream the DataInputStream which contains the constant pool entry to be read.
+     * 
+     * @throws IOException if there is a problem reading the entry from the stream.
+     */
+    public void read(DataInputStream cpStream) throws IOException {
+        value = cpStream.readUTF();
+    } 
+
+    /**
+     * Print a readable version of the constant pool entry.
+     * 
+     * @return the string representation of this constant pool entry.
+     */
+    public String toString() {
+        return "UTF8 Value = " + value;
+    } 
+
+    public String getValue() {
+        return value;
+    } 
+
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/CSharp.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/CSharp.java
new file mode 100644
index 0000000..d0cc826
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/CSharp.java
@@ -0,0 +1,781 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+/* build notes
+
+    -The reference CD to listen to while editing this file is 
+        nap: Underworld  - Everything, Everything
+    -variable naming policy from Fowler's refactoring book.
+    -tested against the PDC pre-beta of csc.exe; future versions will 
+     inevitably change things
+*/
+
+// ====================================================================
+// place in the optional ant tasks package
+// but in its own dotnet group
+// ====================================================================
+
+package org.apache.tools.ant.taskdefs.optional.dotnet;
+
+// ====================================================================
+// imports
+// ====================================================================
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+import java.io.*;
+
+
+// ====================================================================
+/**
+This task compiles CSharp source into executables or modules.
+The task will only work on win2K until other platforms support csc.exe or 
+an equivalent. CSC.exe must be on the execute path too.
+
+<p>
+All parameters are optional: &lt;csc/&gt; should suffice to produce a debug
+build of all *.cs files. References to external files do require explicit 
+enumeration, so are one of the first attributes to consider adding. 
+
+<p>
+
+The task is a directory based task, so attributes like <b>includes="*.cs"</b> and 
+<b>excludes="broken.cs"</b> can be used to control the files pulled in. By default, 
+all *.cs files from the project folder down are included in the command. 
+When this happens the output file -if not specified-
+is taken as the first file in the list, which may be somewhat hard to control.
+Specifying the output file with <b>'outfile'</b> seems prudent. 
+
+<p>
+
+
+<p>
+TODO
+<ol>
+    <li>is incremental build still broken in beta-1?
+    <li>is Win32Icon broken?
+    <li>all the missing options
+</ol>
+<p>
+History
+    <Table>
+    <tr><td>0.3</td>
+        <td> Beta 1 edition </td>
+        <td> To avoid having to remember which assemblies to include, 
+        the task automatically refers to the main dotnet libraries in Beta1.
+        
+    </tr>    <tr><td>0.2</td>
+        <td> Slightly different</td>
+        <td> Split command execution to a separate class; 
+    </tr>
+    <tr><td>0.1</td>
+        <td> "I can't believe it's so rudimentary"</td>
+        <td>  First pass; minimal builds only support; 
+    </tr>
+
+    </table>
+@version 0.3
+@author Steve Loughran steve_l@iseran.com
+
+ */
+
+public class CSharp 
+    extends org.apache.tools.ant.taskdefs.MatchingTask {
+
+    /** constructor inits everything and set up the search pattern
+    */
+    
+    public CSharp () {
+        Clear();
+        setIncludes(csc_file_pattern);
+    }
+    
+    /** name of the executable. the .exe suffix is deliberately not included 
+     * in anticipation of the unix version
+     */
+    protected static final String csc_exe_name="csc";
+    
+    /** what is the file extension we search on?
+     */
+    protected static final String csc_file_ext="cs";
+    
+    /** derive the search pattern from the extension 
+     */
+    protected static final String csc_file_pattern="**/*."+csc_file_ext;
+    
+    /** list of reference classes. (pretty much a classpath equivalent)
+     */
+    protected  String _references;
+    
+    /**
+     *  Set the reference list to be used for this compilation. 
+     *
+     * @param  s  The new References value 
+     */
+    public void setReferences(String s) {
+        _references=s;
+    }
+    
+    /**
+     *  get the reference string or null for no argument needed 
+     *
+     * @return    The References Parameter to CSC 
+     */
+    protected String getReferencesParameter() {
+        //bail on no references
+        if (notEmpty(_references)) 
+            return "/reference:"+_references;
+        else
+            return null;
+    }
+                
+    /**
+     using the path approach didnt work as it could not handle the implicit
+     execution path. Perhaps that could be extracted from the runtime and then
+     the path approach would be viable
+    */
+    protected  Path _referenceFiles;
+    
+    /**
+     * add another path to the reference file path list
+     * @param path another path to append
+     */
+    public void setReferenceFiles(Path path) {
+        //demand create pathlist
+        if(_referenceFiles==null)
+                _referenceFiles=new Path(this.project);
+        _referenceFiles.append(path);
+    }
+    
+    /**
+     turn the path list into a list of files and a /references argument
+     @return null or a string of references.
+    */ 
+    protected String getReferenceFilesParameter() {
+        //bail on no references
+        if (_references==null)
+            return null;
+        //iterate through the ref list & generate an entry for each
+        //or just rely on the fact that the toString operator does this, but
+        //noting that the separator is ';' on windows, ':' on unix
+        String refpath=_references.toString();
+    
+        //bail on no references listed
+        if (refpath.length()==0)
+            return null;
+        
+        StringBuffer s=new StringBuffer("/reference:");
+        s.append(refpath);
+        return new String(s);
+    }   
+    
+    /** 
+     * C# is really dumb in how it handles inclusion. You have to list
+     * every 'assembly' -read DLL that is imported. So already you are
+     * making a platform assumption -shared libraries have a .dll extension
+     * and the poor developer has to know every library which is included
+     * why the compiler cant find classes on the path or in a directory,
+     * is a mystery.
+     *
+     * To reduce the need to be explicit, here is a long list of 
+     * the core libraries used in Beta-1 of .NET
+     * ommitting the blatantly non portable (MS.win32.interop)
+     * and the .designer libraries. (ripping out Com was tempting)
+     * Casing is chosen to match that of the file system <i>exactly</i>
+     * so may work on a unix box too. 
+     */
+    protected static final String DEFAULT_REFERENCE_LIST
+        ="System.dll;System.Drawing.dll;System.Data.dll;"+
+         "System.Diagnostics.dll;"+
+         "System.DirectoryServices.dll;"+
+         "System.IO.dll;"+
+         "System.Management.dll;"+
+         "System.Messaging.dll;"+
+         "System.Net.dll;"+
+         "System.Runtime.Remoting.dll;"+
+         "System.Runtime.Serialization.Formatters.Soap.dll;"+
+         "System.Security.dll;"+
+         "System.ServiceProcess.dll;"+
+         "System.Text.RegularExpressions.dll;"+
+         "System.Timers.dll;"+
+         "System.Web.dll;"+
+         "System.Web.Services.dll;"+
+         "System.WinForms.dll;"+
+         "System.XML.dll;"+
+         "System.XML.Serialization.dll;"+
+         "Microsoft.ComServices.dll;";
+    
+    /** 
+     * get default reference list
+     * @return null or a string of references.
+    */ 
+    protected String getDefaultReferenceParameter() {
+        if(_includeDefaultReferences) {
+            StringBuffer s=new StringBuffer("/reference:");
+            s.append(DEFAULT_REFERENCE_LIST);
+            return new String(s);
+        }
+        else
+            return null;            
+    }
+     
+     /** flag to enable automatic reference inclusion
+      *
+     */
+     protected boolean _includeDefaultReferences;
+
+    /** set the automatic reference inclusion flag on or off
+     *  this flag controls the string of references and the 
+     *  /nostdlib option in CSC
+    @param f on/off flag
+    */
+    public void setIncludeDefaultReferences(boolean f) {
+        _includeDefaultReferences=f;
+    }
+    
+    /** query the optimise flag
+    @return true if optimise is turned on
+     */
+    public boolean getIncludeDefaultReferences() {
+        return _includeDefaultReferences;
+    }
+    
+    /**
+     *  get the include default references flag or null for no argument needed 
+     *
+     * @return    The Parameter to CSC 
+     */
+    protected String getIncludeDefaultReferencesParameter() {
+        return "/nostdlib"+(_includeDefaultReferences?"-":"+");
+    }    
+    
+    /** optimise flag
+     */
+    protected boolean _optimize;
+    
+    /** set the optimise flag on or off
+    @param f on/off flag
+    */
+    public void setOptimize(boolean f) {
+        _optimize=f;
+    }
+    
+    /** query the optimise flag
+    @return true if optimise is turned on
+     */
+    public boolean getOptimize() {
+        return _optimize;
+    }
+    
+    /**
+     *  get the optimise flag or null for no argument needed 
+     *
+     * @return    The Optimize Parameter to CSC 
+     */
+    protected String getOptimizeParameter() {
+        return "/optimize"+(_optimize?"+":"-");
+    }   
+        
+    /** incremental build flag */
+    protected boolean _incremental;
+    
+    /** set the incremental compilation flag on or off
+     * @param f on/off flag
+     */
+    public void setIncremental(boolean f){
+        _incremental=f;
+    }
+    
+    /** query the incrementalflag
+     * @return true iff incremental compilation is turned on
+     */
+    public boolean getIncremental() {
+        return _incremental;
+    }
+    
+    /**
+     *  get the incremental build argument
+     *
+     * @return    The Incremental Parameter to CSC 
+     */
+    protected String getIncrementalParameter() {
+        return "/incremental"+(_incremental?"+":"-");
+    }   
+    
+    /** debug flag. Controls generation of debug information. 
+     */
+    protected boolean _debug;
+    
+    /** set the debug flag on or off
+     * @param f on/off flag
+     */
+    public void setDebug(boolean f) {
+        _debug=f;
+    }
+        
+    /** query the debug flag
+     * @return true if debug is turned on
+     */
+    public boolean getDebug() {
+        return _debug;
+    }
+    
+    /**
+     *  get the debug switch argument  
+     *
+     * @return    The Debug Parameter to CSC 
+     */
+    protected String getDebugParameter() {
+        return "/debug"+(_debug?"+":"-");
+    }   
+    
+    /** output XML documentation flag
+    */  
+    protected File _docFile;
+        
+    /** file for generated XML documentation
+     * @param f output file
+     */
+    public void setDocFile(String f) {
+        _docFile=project.resolveFile(f);
+    }
+            
+    /** get the argument or null for no argument needed
+     * @return    The DocFile Parameter to CSC 
+     */
+    protected String getDocFileParameter() {
+        if (_docFile!=null)
+            return "/doc:"+_docFile.toString();
+        else
+            return null;
+    }   
+        
+    /** warning level: 0-4, with 4 being most verbose
+    */
+    private int _warnLevel;
+    
+    /** set warn level (no range checking)
+     * @param warnLevel warn level -see .net docs for valid range (probably 0-4)
+    */
+    public void setWarnLevel(int warnLevel)
+        {this._warnLevel=warnLevel;}
+    
+    /** query warn level
+     * @return current value
+    */
+    public int getWarnLevel()
+        {return _warnLevel;}
+    
+    /**
+     *  get the warn level switch 
+     *
+     * @return    The WarnLevel Parameter to CSC 
+     */
+    protected String getWarnLevelParameter() {
+        return "/warn:"+_warnLevel;
+    }   
+    
+    /** enable unsafe code flag. Clearly set to false by default
+     */
+    protected boolean _unsafe;
+    
+    /**
+     *  Sets the Unsafe attribute 
+     *
+     * @param  unsafe  The new Unsafe value 
+     */
+    public void setUnsafe(boolean unsafe)
+        {this._unsafe=unsafe;}
+    
+    /**
+     *  query the Unsafe attribute 
+     *
+     * @return    The Unsafe value 
+     */
+    public boolean getUnsafe()
+        {return this._unsafe;}
+    
+    /** get the argument or null for no argument needed
+     * @return    The Unsafe Parameter to CSC 
+    */
+    protected String getUnsafeParameter(){
+        return _unsafe?"/unsafe":null;
+    }   
+        
+    /** main class (or null for automatic choice)
+     */
+    protected String _mainClass;
+    
+    /**
+     *  Sets the MainClass attribute
+     *
+     * @param  mainClass  The new MainClass value 
+     */
+    public void setMainClass(String mainClass)
+        {this._mainClass=mainClass;}
+    
+    /**
+     *  Gets the MainClass attribute 
+     *
+     * @return    The MainClass value 
+     */
+    public String getMainClass()
+        {return this._mainClass;}
+    
+    /**
+     *  get the /main argument or null for no argument needed 
+     *
+     * @return    The MainClass Parameter to CSC 
+     */
+    protected String getMainClassParameter(){
+        if (_mainClass!=null && _mainClass.length()!=0)
+            return "/main:"+_mainClass;
+        else
+            return null;
+    } 
+    
+    /** any extra command options?
+     */
+    protected String _extraOptions;
+    
+    /**
+     *  Sets the ExtraOptions attribute
+     *
+     * @param  extraOptions  The new ExtraOptions value 
+     */
+    public void setExtraOptions(String extraOptions)
+        {this._extraOptions=extraOptions;}
+    
+    /**
+     *  Gets the ExtraOptions attribute 
+     *
+     * @return    The ExtraOptions value 
+     */
+    public String getExtraOptions()
+        {return this._extraOptions;}
+    
+    /**
+     *  get any extra options or null for no argument needed 
+     *
+     * @return    The ExtraOptions Parameter to CSC 
+     */
+    protected String getExtraOptionsParameter() {
+        if (_extraOptions!=null && _extraOptions.length()!=0)
+            return _extraOptions;
+        else
+            return null;
+    } 
+    
+    /** source directory upon which the search pattern is applied
+     */
+    private File _srcDir;
+    
+    /**
+     * Set the source dir to find the files to be compiled
+     * @param  srcDirName  The new SrcDir value 
+     */
+    public void setSrcDir(String srcDirName){
+        _srcDir = project.resolveFile(srcDirName);
+    }
+    
+    /** destination directory (null means use the source directory)
+    * NB: this is currently not used 
+    */
+    private File _destDir;
+    
+    /**
+     * Set the destination dir to find the files to be compiled
+     * @param  dirName  The new DestDir value 
+     */
+    public void setDestDir(String dirName) {
+        _destDir = project.resolveFile(dirName);
+    }
+    
+    /** type of target. Should be one of exe|library|module|winexe|(null)
+    default is exe; the actual value (if not null) is fed to the command line.
+    <br>See /target
+     */
+    protected String _targetType;
+    
+    /** define the target
+     * @param  targetType          The new TargetType value 
+     * @exception  BuildException  if target is not one of exe|library|module|winexe 
+     */
+    public void setTargetType(String targetType)
+        throws  BuildException {
+        targetType=targetType.toLowerCase();
+        if(targetType.equals("exe") || targetType.equals("library") ||
+            targetType.equals("module") ||targetType.equals("winexe") ) {
+            _targetType=targetType; 
+        }
+        else 
+            throw new BuildException("targetType " +targetType+" is not a valid type");
+    }
+    
+    /**
+     *  Gets the TargetType attribute  
+     *
+     * @return    The TargetType value 
+     */
+    public String getTargetType() { 
+            return _targetType;
+    }   
+    
+    /**
+     *  get the argument or null for no argument needed 
+     *
+     * @return    The TargetType Parameter to CSC 
+     */
+    protected String getTargetTypeParameter() {
+        if (notEmpty(_targetType)) 
+            return "/target:"+_targetType;
+        else
+            return null;
+    }   
+    
+    /** icon for incorporation into apps
+     */     
+    protected File _win32icon;  
+    
+    /**
+     * Set the win32 icon 
+     * @param fileName path to the file. Can be relative, absolute, whatever.
+     */
+    public void setWin32Icon(String fileName) {
+        _win32icon = project.resolveFile(fileName);
+    }
+    
+    /**
+     *  get the argument or null for no argument needed 
+     *
+     * @return    The Win32Icon Parameter to CSC 
+     */
+    protected String getWin32IconParameter() {
+        if (_win32icon!=null)
+            return "/win32icon:"+_win32icon.toString();
+        else
+            return null;
+    }
+    
+    /** defines list
+    * something like 'RELEASE;WIN32;NO_SANITY_CHECKS;;SOMETHING_ELSE'
+    */
+    String _definitions;
+    
+    /**
+     * Set the definitions
+     * @param list of definitions split by ; or , or even :
+     */
+    public void setDefinitions(String params) {
+        _definitions=params;
+    }
+      
+    /**
+    *  get the argument or null for no argument needed 
+    *
+    * @return    The Definitions Parameter to CSC 
+    */
+    protected String getDefinitionsParameter() {
+        if (notEmpty(_definitions))
+            return "/define:" + _definitions;
+        else
+            return null;
+    }
+    
+    /** list of extra modules to refer to 
+     *
+    */    
+    String _additionalModules;
+    
+    /**
+     * Set the definitions
+     * @param list of definitions split by ; or , or even :
+     */
+    public void setAdditionalModules(String params) {
+        _additionalModules=params;
+    }
+    
+    /** get the argument or null for no argument needed
+    * @return    The AdditionalModules Parameter to CSC 
+     */
+    protected String getAdditionalModulesParameter() {
+        if (notEmpty(_additionalModules)) 
+            return "/addmodule:" + _additionalModules;
+        else 
+            return null;
+    }
+    
+    /** output file. If not supplied this is derived from the
+     *  source file
+     */    
+    protected String _outputFile;
+    
+    /**
+     * Set the definitions
+     * @param list of definitions split by ; or , or even :
+     */
+    public void setOutputFile(String params) {
+        _outputFile=params;
+    }
+    
+    /** get the argument or null for no argument needed
+    * @return    The OutputFile Parameter to CSC 
+    */
+    protected String getOutputFileParameter() {
+        if (notEmpty(_outputFile)) {
+            File f=project.resolveFile(_outputFile);
+            return "/out:"+f.toString();
+        }
+        else            
+            return null;
+    }
+    
+    /** flag to control action on execution trouble
+    */
+    protected boolean _failOnError;
+    
+    /**set fail on error flag
+    * @param  b  The new FailOnError value 
+    */
+    public void setFailOnError(boolean b){
+        _failOnError=b;
+    }
+    
+    /** query fail on error flag
+     * @return    The FailFailOnError value 
+    */
+    public boolean getFailFailOnError() {
+            return _failOnError;
+    }
+    
+    /** reset all contents. 
+    */
+    public void Clear() {
+        _targetType=null;
+        _win32icon=null;
+        _srcDir=null;
+        _destDir=null;
+        _mainClass=null;
+        _unsafe=false;
+        _warnLevel=3;
+        _docFile = null;
+        _incremental=false;
+        _optimize=false;
+        _debug=true;
+        _references=null;
+        _failOnError=true;
+        _definitions=null;
+        _additionalModules=null;
+        _includeDefaultReferences=true;
+        _extraOptions=null;
+    }
+    
+    /**
+     *  test for a string containing something useful 
+     *
+     * @param  s  string in 
+     * @return    true if the argument is not null or empty 
+     */
+    protected boolean notEmpty(String s) {
+        return s != null && s.length() != 0;
+    }
+    
+    /** do the work by building the command line and then calling it
+    */
+    public void execute() 
+        throws BuildException {
+        if (_srcDir == null)
+            _srcDir=project.resolveFile(".");
+    
+        NetCommand command=new NetCommand(this,"CSC",csc_exe_name);
+        command.setFailOnError(getFailFailOnError());
+        //DEBUG helper
+        command.setTraceCommandLine(true);
+        //fill in args
+        command.addArgument("/nologo");
+        command.addArgument(getAdditionalModulesParameter());
+        command.addArgument(getDefinitionsParameter());
+        command.addArgument(getDebugParameter());
+        command.addArgument(getDocFileParameter());
+        command.addArgument(getIncrementalParameter());
+        command.addArgument(getMainClassParameter());
+        command.addArgument(getOptimizeParameter());
+        command.addArgument(getReferencesParameter());
+        command.addArgument(getTargetTypeParameter());
+        command.addArgument(getUnsafeParameter());
+        command.addArgument(getWarnLevelParameter());
+        command.addArgument(getWin32IconParameter());
+        command.addArgument(getOutputFileParameter());   
+        command.addArgument(getIncludeDefaultReferencesParameter());
+        command.addArgument(getDefaultReferenceParameter());
+        command.addArgument(getExtraOptionsParameter());
+    
+        //get dependencies list. 
+        DirectoryScanner scanner = super.getDirectoryScanner(_srcDir);
+        String[] dependencies = scanner.getIncludedFiles();
+        log("compiling "+dependencies.length+" file"+((dependencies.length==1)?"":"s"));
+        String baseDir=scanner.getBasedir().toString();
+        //add to the command
+        for (int i = 0; i < dependencies.length; i++) {
+            String targetFile=dependencies[i];
+            targetFile=baseDir+File.separator+targetFile;
+            command.addArgument(targetFile);
+        }
+        
+        //now run the command of exe + settings + files
+        command.runCommand();
+    } // end execute
+    
+} //end class
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/Ilasm.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/Ilasm.java
new file mode 100644
index 0000000..e8b0a86
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/Ilasm.java
@@ -0,0 +1,465 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+/* build notes
+
+   -The reference CD to listen to while editing this file is 
+       nap: Underworld  - Everything, Everything
+   -variable naming policy from Fowler's refactoring book.
+   -tested against the PDC pre-beta of csc.exe; future versions will 
+    inevitably change things
+*/
+
+// ====================================================================
+// place in the optional ant tasks package
+// but in its own dotnet group
+// ====================================================================
+
+package org.apache.tools.ant.taskdefs.optional.dotnet;
+
+// ====================================================================
+// imports
+// ====================================================================
+
+import java.io.*;
+import java.text.*;
+import java.util.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+
+/**
+Task to assemble .net 'Intermediate Language' files.
+The task will only work on win2K until other platforms support csc.exe or 
+an equivalent. ilasm.exe must be on the execute path too.
+<p>
+
+<p>
+All parameters are optional: &lt;il/&gt; should suffice to produce a debug
+build of all *.il files.
+The option set is roughly compatible with the CSharp class;
+even though the command line options are only vaguely
+equivalent. [The low level commands take things like /OUT=file,
+csc wants /out:file ... /verbose is used some places; /quiet here in
+ildasm... etc.] It would be nice if someone made all the command line
+tools consistent (and not as brittle as the java cmdline tools) 
+
+
+<p>
+
+The task is a directory based task, so attributes like <b>includes="*.il"</b> and 
+<b>excludes="broken.il"</b> can be used to control the files pulled in. 
+Each file is built on its own, producing an appropriately named output file unless
+manually specified with <b>outfile</b>
+
+
+@author Steve Loughran steve_l@iseran.com
+@version 0.2
+ */
+
+
+public class Ilasm
+    extends org.apache.tools.ant.taskdefs.MatchingTask {
+
+    /** constructor inits everything and set up the search pattern
+    */
+    public Ilasm () {
+        Clear();
+        setIncludes(file_pattern);
+    }
+
+    /** name of the executable. the .exe suffix is deliberately not included 
+     * in anticipation of the unix version
+     */
+    protected static final String exe_name="ilasm";
+    
+    /** what is the file extension we search on?
+     */
+    protected static final String file_ext="il";
+    
+    /** and now derive the search pattern from the extension 
+     */
+    protected static final String file_pattern="**/*."+file_ext;
+    
+    /** title of task for external presentation
+     */
+    protected static final String exe_title="ilasm";
+    
+    /** reset all contents. 
+    */
+    public void Clear() {
+        _targetType=null;
+        _srcDir=null;
+        _listing = false;
+        _verbose=false;
+        _debug=true;
+        _owner=null;
+        _outputFile=null;
+        _failOnError=true;
+        _resourceFile=null;
+        _owner=null;
+        _extraOptions=null;     
+    }
+
+    /** source directory upon which the search pattern is applied
+     */
+    private File _srcDir;
+    
+    /**
+     * Set the source dir to find the files to be compiled
+     * @param  srcDirName  The new SrcDir value 
+     */
+    public void setSrcDir(String srcDirName){
+        _srcDir = project.resolveFile(srcDirName);
+    }
+    
+
+    /** type of target. Should be one of exe|library|module|winexe|(null)
+    default is exe; the actual value (if not null) is fed to the command line.
+    <br>See /target
+     */
+    protected String _targetType;
+    
+    /** define the target
+     * @param  targetType          one of exe|library|
+     * @exception BuildException if target is not one of exe|library|module|winexe 
+     */
+    
+    public void setTargetType(String targetType)
+        throws  BuildException {
+        targetType=targetType.toLowerCase();
+        if(targetType.equals("exe") || targetType.equals("library")) {
+            _targetType=targetType; 
+        }
+        else 
+            throw new BuildException("targetType " +targetType+" is not a valid type");
+    }
+
+    /**
+     * accessor method for target type
+     * @return the current target option
+     */
+    public String getTargetType() { 
+        return _targetType;
+    }   
+    
+    /** g
+     *  get the target type or null for no argument needed 
+     *
+     * @return    The TargetTypeParameter value 
+    */
+
+    protected String getTargetTypeParameter() {
+        if(!notEmpty(_targetType))
+            return null;
+        if (_targetType.equals("exe"))
+            return "/exe";
+        else 
+        if (_targetType.equals("library"))
+            return "/dll";
+        else
+            return null;
+    }   
+        
+    /** owner string is a slightly trivial barrier to disassembly
+    */
+    
+    protected String _owner;
+    
+    /**
+     *  Sets the Owner attribute 
+     *
+     * @param  s  The new Owner value 
+     */
+    
+    public void setOwner(String s) {
+        _owner=s;
+        }
+    
+    /**
+     *  Gets the Owner switch for ilasm
+     *
+     * @return    The Owner string
+     */    
+    protected String getOwnerParameter() {
+        if(notEmpty(_owner))
+            return "/owner="+_owner;
+        else 
+            return null;
+    }
+        
+    /** test for a string containing something useful
+     * @param string to test
+     * @returns true if the argument is not null or empty
+    */
+    protected boolean notEmpty(String s)
+        {return s!=null && s.length()!=0;}
+    
+    /** verbose flag
+     */
+    protected boolean _verbose;
+
+    /** 
+     * enable/disable verbose ILASM output
+     * @param b flag set to true for verbose on
+     */
+    public void setVerbose(boolean b) {
+        _verbose=b;
+    }
+    
+    /** 
+     * turn the verbose flag into a parameter for ILASM
+     * @return null or the appropriate command line string
+     */
+    protected String getVerboseParameter() {
+        return _verbose?null:"/quiet";
+    }   
+    
+        
+    /** listing flag
+     */
+         
+    protected boolean _listing;
+
+    /** 
+     * enable/disable listing
+     * @param b flag set to true for listing on
+     */
+    public void setListing(boolean b) {
+        _listing=b;
+    }
+    
+    /** 
+     * turn the listing flag into a parameter for ILASM
+     * @return the appropriate string from the state of the listing flag
+     */
+    protected String getListingParameter() {
+        return _listing?"/listing":"/nolisting";
+    }
+       
+    
+    /**
+     * output file. If not supplied this is derived from the
+     *  source file
+     */
+     
+    protected String _outputFile;
+    
+    /**
+     * Set the definitions
+     * @param list of definitions split by ; or , or even :
+     */
+    public void setOutputFile(String params) {
+        _outputFile=params;
+    }
+    
+    /**
+     * get the output file 
+     * @return the argument string or null for no argument
+    */
+    protected String getOutputFileParameter() {
+        if (_outputFile==null || _outputFile.length()==0)
+            return null;
+        File f=project.resolveFile(_outputFile);
+        return "/output="+f.toString();
+    }
+    
+    /** resource file (.res format) to include in the app. 
+     */
+    protected File _resourceFile;
+    
+    /**
+     * Set the resource file 
+     * @param fileName path to the file. Can be relative, absolute, whatever.
+     */public void setResourceFile(String fileName) {
+        _resourceFile = project.resolveFile(fileName);
+    }
+        
+    protected String getResourceFileParameter() {
+        if(_resourceFile!=null) {
+            return "/resource="+_resourceFile.toString();
+        }
+        else {
+            return null;
+        }
+    }
+    
+    /** flag to control action on execution trouble
+    */
+    protected boolean _failOnError;
+    
+    /**set fail on error flag
+    */
+    public void setFailOnError(boolean b){
+        _failOnError=b;
+    }
+    
+    /** query fail on error flag
+    */
+    public boolean getFailFailOnError() {
+        return _failOnError;
+    }
+        
+    /** debug flag. Controls generation of debug information. 
+     */
+    protected boolean _debug;
+    
+    /** set the debug flag on or off
+     * @param f on/off flag
+     */
+    public void setDebug(boolean f)
+        {_debug=f;}
+        
+    /** query the debug flag
+     * @return true if debug is turned on
+     */
+    public boolean getDebug() {
+        return _debug;
+    }
+    
+    /** get the argument or null for no argument needed
+    */
+    protected String getDebugParameter() {
+        return _debug?"/debug":null;
+    }   
+
+    /** any extra command options?
+     */
+    protected String _extraOptions;
+    
+    /**
+     *  Sets the ExtraOptions attribute
+     *
+     * @param  extraOptions  The new ExtraOptions value 
+     */
+    public void setExtraOptions(String extraOptions)
+        {this._extraOptions=extraOptions;}
+    
+    /**
+     *  Gets the ExtraOptions attribute 
+     *
+     * @return    The ExtraOptions value 
+     */
+    public String getExtraOptions()
+        {return this._extraOptions;}
+    
+    /**
+     *  get any extra options or null for no argument needed 
+     *
+     * @return    The ExtraOptions Parameter to CSC 
+     */
+    protected String getExtraOptionsParameter() {
+        if (_extraOptions!=null && _extraOptions.length()!=0)
+            return _extraOptions;
+        else
+            return null;
+    } 
+
+        
+    /** This is the execution entry point. Build a list of files and
+     *  call ilasm on each of them.
+     * @throws BuildException if the assembly failed and FailOnError is true
+     */
+    public void execute() 
+        throws BuildException {
+        if (_srcDir == null)
+                _srcDir=project.resolveFile(".");
+    
+        //get dependencies list. 
+        DirectoryScanner scanner = super.getDirectoryScanner(_srcDir);
+        String[] dependencies = scanner.getIncludedFiles();
+        log("assembling "+dependencies.length+" file"+((dependencies.length==1)?"":"s"));
+        String baseDir=scanner.getBasedir().toString();
+        //add to the command
+        for (int i = 0; i < dependencies.length; i++) {
+            String targetFile=dependencies[i];
+            targetFile=baseDir+File.separator+targetFile;
+            executeOneFile(targetFile);
+        }
+        
+    } // end execute
+    
+        
+    /**
+     * do the work for one file by building the command line then calling it
+     * @param targetFile name of the the file to assemble
+     * @throws BuildException if the assembly failed and FailOnError is true
+     */
+    public void executeOneFile(String targetFile) 
+        throws BuildException {
+        NetCommand command=new NetCommand(this,exe_title,exe_name);
+        command.setFailOnError(getFailFailOnError());
+        //DEBUG helper
+        command.setTraceCommandLine(true);
+        //fill in args
+        command.addArgument(getDebugParameter());
+        command.addArgument(getTargetTypeParameter());
+        command.addArgument(getListingParameter());
+        command.addArgument(getOutputFileParameter());   
+        command.addArgument(getOwnerParameter());
+        command.addArgument(getResourceFileParameter());
+        command.addArgument(getVerboseParameter());
+        command.addArgument(getExtraOptionsParameter());
+ 
+
+        /* space for more argumentativeness
+           command.addArgument();
+           command.addArgument();
+        */
+    
+        command.addArgument(targetFile);
+        //now run the command of exe + settings + file
+        command.runCommand();
+    } // end executeOneFile
+} //class
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/NetCommand.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/NetCommand.java
new file mode 100644
index 0000000..bef6d7c
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/dotnet/NetCommand.java
@@ -0,0 +1,223 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+/* build notes
+
+The reference CD to listen to while editing this file is
+Underworld Everything, Everything
+variable naming policy from Fowler's refactoring book.
+ */
+
+// place below the optional ant tasks package
+
+package org.apache.tools.ant.taskdefs.optional.dotnet;
+
+// imports
+
+import java.io.*;
+import java.text.*;
+import java.util.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+
+
+/**
+This is a helper class to spawn net commands out. 
+In its initial form it contains no .net specifics, just contains
+all the command line/exe construction stuff. However, it may be handy in future
+to have a means of setting the path to point to the dotnet bin directory; in which
+case the shared code should go in here.
+@author Steve Loughran steve_l@iseran.com
+@created 2000-11-01
+@version 0.3
+ */
+
+public class NetCommand {
+    
+    /** constructor
+    @param owning task
+    @param title (for logging/errors)
+    @param executable. Leave off the '.exe. for future portability
+    */
+    
+    public NetCommand(Task owner, String title, String program) {
+        _owner=owner;
+        _title=title;
+        _program=program;
+        _commandLine=new Commandline();
+        _commandLine.setExecutable(_program);
+        prepareExecutor();
+        }
+    
+    /** owner project
+     */
+    protected Task _owner;
+    
+    /** executabe
+     */
+    protected Execute _exe;
+    
+    /** what is the command line
+     */
+    protected Commandline _commandLine;
+    
+    /** title of the command
+     */
+    protected String _title;
+    
+    /** actual program to invoke
+     */
+    protected String _program;
+    
+    /** trace flag
+     */
+    protected boolean _traceCommandLine=false;
+    
+    /**
+     * turn tracing on or off
+     * @param b trace flag
+     */
+    public void setTraceCommandLine(boolean b){
+        _traceCommandLine=b;
+    }
+    
+    /** flag to control action on execution trouble
+    */
+    protected boolean _failOnError;
+    
+    /**
+     * set fail on error flag
+     * @param b fail flag -set to true to cause an exception to be raised if
+     * the return value != 0
+     */
+    public void setFailOnError(boolean b){
+        _failOnError=b;
+    }
+    
+    /** query fail on error flag
+    */
+    public boolean getFailFailOnError() {
+        return _failOnError;
+    }
+    
+    /** 
+     * verbose text log
+     * @param msg string to add to log iff verbose is defined for the build
+     */
+    protected void logVerbose(String msg){
+        _owner.getProject().log(msg,Project.MSG_VERBOSE);
+        }
+    
+    
+    /**
+     * error text log
+     * @param  msg  message to display as an error
+     */
+    protected void logError(String msg) {
+        _owner.getProject().log(msg,Project.MSG_ERR);
+    }
+    
+    /**
+     * add an argument to a command line; do nothing if the arg is null or empty string
+     * @param  argument  The feature to be added to the Argument attribute 
+     */
+    public void addArgument(String argument){
+        if(argument!=null && argument.length()!=0) {
+            _commandLine.createArgument().setValue(argument);
+        }
+    }
+    
+    /**
+     * set up the command sequence..
+     */
+    protected void prepareExecutor() {
+        // default directory to the project's base directory
+        File dir = _owner.getProject().getBaseDir();
+        ExecuteStreamHandler handler=new LogStreamHandler(_owner,
+                   Project.MSG_INFO, Project.MSG_WARN);
+        _exe = new Execute(handler, null);
+        _exe.setAntRun(_owner.getProject());
+        _exe.setWorkingDirectory(dir);
+    }
+    
+    /**
+     * Run the command using the given Execute instance.
+     * @throws an exception of something goes wrong and the failOnError flag is true
+     */
+    public void runCommand()
+        throws BuildException {
+        int err = -1; // assume the worst
+        try {
+            if(_traceCommandLine) {
+                _owner.log(_commandLine.toString());
+            }
+            else {
+                //in verbose mode we always log stuff
+                logVerbose(_commandLine.toString());
+            }
+            _exe.setCommandline(_commandLine.getCommandline());
+            err = _exe.execute();
+            if (err != 0) {
+                if (_failOnError) {
+                    throw new BuildException(_title+" returned: "+err, _owner.getLocation());
+                } else {
+                    _owner.log(_title+"  Result: " + err, Project.MSG_ERR);
+                }
+            }
+        } catch (IOException e) {
+            throw new BuildException(_title+" failed: " + e, e, _owner.getLocation());
+        }
+    }
+} //class
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreator.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreator.java
index 5986cac..ff2ff8b 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreator.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreator.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -53,11 +53,9 @@
  */
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.DirectoryScanner;
-import org.apache.tools.ant.Project;
+import org.apache.tools.ant.*;
 import org.apache.tools.ant.taskdefs.*;
-import org.apache.tools.ant.types.Path;
+import org.apache.tools.ant.types.*;
 
 import java.io.File;
 
@@ -126,9 +124,11 @@ public class DDCreator extends MatchingTask {
         String systemClassPath = System.getProperty("java.class.path");
         String execClassPath = project.translatePath(systemClassPath + ":" + classpath);
         Java ddCreatorTask = (Java)project.createTask("java");
+        ddCreatorTask.setTaskName(getTaskName());
         ddCreatorTask.setFork(true);
         ddCreatorTask.setClassname("org.apache.tools.ant.taskdefs.optional.ejb.DDCreatorHelper");
-        ddCreatorTask.setArgs(args);
+        Commandline.Argument arguments = ddCreatorTask.createArg();
+        arguments.setLine(args);
         ddCreatorTask.setClasspath(new Path(project, execClassPath));                         
         if (ddCreatorTask.executeJava() != 0) {                         
             throw new BuildException("Execution of ddcreator helper failed");
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreatorHelper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreatorHelper.java
index 5cbb736..beeb359 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreatorHelper.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DDCreatorHelper.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -116,6 +116,7 @@ public class DDCreatorHelper {
         for (int i = 0; i < descriptors.length; ++i) {
             String descriptorName = descriptors[i];
             File descriptorFile = new File(descriptorDirectory, descriptorName);
+
             int extIndex = descriptorName.lastIndexOf(".");
             String serName = null;
             if (extIndex != -1) {
@@ -130,7 +131,7 @@ public class DDCreatorHelper {
             if (!serFile.exists() || serFile.lastModified() < descriptorFile.lastModified()) {
                 
                 String[] args = {"-noexit", 
-                                 "-d", generatedFilesDirectory.getPath(),
+                                 "-d", serFile.getParent(),
                                  "-outputfile", serFile.getName(),
                                  descriptorFile.getPath()};
                 try {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DescriptorHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DescriptorHandler.java
index a524e76..51ad990 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DescriptorHandler.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/DescriptorHandler.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -74,6 +74,7 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
      * Bunch of constants used for storing entries in a hashtable, and for
      * constructing the filenames of various parts of the ejb jar.
      */
+    private static final String EJB_REF   = "ejb-ref";
     private static final String HOME_INTERFACE   = "home";
     private static final String REMOTE_INTERFACE = "remote";
     private static final String BEAN_CLASS       = "ejb-class";
@@ -84,24 +85,26 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
      * processed by the SAX parser.  Accessed by the SAX parser call-back methods
      * startElement() and endElement().
      */
-    private String currentElement = null;
+    protected String currentElement = null;
 
     /**
      * The text of the current element
      */
-    private String currentText = null;
+    protected String currentText = null;
 
     /**
      * Instance variable that stores the names of the files as they will be
      * put into the jar file, mapped to File objects  Accessed by the SAX
      * parser call-back method characters().
      */
-    private Hashtable ejbFiles = null;
+    protected Hashtable ejbFiles = null;
 
     private Hashtable fileDTDs = new Hashtable();
     
     private Hashtable resourceDTDs = new Hashtable();
 
+    private boolean inEJBRef = false;
+
     /**
      * The directory containing the bean classes and interfaces. This is 
      * used for performing dependency file lookups.
@@ -112,13 +115,20 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
         this.srcDir = srcDir;
     }
     
-
-    public void registerFileDTD(String publicId, File dtdFile) {
-        fileDTDs.put(publicId, dtdFile);
-    }
-    
-    public void registerResourceDTD(String publicId, String resourceName) {
-        resourceDTDs.put(publicId, resourceName);
+    public void registerDTD(String publicId, String location) {
+        if (location == null) {
+            return;
+        }
+        
+        File fileDTD = new File(location);
+        if (fileDTD.exists()) {
+            fileDTDs.put(publicId, fileDTD);
+            return;
+        }
+        
+        if (getClass().getResource(location) != null) {
+            resourceDTDs.put(publicId, location);
+        }
     }
 
     public InputSource resolveEntity(String publicId, String systemId)
@@ -126,7 +136,7 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
     {
         
         File dtdFile = (File) fileDTDs.get(publicId);
-        if (dtdFile != null && dtdFile.exists()) {
+        if (dtdFile != null) {
             try {
                 return new InputSource(new FileInputStream(dtdFile));
             } catch( FileNotFoundException ex ) {
@@ -158,8 +168,9 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
      * instance variables to ensure safe operation.
      */
     public void startDocument() throws SAXException {
-        this.ejbFiles         = new Hashtable(10, 1);
+        this.ejbFiles = new Hashtable(10, 1);
         this.currentElement = null;
+        inEJBRef = false;
     }
 
 
@@ -173,7 +184,10 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
     public void startElement(String name, AttributeList attrs) 
         throws SAXException {
         this.currentElement = name;
-        currentText = "";            
+        currentText = "";
+        if (name.equals(EJB_REF)) {
+            inEJBRef = true;
+        }
     }
 
 
@@ -190,6 +204,9 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
         processElement();
         currentText = "";
         this.currentElement = "";
+        if (name.equals(EJB_REF)) {
+            inEJBRef = false;
+        }
     }
 
     /**
@@ -214,7 +231,11 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
     }
     
     
-    private void processElement() {
+    protected void processElement() {
+        if (inEJBRef) {
+            return;
+        }
+        
         if (currentElement.equals(HOME_INTERFACE)   ||
             currentElement.equals(REMOTE_INTERFACE) ||
             currentElement.equals(BEAN_CLASS)       ||
@@ -222,7 +243,7 @@ public class DescriptorHandler extends org.xml.sax.HandlerBase {
             
             // Get the filename into a String object
             File classFile = null;
-            String className = currentText;
+            String className = currentText.trim();
 
             // If it's a primitive wrapper then we shouldn't try and put
             // it into the jar, so ignore it.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EJBDeploymentTool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EJBDeploymentTool.java
index deabe5c..978abf0 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EJBDeploymentTool.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EJBDeploymentTool.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -60,6 +60,7 @@ import javax.xml.parsers.SAXParser;
 
 import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.Task;
+import org.apache.tools.ant.types.*;
 
 public interface EJBDeploymentTool {
     /**
@@ -86,6 +87,5 @@ public interface EJBDeploymentTool {
     /**
      * Configure this tool for use in the ejbjar task.
      */
-    public void configure(File srcDir, File descriptorDir, String basenameTerminator, 
-                          String baseJarName, boolean flatDestDir);     
+    public void configure(EjbJar.Config config);     
 }
\ No newline at end of file
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbJar.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbJar.java
index e6c0d7f..c8b85de 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbJar.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbJar.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -69,6 +69,7 @@ import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.DirectoryScanner;
 import org.apache.tools.ant.taskdefs.MatchingTask;
+import org.apache.tools.ant.types.*;
 
 /**
  * <p>Provides automated ejb jar file creation for ant.  Extends the MatchingTask
@@ -101,28 +102,76 @@ import org.apache.tools.ant.taskdefs.MatchingTask;
  * @author <a href="mailto:tfennell@sapient.com">Tim Fennell</a>
  */
 public class EjbJar extends MatchingTask {
+    
+    public static class DTDLocation {
+        private String publicId;
+        private String location;
+        
+        public void setPublicId(String publicId) {
+            this.publicId = publicId;
+        }
+        
+        public void setLocation(String location) {
+            this.location = location;
+        }
+        
+        public String getPublicId() {
+            return publicId;
+        }
+        
+        public String getLocation() {
+            return location;
+        }
+    }
 
-    /** Stores a handle to the directory under which to search for class files */
-    private File srcDir;
+    /**
+     * A class which contains the configuration state of the ejbjar task.
+     * This state is passed to the deployment tools for configuration
+     */
+    static class Config {
+        /** Stores a handle to the directory under which to search for class files */
+        public File srcDir;
 
-    /** Stores a handle to the directory under which to search for deployment descriptors */
-    private File descriptorDir;
+        /** Stores a handle to the directory under which to search for deployment descriptors */
+        public File descriptorDir;
+        
+        /** Instance variable that marks the end of the 'basename' */
+        public String baseNameTerminator = "-";
 
-    /** Stores a handle to the directory to put the Jar files in */
-    private File destDir;
+        /** Stores a handle to the destination EJB Jar file */
+        public String baseJarName;
 
-    /** Stores a handle to the destination EJB Jar file */
-    private String baseJarName;
- 
-    /**
-     * Instance variable that determines whether to use a package structure
-     * of a flat directory as the destination for the jar files.
-     */
-    private boolean flatDestDir = false;
+        /**
+         * Instance variable that determines whether to use a package structure
+         * of a flat directory as the destination for the jar files.
+         */
+        public boolean flatDestDir = false;
+        
+        /**
+         * The classpath to use when loading classes
+         */
+        public Path classpath;
     
-    /** Instance variable that marks the end of the 'basename' */
-    private String baseNameTerminator = "-";
+        /**
+         * A Fileset of support classes
+         */
+        public List supportFileSets = new ArrayList();
+        
+        /**
+         * The list of configured DTD locations
+         */
+        public ArrayList dtdLocations = new ArrayList();
+    };
+
+    private Config config = new Config();
 
+
+    /** Stores a handle to the directory to put the Jar files in. This is only used
+        by the generic deployment descriptor tool which is created if no other
+        deployment descriptor tools are provided. Normally each deployment tool
+        will specify the desitination dir itself. */
+    private File destDir;
+ 
     /** Instance variable that stores the suffix for the generated jarfile. */
     private String genericJarSuffix = "-generic.jar";
 
@@ -131,6 +180,12 @@ public class EjbJar extends MatchingTask {
      */
     private ArrayList deploymentTools = new ArrayList();
 
+    /**
+     * Create a weblogic nested element used to configure a
+     * deployment tool for Weblogic server.
+     *
+     * @return the deployment tool instance to be configured.
+     */
     public WeblogicDeploymentTool createWeblogic() {
         WeblogicDeploymentTool tool = new WeblogicDeploymentTool();
         tool.setTask(this);
@@ -138,6 +193,12 @@ public class EjbJar extends MatchingTask {
         return tool;
     }
 
+    /**
+     * Create a nested element for weblogic when using the Toplink
+     * Object- Relational mapping.
+     *
+     * @return the deployment tool instance to be configured.
+     */
     public WeblogicTOPLinkDeploymentTool createWeblogictoplink() {
         WeblogicTOPLinkDeploymentTool tool = new WeblogicTOPLinkDeploymentTool();
         tool.setTask(this);
@@ -146,32 +207,89 @@ public class EjbJar extends MatchingTask {
     }
 
     /**
-     * Setter used to store the value of srcDir prior to execute() being called.
+     * creates a nested classpath element.
+     *
+     * This classpath is used to locate the super classes and interfaces
+     * of the classes that will make up the EJB jar.
+     * 
+     * @return the path to be configured.
+     */
+    public Path createClasspath() {
+        if (config.classpath == null) {
+            config.classpath = new Path(project);
+        }
+        return config.classpath.createPath();
+    }
+
+    /**
+     * Create a DTD location record. This stores the location of a DTD. The DTD is identified
+     * by its public Id. The location may either be a file location or a resource location.
+     */
+    public DTDLocation createDTD() {
+        DTDLocation dtdLocation = new DTDLocation();
+        config.dtdLocations.add(dtdLocation);
+        
+        return dtdLocation;
+    }
+
+    /**
+     * Create a file set for support elements
+     *
+     * @return a fileset which can be populated with support files.
+     */
+    public FileSet createSupport() {
+        FileSet supportFileSet = new FileSet();
+        config.supportFileSets.add(supportFileSet);
+        return supportFileSet;
+    }
+    
+
+    /**
+     * Set the srcdir attribute. The source directory is the directory that contains
+     * the classes that will be added to the EJB jar. Typically this will include the 
+     * home and remote interfaces and the bean class.
+     *
      * @param inDir the source directory.
      */
     public void setSrcdir(File inDir) {
-        this.srcDir = inDir;
+        config.srcDir = inDir;
     }
 
     /**
-     * Setter used to store the value of descriptorDir prior to execute() being called.
+     * Set the descriptor directory.
+     *
+     * The descriptor directory contains the EJB deployment descriptors. These are XML
+     * files that declare the properties of a bean in a particular deployment scenario. Such
+     * properties include, for example, the transactional nature of the bean and the security
+     * access control to the bean's methods.  
+     *
      * @param inDir the directory containing the deployment descriptors.
      */
     public void setDescriptordir(File inDir) {
-        this.descriptorDir = inDir;
+        config.descriptorDir = inDir;
     }
 
     /**
-     * Setter used to store the value of descriptorDir prior to execute() being called.
-     * @param inDir the directory containing the deployment descriptors.
+     * Set the base name of the EJB jar that is to be created if it is not to be
+     * determined from the name of the deployment descriptor files. 
+     * 
+     * @param inValue the basename that will be used when writing the jar file containing
+     * the EJB
      */
     public void setBasejarname(String inValue) {
-        this.baseJarName = inValue;
+        config.baseJarName = inValue;
     }
 
     /**
-     * Setter used to store the value of destination directory prior to execute()
-     * being called.
+     * Set the destination directory.
+     * 
+     * The EJB jar files will be written into this directory. The jar files that exist in
+     * this directory are also used when determining if the contents of the jar file 
+     * have changed.
+     *
+     * Note that this parameter is only used if no deployment tools are specified. Typically
+     * each deployment tool will specify its own destination directory.
+     * 
      * @param inFile the destination directory.
      */
     public void setDestdir(File inDir) {
@@ -179,15 +297,37 @@ public class EjbJar extends MatchingTask {
     }
 
     /**
-     * Setter used to store the value of flatDestDir.
-     * @param inValue a string, either 'true' or 'false'.
+     * Set the classpath to use when resolving classes for inclusion in the jar. 
+     *
+     * @param classpath the classpath to use.
+     */
+    public void setClasspath(Path classpath) {
+        config.classpath = classpath;
+    }
+
+    /**
+     * Set the flat dest dir flag.
+     *
+     * This flag controls whether the destination jars are written out in the 
+     * destination directory with the same hierarchal structure from which 
+     * the deployment descriptors have been read. If this is set to true the 
+     * generated EJB jars are written into the root of the destination directory,
+     * otherwise they are written out in the same relative position as the deployment
+     * descriptors in the descriptor directory.
+     * 
+     * @param inValue the new value of the flatdestdir flag.
      */
     public void setFlatdestdir(boolean inValue) {
-        this.flatDestDir = inValue;
+        config.flatDestDir = inValue;
     }
      
     /**
-     * Setter used to store the suffix for the generated jar file.
+     * Set the suffix for the generated jar file.
+     * When generic jars are generated, they have a suffix which is appended to the
+     * the bean name to create the name of the jar file. Note that this suffix includes
+     * the extension fo te jar file and should therefore end with an appropriate 
+     * extension such as .jar or .ear
+     * 
      * @param inString the string to use as the suffix.
      */
     public void setGenericjarsuffix(String inString) {
@@ -195,57 +335,58 @@ public class EjbJar extends MatchingTask {
     }
 
     /**
-     * Setter used to store the value of baseNameTerminator
+     * Set the baseNameTerminator.
+     *
+     * The basename terminator is the string which terminates the bean name. The convention
+     * used by this task is that bean descriptors are named as the BeanName with some suffix. 
+     * The baseNameTerminator string separates the bean name and the suffix and is used to
+     * determine the bean name.
+     *
      * @param inValue a string which marks the end of the basename.
      */
     public void setBasenameterminator(String inValue) {
-        this.baseNameTerminator = inValue;
+        config.baseNameTerminator = inValue;
     }
 
-    /**
-     * Setter used to store the value of generateweblogic.
-     * @param inValue a string, either 'true' or 'false'.
-     */
-    public void setGenerateweblogic(String inValue) {
-        log("The syntax for using ejbjar with Weblogic has changed.", Project.MSG_ERR);
-        log("Please refer to the ejbjar documentation" +
-            " for information on the using the <weblogic> nested element", Project.MSG_ERR);
-        throw new BuildException("generateweblogic not supported - use nested <weblogic> element");
-    }
+    private void validateConfig() {
+        if (config.srcDir == null) {
+            throw new BuildException("The srcDir attribute must be specified");
+        }
+
+        if (config.descriptorDir == null) {
+            config.descriptorDir = config.srcDir;
+        }
+    }        
 
     /**
      * Invoked by Ant after the task is prepared, when it is ready to execute
-     * this task.  Parses the XML deployment descriptor to acquire the list of
-     * files, then constructs the destination jar file (first deleting it if it
-     * already exists) from the list of classfiles encountered and the descriptor
-     * itself.  File will be of the expected format with classes under full
-     * package hierarchies and the descriptor in META-INF/ejb-jar.xml
+     * this task.  
+     *
+     * This will configure all of the nested deployment tools to allow them to 
+     * process the jar. If no deployment tools have been configured a generic 
+     * tool is created to handle the jar.
+     * 
+     * A parser is configured and then each descriptor found is passed to all
+     * the deployment tool elements for processing.
+     *
      * @exception BuildException thrown whenever a problem is
      *            encountered that cannot be recovered from, to signal to ant
      *            that a major problem occurred within this task.
      */
     public void execute() throws BuildException {
-        if (srcDir == null) {
-            throw new BuildException("The srcDir attribute must be specified");
-        }
+        validateConfig();
         
         if (deploymentTools.size() == 0) {
             GenericDeploymentTool genericTool = new GenericDeploymentTool();
-            genericTool.setDestdir(destDir);
             genericTool.setTask(this);
+            genericTool.setDestdir(destDir);
             genericTool.setGenericJarSuffix(genericJarSuffix);
-
             deploymentTools.add(genericTool);
         }
         
-        File scanDir = descriptorDir;
-        if (scanDir == null) {
-            scanDir = srcDir;
-        }
-        
         for (Iterator i = deploymentTools.iterator(); i.hasNext(); ) {
             EJBDeploymentTool tool = (EJBDeploymentTool)i.next();
-            tool.configure(srcDir, scanDir, baseNameTerminator, baseJarName, flatDestDir);
+            tool.configure(config);
             tool.validateConfigured();
         }
         
@@ -255,15 +396,14 @@ public class EjbJar extends MatchingTask {
             saxParserFactory.setValidating(true);
             SAXParser saxParser = saxParserFactory.newSAXParser();
     
-            
-            DirectoryScanner ds = getDirectoryScanner(scanDir);
+                        
+            DirectoryScanner ds = getDirectoryScanner(config.descriptorDir);
             ds.scan();
             String[] files = ds.getIncludedFiles();
     
             log(files.length + " deployment descriptors located.",
                 Project.MSG_VERBOSE);
             
-                            
             // Loop through the files. Each file represents one deployment
             // descriptor, and hence one bean in our model.
             for (int index = 0; index < files.length; ++index) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/Ejbc.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/Ejbc.java
index 2f6844d..6122cda 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/Ejbc.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/Ejbc.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -53,12 +53,9 @@
  */
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
-
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.DirectoryScanner;
-import org.apache.tools.ant.Project;
+import org.apache.tools.ant.*;
 import org.apache.tools.ant.taskdefs.*;
-import org.apache.tools.ant.types.Path;
+import org.apache.tools.ant.types.*;
 
 import java.io.File;
 
@@ -99,6 +96,8 @@ public class Ejbc extends MatchingTask {
      */
     private File sourceDirectory;
     
+    public boolean keepgenerated;
+    
     /**
      * Do the work.
      *
@@ -137,6 +136,7 @@ public class Ejbc extends MatchingTask {
         String[] files = ds.getIncludedFiles();
 
         Java helperTask = (Java)project.createTask("java");
+        helperTask.setTaskName(getTaskName());
         helperTask.setFork(true);
         helperTask.setClassname("org.apache.tools.ant.taskdefs.optional.ejb.EjbcHelper");
         String args = "";
@@ -144,17 +144,24 @@ public class Ejbc extends MatchingTask {
         args += " " + generatedFilesDirectory;
         args += " " + sourceDirectory;
         args += " " + generatedManifestFile;
+        args += " " + keepgenerated;
+        
         for (int i = 0; i < files.length; ++i) {
             args += " " + files[i];
         }
                                     
-        helperTask.setArgs(args);
+        Commandline.Argument arguments = helperTask.createArg();
+        arguments.setLine(args);
         helperTask.setClasspath(new Path(project, execClassPath));
         if (helperTask.executeJava() != 0) {                         
             throw new BuildException("Execution of ejbc helper failed");
         }
     }
-
+    
+    public boolean getKeepgenerated() {
+        return keepgenerated;
+    }
+    
     /**
      * Set the directory from where the serialised deployment descriptors are
      * to be read.
@@ -173,7 +180,12 @@ public class Ejbc extends MatchingTask {
     public void setDest(String dirName) {
         generatedFilesDirectory = new File(dirName);
     }
-
+    
+    public void setKeepgenerated(String newKeepgenerated) {
+        keepgenerated = Boolean.valueOf(newKeepgenerated.trim()).booleanValue();
+        
+    }
+    
     /**
      * Set the generated manifest file. 
      *
@@ -192,7 +204,7 @@ public class Ejbc extends MatchingTask {
     public void setClasspath(String s) {
         this.classpath = project.translatePath(s);
     }
-
+    
     /**
      * Set the directory containing the source code for the home interface, remote interface
      * and public key class definitions.
@@ -202,5 +214,4 @@ public class Ejbc extends MatchingTask {
     public void setSrc(String dirName) {
         sourceDirectory = new File(dirName);
     }
-                
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbcHelper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbcHelper.java
index 262ff88..625c8a5 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbcHelper.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/EjbcHelper.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -53,12 +53,8 @@
  */
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.ObjectInputStream;
-import java.io.IOException;
-import java.io.PrintWriter;
-import java.io.FileWriter;
+import java.io.*;
+import java.util.*;
 
 import javax.ejb.deployment.EntityDescriptor;
 import javax.ejb.deployment.DeploymentDescriptor;
@@ -103,7 +99,9 @@ public class EjbcHelper {
     /**
      * The names of the serialised deployment descriptors
      */
-    String[] descriptors; 
+    String[] descriptors;
+
+    private boolean keepGenerated;
 
     /**
      * Command line interface for the ejbc helper task.
@@ -112,7 +110,7 @@ public class EjbcHelper {
         EjbcHelper helper = new EjbcHelper(args);
         helper.process();
     }
-
+    
     /**
      * Initialise the EjbcHelper by reading the command arguments.
      */    
@@ -122,12 +120,30 @@ public class EjbcHelper {
         generatedFilesDirectory = new File(args[index++]);
         sourceDirectory = new File(args[index++]);
         manifestFile = new File(args[index++]);
+        keepGenerated = Boolean.valueOf(args[index++]).booleanValue();
         
         descriptors = new String[args.length - index];
         for (int i = 0; index < args.length; ++i) {
             descriptors[i] = args[index++];
         }
     }
+    
+    private String[] getCommandLine(boolean debug, File descriptorFile) {
+        Vector v = new Vector();
+        if (!debug) {
+            v.add("-noexit");
+        }
+        if (keepGenerated) {
+            v.add("-keepgenerated");        
+        }
+        v.add("-d");
+        v.add(generatedFilesDirectory.getPath());
+        v.add(descriptorFile.getPath());
+    
+        String[] args = new String[v.size()];
+        v.copyInto(args);
+        return args;
+    }
 
     /**
      * Determine if the weblogic EJB support classes need to be regenerated
@@ -222,7 +238,7 @@ public class EjbcHelper {
         
         return false;
     }
-
+    
     /**
      * Process the descriptors in turn generating support classes for each and a manifest
      * file for all of the beans.
@@ -240,7 +256,7 @@ public class EjbcHelper {
             else {
                 System.out.println(descriptorFile.getName() + " is up to date");
             }
-            manifest += "Name: " + descriptorFile.getName() + "\nEnterprise-Bean: True\n\n";
+            manifest += "Name: " + descriptorName.replace('\\', '/') + "\nEnterprise-Bean: True\n\n";
         }
         
         FileWriter fw = new FileWriter(manifestFile);
@@ -249,7 +265,7 @@ public class EjbcHelper {
         fw.flush();
         fw.close();
     }
-
+    
     /**
      * Perform the weblogic.ejbc call to regenerate the support classes.
      *
@@ -259,19 +275,15 @@ public class EjbcHelper {
     private void regenerateSupportClasses(File descriptorFile) throws Exception {
         // create a Java task to do the rebuild
 
-        String[] args = {"-noexit",
-                         "-keepgenerated",
-                         "-d", generatedFilesDirectory.getPath(),
-                         descriptorFile.getPath()};
+        
+        String[] args = getCommandLine(false,descriptorFile);
         
         try {
             weblogic.ejbc.main(args);
         }
         catch (Exception e) {
             // run with no exit for better reporting
-            String[] newArgs = {"-keepgenerated",
-                         "-d", generatedFilesDirectory.getPath(),
-                         descriptorFile.getPath()};
+            String[] newArgs = getCommandLine(true, descriptorFile);
             weblogic.ejbc.main(newArgs);
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/GenericDeploymentTool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/GenericDeploymentTool.java
index 0ea083a..4ca0373 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/GenericDeploymentTool.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/GenericDeploymentTool.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,56 +51,68 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
 import java.io.*;
 import java.util.*;
 import java.util.jar.*;
 import java.util.zip.*;
+import java.net.*;
 
 import javax.xml.parsers.SAXParser;
 import org.xml.sax.InputSource;
 import org.xml.sax.SAXException;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.Project;
-import org.apache.tools.ant.Task;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
 
+/**
+ * A deployment tool which creates generic EJB jars. Generic jars contains
+ * only those classes and META-INF entries specified in the EJB 1.1 standard
+ *
+ * This class is also used as a framework for the creation of vendor specific
+ * deployment tools. A number of template methods are provided through which the
+ * vendor specific tool can hook into the EJB creation process.
+ */
 public class GenericDeploymentTool implements EJBDeploymentTool {
     /** Private constants that are used when constructing the standard jarfile */
     protected static final String META_DIR  = "META-INF/";
     protected static final String EJB_DD    = "ejb-jar.xml";
 
-    /** Stores a handle to the directory of the source tree */
-    private File srcDir;
-
-    /** Stores a handle to the directory of the deployment descriptors */
-    private File descriptorDir;
+    /**
+     * The configuration from the containing task. This config combined with the 
+     * settings of the individual attributes here constitues the complete config for
+     * this deployment tool.
+     */
+    private EjbJar.Config config;
 
     /** Stores a handle to the directory to put the Jar files in */
     private File destDir;
     
-    /** Instance variable that stores the jar file name when not using the naming standard */
-    private String baseJarName;
-
-    /**
-     * Instance variable that determines whether to use a package structure
-     * of a flat directory as the destination for the jar files.
-     */
-    private boolean flatDestDir = false;
-    
-    /** Instance variable that marks the end of the 'basename' */
-    private String baseNameTerminator = "-";
+    /** The classpath to use with this deployment tool. This is appended to 
+        any paths from the ejbjar task itself.*/
+    private Path classpath;
 
     /** Instance variable that stores the suffix for the generated jarfile. */
     private String genericJarSuffix = "-generic.jar";
 
     /**
-     * The task to which this tool belongs.
+     * The task to which this tool belongs. This is used to access services provided
+     * by the ant core, such as logging.
      */
     private Task task;
     
+    /**
+     * The classloader generated from the given classpath to load
+     * the super classes and super interfaces.
+     */
+    private ClassLoader classpathLoader = null;
+    
+     /**
+     * List of files have been loaded into the EJB jar
+     */
+    private List addedfiles;
+
     /**
      * Setter used to store the value of destination directory prior to execute()
      * being called.
@@ -135,57 +147,72 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
     /**
      * Get the basename terminator.
      */
-    protected String getBaseNameTerminator() {
-        return baseNameTerminator;
+    protected EjbJar.Config getConfig() {
+        return config;
     }
     
     /**
-     * Get the base jar name.
+     * Returns true, if the meta-inf dir is being explicitly set, false otherwise.
      */
-    protected String getBaseJarName() {
-        return baseJarName;
+    protected boolean usingBaseJarName() {
+        return config.baseJarName != null;
     }
     
     /**
-     * Get the source dir.
+     * Setter used to store the suffix for the generated jar file.
+     * @param inString the string to use as the suffix.
      */
-    protected File getSrcDir() {
-        return srcDir;
+    public void setGenericJarSuffix(String inString) {
+        this.genericJarSuffix = inString;
     }
-    
+
     /**
-     * Get the meta-inf dir.
-     * 
+     * Add the classpath for the user classes
      */
-    protected File getDescriptorDir() {
-        return descriptorDir;
+    public Path createClasspath() {
+        if (classpath == null) {
+            classpath = new Path(task.getProject());
+        }
+        return classpath.createPath();
     }
 
     /**
-     * Returns true, if the meta-inf dir is being explicitly set, false otherwise.
+     * Set the classpath to be used for this compilation.
      */
-    protected boolean usingBaseJarName() {
-        return baseJarName != null;
+    public void setClasspath(Path classpath) {
+        this.classpath = classpath;
     }
-    
+
     /**
-     * Setter used to store the suffix for the generated jar file.
-     * @param inString the string to use as the suffix.
+     * Get the classpath by combining the one from the surrounding task, if any
+     * and the one from tis tool.
      */
-    public void setGenericJarSuffix(String inString) {
-        this.genericJarSuffix = inString;
+    protected Path getCombinedClasspath() {
+        Path combinedPath = classpath;
+        if (config.classpath != null) {
+            if (combinedPath == null) {
+                combinedPath = config.classpath;
+            }
+            else {
+                combinedPath.append(config.classpath);
+            }
+        }
+        
+        return combinedPath;
+    }
+    
+    protected void log(String message, int level) {
+        getTask().log(message, level);
     }
 
+
     /**
      * Configure this tool for use in the ejbjar task.
      */
-    public void configure(File srcDir, File descriptorDir, String baseNameTerminator, 
-                          String baseJarName, boolean flatDestDir) {
-        this.srcDir = srcDir;
-        this.descriptorDir = descriptorDir;
-        this.baseJarName = baseJarName;
-        this.baseNameTerminator = baseNameTerminator;
-        this.flatDestDir = flatDestDir;
+    public void configure(EjbJar.Config config) {
+        this.config = config;
+        
+        classpathLoader = null;
     }
 
     /**
@@ -194,39 +221,52 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
      * constructed.
      * @param jStream A JarOutputStream into which to write the
      *        jar entry.
-     * @param iStream A FileInputStream from which to read the
+     * @param inputFile A File from which to read the
      *        contents the file being added.
-     * @param filename A String representing the name, including
+     * @param logicalFilename A String representing the name, including
      *        all relevant path information, that should be stored for the entry
      *        being added.
      */
     protected void addFileToJar(JarOutputStream jStream,
-                                FileInputStream iStream,
-                                String          filename)
+                                File inputFile,
+                                String logicalFilename)
         throws BuildException {
+        FileInputStream iStream = null;
         try {
-            // Create the zip entry and add it to the jar file
-            ZipEntry zipEntry = new ZipEntry(filename);
-            jStream.putNextEntry(zipEntry);
-            
-            // Create the file input stream, and buffer everything over
-            // to the jar output stream
-            byte[] byteBuffer = new byte[2 * 1024];
-            int count = 0;
-            do {
-                jStream.write(byteBuffer, 0, count);
-                count = iStream.read(byteBuffer, 0, byteBuffer.length);
-            } while (count != -1);
-            
-            // Close up the file input stream for the class file
-            iStream.close();
+            if (!addedfiles.contains(logicalFilename)) {
+                iStream = new FileInputStream(inputFile);
+                // Create the zip entry and add it to the jar file
+                ZipEntry zipEntry = new ZipEntry(logicalFilename.replace('\\','/'));
+                jStream.putNextEntry(zipEntry);
+                   
+                // Create the file input stream, and buffer everything over
+                // to the jar output stream
+                byte[] byteBuffer = new byte[2 * 1024];
+                int count = 0;
+                do {
+                    jStream.write(byteBuffer, 0, count);
+                    count = iStream.read(byteBuffer, 0, byteBuffer.length);
+                } while (count != -1);
+                
+                //add it to list of files in jar
+                addedfiles.add(logicalFilename);
+           }       
         }
         catch (IOException ioe) {
             String msg = "IOException while adding entry "
-                         + filename + "to jarfile."
+                         + logicalFilename + " to jarfile from " + inputFile.getPath() + "."
                          + ioe.getMessage();
             throw new BuildException(msg, ioe);
         }
+        finally {
+            // Close up the file input stream for the class file
+            if (iStream != null) {
+                try {
+                    iStream.close();
+                }
+                catch (IOException closeException) {}
+            }
+        }
     }
 
     protected DescriptorHandler getDescriptorHandler(File srcDir) {
@@ -234,34 +274,47 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
     }
     
     public void processDescriptor(String descriptorFileName, SAXParser saxParser) {
+        FileInputStream descriptorStream = null;
+
         try {
-            DescriptorHandler handler = getDescriptorHandler(srcDir);
+            DescriptorHandler handler = getDescriptorHandler(config.srcDir);
             
             /* Parse the ejb deployment descriptor.  While it may not
              * look like much, we use a SAXParser and an inner class to
              * get hold of all the classfile names for the descriptor.
              */
-            saxParser.parse(new InputSource
-                            (new FileInputStream
-                            (new File(getDescriptorDir(), descriptorFileName))),
-                            handler);
+            descriptorStream = new FileInputStream(new File(config.descriptorDir, descriptorFileName));
+            saxParser.parse(new InputSource(descriptorStream), handler);
                             
             Hashtable ejbFiles = handler.getFiles();
-            
+                    
+            // add in support classes if any
+            Project project = task.getProject();
+            for (Iterator i = config.supportFileSets.iterator(); i.hasNext();) {
+                FileSet supportFileSet = (FileSet)i.next();
+                File supportBaseDir = supportFileSet.getDir(project);
+                DirectoryScanner supportScanner = supportFileSet.getDirectoryScanner(project);
+                supportScanner.scan();
+                String[] supportFiles = supportScanner.getIncludedFiles();
+                for (int j = 0; j < supportFiles.length; ++j) {
+                    ejbFiles.put(supportFiles[j], new File(supportBaseDir, supportFiles[j]));
+                }
+            }            
+
             String baseName = "";
             
             // Work out what the base name is
-            if (baseJarName != null) {
-                baseName = baseJarName;
+            if (config.baseJarName != null) {
+                baseName = config.baseJarName;
             } else {
                 int lastSeparatorIndex = descriptorFileName.lastIndexOf(File.separator);
                 int endBaseName = -1;
                 if (lastSeparatorIndex != -1) {
-                    endBaseName = descriptorFileName.indexOf(baseNameTerminator, 
+                    endBaseName = descriptorFileName.indexOf(config.baseNameTerminator, 
                                                              lastSeparatorIndex);
                 }
                 else {
-                    endBaseName = descriptorFileName.indexOf(baseNameTerminator);
+                    endBaseName = descriptorFileName.indexOf(config.baseNameTerminator);
                 }
 
                 if (endBaseName != -1) {
@@ -272,13 +325,17 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
 
             // First the regular deployment descriptor
             ejbFiles.put(META_DIR + EJB_DD,
-                         new File(getDescriptorDir(), descriptorFileName));
-                         
+                         new File(config.descriptorDir, descriptorFileName));
+            
+            // now the vendor specific files, if any             
             addVendorFiles(ejbFiles, baseName);
 
+            // add any inherited files
+            checkAndAddInherited(ejbFiles);
+
             // Lastly create File object for the Jar files. If we are using
             // a flat destination dir, then we need to redefine baseName!
-            if (flatDestDir && baseName.length() != 0) {
+            if (config.flatDestDir && baseName.length() != 0) {
                 int startName = baseName.lastIndexOf(File.separator);
                 if (startName == -1) {
                     startName = 0;
@@ -304,6 +361,10 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
                 while( (needBuild == false) && (fileIter.hasNext()) ) {
                     File currentFile = (File) fileIter.next();
                     needBuild = ( lastBuild < currentFile.lastModified() );
+                    if (needBuild) {
+                        log("Build needed because " + currentFile.getPath() + " is out of date",
+                            Project.MSG_VERBOSE);
+                    }
                 }
             }
             
@@ -311,7 +372,7 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
             // doing the work!
             if (needBuild) {
                 // Log that we are going to build...
-                getTask().log( "building "
+                log( "building "
                               + jarFile.getName()
                               + " with "
                               + String.valueOf(ejbFiles.size())
@@ -324,8 +385,8 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
             }
             else {
                 // Log that the file is up to date...
-                getTask().log(jarFile.toString() + " is up to date.",
-                              Project.MSG_INFO);
+                log(jarFile.toString() + " is up to date.",
+                              Project.MSG_VERBOSE);
             }
 
         }
@@ -345,6 +406,14 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
                 + ioe.getMessage();
             throw new BuildException(msg, ioe);
         }
+        finally {
+            if (descriptorStream != null) {
+                try {
+                    descriptorStream.close();
+                }
+                catch (IOException closeException) {}
+            }
+        }
     }
     
     /**
@@ -352,6 +421,7 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
      * EJB Jar.
      */
     protected void addVendorFiles(Hashtable ejbFiles, String baseName) {
+        // nothing to add for generic tool.
     }
 
 
@@ -369,14 +439,12 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
      * ejbFiles.
      */
     protected void writeJar(String baseName, File jarfile, Hashtable files) throws BuildException{
-        JarOutputStream jarStream = null;
-        Iterator entryIterator = null;
-        String entryName = null;
-        File entryFile = null;
-	File entryDir = null;
-	String innerfiles[] = null;
 
+        JarOutputStream jarStream = null;
         try {
+            // clean the addedfiles Vector 
+            addedfiles = new ArrayList();
+
             /* If the jarfile already exists then whack it and recreate it.
              * Should probably think of a more elegant way to handle this
              * so that in case of errors we don't leave people worse off
@@ -388,46 +456,47 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
             jarfile.getParentFile().mkdirs();
             jarfile.createNewFile();
             
+            String defaultManifest = "/org/apache/tools/ant/defaultManifest.mf";
+            InputStream in = this.getClass().getResourceAsStream(defaultManifest);
+            if ( in == null ) {
+                throw new BuildException ( "Could not find: " + defaultManifest );
+            }
+            
+            Manifest manifest = new Manifest(in);
             // Create the streams necessary to write the jarfile
-            jarStream = new JarOutputStream(new FileOutputStream(jarfile));
+            
+            jarStream = new JarOutputStream(new FileOutputStream(jarfile), manifest);
             jarStream.setMethod(JarOutputStream.DEFLATED);
             
             // Loop through all the class files found and add them to the jar
-            entryIterator = files.keySet().iterator();
-            while (entryIterator.hasNext()) {
-                entryName = (String) entryIterator.next();
-                entryFile = (File) files.get(entryName);
+            for (Iterator entryIterator = files.keySet().iterator(); entryIterator.hasNext(); ) {
+                String entryName = (String) entryIterator.next();
+                File entryFile = (File) files.get(entryName);
                 
-                getTask().log("adding file '" + entryName + "'",
+                log("adding file '" + entryName + "'",
                               Project.MSG_VERBOSE);
 
-                addFileToJar(jarStream,
-                             new FileInputStream(entryFile),
-                             entryName);
-
-		// See if there are any inner classes for this class and add them in if there are
-		InnerClassFilenameFilter flt = new InnerClassFilenameFilter(entryFile.getName());
-		entryDir = entryFile.getParentFile();
-		innerfiles = entryDir.list(flt);
-		for (int i=0, n=innerfiles.length; i < n; i++) {
-	
-			//get and clean up innerclass name
-			entryName = entryName.substring(0, entryName.lastIndexOf(entryFile.getName())-1) + File.separatorChar + innerfiles[i];
-
-			// link the file
-			entryFile = new File(srcDir, entryName);
-
-			getTask().log("adding innerclass file '" + entryName + "'", 
-				    Project.MSG_VERBOSE);
+                addFileToJar(jarStream, entryFile, entryName);
 
-			addFileToJar(jarStream,
-                                     new FileInputStream(entryFile),
-                                     entryName);
-
-		}
+                // See if there are any inner classes for this class and add them in if there are
+                InnerClassFilenameFilter flt = new InnerClassFilenameFilter(entryFile.getName());
+                File entryDir = entryFile.getParentFile();
+                String[] innerfiles = entryDir.list(flt);
+                for (int i=0, n=innerfiles.length; i < n; i++) {
+            
+                    //get and clean up innerclass name
+                    entryName = entryName.substring(0, entryName.lastIndexOf(entryFile.getName())-1) + File.separatorChar + innerfiles[i];
+        
+                    // link the file
+                    entryFile = new File(config.srcDir, entryName);
+        
+                    log("adding innerclass file '" + entryName + "'", 
+                            Project.MSG_VERBOSE);
+        
+                    addFileToJar(jarStream, entryFile, entryName);
+        
+                }
             }
-            // All done.  Close the jar stream.
-            jarStream.close();
         }
         catch(IOException ioe) {
             String msg = "IOException while processing ejb-jar file '"
@@ -436,12 +505,142 @@ public class GenericDeploymentTool implements EJBDeploymentTool {
                 + ioe.getMessage();
             throw new BuildException(msg, ioe);
         }
+        finally {
+            if (jarStream != null) {
+                try {
+                    jarStream.close();
+                }
+                catch (IOException closeException) {}
+            }
+        }
     } // end of writeJar
 
- 
+    /**
+     * Check if a EJB Class Inherits from a Superclass, and if a Remote Interface
+     * extends an interface other then javax.ejb.EJBObject directly.  Then add those 
+     * classes to the generic-jar so they dont have to added elsewhere.
+     *
+     */
+    protected void checkAndAddInherited(Hashtable checkEntries) throws BuildException
+    {
+        //Copy hashtable so were not changing the one we iterate through
+        Hashtable copiedHash = (Hashtable)checkEntries.clone();
+
+        // Walk base level EJBs and see if they have superclasses or extend extra interfaces which extend EJBObject
+        for (Iterator entryIterator = copiedHash.keySet().iterator(); entryIterator.hasNext(); ) 
+        {
+            String entryName = (String)entryIterator.next();
+            File entryFile = (File)copiedHash.get(entryName);
+
+            // only want class files, xml doesnt reflect very well =)
+            if (entryName.endsWith(".class"))
+            {
+                String classname = entryName.substring(0,entryName.lastIndexOf(".class")).replace(File.separatorChar,'.');
+                ClassLoader loader = getClassLoaderForBuild();
+                try {
+                    Class c = loader.loadClass(classname);
+
+                    // No primatives!!  sanity check, probably not nessesary
+                    if (!c.isPrimitive())
+                    {
+                        if (c.isInterface()) //get as an interface
+                        {
+                            log("looking at interface " + c.getName(),  Project.MSG_VERBOSE);
+                            Class[] interfaces = c.getInterfaces();
+                            for (int i = 0; i < interfaces.length; i++){
+                                log("     implements " + interfaces[i].getName(),  Project.MSG_VERBOSE);
+                                addInterface(interfaces[i], checkEntries);
+                            }
+                        }
+                        else  // get as a class
+                        {
+                            log("looking at class " + c.getName(),  Project.MSG_VERBOSE);
+                            Class s = c.getSuperclass();
+                            addSuperClass(c.getSuperclass(), checkEntries);
+                        }
+                    } //if primative
+                }
+                catch (ClassNotFoundException cnfe) {
+                    log("Could not load class " + classname + " for super class check", 
+                                  Project.MSG_WARN);
+                }                            
+                catch (NoClassDefFoundError ncdfe) {
+                    log("Could not fully load class " + classname + " for super class check", 
+                                  Project.MSG_WARN);
+                }                            
+            } //if 
+        } // while 
+    }
 
+    private void addInterface(Class theInterface, Hashtable checkEntries) {
+        if (!theInterface.getName().startsWith("java")) // do not add system interfaces
+        { 
+            File interfaceFile = new File(config.srcDir.getAbsolutePath() 
+                                        + File.separatorChar 
+                                        + theInterface.getName().replace('.',File.separatorChar)
+                                        + ".class"
+                                        );
+            if (interfaceFile.exists() && interfaceFile.isFile())
+            {
+                checkEntries.put(theInterface.getName().replace('.',File.separatorChar)+".class",
+                                 interfaceFile);
+                Class[] superInterfaces = theInterface.getInterfaces();
+                for (int i = 0; i < superInterfaces.length; i++) {
+                    addInterface(superInterfaces[i], checkEntries);
+                }
+            }
+        }
+    }
+     
+    private void addSuperClass(Class superClass, Hashtable checkEntries) {
     
-
+        if (!superClass.getName().startsWith("java"))
+        {
+            File superClassFile = new File(config.srcDir.getAbsolutePath() 
+                                            + File.separatorChar 
+                                            + superClass.getName().replace('.',File.separatorChar)
+                                            + ".class");
+            if (superClassFile.exists() && superClassFile.isFile())
+            {
+                checkEntries.put(superClass.getName().replace('.',File.separatorChar) + ".class", 
+                                 superClassFile);
+                
+                // now need to get super classes and interfaces for this class
+                Class[] superInterfaces = superClass.getInterfaces();
+                for (int i = 0; i < superInterfaces.length; i++) {
+                    addInterface(superInterfaces[i], checkEntries);
+                }
+                
+                addSuperClass(superClass.getSuperclass(), checkEntries);
+            }               
+        }
+    }
+    
+    /**
+     * Returns a Classloader object which parses the passed in generic EjbJar classpath.
+     * The loader is used to dynamically load classes from javax.ejb.* and the classes 
+     * being added to the jar.
+     *
+     */ 
+    protected ClassLoader getClassLoaderForBuild()
+    {
+        if (classpathLoader != null) {
+            return classpathLoader;
+        }
+        
+        Path combinedClasspath = getCombinedClasspath();
+        
+        // only generate a new ClassLoader if we have a classpath
+        if (combinedClasspath == null) {
+            classpathLoader = getClass().getClassLoader();
+        }
+        else {
+            classpathLoader = new AntClassLoader(getTask().getProject(), combinedClasspath);
+        }
+        
+        return classpathLoader;
+    }
+ 
     /**
      * Called to validate that the tool parameters have been configured.
      *
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/InnerClassFilenameFilter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/InnerClassFilenameFilter.java
index 9214760..48c892a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/InnerClassFilenameFilter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/InnerClassFilenameFilter.java
@@ -1,23 +1,76 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
 import java.io.*;
 
 public class InnerClassFilenameFilter implements FilenameFilter {
-	private String baseClassName;
+    private String baseClassName;
 
-	InnerClassFilenameFilter(String baseclass){
-		int extidx = baseclass.lastIndexOf(".class");
-		if (extidx == -1) {
-			extidx = baseclass.length()-1;
-		}
-		baseClassName = baseclass.substring(0,extidx);
-	}
+    InnerClassFilenameFilter(String baseclass){
+        int extidx = baseclass.lastIndexOf(".class");
+        if (extidx == -1) {
+            extidx = baseclass.length()-1;
+        }
+        baseClassName = baseclass.substring(0,extidx);
+    }
 
-	public boolean accept (File Dir, String filename){
-        	if ((filename.lastIndexOf(".") != filename.lastIndexOf(".class")) 
-		    || (filename.indexOf(baseClassName + "$") != 0)) {
-				return false;
-		}
-		return true;
-	}
+    public boolean accept (File Dir, String filename){
+        if ((filename.lastIndexOf(".") != filename.lastIndexOf(".class")) 
+            || (filename.indexOf(baseClassName + "$") != 0)) {
+            return false;
+        }
+        return true;
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLRun.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLRun.java
index dcbe84e..0322db7 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLRun.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLRun.java
@@ -1,7 +1,7 @@
 /*
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * Copyright (c) 2000, 2001 The Apache Software Foundation.  All rights 
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -69,7 +69,9 @@ import java.io.File;
  * @author <a href="mailto:conor@cortexebusiness.com.au">Conor MacNeill</a>, Cortex ebusiness Pty Limited
  */
 public class WLRun extends Task {
-    static private final String defaultPolicyFile = "weblogic.policy";
+    static protected final String DEFAULT_WL51_POLICY_FILE = "weblogic.policy";
+    static protected final String DEFAULT_WL60_POLICY_FILE = "lib/weblogic.policy";
+    static protected final String DEFAULT_PROPERTIES_FILE = "weblogic.properties";
 
     /**
      * The classpath to be used when running the Java VM. It must contain the weblogic
@@ -83,6 +85,10 @@ public class WLRun extends Task {
     private Path weblogicClasspath;
 
     private String weblogicMainClass = "weblogic.Server";
+    
+    /**
+     * Addional arguments to pass to the JVM used to run weblogic
+     */
     private String additionalArgs = "";
     
     /**
@@ -94,6 +100,11 @@ public class WLRun extends Task {
      * The weblogic system home directory
      */
     private File weblogicSystemHome;
+
+    /**
+     * The weblogic domain
+     */
+    private String weblogicDomainName;
     
     /**
      * The name of the weblogic server - used to select the server's directory in the 
@@ -104,13 +115,54 @@ public class WLRun extends Task {
     /**
      * The file containing the weblogic properties for this server.
      */
-    private String weblogicPropertiesFile = "weblogic.properties";
+    private String weblogicPropertiesFile = null;
 
     /**
      * additional args to pass to the spawned jvm
      */
     private String additionalJvmArgs = "";
+
+    /**
+     * The location of the BEA Home under which this server is run.
+     * WL6 only
+     */
+    private File beaHome = null;
+
+    /**
+     * The management username
+     */
+    private String managementUsername = "system";
     
+    /**
+     * The management password
+     */
+    private String managementPassword = null;
+
+    /**
+     * The provate key password - used for SSL
+     */
+    private String pkPassword = null;
+
+    /**
+     * Add the classpath for the user classes
+     */
+    public Path createClasspath() {
+        if (classpath == null) {
+            classpath = new Path(project);
+        }
+        return classpath.createPath();
+    }
+
+    /**
+     * Get the classpath to the weblogic classpaths
+     */
+    public Path createWLClasspath() {
+        if (weblogicClasspath == null) {
+            weblogicClasspath = new Path(project);
+        }
+        return weblogicClasspath.createPath();
+    }
+
     /**
      * Do the work.
      *
@@ -130,9 +182,83 @@ public class WLRun extends Task {
             throw new BuildException("weblogic home directory " + weblogicSystemHome.getPath() + 
                                      " is not valid");
         }
-                
-        File propertiesFile = new File(weblogicSystemHome, weblogicPropertiesFile);
+
+        if (beaHome != null) {
+            executeWLS6();
+        }
+        else {
+            executeWLS();
+        }
+    }
+    
+    private void executeWLS6() {
+        
+        if (!beaHome.isDirectory()) {
+            throw new BuildException("BEA home " + beaHome.getPath() + 
+                                     " is not valid");
+        }
+        
+        File securityPolicyFile = null;
+        if (securityPolicy == null) {
+            securityPolicyFile = new File(weblogicSystemHome, DEFAULT_WL60_POLICY_FILE);
+        }
+        else {
+            securityPolicyFile = new File(weblogicSystemHome, securityPolicy);
+        }
+
+        File configFile = new File(weblogicSystemHome, "config/" + weblogicDomainName + "/config.xml");
+        if (!configFile.exists()) {
+            throw new BuildException("Server config file " + configFile + " not found.");
+        }
         
+        if (managementPassword == null) {
+            throw new BuildException("You must supply a management password to start the server");
+        }
+
+        Java weblogicServer = (Java)project.createTask("java");
+        weblogicServer.setTaskName(getTaskName());
+        weblogicServer.setFork(true);
+        weblogicServer.setDir(weblogicSystemHome);
+        weblogicServer.setClassname(weblogicMainClass);
+
+        String jvmArgs = additionalJvmArgs;
+        
+        jvmArgs += " -Dweblogic.Domain=" + weblogicDomainName;
+        jvmArgs += " -Dweblogic.Name=" + weblogicSystemName;
+        jvmArgs += " -Dweblogic.system.home=" + weblogicSystemHome;
+
+        jvmArgs += " -Dbea.home=" + beaHome;
+        jvmArgs += " -Djava.security.policy==" + securityPolicyFile;
+        
+        jvmArgs += " -Dweblogic.management.username=" + managementUsername;
+        jvmArgs += " -Dweblogic.management.password=" + managementPassword;
+        if (pkPassword != null) {
+            jvmArgs += " -Dweblogic.pkpassword=" + pkPassword;
+        }
+        
+
+        weblogicServer.createJvmarg().setLine(jvmArgs);
+        weblogicServer.createArg().setLine(additionalArgs);
+        
+        if (classpath != null) {
+            weblogicServer.setClasspath(classpath);                         
+        }
+            
+        if (weblogicServer.executeJava() != 0) {                         
+            throw new BuildException("Execution of weblogic server failed");
+        }
+     }
+    
+    private void executeWLS() {
+
+        File propertiesFile = null;
+        
+        if (weblogicPropertiesFile == null) {
+            propertiesFile = new File(weblogicSystemHome, DEFAULT_PROPERTIES_FILE);
+        }
+        else {
+            propertiesFile = new File(weblogicSystemHome, weblogicPropertiesFile);
+        }
         if (!propertiesFile.exists()) {
             throw new BuildException("Properties file " + weblogicPropertiesFile +
                                      " not found in weblogic home " + weblogicSystemHome);
@@ -140,7 +266,7 @@ public class WLRun extends Task {
 
         File securityPolicyFile = null;
         if (securityPolicy == null) {
-            securityPolicyFile = new File(weblogicSystemHome, defaultPolicyFile);
+            securityPolicyFile = new File(weblogicSystemHome, DEFAULT_WL51_POLICY_FILE);
         }
         else {
             securityPolicyFile = new File(weblogicSystemHome, securityPolicy);
@@ -156,7 +282,7 @@ public class WLRun extends Task {
         weblogicServer.setFork(true);
         weblogicServer.setClassname(weblogicMainClass);
 
-        String jvmArgs = "";
+        String jvmArgs = additionalJvmArgs;
         
         if (weblogicClasspath != null) {
             jvmArgs += " -Dweblogic.class.path=" + weblogicClasspath;
@@ -166,12 +292,13 @@ public class WLRun extends Task {
         jvmArgs += " -Dweblogic.system.home=" + weblogicSystemHome;
         jvmArgs += " -Dweblogic.system.name=" + weblogicSystemName;
         jvmArgs += " -Dweblogic.system.propertiesFile=" + weblogicPropertiesFile;
-        jvmArgs += " " + additionalJvmArgs;
 
         weblogicServer.createJvmarg().setLine(jvmArgs);
         weblogicServer.createArg().setLine(additionalArgs);
         
-        weblogicServer.setClasspath(classpath);                         
+        if (classpath != null) {
+            weblogicServer.setClasspath(classpath);                         
+        }
         if (weblogicServer.executeJava() != 0) {                         
             throw new BuildException("Execution of weblogic server failed");
         }
@@ -179,9 +306,9 @@ public class WLRun extends Task {
 
     
     /**
-     * Set the classpath to be used for this compilation.
+     * Set the classpath to be used for this execution.
      *
-     * @param s the classpath to use when executing the weblogic task.
+     * @param s the classpath to use when executing the weblogic server.
      */
     public void setClasspath(Path classpath) {
         this.classpath = classpath;
@@ -213,8 +340,18 @@ public class WLRun extends Task {
      * @param weblogicHome the home directory of weblogic.
      *
      */
-    public void setHome(String weblogicHome) {
-        weblogicSystemHome = new File(weblogicHome);
+    public void setHome(File weblogicHome) {
+        weblogicSystemHome = weblogicHome;
+    }
+
+    /**
+     * The location of the BEA Home.
+     *
+     * @param beaHome the BEA Home directory.
+     *
+     */
+    public void setBEAHome(File beaHome) {
+        this.beaHome = beaHome;
     }
     
     /**
@@ -226,6 +363,15 @@ public class WLRun extends Task {
         this.weblogicSystemName = serverName;
     }
     
+    /**
+     * Set the Domain to run in
+     *
+     * @param domain the domain
+     */
+    public void setDomain(String domain) {
+        this.weblogicDomainName = domain;
+    }
+    
     /**
      * Set the properties file to use.
      *
@@ -244,12 +390,41 @@ public class WLRun extends Task {
     public void setJvmargs(String args) {
         this.additionalJvmArgs = args;
     }
-    public void setArgs(String args) 
-    {
+    
+    /**
+     * Set the management username to run the server
+     *
+     * @param username the management username of the server.
+     */
+    public void setUsername(String username) {
+        this.managementUsername = username;
+    }
+    
+
+    /**
+     * Set the management password of the server
+     *
+     * @param password the management pasword of the server.
+     */
+    public void setPassword(String password) {
+        this.managementPassword = password;
+    }
+    
+    /**
+     * Set the private key password so the server can decrypt the SSL private key file.
+     *
+     * @param pkpassword the private key password,
+     */
+    public void setPKPassword(String pkpassword) {
+        this.pkPassword = pkpassword;
+    }
+    
+    public void setArgs(String args) {
         additionalArgs = args;
     }
-    public void setWeblogicMainClass(String c)
-    {
+
+    
+    public void setWeblogicMainClass(String c) {
         weblogicMainClass = c;
     }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLStop.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLStop.java
index d06eba2..f25fe40 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLStop.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WLStop.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -72,7 +72,7 @@ public class WLStop extends Task {
     /**
      * The classpath to be used. It must contains the weblogic.Admin class.
      */
-    private String classpath;
+    private Path classpath;
 
     /**
      * The weblogic username to use to request the shutdown.
@@ -94,6 +94,12 @@ public class WLStop extends Task {
      */
     private int delay = 0;
     
+    /**
+     * The location of the BEA Home under which this server is run.
+     * WL6 only
+     */
+    private File beaHome = null;
+
     /**
      * Do the work.
      *
@@ -110,16 +116,24 @@ public class WLStop extends Task {
         if (serverURL == null) {
             throw new BuildException("The url of the weblogic server must be provided.");
         }
-
-        String execClassPath = project.translatePath(classpath);
         
         Java weblogicAdmin = (Java)project.createTask("java");
         weblogicAdmin.setFork(true);
         weblogicAdmin.setClassname("weblogic.Admin");
-        String args = serverURL + " SHUTDOWN " + username + " " + password + " " + delay;
+        String args;
+        
+        if (beaHome == null) {
+            args = serverURL + " SHUTDOWN " + username + " " + password + " " + delay;
+        }
+        else {
+            args = " -url " + serverURL + 
+                   " -username " + username +
+                   " -password " + password +
+                   " SHUTDOWN " + " " + delay;
+        }            
 
         weblogicAdmin.setArgs(args);
-        weblogicAdmin.setClasspath(new Path(project, execClassPath));                         
+        weblogicAdmin.setClasspath(classpath);                         
         weblogicAdmin.execute();
     }
     
@@ -128,10 +142,20 @@ public class WLStop extends Task {
      *
      * @param s the classpath to use when executing the weblogic admin task.
      */
-    public void setClasspath(String s) {
-        this.classpath = project.translatePath(s);
+    public void setClasspath(Path path) {
+        this.classpath = path;
     }
     
+    /**
+     * Add the classpath for the user classes
+     */
+    public Path createClasspath() {
+        if (classpath == null) {
+            classpath = new Path(project);
+        }
+        return classpath.createPath();
+    }
+
     /**
      * Set the username to use to request shutdown of the server.
      *
@@ -168,4 +192,15 @@ public class WLStop extends Task {
     public void setDelay(String s) {
         delay = Integer.parseInt(s);
     }
+
+    /**
+     * The location of the BEA Home.
+     *
+     * @param beaHome the BEA Home directory.
+     *
+     */
+    public void setBEAHome(File beaHome) {
+        this.beaHome = beaHome;
+    }
+    
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicDeploymentTool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicDeploymentTool.java
index e336b38..cfa1546 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicDeploymentTool.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicDeploymentTool.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -55,20 +55,38 @@
 package org.apache.tools.ant.taskdefs.optional.ejb;
 
 import java.io.*;
+import java.util.jar.*;
 import java.util.*;
+import java.net.*;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.Project;
-import org.apache.tools.ant.Task;
-import org.apache.tools.ant.types.Path;
-import org.apache.tools.ant.types.Commandline;
+import javax.xml.parsers.*;
+import org.xml.sax.*;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
 import org.apache.tools.ant.taskdefs.Java;
 
 public class WeblogicDeploymentTool extends GenericDeploymentTool {
-    protected static final String WL_DD     = "weblogic-ejb-jar.xml";
+    public static final String PUBLICID_EJB11
+        = "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN";
+    public static final String PUBLICID_EJB20
+        = "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN";
+
+    public static final String PUBLICID_WEBLOGIC_EJB
+        = "-//BEA Systems, Inc.//DTD WebLogic 5.1.0 EJB//EN";
+    
+    protected static final String DEFAULT_WL51_EJB11_DTD_LOCATION 
+        = "/weblogic/ejb/deployment/xml/ejb-jar.dtd";
+    protected static final String DEFAULT_WL60_EJB11_DTD_LOCATION 
+        = "/weblogic/ejb20/dd/xml/ejb11-jar.dtd";
+    protected static final String DEFAULT_WL60_EJB20_DTD_LOCATION 
+        = "/weblogic/ejb20/dd/xml/ejb20-jar.dtd";
+
+    protected static final String DEFAULT_WL_DTD_LOCATION 
+        = "/weblogic/ejb/deployment/xml/weblogic-ejb-jar.dtd";
+
+    protected static final String WL_DD = "weblogic-ejb-jar.xml";
     protected static final String WL_CMP_DD = "weblogic-cmp-rdbms-jar.xml";
-    protected static final String WL_DTD     = "/weblogic/ejb/deployment/xml/ejb-jar.dtd";
-    protected static final String WL_HTTP_DTD     = "http://www.bea.com/servers/wls510/dtd/weblogic-ejb-jar.dtd";
 
     /** Instance variable that stores the suffix for the weblogic jarfile. */
     private String jarSuffix = ".jar";
@@ -76,8 +94,9 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
     /** Instance variable that stores the location of the weblogic DTD file. */
     private String weblogicDTD;
 
-    private Path classpath;
-
+    /** Instance variable that stores the location of the ejb 1.1 DTD file. */
+    private String ejb11DTD;
+        
     /** Instance variable that determines whether generic ejb jars are kept. */
 
     private boolean keepgenerated = false;
@@ -87,22 +106,46 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
     private boolean keepGeneric = false;
 
     private String compiler = null;
-    
+
+    private boolean alwaysRebuild = true;
+
+    /**
+     * Indicates if the old CMP location convention is to be used.
+     */
+    private boolean newCMP = false;
+
+    /** The classpath to the weblogic classes. */
+    private Path wlClasspath = null;
+
     /**
-     * Set the classpath to be used for this compilation.
+     * Get the classpath to the weblogic classpaths
      */
-    public void setClasspath(Path classpath) {
-        this.classpath = classpath;
+    public Path createWLClasspath() {
+        if (wlClasspath == null) {
+            wlClasspath = new Path(getTask().getProject());
+        }
+        return wlClasspath.createPath();
+    }
+    
+    public void setWLClasspath(Path wlClasspath) {
+        this.wlClasspath = wlClasspath;
     }
 
     /**
      * The compiler (switch <code>-compiler</code>) to use
      */
-    public void setCompiler(String compiler) 
-    {
+    public void setCompiler(String compiler) {
         this.compiler = compiler;
     }
     
+    /**
+     * Set the rebuild flag to false to only update changes in the
+     * jar rather than rerunning ejbc
+     */
+    public void setRebuild(boolean rebuild) {
+        this.alwaysRebuild = rebuild;
+    }
+    
 
     /**
      * Setter used to store the suffix for the generated weblogic jar file.
@@ -125,69 +168,173 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
      * the .java source files are kept).
      * @param inValue either 'true' or 'false'
      */
-    public void setKeepgenerated(String inValue) 
-    {
+    public void setKeepgenerated(String inValue) {
         this.keepgenerated = Boolean.valueOf(inValue).booleanValue();
     }
 
     /**
      * sets some additional args to send to ejbc.
      */
-    public void setArgs(String args) 
-    {
+    public void setArgs(String args) {
         this.additionalArgs = args;
     }
     
     
     /**
-     * Setter used to store the location of the weblogic DTD. This can be a file on the system 
+     * Setter used to store the location of the ejb-jar DTD. This can be a file on the system 
      * or a resource on the classpath. 
      * @param inString the string to use as the DTD location.
      */
     public void setWeblogicdtd(String inString) {
+        setEJBdtd(inString);
+    }
+
+    /**
+     * Setter used to store the location of the weblogic DTD. This can be a file on the system 
+     * or a resource on the classpath. 
+     * @param inString the string to use as the DTD location.
+     */
+    public void setWLdtd(String inString) {
         this.weblogicDTD = inString;
     }
 
+    /**
+     * Setter used to store the location of the Sun's Generic EJB DTD. 
+     * This can be a file on the system or a resource on the classpath. 
+     * @param inString the string to use as the DTD location.
+     */
+    public void setEJBdtd(String inString) {
+        this.ejb11DTD = inString;
+    }
+
+    /**
+     * Set the value of the oldCMP scheme. This is an antonym for
+     * newCMP
+     */
+    public void setOldCMP(boolean oldCMP) {
+        this.newCMP = !oldCMP;
+    }
+    
+    /**
+     * Set the value of the newCMP scheme. The old CMP scheme locates the 
+     * weblogic CMP descriptor based on the naming convention where the 
+     * weblogic CMP file is expected to be named with the bean name as the prefix.
+     * 
+     * Under this scheme the name of the CMP descriptor does not match the name
+     * actually used in the main weblogic EJB descriptor. Also, descriptors which 
+     * contain multiple CMP references could not be used.
+     *
+     */
+    public void setNewCMP(boolean newCMP) {
+        this.newCMP = newCMP;
+    }
+    
+
     protected DescriptorHandler getDescriptorHandler(File srcDir) {
         DescriptorHandler handler = new DescriptorHandler(srcDir);
-        if (weblogicDTD != null) {
-            // is the DTD a local file?
-            File dtdFile = new File(weblogicDTD);
-            if (dtdFile.exists()) {
-                handler.registerFileDTD("-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN",
-                                        dtdFile);
-            } else {
-                handler.registerResourceDTD("-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN",
-                                            weblogicDTD);
-            }                                            
-        } else {
-            handler.registerResourceDTD("-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN",
-                                        WL_DTD);
+        // register all the DTDs, both the ones that are known and
+        // any supplied by the user
+        handler.registerDTD(PUBLICID_EJB11, DEFAULT_WL51_EJB11_DTD_LOCATION);
+        handler.registerDTD(PUBLICID_EJB11, DEFAULT_WL60_EJB11_DTD_LOCATION);
+        handler.registerDTD(PUBLICID_EJB11, ejb11DTD);
+        handler.registerDTD(PUBLICID_EJB20, DEFAULT_WL60_EJB20_DTD_LOCATION);
+        
+        
+        for (Iterator i = getConfig().dtdLocations.iterator(); i.hasNext();) {
+            EjbJar.DTDLocation dtdLocation = (EjbJar.DTDLocation)i.next();
+            handler.registerDTD(dtdLocation.getPublicId(), dtdLocation.getLocation());
         }
         
         return handler;                                    
     }
 
+    protected DescriptorHandler getWeblogicDescriptorHandler(final File srcDir) {
+        DescriptorHandler handler = 
+            new DescriptorHandler(srcDir) {        
+                protected void processElement() {
+                    if (currentElement.equals("type-storage")) {
+                        // Get the filename of vendor specific descriptor
+                        String fileNameWithMETA = currentText;
+                        //trim the META_INF\ off of the file name
+                        String fileName = fileNameWithMETA.substring(META_DIR.length(), 
+                                                                     fileNameWithMETA.length() );
+                        File descriptorFile = new File(srcDir, fileName);
+                        
+                        ejbFiles.put(fileNameWithMETA, descriptorFile);
+                    }
+                }
+            };
+
+        handler.registerDTD(PUBLICID_WEBLOGIC_EJB, 
+                            weblogicDTD == null ? DEFAULT_WL_DTD_LOCATION : weblogicDTD);
+                            
+        for (Iterator i = getConfig().dtdLocations.iterator(); i.hasNext();) {
+            EjbJar.DTDLocation dtdLocation = (EjbJar.DTDLocation)i.next();
+            handler.registerDTD(dtdLocation.getPublicId(), dtdLocation.getLocation());
+        }
+        return handler;                                    
+    }
+
     /**
      * Add any vendor specific files which should be included in the 
      * EJB Jar.
      */
     protected void addVendorFiles(Hashtable ejbFiles, String baseName) {
-        String ddPrefix = (usingBaseJarName() ? "" : baseName + getBaseNameTerminator());
+        String ddPrefix = (usingBaseJarName() ? "" : baseName + getConfig().baseNameTerminator);
 
-        File weblogicDD = new File(getDescriptorDir(), ddPrefix + WL_DD);
+        File weblogicDD = new File(getConfig().descriptorDir, ddPrefix + WL_DD);
 
         if (weblogicDD.exists()) {
             ejbFiles.put(META_DIR + WL_DD,
                          weblogicDD);
         }
+        else {
+            log("Unable to locate weblogic deployment descriptor. It was expected to be in " + 
+                weblogicDD.getPath(), Project.MSG_WARN);
+            return;
+        }
 
-        // The the weblogic cmp deployment descriptor
-        File weblogicCMPDD = new File(getDescriptorDir(), ddPrefix + WL_CMP_DD);
-
-        if (weblogicCMPDD.exists()) {
-            ejbFiles.put(META_DIR + WL_CMP_DD,
-                         weblogicCMPDD);
+        if (!newCMP) {
+            log("The old method for locating CMP files has been DEPRECATED.", Project.MSG_VERBOSE);
+            log("Please adjust your weblogic descriptor and set newCMP=\"true\" " +
+                "to use the new CMP descriptor inclusion mechanism. ", Project.MSG_VERBOSE);
+            // The the weblogic cmp deployment descriptor
+            File weblogicCMPDD = new File(getConfig().descriptorDir, ddPrefix + WL_CMP_DD);
+                
+            if (weblogicCMPDD.exists()) {
+                ejbFiles.put(META_DIR + WL_CMP_DD,
+                             weblogicCMPDD);
+            }
+        }
+        else {
+            // now that we have the weblogic descriptor, we parse the file
+            // to find other descriptors needed to deploy the bean.
+            // this could be the weblogic-cmp-rdbms.xml or any other O/R
+            // mapping tool descriptors.
+            try
+            {
+                File ejbDescriptor = (File)ejbFiles.get(META_DIR + EJB_DD);
+                SAXParserFactory saxParserFactory = SAXParserFactory.newInstance();
+                saxParserFactory.setValidating(true);
+                SAXParser saxParser = saxParserFactory.newSAXParser();
+                DescriptorHandler handler = getWeblogicDescriptorHandler(ejbDescriptor.getParentFile());
+                saxParser.parse(new InputSource
+                                (new FileInputStream
+                                (weblogicDD)),
+                                handler);
+                                
+                Hashtable ht = handler.getFiles();
+                Enumeration e = ht.keys();
+                while(e.hasMoreElements()){
+                    String key = (String)e.nextElement();
+                    ejbFiles.put(key, ht.get(key));
+                }
+            }
+            catch(Exception e)
+            { 
+                String msg = "Exception while adding Vendor specific files: " + e.toString();
+                throw new BuildException(msg, e);
+            }
         }
     }
     
@@ -220,22 +367,28 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
                 args += " -compiler " + compiler;
             }
             
-            args += " -noexit " + sourceJar.getPath() + " " + destJar.getPath();
+            args += " " + sourceJar.getPath() + " " + destJar.getPath();
             
             javaTask = (Java) getTask().getProject().createTask("java");
+            javaTask.setTaskName("ejbc");
             javaTask.setClassname("weblogic.ejbc");
             Commandline.Argument arguments = javaTask.createArg();
             arguments.setLine(args);
+            Path classpath = wlClasspath;
+            if (classpath == null) {
+                classpath = getCombinedClasspath();
+            }
+            
             if (classpath != null) {
                 javaTask.setClasspath(classpath);
                 javaTask.setFork(true);
             }
             else {
-                javaTask.setFork(false);
+                javaTask.setFork(true);
             }
             
 
-            getTask().log("Calling weblogic.ejbc for " + sourceJar.toString(),
+            log("Calling weblogic.ejbc for " + sourceJar.toString(),
                           Project.MSG_VERBOSE);
 
             javaTask.execute();
@@ -257,9 +410,12 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
         File genericJarFile = super.getVendorOutputJarFile(baseName);
         super.writeJar(baseName, genericJarFile, files);
         
-        buildWeblogicJar(genericJarFile, jarFile);
+        if (alwaysRebuild || isRebuildRequired(genericJarFile, jarFile))
+        {
+            buildWeblogicJar(genericJarFile, jarFile);
+        }
         if (!keepGeneric) {
-             getTask().log("deleting generic jar " + genericJarFile.toString(),
+             log("deleting generic jar " + genericJarFile.toString(),
                            Project.MSG_VERBOSE);
              genericJarFile.delete();
         }
@@ -272,4 +428,236 @@ public class WeblogicDeploymentTool extends GenericDeploymentTool {
     public void validateConfigured() throws BuildException {
         super.validateConfigured();
     }
+
+    
+    /**
+     * Helper method to check to see if a weblogic EBJ1.1 jar needs to be rebuilt using 
+     * ejbc.  Called from writeJar it sees if the "Bean" classes  are the only thing that needs
+     * to be updated and either updates the Jar with the Bean classfile or returns true,
+     * saying that the whole weblogic jar needs to be regened with ejbc.  This allows faster 
+     * build times for working developers.
+     * <p>
+     * The way weblogic ejbc works is it creates wrappers for the publicly defined methods as 
+     * they are exposed in the remote interface.  If the actual bean changes without changing the 
+     * the method signatures then only the bean classfile needs to be updated and the rest of the 
+     * weblogic jar file can remain the same.  If the Interfaces, ie. the method signatures change 
+     * or if the xml deployment dicriptors changed, the whole jar needs to be rebuilt with ejbc.  
+     * This is not strictly true for the xml files.  If the JNDI name changes then the jar doesnt
+     * have to be rebuild, but if the resources references change then it does.  At this point the
+     * weblogic jar gets rebuilt if the xml files change at all.
+     *
+     * @param genericJarFile java.io.File The generic jar file.
+     * @param weblogicJarFile java.io.File The weblogic jar file to check to see if it needs to be rebuilt.
+     */
+    protected boolean isRebuildRequired(File genericJarFile, File weblogicJarFile)
+    {
+        boolean rebuild = false;
+
+        JarFile genericJar = null;
+        JarFile wlJar = null;
+        File newWLJarFile = null;
+        JarOutputStream newJarStream = null;
+        
+        try 
+        {
+            log("Checking if weblogic Jar needs to be rebuilt for jar " + weblogicJarFile.getName(),
+                Project.MSG_VERBOSE);
+            // Only go forward if the generic and the weblogic file both exist
+            if (genericJarFile.exists() && genericJarFile.isFile() 
+                && weblogicJarFile.exists() && weblogicJarFile.isFile())
+            {
+                //open jar files
+                genericJar = new JarFile(genericJarFile);
+                wlJar = new JarFile(weblogicJarFile);
+
+                Hashtable genericEntries = new Hashtable();
+                Hashtable wlEntries = new Hashtable();
+                Hashtable replaceEntries = new Hashtable();
+                
+                //get the list of generic jar entries
+                for (Enumeration e = genericJar.entries(); e.hasMoreElements();)
+                {
+                    JarEntry je = (JarEntry)e.nextElement();
+                    genericEntries.put(je.getName().replace('\\', '/'), je);
+                }
+                //get the list of weblogic jar entries
+                for (Enumeration e = wlJar.entries() ; e.hasMoreElements();)
+                {
+                    JarEntry je = (JarEntry)e.nextElement();
+                    wlEntries.put(je.getName(), je);
+                }
+
+                //Cycle Through generic and make sure its in weblogic
+                ClassLoader genericLoader = getClassLoaderFromJar(genericJarFile);
+                for (Enumeration e = genericEntries.keys(); e.hasMoreElements();)
+                {
+                    String filepath = (String)e.nextElement();
+                    if (wlEntries.containsKey(filepath))    // File name/path match
+                    {
+                        // Check files see if same
+                        JarEntry genericEntry = (JarEntry)genericEntries.get(filepath);
+                        JarEntry wlEntry = (JarEntry)wlEntries.get(filepath);
+                        if ((genericEntry.getCrc() !=  wlEntry.getCrc())  || // Crc's Match
+                            (genericEntry.getSize() != wlEntry.getSize()) ) // Size Match
+                        {
+                            if (genericEntry.getName().endsWith(".class"))
+                            {
+                                //File are different see if its an object or an interface
+                                String classname = genericEntry.getName().replace(File.separatorChar,'.');
+                                classname = classname.substring(0,classname.lastIndexOf(".class"));
+                                Class genclass = genericLoader.loadClass(classname);
+                                if (genclass.isInterface())
+                                {
+                                    //Interface changed   rebuild jar.
+                                    log("Interface " + genclass.getName() + " has changed",Project.MSG_VERBOSE);
+                                    rebuild = true;
+                                    break;
+                                }
+                                else
+                                {
+                                    //Object class Changed   update it.
+                                    replaceEntries.put(filepath, genericEntry);
+                                }
+                            }
+                            else
+                            {
+                                // is it the manifest. If so ignore it
+                                if (!genericEntry.getName().equals("META-INF/MANIFEST.MF")) {
+                                    //File other then class changed   rebuild
+                                    log("Non class file " + genericEntry.getName() + " has changed",Project.MSG_VERBOSE);
+                                    rebuild = true;
+                                }
+                                break;
+                            }
+                        }
+                    }
+                    else // a file doesnt exist rebuild
+                    {
+                        log("File " + filepath + " not present in weblogic jar",Project.MSG_VERBOSE);
+                        rebuild =  true;
+                        break;
+                    }
+                }
+                
+                if (!rebuild)
+                {
+                    log("No rebuild needed - updating jar",Project.MSG_VERBOSE);
+                    newWLJarFile = new File(weblogicJarFile.getAbsolutePath() + ".temp");
+                    if (newWLJarFile.exists()) {
+                        newWLJarFile.delete();
+                    }
+                    
+                    newJarStream = new JarOutputStream(new FileOutputStream(newWLJarFile));
+                    newJarStream.setLevel(0);
+                    
+                    //Copy files from old weblogic jar
+                    for (Enumeration e = wlEntries.elements() ; e.hasMoreElements();)
+                    {
+                        byte[] buffer = new byte[1024];
+                        int bytesRead;
+                        InputStream is;
+                        JarEntry je = (JarEntry)e.nextElement();
+                        if (je.getCompressedSize() == -1 ||
+                                je.getCompressedSize() == je.getSize()) {
+                            newJarStream.setLevel(0);
+                        }
+                        else {
+                            newJarStream.setLevel(9);
+                        }
+                            
+                        // Update with changed Bean class
+                        if (replaceEntries.containsKey(je.getName()))
+                        {
+                            log("Updating Bean class from generic Jar " + je.getName(),Project.MSG_VERBOSE);
+                            // Use the entry from the generic jar
+                            je = (JarEntry)replaceEntries.get(je.getName());
+                            is = genericJar.getInputStream(je);
+                        }   
+                        else  //use fle from original weblogic jar
+                        {
+                            is = wlJar.getInputStream(je);
+                        }
+                        newJarStream.putNextEntry(new JarEntry(je.getName()));
+
+                        while ((bytesRead = is.read(buffer)) != -1)
+                        {
+                            newJarStream.write(buffer,0,bytesRead);
+                        }
+                        is.close();
+                    }
+                }
+                else
+                {
+                    log("Weblogic Jar rebuild needed due to changed interface or XML",Project.MSG_VERBOSE);
+                }       
+            }
+            else
+            {
+                rebuild = true;
+            }
+        }
+        catch(ClassNotFoundException cnfe)
+        {
+            String cnfmsg = "ClassNotFoundException while processing ejb-jar file"
+                + ". Details: "
+                + cnfe.getMessage();
+            throw new BuildException(cnfmsg, cnfe);
+        }
+        catch(IOException ioe) {
+            String msg = "IOException while processing ejb-jar file "
+                + ". Details: "
+                + ioe.getMessage();
+            throw new BuildException(msg, ioe);
+        }
+        finally {
+            // need to close files and perhaps rename output
+            if (genericJar != null) {
+                try {
+                    genericJar.close();
+                }
+                catch (IOException closeException) {}
+            }
+            
+            if (wlJar != null) {
+                try {
+                    wlJar.close();
+                }
+                catch (IOException closeException) {}
+            }
+            
+            if (newJarStream != null) {
+                try {
+                    newJarStream.close();
+                }
+                catch (IOException closeException) {}
+
+                weblogicJarFile.delete();
+                newWLJarFile.renameTo(weblogicJarFile);
+                if (!weblogicJarFile.exists()) {
+                    rebuild = true;
+                }
+            }
+        }
+
+        return rebuild;
+    }
+    
+    /**
+    * Helper method invoked by isRebuildRequired to get a ClassLoader for 
+    * a Jar File passed to it.
+    *
+    * @param classjar java.io.File representing jar file to get classes from.
+    */
+    protected ClassLoader getClassLoaderFromJar(File classjar) throws IOException
+    {
+        Path lookupPath = new Path(getTask().getProject());
+        lookupPath.setLocation(classjar);
+        
+        Path classpath = getCombinedClasspath();
+        if (classpath != null) {
+            lookupPath.append(classpath);
+        }
+        
+        return new AntClassLoader(getTask().getProject(), lookupPath);
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicTOPLinkDeploymentTool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicTOPLinkDeploymentTool.java
index c0186f5..02aa7dd 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicTOPLinkDeploymentTool.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ejb/WeblogicTOPLinkDeploymentTool.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -89,11 +89,11 @@ public class WeblogicTOPLinkDeploymentTool extends WeblogicDeploymentTool {
     protected DescriptorHandler getDescriptorHandler(File srcDir) {
         DescriptorHandler handler = super.getDescriptorHandler(srcDir);
         if (toplinkDTD != null) {
-            handler.registerResourceDTD("-//The Object People, Inc.//DTD TOPLink for WebLogic CMP 2.5.1//EN",
-                                        toplinkDTD);
+            handler.registerDTD("-//The Object People, Inc.//DTD TOPLink for WebLogic CMP 2.5.1//EN",
+                                toplinkDTD);
         } else {
-            handler.registerResourceDTD("-//The Object People, Inc.//DTD TOPLink for WebLogic CMP 2.5.1//EN",
-                                        TL_DTD_LOC);
+            handler.registerDTD("-//The Object People, Inc.//DTD TOPLink for WebLogic CMP 2.5.1//EN",
+                                TL_DTD_LOC);
         }
         return handler;                                    
     }
@@ -108,12 +108,25 @@ public class WeblogicTOPLinkDeploymentTool extends WeblogicDeploymentTool {
 
         // Setup a naming standard here?.
 
-        File toplinkDD = new File(getDescriptorDir(), toplinkDescriptor);
 
+        File toplinkDD = null;
+        if (usingBaseJarName()) {
+            toplinkDD = new File(getConfig().descriptorDir, toplinkDescriptor);
+        }
+        else {
+            String ddPrefix = baseName + getConfig().baseNameTerminator;
+            File actualDir = (new File(getConfig().descriptorDir, ddPrefix)).getParentFile();
+            toplinkDD = new File(actualDir, toplinkDescriptor);
+        }
+        
         if (toplinkDD.exists()) {
             ejbFiles.put(META_DIR + toplinkDescriptor,
                          toplinkDD);
         }
+        else {
+            log("Unable to locate toplink deployment descriptor. It was expected to be in " + 
+                toplinkDD.getPath(), Project.MSG_WARN);
+        }                
     }
     
     /**
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntTool.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntTool.java
new file mode 100644
index 0000000..6fdbe83
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntTool.java
@@ -0,0 +1,131 @@
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+import com.ibm.ivj.util.base.Project;
+import com.ibm.ivj.util.base.ToolData;
+import com.ibm.ivj.util.base.IvjException;
+import org.apache.tools.ant.BuildException;
+
+/**
+ * This class is the equivalent to org.apache.tools.ant.Main for the
+ * VAJ tool environment. It's main is called when the user selects
+ * Tools->Ant Build from the VAJ project menu.
+ * Additionally this class provides methods to save build info for
+ * a project in the repository and load it from the repository
+ *
+ * @author: Wolf Siberski
+ */
+public class VAJAntTool {
+	private static final String TOOL_DATA_KEY = "AntTool";
+/**
+ * Loads the BuildInfo for the specified VAJ project from the
+ * tool data for this project.
+ * If there is no build info stored for that project, a new
+ * default BuildInfo is returned
+ * 
+ * @return BuildInfo buildInfo build info for the specified project
+ * @param projectName String project name
+ */
+public static VAJBuildInfo loadBuildData(String projectName) {
+	VAJBuildInfo result = null;
+	try {
+		Project project = VAJUtil.getWorkspace().loadedProjectNamed( projectName );
+		if ( project.testToolRepositoryData(TOOL_DATA_KEY) ) {
+			ToolData td = project.getToolRepositoryData(TOOL_DATA_KEY);
+			String data = (String)td.getData();
+			result = VAJBuildInfo.parse( data );
+		} else {
+			result = new VAJBuildInfo();
+		}
+		result.setVAJProjectName( projectName );
+	} catch (Throwable t) {
+		System.out.println("BuildInfo for Project " + projectName + 
+			" could not be loaded" + t);
+		throw new BuildException(t);
+	}
+	return result;
+}
+/**
+ * Starts the application.
+ * @param args an array of command-line arguments
+ */
+public static void main(java.lang.String[] args) {
+	VAJBuildInfo info;
+	if ( args.length >= 2 && args[1] instanceof String ) {
+		String projectName = (String)args[1];
+		info = loadBuildData( projectName );
+	} 
+	else {
+		info = new VAJBuildInfo();
+	}
+	
+	VAJAntToolGUI mainFrame = new VAJAntToolGUI( info );
+	mainFrame.show();
+}
+/**
+ * Saves the BuildInfo for a project in the VAJ repository.
+ * @param info BuildInfo build info to save
+ */
+public static void saveBuildData(VAJBuildInfo info) {
+	String data = info.asDataString();
+	try {
+		ToolData td = new ToolData( TOOL_DATA_KEY, data );
+		VAJUtil.getWorkspace().loadedProjectNamed( info.getVAJProjectName() ).setToolRepositoryData( td );
+	} catch (Throwable t) {
+		throw new BuildException("BuildInfo for Project " + info.getVAJProjectName() + 
+			" could not be saved", t);
+	}
+}
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntToolGUI.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntToolGUI.java
new file mode 100644
index 0000000..77112ca
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJAntToolGUI.java
@@ -0,0 +1,1391 @@
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+import java.util.Vector;
+import java.awt.Frame;
+import java.awt.Dialog;
+import java.awt.Panel;
+import java.awt.MenuBar;
+import java.awt.Menu;
+import java.awt.MenuItem;
+import java.awt.Label;
+import java.awt.TextField;
+import java.awt.TextArea;
+import java.awt.List;
+import java.awt.Choice;
+import java.awt.Button;
+import java.awt.FileDialog;
+import java.awt.FlowLayout;
+import java.awt.BorderLayout;
+import java.awt.GridBagLayout;
+import java.awt.GridBagConstraints;
+import java.awt.Insets;
+import java.awt.Toolkit;
+import java.awt.Font;
+import java.awt.SystemColor;
+import java.awt.event.ActionListener;
+import java.awt.event.ItemListener;
+import java.awt.event.TextListener;
+import java.awt.event.WindowListener;
+import java.awt.event.ActionEvent;
+import java.awt.event.ItemEvent;
+import java.awt.event.TextEvent;
+import java.awt.event.WindowEvent;
+import java.beans.PropertyChangeListener;
+import org.apache.tools.ant.Main;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.BuildListener;
+import org.apache.tools.ant.BuildEvent;
+import org.apache.tools.ant.Project;
+
+/**
+ * This is a simple grafical user interface to provide the information needed by ANT and
+ * to start the build-process within IBM VisualAge for Java.
+ * <p>
+ * I was using AWT to make it independent from the JDK-version. Please don't ask me for a Swing-version:
+ * I am very familiar with Swing and I really think that it's not necessary for such a simple gui!
+ * <p>
+ * It is completely developed in VAJ using the visual composition editor. About 90% of the code is generated by VAJ,
+ * but in fact I did a lot of <i>code-beautification</i> ;-).
+ * <p>
+ * @version 1.0 h
+ * @author: Christoph Wilhelms, TUI Infotec GmbH
+ */
+public class VAJAntToolGUI extends Frame {
+	/**
+	 * Members 
+	 */
+	private VAJBuildLogger logger = new VAJBuildLogger();
+	private String lineSeparator = "\r\n";
+	private PrivateEventHandler iEventHandler = new PrivateEventHandler();
+
+	/**
+	 * Members of the main-window
+	 */
+	// main model
+	private VAJBuildInfo iBuildInfo = null;
+	// Menue
+	private MenuBar iAntMakeMenuBar = null;
+	private Menu iFileMenu = null;
+	private MenuItem iSaveMenuItem = null;
+	private MenuItem iMenuSeparator = null;
+	private MenuItem iShowLogMenuItem = null;
+	private Menu iHelpMenu = null;
+	private MenuItem iAboutMenuItem = null;
+	// Container
+	private Panel iContentsPane = null;
+	private Panel iOptionenPanel = null;
+	private Panel iCommandButtonPanel = null;
+	private FlowLayout iCommandButtonPanelFlowLayout = null;
+	// Project name
+	private Label iProjectLabel = null;
+	private Label iProjectText = null;
+	// XML-file 
+	private Label iBuildFileLabel = null;
+	private TextField iBuildFileTextField = null;
+	private boolean iConnPtoP2Aligning = false;
+	private Button iBrowseButton = null;
+	private FileDialog iFileDialog = null;
+	// Options
+	private Choice iMessageOutputLevelChoice = null;
+	private Label iMessageOutputLevelLabel = null;
+	private Label iTargetLabel = null;
+	private List iTargetList = null;
+	// Command-buttons
+	private Button iBuildButton = null;
+	private Button iReloadButton = null;	
+	private Button iCloseButton = null;
+	/**
+	 * log-Window
+	 */
+	// Container
+	private Frame iMessageFrame = null;
+	private Panel iMessageCommandPanel = null;
+	private Panel iMessageContentPanel = null;
+	// Components
+	private TextArea iMessageTextArea = null;
+	private Button iMessageOkButton = null;
+	private Button iMessageClearLogButton = null;
+	/**
+	 * About-dialog
+	 */
+	// Container
+	private Dialog iAboutDialog = null;
+	private Panel iAboutDialogContentPanel = null;
+	private Panel iAboutInfoPanel = null;
+	private Panel iAboutCommandPanel = null;
+	// Labels
+	private Label iAboutTitleLabel = null;
+	private Label iAboutDevLabel = null;
+	private Label iAboutContactLabel = null;
+	// Buttons
+	private Button iAboutOkButton = null;
+
+	/**
+	 * This internal BuildLogger, to be honest, is just a BuildListener. 
+	 * It does nearly the same as the DefaultLogger, but uses the Loggin-Window for output.
+	 */
+	private class VAJBuildLogger implements BuildListener {
+		private long startTime = System.currentTimeMillis();
+
+		/**
+		 * VAJBuildLogger constructor comment.
+		 */
+		public VAJBuildLogger() {
+			super();
+		}
+
+		/**
+		 *  Fired after the last target has finished. This event
+		 *  will still be thrown if an error occured during the build.
+		 *
+		 *  @see BuildEvent#getException()
+		 */
+		public void buildFinished(BuildEvent event) {
+			Throwable error = event.getException();
+
+			if (error == null) {
+				getMessageTextArea().append(lineSeparator + "BUILD SUCCESSFUL");
+			}
+			else {
+				getMessageTextArea().append(lineSeparator + "BUILD FAILED" + lineSeparator);
+
+				if (error instanceof BuildException) {
+					getMessageTextArea().append(error.toString());
+
+					Throwable nested = ((BuildException)error).getException();
+					if (nested != null) {
+						nested.printStackTrace(System.err);
+					}
+				}
+				else {
+					error.printStackTrace(System.err);
+				}
+			}
+
+			getMessageTextArea().append(lineSeparator + "Total time: " + formatTime(System.currentTimeMillis() - startTime));
+		}
+
+		/**
+		 *  Fired before any targets are started.
+		 */
+		public void buildStarted(BuildEvent event) {
+			startTime = System.currentTimeMillis();
+			getMessageTextArea().append(lineSeparator);
+		}
+
+		/**
+		 *  Fired whenever a message is logged.
+		 *
+		 *  @see BuildEvent#getMessage()
+		 *  @see BuildEvent#getPriority()
+		 */
+		public void messageLogged(BuildEvent event) {
+			if (event.getPriority() <= getBuildInfo().getOutputMessageLevel()) {
+				String msg = "";
+				if (event.getTask() != null)
+					msg = "[" + event.getTask().getTaskName() + "] ";
+				getMessageTextArea().append(lineSeparator + msg + event.getMessage());
+			}
+		}
+
+		/**
+		 *  Fired when a target has finished. This event will
+		 *  still be thrown if an error occured during the build.
+		 *
+		 *  @see BuildEvent#getException()
+		 */
+		public void targetFinished(BuildEvent event) {
+		}
+
+		/**
+		 *  Fired when a target is started.
+		 *
+		 *  @see BuildEvent#getTarget()
+		 */
+		public void targetStarted(BuildEvent event) {
+			if (getBuildInfo().getOutputMessageLevel() <= Project.MSG_INFO) {
+				getMessageTextArea().append(lineSeparator + event.getTarget().getName() + ":");
+			}
+		}
+
+		/**
+		 *  Fired when a task has finished. This event will still
+		 *  be throw if an error occured during the build.
+		 *
+		 *  @see BuildEvent#getException()
+		 */
+		public void taskFinished(BuildEvent event) {
+		}
+
+		/**
+		 *  Fired when a task is started.
+		 *
+		 *  @see BuildEvent#getTask()
+		 */
+		public void taskStarted(BuildEvent event) {
+		}
+		/**
+		 * Chris: HACK: remove when Ant-Refactoring is finished!
+		 */
+		public void buildSuccessful() {
+			getMessageTextArea().append(lineSeparator + "BUILD SUCCESSFUL");
+			getMessageTextArea().append(lineSeparator + "Total time: " + formatTime(System.currentTimeMillis() - startTime));
+		}
+		/**
+		 * Chris: HACK: remove when Ant-Refactoring is finished!
+		 */
+		public void buildFailed(Throwable exc) {
+			getMessageTextArea().append(lineSeparator + "BUILD FAILED" + lineSeparator);
+
+			if (exc instanceof BuildException) {
+				getMessageTextArea().append(exc.toString());
+
+				Throwable nested = ((BuildException)exc).getException();
+				if (nested != null) {
+					nested.printStackTrace(System.err);
+				}
+			}
+			else {
+				exc.printStackTrace(System.err);
+			}
+			getMessageTextArea().append(lineSeparator + "Total time: " + formatTime(System.currentTimeMillis() - startTime));
+		}
+	}
+	
+	/**
+	 * Eventhandler to handle all AWT-events
+	 */
+	private class PrivateEventHandler implements ActionListener, ItemListener, TextListener, WindowListener, PropertyChangeListener {
+		/**
+		 * ActionListener method
+		 */
+		public void actionPerformed(ActionEvent e) {
+			try {
+				/* #### Main App-Frame #### */
+				// browse XML-File with filechooser
+				if (e.getSource() == VAJAntToolGUI.this.getBrowseButton()) {
+					getFileDialog().setDirectory(getBuildFileTextField().getText().substring(0, getBuildFileTextField().getText().lastIndexOf('\\') + 1));
+					getFileDialog().setFile("*.xml");
+					getFileDialog().show();
+					if (!getFileDialog().getFile().equals("") ) {
+						getBuildFileTextField().setText(getFileDialog().getDirectory() + getFileDialog().getFile());
+					}
+				}
+				// dispose and exit application 
+				if (e.getSource() == VAJAntToolGUI.this.getCloseButton()) {
+					dispose();
+					System.exit(0);
+				}
+				// start build-process
+				if (e.getSource() == VAJAntToolGUI.this.getBuildButton()) 
+					executeTarget();
+				if (e.getSource() == VAJAntToolGUI.this.getReloadButton()) {
+					try {
+						getBuildInfo().updateTargetList();
+						fillList();
+					}
+					catch (Throwable fileNotFound) {
+						handleException(fileNotFound);
+						getTargetList().removeAll();
+						getBuildButton().setEnabled(false);
+					}
+				}
+				// MenuItems
+				if (e.getSource() == VAJAntToolGUI.this.getSaveMenuItem()) 
+					saveBuildInfo();
+				if (e.getSource() == VAJAntToolGUI.this.getAboutMenuItem()) 
+					getAboutDialog().show();
+				if (e.getSource() == VAJAntToolGUI.this.getShowLogMenuItem()) 
+					getMessageFrame().show();
+				/* #### About dialog #### */
+				if (e.getSource() == VAJAntToolGUI.this.getAboutOkButton()) 
+					getAboutDialog().dispose();
+				/* #### Log frame #### */
+				if (e.getSource() == VAJAntToolGUI.this.getMessageOkButton())
+					getMessageFrame().dispose();
+				if (e.getSource() == VAJAntToolGUI.this.getMessageClearLogButton()) 
+					getMessageTextArea().setText("");
+				if (e.getSource() == VAJAntToolGUI.this.getMessageOkButton()) 
+					getMessageFrame().dispose();
+			}
+			catch (Throwable exc) {
+				handleException(exc);
+			}
+		}
+
+		/**
+		 * ItemListener method
+		 */
+		public void itemStateChanged(ItemEvent e) {
+			try {
+				if (e.getSource() == VAJAntToolGUI.this.getTargetList()) 
+					getBuildButton().setEnabled(true);
+				if (e.getSource() == VAJAntToolGUI.this.getMessageOutputLevelChoice()) 
+					getBuildInfo().setOutputMessageLevel(getMessageOutputLevelChoice().getSelectedIndex());
+				if (e.getSource() == VAJAntToolGUI.this.getTargetList()) 
+					getBuildInfo().setTarget(getTargetList().getSelectedItem());
+			}
+			catch (Throwable exc) {
+				handleException(exc);
+			}
+		}
+		
+		/**
+		 * PropertyChangeListener method
+		 */
+		public void propertyChange(java.beans.PropertyChangeEvent evt) {
+			if (evt.getSource() == VAJAntToolGUI.this.getBuildInfo() && (evt.getPropertyName().equals("projectName"))) 
+				connectProjectNameToLabel();
+			if (evt.getSource() == VAJAntToolGUI.this.getBuildInfo() && (evt.getPropertyName().equals("buildFileName"))) 
+				connectBuildFileNameToTextField();
+		}
+		
+		/**
+		 * TextListener method
+		 */
+		public void textValueChanged(TextEvent e) {
+			if (e.getSource() == VAJAntToolGUI.this.getBuildFileTextField()) 
+				connectTextFieldToBuildFileName();
+		}
+		
+		/**
+		 * WindowListener methods
+		 */
+		public void windowClosing(WindowEvent e) {
+			try {
+				if (e.getSource() == VAJAntToolGUI.this) {
+					dispose();
+					System.exit(0);
+				}
+				if (e.getSource() == VAJAntToolGUI.this.getAboutDialog()) 
+					getAboutDialog().dispose();
+				if (e.getSource() == VAJAntToolGUI.this.getMessageFrame()) 
+					getMessageFrame().dispose();
+			}
+			catch (Throwable exc) {
+				handleException(exc);
+			}
+		}
+		public void windowActivated(WindowEvent e) {};
+		public void windowClosed(WindowEvent e) {};
+		public void windowDeactivated(WindowEvent e) {};
+		public void windowDeiconified(WindowEvent e) {};
+		public void windowIconified(WindowEvent e) {};
+		public void windowOpened(WindowEvent e) {};
+	}
+	
+	/**
+	 * AntMake default-constructor.
+	 */
+	private VAJAntToolGUI() {
+		super();
+		initialize();
+	}
+	/**
+	 * AntMake constructor called by VAJAntTool integration.
+	 * @param buildInfo VAJBuildInfo
+	 */
+	 
+	public VAJAntToolGUI(VAJBuildInfo newBuildInfo) {
+		super();
+		setBuildInfo(newBuildInfo);
+		initialize();
+	}
+	/**
+	 * This method is used to center dialogs.
+	 */
+	public static void centerDialog(Dialog dialog) {
+		dialog.setLocation((Toolkit.getDefaultToolkit().getScreenSize().width / 2) - (dialog.getSize().width / 2), (java.awt.Toolkit.getDefaultToolkit().getScreenSize().height / 2) - (dialog.getSize().height / 2));
+	}
+	/**
+	 * connectBuildFileNameToTextField:  (BuildInfo.buildFileName <--> BuildFileTextField.text)
+	 */
+	private void connectBuildFileNameToTextField() {
+		/* Set the target from the source */
+		try {
+			if (iConnPtoP2Aligning == false) {
+				iConnPtoP2Aligning = true;
+				if ((getBuildInfo() != null)) {
+					getBuildFileTextField().setText(getBuildInfo().getBuildFileName());
+				}
+				iConnPtoP2Aligning = false;
+			}
+		} catch (Throwable iExc) {
+			iConnPtoP2Aligning = false;
+			handleException(iExc);
+		}
+	}
+	/**
+	 * connectProjectNameToLabel:  (BuildInfo.vajProjectName <--> ProjectText.text)
+	 */
+	private void connectProjectNameToLabel() {
+		/* Set the target from the source */
+		try {
+			if ((getBuildInfo() != null)) {
+				getProjectText().setText(getBuildInfo().getVAJProjectName());
+			}
+		} catch (Throwable iExc) {
+			handleException(iExc);
+		}
+	}
+	/**
+	 * connectTextFieldToBuildFileName:  (BuildInfo.buildFileName <--> BuildFileTextField.text)
+	 */
+	private void connectTextFieldToBuildFileName() {
+		/* Set the source from the target */
+		try {
+			if (iConnPtoP2Aligning == false) {
+				iConnPtoP2Aligning = true;
+				if ((getBuildInfo() != null)) {
+					getBuildInfo().setBuildFileName(getBuildFileTextField().getText());
+				}
+				iConnPtoP2Aligning = false;
+			}
+		} catch (Throwable iExc) {
+			iConnPtoP2Aligning = false;
+			handleException(iExc);
+		}
+	}
+	/**
+	 * external build of a .jar-file
+	 */
+	private void executeTarget() {
+		try	{
+			getMessageFrame().show();
+			// Chris: HACK: remove when Ant-Refactoring is finished!
+			logger.buildStarted(null);
+			getBuildInfo().executeProject(logger);
+			// Chris: HACK: remove when Ant-Refactoring is finished!
+			logger.buildSuccessful();			
+		}
+		catch (Throwable exc) {
+			// We aren't interested in exceptions! All necessary information has been written to the logging-window!
+			// Unfortunately ANT-Refactoring isn't done yet!
+			// Chris: HACK: remove when Ant-Refactoring is finished!
+			logger.buildFailed( exc );			
+		}
+		return;
+	}
+	/**
+	 * Fills the taget-list with project-targets
+	 */
+	private void fillList() {
+		getTargetList().removeAll();
+		Vector targets = getBuildInfo().getProjectTargets();
+		for (int i = 0;i < targets.size(); i++) {
+			getTargetList().add(targets.elementAt(i).toString());
+		}
+		getTargetList().select(iBuildInfo.getProjectTargets().indexOf(iBuildInfo.getTarget()));
+		if (getTargetList().getSelectedIndex() >= 0) {
+			getBuildButton().setEnabled(true);
+		}
+	}
+	/**
+	 * Copied from DefaultLogger to provide the same time-format.
+	 */
+	public static String formatTime(long millis) {
+		long seconds = millis / 1000;
+		long minutes = seconds / 60;
+
+		if (minutes > 0) {
+			return Long.toString(minutes) + " minute"
+				+ (minutes == 1 ? " " : "s ")
+				+ Long.toString(seconds%60) + " second"
+				+ (seconds%60 == 1 ? "" : "s");
+		}
+		else {
+			return Long.toString(seconds) + " second"
+				+ (seconds%60 == 1 ? "" : "s");
+		}
+	}
+	/**
+	 * Return the AboutCommandPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getAboutCommandPanel() {
+		if (iAboutCommandPanel == null) {
+			try {
+				iAboutCommandPanel = new Panel();
+				iAboutCommandPanel.setName("AboutCommandPanel");
+				iAboutCommandPanel.setLayout(new java.awt.FlowLayout());
+				getAboutCommandPanel().add(getAboutOkButton(), getAboutOkButton().getName());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutCommandPanel;
+	}
+	/**
+	 * Return the AboutContactLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getAboutContactLabel() {
+		if (iAboutContactLabel == null) {
+			try {
+				iAboutContactLabel = new Label();
+				iAboutContactLabel.setName("AboutContactLabel");
+				iAboutContactLabel.setAlignment(java.awt.Label.CENTER);
+				iAboutContactLabel.setText("contact: wolf.siberski@tui.de or christoph.wilhelms@tui.de");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutContactLabel;
+	}
+	/**
+	 * Return the AboutDevLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getAboutDevLabel() {
+		if (iAboutDevLabel == null) {
+			try {
+				iAboutDevLabel = new Label();
+				iAboutDevLabel.setName("AboutDevLabel");
+				iAboutDevLabel.setAlignment(java.awt.Label.CENTER);
+				iAboutDevLabel.setText("developed by Wolf Siberski & Christoph Wilhelms");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutDevLabel;
+	}
+	/**
+	 * Return the AboutDialog property value.
+	 * @return java.awt.Dialog
+	 */
+	private Dialog getAboutDialog() {
+		if (iAboutDialog == null) {
+			try {
+				iAboutDialog = new Dialog(this);
+				iAboutDialog.setName("AboutDialog");
+				iAboutDialog.setResizable(false);
+				iAboutDialog.setLayout(new java.awt.BorderLayout());
+				iAboutDialog.setBounds(550, 14, 383, 142);
+				iAboutDialog.setModal(true);
+				iAboutDialog.setTitle("About...");
+				getAboutDialog().add(getAboutDialogContentPanel(), "Center");
+				iAboutDialog.pack();
+				centerDialog(iAboutDialog);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutDialog;
+	}
+	/**
+	 * Return the AboutDialogContentPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getAboutDialogContentPanel() {
+		if (iAboutDialogContentPanel == null) {
+			try {
+				iAboutDialogContentPanel = new Panel();
+				iAboutDialogContentPanel.setName("AboutDialogContentPanel");
+				iAboutDialogContentPanel.setLayout(new java.awt.BorderLayout());
+				getAboutDialogContentPanel().add(getAboutCommandPanel(), "South");
+				getAboutDialogContentPanel().add(getAboutInfoPanel(), "Center");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutDialogContentPanel;
+	}
+	/**
+	 * Return the AboutInfoPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getAboutInfoPanel() {
+		if (iAboutInfoPanel == null) {
+			try {
+				iAboutInfoPanel = new Panel();
+				iAboutInfoPanel.setName("AboutInfoPanel");
+				iAboutInfoPanel.setLayout(new GridBagLayout());
+
+				GridBagConstraints constraintsAboutTitleLabel = new GridBagConstraints();
+				constraintsAboutTitleLabel.gridx = 0; constraintsAboutTitleLabel.gridy = 0;
+				constraintsAboutTitleLabel.fill = GridBagConstraints.HORIZONTAL;
+				constraintsAboutTitleLabel.weightx = 1.0;
+				constraintsAboutTitleLabel.weighty = 1.0;
+				constraintsAboutTitleLabel.insets = new Insets(4, 0, 4, 0);
+				getAboutInfoPanel().add(getAboutTitleLabel(), constraintsAboutTitleLabel);
+
+				GridBagConstraints constraintsAboutDevLabel = new GridBagConstraints();
+				constraintsAboutDevLabel.gridx = 0; constraintsAboutDevLabel.gridy = 1;
+				constraintsAboutDevLabel.fill = GridBagConstraints.HORIZONTAL;
+				constraintsAboutDevLabel.weightx = 1.0;
+				constraintsAboutDevLabel.insets = new Insets(4, 0, 0, 0);
+				getAboutInfoPanel().add(getAboutDevLabel(), constraintsAboutDevLabel);
+
+				GridBagConstraints constraintsAboutContactLabel = new GridBagConstraints();
+				constraintsAboutContactLabel.gridx = 0; constraintsAboutContactLabel.gridy = 2;
+				constraintsAboutContactLabel.fill = GridBagConstraints.HORIZONTAL;
+				constraintsAboutContactLabel.weightx = 1.0;
+				constraintsAboutContactLabel.insets = new Insets(2, 0, 4, 0);
+				getAboutInfoPanel().add(getAboutContactLabel(), constraintsAboutContactLabel);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutInfoPanel;
+	}
+	/**
+	 * Return the AboutMenuItem property value.
+	 * @return java.awt.MenuItem
+	 */
+	private MenuItem getAboutMenuItem() {
+		if (iAboutMenuItem == null) {
+			try {
+				iAboutMenuItem = new MenuItem();
+				iAboutMenuItem.setLabel("About...");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutMenuItem;
+	}
+	/**
+	 * Return the AboutOkButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getAboutOkButton() {
+		if (iAboutOkButton == null) {
+			try {
+				iAboutOkButton = new Button();
+				iAboutOkButton.setName("AboutOkButton");
+				iAboutOkButton.setLabel("OK");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutOkButton;
+	}
+	/**
+	 * Return the AboutTitleLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getAboutTitleLabel() {
+		if (iAboutTitleLabel == null) {
+			try {
+				iAboutTitleLabel = new Label();
+				iAboutTitleLabel.setName("AboutTitleLabel");
+				iAboutTitleLabel.setFont(new Font("Arial", 1, 12));
+				iAboutTitleLabel.setAlignment(Label.CENTER);
+				iAboutTitleLabel.setText("Ant VisualAge for Java Tool-Integration");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAboutTitleLabel;
+	}
+	/**
+	 * Return the AntMakeMenuBar property value.
+	 * @return java.awt.MenuBar
+	 */
+	private MenuBar getAntMakeMenuBar() {
+		if (iAntMakeMenuBar == null) {
+			try {
+				iAntMakeMenuBar = new MenuBar();
+				iAntMakeMenuBar.add(getFileMenu());
+				iAntMakeMenuBar.add(getHelpMenu());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iAntMakeMenuBar;
+	}
+	/**
+	 * Return the BrowseButton property value.
+	 * @return Button
+	 */
+	private Button getBrowseButton() {
+		if (iBrowseButton == null) {
+			try {
+				iBrowseButton = new Button();
+				iBrowseButton.setName("BrowseButton");
+				iBrowseButton.setLabel("...");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iBrowseButton;
+	}
+	/**
+	 * Return the BuildButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getBuildButton() {
+		if (iBuildButton == null) {
+			try {
+				iBuildButton = new Button();
+				iBuildButton.setName("BuildButton");
+				iBuildButton.setLabel("Build");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iBuildButton;
+	}
+	/**
+	 * Return the BuildFileLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getBuildFileLabel() {
+		if (iBuildFileLabel == null) {
+			try {
+				iBuildFileLabel = new Label();
+				iBuildFileLabel.setName("BuildFileLabel");
+				iBuildFileLabel.setText("Ant-Buildfile:");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iBuildFileLabel;
+	}
+	/**
+	 * Return the BuildFileTextField property value.
+	 * @return java.awt.TextField
+	 */
+	private TextField getBuildFileTextField() {
+		if (iBuildFileTextField == null) {
+			try {
+				iBuildFileTextField = new TextField();
+				iBuildFileTextField.setName("BuildFileTextField");
+				iBuildFileTextField.setBackground(SystemColor.textHighlightText);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iBuildFileTextField;
+	}
+	/**
+	 * Return the BuildInfo property value.
+	 * @return org.apache.tools.ant.taskdefs.optional.ide.VAJBuildInfo
+	 */
+	private VAJBuildInfo getBuildInfo() {
+		return iBuildInfo;
+	}
+	/**
+	 * Return the CloseButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getCloseButton() {
+		if (iCloseButton == null) {
+			try {
+				iCloseButton = new Button();
+				iCloseButton.setName("CloseButton");
+				iCloseButton.setLabel("Close");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iCloseButton;
+	}
+	/**
+	 * Return the CommandButtonPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getCommandButtonPanel() {
+		if (iCommandButtonPanel == null) {
+			try {
+				iCommandButtonPanel = new Panel();
+				iCommandButtonPanel.setName("CommandButtonPanel");
+				iCommandButtonPanel.setLayout(getCommandButtonPanelFlowLayout());
+				iCommandButtonPanel.setBackground(SystemColor.control);
+				iCommandButtonPanel.add(getReloadButton());
+				getCommandButtonPanel().add(getBuildButton(), getBuildButton().getName());
+				getCommandButtonPanel().add(getCloseButton(), getCloseButton().getName());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iCommandButtonPanel;
+	}
+	/**
+	 * Return the CommandButtonPanelFlowLayout property value.
+	 * @return java.awt.FlowLayout
+	 */
+	private FlowLayout getCommandButtonPanelFlowLayout() {
+		FlowLayout iCommandButtonPanelFlowLayout = null;
+		try {
+			/* Create part */
+			iCommandButtonPanelFlowLayout = new FlowLayout();
+			iCommandButtonPanelFlowLayout.setAlignment(FlowLayout.RIGHT);
+		} catch (Throwable iExc) {
+			handleException(iExc);
+		};
+		return iCommandButtonPanelFlowLayout;
+	}
+	/**
+	 * Return the ContentsPane property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getContentsPane() {
+		if (iContentsPane == null) {
+			try {
+				iContentsPane = new Panel();
+				iContentsPane.setName("ContentsPane");
+				iContentsPane.setLayout(new BorderLayout());
+				getContentsPane().add(getCommandButtonPanel(), "South");
+				getContentsPane().add(getOptionenPanel(), "Center");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iContentsPane;
+	}
+	/**
+	 * Return the FileDialog property value.
+	 * @return java.awt.FileDialog
+	 */
+	private FileDialog getFileDialog() {
+		if (iFileDialog == null) {
+			try {
+				iFileDialog = new FileDialog(this);
+				iFileDialog.setName("FileDialog");
+				iFileDialog.setLayout(null);
+				centerDialog(iFileDialog);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iFileDialog;
+	}
+	/**
+	 * Return the FileMenu property value.
+	 * @return java.awt.Menu
+	 */
+	private Menu getFileMenu() {
+		if (iFileMenu == null) {
+			try {
+				iFileMenu = new Menu();
+				iFileMenu.setLabel("File");
+				iFileMenu.add(getSaveMenuItem());
+				iFileMenu.add(getMenuSeparator());
+				iFileMenu.add(getShowLogMenuItem());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iFileMenu;
+	}
+	/**
+	 * Return the HelpMenu property value.
+	 * @return java.awt.Menu
+	 */
+	private Menu getHelpMenu() {
+		if (iHelpMenu == null) {
+			try {
+				iHelpMenu = new Menu();
+				iHelpMenu.setLabel("Help");
+				iHelpMenu.add(getAboutMenuItem());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iHelpMenu;
+	}
+	/**
+	 * Return the MenuSeparator1 property value.
+	 * @return java.awt.MenuItem
+	 */
+	private MenuItem getMenuSeparator() {
+		if (iMenuSeparator == null) {
+			try {
+				iMenuSeparator = new MenuItem();
+				iMenuSeparator.setLabel("-");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMenuSeparator;
+	}
+	/**
+	 * Return the MessageClearLogButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getMessageClearLogButton() {
+		if (iMessageClearLogButton == null) {
+			try {
+				iMessageClearLogButton = new Button();
+				iMessageClearLogButton.setName("MessageClearLogButton");
+				iMessageClearLogButton.setLabel("Clear Log");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageClearLogButton;
+	}
+	/**
+	 * Return the MessageCommandPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getMessageCommandPanel() {
+		if (iMessageCommandPanel == null) {
+			try {
+				iMessageCommandPanel = new Panel();
+				iMessageCommandPanel.setName("MessageCommandPanel");
+				iMessageCommandPanel.setLayout(new FlowLayout());
+				getMessageCommandPanel().add(getMessageClearLogButton(), getMessageClearLogButton().getName());
+				getMessageCommandPanel().add(getMessageOkButton(), getMessageOkButton().getName());
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageCommandPanel;
+	}
+	/**
+	 * Return the MessageContentPanel property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getMessageContentPanel() {
+		if (iMessageContentPanel == null) {
+			try {
+				iMessageContentPanel = new Panel();
+				iMessageContentPanel.setName("MessageContentPanel");
+				iMessageContentPanel.setLayout(new BorderLayout());
+				iMessageContentPanel.setBackground(SystemColor.control);
+				getMessageContentPanel().add(getMessageTextArea(), "Center");
+				getMessageContentPanel().add(getMessageCommandPanel(), "South");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageContentPanel;
+	}
+	/**
+	 * Return the MessageFrame property value.
+	 * @return java.awt.Frame
+	 */
+	private Frame getMessageFrame() {
+		if (iMessageFrame == null) {
+			try {
+				iMessageFrame = new Frame();
+				iMessageFrame.setName("MessageFrame");
+				iMessageFrame.setLayout(new BorderLayout());
+				iMessageFrame.setBounds(0, 0, 750, 250);
+				iMessageFrame.setTitle("Message Log");
+				iMessageFrame.add(getMessageContentPanel(), "Center");
+				iMessageFrame.setLocation((Toolkit.getDefaultToolkit().getScreenSize().width / 2) - (iMessageFrame.getSize().width / 2), (java.awt.Toolkit.getDefaultToolkit().getScreenSize().height / 2));
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageFrame;
+	}
+	/**
+	 * Return the MessageOkButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getMessageOkButton() {
+		if (iMessageOkButton == null) {
+			try {
+				iMessageOkButton = new Button();
+				iMessageOkButton.setName("MessageOkButton");
+				iMessageOkButton.setLabel("Close");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageOkButton;
+	}
+	/**
+	 * Return the MessageOutputLevelChoice property value.
+	 * @return java.awt.Choice
+	 */
+	private Choice getMessageOutputLevelChoice() {
+		if (iMessageOutputLevelChoice == null) {
+			try {
+				iMessageOutputLevelChoice = new Choice();
+				iMessageOutputLevelChoice.setName("MessageOutputLevelChoice");
+				iMessageOutputLevelChoice.add("Error");
+				iMessageOutputLevelChoice.add("Warning");
+				iMessageOutputLevelChoice.add("Info");
+				iMessageOutputLevelChoice.add("Verbose");
+				iMessageOutputLevelChoice.add("Debug");
+				iMessageOutputLevelChoice.select(2);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageOutputLevelChoice;
+	}
+	/**
+	 * Return the MessageOutputLevelLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getMessageOutputLevelLabel() {
+		if (iMessageOutputLevelLabel == null) {
+			try {
+				iMessageOutputLevelLabel = new Label();
+				iMessageOutputLevelLabel.setName("MessageOutputLevelLabel");
+				iMessageOutputLevelLabel.setText("Message Level:");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageOutputLevelLabel;
+	}
+	/**
+	 * Return the MessageTextArea property value.
+	 * @return java.awt.TextArea
+	 */
+	private TextArea getMessageTextArea() {
+		if (iMessageTextArea == null) {
+			try {
+				iMessageTextArea = new TextArea();
+				iMessageTextArea.setName("MessageTextArea");
+				iMessageTextArea.setFont(new Font("monospaced", 0, 12));
+				iMessageTextArea.setText("");
+				iMessageTextArea.setEditable(false);
+				iMessageTextArea.setEnabled(true);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iMessageTextArea;
+	}
+	/**
+	 * Return the Panel1 property value.
+	 * @return java.awt.Panel
+	 */
+	private Panel getOptionenPanel() {
+		if (iOptionenPanel == null) {
+			try {
+				iOptionenPanel = new Panel();
+				iOptionenPanel.setName("OptionenPanel");
+				iOptionenPanel.setLayout(new GridBagLayout());
+				iOptionenPanel.setBackground(SystemColor.control);
+
+				GridBagConstraints constraintsProjectLabel = new GridBagConstraints();
+				constraintsProjectLabel.gridx = 0; constraintsProjectLabel.gridy = 0;
+				constraintsProjectLabel.anchor = GridBagConstraints.WEST;
+				constraintsProjectLabel.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getProjectLabel(), constraintsProjectLabel);
+
+				GridBagConstraints constraintsBuildFileLabel = new GridBagConstraints();
+				constraintsBuildFileLabel.gridx = 0; constraintsBuildFileLabel.gridy = 1;
+				constraintsBuildFileLabel.anchor = GridBagConstraints.WEST;
+				constraintsBuildFileLabel.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getBuildFileLabel(), constraintsBuildFileLabel);
+
+				GridBagConstraints constraintsTargetLabel = new GridBagConstraints();
+				constraintsTargetLabel.gridx = 0; constraintsTargetLabel.gridy = 2;
+				constraintsTargetLabel.anchor = GridBagConstraints.NORTHWEST;
+				constraintsTargetLabel.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getTargetLabel(), constraintsTargetLabel);
+
+				GridBagConstraints constraintsProjectText = new GridBagConstraints();
+				constraintsProjectText.gridx = 1; constraintsProjectText.gridy = 0;
+				constraintsProjectText.gridwidth = 2;
+				constraintsProjectText.fill = GridBagConstraints.HORIZONTAL;
+				constraintsProjectText.anchor = GridBagConstraints.WEST;
+				constraintsProjectText.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getProjectText(), constraintsProjectText);
+
+				GridBagConstraints constraintsBuildFileTextField = new GridBagConstraints();
+				constraintsBuildFileTextField.gridx = 1; constraintsBuildFileTextField.gridy = 1;
+				constraintsBuildFileTextField.fill = GridBagConstraints.HORIZONTAL;
+				constraintsBuildFileTextField.anchor = GridBagConstraints.WEST;
+				constraintsBuildFileTextField.weightx = 1.0;
+				constraintsBuildFileTextField.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getBuildFileTextField(), constraintsBuildFileTextField);
+
+				GridBagConstraints constraintsBrowseButton = new GridBagConstraints();
+				constraintsBrowseButton.gridx = 2; constraintsBrowseButton.gridy = 1;
+				constraintsBrowseButton.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getBrowseButton(), constraintsBrowseButton);
+
+				GridBagConstraints constraintsTargetList = new GridBagConstraints();
+				constraintsTargetList.gridx = 1; constraintsTargetList.gridy = 2;
+				constraintsTargetList.gridheight = 2;
+				constraintsTargetList.fill = GridBagConstraints.BOTH;
+				constraintsTargetList.weightx = 1.0;
+				constraintsTargetList.weighty = 1.0;
+				constraintsTargetList.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getTargetList(), constraintsTargetList);
+
+				GridBagConstraints constraintsMessageOutputLevelLabel = new GridBagConstraints();
+				constraintsMessageOutputLevelLabel.gridx = 0; constraintsMessageOutputLevelLabel.gridy = 4;
+				constraintsMessageOutputLevelLabel.anchor = GridBagConstraints.WEST;
+				constraintsMessageOutputLevelLabel.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getMessageOutputLevelLabel(), constraintsMessageOutputLevelLabel);
+
+				GridBagConstraints constraintsMessageOutputLevelChoice = new GridBagConstraints();
+				constraintsMessageOutputLevelChoice.gridx = 1; constraintsMessageOutputLevelChoice.gridy = 4;
+				constraintsMessageOutputLevelChoice.fill = GridBagConstraints.HORIZONTAL;
+				constraintsMessageOutputLevelChoice.anchor = GridBagConstraints.WEST;
+				constraintsMessageOutputLevelChoice.weightx = 1.0;
+				constraintsMessageOutputLevelChoice.insets = new Insets(4, 4, 4, 4);
+				getOptionenPanel().add(getMessageOutputLevelChoice(), constraintsMessageOutputLevelChoice);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iOptionenPanel;
+	}
+	/**
+	 * Return the ProjectLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getProjectLabel() {
+		if (iProjectLabel == null) {
+			try {
+				iProjectLabel = new Label();
+				iProjectLabel.setName("ProjectLabel");
+				iProjectLabel.setText("Projectname:");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iProjectLabel;
+	}
+	/**
+	 * Return the ProjectText property value.
+	 * @return java.awt.Label
+	 */
+	private Label getProjectText() {
+		if (iProjectText == null) {
+			try {
+				iProjectText = new Label();
+				iProjectText.setName("ProjectText");
+				iProjectText.setText(" ");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iProjectText;
+	}
+	/**
+	 * Return the ReloadButton property value.
+	 * @return java.awt.Button
+	 */
+	private Button getReloadButton() {
+		if (iReloadButton == null) {
+			try {
+				iReloadButton = new Button();
+				iReloadButton.setName("ReloadButton");
+				iReloadButton.setLabel("(Re)Load");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iReloadButton;
+	}
+	/**
+	 * Return the SaveMenuItem property value.
+	 * @return java.awt.MenuItem
+	 */
+	private MenuItem getSaveMenuItem() {
+		if (iSaveMenuItem == null) {
+			try {
+				iSaveMenuItem = new MenuItem();
+				iSaveMenuItem.setLabel("Save BuildInfo To Repository");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iSaveMenuItem;
+	}
+	/**
+	 * Return the ShowLogMenuItem property value.
+	 * @return java.awt.MenuItem
+	 */
+	private MenuItem getShowLogMenuItem() {
+		if (iShowLogMenuItem == null) {
+			try {
+				iShowLogMenuItem = new MenuItem();
+				iShowLogMenuItem.setLabel("Log");
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iShowLogMenuItem;
+	}
+	/**
+	 * Return the TargetLabel property value.
+	 * @return java.awt.Label
+	 */
+	private Label getTargetLabel() {
+		if (iTargetLabel == null) {
+			try {
+				iTargetLabel = new Label();
+				iTargetLabel.setName("TargetLabel");
+				iTargetLabel.setText("Target:");
+				iTargetLabel.setEnabled(true);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iTargetLabel;
+	}
+	/**
+	 * Return the TargetList property value.
+	 * @return java.awt.List
+	 */
+	private List getTargetList() {
+		if (iTargetList == null) {
+			try {
+				iTargetList = new List();
+				iTargetList.setName("TargetList");
+				iTargetList.setEnabled(true);
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+		return iTargetList;
+	}
+	/**
+	 * Called whenever the part throws an exception.
+	 * @param exception Throwable
+	 */
+	private void handleException(Throwable exception) {
+		// Write exceptions to the log-window
+		getMessageTextArea().append(lineSeparator + lineSeparator + exception.getMessage());
+		getMessageFrame().show();
+		
+	}
+	/**
+	 * Initializes connections
+	 * @exception Exception The exception description.
+	 */
+	private void initConnections() throws Exception {
+		this.addWindowListener(iEventHandler);
+		getBrowseButton().addActionListener(iEventHandler);
+		getCloseButton().addActionListener(iEventHandler);
+		getBuildButton().addActionListener(iEventHandler);
+		getSaveMenuItem().addActionListener(iEventHandler);
+		getAboutOkButton().addActionListener(iEventHandler);
+		getAboutMenuItem().addActionListener(iEventHandler);
+		getMessageOkButton().addActionListener(iEventHandler);
+		getMessageClearLogButton().addActionListener(iEventHandler);
+		getMessageOkButton().addActionListener(iEventHandler);
+		getShowLogMenuItem().addActionListener(iEventHandler);
+		getAboutDialog().addWindowListener(iEventHandler);
+		getMessageFrame().addWindowListener(iEventHandler);
+		getReloadButton().addActionListener(iEventHandler);
+		getTargetList().addItemListener(iEventHandler);
+		getMessageOutputLevelChoice().addItemListener(iEventHandler);
+		getBuildFileTextField().addTextListener(iEventHandler);
+		connectProjectNameToLabel();
+		connectBuildFileNameToTextField();
+	}
+	/**
+	 * Initialize the class.
+	 */
+	private void initialize() {
+		try {
+			setName("AntMake");
+			setMenuBar(getAntMakeMenuBar());
+			setLayout(new java.awt.BorderLayout());
+			setSize(389, 222);
+			setTitle("Ant VisualAge for Java Tool-Integration");
+			add(getContentsPane(), "Center");
+			initConnections();
+		} catch (Throwable iExc) {
+			handleException(iExc);
+		}
+		setLocation((Toolkit.getDefaultToolkit().getScreenSize().width / 2) - (getSize().width / 2), (java.awt.Toolkit.getDefaultToolkit().getScreenSize().height / 2) - (getSize().height));
+		if ((getTargetList().getItemCount() == 0) || (getTargetList().getSelectedIndex() < 0)) {
+			getBuildButton().setEnabled(false);
+		}
+	}
+	/**
+	 * Saves the build-informations to repository
+	 */
+	private void saveBuildInfo() {
+		try {
+			VAJAntTool.saveBuildData(getBuildInfo());
+		}
+		catch (Throwable exc) {
+			// This Exception occurs when you try to write into a versioned project
+			handleException( exc );
+		}
+		return;
+	}
+	/**
+	 * Set the BuildInfo to a new value.
+	 * @param newValue org.apache.tools.ant.taskdefs.optional.vaj.VAJBuildInfo
+	 */
+	private void setBuildInfo(VAJBuildInfo newValue) {
+		if (iBuildInfo != newValue) {
+			try {
+				/* Stop listening for events from the current object */
+				if (iBuildInfo != null) {
+					iBuildInfo.removePropertyChangeListener(iEventHandler);
+				}
+				iBuildInfo = newValue;
+
+				/* Listen for events from the new object */
+				if (iBuildInfo != null) {
+					iBuildInfo.addPropertyChangeListener(iEventHandler);
+				}
+				connectProjectNameToLabel();
+				connectBuildFileNameToTextField();
+
+				// Select the log-level given by BuildInfo
+				getMessageOutputLevelChoice().select(iBuildInfo.getOutputMessageLevel());
+				fillList();
+				// BuildInfo can conly be saved to a VAJ project if tool API is called via the projects context-menu
+				if ((iBuildInfo.getVAJProjectName() == null) || (iBuildInfo.getVAJProjectName().equals(""))) {
+					getSaveMenuItem().setEnabled(false);
+				}
+			} catch (Throwable iExc) {
+				handleException(iExc);
+			}
+		}
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJBuildInfo.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJBuildInfo.java
new file mode 100644
index 0000000..7bce108
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJBuildInfo.java
@@ -0,0 +1,343 @@
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+import java.util.Hashtable;
+import java.util.Vector;
+import java.util.Enumeration;
+import org.apache.tools.ant.*;
+import java.io.File;
+
+/**
+ * This class wraps the Ant project information needed to
+ * start Ant from Visual Age.
+ * It serves the following purposes:
+ * - acts as model for AntMakeFrame
+ * - converts itself to/from String (to store the information
+ *   as ToolData in the VA repository)
+ * - wraps Project functions for the GUI (get target list,
+ *   execute target)
+ *    
+ * @author Wolf Siberski, TUI Infotec GmbH
+ */
+
+public class VAJBuildInfo {
+	// name of the VA project this BuildInfo belongs to
+	private String vajProjectName = "";
+	
+		// name of the Ant build file
+	private String buildFileName = "";
+
+		// main targets found in the build file
+	private Vector projectTargets = new Vector();
+
+		// target selected for execution
+	private java.lang.String target = "";
+
+		// log level
+	private int outputMessageLevel = Project.MSG_INFO;
+
+		// Ant Project created from build file
+	private transient Project project;
+
+		// is true if Project initialization was successful
+	private transient boolean projectInitialized = false;
+
+		// Support for bound properties
+	protected transient java.beans.PropertyChangeSupport propertyChange;
+/**
+ * The addPropertyChangeListener method was generated to support the propertyChange field.
+ */
+public synchronized void addPropertyChangeListener(java.beans.PropertyChangeListener listener) {
+	getPropertyChange().addPropertyChangeListener(listener);
+}
+/**
+ * Returns the BuildInfo information as String. The BuildInfo can
+ * be rebuilt from that String by calling parse().
+ * @return java.lang.String
+ */
+public String asDataString() {
+	String result = getOutputMessageLevel() + "|" + getBuildFileName() + "|" + getTarget();
+	for ( Enumeration e = getProjectTargets().elements(); e.hasMoreElements(); ) {
+		result = result + "|" + e.nextElement();
+	}
+
+	return result;
+}
+/**
+ * Executes the target set by setTarget().
+ * @param listener  BuildListener for the output of the build
+ */
+public void executeProject( BuildListener listener ) {
+	Throwable error = null;
+	try {
+		if (!isProjectInitialized()) {
+			project = new Project();
+		}
+		project.addBuildListener( listener );
+		// Chris: HACK: replace when Ant-Refactoring is finished!
+//		project.fireBuildStarted();
+		if (!isProjectInitialized()) {
+			initProject();
+		}
+		project.executeTarget(target);
+		
+	} catch (RuntimeException exc) {
+		error = exc;
+		throw exc;
+	} catch (Error err) {
+		error = err;
+		throw err;
+	} finally {
+		// Chris: HACK: replace when Ant-Refactoring is finished!
+//		project.fireBuildFinished(error);
+		project.removeBuildListener( listener );
+	}
+}
+	/**
+	 * Search for the insert position to keep names a sorted list of Strings
+	 * This method has been copied from org.apache.tools.ant.Main
+	 */
+	private static int findTargetPosition(Vector names, String name) {
+		int res = names.size();
+		for (int i=0; i<names.size() && res == names.size(); i++) {
+			if (name.compareTo((String)names.elementAt(i)) < 0) {
+				res = i;
+			}
+		}
+		return res;
+	}
+/**
+ * The firePropertyChange method was generated to support the propertyChange field.
+ */
+public void firePropertyChange(java.lang.String propertyName, java.lang.Object oldValue, java.lang.Object newValue) {
+	getPropertyChange().firePropertyChange(propertyName, oldValue, newValue);
+}
+/**
+ * Returns the build file name.
+ * @return build file name.
+ */
+public String getBuildFileName() {
+	return buildFileName;
+}
+/**
+ * Returns the log level
+ * @return log level.
+ */
+public int getOutputMessageLevel() {
+	return outputMessageLevel;
+}
+/**
+ * Returns the Ant project
+ * @return org.apache.tools.ant.Project
+ */
+private Project getProject() {
+	return project;
+}
+/**
+ * return a list of all targets in the current buildfile
+ */
+public Vector getProjectTargets() {
+	return projectTargets;
+}
+/**
+ * Accessor for the propertyChange field.
+ */
+protected java.beans.PropertyChangeSupport getPropertyChange() {
+	if (propertyChange == null) {
+		propertyChange = new java.beans.PropertyChangeSupport(this);
+	};
+	return propertyChange;
+}
+/**
+ * Insert the method's description here.
+ * Creation date: (07.11.2000 10:34:18)
+ * @return java.lang.String
+ */
+public java.lang.String getTarget() {
+	return target;
+}
+/**
+ * returns the VA project name
+ * @return The projectName property value.
+ */
+public String getVAJProjectName() {
+	return vajProjectName;
+}
+/**
+ * Initializes the Ant project. Assumes that the
+ * project attribute is already set.
+ */
+private void initProject() {
+	try {
+		project.init();
+		File buildFile = new File(getBuildFileName());
+		project.setUserProperty("ant.file", buildFile.getAbsolutePath());
+		ProjectHelper.configureProject(project, buildFile);
+		setProjectInitialized(true);
+	} catch (RuntimeException exc) {
+		setProjectInitialized(false);
+		throw exc;
+	} catch (Error err) {
+		setProjectInitialized(false);
+		throw err;
+	}
+}
+/**
+ * Returns true, if the Ant project is initialized
+ * (i.e. buildfile loaded)
+ */
+public boolean isProjectInitialized() {
+	return projectInitialized;
+}
+/**
+ * Creates a BuildInfo object from a String
+ * The String must be in the format
+ * outputMessageLevel'|'buildFileName'|'defaultTarget'|'(project target'|')*
+ *
+ * @return org.apache.tools.ant.taskdefs.optional.vaj.BuildInfo
+ * @param data java.lang.String
+ */
+public static VAJBuildInfo parse(String data) {
+	VAJBuildInfo result = new VAJBuildInfo();
+
+	try {
+		java.util.StringTokenizer tok = new java.util.StringTokenizer( data, "|" );
+		result.setOutputMessageLevel( tok.nextToken() );
+		result.setBuildFileName( tok.nextToken() );
+		result.setTarget( tok.nextToken() );
+		while( tok.hasMoreTokens() ) {
+			result.projectTargets.addElement( tok.nextToken() );
+		}
+	} catch ( Throwable t ) {
+	}
+	return result;
+}
+/**
+ * The removePropertyChangeListener method was generated to support the propertyChange field.
+ */
+public synchronized void removePropertyChangeListener(java.beans.PropertyChangeListener listener) {
+	getPropertyChange().removePropertyChangeListener(listener);
+}
+/**
+ * Sets the build file name
+ * @param buildFileName build file name
+ */
+public void setBuildFileName(String newBuildFileName) {
+	String oldValue = buildFileName;
+	buildFileName = newBuildFileName;
+	setProjectInitialized(false);
+	firePropertyChange("buildFileName", oldValue, buildFileName);
+}
+/**
+ * Sets the log level (value must be one of the constants in Project)
+ * @param outputMessageLevel log level.
+ */
+public void setOutputMessageLevel(int newOutputMessageLevel) {
+	int oldValue = outputMessageLevel;
+	outputMessageLevel = newOutputMessageLevel;
+	firePropertyChange("outputMessageLevel", new Integer(oldValue), new Integer(outputMessageLevel));
+}
+/**
+ * Sets the log level (value must be one of the constants in Project)
+ * @param outputMessageLevel log level as String.
+ */
+private void setOutputMessageLevel(String outputMessageLevel) {
+	int level = Integer.parseInt( outputMessageLevel );
+	setOutputMessageLevel( level );
+}
+/**
+  */
+private void setProjectInitialized(boolean initialized) {
+	Boolean oldValue = new Boolean(projectInitialized);
+	projectInitialized = initialized;
+	firePropertyChange("projectInitialized", oldValue, new Boolean(projectInitialized));
+}
+/**
+ * Sets the target to execute when executeBuild is called
+ * @param newTarget build target
+ */
+public void setTarget(String newTarget) {
+	String oldValue = target;
+	target = newTarget;
+	firePropertyChange("target", oldValue, target);
+}
+/**
+ * Sets the name of the Visual Age for Java project where
+ * this BuildInfo belongs to
+ * @param newProjectName VAJ project
+ */
+public void setVAJProjectName(String newVAJProjectName) {
+	String oldValue = vajProjectName;
+	vajProjectName = newVAJProjectName;
+	firePropertyChange("VAJProjectName", oldValue, vajProjectName);
+}
+/**
+ * reloads the build file and updates the target list
+ */
+public void updateTargetList() {
+	project = new Project();
+	initProject();
+	projectTargets.removeAllElements();
+	Enumeration ptargets = project.getTargets().elements();
+	while (ptargets.hasMoreElements()) {
+		Target currentTarget = (Target) ptargets.nextElement();
+		if ( currentTarget.getDescription() != null ) {
+			String targetName = currentTarget.getName();
+			int pos = findTargetPosition( projectTargets, targetName );
+			projectTargets.insertElementAt(targetName, pos);
+		}
+	}
+}
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJExport.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJExport.java
new file mode 100644
index 0000000..de6e6bf
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJExport.java
@@ -0,0 +1,241 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+
+
+
+import com.ibm.ivj.util.base.ExportCodeSpec;
+import com.ibm.ivj.util.base.IvjException;
+import com.ibm.ivj.util.base.Package;
+import java.io.File;
+import java.util.Enumeration;
+import java.util.Vector;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.types.PatternSet;
+
+/**
+ * Export packages from the Visual Age for Java workspace. 
+ * The packages are specified similar to all other MatchingTasks. 
+ * Since the VA Workspace is not file based, this task is simulating 
+ * a directory hierarchy for the workspace:
+ * The 'root' contains all project 'dir's, and the projects contain 
+ * their respective package 'dir's.
+ * Example:  
+ * <blockquote> 
+ * &lt;vajexport destdir="C:/builddir/source">
+ * &nbsp;&lt;include name="/MyVAProject/org/foo/subsystem1/**" />
+ * &nbsp;&lt;exclude name="/MyVAProject/org/foo/subsystem1/test/**"/>
+ * &lt;/vajexport>
+ * </blockquote>
+ * exports all packages in the project MyVAProject which start with
+ * 'org.foo.subsystem1' except of these starting with 
+ * 'org.foo.subsystem1.test'.
+ *
+ * There are flags to choose which items to export:
+ * exportSources:   export Java sources
+ * exportResources: export project resources
+ * exportClasses:   export class files
+ * exportDebugInfo: export class files with debug info (use with exportClasses)
+ * default is exporting Java files and resources.
+ *
+ * @author Wolf Siberski, TUI Infotec GmbH
+ */
+
+public class VAJExport extends Task {
+    protected File destDir;
+    protected boolean exportSources = true;
+    protected boolean exportResources = true;
+    protected boolean exportClasses = false;
+    protected boolean exportDebugInfo = false;
+    protected boolean useDefaultExcludes = true;
+
+    protected PatternSet patternSet = new PatternSet();
+
+    /**
+     * add a name entry on the exclude list
+     */
+    public PatternSet.NameEntry createExclude() {
+        return patternSet.createExclude();
+    }
+
+    /**
+     * add a name entry on the include list
+     */
+    public PatternSet.NameEntry createInclude() {
+        return patternSet.createInclude();
+    }
+
+    /**
+     * do the export
+     */
+    public void execute() throws BuildException {
+        // first off, make sure that we've got a destdir
+        if (destDir == null) {
+            throw new BuildException("destdir attribute must be set!");
+        }
+
+        VAJWorkspaceScanner ds = this.getWorkspaceScanner();
+
+        Package[] packages = ds.getIncludedPackages();
+
+        export(packages);
+    }
+
+    /**
+     * export the array of Packages
+     */
+    public void export(Package[] packages) {
+        try {
+            String dest = destDir.getAbsolutePath();
+
+            log("Exporting " + packages.length + " package(s) to " + dest);
+            for (int i = 0; i < packages.length; i++) {
+                log("    " + packages[i].getName(), Project.MSG_VERBOSE);
+            }
+
+            ExportCodeSpec exportSpec = new ExportCodeSpec();
+
+            exportSpec.setPackages(packages);
+            exportSpec.includeJava(exportSources);
+            exportSpec.includeClass(exportClasses);
+            exportSpec.includeResources(exportResources);
+            exportSpec.includeClassDebugInfo(exportDebugInfo);
+            exportSpec.useSubdirectories(true);
+            exportSpec.overwriteFiles(true);
+            exportSpec.setExportDirectory(dest);
+            VAJUtil.getWorkspace().exportData(exportSpec);
+        } catch (IvjException ex) {
+            throw VAJUtil.createBuildException("Exporting failed!", ex);
+        }
+    }
+
+    /**
+     * Returns the directory scanner needed to access the files to process.
+     */
+    protected VAJWorkspaceScanner getWorkspaceScanner() {
+        VAJWorkspaceScanner scanner = new VAJWorkspaceScanner();
+        scanner.setIncludes(patternSet.getIncludePatterns(getProject()));
+        scanner.setExcludes(patternSet.getExcludePatterns(getProject()));
+        if (useDefaultExcludes)
+            scanner.addDefaultExcludes();
+        scanner.scan();
+        return scanner;
+    }
+
+    /**
+     * Sets whether default exclusions should be used or not.
+     *
+     * @param useDefaultExcludes "true"|"on"|"yes" when default exclusions 
+     *                           should be used, "false"|"off"|"no" when they
+     *                           shouldn't be used.
+     */
+    public void setDefaultexcludes(boolean useDefaultExcludes) {
+        this.useDefaultExcludes = useDefaultExcludes;
+    }
+
+    /**
+     * Set the destination directory into which the Java source
+     * files should be compiled.
+     */
+    public void setDestdir(File destDir) {
+        this.destDir = destDir;
+    }
+
+    /**
+     * Sets the set of exclude patterns. Patterns may be separated by a comma
+     * or a space.
+     *
+     * @param excludes the string containing the exclude patterns
+     */
+    public void setExcludes(String excludes) {
+        patternSet.setExcludes(excludes);
+    }
+
+    /**
+     */
+    public void setExportClasses(boolean doExport) {
+        exportClasses = doExport;
+    }
+
+    /**
+     */
+    public void setExportDebugInfo(boolean doExport) {
+        exportDebugInfo = doExport;
+    }
+
+    /**
+     */
+    public void setExportResources(boolean doExport) {
+        exportResources = doExport;
+    }
+
+    /**
+     */
+    public void setExportSources(boolean doExport) {
+        exportSources = doExport;
+    }
+    /**
+     * Sets the set of include patterns. Patterns may be separated by a comma
+     * or a space.
+     *
+     * @param includes the string containing the include patterns
+     */
+    public void setIncludes(String includes) {
+        patternSet.setIncludes(includes);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJImport.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJImport.java
new file mode 100644
index 0000000..6f414c3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJImport.java
@@ -0,0 +1,339 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+import com.ibm.ivj.util.base.ImportCodeSpec;
+import com.ibm.ivj.util.base.IvjException;
+import com.ibm.ivj.util.base.Project;
+import com.ibm.ivj.util.base.ProjectEdition;
+import com.ibm.ivj.util.base.Type;
+import java.io.File;
+import java.util.Enumeration;
+import java.util.Vector;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.DirectoryScanner;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.types.FileSet;
+
+/**
+ * Import source, class files, and resources to the Visual Age for Java 
+ * workspace using FileSets.
+ * <p>
+ * Example:  
+ * <pre> 
+ * &lt;vajimport project="MyVAProject"&gt;
+ *   &lt;fileset dir="src"&gt;
+ *     &lt;include name="org/foo/subsystem1/**" /&gt;
+ *     &lt;exclude name="/org/foo/subsystem1/test/**" /&gt;
+ *  &lt;/fileset&gt;
+ * &lt;/vajexport&gt;
+ * </pre>
+ * import all source and resource files from the "src" directory
+ * which start with 'org.foo.subsystem1', except of these starting with 
+ * 'org.foo.subsystem1.test' into the project MyVAProject.
+ * </p>
+ * <p>If MyVAProject isn't loaded into the Workspace, a new edition is
+ * created in the repository and automatically loaded into the Workspace.
+ * There has to be at least one nested FileSet element.
+ * </p>
+ * <p>There are attributes to choose which items to export:
+ * <table border="1" cellpadding="2" cellspacing="0">
+ * <tr>
+ *   <td valign="top"><b>Attribute</b></td>
+ *   <td valign="top"><b>Description</b></td>
+ *   <td align="center" valign="top"><b>Required</b></td>
+ * </tr>
+ * <tr>
+ *   <td valign="top">vajproject</td>
+ *   <td valign="top">the name of the Project to import to</td>
+ *   <td align="center" valign="top">Yes</td>
+ * </tr>
+ * <tr>
+ *   <td valign="top">importSources</td>
+ *   <td valign="top">import Java sources, defaults to "yes"</td>
+ *   <td align="center" valign="top">No</td>
+ * </tr>
+ * <tr>
+ *   <td valign="top">importResources</td>
+ *   <td valign="top">import resource files (anything that doesn't
+ *                    end with .java or .class), defaults to "yes"</td>
+ *   <td align="center" valign="top">No</td>
+ * </tr>
+ * <tr>
+ *   <td valign="top">importClasses</td>
+ *   <td valign="top">import class files, defaults to "no"</td>
+ *   <td align="center" valign="top">No</td>
+ * </tr>
+ * </table>
+ *
+ * @author: Glenn McAllister, inspired by a similar task written by Peter Kelley
+ */
+public class VAJImport extends Task {
+    protected Vector filesets = new Vector();
+    protected boolean importSources = true;
+    protected boolean importResources = true;
+    protected boolean importClasses = false;
+    protected String importProject = null;
+    protected Project vajproject = null;
+
+    /**
+     * The VisualAge for Java Project name to import into.
+     */
+    public void setVajproject(String projectName) {
+        this.importProject = projectName;
+    }
+
+    /**
+     * Adds a set of files (nested fileset attribute).
+     */
+    public void addFileset(FileSet set) {
+        filesets.addElement(set);
+    }
+
+    /**
+     * Import .class files.
+     */
+    public void setImportClasses(boolean importClasses) {
+        this.importClasses = importClasses;
+    }
+
+    /**
+     * Import resource files (anything that doesn't end in
+     * .class or .java)
+     */
+    public void setImportResources(boolean importResources) {
+        this.importResources = importResources;
+    }
+
+    /**
+     * Import .java files
+     */
+    public void setImportSources(boolean importSources) {
+        this.importSources = importSources;
+    }
+
+    /**
+     * Do the import.
+     */
+    public void execute() throws BuildException {
+        if (filesets.size() == 0) {
+            throw new BuildException("At least one fileset is required!");
+        }
+
+        if (importProject == null || "".equals(importProject)) {
+            throw new BuildException("The VisualAge for Java Project name is required!");
+        }
+
+        vajproject = getVAJProject();
+        if (vajproject == null) {
+            try {
+                vajproject = VAJUtil.getWorkspace().createProject(this.importProject, true);
+            } catch (IvjException e) {
+                throw VAJUtil.createBuildException( "Error while creating Project " + 
+                                                    importProject + ": ", 
+                                                    e ); 
+            }
+        }
+
+        for (Enumeration e = filesets.elements(); e.hasMoreElements();) {
+            importFileset((FileSet) e.nextElement());
+        }
+    }
+
+    /**
+     * Try to get the project we want from the Workspace.
+     */
+    protected Project getVAJProject() {
+        Project found = null;
+        Project[] currentProjects = VAJUtil.getWorkspace().getProjects();
+
+        for (int i = 0; i < currentProjects.length; i++) {
+            Project p = currentProjects[i];
+            if (p.getName().equals(this.importProject)) {
+                found = p;
+                break;
+            }
+        }
+
+        return found;
+    }
+
+    /**
+     * Import all files from the fileset into the Project in the
+     * Workspace.
+     */
+    protected void importFileset(FileSet fileset) {
+        DirectoryScanner ds = fileset.getDirectoryScanner(this.project);
+        if (ds.getIncludedFiles().length == 0) {
+            return;
+        }
+
+        Vector classes = new Vector();
+        Vector sources = new Vector();
+        Vector resources = new Vector();
+
+        String[] classesArr = null;
+        String[] sourcesArr = null;
+        String[] resourcesArr = null;
+
+        StringBuffer msg = new StringBuffer();
+        msg.append("Importing ");
+        String connector = "";
+
+        ImportCodeSpec importSpec = new ImportCodeSpec();
+        importSpec.setDefaultProject(vajproject);
+
+        scan(
+             fileset.getDir(this.project), 
+             ds.getIncludedFiles(), 
+             classes, 
+             sources, 
+             resources); 
+
+        if (importClasses) {
+            classesArr = new String[classes.size()];
+            classes.copyInto(classesArr);
+            importSpec.setClassFiles(classesArr);
+            if (classesArr.length > 0) {
+                logFiles(classes, "class");
+                msg.append( classesArr.length );
+                msg.append( " class " );
+                msg.append( classesArr.length > 1 ? "files" : "file" );
+                connector = ", ";
+            }
+        }
+
+        if (importSources) {
+            sourcesArr = new String[sources.size()];
+            sources.copyInto(sourcesArr);
+            importSpec.setJavaFiles(sourcesArr);
+            if (sourcesArr.length > 0) {
+                logFiles(sources, "source");
+                msg.append( connector );
+                msg.append( sourcesArr.length );
+                msg.append( " source " );
+                msg.append( sourcesArr.length > 1 ? "files" : "file" );
+                connector = ", ";
+            }
+        }
+
+        if (importResources) {
+            String resourcePath = fileset.getDir(this.project).getAbsolutePath();
+            resourcesArr = new String[resources.size()];
+            resources.copyInto(resourcesArr);
+            importSpec.setResourcePath(resourcePath);
+            importSpec.setResourceFiles(resourcesArr);
+            if (resourcesArr.length > 0) {
+                logFiles(resources, "resource");
+                log( "  (relative to resource path '" + resourcePath + "')", 
+                     org.apache.tools.ant.Project.MSG_VERBOSE );
+
+                msg.append( connector );
+                msg.append( resourcesArr.length );
+                msg.append( " resource " );
+                msg.append( resourcesArr.length > 1 ? "files" : "file" );
+            }
+        }
+
+        msg.append( " into the " );
+        msg.append( importProject );
+        msg.append( " project." );
+
+        log(msg.toString());
+                
+        try {
+            Type[] importedTypes = VAJUtil.getWorkspace().importData(importSpec);
+            if (importedTypes == null) {
+                throw new BuildException("Unable to import into Workspace!");
+            }
+        } catch (IvjException ivje) {
+            VAJUtil.createBuildException("Error while importing into Workspace: ", ivje);
+        }
+    }
+
+    /**
+     * Sort the files into classes, sources, and resources.
+     */
+    protected void scan(
+                        File dir, 
+                        String[] files, 
+                        Vector classes, 
+                        Vector sources, 
+                        Vector resources) {
+        for (int i = 0; i < files.length; i++) {
+            String file = (new File(dir, files[i])).getAbsolutePath();
+            if (file.endsWith(".java") || file.endsWith(".JAVA")) {
+                sources.addElement(file);
+            } else
+                if (file.endsWith(".class") || file.endsWith(".CLASS")) {
+                    classes.addElement(file);
+                } else {
+                    // for resources VA expects the path relative to the resource path
+                    resources.addElement(files[i]);
+                }
+        }
+    }
+                
+    /**
+     * Logs a list of file names to the message log
+     * @param fileNames java.util.Vector file names to be logged
+     * @param type java.lang.String file type
+     */
+    protected void logFiles(Vector fileNames, String fileType) {
+        log(  fileType + " files found for import:", org.apache.tools.ant.Project.MSG_VERBOSE);
+        for ( Enumeration e = fileNames.elements(); e.hasMoreElements(); ) {
+            log( "    " + e.nextElement(), org.apache.tools.ant.Project.MSG_VERBOSE );
+        }
+    } 
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJLoadProjects.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJLoadProjects.java
new file mode 100644
index 0000000..4f0fc37
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJLoadProjects.java
@@ -0,0 +1,251 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+
+import com.ibm.ivj.util.base.IvjException;
+import com.ibm.ivj.util.base.ProjectEdition;
+import java.util.Enumeration;
+import java.util.Vector;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.Task;
+
+/**
+ * Load specific project versions into the Visual Age for Java workspace.
+ * Each project and version name has to be specified completely.
+ * Example:  
+ * <blockquote> 
+ * &lt;vajload>
+ * &nbsp;&lt;project name="MyVAProject" version="2.1"/>
+ * &nbsp;&lt;project name="Apache Xerces" version="1.2.0"/>
+ * &lt;/vajload>
+ * </blockquote>
+ *
+ * @author Wolf Siberski, TUI Infotec GmbH
+ */
+
+public class VAJLoadProjects extends Task {
+    Vector projectDescriptions = new Vector();
+    Vector expandedProjectDescriptions = new Vector();
+
+    /**
+     * Class to maintain VisualAge for Java Workspace Project descriptions.
+     */
+    public class VAJProjectDescription {
+        private String name;
+        private String version;
+        private boolean projectFound;
+
+        public VAJProjectDescription() {
+        }
+
+        public VAJProjectDescription(String n, String v) {
+            name = n;
+            version = v;
+        }
+
+        public String getName() {
+            return name;
+        }
+
+        public String getVersion() {
+            return version;
+        }
+
+        public boolean projectFound() {
+            return projectFound;
+        }
+
+        public void setName(String newName) {
+            if (newName == null || newName.equals("")) {
+                throw new BuildException("name attribute must be set");
+            }
+            name = newName;
+        }
+
+        public void setVersion(String newVersion) {
+            if (newVersion == null || newVersion.equals("")) {
+                throw new BuildException("version attribute must be set");
+            }
+            version = newVersion;
+        }
+
+        public void setProjectFound() {
+            projectFound = true;
+        }
+    }
+    
+    /**
+     * Add a project description entry on the project list.
+     */
+    public VAJProjectDescription createVAJProject() {
+        VAJProjectDescription d = new VAJProjectDescription();
+        projectDescriptions.addElement(d);
+        return d;
+    }
+    /**
+     * Load specified projects.
+     */
+    public void execute() {
+        expandDescriptions();
+        log(
+            "Loading " + expandedProjectDescriptions.size() + " project(s) into workspace"); 
+        for (Enumeration e = expandedProjectDescriptions.elements(); 
+             e.hasMoreElements(); 
+             ) {
+            VAJProjectDescription d = (VAJProjectDescription) e.nextElement();
+
+            ProjectEdition pe = findProjectEdition(d.getName(), d.getVersion());
+            try {
+                log( "Loading " + d.getName() + ", Version " + d.getVersion() + 
+                     ", into Workspace", 
+                     Project.MSG_VERBOSE ); 
+                pe.loadIntoWorkspace();
+            } catch (IvjException ex) {
+                throw VAJUtil.createBuildException( "Project " + d.getName() + 
+                                                    " could not be loaded.", 
+                                                    ex ); 
+            }
+        }
+    }
+
+    /**
+     */
+    public void expandDescriptions() {
+        String[] projectNames;
+        try {
+            projectNames = VAJUtil.getWorkspace().getRepository().getProjectNames();
+        } catch (IvjException e) {
+            throw VAJUtil.createBuildException("VA Exception occured: ", e);
+        }
+
+        for (int i = 0; i < projectNames.length; i++) {
+            for (Enumeration e = projectDescriptions.elements(); e.hasMoreElements();) {
+                VAJProjectDescription d = (VAJProjectDescription) e.nextElement();
+                String pattern = d.getName();
+                if (VAJWorkspaceScanner.match(pattern, projectNames[i])) {
+                    d.setProjectFound();
+                    expandedProjectDescriptions.
+                        addElement(new VAJProjectDescription(projectNames[i], d.getVersion())); 
+                    break;
+                }
+            }
+        }
+
+        for (Enumeration e = projectDescriptions.elements(); e.hasMoreElements();) {
+            VAJProjectDescription d = (VAJProjectDescription) e.nextElement();
+            if (!d.projectFound()) {
+                log("No Projects match the name " + d.getName(), Project.MSG_WARN);
+            }
+        }
+    }
+
+    /**
+     */
+    public static Vector findMatchingProjects(String pattern) {
+        String[] projectNames;
+        try {
+            projectNames = VAJUtil.getWorkspace().getRepository().getProjectNames();
+        } catch (IvjException e) {
+            throw VAJUtil.createBuildException("VA Exception occured: ", e);
+        }
+
+        Vector matchingProjects = new Vector();
+        for (int i = 0; i < projectNames.length; i++) {
+            if (VAJWorkspaceScanner.match(pattern, projectNames[i])) {
+                matchingProjects.addElement(projectNames[i]);
+            }
+        }
+
+        return matchingProjects;
+    }
+
+    /**
+     * Finds a specific project edition in the repository.
+     *
+     * @param name project name
+     * @param versionName project version name
+     * @return com.ibm.ivj.util.base.ProjectEdition
+     */
+    public static ProjectEdition findProjectEdition(
+                                                    String name, 
+                                                    String versionName) {
+        try {
+            ProjectEdition[] editions = null;
+            editions = VAJUtil.getWorkspace().getRepository().getProjectEditions(name);
+
+            if (editions == null) {
+                throw new BuildException("Project " + name + " doesn't exist");
+            }
+
+            ProjectEdition pe = null;
+
+            for (int i = 0; i < editions.length && pe == null; i++) {
+                if (versionName.equals(editions[i].getVersionName())) {
+                    pe = editions[i];
+                }
+            }
+            if (pe == null) {
+                throw new BuildException( "Version " + versionName + " of Project " + 
+                                          name + " doesn't exist" ); 
+            }
+            return pe;
+
+        } catch (IvjException e) {
+            throw VAJUtil.createBuildException("VA Exception occured: ", e);
+        }
+
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJUtil.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJUtil.java
new file mode 100644
index 0000000..c83d0c2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJUtil.java
@@ -0,0 +1,108 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+
+import com.ibm.ivj.util.base.IvjException;
+import com.ibm.ivj.util.base.ToolEnv;
+import com.ibm.ivj.util.base.Workspace;
+import org.apache.tools.ant.BuildException;
+
+/**
+ * Helper class for VAJ tasks. Holds Workspace singleton and
+ * wraps IvjExceptions into BuildExceptions
+ *
+ * @author Wolf Siberski, TUI Infotec GmbH
+ */
+class VAJUtil {
+    static private Workspace workspace;
+        
+    /**
+     * Wraps IvjException into a BuildException
+     *
+     * @return org.apache.tools.ant.BuildException
+     * @param errMsg Additional error message
+     * @param e IvjException which is wrapped
+     */
+    public static BuildException createBuildException(
+                                                      String errMsg, 
+                                                      IvjException e) {
+        errMsg = errMsg + "\n" + e.getMessage();
+        String[] errors = e.getErrors();
+        if (errors != null) {
+            for (int i = 0; i < errors.length; i++) {
+                errMsg = errMsg + "\n" + errors[i];
+            }
+        }
+        return new BuildException(errMsg);
+    }
+        
+    /**
+     * Insert the method's description here.
+     * Creation date: (19.09.2000 13:41:21)
+     * @return com.ibm.ivj.util.base.Workspace
+     */
+    public static Workspace getWorkspace() {
+        if (workspace == null) {
+            workspace = ToolEnv.connectToWorkspace();
+            if (workspace == null) {
+                throw new BuildException(
+                                         "Unable to connect to Workspace! "
+                                         + "Make sure you are running in VisualAge for Java."); 
+            }
+        }
+
+        return workspace;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJWorkspaceScanner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJWorkspaceScanner.java
new file mode 100644
index 0000000..1348145
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/VAJWorkspaceScanner.java
@@ -0,0 +1,246 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.ide;
+
+import com.ibm.ivj.util.base.IvjException;
+import com.ibm.ivj.util.base.Package;
+import com.ibm.ivj.util.base.Project;
+import java.io.File;
+import java.util.Enumeration;
+import java.util.StringTokenizer;
+import java.util.Vector;
+import org.apache.tools.ant.DirectoryScanner;
+
+/**
+ * Class for scanning a Visual Age for Java workspace for packages matching
+ * a certain criteria.
+ * <p>
+ * These criteria consist of a set of include and exclude patterns. With these
+ * patterns, you can select which packages you want to have included, and which
+ * packages you want to have excluded.  You can add patterns to be excluded by
+ * default with the addDefaultExcludes method.  The patters that are excluded
+ * by default include
+ * <ul>
+ *   <li>IBM*\**</li>
+ *   <li>Java class libraries\**</li>
+ *   <li>Sun class libraries*\**</li>
+ *   <li>JSP Page Compile Generated Code\**</li>
+ *   <li>VisualAge*\**</li>
+ * </ul>
+ * <p>
+ * This class works like DirectoryScanner. 
+ *
+ * @see org.apache.tools.ant.DirectoryScanner
+ *
+ * @author Wolf Siberski, TUI Infotec (based on Arnout J. Kuipers DirectoryScanner)
+ */
+public class VAJWorkspaceScanner extends DirectoryScanner {
+
+    /**
+     * Patterns that should be excluded by default.
+     *
+     * @see #addDefaultExcludes()
+     */
+    private final static String[] DEFAULTEXCLUDES = 
+    {
+        "IBM*/**", 
+        "Java class libraries/**", 
+        "Sun class libraries*/**", 
+        "JSP Page Compile Generated Code/**", 
+        "VisualAge*/**", 
+    }; 
+
+    /**
+     * The packages that where found and matched at least one includes, and
+     * matched no excludes.
+     */
+    private Vector packagesIncluded = new Vector();
+   
+    /**
+     * Adds the array with default exclusions to the current exclusions set.
+     */
+    public void addDefaultExcludes() {
+        int excludesLength = excludes == null ? 0 : excludes.length;
+        String[] newExcludes;
+        newExcludes = new String[excludesLength + DEFAULTEXCLUDES.length];
+        if (excludesLength > 0) {
+            System.arraycopy(excludes, 0, newExcludes, 0, excludesLength);
+        }
+        for (int i = 0; i < DEFAULTEXCLUDES.length; i++) {
+            newExcludes[i + excludesLength] = DEFAULTEXCLUDES[i].
+                replace( '/', File.separatorChar ).replace( '\\', File.separatorChar ); 
+        }
+        excludes = newExcludes;
+    }
+        
+    /**
+     * Finds all Projects specified in include patterns.
+     *
+     * @return the projects
+     */
+    public Vector findMatchingProjects() {
+        Project[] projects = VAJUtil.getWorkspace().getProjects();
+
+        Vector matchingProjects = new Vector();
+
+        boolean allProjectsMatch = false;
+        for (int i = 0; i < projects.length; i++) {
+            Project project = projects[i];
+            for (int j = 0; j < includes.length && !allProjectsMatch; j++) {
+                StringTokenizer tok = new StringTokenizer(includes[j], File.separator);
+                String projectNamePattern = tok.nextToken();
+                if (projectNamePattern.equals("**")) {
+                    // if an include pattern starts with '**', 
+                    // all projects match
+                    allProjectsMatch = true;
+                } else
+                    if (match(projectNamePattern, project.getName())) {
+                        matchingProjects.addElement(project);
+                        break;
+                    }
+            }
+        }
+
+        if (allProjectsMatch) {
+            matchingProjects = new Vector();
+            for (int i = 0; i < projects.length; i++) {
+                matchingProjects.addElement(projects[i]);
+            }
+        }
+
+        return matchingProjects;
+    }
+        
+    /**
+     * Get the names of the packages that matched at least one of the include
+     * patterns, and didn't match one of the exclude patterns.
+     *
+     * @return the matching packages
+     */
+    public Package[] getIncludedPackages() {
+        int count = packagesIncluded.size();
+        Package[] packages = new Package[count];
+        for (int i = 0; i < count; i++) {
+            packages[i] = (Package) packagesIncluded.elementAt(i);
+        }
+        return packages;
+    }
+        
+    /**
+     * Matches a string against a pattern. The pattern contains two special
+     * characters:
+     * '*' which means zero or more characters,
+     * '?' which means one and only one character.
+     *
+     * @param pattern the (non-null) pattern to match against
+     * @param str     the (non-null) string that must be matched against the
+     *                pattern
+     *
+     * @return <code>true</code> when the string matches against the pattern,
+     *         <code>false</code> otherwise.
+     */
+    protected static boolean match(String pattern, String str) {
+        return DirectoryScanner.match(pattern, str);
+    }
+    /**
+     * Scans the workspace for packages that match at least one include
+     * pattern, and don't match any exclude patterns.
+     *
+     */
+    public void scan() {
+        if (includes == null) {
+            // No includes supplied, so set it to 'matches all'
+            includes = new String[1];
+            includes[0] = "**";
+        }
+        if (excludes == null) {
+            excludes = new String[0];
+        }
+
+        // only scan projects which are included in at least one include pattern
+        Vector matchingProjects = findMatchingProjects();
+        for (Enumeration e = matchingProjects.elements(); e.hasMoreElements();) {
+            Project project = (Project) e.nextElement();
+            scanProject(project);
+        }
+    }
+        
+    /**
+     * Scans a project for packages that match at least one include
+     * pattern, and don't match any exclude patterns.
+     *
+     */
+    public void scanProject(Project project) {
+        try {
+            Package[] packages = project.getPackages();
+            if (packages != null) {
+                for (int i = 0; i < packages.length; i++) {
+                    Package item = packages[i];
+                    // replace '.' by file seperator because the patterns are
+                    // using file seperator syntax (and we can use the match
+                    // methods this way).
+                    String name = 
+                        project.getName()
+                        + File.separator
+                        + item.getName().replace('.', File.separatorChar); 
+                    if (isIncluded(name) && !isExcluded(name)) {
+                        packagesIncluded.addElement(item);
+                    }
+                }
+            }
+        } catch (IvjException e) {
+            throw VAJUtil.createBuildException("VA Exception occured: ", e);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/default.ini b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/default.ini
new file mode 100644
index 0000000..92e8c78
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/ide/default.ini
@@ -0,0 +1,4 @@
+Name=Ant
+Version=0.1
+Help-Item=Ant Help,doc/VAJAntTool.html
+Menu-Items=Ant Build,org.apache.tools.ant.taskdefs.optional.ide.VAJAntTool,-P;
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JJTree.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JJTree.java
index 447100d..53d8145 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JJTree.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JJTree.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -171,18 +171,22 @@ public class JJTree extends Task {
             cmdl.createArgument().setValue("-"+name+":"+value.toString());
         }
 
-        // load command line with required attributes
-        if (outputDirectory != null) {
-            if (!outputDirectory.isDirectory()) {
-                throw new BuildException("Outputdir not a directory.");
-            }
-            cmdl.createArgument().setValue(
-                "-OUTPUT_DIRECTORY:"+outputDirectory.getAbsolutePath());
-        }
-
         if (target == null || !target.isFile()) {
             throw new BuildException("Invalid target: " + target);
         }
+        
+        // use the directory containing the target as the output directory
+        if (outputDirectory == null) {
+            outputDirectory = new File(target.getParent());
+        }        
+        if (!outputDirectory.isDirectory() ) {
+            throw new BuildException("'outputdirectory' " + outputDirectory + " is not a directory.");
+        }
+        // convert backslashes to slashes, otherwise jjtree will put this as
+        // comments and this seems to confuse javacc
+        cmdl.createArgument().setValue(
+            "-OUTPUT_DIRECTORY:"+outputDirectory.getAbsolutePath().replace('\\', '/'));
+        
         final File javaFile = new File(
             target.toString().substring(0, target.toString().indexOf(".jjt")) + ".jj");
         if (javaFile.exists() && target.lastModified() < javaFile.lastModified()) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JavaCC.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JavaCC.java
index 2ffd242..ae2d29d 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JavaCC.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/javacc/JavaCC.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/ClassNameReader.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/ClassNameReader.java
index 0cc96af..4b8c7d0 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/ClassNameReader.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/ClassNameReader.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -51,7 +51,6 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.tools.ant.taskdefs.optional.jlink;
 
 import java.io .*;
@@ -65,66 +64,66 @@ import java.io .*;
  */
 class ConstantPool extends Object{
 
-	static final 
-	byte UTF8 = 1, UNUSED = 2, INTEGER = 3, FLOAT = 4, LONG = 5, DOUBLE = 6,
-	CLASS = 7, STRING = 8, FIELDREF = 9, METHODREF = 10,
-	INTERFACEMETHODREF = 11, NAMEANDTYPE = 12;
+    static final 
+        byte UTF8 = 1, UNUSED = 2, INTEGER = 3, FLOAT = 4, LONG = 5, DOUBLE = 6,
+        CLASS = 7, STRING = 8, FIELDREF = 9, METHODREF = 10,
+        INTERFACEMETHODREF = 11, NAMEANDTYPE = 12;
 
-	 byte[] types;
+    byte[] types;
 
-	 Object[] values;
+    Object[] values;
 
-	 ConstantPool( DataInput data ) throws IOException {
-		super();
+    ConstantPool( DataInput data ) throws IOException {
+        super();
 
-			int count = data .readUnsignedShort();
-			types = new byte [ count ];
-			values = new Object [ count ];
-			// read in all constant pool entries.
-			for ( int i = 1; i < count; i++ ) {
-				byte type = data .readByte();
-				types[i] = type;
-				switch (type)
-				{
-				case UTF8 :
-					values[i] = data .readUTF();
-					break;
-				
-				case UNUSED :
-					break;
-				
-				case INTEGER :
-					values[i] = new Integer( data .readInt() );
-					break;
-				
-				case FLOAT :
-					values[i] = new Float( data .readFloat() );
-					break;
-				
-				case LONG :
-					values[i] = new Long( data .readLong() );
-					++i;
-					break;
-				
-				case DOUBLE :
-					values[i] = new Double( data .readDouble() );
-					++i;
-					break;
-				
-				case CLASS :
-				case STRING :
-					values[i] = new Integer( data .readUnsignedShort() );
-					break;
-				
-				case FIELDREF :
-				case METHODREF :
-				case INTERFACEMETHODREF :
-				case NAMEANDTYPE :
-					values[i] = new Integer( data .readInt() );
-					break;
-				}
-			}
-		}
+        int count = data .readUnsignedShort();
+        types = new byte [ count ];
+        values = new Object [ count ];
+        // read in all constant pool entries.
+        for ( int i = 1; i < count; i++ ) {
+            byte type = data .readByte();
+            types[i] = type;
+            switch (type)
+            {
+            case UTF8 :
+                values[i] = data .readUTF();
+                break;
+                                
+            case UNUSED :
+                break;
+                                
+            case INTEGER :
+                values[i] = new Integer( data .readInt() );
+                break;
+                                
+            case FLOAT :
+                values[i] = new Float( data .readFloat() );
+                break;
+                                
+            case LONG :
+                values[i] = new Long( data .readLong() );
+                ++i;
+                break;
+                                
+            case DOUBLE :
+                values[i] = new Double( data .readDouble() );
+                ++i;
+                break;
+                                
+            case CLASS :
+            case STRING :
+                values[i] = new Integer( data .readUnsignedShort() );
+                break;
+                                
+            case FIELDREF :
+            case METHODREF :
+            case INTERFACEMETHODREF :
+            case NAMEANDTYPE :
+                values[i] = new Integer( data .readInt() );
+                break;
+            }
+        }
+    }
 
 
 }
@@ -135,25 +134,25 @@ class ConstantPool extends Object{
  */
 public class ClassNameReader extends Object{
 
-	public static 
-	String getClassName( InputStream input ) throws IOException {
-		DataInputStream data = new DataInputStream( input );
-		// verify this is a valid class file.
-		int cookie = data .readInt();
-		if ( cookie != 0xCAFEBABE ) {
-			return null;
-		}
-		int version = data .readInt();
-		// read the constant pool.
-		ConstantPool constants = new ConstantPool( data );
-		Object[] values = constants .values;
-		// read access flags and class index.
-		int accessFlags = data .readUnsignedShort();
-		int classIndex = data .readUnsignedShort();
-		Integer stringIndex = (Integer) values[classIndex];
-		String className = (String) values[stringIndex .intValue()];
-		return className;
-	}
+    public static 
+        String getClassName( InputStream input ) throws IOException {
+        DataInputStream data = new DataInputStream( input );
+        // verify this is a valid class file.
+        int cookie = data .readInt();
+        if ( cookie != 0xCAFEBABE ) {
+            return null;
+        }
+        int version = data .readInt();
+        // read the constant pool.
+        ConstantPool constants = new ConstantPool( data );
+        Object[] values = constants .values;
+        // read access flags and class index.
+        int accessFlags = data .readUnsignedShort();
+        int classIndex = data .readUnsignedShort();
+        Integer stringIndex = (Integer) values[classIndex];
+        String className = (String) values[stringIndex .intValue()];
+        return className;
+    }
 
 
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/JlinkTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/JlinkTask.java
index 8afeb14..a217232 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/JlinkTask.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/JlinkTask.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -177,7 +177,7 @@ public class JlinkTask extends MatchingTask {
             throw new BuildException( ex, location );
         }
     }
-	
+
     private boolean haveAddFiles(){
         return haveEntries(addfiles);
     }
@@ -185,7 +185,7 @@ public class JlinkTask extends MatchingTask {
     private boolean haveMergeFiles(){
         return haveEntries(mergefiles);
     }
-	
+
     private boolean haveEntries(Path p){
         if (p == null){
             return false;
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/jlink.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/jlink.java
index cc5492b..dac3679 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/jlink.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jlink/jlink.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -65,74 +65,74 @@
 package org.apache.tools.ant.taskdefs.optional.jlink;
 
 import java.io .*;
-import java.util.zip .*;
-import java.util .Vector;
 import java.util .Enumeration;
+import java.util .Vector;
+import java.util.zip .*;
 
 public class jlink extends Object{
 
-	/**
+    /**
      * The file that will be created by this instance of jlink.
-	 */
-	public  void setOutfile( String outfile ) {
-		if ( outfile == null ) {
-			return ;
-		}
-		this .outfile = outfile;
-	}
+     */
+    public  void setOutfile( String outfile ) {
+        if ( outfile == null ) {
+            return ;
+        }
+        this .outfile = outfile;
+    }
 
-	/**
+    /**
      * Adds a file to be merged into the output.
-	 */
-	public  void addMergeFile( String mergefile ) {
-		if ( mergefile == null ) {
-			return ;
-		}
-		mergefiles .addElement( mergefile );
-	}
+     */
+    public  void addMergeFile( String mergefile ) {
+        if ( mergefile == null ) {
+            return ;
+        }
+        mergefiles .addElement( mergefile );
+    }
 
-	/**
+    /**
      * Adds a file to be added into the output.
-	 */
-	public  void addAddFile( String addfile ) {
-		if ( addfile == null ) {
-			return ;
-		}
-		addfiles .addElement( addfile );
-	}
+     */
+    public  void addAddFile( String addfile ) {
+        if ( addfile == null ) {
+            return ;
+        }
+        addfiles .addElement( addfile );
+    }
 
-	/**
+    /**
      * Adds several files to be merged into the output.
-	 */
-	public  void addMergeFiles( String[] mergefiles ) {
-		if ( mergefiles == null ) {
-			return ;
-		}
-		for ( int i = 0; i < mergefiles .length; i++ ) {
-			addMergeFile( mergefiles[i] );
-		}
-	}
+     */
+    public  void addMergeFiles( String[] mergefiles ) {
+        if ( mergefiles == null ) {
+            return ;
+        }
+        for ( int i = 0; i < mergefiles .length; i++ ) {
+            addMergeFile( mergefiles[i] );
+        }
+    }
 
-	/**
+    /**
      * Adds several file to be added into the output.
-	 */
-	public  void addAddFiles( String[] addfiles ) {
-		if ( addfiles == null ) {
-			return ;
-		}
-		for ( int i = 0; i < addfiles .length; i++ ) {
-			addAddFile( addfiles[i] );
-		}
-	}
+     */
+    public  void addAddFiles( String[] addfiles ) {
+        if ( addfiles == null ) {
+            return ;
+        }
+        for ( int i = 0; i < addfiles .length; i++ ) {
+            addAddFile( addfiles[i] );
+        }
+    }
 
-	/**
+    /**
      * Determines whether output will be compressed.
-	 */
-	public  void setCompression( boolean compress ) {
-		this .compression = compress;
-	}
+     */
+    public  void setCompression( boolean compress ) {
+        this .compression = compress;
+    }
 
-	/**
+    /**
      * Performs the linking of files.
      * Addfiles are added to the output as-is. For example, a 
      * jar file is added to the output as a jar file.
@@ -146,104 +146,105 @@ public class jlink extends Object{
      * provide multiple, disjoint directories, as
      * addfiles: they will all be added in a rational 
      * manner to outfile.
-	 */
-	public  void link() throws Exception {
-		ZipOutputStream output = new ZipOutputStream( new FileOutputStream( outfile ) );
-		if ( compression ) {
-			output .setMethod( ZipOutputStream .DEFLATED );
-			output .setLevel( Deflater .DEFAULT_COMPRESSION );
-		} else {
-			output .setMethod( ZipOutputStream .STORED );
-		}
-		Enumeration merges = mergefiles .elements();
-		while ( merges .hasMoreElements() ) {
-			String path = (String) merges .nextElement();
-			File f = new File( path );
-			if ( f.getName().endsWith( ".jar" ) || f.getName().endsWith( ".zip" ) ) {
-				//Do the merge
-				mergeZipJarContents( output, f );
-			}
-			else {
-				//Add this file to the addfiles Vector and add it later at the top level of the output file.
-				addAddFile( path );
-			}
-		}
-		Enumeration adds = addfiles .elements();
-		while ( adds .hasMoreElements() ) {
-			String name = (String) adds .nextElement();
-			File f = new File( name );
-			if ( f .isDirectory() ) {
-			    //System.out.println("in jlink: adding directory contents of " + f.getPath());
-				addDirContents( output, f, f.getName() + '/', compression );
-			}
-			else {
-				addFile( output, f, "", compression );
-			}
-		}
-		if ( output != null ) {
-			try  {
-				output .close();
-			} catch( IOException ioe ) {}
-		}
-	}
+     */
+    public  void link() throws Exception {
+        ZipOutputStream output = new ZipOutputStream( new FileOutputStream( outfile ) );
+        if ( compression ) {
+            output .setMethod( ZipOutputStream .DEFLATED );
+            output .setLevel( Deflater .DEFAULT_COMPRESSION );
+        } else {
+            output .setMethod( ZipOutputStream .STORED );
+        }
+        Enumeration merges = mergefiles .elements();
+        while ( merges .hasMoreElements() ) {
+            String path = (String) merges .nextElement();
+            File f = new File( path );
+            if ( f.getName().endsWith( ".jar" ) || f.getName().endsWith( ".zip" ) ) {
+                                //Do the merge
+                mergeZipJarContents( output, f );
+            }
+            else {
+                //Add this file to the addfiles Vector and add it 
+                //later at the top level of the output file.
+                addAddFile( path );
+            }
+        }
+        Enumeration adds = addfiles .elements();
+        while ( adds .hasMoreElements() ) {
+            String name = (String) adds .nextElement();
+            File f = new File( name );
+            if ( f .isDirectory() ) {
+                //System.out.println("in jlink: adding directory contents of " + f.getPath());
+                addDirContents( output, f, f.getName() + '/', compression );
+            }
+            else {
+                addFile( output, f, "", compression );
+            }
+        }
+        if ( output != null ) {
+            try  {
+                output .close();
+            } catch( IOException ioe ) {}
+        }
+    }
 
-	public static  void main( String[] args ) {
-		// jlink output input1 ... inputN
-		if ( args .length < 2 ) {
-			System .out .println( "usage: jlink output input1 ... inputN" );
-			System .exit( 1 );
-		}
-		jlink linker = new jlink();
-		linker .setOutfile( args[0] );
-		//To maintain compatibility with the command-line version, we will only add files to be merged.
-		for ( int i = 1; i < args .length; i++ ) {
-			linker .addMergeFile( args[i] );
-		}
-		try  {
-			linker .link();
-		} catch( Exception ex ) {
-			System .err .print( ex .getMessage() );
-		}
-	}
+    public static  void main( String[] args ) {
+        // jlink output input1 ... inputN
+        if ( args .length < 2 ) {
+            System .out .println( "usage: jlink output input1 ... inputN" );
+            System .exit( 1 );
+        }
+        jlink linker = new jlink();
+        linker .setOutfile( args[0] );
+        //To maintain compatibility with the command-line version, we will only add files to be merged.
+        for ( int i = 1; i < args .length; i++ ) {
+            linker .addMergeFile( args[i] );
+        }
+        try  {
+            linker .link();
+        } catch( Exception ex ) {
+            System .err .print( ex .getMessage() );
+        }
+    }
 
     /*
      * Actually performs the merging of f into the output.
      * f should be a zip or jar file.
      */
-	private void mergeZipJarContents( ZipOutputStream output, File f ) throws IOException {
-		//Check to see that the file with name "name" exists.
-		if ( ! f .exists() ) {
-			return ;
-		}
-		ZipFile zipf = new ZipFile( f );
-		Enumeration entries = zipf.entries();
-		while (entries.hasMoreElements()){
-		    ZipEntry inputEntry = (ZipEntry) entries.nextElement();
-    	    //Ignore manifest entries.  They're bound to cause conflicts between
-	        //files that are being merged.  User should supply their own
-	        //manifest file when doing the merge.
-	        String inputEntryName = inputEntry.getName();
-	        int index = inputEntryName.indexOf("META-INF");
-	        if (index < 0){
-	            //META-INF not found in the name of the entry. Go ahead and process it.
-	            try {
-        		    output.putNextEntry(processEntry(zipf, inputEntry));
-        		} catch (ZipException ex){
-        		    //If we get here, it could be because we are trying to put a
-        		    //directory entry that already exists.
-        		    //For example, we're trying to write "com", but a previous
-        		    //entry from another mergefile was called "com".
-        		    //In that case, just ignore the error and go on to the
-        		    //next entry.
-    		        String mess = ex.getMessage();
-    		        if (mess.indexOf("duplicate") >= 0){
-    		            //It was the duplicate entry.
-    		            continue;
-    		        } else {
-        		        //I hate to admit it, but we don't know what happened here.  Throw the Exception.
-        		        throw ex;
-        		    }
-        		}
+    private void mergeZipJarContents( ZipOutputStream output, File f ) throws IOException {
+        //Check to see that the file with name "name" exists.
+        if ( ! f .exists() ) {
+            return ;
+        }
+        ZipFile zipf = new ZipFile( f );
+        Enumeration entries = zipf.entries();
+        while (entries.hasMoreElements()){
+            ZipEntry inputEntry = (ZipEntry) entries.nextElement();
+            //Ignore manifest entries.  They're bound to cause conflicts between
+            //files that are being merged.  User should supply their own
+            //manifest file when doing the merge.
+            String inputEntryName = inputEntry.getName();
+            int index = inputEntryName.indexOf("META-INF");
+            if (index < 0){
+                //META-INF not found in the name of the entry. Go ahead and process it.
+                try {
+                    output.putNextEntry(processEntry(zipf, inputEntry));
+                } catch (ZipException ex){
+                    //If we get here, it could be because we are trying to put a
+                    //directory entry that already exists.
+                    //For example, we're trying to write "com", but a previous
+                    //entry from another mergefile was called "com".
+                    //In that case, just ignore the error and go on to the
+                    //next entry.
+                    String mess = ex.getMessage();
+                    if (mess.indexOf("duplicate") >= 0){
+                                //It was the duplicate entry.
+                        continue;
+                    } else {
+                                //I hate to admit it, but we don't know what happened here.  Throw the Exception.
+                        throw ex;
+                    }
+                }
                 InputStream in = zipf.getInputStream(inputEntry);
                 int len = buffer.length;
                 int count = -1;
@@ -252,168 +253,168 @@ public class jlink extends Object{
                 }
                 in.close();
                 output.closeEntry();
-	        }
-		}
-		zipf .close();
-	}
+            }
+        }
+        zipf .close();
+    }
 
     /*
      * Adds contents of a directory to the output.
      */
-	private void addDirContents( ZipOutputStream output, File dir, String prefix, boolean compress ) throws IOException {
-		String[] contents = dir .list();
-		for ( int i = 0; i < contents .length; ++i ) {
-			String name = contents[i];
-			File file = new File( dir, name );
-			if ( file .isDirectory() ) {
-				addDirContents( output, file, prefix + name + '/', compress );
-			}
-			else {
-				addFile( output, file, prefix, compress );
-			}
-		}
-	}
+    private void addDirContents( ZipOutputStream output, File dir, String prefix, boolean compress ) throws IOException {
+        String[] contents = dir .list();
+        for ( int i = 0; i < contents .length; ++i ) {
+            String name = contents[i];
+            File file = new File( dir, name );
+            if ( file .isDirectory() ) {
+                addDirContents( output, file, prefix + name + '/', compress );
+            }
+            else {
+                addFile( output, file, prefix, compress );
+            }
+        }
+    }
 
     /*
      * Gets the name of an entry in the file.  This is the real name
      * which for a class is the name of the package with the class
      * name appended.
      */
-	private String getEntryName( File file, String prefix ) {
-		String name = file .getName();
-		if ( ! name .endsWith( ".class" ) ) {
-			// see if the file is in fact a .class file, and determine its actual name.
-			try  {
-				InputStream input = new FileInputStream( file );
-				String className = ClassNameReader .getClassName( input );
-				input .close();
-				if ( className != null ) {
-					return className .replace( '.', '/' ) + ".class";
-				}
-			} catch( IOException ioe ) {}
-		}
-		System.out.println("From " + file.getPath() + " and prefix " + prefix + ", creating entry " + prefix+name);
-		return (prefix + name);
-	}
+    private String getEntryName( File file, String prefix ) {
+        String name = file .getName();
+        if ( ! name .endsWith( ".class" ) ) {
+            // see if the file is in fact a .class file, and determine its actual name.
+            try  {
+                InputStream input = new FileInputStream( file );
+                String className = ClassNameReader .getClassName( input );
+                input .close();
+                if ( className != null ) {
+                    return className .replace( '.', '/' ) + ".class";
+                }
+            } catch( IOException ioe ) {}
+        }
+        System.out.println("From " + file.getPath() + " and prefix " + prefix + ", creating entry " + prefix+name);
+        return (prefix + name);
+    }
 
     /*
      * Adds a file to the output stream.
      */
-	private void addFile( ZipOutputStream output, File file, String prefix, boolean compress) throws IOException {
-		//Make sure file exists
-		long checksum = 0;
-		if ( ! file .exists() ) {
-			return ;
-		}
-		ZipEntry entry = new ZipEntry( getEntryName( file, prefix ) );
-		entry .setTime( file .lastModified() );
-		entry .setSize( file .length() );
+    private void addFile( ZipOutputStream output, File file, String prefix, boolean compress) throws IOException {
+        //Make sure file exists
+        long checksum = 0;
+        if ( ! file .exists() ) {
+            return ;
+        }
+        ZipEntry entry = new ZipEntry( getEntryName( file, prefix ) );
+        entry .setTime( file .lastModified() );
+        entry .setSize( file .length() );
         if (! compress){
-		    entry.setCrc(calcChecksum(file));
+            entry.setCrc(calcChecksum(file));
         }
-		FileInputStream input = new FileInputStream( file );
-		addToOutputStream(output, input, entry);
-	}
-	
+        FileInputStream input = new FileInputStream( file );
+        addToOutputStream(output, input, entry);
+    }
+        
     /*
      * A convenience method that several other methods might call.
      */
-	private void addToOutputStream(ZipOutputStream output, InputStream input, ZipEntry ze) throws IOException{
-	    try {
-            output.putNextEntry(ze);	    
-	    } catch (ZipException zipEx) {
-	        //This entry already exists. So, go with the first one.
-	        input.close();
-	        return;
-	    }
-	    int numBytes = -1;
-	    while((numBytes = input.read(buffer)) > 0){
-	        output.write(buffer, 0, numBytes);
-	    }
-	    output.closeEntry();
-	    input.close();
-	}
+    private void addToOutputStream(ZipOutputStream output, InputStream input, ZipEntry ze) throws IOException{
+        try {
+            output.putNextEntry(ze);            
+        } catch (ZipException zipEx) {
+            //This entry already exists. So, go with the first one.
+            input.close();
+            return;
+        }
+        int numBytes = -1;
+        while((numBytes = input.read(buffer)) > 0){
+            output.write(buffer, 0, numBytes);
+        }
+        output.closeEntry();
+        input.close();
+    }
 
     /*
      * A method that does the work on a given entry in a mergefile.
      * The big deal is to set the right parameters in the ZipEntry 
      * on the output stream.
      */
-	private ZipEntry processEntry( ZipFile zip, ZipEntry inputEntry ) throws IOException{
-	    /*
-	    First, some notes.
-	    On MRJ 2.2.2, getting the size, compressed size, and CRC32 from the
-	    ZipInputStream does not work for compressed (deflated) files.  Those calls return -1.
-	    For uncompressed (stored) files, those calls do work.
-	    However, using ZipFile.getEntries() works for both compressed and 
-	    uncompressed files.
-	    
-	    Now, from some simple testing I did, it seems that the value of CRC-32 is
-	    independent of the compression setting. So, it should be easy to pass this 
-	    information on to the output entry.
-	    */
-		String name = inputEntry .getName();
-		if ( ! (inputEntry .isDirectory() || name .endsWith( ".class" )) ) {
-			try  {
-				InputStream input = zip.getInputStream( zip .getEntry( name ) );
-				String className = ClassNameReader .getClassName( input );
-				input .close();
-				if ( className != null ) {
-					name = className .replace( '.', '/' ) + ".class";
-				}
-			} catch( IOException ioe ) {}
-		}
-		ZipEntry outputEntry = new ZipEntry( name );
-		outputEntry.setTime(inputEntry .getTime() );
-		outputEntry.setExtra(inputEntry.getExtra());
-		outputEntry.setComment(inputEntry.getComment());
+    private ZipEntry processEntry( ZipFile zip, ZipEntry inputEntry ) throws IOException{
+        /*
+          First, some notes.
+          On MRJ 2.2.2, getting the size, compressed size, and CRC32 from the
+          ZipInputStream does not work for compressed (deflated) files.  Those calls return -1.
+          For uncompressed (stored) files, those calls do work.
+          However, using ZipFile.getEntries() works for both compressed and 
+          uncompressed files.
+            
+          Now, from some simple testing I did, it seems that the value of CRC-32 is
+          independent of the compression setting. So, it should be easy to pass this 
+          information on to the output entry.
+        */
+        String name = inputEntry .getName();
+        if ( ! (inputEntry .isDirectory() || name .endsWith( ".class" )) ) {
+            try  {
+                InputStream input = zip.getInputStream( zip .getEntry( name ) );
+                String className = ClassNameReader .getClassName( input );
+                input .close();
+                if ( className != null ) {
+                    name = className .replace( '.', '/' ) + ".class";
+                }
+            } catch( IOException ioe ) {}
+        }
+        ZipEntry outputEntry = new ZipEntry( name );
+        outputEntry.setTime(inputEntry .getTime() );
+        outputEntry.setExtra(inputEntry.getExtra());
+        outputEntry.setComment(inputEntry.getComment());
         outputEntry.setTime(inputEntry.getTime());
-		if (compression){
-		    outputEntry.setMethod(ZipEntry.DEFLATED);
+        if (compression){
+            outputEntry.setMethod(ZipEntry.DEFLATED);
             //Note, don't need to specify size or crc for compressed files.
-		} else {
-		    outputEntry.setMethod(ZipEntry.STORED);
+        } else {
+            outputEntry.setMethod(ZipEntry.STORED);
             outputEntry.setCrc(inputEntry.getCrc());
-		    outputEntry.setSize(inputEntry.getSize());
-		}
-		return outputEntry;
-	}
-	
+            outputEntry.setSize(inputEntry.getSize());
+        }
+        return outputEntry;
+    }
+        
     /*
      * Necessary in the case where you add a entry that
      * is not compressed.
      */
-	private long calcChecksum(File f) throws IOException {
-	    BufferedInputStream in = new BufferedInputStream(new FileInputStream(f));
-	    return calcChecksum(in, f.length());
-	}
+    private long calcChecksum(File f) throws IOException {
+        BufferedInputStream in = new BufferedInputStream(new FileInputStream(f));
+        return calcChecksum(in, f.length());
+    }
 
     /*
      * Necessary in the case where you add a entry that
      * is not compressed.
      */
-	private long calcChecksum(InputStream in, long size) throws IOException{
-	    CRC32 crc = new CRC32();
-		int len = buffer.length;
-		int count = -1;
-		int haveRead = 0; 
+    private long calcChecksum(InputStream in, long size) throws IOException{
+        CRC32 crc = new CRC32();
+        int len = buffer.length;
+        int count = -1;
+        int haveRead = 0; 
         while((count=in.read(buffer, 0, len)) > 0){
             haveRead += count;
             crc.update(buffer, 0, count);
         }
         in.close();
         return crc.getValue();
-	}
+    }
 
-	private  String outfile = null;
+    private  String outfile = null;
 
-	private  Vector mergefiles = new Vector( 10 );
+    private  Vector mergefiles = new Vector( 10 );
 
-	private  Vector addfiles = new Vector( 10 );
+    private  Vector addfiles = new Vector( 10 );
 
-	private  boolean compression = false;
-	
-	byte[] buffer = new byte[8192];
+    private  boolean compression = false;
+        
+    byte[] buffer = new byte[8192];
 
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jsp/WLJspc.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jsp/WLJspc.java
index d7d63cd..51d45b4 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jsp/WLJspc.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/jsp/WLJspc.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/AggregateTransformer.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/AggregateTransformer.java
new file mode 100644
index 0000000..91dd514
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/AggregateTransformer.java
@@ -0,0 +1,529 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.junit;
+
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.BuildException;
+
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.InputStream;
+import java.io.OutputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+
+import java.util.Enumeration;
+import java.util.Hashtable;
+
+import org.apache.xalan.xslt.XSLTProcessorFactory;
+import org.apache.xalan.xslt.XSLTProcessor;
+import org.apache.xalan.xslt.XSLTInputSource;
+import org.apache.xalan.xslt.XSLTResultTarget;
+
+import javax.xml.parsers.DocumentBuilderFactory;
+import javax.xml.parsers.DocumentBuilder;
+import javax.xml.parsers.ParserConfigurationException;
+
+import org.w3c.dom.Document;
+import org.w3c.dom.Element;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import org.w3c.dom.NamedNodeMap;
+
+import org.xml.sax.SAXException;
+
+/**
+ * Transform a JUnit xml report.
+ * The default transformation generates an html report in either framed or non-framed
+ * style. The non-framed style is convenient to have a concise report via mail, the
+ * framed report is much more convenient if you want to browse into different
+ * packages or testcases since it is a Javadoc like report.
+ * In the framed report, there are 3 frames:
+ * <ul>
+ *  <li>packageListFrame - list of all packages.
+ *  <li>classListFrame - summary of all testsuites belonging to a package or tests list.
+ *  <li>classFrame - details of all tests made for a package or for a testsuite.
+ * </ul>
+ * As a default, the transformer will use its default stylesheets, they may not be
+ * be appropriate for users who wants to customize their reports, so you can indicates
+ * your own stylesheets by using <tt>setStyleDir()</tt>.
+ * Stylesheets must be as follows:
+ * <ul>
+ *   <li><b>all-packages.xsl</b> create the package list. It creates
+ *   all-packages.html file in the html folder and it is load in the packageListFrame</li>
+ *   <li><b>all-classes.xsl</b> creates the class list. It creates the all-classes.html
+ * file in the html folder is loaded by the 'classListFrame' frame</li>
+ *   <li><b>overview-packages.xsl</b> allows to get summary on all tests made
+ *   for each packages and each class that not include in a package. The filename
+ *   is overview-packages.html</li>
+ *   <li><b>class-detail.xsl</b> is the style for the detail of the tests made on a class.
+ *   the Html resulting page in write in the directory of the package and the name
+ *   of this page is the name of the class with "-detail" element. For instance,
+ *   the style is applied on the MyClass testsuite, the resulting filename is
+ *   <u>MyClass-detail.html</u>. This file is load in the "classFrame" frame.</li>
+ *   <li><b>package-summary.xsl</b> allows to create a summary on the package.
+ *   The resulting html file is write in the package directory. The name of this
+ *   file is <u>package-summary.html</u> This file is load in the "classFrame" frame.</li>
+ *   <li><b>classes-list.xsl</b> create the list of the class in this package.
+ *   The resulting html file is write in the package directory and it is load in
+ *   the 'classListFrame' frame. The name of the resulting file is <u>class-list.html</u></li>
+ * <li>
+ *
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ * @author <a href="mailto:ndelahaye@imediation.com">Nicolas Delahaye</a>
+ */
+public class AggregateTransformer {     
+        
+    public final static String ALLPACKAGES = "all-packages";
+        
+    public final static String ALLCLASSES = "all-classes";
+        
+    public final static String OVERVIEW_PACKAGES = "overview-packages";
+        
+    public final static String CLASS_DETAILS = "class-details";
+        
+    public final static String CLASSES_LIST = "classes-list";
+        
+    public final static String PACKAGE_SUMMARY = "package-summary";
+        
+    public final static String OVERVIEW_SUMMARY = "overview-summary";
+
+    public final static String FRAMES = "frames";
+
+    public final static String NOFRAMES = "noframes";
+
+    /** Task */
+    protected Task task;
+
+    /** the xml document to process */
+    protected Document document;
+
+    /** the style directory. XSLs should be read from here if necessary */
+    protected File styleDir;
+
+    /** the destination directory, this is the root from where html should be generated */
+    protected File toDir;
+
+    /** the format to use for the report. Must be <tt>FRAMES</tt> or <tt>NOFRAMES</tt> */
+    protected String format;
+
+    /** the file extension of the generated files. As a default it will be <tt>.html</tt> */
+    protected String extension;
+
+    /** XML Parser factory */
+    protected static final DocumentBuilderFactory dbfactory = DocumentBuilderFactory.newInstance();
+
+    public AggregateTransformer(Task task){
+        this.task = task;
+    }
+
+    public void setFormat(String format){
+        this.format = format;
+    }
+
+    public void setXmlDocument(Document doc){
+        this.document = doc;
+    }
+
+    /**
+     * Set the xml file to be processed. This is a helper if you want
+     * to set the file directly. Much more for testing purposes.
+     * @param xmlfile xml file to be processed
+     */
+    void setXmlfile(File xmlfile) throws BuildException {
+        try {
+            setXmlDocument(readDocument(xmlfile));
+        } catch (Exception e){
+            throw new BuildException("Error while parsing document: " + xmlfile, e);
+        }
+    }
+
+    /**
+     * set the style directory. It is optional and will override the
+     * default xsl used.
+     * @param styledir  the directory containing the xsl files if the user
+     * would like to override with its own style.
+     */
+    public void setStyledir(File styledir){
+        this.styleDir = styledir;
+    }
+
+    /** set the destination directory */
+    public void setTodir(File todir){
+        this.toDir = todir;
+    }
+
+    /** set the extension of the output files */
+    public void setExtension(String ext){
+        this.extension = ext;
+    }
+
+    /** get the extension, if it is null, it will use .html as the default */
+    protected String getExtension(){
+        if (extension == null) {
+            extension = ".html";
+        }
+        return extension;
+    }
+
+    public void transform() throws BuildException {
+        checkOptions();
+        try {
+            Element root = document.getDocumentElement();
+                        
+            if (NOFRAMES.equals(format)) {
+                //createCascadingStyleSheet();
+                createSinglePageSummary(root);
+            } else {
+                createFrameStructure();
+                createCascadingStyleSheet();
+                createPackageList(root);
+                createClassList(root);
+                createPackageOverview(root);
+                createAllTestSuiteDetails(root);
+                createAllPackageDetails(root);
+            }
+        } catch (Exception e){
+            e.printStackTrace();
+            throw new BuildException("Errors while applying transformations", e);
+        }
+    }
+
+    /** check for invalid options */
+    protected void checkOptions() throws BuildException {
+        if ( !FRAMES.equals(format) && !NOFRAMES.equals(format)) {
+            throw new BuildException("Invalid format. Must be 'frames' or 'noframes' but was: '" + format + "'");
+        }
+        // set the destination directory relative from the project if needed.
+        if (toDir == null) {
+            toDir = task.getProject().resolveFile(".");
+        } else if ( !toDir.isAbsolute() ) {
+            toDir = task.getProject().resolveFile(toDir.getPath());
+        }
+        // create the directories if needed
+        if (!toDir.exists()) {
+            if (!toDir.mkdirs()){
+                throw new BuildException("Could not create directory " + toDir);
+            }
+        }
+    }
+
+    /** create a single page summary */
+    protected void createSinglePageSummary(Element root) throws IOException, SAXException {
+        transform(root, OVERVIEW_SUMMARY + ".xsl", OVERVIEW_SUMMARY + getExtension());
+    }
+
+    /**
+     * read the xml file that should be the resuiting file of the testcase.
+     * @param filename name of the xml resulting file of the testcase.
+     */
+    protected Document readDocument(File file) throws IOException, SAXException, ParserConfigurationException {
+        DocumentBuilder builder = dbfactory.newDocumentBuilder();
+        InputStream in = new FileInputStream(file);
+        try {
+            return builder.parse(in);
+        } finally {
+            in.close();
+        }
+    }
+
+    protected void createCascadingStyleSheet() throws IOException, SAXException {
+        InputStream in = null;
+        if (styleDir == null) {
+            in = getResourceAsStream("html/stylesheet.css");
+        } else {
+            in = new FileInputStream(new File(styleDir, "stylesheet.css"));
+        }
+        OutputStream out = new FileOutputStream( new File(toDir, "stylesheet.css"));
+        copy(in, out);
+    }
+
+    protected void createFrameStructure() throws IOException, SAXException{
+        InputStream in = null;
+        if (styleDir == null) {
+            in = getResourceAsStream("html/index.html");
+        } else {
+            in = new FileInputStream(new File(styleDir, "index.html"));
+        }
+        OutputStream out = new FileOutputStream( new File(toDir, "index.html") );
+        copy(in, out);
+    }
+        
+    /**
+     * Create the list of all packages.
+     * @param root root of the xml document.
+     */
+    protected void createPackageList(Node root) throws SAXException {
+        transform(root, ALLPACKAGES + ".xsl", ALLPACKAGES + getExtension());
+    }
+
+    /**
+     * Create the list of all classes.
+     * @param root root of the xml document.
+     */
+    protected void createClassList(Node root) throws SAXException {
+        transform(root, ALLCLASSES + ".xsl", ALLCLASSES + getExtension());
+    }
+
+    /**
+     * Create the summary used in the overview.
+     * @param root root of the xml document.
+     */
+    protected void createPackageOverview(Node root) throws SAXException {
+        transform(root,  OVERVIEW_PACKAGES + ".xsl", OVERVIEW_PACKAGES + getExtension());
+    }
+
+    /**
+     *  @return the list of all packages that exists defined in testsuite nodes
+     */
+    protected Enumeration getPackages(Element root){
+        Hashtable map = new Hashtable();
+        NodeList testsuites = root.getElementsByTagName(XMLConstants.TESTSUITE);
+        final int size = testsuites.getLength();
+        for (int i = 0; i < size; i++){
+            Element testsuite = (Element) testsuites.item(i);
+            String packageName = testsuite.getAttribute(XMLConstants.ATTR_PACKAGE);
+            if (packageName == null){
+                //@todo replace the exception by something else
+                throw new IllegalStateException("Invalid 'testsuite' node: should contains 'package' attribute");
+            }
+            map.put(packageName, packageName);
+        }
+        return map.keys();
+    }
+
+    /**
+     * create all resulting html pages for all testsuites.
+     * @param root should be 'testsuites' node.
+     */
+    protected void createAllTestSuiteDetails(Element root) throws SAXException {
+        NodeList testsuites = root.getElementsByTagName(XMLConstants.TESTSUITE);
+        final int size = testsuites.getLength();
+        for (int i = 0; i < size; i++){
+            Element testsuite = (Element) testsuites.item(i);
+            createTestSuiteDetails(testsuite);
+        }
+    }
+
+    /**
+     * create the html resulting page of one testsuite.
+     * @param root should be 'testsuite' node.
+     */
+    protected void createTestSuiteDetails(Element testsuite) throws SAXException {
+                
+        String packageName = testsuite.getAttribute(XMLConstants.ATTR_PACKAGE);         
+        String pkgPath = packageToPath(packageName);
+        
+        // get the class name
+        String name = testsuite.getAttribute(XMLConstants.ATTR_NAME);
+
+        // get the name of the testsuite and create the filename of the ouput html page
+        String filename = name + "-details" + getExtension();
+        String fullpathname = pkgPath + filename; // there's already end path separator to pkgPath
+
+        // apply the style on the document.
+        transform(testsuite, CLASS_DETAILS + ".xsl", fullpathname);
+    }
+
+    /**
+     * create the html resulting page of the summary of each package of the root element.
+     * @param root should be 'testsuites' node.
+     */
+    protected void createAllPackageDetails(Element root) throws SAXException, ParserConfigurationException {
+        Enumeration packages = getPackages(root);
+        while ( packages.hasMoreElements() ){
+            String pkgname = (String)packages.nextElement();
+            // for each package get the list of its testsuite.
+            DOMUtil.NodeFilter pkgFilter = new PackageFilter(pkgname);
+            NodeList testsuites = DOMUtil.listChildNodes(root, pkgFilter, false);
+            Element doc = buildDocument(testsuites);
+            // skip package details if the package does not exist (root package)
+            if( !pkgname.equals("") ){
+                createPackageDetails(doc, pkgname);
+            }
+        }
+    }
+
+    protected String packageToPath(String pkgname){
+        if (!pkgname.equals("")) {
+            return pkgname.replace('.', File.separatorChar) + File.separatorChar;
+        }
+        return "." + File.separatorChar;
+    }
+
+    /**
+     * create the html resulting page of the summary of a package .
+     * @param root should be 'testsuites' node.
+     * @param pkgname Name of the package that we want a summary.
+     */
+    protected void createPackageDetails(Node root, String pkgname) throws SAXException {
+        String path = packageToPath(pkgname);
+
+        // apply style to get the list of the classes of this package and
+        // display it in the classListFrame.
+        transform(root, CLASSES_LIST + ".xsl", path + CLASSES_LIST + getExtension());
+
+        // apply style to get a summary on this package.
+        transform(root, PACKAGE_SUMMARY + ".xsl", path + PACKAGE_SUMMARY + getExtension());
+    }
+
+    /**
+     * Create an element root ("testsuites")
+     * and import all nodes as children of this element.
+     *
+     */
+    protected Element buildDocument(NodeList list) throws ParserConfigurationException {
+        DocumentBuilder builder = dbfactory.newDocumentBuilder();
+        Document doc = builder.newDocument();
+        Element elem = doc.createElement(XMLConstants.TESTSUITES);
+        final int len = list.getLength();
+        for(int i=0 ; i < len ; i++) {
+            DOMUtil.importNode(elem, list.item(i));
+        }
+        return elem;
+    }
+
+    /**
+     * Apply a template on a part of the xml document.
+     *
+     * @param root root of the document fragment
+     * @param xslfile style file
+     * @param outfilename filename of the result of the style applied on the Node
+     *
+     * @throws SAXException SAX Parsing Error on the style Sheet.
+     */
+    protected void transform(Node root, String xslname, String htmlname) throws SAXException {
+        try{
+            final long t0 = System.currentTimeMillis();
+            XSLTInputSource xsl_source = getXSLStreamSource(xslname);
+            XSLTProcessor processor = XSLTProcessorFactory.getProcessor();
+            File htmlfile = new File(toDir, htmlname);
+            // create the directory if it does not exist
+            File dir = new File(htmlfile.getParent()); // getParentFile is in JDK1.2+
+            if (!dir.exists()) {
+                dir.mkdirs();
+            }
+            task.log("Applying '" + xslname + "'. Generating '" + htmlfile + "'", Project.MSG_VERBOSE);
+            processor.process( new XSLTInputSource(root), xsl_source, new XSLTResultTarget(htmlfile.getAbsolutePath()) );
+            final long dt = System.currentTimeMillis() - t0;
+            task.log("Transform time for " + xslname + ": " + dt + "ms");
+        } catch (IOException e){
+            task.log(e.getMessage(), Project.MSG_ERR);
+            e.printStackTrace(); //@todo bad, change this
+            throw new SAXException(e.getMessage());
+        }
+    }
+
+
+    /**
+     * default xsls are embedded in the distribution jar. As a default we will use
+     * them, otherwise we will get the one supplied by the client in a given
+     * directory. It must have the same name.
+     */
+    protected XSLTInputSource getXSLStreamSource(String name) throws IOException {
+        InputStream in;
+        String systemId; //we need this because there are references in xsls
+        if (styleDir == null){
+            in = getResourceAsStream("xsl/" + name);
+            systemId = getClass().getResource("xsl/" + name).toString();
+        } else {
+            File f = new File(styleDir, name);
+            in= new FileInputStream(f);
+            systemId = f.getAbsolutePath();
+        }
+        XSLTInputSource ss = new XSLTInputSource(in);
+        ss.setSystemId(systemId);
+        return ss;
+    }
+
+    private InputStream getResourceAsStream(String name) throws FileNotFoundException {
+        InputStream in = getClass().getResourceAsStream(name);
+        if (in == null) {
+            throw new FileNotFoundException("Could not find resource '" + name + "'");
+        }
+        return in;
+    }
+
+    /** Do some raw stream copying */
+    private static void copy(InputStream in, OutputStream out) throws IOException {
+        int size = -1;
+        byte[] buffer =  new byte[1024];
+        // Make the copy
+        while( (size = in.read(buffer)) != -1){
+            out.write(buffer,0,size);
+        }
+    }
+
+
+    /**
+     * allow us to check if the node is a object of a specific package.
+     */
+    protected static class PackageFilter implements DOMUtil.NodeFilter {
+        private final String pkgName;
+
+        PackageFilter(String pkgname) {
+            this.pkgName = pkgname;
+        }
+        /**
+         * if the node receive is not a element then return false
+         * check if the node is a class of this package.
+         */
+        public boolean accept(Node node) {
+            String pkgname = DOMUtil.getNodeAttribute(node, XMLConstants.ATTR_PACKAGE);
+            return pkgName.equals(pkgname);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BaseTest.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BaseTest.java
index 2d001a4..82bbf7f 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BaseTest.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BaseTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,12 +54,14 @@
 
 package org.apache.tools.ant.taskdefs.optional.junit;
 
+import java.io.File;
 import java.util.Vector;
 
 /**
  * Baseclass for BatchTest and JUnitTest.
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
  */
 public abstract class BaseTest {
     protected boolean haltOnError = false;
@@ -68,6 +70,8 @@ public abstract class BaseTest {
     protected String ifProperty = null;
     protected String unlessProperty = null;
     protected Vector formatters = new Vector();
+    /** destination directory */
+    protected File destDir = null;
 
     public void setFork(boolean value) {
         fork = value;
@@ -104,4 +108,23 @@ public abstract class BaseTest {
     public void addFormatter(FormatterElement elem) {
         formatters.addElement(elem);
     }
+
+    /**
+     * Sets the destination directory.
+     */
+    public void setTodir(File destDir) {
+        this.destDir = destDir; 
+    }
+
+    /**
+     * @return the destination directory as an absolute path if it exists
+     *			otherwise return <tt>null</tt>
+     */
+    public String getTodir(){
+        if (destDir != null){
+            return destDir.getAbsolutePath();
+        }
+        return null;
+    }
+
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BatchTest.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BatchTest.java
index 33da6df..f25e5ce 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BatchTest.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/BatchTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -61,76 +61,148 @@ import org.apache.tools.ant.types.FileSet;
 import org.apache.tools.ant.types.Reference;
 
 import java.util.*;
+import java.io.File;
 
 /**
  * Create JUnitTests from a list of files.
  *
  * @author <a href="mailto:jeff.martin@synamic.co.uk">Jeff Martin</a>
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ *
+ * @see JUnitTest
  */
 public final class BatchTest extends BaseTest {
+
+    /** the reference to the project */
     private Project project;
 
+    /** the list of filesets containing the testcase filename rules */
     private Vector filesets = new Vector();
 
+    /**
+     * create a new batchtest instance
+     * @param project     the project it depends on.
+     */
     public BatchTest(Project project){
         this.project = project;
     }
 
+    /**
+     * Add a new fileset instance to this batchtest. Whatever the fileset is,
+     * only filename that are <tt>.java</tt> or <tt>.class</tt> will be
+     * considered as 'candidates'.
+     * @param     fs the new fileset containing the rules to get the testcases.
+     */
     public void addFileSet(FileSet fs) {
         filesets.addElement(fs);
     }
 
+    /**
+     * return all <tt>JUnitTest</tt> instances obtain by applying the fileset rules.
+     * @return  an enumeration of all elements of this batchtest that are
+     * a <tt>JUnitTest</tt> instance.
+     * @see addTestsTo(Vector)
+     */
     public final Enumeration elements(){
-        return new FileList();
+        JUnitTest[] tests = createAllJUnitTest();
+        return Enumerations.fromArray(tests);
     }
 
-    public class FileList implements Enumeration{
-        private String files[]=null;
-        private int i=0;
-        
-        private FileList(){
-            Vector v = new Vector();
-            for (int j=0; j<filesets.size(); j++) {
-                FileSet fs = (FileSet) filesets.elementAt(j);
-                DirectoryScanner ds = fs.getDirectoryScanner(project);
-                ds.scan();
-                String[] f = ds.getIncludedFiles();
-                for (int k=0; k<f.length; k++) {
-                    if (f[k].endsWith(".java")) {
-                        v.addElement(f[k].substring(0, f[k].length()-5));
-                    } else if (f[k].endsWith(".class")) {
-                        v.addElement(f[k].substring(0, f[k].length()-6));
-                    }
-                }
-            }
-
-            files = new String[v.size()];
-            v.copyInto(files);
+    /**
+     * Convenient method to merge the <tt>JUnitTest</tt>s of this batchtest
+     * to a <tt>Vector</tt>.
+     * @param v the vector to which should be added all individual tests of this
+     * batch test.
+     */
+    final void addTestsTo(Vector v){
+        JUnitTest[] tests = createAllJUnitTest();
+        v.ensureCapacity( v.size() + tests.length);
+        for (int i = 0; i < tests.length; i++) {
+            v.addElement(tests[i]);
         }
-        public final boolean hasMoreElements(){
-            if(i<files.length)return true;
-            return false;
+    }
+
+    /**
+     * Create all <tt>JUnitTest</tt>s based on the filesets. Each instance
+     * is configured to match this instance properties.
+     * @return the array of all <tt>JUnitTest</tt>s that belongs to this batch.
+     */
+    private JUnitTest[] createAllJUnitTest(){
+        String[] filenames = getFilenames();
+        JUnitTest[] tests = new JUnitTest[filenames.length];
+        for (int i = 0; i < tests.length; i++) {
+            String classname = javaToClass(filenames[i]);
+            tests[i] = createJUnitTest(classname);
         }
-        public final Object nextElement() throws NoSuchElementException{
-            if(hasMoreElements()){
-                JUnitTest test = new JUnitTest(javaToClass(files[i]));
-                test.setHaltonerror(haltOnError);
-                test.setHaltonfailure(haltOnFail);
-                test.setFork(fork);
-                test.setIf(ifProperty);
-                test.setUnless(unlessProperty);
-                Enumeration list = formatters.elements();
-                while (list.hasMoreElements()) {
-                    test.addFormatter((FormatterElement)list.nextElement());
+        return tests;
+    }
+
+    /**
+     * Iterate over all filesets and return the filename of all files
+     * that end with <tt>.java</tt> or <tt>.class</tt>. This is to avoid
+     * wrapping a <tt>JUnitTest</tt> over an xml file for example. A Testcase
+     * is obviouslly a java file (compiled or not).
+     * @return an array of filenames without their extension. As they should
+     * normally be taken from their root, filenames should match their fully
+     * qualified class name (If it is not the case it will fail when running the test).
+     * For the class <tt>org/apache/Whatever.class</tt> it will return <tt>org/apache/Whatever</tt>.
+     */
+    private String[] getFilenames(){
+        Vector v = new Vector();
+        final int size = this.filesets.size();
+        for (int j=0; j<size; j++) {
+            FileSet fs = (FileSet) filesets.elementAt(j);
+            DirectoryScanner ds = fs.getDirectoryScanner(project);
+            ds.scan();
+            String[] f = ds.getIncludedFiles();
+            for (int k = 0; k < f.length; k++) {
+                String pathname = f[k];
+                if (pathname.endsWith(".java")) {
+                    v.addElement(pathname.substring(0, pathname.length()-".java".length()));
+                } else if (pathname.endsWith(".class")) {
+                    v.addElement(pathname.substring(0, pathname.length()-".class".length()));
                 }
-                i++;
-                return test;
             }
-            throw new NoSuchElementException();
         }
-        public final String javaToClass(String fileName){
-            return fileName.replace(java.io.File.separatorChar, '.');
+
+        String[] files = new String[v.size()];
+        v.copyInto(files);
+        return files;
+    }
+
+    /**
+     * convenient method to convert a pathname without extension to a
+     * fully qualified classname. For example <tt>org/apache/Whatever</tt> will
+     * be converted to <tt>org.apache.Whatever</tt>
+     * @param filename the filename to "convert" to a classname.
+     * @return the classname matching the filename.
+     */
+    public final static String javaToClass(String filename){
+        return filename.replace(File.separatorChar, '.');
+    }
+
+    /**
+     * Create a <tt>JUnitTest</tt> that has the same property as this
+     * <tt>BatchTest</tt> instance.
+     * @param classname the name of the class that should be run as a
+     * <tt>JUnitTest</tt>. It must be a fully qualified name.
+     * @return the <tt>JUnitTest</tt> over the given classname.
+     */
+    private JUnitTest createJUnitTest(String classname){
+        JUnitTest test = new JUnitTest();
+        test.setName(classname);
+        test.setHaltonerror(this.haltOnError);
+        test.setHaltonfailure(this.haltOnFail);
+        test.setFork(this.fork);
+        test.setIf(this.ifProperty);
+        test.setUnless(this.unlessProperty);
+        test.setTodir(this.destDir);
+        Enumeration list = this.formatters.elements();
+        while (list.hasMoreElements()) {
+            test.addFormatter((FormatterElement)list.nextElement());
         }
+        return test;
     }
+
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/DOMUtil.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/DOMUtil.java
new file mode 100644
index 0000000..9977b36
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/DOMUtil.java
@@ -0,0 +1,254 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.junit;
+
+import org.w3c.dom.Node;
+import org.w3c.dom.Document;
+import org.w3c.dom.CDATASection;
+import org.w3c.dom.Comment;
+import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
+import org.w3c.dom.Attr;
+import org.w3c.dom.EntityReference;
+import org.w3c.dom.ProcessingInstruction;
+import org.w3c.dom.Text;
+import org.w3c.dom.NodeList;
+import org.w3c.dom.DOMException;
+
+import java.util.Vector;
+
+/**
+ * Some utilities that might be useful when manipulating DOM trees.
+ *
+ * @author <a href="bailliez@noos.fr">Stephane Bailliez</a>
+ */
+public final class DOMUtil {
+
+    /** unused constructor */
+    private DOMUtil(){
+    }
+
+    /**
+     * Filter interface to be applied when iterating over a DOM tree.
+     * Just think of it like a <tt>FileFilter</tt> clone.
+     */
+    public interface NodeFilter {
+        /**
+         * @param       node    the node to check for acceptance.
+         * @return      <tt>true</tt> if the node is accepted by this filter,
+         *                      otherwise <tt>false</tt>
+         */
+        public boolean accept(Node node);
+    }
+
+    /**
+     * list a set of node that match a specific filter. The list can be made
+     * recursively or not.
+     * @param   parent  the parent node to search from
+     * @param   filter  the filter that children should match.
+     * @param   recurse <tt>true</tt> if you want the list to be made recursively
+     *                  otherwise <tt>false</tt>.
+     */
+    public static NodeList listChildNodes(Node parent, NodeFilter filter, boolean recurse){
+        NodeListImpl matches = new NodeListImpl();
+        NodeList children = parent.getChildNodes();
+        if (children != null) {
+            final int len = children.getLength();
+            for (int i = 0; i < len; i++) {
+                Node child = children.item(i);
+                if (filter.accept(child)) {
+                    matches.addElement(child);
+                }
+                if (recurse) {
+                    NodeList recmatches = listChildNodes(child, filter, recurse);
+                    final int reclength = matches.getLength();
+                    for (int j = 0; j < reclength; j++) {
+                        matches.addElement( recmatches.item(i) );
+                    }
+                }
+            }
+        }
+        return matches;
+    }
+
+    /** custom implementation of a nodelist */
+    public static class NodeListImpl extends Vector implements NodeList {
+        public int getLength(){
+            return size();
+        }
+        public Node item(int i){
+            try {
+                return (Node)elementAt(i);
+            } catch (ArrayIndexOutOfBoundsException e){
+                return null; // conforming to NodeList interface
+            }
+        }
+    }
+
+    /**
+     * return the attribute value of an element.
+     * @param node the node to get the attribute from.
+     * @param name the name of the attribute we are looking for the value.
+     * @return the value of the requested attribute or <tt>null</tt> if the
+     *         attribute was not found or if <tt>node</tt> is not an <tt>Element</tt>.
+     */
+    public static String getNodeAttribute(Node node, String name) {
+        if (node instanceof Element) {
+            Element element = (Element)node;
+            return element.getAttribute(name);
+        }
+        return null;
+    }
+
+
+    /**
+     * Iterate over the children of a given node and return the first node
+     * that has a specific name.
+     * @param   parent  the node to search child from. Can be <tt>null</tt>.
+     * @param   tagname the child name we are looking for. Cannot be <tt>null</tt>.
+     * @return  the first child that matches the given name or <tt>null</tt> if
+     *                  the parent is <tt>null</tt> or if a child does not match the
+     *                  given name.
+     */
+    public static Element getChildByTagName (Node parent, String tagname) {
+        if (parent == null){
+            return null;
+        }
+        NodeList childList = parent.getChildNodes();
+        final int len = childList.getLength();
+        for (int i = 0; i < len; i++) {
+            Node child = childList.item(i);
+            if ( child != null && child.getNodeType() == Node.ELEMENT_NODE &&
+                 child.getNodeName().equals(tagname)) {
+                return (Element)child;
+            }
+        }
+        return null;
+    }
+
+    /**
+     * Simple tree walker that will clone recursively a node. This is to
+     * avoid using parser-specific API such as Sun's <tt>changeNodeOwner</tt>
+     * when we are dealing with DOM L1 implementations since <tt>cloneNode(boolean)</tt>
+     * will not change the owner document.
+     * <tt>changeNodeOwner</tt> is much faster and avoid the costly cloning process.
+     * <tt>importNode</tt> is in the DOM L2 interface.
+     * @param   parent  the node parent to which we should do the import to.
+     * @param   child   the node to clone recursively. Its clone will be
+     *              appended to <tt>parent</tt>.
+     * @return  the cloned node that is appended to <tt>parent</tt>
+     */
+    public static final Node importNode(Node parent, Node child){
+        Node copy = null;
+        final Document doc = parent.getOwnerDocument();
+
+        switch (child.getNodeType()) {
+        case Node.CDATA_SECTION_NODE:
+            copy = doc.createCDATASection(((CDATASection) child).getData());
+            break;
+        case Node.COMMENT_NODE:
+            copy = doc.createComment(((Comment) child).getData());
+            break;
+        case Node.DOCUMENT_FRAGMENT_NODE:
+            copy = doc.createDocumentFragment();
+            break;
+        case Node.ELEMENT_NODE:
+            final Element elem = doc.createElement(((Element)child).getTagName());
+            copy = elem;
+            final NamedNodeMap attributes = child.getAttributes();
+            if ( attributes != null) {
+                final int size = attributes.getLength();
+                for (int i = 0; i < size; i++) {
+                    final Attr attr = (Attr) attributes.item(i);
+                    elem.setAttribute(attr.getName(), attr.getValue());
+                }
+            }
+            break;
+        case Node.ENTITY_REFERENCE_NODE:
+            copy = doc.createEntityReference(child.getNodeName());
+            break;
+        case Node.PROCESSING_INSTRUCTION_NODE:
+            final ProcessingInstruction pi = (ProcessingInstruction)child;
+            copy = doc.createProcessingInstruction(pi.getTarget(), pi.getData());
+            break;
+        case Node.TEXT_NODE:
+            copy = doc.createTextNode(((Text) child).getData());
+            break;
+        default:
+            // this should never happen
+            throw new IllegalStateException("Invalid node type: " + child.getNodeType());
+        }
+
+        // okay we have a copy of the child, now the child becomes the parent
+        // and we are iterating recursively over its children.
+        try {
+            final NodeList children = child.getChildNodes();
+            if (children != null) {
+                final int size = children.getLength();
+                for (int i = 0; i < size; i++) {
+                    final Node newChild = children.item(i);
+                    if (newChild != null) {
+                        importNode(copy, newChild);
+                    }
+                }
+            }
+        } catch (DOMException ignored) {
+        }
+
+        // bingo append it. (this should normally not be done here)
+        parent.appendChild(copy);
+        return copy;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/Enumerations.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/Enumerations.java
new file mode 100644
index 0000000..900d7ae
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/Enumerations.java
@@ -0,0 +1,216 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.junit;
+
+import java.util.Enumeration;
+import java.util.NoSuchElementException;
+
+/**
+ * A couple of methods related to enumerations that might be useful.
+ * This class should probably disappear once the required JDK is set to 1.2
+ * instead of 1.1.
+ *
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ */
+public final class Enumerations {
+        
+        private Enumerations(){
+        }
+
+        /**
+         * creates an enumeration from an array of objects.
+         * @param       array   the array of object to enumerate.
+         * @return the enumeration over the array of objects.
+         */
+        public static Enumeration fromArray(Object[] array){
+                return new ArrayEnumeration(array);
+        }
+
+        /**
+        * creates an enumeration from an array of enumeration. The created enumeration
+        * will sequentially enumerate over all elements of each enumeration and skip
+        * <tt>null</tt> enumeration elements in the array.
+        * @param        enums   the array of enumerations.
+        * @return the enumeration over the array of enumerations.
+         */
+        public static Enumeration fromCompound(Enumeration[] enums){
+                return new CompoundEnumeration(enums);
+        }
+
+}
+
+
+/**
+ * Convenient enumeration over an array of objects.
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ */
+class ArrayEnumeration implements Enumeration {
+        
+        /** object array */
+        private Object[] array;
+        
+        /** current index */
+        private int pos;
+        
+        /**
+         * Initialize a new enumeration that wraps an array.
+         * @param       array   the array of object to enumerate.
+         */
+        public ArrayEnumeration(Object[] array){
+                this.array = array;
+                this.pos = 0;
+        }
+        /**
+         * Tests if this enumeration contains more elements.
+         *
+         * @return  <code>true</code> if and only if this enumeration object
+         *           contains at least one more element to provide;
+         *          <code>false</code> otherwise.
+         */
+        public boolean hasMoreElements() {
+                return (pos < array.length);
+        }
+
+        /**
+         * Returns the next element of this enumeration if this enumeration
+         * object has at least one more element to provide.
+         *
+         * @return     the next element of this enumeration.
+         * @throws  NoSuchElementException  if no more elements exist.
+         */
+        public Object nextElement() throws NoSuchElementException {
+                if (hasMoreElements()) {
+                        Object o = array[pos];
+                        pos++;
+                        return o;
+                }
+                throw new NoSuchElementException();
+        }
+}
+/**
+ * Convenient enumeration over an array of enumeration. For example:
+ * <pre>
+ * Enumeration e1 = v1.elements();
+ * while (e1.hasMoreElements()){
+ *    // do something
+ * }
+ * Enumeration e2 = v2.elements();
+ * while (e2.hasMoreElements()){
+ *    // do the same thing
+ * }
+ * </pre>
+ * can be written as:
+ * <pre>
+ * Enumeration[] enums = { v1.elements(), v2.elements() };
+ * Enumeration e = Enumerations.fromCompound(enums);
+ * while (e.hasMoreElements()){
+ *    // do something
+ * }
+ * </pre>
+ * Note that the enumeration will skip null elements in the array. The following is
+ * thus possible:
+ * <pre>
+ * Enumeration[] enums = { v1.elements(), null, v2.elements() }; // a null enumeration in the array
+ * Enumeration e = Enumerations.fromCompound(enums);
+ * while (e.hasMoreElements()){
+ *    // do something
+ * }
+ * </pre>
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ */
+ class CompoundEnumeration implements Enumeration {
+        
+        /** enumeration array */
+        private Enumeration[] enumArray;
+        
+        /** index in the enums array */
+        private int index = 0;
+
+    public CompoundEnumeration(Enumeration[] enumarray) {
+                this.enumArray = enumarray;
+    }
+
+        /**
+         * Tests if this enumeration contains more elements.
+         *
+         * @return  <code>true</code> if and only if this enumeration object
+         *           contains at least one more element to provide;
+         *          <code>false</code> otherwise.
+         */
+    public boolean hasMoreElements() {
+                while (index < enumArray.length) {
+                        if (enumArray[index] != null && enumArray[index].hasMoreElements()) {
+                                return true;
+                        }
+                        index++;
+                }
+                return false;
+    }
+
+        /**
+         * Returns the next element of this enumeration if this enumeration
+         * object has at least one more element to provide.
+         *
+         * @return     the next element of this enumeration.
+         * @throws  NoSuchElementException  if no more elements exist.
+         */
+    public Object nextElement() throws NoSuchElementException {
+                if ( hasMoreElements() ) {
+                        return enumArray[index].nextElement();
+                }
+                throw new NoSuchElementException();
+    }
+}
+
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/FormatterElement.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/FormatterElement.java
index c1a3466..0120bf9 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/FormatterElement.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/FormatterElement.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitResultFormatter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitResultFormatter.java
index 82e18ea..c4917f7 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitResultFormatter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitResultFormatter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTask.java
index bebab21..0200911 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTask.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTask.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -58,16 +58,19 @@ import org.apache.tools.ant.AntClassLoader;
 import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.Project;
 import org.apache.tools.ant.Task;
-import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.taskdefs.Execute;
+import org.apache.tools.ant.taskdefs.LogStreamHandler;
+import org.apache.tools.ant.taskdefs.ExecuteWatchdog;
+import org.apache.tools.ant.taskdefs.LogOutputStream;
 import org.apache.tools.ant.types.Commandline;
+import org.apache.tools.ant.types.Environment;
 import org.apache.tools.ant.types.CommandlineJava;
 import org.apache.tools.ant.types.Path;
-import org.apache.tools.ant.types.Reference;
+
 
 import java.io.File;
 import java.io.IOException;
-import java.lang.reflect.InvocationTargetException;
-import java.lang.reflect.Method;
+import java.io.OutputStream;
 
 import java.util.Enumeration;
 import java.util.Vector;
@@ -82,8 +85,9 @@ import java.util.Vector;
  * <p> To spawn a new Java VM to prevent interferences between
  * different testcases, you need to enable <code>fork</code>.
  *
- * @author Thomas Haas 
- * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ * @author Thomas Haas
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
  */
 public class JUnitTask extends Task {
 
@@ -96,6 +100,12 @@ public class JUnitTask extends Task {
     private Integer timeout = null;
     private boolean summary = false;
 
+    /**
+     * Tells this task to halt when there is an error in a test.
+     * this property is applied on all BatchTest (batchtest) and JUnitTest (test)
+     * however it can possibly be overridden by their own properties.
+     * @param   value   <tt>true</tt> if it should halt, otherwise <tt>false<tt>
+     */
     public void setHaltonerror(boolean value) {
         Enumeration enum = allTests();
         while (enum.hasMoreElements()) {
@@ -104,6 +114,12 @@ public class JUnitTask extends Task {
         }
     }
 
+    /**
+     * Tells this task to halt when there is a failure in a test.
+     * this property is applied on all BatchTest (batchtest) and JUnitTest (test)
+     * however it can possibly be overridden by their own properties.
+     * @param   value   <tt>true</tt> if it should halt, otherwise <tt>false<tt>
+     */
     public void setHaltonfailure(boolean value) {
         Enumeration enum = allTests();
         while (enum.hasMoreElements()) {
@@ -112,10 +128,49 @@ public class JUnitTask extends Task {
         }
     }
 
+    /**
+     * Tells whether a JVM should be forked for each testcase. It avoids interference
+     * between testcases and possibly avoids hanging the build.
+     * this property is applied on all BatchTest (batchtest) and JUnitTest (test)
+     * however it can possibly be overridden by their own properties.
+     * @param   value   <tt>true</tt> if a JVM should be forked, otherwise <tt>false<tt>
+     * @see #setTimeout(Integer)
+     * @see #haltOntimeout(boolean)
+     */
+    public void setFork(boolean value) {
+        Enumeration enum = allTests();
+        while (enum.hasMoreElements()) {
+            BaseTest test = (BaseTest) enum.nextElement();
+            test.setFork(value);
+        }
+    }
+
+    /**
+     * Tells whether the task should print a short summary of the task.
+     * @param   value   <tt>true</tt> to print a summary, <tt>false</tt> otherwise.
+     * @see SummaryJUnitResultFormatter
+     */
     public void setPrintsummary(boolean value) {
         summary = value;
     }
 
+    /**
+     * Set the timeout value (in milliseconds). If the test is running for more than this
+     * value, the test will be canceled. (works only when in 'fork' mode).
+     * @param   value   the maximum time (in milliseconds) allowed before declaring the test
+     *                  as 'timed-out'
+     * @see #setFork(boolean)
+     * @see #haltOnTimeout(boolean)
+     */
+    public void setTimeout(Integer value) {
+        timeout = value;
+    }
+
+    /**
+     * Set the maximum memory to be used by all forked JVMs.
+     * @param   max     the value as defined by <tt>-mx</tt> or <tt>-Xmx</tt>
+     *                  in the java command line options.
+     */
     public void setMaxmemory(String max) {
         if (Project.getJavaVersion().startsWith("1.1")) {
             createJvmarg().setValue("-mx"+max);
@@ -124,51 +179,70 @@ public class JUnitTask extends Task {
         }
     }
 
-    public void setTimeout(Integer value) {
-        timeout = value;
+    /**
+     * Set a new VM to execute the testcase. Default is <tt>java</tt>. Ignored if no JVM is forked.
+     * @param   value   the new VM to use instead of <tt>java</tt>
+     * @see #setFork(boolean)
+     */
+    public void setJvm(String value) {
+        commandline.setVm(value);
     }
 
-    public void setFork(boolean value) {
-        Enumeration enum = allTests();
-        while (enum.hasMoreElements()) {
-            BaseTest test = (BaseTest) enum.nextElement();
-            test.setFork(value);
-        }
+    /**
+     * Create a new JVM argument. Ignored if no JVM is forked.
+     * @return  create a new JVM argument so that any argument can be passed to the JVM.
+     * @see #setFork(boolean)
+     */
+    public Commandline.Argument createJvmarg() {
+        return commandline.createVmArgument();
     }
 
-    public void setJvm(String value) {
-	commandline.setVm(value);
+    /**
+     * The directory to invoke the VM in. Ignored if no JVM is forked.
+     * @param   dir     the directory to invoke the JVM from.
+     * @see #setFork(boolean)
+     */
+    public void setDir(File dir) {
+        this.dir = dir;
     }
 
-    public Commandline.Argument createJvmarg() {
-	return commandline.createVmArgument();
+    /**
+     * Add a nested sysproperty element. This might be useful to tranfer
+     * Ant properties to the testcases when JVM forking is not enabled.
+     */
+    public void addSysproperty(Environment.Variable sysp) {
+        commandline.addSysproperty(sysp);
     }
-
+    
     public Path createClasspath() {
         return commandline.createClasspath(project).createPath();
     }
 
+    /**
+     * Add a new single testcase.
+     * @param   test    a new single testcase
+     * @see JUnitTest
+     */
     public void addTest(JUnitTest test) {
         tests.addElement(test);
     }
 
+    /**
+     * Create a new set of testcases (also called ..batchtest) and add it to the list.
+     * @return  a new instance of a batch test.
+     * @see BatchTest
+     */
     public BatchTest createBatchTest() {
         BatchTest test = new BatchTest(project);
         batchTests.addElement(test);
         return test;
     }
 
-    public void addFormatter(FormatterElement fe) {
-        formatters.addElement(fe);
-    }
-
     /**
-     * The directory to invoke the VM in.
-     *
-     * <p>Ignored if fork=false.
+     * Add a new formatter to all tests of this task.
      */
-    public void setDir(File dir) {
-        this.dir = dir;
+    public void addFormatter(FormatterElement fe) {
+        formatters.addElement(fe);
     }
 
     /**
@@ -182,194 +256,219 @@ public class JUnitTask extends Task {
      * Runs the testcase.
      */
     public void execute() throws BuildException {
-        boolean errorOccurred = false;
-        boolean failureOccurred = false;
-
-        Vector runTests = (Vector) tests.clone();
-
-        Enumeration list = batchTests.elements();
+        Enumeration list = getIndividualTests();
         while (list.hasMoreElements()) {
-            BatchTest test = (BatchTest)list.nextElement();
-            Enumeration list2 = test.elements();
-            while (list2.hasMoreElements()) {
-                runTests.addElement(list2.nextElement());
+            JUnitTest test = (JUnitTest)list.nextElement();
+            if ( test.shouldRun(project)) {
+                execute(test);
             }
         }
+    }
 
-        list = runTests.elements();
-        while (list.hasMoreElements()) {
-            JUnitTest test = (JUnitTest)list.nextElement();
+    protected void execute(JUnitTest test) throws BuildException {
+        // set the default values if not specified
+        //@todo should be moved to the test class instead.
+        if (test.getTodir() == null) {
+            test.setTodir(project.resolveFile("."));
+        }
 
-            if (!test.shouldRun(project)) {
-                continue;
-            }
+        if (test.getOutfile() == null) {
+            test.setOutfile( "TEST-" + test.getName() );
+        }
 
-            if (test.getOutfile() == null) {
-                test.setOutfile(project.resolveFile("TEST-" + test.getName()));
+        // execute the test and get the return code
+        int exitValue = JUnitTestRunner.ERRORS;
+        boolean wasKilled = false;
+        if (!test.getFork()) {
+            exitValue = executeInVM(test);
+        } else {
+            ExecuteWatchdog watchdog = createWatchdog();
+            exitValue = executeAsForked(test, watchdog);
+            // null watchdog means no timeout, you'd better not check with null
+            if (watchdog != null) {
+                //info will be used in later version do nothing for now
+                //wasKilled = watchdog.killedProcess();
             }
+        }
 
-            int exitValue = JUnitTestRunner.ERRORS;
-            
-            if (!test.getFork()) {
+        // if there is an error/failure and that it should halt, stop everything otherwise
+        // just log a statement
+        boolean errorOccurredHere = exitValue == JUnitTestRunner.ERRORS;
+        boolean failureOccurredHere = exitValue != JUnitTestRunner.SUCCESS;
+        if (errorOccurredHere && test.getHaltonerror()
+            || failureOccurredHere && test.getHaltonfailure()) {
+            throw new BuildException("Test "+test.getName()+" failed",
+                                     location);
+        } else if (errorOccurredHere || failureOccurredHere) {
+            log("TEST "+test.getName()+" FAILED", Project.MSG_ERR);
+        }
+    }
 
-                if (dir != null) {
-                    log("dir attribute ignored if running in the same VM",
-                        Project.MSG_WARN);
-                }
+    /**
+     * Execute a testcase by forking a new JVM. The command will block until
+     * it finishes. To know if the process was destroyed or not, use the
+     * <tt>killedProcess()</tt> method of the watchdog class.
+     * @param  test       the testcase to execute.
+     * @param  watchdog   the watchdog in charge of cancelling the test if it
+     * exceeds a certain amount of time. Can be <tt>null</tt>, in this case
+     * the test could probably hang forever.
+     */
+    private int executeAsForked(JUnitTest test, ExecuteWatchdog watchdog) throws BuildException {
+        CommandlineJava cmd = (CommandlineJava) commandline.clone();
+
+        cmd.setClassname("org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner");
+        cmd.createArgument().setValue(test.getName());
+        cmd.createArgument().setValue("haltOnError=" + test.getHaltonerror());
+        cmd.createArgument().setValue("haltOnFailure=" + test.getHaltonfailure());
+        if (summary) {
+            log("Running " + test.getName(), Project.MSG_INFO);
+            cmd.createArgument().setValue("formatter=org.apache.tools.ant.taskdefs.optional.junit.SummaryJUnitResultFormatter");
+        }
 
-                JUnitTestRunner runner = null;
-
-                Path classpath = commandline.getClasspath();
-                if (classpath != null) {
-                    log("Using CLASSPATH " + classpath, Project.MSG_VERBOSE);
-                    AntClassLoader l = new AntClassLoader(project, classpath, 
-                                                          false);
-                    // make sure the test will be accepted as a TestCase
-                    l.addSystemPackageRoot("junit");
-                    // will cause trouble in JDK 1.1 if omitted
-                    l.addSystemPackageRoot("org.apache.tools.ant");
-                    runner = new JUnitTestRunner(test, test.getHaltonerror(),
-                                                 test.getHaltonfailure(), l);
-                } else {
-                    runner = new JUnitTestRunner(test, test.getHaltonerror(),
-                                                 test.getHaltonfailure());
-                }
+        StringBuffer formatterArg = new StringBuffer(128);
+        final FormatterElement[] feArray = mergeFormatters(test);
+        for (int i = 0; i < feArray.length; i++) {
+            FormatterElement fe = feArray[i];
+            formatterArg.append("formatter=");
+            formatterArg.append(fe.getClassname());
+            File outFile = getOutput(fe,test);
+            if (outFile != null) {
+                formatterArg.append(",");
+                formatterArg.append( outFile );
+            }
+            cmd.createArgument().setValue(formatterArg.toString());
+            formatterArg.setLength(0);
+        }
 
-                if (summary) {
-                    log("Running " + test.getName(), Project.MSG_INFO);
-                    
-                    SummaryJUnitResultFormatter f = 
-                        new SummaryJUnitResultFormatter();
-                    f.setOutput(new LogOutputStream(this, Project.MSG_INFO));
-                    runner.addFormatter(f);
-                }
+        Execute execute = new Execute(new LogStreamHandler(this, Project.MSG_INFO, Project.MSG_WARN), watchdog);
+        execute.setCommandline(cmd.getCommandline());
+        if (dir != null) {
+            execute.setWorkingDirectory(dir);
+            execute.setAntRun(project);
+        }
 
-                for (int i=0; i<formatters.size(); i++) {
-                    FormatterElement fe = (FormatterElement) formatters.elementAt(i);
-                    if (fe.getUseFile()) {
-                        fe.setOutfile(project.resolveFile(test.getOutfile()
-                                                          +fe.getExtension()));
-                    } else {
-                        fe.setOutput(new LogOutputStream(this, Project.MSG_INFO));
-                    }
-                    runner.addFormatter(fe.createFormatter());
-                }
-                FormatterElement[] add = test.getFormatters();
-                for (int i=0; i<add.length; i++) {
-                    if (add[i].getUseFile()) {
-                        add[i].setOutfile(project.resolveFile(test.getOutfile()
-                                                              +add[i].getExtension()));
-                    } else {
-                        add[i].setOutput(new LogOutputStream(this, Project.MSG_INFO));
-                    }
-                    runner.addFormatter(add[i].createFormatter());
-                }
+        log("Executing: "+cmd.toString(), Project.MSG_VERBOSE);
+        try {
+            return execute.execute();
+        } catch (IOException e) {
+            throw new BuildException("Process fork failed.", e, location);
+        }
+    }
 
-                runner.run();
-                exitValue = runner.getRetCode();
-
-            } else {
-                CommandlineJava cmd = (CommandlineJava) commandline.clone();
-                
-                cmd.setClassname("org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner");
-                cmd.createArgument().setValue(test.getName());
-                cmd.createArgument().setValue("haltOnError=" 
-                                              + test.getHaltonerror());
-                cmd.createArgument().setValue("haltOnFailure="
-                                              + test.getHaltonfailure());
-                if (summary) {
-                    log("Running " + test.getName(), Project.MSG_INFO);
-                    
-                    cmd.createArgument().setValue("formatter=org.apache.tools.ant.taskdefs.optional.junit.SummaryJUnitResultFormatter");
-                }
+    // in VM is not very nice since it could probably hang the
+    // whole build. IMHO this method should be avoided and it would be best
+    // to remove it in future versions. TBD. (SBa)
+        
+    /**
+     * Execute inside VM.
+     */
+    private int executeInVM(JUnitTest test) throws BuildException {
+        if (dir != null) {
+            log("dir attribute ignored if running in the same VM", Project.MSG_WARN);
+        }
 
-                StringBuffer formatterArg = new StringBuffer();
-                for (int i=0; i<formatters.size(); i++) {
-                    FormatterElement fe = (FormatterElement) formatters.elementAt(i);
-                    formatterArg.append("formatter=");
-                    formatterArg.append(fe.getClassname());
-                    if (fe.getUseFile()) {
-                        formatterArg.append(",");
-                        formatterArg.append(project.resolveFile(test.getOutfile()
-                                                                +fe.getExtension())
-                                            .getAbsolutePath());
-                    }
-                    cmd.createArgument().setValue(formatterArg.toString());
-                    formatterArg.setLength(0);
-                }
-                
-                FormatterElement[] add = test.getFormatters();
-                for (int i=0; i<add.length; i++) {
-                    formatterArg.append("formatter=");
-                    formatterArg.append(add[i].getClassname());
-                    if (add[i].getUseFile()) {
-                        formatterArg.append(",");
-                        formatterArg.append(project.resolveFile(test.getOutfile()
-                                                                +add[i].getExtension())
-                                            .getAbsolutePath());
-                    }
-                    cmd.createArgument().setValue(formatterArg.toString());
-                    formatterArg.setLength(0);
-                }
+        CommandlineJava.SysProperties sysProperties = commandline.getSystemProperties();
+        if (sysProperties != null) {
+            sysProperties.setSystem();
+        }
+        try {
+            log("Using System properties " + System.getProperties(), Project.MSG_VERBOSE);
+            AntClassLoader cl = null;
+            Path classpath = commandline.getClasspath();
+            if (classpath != null) {
+                log("Using CLASSPATH " + classpath, Project.MSG_VERBOSE);
+
+                cl = new AntClassLoader(project, classpath, false);
+                // make sure the test will be accepted as a TestCase
+                cl.addSystemPackageRoot("junit");
+                // will cause trouble in JDK 1.1 if omitted
+                cl.addSystemPackageRoot("org.apache.tools.ant");
+            }
+            JUnitTestRunner runner = new JUnitTestRunner(test, test.getHaltonerror(), test.getHaltonfailure(), cl);
 
-                Execute execute = new Execute(new LogStreamHandler(this, Project.MSG_INFO, Project.MSG_WARN), createWatchdog());
-                execute.setCommandline(cmd.getCommandline());
-                if (dir != null) {
-                    execute.setWorkingDirectory(dir);
-                    execute.setAntRun(project);
-                }
-                
-                log("Executing: "+cmd.toString(), Project.MSG_VERBOSE);
-                try {
-                    exitValue = execute.execute();
-                } catch (IOException e) {
-                    throw new BuildException("Process fork failed.", e, 
-                                             location);
+            if (summary) {
+                log("Running " + test.getName(), Project.MSG_INFO);
+
+                SummaryJUnitResultFormatter f = new SummaryJUnitResultFormatter();
+                f.setOutput( getDefaultOutput() );
+                runner.addFormatter(f);
+            }
+
+            final FormatterElement[] feArray = mergeFormatters(test);
+            for (int i = 0; i < feArray.length; i++) {
+                FormatterElement fe = feArray[i];
+                File outFile = getOutput(fe,test);
+                if (outFile != null) {
+                    fe.setOutfile(outFile);
+                } else {
+                    fe.setOutput( getDefaultOutput() );
                 }
+                runner.addFormatter(fe.createFormatter());
             }
 
-            boolean errorOccurredHere = exitValue == JUnitTestRunner.ERRORS;
-            boolean failureOccurredHere = exitValue != JUnitTestRunner.SUCCESS;
-            if (errorOccurredHere && test.getHaltonerror()
-                || failureOccurredHere && test.getHaltonfailure()) {
-                throw new BuildException("Test "+test.getName()+" failed", 
-                                         location);
-            } else if (errorOccurredHere || failureOccurredHere) {
-                log("TEST "+test.getName()+" FAILED", Project.MSG_ERR);
+            runner.run();
+            return runner.getRetCode();
+        } finally{
+            if (sysProperties != null) {
+                sysProperties.restoreSystem();
             }
         }
     }
 
+    /**
+     * @return <tt>null</tt> if there is a timeout value, otherwise the
+     * watchdog instance.
+     */
     protected ExecuteWatchdog createWatchdog() throws BuildException {
-        if (timeout == null) return null;
+        if (timeout == null){
+            return null;
+        }
         return new ExecuteWatchdog(timeout.intValue());
     }
 
-    private void rename(String source, String destination) throws BuildException {
-        final File src = new File(source);
-        final File dest = new File(destination);
+    /**
+     * get the default output for a formatter.
+     */
+    protected OutputStream getDefaultOutput(){
+        return new LogOutputStream(this, Project.MSG_INFO);
+    }
 
-        if (dest.exists()) dest.delete();
-        src.renameTo(dest);
+    /**
+     * Merge all individual tests from the batchtest with all individual tests
+     * and return an enumeration over all <tt>JUnitTest</tt>.
+     */
+    protected Enumeration getIndividualTests(){
+        Enumeration[] enums = new Enumeration[ batchTests.size() + 1];
+        for (int i = 0; i < batchTests.size(); i++) {
+            BatchTest batchtest = (BatchTest)batchTests.elementAt(i);
+            enums[i] = batchtest.elements();
+        }
+        enums[enums.length - 1] = tests.elements();
+        return Enumerations.fromCompound(enums);
     }
 
     protected Enumeration allTests() {
+        Enumeration[] enums = { tests.elements(), batchTests.elements() };
+        return Enumerations.fromCompound(enums);
+    }
 
-        return new Enumeration() {
-                private Enumeration testEnum = tests.elements();
-                private Enumeration batchEnum = batchTests.elements();
-                
-                public boolean hasMoreElements() {
-                    return testEnum.hasMoreElements() ||
-                        batchEnum.hasMoreElements();
-                }
-                
-                public Object nextElement() {
-                    if (testEnum.hasMoreElements()) {
-                        return testEnum.nextElement();
-                    }
-                    return batchEnum.nextElement();
-                }
-            };
+    private FormatterElement[] mergeFormatters(JUnitTest test){
+        Vector feVector = (Vector)formatters.clone();
+        test.addFormattersTo(feVector);
+        FormatterElement[] feArray = new FormatterElement[feVector.size()];
+        feVector.copyInto(feArray);
+        return feArray;
     }
+
+    /** return the file or null if does not use a file */
+    protected File getOutput(FormatterElement fe, JUnitTest test){
+        if (fe.getUseFile()) {
+            String filename = test.getOutfile() + fe.getExtension();
+            File destFile = new File( test.getTodir(), filename );
+            String absFilename = destFile.getAbsolutePath();
+            return project.resolveFile(absFilename);
+        }
+        return null;
+    }
+
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTest.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTest.java
index 6e7b79c..e568f8e 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTest.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -63,12 +63,20 @@ import java.util.Vector;
 /**
  *
  * @author Thomas Haas
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>,
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
  */
 public class JUnitTest extends BaseTest {
+    
+    /** the name of the test case */
     private String name = null;
-    private File outfile = null;
+    
+    /** the name of the result file */
+    private String outfile = null;
 
+    // @todo this is duplicating TestResult information. Only the time is not
+    // part of the result. So we'd better derive a new class from TestResult
+    // and deal with it. (SB)
     private long runs, failures, errors;
     private long runTime;
 
@@ -89,7 +97,7 @@ public class JUnitTest extends BaseTest {
         name = value;
     }
 
-    public void setOutfile(File value) {
+    public void setOutfile(String value) {
         outfile = value;
     }
 
@@ -97,11 +105,11 @@ public class JUnitTest extends BaseTest {
         return name;
     }
 
+    /**
+     * @return the name of the output file.
+     */
     public String getOutfile() {
-        if (outfile != null) {
-            return outfile.getAbsolutePath();
-        }
-        return null;
+        return outfile;
     }
 
     public void setCounts(long runs, long failures, long errors) {
@@ -134,4 +142,14 @@ public class JUnitTest extends BaseTest {
         formatters.copyInto(fes);
         return fes;
     }
+
+    /**
+     * Convenient method to add formatters to a vector
+     */
+    void addFormattersTo(Vector v){
+        final int count = formatters.size();
+        for (int i = 0; i < count; i++){
+            v.addElement( formatters.elementAt(i) );
+        }
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTestRunner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTestRunner.java
index 1f38062..2c960ae 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTestRunner.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/JUnitTestRunner.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -161,15 +161,22 @@ public class JUnitTestRunner implements TestListener {
                 testClass = loader.loadClass(test.getName());
             }
             
+            Method suiteMethod = null;
             try {
-                Method suiteMethod= testClass.getMethod("suite", new Class[0]);
-                suite = (Test)suiteMethod.invoke(null, new Class[0]);
-            } catch(NoSuchMethodException e) {
-            } catch(InvocationTargetException e) {
-            } catch(IllegalAccessException e) {
+                // check if there is a suite method
+                suiteMethod= testClass.getMethod("suite", new Class[0]);
+            } catch(Exception e) {
+                // no appropriate suite method found. We don't report any
+                // error here since it might be perfectly normal. We don't
+                // know exactly what is the cause, but we're doing exactly
+                // the same as JUnit TestRunner do. We swallow the exceptions.
             }
-            
-            if (suite == null) {
+            if (suiteMethod != null){
+                // if there is a suite method available, then try
+                // to extract the suite from it. If there is an error
+                // here it will be caught below and reported.
+                suite = (Test)suiteMethod.invoke(null, new Class[0]);
+            } else {
                 // try to extract a test suite automatically
                 // this will generate warnings if the class is no suitable Test
                 suite= new TestSuite(testClass);
@@ -237,7 +244,7 @@ public class JUnitTestRunner implements TestListener {
     public void endTest(Test test) {}
 
     /**
-     * Interface TestListener.
+     * Interface TestListener for JUnit &lt;= 3.4.
      *
      * <p>A Test failed.
      */
@@ -247,6 +254,15 @@ public class JUnitTestRunner implements TestListener {
         }
     }
 
+    /**
+     * Interface TestListener for JUnit &gt; 3.4.
+     *
+     * <p>A Test failed.
+     */
+    public void addFailure(Test test, AssertionFailedError t) {
+        addFailure(test, (Throwable) t);
+    }
+
     /**
      * Interface TestListener.
      *
@@ -335,14 +351,18 @@ public class JUnitTestRunner implements TestListener {
         }
     }
 
-    private static void createAndStoreFormatter(String line) 
+    /**
+     * Line format is: formatter=<classname>(,<pathname>)?
+     */
+    private static void createAndStoreFormatter(String line)
         throws BuildException {
-
         FormatterElement fe = new FormatterElement();
-        StringTokenizer tok = new StringTokenizer(line, ",");
-        fe.setClassname(tok.nextToken());
-        if (tok.hasMoreTokens()) {
-            fe.setOutfile(new java.io.File(tok.nextToken()));
+        int pos = line.indexOf(',');
+        if (pos == -1) {
+            fe.setClassname(line);
+        } else {
+            fe.setClassname(line.substring(0, pos));
+            fe.setOutfile( new File(line.substring(pos + 1)) );
         }
         fromCmdLine.addElement(fe.createFormatter());
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/PlainJUnitResultFormatter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/PlainJUnitResultFormatter.java
index 6d64430..722369c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/PlainJUnitResultFormatter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/PlainJUnitResultFormatter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -59,13 +59,14 @@ import org.apache.tools.ant.BuildException;
 import java.io.*;
 import java.text.NumberFormat;
 
+import junit.framework.AssertionFailedError;
 import junit.framework.Test;
 import junit.framework.TestCase;
 
 /**
  * Prints plain text output of the test to a specified Writer.
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
 public class PlainJUnitResultFormatter implements JUnitResultFormatter {
@@ -172,7 +173,7 @@ public class PlainJUnitResultFormatter implements JUnitResultFormatter {
     }
 
     /**
-     * Interface TestListener.
+     * Interface TestListener for JUnit &lt;= 3.4.
      *
      * <p>A Test failed.
      */
@@ -180,6 +181,15 @@ public class PlainJUnitResultFormatter implements JUnitResultFormatter {
         formatError("\tFAILED", test, t);
     }
 
+    /**
+     * Interface TestListener for JUnit &gt; 3.4.
+     *
+     * <p>A Test failed.
+     */
+    public void addFailure(Test test, AssertionFailedError t) {
+        addFailure(test, (Throwable) t);
+    }
+
     /**
      * Interface TestListener.
      *
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/SummaryJUnitResultFormatter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/SummaryJUnitResultFormatter.java
index 1f54b3f..e01f281 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/SummaryJUnitResultFormatter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/SummaryJUnitResultFormatter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -57,6 +57,7 @@ package org.apache.tools.ant.taskdefs.optional.junit;
 import java.text.NumberFormat;
 import java.io.IOException;
 import java.io.OutputStream;
+import junit.framework.AssertionFailedError;
 import junit.framework.Test;
 
 import org.apache.tools.ant.BuildException;
@@ -64,7 +65,7 @@ import org.apache.tools.ant.BuildException;
 /**
  * Prints short summary output of the test to Ant's logging system.
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
  
 public class SummaryJUnitResultFormatter implements JUnitResultFormatter {
@@ -98,6 +99,14 @@ public class SummaryJUnitResultFormatter implements JUnitResultFormatter {
      * Empty
      */
     public void addFailure(Test test, Throwable t) {}
+    /**
+     * Interface TestListener for JUnit &gt; 3.4.
+     *
+     * <p>A Test failed.
+     */
+    public void addFailure(Test test, AssertionFailedError t) {
+        addFailure(test, (Throwable) t);
+    }
     /**
      * Empty
      */
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLConstants.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLConstants.java
new file mode 100644
index 0000000..2c626cc
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLConstants.java
@@ -0,0 +1,106 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.junit;
+
+/**
+ * Interface that groups all constants used throughout the <tt>XML<tt>
+ * documents that are generated by the <tt>XMLJUnitResultFormatter</tt>
+ * As of now the DTD is:
+ *
+ * <----------------- @todo describe DTDs ---------------------->
+ *
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ * @see XMLJUnitResultFormatter
+ * @see XMLResultAggregator
+ */
+public interface XMLConstants {
+    /** the testsuites element for the aggregate document */
+    public final static String TESTSUITES = "testsuites";
+
+    /** the testsuite element */
+    public final static String TESTSUITE = "testsuite";
+
+    /** the testcase element */
+    public final static String TESTCASE = "testcase";
+
+    /** the error element */
+    public final static String ERROR = "error";
+
+    /** the failure element */
+    public final static String FAILURE = "failure";
+
+    /** package attribute for the aggregate document */
+    public final static String ATTR_PACKAGE = "package";
+
+    /** name attribute for testcase and testsuite elements */
+    public final static String ATTR_NAME = "name";
+
+    /** time attribute for testcase and testsuite elements */
+    public final static String ATTR_TIME = "time";
+
+    /** errors attribute for testsuite elements */
+    public final static String ATTR_ERRORS = "errors";
+
+    /** failures attribute for testsuite elements */
+    public final static String ATTR_FAILURES = "failures";
+
+    /** tests attribute for testsuite elements */
+    public final static String ATTR_TESTS = "tests";
+
+    /** type attribute for failure and error elements */
+    public final static String ATTR_TYPE = "type";
+
+    /** message attribute for failure elements */
+    public final static String ATTR_MESSAGE = "message";
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLJUnitResultFormatter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLJUnitResultFormatter.java
index 5902685..dbdfeff 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLJUnitResultFormatter.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLJUnitResultFormatter.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -62,17 +62,19 @@ import java.util.*;
 import javax.xml.parsers.*;
 import org.w3c.dom.*;
 import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.util.DOMElementWriter;
 
+import junit.framework.AssertionFailedError;
 import junit.framework.Test;
 import junit.framework.TestCase;
 
 /**
  * Prints XML output of the test to a specified Writer.
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 
-public class XMLJUnitResultFormatter implements JUnitResultFormatter {
+public class XMLJUnitResultFormatter implements JUnitResultFormatter, XMLConstants {
 
     private static DocumentBuilder getDocumentBuilder() {
         try {
@@ -86,7 +88,8 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
     /**
      * Formatter for timings.
      */
-    private NumberFormat nf = NumberFormat.getInstance();
+    private NumberFormat nf = NumberFormat.getInstance(Locale.US);
+
     /**
      * The XML document.
      */
@@ -119,25 +122,25 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
      */
     public void startTestSuite(JUnitTest suite) {
         doc = getDocumentBuilder().newDocument();
-        rootElement = doc.createElement("testsuite");
-        rootElement.setAttribute("name", xmlEscape(suite.getName()));
+        rootElement = doc.createElement(TESTSUITE);
+        rootElement.setAttribute(ATTR_NAME, suite.getName());
     }
 
     /**
      * The whole testsuite ended.
      */
     public void endTestSuite(JUnitTest suite) throws BuildException {
-        rootElement.setAttribute("tests", ""+suite.runCount());
-        rootElement.setAttribute("failures", ""+suite.failureCount());
-        rootElement.setAttribute("errors", ""+suite.errorCount());
-        rootElement.setAttribute("time", 
-                                 nf.format(suite.getRunTime()/1000.0)+" sec");
+        rootElement.setAttribute(ATTR_TESTS, ""+suite.runCount());
+        rootElement.setAttribute(ATTR_FAILURES, ""+suite.failureCount());
+        rootElement.setAttribute(ATTR_ERRORS, ""+suite.errorCount());
+        rootElement.setAttribute(ATTR_TIME,
+                                 nf.format(suite.getRunTime()/1000.0));
         if (out != null) {
             Writer wri = null;
             try {
                 wri = new OutputStreamWriter(out);
                 wri.write("<?xml version=\"1.0\"?>\n");
-                write(rootElement, wri, 0);
+                (new DOMElementWriter()).write(rootElement, wri, 0, "  ");
                 wri.flush();
             } catch(IOException exc) {
                 throw new BuildException("Unable to write log file", exc);
@@ -160,8 +163,8 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
      */
     public void startTest(Test t) {
         lastTestStart = System.currentTimeMillis();
-        currentTest = doc.createElement("testcase");
-        currentTest.setAttribute("name", xmlEscape(((TestCase) t).name()));
+        currentTest = doc.createElement(TESTCASE);
+        currentTest.setAttribute(ATTR_NAME, ((TestCase) t).name());
         rootElement.appendChild(currentTest);
     }
 
@@ -171,18 +174,27 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
      * <p>A Test is finished.
      */
     public void endTest(Test test) {
-        currentTest.setAttribute("time", 
+        currentTest.setAttribute(ATTR_TIME,
                                  nf.format((System.currentTimeMillis()-lastTestStart)
                                            / 1000.0));
     }
 
     /**
-     * Interface TestListener.
+     * Interface TestListener for JUnit &lt;= 3.4.
      *
      * <p>A Test failed.
      */
     public void addFailure(Test test, Throwable t) {
-        formatError("failure", test, t);
+        formatError(FAILURE, test, t);
+    }
+
+    /**
+     * Interface TestListener for JUnit &gt; 3.4.
+     *
+     * <p>A Test failed.
+     */
+    public void addFailure(Test test, AssertionFailedError t) {
+        addFailure(test, (Throwable) t);
     }
 
     /**
@@ -191,7 +203,7 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
      * <p>An error occured while running the test.
      */
     public void addError(Test test, Throwable t) {
-        formatError("error", test, t);
+        formatError(ERROR, test, t);
     }
 
     private void formatError(String type, Test test, Throwable t) {
@@ -208,9 +220,9 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
 
         String message = t.getMessage();
         if (message != null && message.length() > 0) {
-            nested.setAttribute("message", xmlEscape(t.getMessage()));
+            nested.setAttribute(ATTR_MESSAGE, t.getMessage());
         }
-        nested.setAttribute("type", xmlEscape(t.getClass().getName()));
+        nested.setAttribute(ATTR_TYPE, t.getClass().getName());
 
         StringWriter swr = new StringWriter();
         t.printStackTrace(new PrintWriter(swr, true));
@@ -218,97 +230,4 @@ public class XMLJUnitResultFormatter implements JUnitResultFormatter {
         nested.appendChild(trace);
     }
 
-
-    /**
-     * Translates <, & , " and > to corresponding entities.
-     */
-    private String xmlEscape(String orig) {
-        if (orig == null) return "";
-        StringBuffer temp = new StringBuffer();
-        StringCharacterIterator sci = new StringCharacterIterator(orig);
-        for (char c = sci.first(); c != CharacterIterator.DONE;
-             c = sci.next()) {
-
-            switch (c) {
-            case '<':
-                temp.append("&lt;");
-                break;
-            case '>':
-                temp.append("&gt;");
-                break;
-            case '\"':
-                temp.append("&quot;");
-                break;
-            case '&':
-                temp.append("&amp;");
-                break;
-            default:
-                temp.append(c);
-                break;
-            }
-        }
-        return temp.toString();
-    }
-
-    /**
-     *  Writes a DOM element to a stream.
-     */
-    private static void write(Element element, Writer out, int indent) throws IOException {
-        // Write indent characters
-        for (int i = 0; i < indent; i++) {
-            out.write("\t");
-        }
-
-        // Write element
-        out.write("<");
-        out.write(element.getTagName());
-
-        // Write attributes
-        NamedNodeMap attrs = element.getAttributes();
-        for (int i = 0; i < attrs.getLength(); i++) {
-            Attr attr = (Attr) attrs.item(i);
-            out.write(" ");
-            out.write(attr.getName());
-            out.write("=\"");
-            out.write(attr.getValue());
-            out.write("\"");
-        }
-        out.write(">");
-
-        // Write child attributes and text
-        boolean hasChildren = false;
-        NodeList children = element.getChildNodes();
-        for (int i = 0; i < children.getLength(); i++) {
-            Node child = children.item(i);
-
-            if (child.getNodeType() == Node.ELEMENT_NODE) {
-                if (!hasChildren) {
-                    out.write("\n");
-                    hasChildren = true;
-                }
-                write((Element)child, out, indent + 1);
-            }
-
-            if (child.getNodeType() == Node.TEXT_NODE) {
-                out.write("<![CDATA[");
-                out.write(((Text)child).getData());
-                out.write("]]>");
-            }
-        }
-
-        // If we had child elements, we need to indent before we close
-        // the element, otherwise we're on the same line and don't need
-        // to indent
-        if (hasChildren) {
-            for (int i = 0; i < indent; i++) {
-                out.write("\t");
-            }
-        }
-
-        // Write element close
-        out.write("</");
-        out.write(element.getTagName());
-        out.write(">\n");
-    }
-
 } // XMLJUnitResultFormatter
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLResultAggregator.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLResultAggregator.java
new file mode 100644
index 0000000..c8a4136
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLResultAggregator.java
@@ -0,0 +1,317 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.taskdefs.optional.junit;
+
+import java.io.File;
+import java.io.IOException;
+import java.io.OutputStream;
+import java.io.PrintWriter;
+import java.io.StringWriter;
+import java.io.FileOutputStream;
+import java.util.Enumeration;
+import java.util.Vector;
+
+import org.w3c.dom.Element;
+import org.w3c.dom.Document;
+import org.w3c.dom.Node;
+import org.w3c.dom.*;
+import org.xml.sax.SAXException;
+import javax.xml.parsers.DocumentBuilder;
+import javax.xml.parsers.DocumentBuilderFactory;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.DirectoryScanner;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.types.FileSet;
+import org.apache.tools.ant.util.DOMElementWriter;
+
+
+/**
+ * This is an helper class that will aggregate all testsuites under a specific
+ * directory and create a new single document. It is not particulary clean but
+ * should be helpful while I am thinking about another technique.
+ *
+ * The main problem is due to the fact that a JVM can be forked for a testcase
+ * thus making it impossible to aggregate all testcases since the listener is
+ * (obviously) in the forked JVM. A solution could be to write a
+ * TestListener that will receive events from the TestRunner via sockets. This
+ * is IMHO the simplest way to do it to avoid this file hacking thing.
+ *
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ */
+public class XMLResultAggregator extends Task implements XMLConstants {
+    
+    /** the list of all filesets, that should contains the xml to aggregate */
+    protected Vector filesets = new Vector();
+    
+    /** the name of the result file */
+    protected String toFile;
+    
+    /** the directory to write the file to */
+    protected File toDir;
+    
+    protected Vector transformers = new Vector();
+    
+    /** the default directory: <tt>.</tt>. It is resolved from the project directory */
+    public final static String DEFAULT_DIR = ".";
+    
+    /** the default file name: <tt>TESTS-TestSuites.xml</tt> */
+    public final static String DEFAULT_FILENAME = "TESTS-TestSuites.xml";
+    
+    
+    public AggregateTransformer createReport(){
+        AggregateTransformer transformer = new AggregateTransformer(this);
+        transformers.add(transformer);
+        return transformer;
+    }
+    
+    /**
+     * Set the name of the file aggregating the results. It must be relative
+     * from the <tt>todir</tt> attribute. If not set it will use {@link DEFAULT_FILENAME}
+     * @param  value   the name of the file.
+     * @see #setTodir(File)
+     */
+    public void setTofile(String value){
+        toFile = value;
+    }
+    
+    /**
+     * Set the destination directory where the results should be written. If not
+     * set if will use {@link DEFAULT_DIR}. When given a relative directory
+     * it will resolve it from the project directory.
+     * @param value    the directory where to write the results, absolute or
+     * relative.
+     */
+    public void setTodir(File value){
+        toDir = value;
+    }
+    
+    /**
+     * Add a new fileset containing the xml results to aggregate
+     * @param    fs      the new fileset of xml results.
+     */
+    public void addFileSet(FileSet fs) {
+        filesets.addElement(fs);
+    }
+    
+    /**
+     * Aggregate all testsuites into a single document and write it to the
+     * specified directory and file.
+     * @throws	BuildException	thrown if there is a serious error while writing
+     *			the document.
+     */
+    public void execute() throws BuildException {
+        Element rootElement = createDocument();
+        File destFile = getDestinationFile();
+        // write the document
+        try {
+            writeDOMTree(rootElement.getOwnerDocument(),  destFile );
+        } catch (IOException e){
+            throw new BuildException("Unable to write test aggregate to '" + destFile + "'", e);
+        }
+        // apply transformation
+        Enumeration enum = transformers.elements();
+        while (enum.hasMoreElements()) {
+            AggregateTransformer transformer =
+                (AggregateTransformer) enum.nextElement();
+            transformer.setXmlDocument(rootElement.getOwnerDocument());
+            transformer.transform();
+        }
+    }
+    
+    /**
+     * get the full destination file where to write the result. It is made of
+     * the <tt>todir</tt> and <tt>tofile</tt> attributes.
+     * @return the destination file where should be written the result file.
+     */
+    protected File getDestinationFile(){
+        if (toFile == null){
+            toFile = DEFAULT_FILENAME;
+        }
+        if (toDir == null){
+            toDir = project.resolveFile(DEFAULT_DIR);
+        }
+        return new File(toDir, toFile);
+    }
+    
+    /**
+     * @return all files in the fileset that end with a '.xml'.
+     */
+    protected File[] getFiles() {
+        Vector v = new Vector();
+        final int size = filesets.size();
+        for (int i = 0; i < size; i++) {
+            FileSet fs = (FileSet) filesets.elementAt(i);
+            DirectoryScanner ds = fs.getDirectoryScanner(project);
+            ds.scan();
+            String[] f = ds.getIncludedFiles();
+            for (int j = 0; j < f.length; j++) {
+                String pathname = f[j];
+                if ( pathname.endsWith(".xml") ) {
+                    File file = new File(ds.getBasedir(), pathname);
+                    file = project.resolveFile(file.getPath());
+                    v.addElement( file );
+                }
+            }
+        }
+        
+        File[] files = new File[v.size()];
+        v.copyInto(files);
+        return files;
+    }
+    
+    //----- from now, the methods are all related to DOM tree manipulation
+    
+    /**
+     * Write the DOM tree to a file.
+     * @param doc the XML document to dump to disk.
+     * @param file the filename to write the document to. Should obviouslly be a .xml file.
+     * @throws IOException thrown if there is an error while writing the content.
+     */
+    protected void writeDOMTree(Document doc, File file) throws IOException {
+        OutputStream out = new FileOutputStream( file );
+        PrintWriter wri = new PrintWriter(out);
+        wri.write("<?xml version=\"1.0\"?>\n");
+        (new DOMElementWriter()).write(doc.getDocumentElement(), wri, 0, "  ");
+        wri.flush();
+        wri.close();
+        // writers do not throw exceptions, so check for them.
+        if (wri.checkError()){
+            throw new IOException("Error while writing DOM content");
+        }
+    }
+    
+    /**
+     * Create a DOM tree with firstchild as 'testsuites' and aggregates all
+     * testsuite results that exists in the base directory.
+     * @return	the root element of DOM tree that aggregates all testsuites.
+     */
+    protected Element createDocument() {
+        // create the dom tree
+        DocumentBuilder builder = getDocumentBuilder();
+        Document doc = builder.newDocument();
+        Element rootElement = doc.createElement(TESTSUITES);
+        doc.appendChild(rootElement);
+        
+        // get all files and add them to the document
+        File[] files = getFiles();
+        for (int i = 0; i < files.length; i++) {
+            try {
+                log("Parsing file: '" + files[i] + "'", Project.MSG_VERBOSE);
+                //XXX there seems to be a bug in xerces 1.3.0 that doesn't like file object
+                // will investigate later. It does not use the given directory but
+                // the vm dir instead ? Works fine with crimson.
+                Document testsuiteDoc = builder.parse( "file:///" + files[i].getAbsolutePath() );
+                Element elem = testsuiteDoc.getDocumentElement();
+                // make sure that this is REALLY a testsuite.
+                if ( TESTSUITE.equals(elem.getNodeName()) ) {
+                    addTestSuite(rootElement, elem);
+                } else {
+                    // issue a warning.
+                    log("the file " + files[i] + " is not a valid testsuite XML document", Project.MSG_WARN);
+                }
+            } catch (SAXException e){
+                // a testcase might have failed and write a zero-length document,
+                // It has already failed, but hey.... mm. just put a warning
+                log("The file " + files[i] + " is not a valid XML document. It is possibly corrupted.", Project.MSG_WARN);
+                StringWriter sw = new StringWriter();
+                e.printStackTrace(new PrintWriter(sw));
+                log(sw.toString(), Project.MSG_DEBUG);
+            } catch (IOException e){
+                log("Error while accessing file " + files[i] + ": " + e.getMessage(), Project.MSG_ERR);
+            }
+        }
+        return rootElement;
+    }
+    
+    /**
+     * Add a new testsuite node to the document, the main difference is that it
+     * split the previous fully qualified name into a package and a name.
+     * For example: <tt>org.apache.Whatever</tt> will be splitted in
+     * <tt>org.apache</tt> and <tt>Whatever</tt>.
+     * @param root the root element to which the <tt>testsuite</tt> node should
+     *        be appended.
+     * @param testsuite the element to append to the given root. It will slightly
+     *        modify the original node to change the name attribute and add
+     *        a package one.
+     */
+    protected void addTestSuite(Element root, Element testsuite){
+        String fullclassname = testsuite.getAttribute(ATTR_NAME);
+        int pos = fullclassname.lastIndexOf('.');
+        
+        // a missing . might imply no package at all. Don't get fooled.
+        String pkgName = (pos == -1) ? "" : fullclassname.substring(0, pos);
+        String classname = (pos == -1) ? fullclassname : fullclassname.substring(pos + 1);
+        Element copy = (Element)DOMUtil.importNode(root, testsuite);
+        
+        // modify the name attribute and set the package
+        copy.setAttribute(ATTR_NAME, classname);
+        copy.setAttribute(ATTR_PACKAGE, pkgName);
+    }
+    
+    /**
+     * Create a new document builder. Will issue an <tt>ExceptionInitializerError</tt>
+     * if something is going wrong. It is fatal anyway.
+     * @return a new document builder to create a DOM
+     * @todo factorize this somewhere else. It is duplicated code.
+     */
+    private static DocumentBuilder getDocumentBuilder() {
+        try {
+            return DocumentBuilderFactory.newInstance().newDocumentBuilder();
+        } catch(Exception exc) {
+            throw new ExceptionInInitializerError(exc);
+        }
+    }
+    
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/index.html b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/index.html
new file mode 100644
index 0000000..c069aec
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/index.html
@@ -0,0 +1,21 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN""http://www.w3.org/TR/REC-html40/loose.dtd>
+
+<HTML>
+	<HEAD>
+	<TITLE>
+		Unit Tests Results.
+	</TITLE>
+	</HEAD>
+	<FRAMESET cols="20%,80%">
+		<FRAMESET rows="30%,70%">
+			<FRAME src="all-packages.html" name="packageListFrame">
+			<FRAME src="all-classes.html" name="classListFrame">
+		</FRAMESET>
+		<FRAME src="overview-packages.html" name="classFrame">
+	</FRAMESET>
+	<NOFRAMES>
+	<H2>Frame Alert</H2>
+	<P>
+		This document is designed to be viewed using the frames feature. If you see this message, you are using a non-frame-capable web client.
+	</P>
+</HTML>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/stylesheet.css b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/stylesheet.css
new file mode 100644
index 0000000..a1f5549
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/html/stylesheet.css
@@ -0,0 +1,38 @@
+BODY {
+	font:normal 68% verdana,arial,helvetica;
+	color:#000000;
+}
+TD {
+	FONT-SIZE: 68%
+}
+P {
+	line-height:1.5em;
+	margin-top:0.5em; margin-bottom:1.0em;
+}
+H1 {
+	MARGIN: 0px 0px 5px; FONT: 165% verdana,arial,helvetica
+}
+H2 {
+	MARGIN-TOP: 1em; MARGIN-BOTTOM: 0.5em; FONT: bold 125% verdana,arial,helvetica
+}
+H3 {
+	MARGIN-BOTTOM: 0.5em; FONT: bold 115% verdana,arial,helvetica
+}
+H4 {
+	MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+}
+H5 {
+	MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+}
+H6 {
+	MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+}
+.Error {
+	font-weight:bold; background:#EEEEE0; color:purple;
+}
+.Failure {
+	font-weight:bold; background:#EEEEE0; color:red;
+}
+.Pass {
+	background:#EEEEE0;
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-classes.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-classes.xsl
new file mode 100644
index 0000000..d4c80a2
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-classes.xsl
@@ -0,0 +1,45 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<xsl:include href="toolkit.xsl"/>
+
+<!--
+    Display the whole list of testsuite
+-->
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" HREF="./stylesheet.css" TITLE="Style"/>
+		</HEAD>
+		<BODY onload="open('overview-packages.html','classFrame')">
+			<H2>Classes</H2>
+			<p>
+			<TABLE WIDTH="100%">
+					<xsl:apply-templates select="testsuite">
+						<xsl:sort select="@name"/>
+					</xsl:apply-templates>
+			</TABLE>
+			</p>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+<!--
+    Display each testsuite name with an hyperlink to the package frame.
+    The hyperlink is made of the {packagename} + {classname} + "-details.html"
+-->
+<xsl:template match="testsuite">
+	<tr>
+		<td nowrap="nowrap">
+			<a target="classFrame">
+				<xsl:attribute name="href">
+					<xsl:if test="not(@package='')">
+						<xsl:value-of select="translate(@package,'.','/')"/><xsl:text>/</xsl:text>
+					</xsl:if><xsl:value-of select="@name"/><xsl:text>-details.html</xsl:text>
+				</xsl:attribute>
+				<xsl:value-of select="@name"/></a>
+		</td>
+	</tr>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-packages.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-packages.xsl
new file mode 100644
index 0000000..b390357
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/all-packages.xsl
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<xsl:include href="toolkit.xsl"/>
+
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" HREF="./stylesheet.css" TITLE="Style"/>
+		</HEAD>
+		<BODY>
+	
+			<H2><a href="all-classes.html" target="classListFrame">Home</a></H2>
+			<!-- create a summary on this testcase-->
+			<!--xsl:call-template name="SummaryTableHeadRootPackage"/-->
+			<H2>Packages</H2>
+
+			<!-- Get the list of the subpackage -->
+			<p>
+				<table width="100%">
+					<!-- For each packages node apply the style describe in the below template-->
+					<xsl:apply-templates select="testsuite[not(./@package = preceding-sibling::testsuite/@package)]">
+						<xsl:sort select="@package"/>
+					</xsl:apply-templates>
+				</table>
+			</p>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+<xsl:template match="testsuite">
+	<tr>
+		<td nowrap="nowrap">
+			<a href="{translate(@package,'.','/')}/package-summary.html" target="classFrame"><xsl:value-of select="@package"/></a>
+		</td>
+	</tr>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/class-details.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/class-details.xsl
new file mode 100644
index 0000000..b4ccdd4
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/class-details.xsl
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+
+<!-- This style sheet should contain just a named templates that used in the other specific templates -->
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<!-- import the commun templates -->
+<xsl:include href="toolkit.xsl"/>
+
+<xsl:template match="testsuite">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" TITLE="Style">
+				<xsl:attribute name="href"><xsl:call-template name="path"><xsl:with-param name="path" select="@package"/></xsl:call-template>stylesheet.css</xsl:attribute>
+			</LINK>
+		</HEAD>
+		<BODY>
+			<xsl:call-template name="header">
+				<xsl:with-param name="useFrame">yes</xsl:with-param>
+				<xsl:with-param name="path" select="@package"/>
+			</xsl:call-template>
+	
+			<H2>Class <xsl:if test="not(@package = '')"><xsl:value-of select="@package"/>.</xsl:if><xsl:value-of select="@name"/></H2>
+			<p>
+			<h3>TestCase <xsl:value-of select="@name"/></h3>
+			
+			<table border="0" cellpadding="5" cellspacing="2" width="95%">
+				<!-- Header -->
+				<xsl:call-template name="classesSummaryHeader"/>
+				<!-- match the testcases of this package -->
+				<xsl:apply-templates select="testcase"/>
+			</table>
+			</p>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/classes-list.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/classes-list.xsl
new file mode 100644
index 0000000..058b756
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/classes-list.xsl
@@ -0,0 +1,44 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<!-- import the commun templates -->
+<xsl:include href="toolkit.xsl"/>
+
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" TITLE="Style">
+				<xsl:attribute name="href"><xsl:call-template name="path"><xsl:with-param name="path" select="testsuite[position() = 1]/@package"/></xsl:call-template>stylesheet.css</xsl:attribute>
+			</LINK>
+		</HEAD>
+		<BODY>
+			
+			<table width="100%">
+				<tr>
+					<td nowrap="nowrap">
+						<H2><a href="package-summary.html" target="classFrame"><xsl:value-of select="testsuite/@package"/></a></H2>
+					</td>
+				</tr>
+			</table>
+	
+			<H2>Classes</H2>
+			<p>
+			<TABLE WIDTH="100%">
+					<xsl:apply-templates select="testsuite">
+						<xsl:sort select="@name"/>
+					</xsl:apply-templates>
+			</TABLE>
+			</p>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+<xsl:template match="testsuite">
+	<tr>
+		<td nowrap="nowrap">
+			<a href="{@name}-details.html" target="classFrame"><xsl:value-of select="@name"/></a>
+		</td>
+	</tr>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-packages.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-packages.xsl
new file mode 100644
index 0000000..98764ef
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-packages.xsl
@@ -0,0 +1,109 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<xsl:include href="toolkit.xsl"/>
+
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style"/>
+		</HEAD>
+		<BODY>
+			<xsl:call-template name="header">
+				<xsl:with-param name="useFrame">yes</xsl:with-param>	
+			</xsl:call-template>
+
+			<xsl:call-template name="summary"/>
+
+
+		<xsl:if test="count(testsuite[not(./@package = preceding-sibling::testsuite/@package)])&gt;0">	
+		<h2>Packages</h2>
+		<table border="0" cellpadding="5" cellspacing="2" width="95%">
+			<!--Header-->
+			<xsl:call-template name="packageSummaryHeader"/>
+			
+			<!-- write a summary for the package -->
+			<xsl:apply-templates select="testsuite[not(./@package = preceding-sibling::testsuite/@package) and not(./@package = '') ]" mode="package">
+				<xsl:sort select="@package"/>
+			</xsl:apply-templates>
+		</table>
+		<br/>
+		</xsl:if>
+
+
+		<xsl:if test="count(testsuite[./@package = ''])&gt;0">	
+		<h2>Classes</h2>
+		<table border="0" cellpadding="5" cellspacing="2" width="95%">
+			<!--Header-->
+			<xsl:call-template name="packageSummaryHeader"/>
+				
+			<!-- write a summary for the package -->
+			<xsl:apply-templates select="testsuite[./@package = '']" mode="class">
+				<xsl:sort select="@name"/>
+			</xsl:apply-templates>
+		</table>
+		</xsl:if>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+<xsl:template match="testsuite" mode="package">
+	<xsl:variable name="isError" select="(sum(//testsuite[@package = current()/@package]/@errors) + sum(//testsuite[@package = current()/@package]/@failures))&gt;0"/>
+	<!-- write a summary for the package -->
+	<tr valign="top">
+		<xsl:attribute name="class">
+			<xsl:choose>
+				<xsl:when test="$isError">Failure</xsl:when>
+				<xsl:otherwise>Pass</xsl:otherwise>
+			</xsl:choose>
+		</xsl:attribute>
+		<td>
+			<a href="{translate(@package,'.','/')}/package-summary.html">
+				<xsl:value-of select="@package"/>
+			</a>
+		</td>
+		<xsl:call-template name="statistics">
+			<xsl:with-param name="isError" select="$isError"/>
+		</xsl:call-template>
+	</tr>
+</xsl:template>
+
+<xsl:template match="testsuite" mode="class">
+	<xsl:variable name="isError" select="(@errors + @failures)&gt;0"/>
+	<!-- write a summary for the package -->
+	<tr valign="top">
+		<xsl:attribute name="class">
+			<xsl:choose>
+				<xsl:when test="$isError">Failure</xsl:when>
+				<xsl:otherwise>Pass</xsl:otherwise>
+			</xsl:choose>
+		</xsl:attribute>
+		<td>
+
+			<a href="{translate(@package,'.','/')}/summary.html">
+				<xsl:value-of select="@name"/>
+			</a>
+		</td>
+		<xsl:call-template name="statistics">
+			<xsl:with-param name="isError" select="$isError"/>
+		</xsl:call-template>
+	</tr>
+</xsl:template>
+
+
+<xsl:template name="statistics">
+	<xsl:variable name="isError"/>
+		<td>
+			<xsl:value-of select="sum(//testsuite[@package = current()/@package]/@tests)"/></td>
+		<td>
+			<xsl:value-of select="sum(//testsuite[@package = current()/@package]/@errors)"/></td>
+		<td>
+			<xsl:value-of select="sum(//testsuite[@package = current()/@package]/@failures)"/></td>
+		<td>
+            <xsl:call-template name="display-time">
+            	<xsl:with-param name="value" select="sum(//testsuite[@package = current()/@package]/@time)"/>
+            </xsl:call-template>
+		</td>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-summary.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-summary.xsl
new file mode 100644
index 0000000..513be7d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/overview-summary.xsl
@@ -0,0 +1,196 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0" xmlns:html="http://www.w3.org/Profiles/XHTML-transitional">
+
+<xsl:include href="toolkit.xsl"/>
+
+<!--
+	====================================================
+		Create the page structure
+    ====================================================
+-->
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<!--LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style"/-->
+		<!-- put the style in the html so that we can mail it w/o problem -->
+		<style type="text/css">
+			BODY {
+			font:normal 68% verdana,arial,helvetica;
+			color:#000000;
+			}
+			TD {
+			FONT-SIZE: 68%
+			}
+			P {
+			line-height:1.5em;
+			margin-top:0.5em; margin-bottom:1.0em;
+			}
+			H1 {
+			MARGIN: 0px 0px 5px; FONT: 165% verdana,arial,helvetica
+			}
+			H2 {
+			MARGIN-TOP: 1em; MARGIN-BOTTOM: 0.5em; FONT: bold 125% verdana,arial,helvetica
+			}
+			H3 {
+			MARGIN-BOTTOM: 0.5em; FONT: bold 115% verdana,arial,helvetica
+			}
+			H4 {
+			MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+			}
+			H5 {
+			MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+			}
+			H6 {
+			MARGIN-BOTTOM: 0.5em; FONT: bold 100% verdana,arial,helvetica
+			}	
+            .Error {
+            	font-weight:bold; background:#EEEEE0; color:purple;
+            }
+            .Failure {
+            	font-weight:bold; background:#EEEEE0; color:red;
+            }
+            .Pass {
+            	background:#EEEEE0;
+            }
+			</style>			
+		</HEAD>
+		<body text="#000000" bgColor="#ffffff">
+			<a name="#top"></a>
+			<xsl:call-template name="header"/>
+			
+			<!-- Summary part -->
+			<xsl:call-template name="summary"/>
+			<hr size="1" width="95%" align="left"/>
+			
+			<!-- Package List part -->
+			<xsl:call-template name="packagelist"/>
+			<hr size="1" width="95%" align="left"/>
+			
+			<!-- For each package create its part -->
+			<xsl:call-template name="packages"/>
+			<hr size="1" width="95%" align="left"/>
+			
+			<!-- For each class create the  part -->
+			<xsl:call-template name="classes"/>
+			
+		</body>
+	</HTML>
+</xsl:template>
+	
+	
+	
+	<!-- ================================================================== -->
+	<!-- Write a list of all packages with an hyperlink to the anchor of    -->
+	<!-- of the package name.                                               -->
+	<!-- ================================================================== -->
+	<xsl:template name="packagelist">	
+		<h2>Packages</h2>
+		Note: package statistics are not computed recursively, they only sum up all of its testsuites numbers.
+		<table border="0" cellpadding="5" cellspacing="2" width="95%">
+			<xsl:call-template name="packageSummaryHeader"/>
+			<!-- list all packages recursively -->
+			<xsl:for-each select="./testsuite[not(./@package = preceding-sibling::testsuite/@package)]">
+				<xsl:sort select="@package"/>
+				<xsl:variable name="testCount" select="sum(../testsuite[./@package = current()/@package]/@tests)"/>
+				<xsl:variable name="errorCount" select="sum(../testsuite[./@package = current()/@package]/@errors)"/>
+				<xsl:variable name="failureCount" select="sum(../testsuite[./@package = current()/@package]/@failures)"/>
+				<xsl:variable name="timeCount" select="sum(../testsuite[./@package = current()/@package]/@time)"/>
+				
+				<!-- write a summary for the package -->
+				<tr valign="top">
+					<!-- set a nice color depending if there is an error/failure -->
+					<xsl:attribute name="class">
+						<xsl:choose>
+						    <xsl:when test="$failureCount &gt; 0">Failure</xsl:when>
+							<xsl:when test="$errorCount &gt; 0">Error</xsl:when>
+							<xsl:otherwise>Pass</xsl:otherwise>
+						</xsl:choose>
+					</xsl:attribute>				
+					<td><a href="#{@package}"><xsl:value-of select="@package"/></a></td>
+					<td><xsl:value-of select="$testCount"/></td>
+					<td><xsl:value-of select="$errorCount"/></td>
+					<td><xsl:value-of select="$failureCount"/></td>
+					<td>
+                        <xsl:call-template name="display-time">
+                        	<xsl:with-param name="value" select="$timeCount"/>
+                        </xsl:call-template>					
+					</td>					
+				</tr>
+			</xsl:for-each>
+		</table>		
+	</xsl:template>
+	
+	
+	<!-- ================================================================== -->
+	<!-- Write a package level report                                       -->
+	<!-- It creates a table with values from the document:                  -->
+	<!-- Name | Tests | Errors | Failures | Time                            -->
+	<!-- ================================================================== -->
+	<xsl:template name="packages">
+		<!-- create an anchor to this package name -->
+		<xsl:for-each select="./testsuite[not(./@package = preceding-sibling::testsuite/@package)]">
+			<xsl:sort select="@package"/>
+				<a name="#{@package}"></a>
+				<h3>Package <xsl:value-of select="@package"/></h3>
+				
+				<table border="0" cellpadding="5" cellspacing="2" width="95%">
+					<xsl:call-template name="packageSummaryHeader"/>
+			
+					<!-- match the testsuites of this package -->
+					<xsl:apply-templates select="../testsuite[./@package = current()/@package]"/>					
+				</table>
+				<a href="#top">Back to top</a>
+				<p/>
+				<p/>
+		</xsl:for-each>
+	</xsl:template>
+
+	<!-- ================================================================== -->
+	<!-- Process a testsuite node                                           -->
+	<!-- It creates a table with values from the document:                  -->
+	<!-- Name | Tests | Errors | Failures | Time                            -->
+	<!-- It must match the table definition at the package level            -->
+	<!-- ================================================================== -->	
+	<xsl:template match="testsuite">
+		<tr valign="top">
+			<!-- set a nice color depending if there is an error/failure -->
+			<xsl:attribute name="class">
+				<xsl:choose>
+				    <xsl:when test="@failures[.&gt; 0]">Failure</xsl:when>
+					<xsl:when test="@errors[.&gt; 0]">Error</xsl:when>
+					<xsl:otherwise>Pass</xsl:otherwise>
+				</xsl:choose>
+			</xsl:attribute>
+		
+			<!-- print testsuite information -->
+			<td><a href="#{@name}"><xsl:value-of select="@name"/></a></td>
+			<td><xsl:value-of select="@tests"/></td>
+			<td><xsl:value-of select="@errors"/></td>
+			<td><xsl:value-of select="@failures"/></td>
+			<td>
+                <xsl:call-template name="display-time">
+                	<xsl:with-param name="value" select="@time"/>
+                </xsl:call-template>
+			</td>
+		</tr>
+	</xsl:template>
+	
+	<xsl:template name="classes">
+		<xsl:for-each select="./testsuite">
+			<xsl:sort select="@name"/>
+			<!-- create an anchor to this class name -->
+			<a name="#{@name}"></a>
+			<h3>TestCase <xsl:value-of select="@name"/></h3>
+			
+			<table border="0" cellpadding="5" cellspacing="2" width="95%">
+				<!-- Header -->
+				<xsl:call-template name="classesSummaryHeader"/>
+
+				<!-- match the testcases of this package -->
+				<xsl:apply-templates select="testcase"/>
+			</table>
+			<a href="#top">Back to top</a>
+		</xsl:for-each>
+	</xsl:template>
+	
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/package-summary.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/package-summary.xsl
new file mode 100644
index 0000000..87ee222
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/package-summary.xsl
@@ -0,0 +1,85 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<!-- import the commun templates -->
+<xsl:include href="toolkit.xsl"/>
+
+<xsl:template match="testsuites">
+	<HTML>
+		<HEAD>
+			<LINK REL ="stylesheet" TYPE="text/css" TITLE="Style">
+				<xsl:attribute name="href"><xsl:call-template name="path"><xsl:with-param name="path" select="testsuite[position() = 1]/@package"/></xsl:call-template>stylesheet.css</xsl:attribute>
+			</LINK>
+		</HEAD>
+		<BODY><xsl:attribute name="onload">open('classes-list.html','classListFrame')</xsl:attribute>
+			<xsl:call-template name="header">
+				<xsl:with-param name="useFrame">yes</xsl:with-param>	
+				<xsl:with-param name="path" select="testsuite/@package"/>
+			</xsl:call-template>
+			<!-- create an anchor to this package name -->
+			<h3>Package <xsl:value-of select="testsuite/@package"/></h3>
+			
+			<table border="0" cellpadding="5" cellspacing="2" width="95%">
+				<!--Header-->
+				<xsl:call-template name="packageSummaryHeader"/>				
+				
+				<!-- write a summary for the package -->
+				<tr valign="top">
+				<xsl:variable name="errorCount" select="sum(testsuite/@errors)"/>
+				<xsl:variable name="failureCount" select="sum(testsuite/@failures)"/>
+					<xsl:attribute name="class">
+						<xsl:choose>
+						    <xsl:when test="$failureCount &gt; 0">Failure</xsl:when>
+							<xsl:when test="$errorCount &gt; 0">Error</xsl:when>
+							<xsl:otherwise>Pass</xsl:otherwise>
+						</xsl:choose>
+					</xsl:attribute>
+					<td><xsl:value-of select="testsuite/@package"/></td>
+					<td><xsl:value-of select="sum(testsuite/@tests)"/></td>
+					<td><xsl:value-of select="sum(testsuite/@errors)"/></td>
+					<td><xsl:value-of select="sum(testsuite/@failures)"/></td>
+					<td><xsl:value-of select="format-number(sum(testsuite/@time),'#,###0.000')"/></td>
+				</tr>
+			</table>
+	
+			<H2>Classes</H2>
+			<p>
+			<table border="0" cellpadding="5" cellspacing="2" width="95%">
+				<!--Header-->
+				<xsl:call-template name="packageSummaryHeader"/>
+				
+				<!--Value-->
+				<xsl:apply-templates select="testsuite">
+					<xsl:sort select="@name"/>
+				</xsl:apply-templates>
+			</table>
+			</p>
+		</BODY>
+	</HTML>
+</xsl:template>
+
+<xsl:template match="testsuite">
+		<tr valign="top">
+			<!-- set a nice color depending if there is an error/failure -->
+			<xsl:attribute name="class">
+				<xsl:choose>
+				    <xsl:when test="@failures[.&gt; 0]">Failure</xsl:when>
+					<xsl:when test="@errors[.&gt; 0]">Error</xsl:when>
+					<xsl:otherwise>Pass</xsl:otherwise>
+				</xsl:choose>
+			</xsl:attribute>
+		
+			<!-- print testsuite information -->
+			<td><a href="{@name}-details.html" target="classFrame"><xsl:value-of select="@name"/></a></td>
+			<td><xsl:value-of select="@tests"/></td>
+			<td><xsl:value-of select="@errors"/></td>
+			<td><xsl:value-of select="@failures"/></td>
+			<td>
+                <xsl:call-template name="display-time">
+                	<xsl:with-param name="value" select="@time"/>
+                </xsl:call-template>			
+			</td>
+		</tr>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/toolkit.xsl b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/toolkit.xsl
new file mode 100644
index 0000000..c81a169
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/junit/xsl/toolkit.xsl
@@ -0,0 +1,238 @@
+<?xml version="1.0" encoding="ISO-8859-1"?>
+<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
+
+<!--
+    format a number in to display its value in percent
+    @param value the number to format
+-->
+<xsl:template name="display-time">
+	<xsl:param name="value"/>
+	<xsl:value-of select="format-number($value,'0.000')"/>
+</xsl:template>
+
+<!--
+    format a number in to display its value in percent
+    @param value the number to format
+-->
+<xsl:template name="display-percent">
+	<xsl:param name="value"/>
+	<xsl:value-of select="format-number($value,'0.00%')"/>
+</xsl:template>
+
+<!--
+    transform string like a.b.c to ../../../
+    @param path the path to transform into a descending directory path
+-->
+<xsl:template name="path">
+	<xsl:param name="path"/>
+	<xsl:if test="contains($path,'.')">
+		<xsl:text>../</xsl:text>	
+		<xsl:call-template name="path">
+			<xsl:with-param name="path"><xsl:value-of select="substring-after($path,'.')"/></xsl:with-param>
+		</xsl:call-template>	
+	</xsl:if>
+	<xsl:if test="not(contains($path,'.')) and not($path = '')">
+		<xsl:text>../</xsl:text>	
+	</xsl:if>	
+</xsl:template>
+
+<!--
+	template that will convert a carriage return into a br tag
+	@param word the text from which to convert CR to BR tag
+-->
+<xsl:template name="br-replace">
+	<xsl:param name="word"/>
+	<xsl:choose>
+		<xsl:when test="contains($word,'&#xA;')">
+			<xsl:value-of select="substring-before($word,'&#xA;')"/>
+			<br/>
+			<xsl:call-template name="br-replace">
+				<xsl:with-param name="word" select="substring-after($word,'&#xA;')"/>
+			</xsl:call-template>
+		</xsl:when>
+		<xsl:otherwise>
+			<xsl:value-of select="$word"/>
+		</xsl:otherwise>
+	</xsl:choose>
+</xsl:template>
+
+<!-- 
+		=====================================================================
+		classes summary header
+		=====================================================================
+-->
+<xsl:template name="header">
+	<xsl:param name="useFrame">no</xsl:param>
+	<xsl:param name="path"/>
+	<h1>Unit Tests Results</h1>
+	<table width="100%">
+	<tr>
+		<td align="left">
+			<!--xsl:choose>
+				<xsl:when test="$useFrame='yes'">Frames&#160;
+				<a target="_top">
+					<xsl:attribute name="href"><xsl:call-template name="path"><xsl:with-param name="path" select="$path"/></xsl:call-template>noframes.html</xsl:attribute>No frames</a></xsl:when>
+				<xsl:when test="$useFrame='no'"><a target="_top"><xsl:attribute name="href"><xsl:call-template name="path"><xsl:with-param name="path" select="$path"/></xsl:call-template>index.html</xsl:attribute>Frames</a>&#160;No frames</xsl:when>
+				<xsl:otherwise><code>ERROR : useFrame must have 'no' or 'yes' as value.</code></xsl:otherwise>
+			</xsl:choose-->
+		</td>
+		<td align="right">Designed for use with <a href='http://www.junit.org'>JUnit</a> and <a href='http://jakarta.apache.org'>Ant</a>.</td>
+	</tr>
+	</table>
+	<hr size="1"/>
+</xsl:template>
+
+<xsl:template name="summaryHeader">
+	<tr bgcolor="#A6CAF0" valign="top">
+		<td><b>Tests</b></td>
+		<td><b>Failures</b></td>
+		<td><b>Errors</b></td>
+		<td><b>Success Rate</b></td>
+		<td nowrap="nowrap"><b>Time(s)</b></td>
+	</tr>
+</xsl:template>
+
+<!-- 
+		=====================================================================
+		package summary header
+		=====================================================================
+-->
+<xsl:template name="packageSummaryHeader">
+	<tr bgcolor="#A6CAF0" valign="top">
+		<td width="75%"><b>Name</b></td>
+		<td width="5%"><b>Tests</b></td>
+		<td width="5%"><b>Errors</b></td>
+		<td width="5%"><b>Failures</b></td>
+		<td width="10%" nowrap="nowrap"><b>Time(s)</b></td>
+	</tr>
+</xsl:template>
+
+<!-- 
+		=====================================================================
+		classes summary header
+		=====================================================================
+-->
+<xsl:template name="classesSummaryHeader">
+	<tr bgcolor="#A6CAF0" valign="top">
+		<td width="18%"><b>Name</b></td>
+		<td width="7%"><b>Status</b></td>
+		<td width="70%"><b>Type</b></td>
+		<td width="5%" nowrap="nowrap"><b>Time(s)</b></td>
+	</tr>
+</xsl:template>
+
+<!-- 
+		=====================================================================
+		Write the summary report
+		It creates a table with computed values from the document:
+		User | Date | Environment | Tests | Failures | Errors | Rate | Time
+		Note : this template must call at the testsuites level
+		=====================================================================
+-->
+	<xsl:template name="summary">
+		<h2>Summary</h2>
+		<xsl:variable name="testCount" select="sum(./testsuite/@tests)"/>
+		<xsl:variable name="errorCount" select="sum(./testsuite/@errors)"/>
+		<xsl:variable name="failureCount" select="sum(./testsuite/@failures)"/>
+		<xsl:variable name="timeCount" select="sum(./testsuite/@time)"/>
+		<xsl:variable name="successRate" select="($testCount - $failureCount - $errorCount) div $testCount"/>
+		<table border="0" cellpadding="5" cellspacing="2" width="95%">
+		<xsl:call-template name="summaryHeader"/>
+		<tr valign="top">
+			<xsl:attribute name="class">
+    			<xsl:choose>
+    			    <xsl:when test="$failureCount &gt; 0">Failure</xsl:when>
+    				<xsl:when test="$errorCount &gt; 0">Error</xsl:when>
+    				<xsl:otherwise>Pass</xsl:otherwise>
+    			</xsl:choose>			
+			</xsl:attribute>		
+			<td><xsl:value-of select="$testCount"/></td>
+			<td><xsl:value-of select="$failureCount"/></td>
+			<td><xsl:value-of select="$errorCount"/></td>
+			<td>
+			    <xsl:call-template name="display-percent">
+			        <xsl:with-param name="value" select="$successRate"/>
+			    </xsl:call-template>
+			</td>
+			<td>
+			    <xsl:call-template name="display-time">
+			        <xsl:with-param name="value" select="$timeCount"/>
+			    </xsl:call-template>
+			</td>
+		</tr>
+		</table>
+		Note: <i>failures</i> are anticipated and checked for with assertions while <i>errors</i> are unanticipated.
+	</xsl:template>
+
+<!-- 
+		=====================================================================
+		testcase report
+		=====================================================================
+-->
+<xsl:template match="testcase">
+	<TR valign="top">
+		<xsl:attribute name="class">
+			<xsl:choose>
+			    <xsl:when test="./failure">Failure</xsl:when>
+				<xsl:when test="./error">Error</xsl:when>
+				<xsl:otherwise>Pass</xsl:otherwise>
+			</xsl:choose>
+		</xsl:attribute>
+		<TD><xsl:value-of select="./@name"/></TD>
+		<xsl:choose>
+			<xsl:when test="./failure">
+				<td>Failure</td>
+				<td><xsl:apply-templates select="./failure"/></td>
+			</xsl:when>
+			<xsl:when test="./error">
+				<TD>Error</TD>
+				<td><xsl:apply-templates select="./error"/></td>
+			</xsl:when>
+			<xsl:otherwise>
+				<TD>Success</TD>
+				<TD><xsl:apply-templates select="./pass"/></TD>
+			</xsl:otherwise>
+		</xsl:choose>
+		<td>
+		    <xsl:call-template name="display-time">
+		        <xsl:with-param name="value" select="@time"/>
+		    </xsl:call-template>				
+		</td>
+	</TR>
+</xsl:template>
+
+<!-- Note : the below template error and failure are the same style
+            so just call the same style store in the toolkit template -->
+<xsl:template match="failure">
+	<xsl:call-template name="display-failures"/>
+</xsl:template>
+
+<xsl:template match="error">
+	<xsl:call-template name="display-failures"/>
+</xsl:template>
+
+<!-- Style for the error and failure in the tescase template -->
+<xsl:template name="display-failures">
+	<xsl:choose>
+		<xsl:when test="not(@message)">N/A</xsl:when>
+		<xsl:otherwise>
+			<xsl:value-of select="@message"/>
+		</xsl:otherwise>
+	</xsl:choose>
+	<!-- display the stacktrace -->
+	<code>
+		<p/>
+		<xsl:call-template name="br-replace">
+			<xsl:with-param name="word" select="."/>
+		</xsl:call-template>
+	</code>
+	<!-- the later is better but might be problematic for non-21" monitors... -->
+	<!--pre><xsl:value-of select="."/></pre-->
+</xsl:template>
+
+<!-- I am sure that all nodes are called -->
+<xsl:template match="*">
+	<xsl:apply-templates/>
+</xsl:template>
+
+</xsl:stylesheet>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/metamata/MParse.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/metamata/MParse.java
index 8b974a8..038935f 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/metamata/MParse.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/metamata/MParse.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -62,46 +62,89 @@ import org.apache.tools.ant.types.Commandline;
 import org.apache.tools.ant.types.CommandlineJava;
 import org.apache.tools.ant.types.Path;
 
-import java.io.File;
-import java.io.IOException;
+import java.io.*;
+import java.util.*;
 
-/*
+/**
+ * Simple Metamata MParse task based on the original written by
+ * <a href="mailto:thomas.haas@softwired-inc.com">Thomas Haas</a>
+ * 
+ * This version was written for Metamata 2.0 available at
+ * <a href="http://www.metamata.com">http://www.metamata.com</a>
  *
- * @author thomas.haas@softwired-inc.com
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
  */
 public class MParse extends Task {
 
-    private Path userclasspath = null;
+    private Path classpath = null;
+    private Path sourcepath = null;
     private File metahome = null;
-    private File metaworkingdir = null;
     private File target = null;
-    private boolean cleanupHack = false;
+    private boolean verbose = false;
+    private boolean debugparser = false;
+    private boolean debugscanner = false;    
+    private boolean cleanup = false;
     private CommandlineJava cmdl = new CommandlineJava();
+    private File optionsFile = null;
 
-
+    /** location of metamata dev environment */
     public void setMetamatahome(File metamatahome) {
         this.metahome = metamatahome;
     }
 
-    public void setWorkingdir(File workingdir) {
-        this.metaworkingdir = workingdir;
-    }
-
+    /** the .jj file to process */
     public void setTarget(File target) {
         this.target = target;
     }
 
-    public Path createUserclasspath() {
-        if (userclasspath == null) {
-            userclasspath = new Path(project);
-        }
-        
-        return userclasspath;
+    /** create a classpath entry */
+    public Path createClasspath() {
+        if (classpath == null) {
+            classpath = new Path(project);
+        }        
+        return classpath;
+    }
+
+    /** creates a sourcepath entry */
+    public Path createSourcepath() {
+        if (sourcepath == null) {
+            sourcepath = new Path(project);
+        }        
+        return sourcepath;
+    }
+
+    /** set verbose mode */
+    public void setVerbose(boolean flag){
+        verbose = flag;
+    }
+
+    /** set scanner debug mode */
+    public void setDebugscanner(boolean flag){
+        debugscanner = flag;
+    }
+
+    /** set parser debug mode */
+    public void setDebugparser(boolean flag){
+        debugparser = flag;
+    }
+
+    /** set the hack to cleanup the temp file */
+    public void setCleanup(boolean value) {
+        cleanup = value;
     }
 
+    /** Creates a nested jvmarg element. */
+    public Commandline.Argument createJvmarg() {
+        return cmdl.createVmArgument();
+    }
 
-    public void setCleanupHack(boolean value) {
-        cleanupHack = value;
+    /**  -mx or -Xmx depending on VM version */
+    public void setMaxmemory(String max){
+        if (Project.getJavaVersion().startsWith("1.1")) {
+            createJvmarg().setValue("-mx" + max);
+        } else {
+            createJvmarg().setValue("-Xmx" + max);
+        }
     }
 
     public MParse() {
@@ -109,81 +152,200 @@ public class MParse extends Task {
         cmdl.setClassname("com.metamata.jj.MParse");
     }
 
-
+   
+    /** execute the command line */
     public void execute() throws BuildException {
-
-        if (target == null || !target.isFile()) {
-            throw new BuildException("Invalid target: " + target);
-        }
-        final File javaFile = new File(target.toString().substring(0,
-                                                                   target.toString().indexOf(".jj")) + ".java");
-        if (javaFile.exists() && target.lastModified() < javaFile.lastModified()) {
-            project.log("Target is already build - skipping (" + target + ")");
-            return;
+        try {
+            setUp();
+            ExecuteStreamHandler handler = createStreamHandler();
+            _execute(handler);
+        } finally {
+            cleanUp();
         }
-        cmdl.createArgument().setValue(target.getAbsolutePath());
+    }
+    
+    /** return the default stream handler for this task */
+    protected ExecuteStreamHandler createStreamHandler(){
+        return new LogStreamHandler(this, Project.MSG_INFO, Project.MSG_INFO);
+    }
+    
+    /**
+     * check the options and build the command line
+     */
+    protected void setUp() throws BuildException {
+        checkOptions();
 
-        if (metahome == null || !metahome.isDirectory()) {
-            throw new BuildException("Metamatahome not valid.");
-        }
-        if (metaworkingdir == null || !metaworkingdir.isDirectory()) {
-            throw new BuildException("Workingdir not set.");
-        }
-        if (userclasspath == null) {
-            throw new BuildException("Userclasspath not set.");
+        // set the classpath as the jar files
+        File[] jars = getMetamataLibs();
+        final Path classPath = cmdl.createClasspath(project);
+        for (int i = 0; i < jars.length; i++){
+            classPath.createPathElement().setLocation(jars[i]);
         }
 
-        final Path classpath = cmdl.createClasspath(project);
-        classpath.createPathElement().setLocation(new File(metahome.getAbsolutePath() + "/lib/metamatadebug.jar"));
-        classpath.createPathElement().setLocation(new File(metahome.getAbsolutePath() + "/lib/metamata.jar"));
-        classpath.createPathElement().setLocation(new File(metahome.getAbsolutePath() + "/lib/JavaCC.zip"));
+        // set the metamata.home property
+        final Commandline.Argument vmArgs = cmdl.createVmArgument();
+        vmArgs.setValue("-Dmetamata.home=" + metahome.getAbsolutePath() );
 
-        final Commandline.Argument arg = cmdl.createVmArgument();
-        arg.setValue("-mx140M");
-        arg.setValue("-Dmwp=" + metaworkingdir.getAbsolutePath());
-        arg.setValue("-Dmetamata.home=" + metahome.getAbsolutePath());
-        arg.setValue("-Dmetamata.java=java");
-        arg.setValue("-Dmetamata.java.options=-mx140M");
-        arg.setValue("-Dmetamata.java.options.classpath=-classpath");
-        arg.setValue("-Dmetamata.java.compiler=javac");
-        arg.setValue("-Dmetamata.java.compiler.options.0=-J-mx64M");
-        arg.setValue("-Dmetamata.java.compiler.options.classpath=-classpath");
-        arg.setValue("-Dmetamata.language=en");
-        arg.setValue("-Dmetamata.country=US");
-        arg.setValue("-Dmetamata.classpath=" + userclasspath);
 
-        final Execute process = new Execute(new LogStreamHandler(this,
-                                                                 Project.MSG_INFO,
-                                                                 Project.MSG_INFO), null);
+        // write all the options to a temp file and use it ro run the process
+        String[] options = getOptions();
+        optionsFile = createTmpFile();
+        generateOptionsFile(optionsFile, options);
+        Commandline.Argument args = cmdl.createArgument();
+        args.setLine("-arguments " + optionsFile.getAbsolutePath());
+    }    
+
+    
+    /** execute the process with a specific handler */
+    protected void _execute(ExecuteStreamHandler handler) throws BuildException {
+        // target has been checked as a .jj, see if there is a matching
+        // java file and if it is needed to run to process the grammar
+        String pathname = target.getAbsolutePath();
+        int pos = pathname.length() - ".jj".length();
+        pathname = pathname.substring(0, pos) + ".java";
+        File javaFile = new File(pathname);
+        if (javaFile.exists() && target.lastModified() < javaFile.lastModified()) {
+            project.log("Target is already build - skipping (" + target + ")");
+            return;
+        }
+        
+        final Execute process = new Execute(handler);
         log(cmdl.toString(), Project.MSG_VERBOSE);
         process.setCommandline(cmdl.getCommandline());
-
         try {
-            try {
-                if (process.execute() != 0) {
-                    throw new BuildException("MParse failed.");
-                }
-            } finally {
-                if (cleanupHack) {
-                    final File oo393 = new File(javaFile.getParent(),
-                                                "OO393.class");
-                    if (oo393.exists()) {
-                        project.log("Removing stale file: " + oo393.getName());
-                        oo393.delete();
-                    }
-                    final File sunjj = new File(javaFile.getParent(),
-                                                "__jj" + javaFile.getName().substring(0,
-                                                                                      javaFile.getName().indexOf(".java")) + ".sunjj");
-                    if (sunjj.exists()) {
-                        project.log("Removing stale file: " + sunjj.getName());
-                        sunjj.delete();
-                    }
-                }
+            if (process.execute() != 0) {
+                throw new BuildException("Metamata task failed.");
             }
+        } catch (IOException e){
+            throw new BuildException("Failed to launch Metamata task: " + e);
+        }
+    }    
+    
+    /** clean up all the mess that we did with temporary objects */
+    protected void cleanUp(){
+        if (optionsFile != null){
+            optionsFile.delete();
+            optionsFile = null;
+        }
+        if (cleanup) {
+            String name = target.getName();
+            int pos = name.length() - ".jj".length();
+            name = "__jj" + name.substring(0, pos) + ".sunjj";
+            final File sunjj = new File(target.getParent(), name);
+            if (sunjj.exists()) {
+                project.log("Removing stale file: " + sunjj.getName());
+                sunjj.delete();
+            }
+        }
+    }
+    
+    /**
+     * return an array of files containing the path to the needed
+     * libraries to run metamata. The file are not checked for
+     * existence. You should do this yourself if needed or simply let the
+     * forked process do it for you.
+     * @return array of jars/zips needed to run metamata.
+     */
+    protected File[] getMetamataLibs(){
+        Vector files = new Vector();
+        files.addElement( new File(metahome, "lib/metamata.jar") );
+        files.addElement( new File(metahome, "bin/lib/JavaCC.zip") );
+        
+        File[] array = new File[ files.size() ];
+        files.copyInto(array);
+        return array;
+    }
+    
+    
+    /**
+     * validate options set and resolve files and paths
+     * @throws BuildException thrown if an option has an incorrect state.
+     */
+    protected void checkOptions() throws BuildException {       
+        // check that the home is ok.
+        if (metahome == null || !metahome.exists()){
+            throw new BuildException("'metamatahome' must point to Metamata home directory.");
+        }
+        metahome = project.resolveFile(metahome.getPath());
+        
+        // check that the needed jar exists.
+        File[] jars = getMetamataLibs();
+        for (int i = 0; i < jars.length; i++){
+            if (!jars[i].exists()){
+                throw new BuildException( jars[i] + " does not exist. Check your metamata installation.");
+            }           
+        }
+        
+        // check that the target is ok and resolve it.
+        if (target == null || !target.isFile() || !target.getName().endsWith(".jj") ) {
+            throw new BuildException("Invalid target: " + target);
+        }
+        target = project.resolveFile(target.getPath());
+    }    
+    
+    /**
+     * return all options of the command line as string elements
+     * @param an array of options corresponding to the setted options.
+     */
+    protected String[] getOptions(){
+        Vector options = new Vector();
+        if (verbose){
+            options.addElement("-verbose");
+        }
+        if (debugscanner){
+            options.addElement("-ds");
+        }
+        if (debugparser){
+            options.addElement("-dp");
+        }
+        if (classpath != null){
+            options.addElement("-classpath");
+            options.addElement(classpath.toString());
         }
-        catch (IOException e) {
-            throw new BuildException("Failed to launch MParse: " + e);
+        if (sourcepath != null){
+            options.addElement("-sourcepath");
+            options.addElement(sourcepath.toString());
         }
+        options.addElement(target.getAbsolutePath());
+        
+        String[] array = new String[options.size()];
+        options.copyInto(array);
+        return array;
+    }
+    
+    /**
+     * write all options to a file with one option / line
+     * @param tofile the file to write the options to.
+     * @param options the array of options element to write to the file.
+     * @throws BuildException thrown if there is a problem while writing
+     * to the file.
+     */
+    protected void generateOptionsFile(File tofile, String[] options) throws BuildException {
+        FileWriter fw = null;
+        try {
+            fw = new FileWriter(tofile);
+            PrintWriter pw = new PrintWriter(fw);
+            for (int i = 0; i < options.length; i++){
+                pw.println( options[i] );
+            }
+            pw.flush();
+        } catch (IOException e){
+            throw new BuildException("Error while writing options file " + tofile, e);
+        } finally {
+            if (fw != null){
+                try {
+                    fw.close();
+                } catch (IOException ignored){}
+            }
+        }
+    }
+    
+    /** create a temporary file in the current directory */
+    protected final static File createTmpFile(){
+        // must be compatible with JDK 1.1 !!!!
+        final long rand = (new Random(System.currentTimeMillis())).nextLong();
+        File file = new File("metamata" + rand + ".tmp");
+        return file;
     }
 
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/FTP.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java
similarity index 87%
rename from jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/FTP.java
rename to jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java
index 4a8e453..bce41f3 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/FTP.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/FTP.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -52,14 +52,14 @@
  * <http://www.apache.org/>.
  */
 
-package org.apache.tools.ant.taskdefs.optional;
+package org.apache.tools.ant.taskdefs.optional.net;
 
-import org.apache.tools.ant.*;
-import org.apache.tools.ant.types.*;
+import com.oroinc.net.ftp.*;
 import java.io.*;
 import java.net.*;
 import java.util.*;
-import com.oroinc.net.ftp.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.*;
 
 /**
  * Basic FTP client that performs the following actions:
@@ -79,7 +79,7 @@ public class FTP
 {
     protected final static int SEND_FILES   = 0;
     protected final static int GET_FILES    = 1;
-    protected final static int DEL_FILES    = 2;	
+    protected final static int DEL_FILES    = 2;        
     protected final static int LIST_FILES   = 3;
     
     private String remotedir;
@@ -88,6 +88,7 @@ public class FTP
     private String password;
     private File listing;
     private boolean binary = true;
+    private boolean passive = false;
     private boolean verbose = false;
     private boolean newerOnly = false;
     private int action = SEND_FILES;
@@ -109,11 +110,11 @@ public class FTP
         "retrieved",
         "deleted",
         "listed"
-    };		
-	
+    };                
+        
     protected class FTPDirectoryScanner extends DirectoryScanner {
         protected FTPClient ftp = null;
-	
+        
         public FTPDirectoryScanner(FTPClient ftp) {
             super();
             this.ftp = ftp;
@@ -196,7 +197,7 @@ public class FTP
                 throw new BuildException("Error while communicating with FTP server: ", e);
             }
         }
-    }	
+    }        
 
     /**
      * Sets the remote directory where files will be placed.  This may
@@ -250,6 +251,16 @@ public class FTP
         this.binary = binary;
     }
 
+    /**
+     * Specifies whether to use passive mode.  Set to true if you
+     * are behind a firewall and cannot connect without it.  Passive mode
+     * is disabled by default.
+     */
+    public void setPassive(boolean passive)
+    {
+        this.passive = passive;
+    }
+
     /**
      * Set to true to receive notification about each file as it is
      * transferred.
@@ -332,7 +343,7 @@ public class FTP
      */
     public void setListing(File listing) throws BuildException {
         this.listing = listing;
-    }	
+    }        
     
 
     /**
@@ -374,8 +385,8 @@ public class FTP
             ds = new FTPDirectoryScanner(ftp);
             fs.setupDirectoryScanner(ds, project);
             ds.scan();
-        }			
-				
+        }                        
+                                
         String[] dsfiles = ds.getIncludedFiles();
         String dir = null;
         if ((ds.getBasedir() == null) && ((action == SEND_FILES) || (action == GET_FILES))) {
@@ -399,29 +410,29 @@ public class FTP
         for (int i = 0; i < dsfiles.length; i++)
         {
             switch (action) {
-                case SEND_FILES: {
-                    sendFile(ftp, dir, dsfiles[i]);
-                    break;
-                }
+            case SEND_FILES: {
+                sendFile(ftp, dir, dsfiles[i]);
+                break;
+            }
 
-                case GET_FILES: {
-                    getFile(ftp, dir, dsfiles[i]);
-                    break;
-                }
+            case GET_FILES: {
+                getFile(ftp, dir, dsfiles[i]);
+                break;
+            }
 
-                case DEL_FILES: {
-                    delFile(ftp, dsfiles[i]);
-                    break;
-                }
+            case DEL_FILES: {
+                delFile(ftp, dsfiles[i]);
+                break;
+            }
 
-                case LIST_FILES: {
-                    listFile(ftp, bw, dsfiles[i]);
-                    break;
-                }
+            case LIST_FILES: {
+                listFile(ftp, bw, dsfiles[i]);
+                break;
+            }
 
-                default: {
-                    throw new BuildException("unknown ftp action " + action );
-                }
+            default: {
+                throw new BuildException("unknown ftp action " + action );
+            }
             }
         }
 
@@ -501,12 +512,15 @@ public class FTP
                 log("creating remote directory " + resolveFile(dir.getPath()),
                     Project.MSG_VERBOSE);
                 ftp.makeDirectory(resolveFile(dir.getPath()));
+                // Both codes 550 and 553 can be produced by FTP Servers
+                //  to indicate that an attempt to create a directory has
+                //  failed because the directory already exists.
                 if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()) &&
-                    (ftp.getReplyCode() != 550))
+                    (ftp.getReplyCode() != 550) && (ftp.getReplyCode() != 553))
                 {
                     throw new BuildException(
-                        "could not create directory: " +
-                        ftp.getReplyString());
+                                             "could not create directory: " +
+                                             ftp.getReplyString());
                 }
                 dirCache.addElement(dir);
             }
@@ -526,8 +540,8 @@ public class FTP
         if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
         {
             throw new BuildException(
-                "could not date test remote file: " +
-                ftp.getReplyString());
+                                     "could not date test remote file: " +
+                                     ftp.getReplyString());
         }
 
         if (files == null)
@@ -579,8 +593,8 @@ public class FTP
             if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
             {
                 throw new BuildException(
-                    "could not transfer file: " +
-                    ftp.getReplyString());
+                                         "could not transfer file: " +
+                                         ftp.getReplyString());
             }
             
             log("File " + file.getAbsolutePath() + " copied to " + server,
@@ -608,7 +622,7 @@ public class FTP
      * Delete a file from the remote host.
      */
     protected void delFile(FTPClient ftp, String filename)
-            throws IOException, BuildException {
+        throws IOException, BuildException {
         if (verbose) {
             log("deleting " + filename);
         }
@@ -646,23 +660,23 @@ public class FTP
                 log("transferring " + filename + " to " + file.getAbsolutePath());
             }
 
-			
-            File pdir = new File(file.getParent());	// stay 1.1 compatible
+                        
+            File pdir = new File(file.getParent());        // stay 1.1 compatible
             if (!pdir.exists()) {
                 pdir.mkdirs();
-            }		
+            }                
             outstream = new BufferedOutputStream(new FileOutputStream(file));
             ftp.retrieveFile(resolveFile(filename), outstream);
-			
+                        
             if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
             {
                 throw new BuildException(
-"could not transfer file: " +
- ftp.getReplyString());
+                                         "could not transfer file: " +
+                                         ftp.getReplyString());
             }
-			
+                        
             log("File " + file.getAbsolutePath() + " copied from " + server,
- Project.MSG_VERBOSE);
+                Project.MSG_VERBOSE);
 
             transferred++;
         }
@@ -742,8 +756,20 @@ public class FTP
                 if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
                 {
                     throw new BuildException(
-                        "could not set transfer type: " +
-                        ftp.getReplyString());
+                                             "could not set transfer type: " +
+                                             ftp.getReplyString());
+                }
+            }
+            
+            if (passive)
+            {
+                log("entering passive mode", Project.MSG_VERBOSE);
+                ftp.enterLocalPassiveMode();
+                if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
+                {
+                    throw new BuildException(
+                                             "could not enter into passive mode: " +
+                                             ftp.getReplyString());
                 }
             }
 
@@ -754,8 +780,8 @@ public class FTP
                 if (!FTPReply.isPositiveCompletion(ftp.getReplyCode()))
                 {
                     throw new BuildException(
-                        "could not change remote directory: " +
-                        ftp.getReplyString());
+                                             "could not change remote directory: " +
+                                             ftp.getReplyString());
                 }
             }
 
@@ -770,18 +796,18 @@ public class FTP
         finally
         {
             /*
-            if (ftp != null && ftp.isConnected())
-            {
-                try
-                {
-                    // this hangs - I don't know why.
-                    ftp.disconnect();
-                }
-                catch(IOException ex)
-                {
-                    // ignore it
-                }
-            }
+              if (ftp != null && ftp.isConnected())
+              {
+              try
+              {
+              // this hangs - I don't know why.
+              ftp.disconnect();
+              }
+              catch(IOException ex)
+              {
+              // ignore it
+              }
+              }
             */
         }
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/TelnetTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/TelnetTask.java
new file mode 100644
index 0000000..f98e24a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/net/TelnetTask.java
@@ -0,0 +1,372 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.net;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.DirectoryScanner;
+import org.apache.tools.ant.taskdefs.MatchingTask;
+import com.oroinc.net.telnet.*;
+import org.apache.tools.ant.BuildException;
+import java.io.*;
+import java.lang.*;
+import java.util.*;
+
+/**
+ * Class to provide automated telnet protocol support for the Ant build tool
+ *
+ * @author Scott Carlson<a href="mailto:ScottCarlson@email.com">ScottCarlson@email.com</a>
+ * @version $Revision: 1.2 $
+ */
+
+public class TelnetTask extends Task {
+    /**
+     *  The userid to login with, if automated login is used
+     */
+    private String userid  = null;
+
+    /**
+     *  The password to login with, if automated login is used
+     */
+    private String password= null;
+
+    /**
+     *  The server to connect to. 
+     */
+    private String server  = null;
+
+    /**
+     *  The tcp port to connect to. 
+     */
+    private int port = 23;
+
+    /**
+     *  The Object which handles the telnet session.
+     */
+    private AntTelnetClient telnet = null;
+
+    /**
+     *  The list of read/write commands for this session
+     */
+    private Vector telnetTasks = new Vector();
+
+    /** 
+     *  If true, adds a CR to beginning of login script
+     */
+    private boolean addCarriageReturn = false;
+
+    /**
+     *  Default time allowed for waiting for a valid response
+     *  for all child reads.  A value of 0 means no limit.
+     */
+    private Integer defaultTimeout = null;
+
+    /** 
+     *  Verify that all parameters are included. 
+     *  Connect and possibly login
+     *  Iterate through the list of Reads and writes 
+     */
+    public void execute() throws BuildException 
+    {
+       /**  A server name is required to continue */
+       if (server== null)
+           throw new BuildException("No Server Specified");
+       /**  A userid and password must appear together 
+        *   if they appear.  They are not required.
+        */
+       if (userid == null && password != null)
+           throw new BuildException("No Userid Specified");
+       if (password == null && userid != null)
+           throw new BuildException("No Password Specified");
+
+       /**  Create the telnet client object */
+       telnet = new AntTelnetClient();
+       try {
+           telnet.connect(server, port);
+       } catch(IOException e) {
+           throw new BuildException("Can't connect to "+server);
+       }
+       /**  Login if userid and password were specified */
+       if (userid != null && password != null)
+          login();
+       /**  Process each sub command */
+       Enumeration tasksToRun = telnetTasks.elements();
+       while (tasksToRun!=null && tasksToRun.hasMoreElements())
+       {
+           TelnetSubTask task = (TelnetSubTask) tasksToRun.nextElement();
+           if (task instanceof TelnetRead && defaultTimeout != null)
+               ((TelnetRead)task).setDefaultTimeout(defaultTimeout);
+           task.execute(telnet);
+       }
+    }
+
+    /**  
+     *  Process a 'typical' login.  If it differs, use the read 
+     *  and write tasks explicitely
+     */
+    private void login()
+    {
+       if (addCarriageReturn)
+          telnet.sendString("\n", true);
+       telnet.waitForString("ogin:");
+       telnet.sendString(userid, true);
+       telnet.waitForString("assword:");
+       telnet.sendString(password, false);
+    }
+
+    /**
+     *  Set the userid attribute 
+     */
+    public void setUserid(String u) { this.userid = u; }
+
+    /**
+     *  Set the password attribute 
+     */
+    public void setPassword(String p) { this.password = p; }
+
+    /**
+     *  Set the server address attribute 
+     */
+    public void setServer(String m) { this.server = m; }
+
+    /**
+     *  Set the tcp port to connect to attribute 
+     */
+    public void setPort(int p) { this.port = p; }
+
+    /**
+     *  Set the tcp port to connect to attribute 
+     */
+    public void setInitialCR(boolean b)
+    {
+       this.addCarriageReturn = b;
+    }
+
+    /**
+     *  Change the default timeout to wait for 
+     *  valid responses
+     */
+    public void setTimeout(Integer i)
+    {
+       this.defaultTimeout = i;
+    }
+
+    /**
+     *  A subTask <read> tag was found.  Create the object, 
+     *  Save it in our list, and return it.
+     */
+   
+    public TelnetSubTask createRead()
+    {
+        TelnetSubTask task = (TelnetSubTask)new TelnetRead();
+        telnetTasks.addElement(task);
+        return task;
+    }
+
+    /**
+     *  A subTask <write> tag was found.  Create the object, 
+     *  Save it in our list, and return it.
+     */
+    public TelnetSubTask createWrite()
+    {
+        TelnetSubTask task = (TelnetSubTask)new TelnetWrite();
+        telnetTasks.addElement(task);
+        return task;
+    }
+
+    /**  
+     *  This class is the parent of the Read and Write tasks.
+     *  It handles the common attributes for both.
+     */
+    public class TelnetSubTask
+    {
+        protected String taskString= "";
+        public void execute(AntTelnetClient telnet) 
+                throws BuildException
+        {
+            throw new BuildException("Shouldn't be able instantiate a SubTask directly");
+        }
+        public void addText(String s) { setString(s);}
+        public void setString(String s)
+        {
+           taskString += s; 
+        }
+    }
+    /**
+     *  This class sends text to the connected server 
+     */
+    public class TelnetWrite extends TelnetSubTask
+    {
+        private boolean echoString = true;
+        public void execute(AntTelnetClient telnet) 
+               throws BuildException
+        {
+           telnet.sendString(taskString, echoString);
+        }
+        
+        public void setEcho(boolean b)
+        {
+           echoString = b;
+        }
+    }
+    /**
+     *  This class reads the output from the connected server
+     *  until the required string is found. 
+     */
+    public class TelnetRead extends TelnetSubTask
+    {
+        private Integer timeout = null;
+        public void execute(AntTelnetClient telnet) 
+               throws BuildException
+        {
+            telnet.waitForString(taskString, timeout);
+        }
+        /**
+         *  Override any default timeouts
+         */
+        public void setTimeout(Integer i)
+        {
+           this.timeout = i;
+        }
+        /**
+         *  Sets the default timeout if none has been set already
+         */
+        public void setDefaultTimeout(Integer defaultTimeout)
+        {
+           if (timeout == null)
+              timeout = defaultTimeout;
+    }
+    }
+    /**
+     *  This class handles the abstraction of the telnet protocol.
+     *  Currently it is a wrapper around <a href="www.oroinc.com">ORO</a>'s 
+     *  NetComponents
+     */
+    public class AntTelnetClient extends TelnetClient
+    {
+      /**
+       * Read from the telnet session until the string we are 
+       * waiting for is found 
+       * @parm s The string to wait on 
+       */
+      public void waitForString(String s)
+      {
+           waitForString(s, null);
+      }
+
+      /**
+       * Read from the telnet session until the string we are 
+       * waiting for is found or the timeout has been reached
+       * @parm s The string to wait on 
+       * @parm timeout The maximum number of seconds to wait
+       */
+      public void waitForString(String s, Integer timeout)
+      {
+        InputStream is =this.getInputStream();
+        try {
+          StringBuffer sb = new StringBuffer();
+          if (timeout == null || timeout.intValue() == 0)
+          {
+              while (sb.toString().indexOf(s) == -1)
+                  {
+                      sb.append((char) is.read());
+                  }
+          }
+          else
+          {
+              Calendar endTime = Calendar.getInstance(); 
+              endTime.add(Calendar.SECOND,timeout.intValue());
+              while ( sb.toString().indexOf(s) == -1)
+              {
+                  while (Calendar.getInstance().before(endTime) &&
+                         is.available() == 0) {
+                      Thread.sleep(250);
+                  }
+                  if (is.available() == 0)
+                      throw new BuildException("Response Timed-Out", getLocation());
+                  sb.append((char) is.read());
+              }
+          }
+          log(sb.toString(), Project.MSG_INFO);
+        } catch (BuildException be)
+        { 
+            throw be;
+        } catch (Exception e)
+        { 
+            throw new BuildException(e, getLocation());
+        }
+      }
+
+    
+      /**
+       * Write this string to the telnet session.
+       * @parm echoString  Logs string sent
+       */
+      public void sendString(String s, boolean echoString)
+      {
+        OutputStream os =this.getOutputStream();
+        try {
+          os.write((s + "\n").getBytes());
+          if (echoString)
+              log(s, Project.MSG_INFO);
+          os.flush();
+        } catch (Exception e)
+        { 
+          throw new BuildException(e, getLocation());
+        }
+      }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Base.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Base.java
new file mode 100644
index 0000000..4c8cf9f
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Base.java
@@ -0,0 +1,170 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import java.io.*;
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.taskdefs.*;
+import org.apache.tools.ant.types.*;
+import org.apache.oro.text.perl.*;
+
+
+/** Base class for Perforce (P4) ANT tasks. See individual task for example usage.
+ *
+ * @see P4Sync
+ * @see P4Have
+ * @see P4Change
+ * @see P4Edit
+ * @see P4Submit
+ * @see P4Label
+ * @see org.apache.tools.ant.taskdefs.Exec
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ */
+public abstract class P4Base extends org.apache.tools.ant.Task {
+
+    /**Perl5 regexp in Java - cool eh? */
+    protected Perl5Util util = null;
+    /** The OS shell to use (cmd.exe or /bin/sh) */
+    protected String shell;
+
+    //P4 runtime directives
+    /** Perforce Server Port (eg KM01:1666) */
+    protected String P4Port     = "";
+    /** Perforce Client (eg myclientspec) */
+    protected String P4Client   = "";
+    /** Perforce User (eg fbloggs) */
+    protected String P4User     = "";
+    /** Perforce view for commands (eg //projects/foobar/main/source/... )*/
+    protected String P4View     = "";
+
+    //P4 g-opts and cmd opts (rtfm)
+    /** Perforce 'global' opts.
+      * Forms half of low level API */
+    protected String P4Opts     = "";
+    /** Perforce command opts.
+      * Forms half of low level API */
+    protected String P4CmdOpts  = "";
+
+    //Setters called by Ant
+    public void setPort(String P4Port)        { this.P4Port       =   "-p"+P4Port;    }
+    public void setClient(String P4Client)    { this.P4Client     =   "-c"+P4Client;  }
+    public void setUser(String P4User)        { this.P4User       =   "-u"+P4User;    }
+    public void setView(String P4View)        { this.P4View       =   P4View;         }
+    public void setCmdopts(String P4CmdOpts)  { this.P4CmdOpts    =   P4CmdOpts;      }
+
+    public void init() {
+
+        util = new Perl5Util();
+
+    	//Get default P4 settings from environment - Mark would have done something cool with
+	    //introspection here.....:-)
+	    String tmpprop;
+        if((tmpprop = project.getProperty("p4.port")) != null) setPort(tmpprop);
+        if((tmpprop = project.getProperty("p4.client")) != null) setClient(tmpprop);
+        if((tmpprop = project.getProperty("p4.user")) != null) setUser(tmpprop);	
+    }
+
+    protected void execP4Command(String command) throws BuildException {
+        execP4Command(command, null);
+    }
+    
+    /** Execute P4 command assembled by subclasses.
+	@param command The command to run
+	@param p4input Input to be fed to command on stdin
+	@param handler A P4Handler to process any input and output
+    */
+    protected void execP4Command(String command, P4Handler handler) throws BuildException {
+        try{
+
+            Commandline commandline = new Commandline();
+            commandline.setExecutable("p4");
+
+            //Check API for these - it's how CVS does it...
+            commandline.createArgument().setValue(P4Port);
+            commandline.createArgument().setValue(P4User);
+            commandline.createArgument().setValue(P4Client);
+            commandline.createArgument().setLine(command);
+
+	        log("Execing "+commandline.getCommandline(), Project.MSG_VERBOSE);
+
+            if(handler == null ) handler = new SimpleP4OutputHandler(this);
+
+            Execute exe = new Execute(handler, null);
+
+            exe.setAntRun(project);
+            
+            exe.setCommandline(commandline.getCommandline());
+
+            try{
+             exe.execute();
+            }catch(IOException e) {
+                throw new BuildException(e);
+            } finally {
+                try{
+                    handler.stop();
+                }catch(Exception e) {}
+            }
+
+            
+    		
+	    }catch(Exception e) {
+	        throw new BuildException("Problem exec'ing P4 command: "+e.getMessage());
+	    }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Change.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Change.java
new file mode 100644
index 0000000..f946b72
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Change.java
@@ -0,0 +1,138 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import java.io.*;
+
+import org.apache.tools.ant.*;
+
+/** P4Change - grab a new changelist from Perforce.
+ *
+ * P4Change creates a new changelist in perforce. P4Change sets the property
+ * ${p4.change} with the new changelist number. This should then be passed into
+ * p4edit and p4submit.
+ *
+ * @see P4Edit
+ * @see P4Submit
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ *
+ */
+public class P4Change extends P4Base {
+
+	protected String emptyChangeList = null;
+
+    public void execute() throws BuildException {
+
+        if(emptyChangeList == null) emptyChangeList = getEmptyChangeList();
+        final Project myProj = project;
+
+        P4Handler handler = new P4HandlerAdapter() {
+            public void process(String line) {
+                if (util.match("/Change/", line)) {
+                    
+                    //Remove any non-numerical chars - should leave the change number
+   	        		line = util.substitute("s/[^0-9]//g", line);
+   	        		
+   			       	int changenumber = Integer.parseInt(line);
+   			        log("Change Number is "+changenumber, Project.MSG_INFO);
+				    myProj.setProperty("p4.change", ""+changenumber);
+
+       			} else if(util.match("/error/", line)) {
+   	    		    throw new BuildException("Perforce Error, check client settings and/or server");
+       			}
+   			        
+   	        }};
+
+        handler.setOutput(emptyChangeList);
+
+        execP4Command("change -i", handler);
+    }
+
+
+    public String getEmptyChangeList() throws BuildException {
+        final StringBuffer stringbuf = new StringBuffer();
+        
+        execP4Command("change -o", new P4HandlerAdapter() {
+            public void process(String line) {
+        	    if(!util.match("/^#/",line)){
+                    if(util.match("/error/", line)) {
+	        		
+   			            log("Client Error", Project.MSG_VERBOSE);
+   			            throw new BuildException("Perforce Error, check client settings and/or server");
+   			            
+           			} else if(util.match("/<enter description here>/",line)) {
+
+                        line = util.substitute("s/<enter description here>/AutoSubmit By Ant/", line);
+			    		
+			        } else if(util.match("/\\/\\//", line)) {
+			            //Match "//" for begining of depot filespec
+			    	    return;
+				    }
+				    
+    				stringbuf.append(line);
+	    			stringbuf.append("\n");
+	    			
+		    	}
+    		}});
+		
+    	   	return stringbuf.toString();
+    }
+
+
+} //EoF
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Edit.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Edit.java
new file mode 100644
index 0000000..4cb6439
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Edit.java
@@ -0,0 +1,85 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.*;
+
+/** P4Edit - checkout file(s) for edit.
+ *
+ * Example Usage:<br>
+ * &lt;p4edit change="${p4.change}" view="//depot/project/foo.txt" /&gt;
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ *
+ * ToDo: Should call reopen if file is already open in one of our changelists perhaps?
+ */
+ 
+ public class P4Edit extends P4Base {
+ 
+     public String change = null;
+     
+     public void setChange(String change) {
+             this.change = change;
+	 }
+	 
+     public void execute() throws BuildException {
+         if(change != null ) P4CmdOpts = "-c "+change;
+	     if(P4View == null) throw new BuildException("No view specified to edit");
+         execP4Command("-s edit "+P4CmdOpts+" "+P4View, new SimpleP4OutputHandler(this));
+	 }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Handler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Handler.java
new file mode 100644
index 0000000..bef5f98
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Handler.java
@@ -0,0 +1,69 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.taskdefs.ExecuteStreamHandler;
+
+/** Interface for p4 job output stream handler. Classes implementing this interface
+ * can be called back by P4Base.execP4Command();
+ *
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ */
+public interface P4Handler extends ExecuteStreamHandler {
+
+    public void process(String line) throws BuildException;
+    public void setOutput(String line) throws BuildException;
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4HandlerAdapter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4HandlerAdapter.java
new file mode 100644
index 0000000..a170098
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4HandlerAdapter.java
@@ -0,0 +1,119 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999, 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import java.io.*;
+import org.apache.tools.ant.*;
+
+public abstract class P4HandlerAdapter implements P4Handler {
+
+    public abstract void process(String line);
+
+
+    String p4input = "";
+
+    //set any data to be written to P4's stdin - messy, needs work
+    public void setOutput(String p4Input) {
+        this.p4input = p4Input;
+    }
+
+
+    public void start() throws BuildException {
+
+    try{
+        //First write any output to P4 
+        if(p4input != null && p4input.length() >0 && os != null) {
+                    os.write(p4input.getBytes());
+                    os.flush();
+                    os.close();
+            }
+
+        //Now read any input and process
+      
+        BufferedReader input = new BufferedReader(
+                                     new InputStreamReader(
+                                       new SequenceInputStream(is,es)));
+
+            String line;
+	    	while((line = input.readLine()) != null) {
+	    	   process(line);
+	    	}
+	    	
+	    	input.close();
+
+
+        }catch(Exception e) {
+            throw new BuildException(e);
+        }
+    }
+
+    OutputStream os;    //OUtput
+    InputStream is;     //Input
+    InputStream es;     //Error
+
+    public void setProcessInputStream(OutputStream os) throws IOException {
+        this.os = os;
+    }
+
+    public void setProcessErrorStream(InputStream is) throws IOException {
+        this.es = is;
+    }
+
+    public void setProcessOutputStream(InputStream is) throws IOException {
+        this.is = is;
+    }
+
+    public void stop(){}
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Have.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Have.java
new file mode 100644
index 0000000..b771f01
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Have.java
@@ -0,0 +1,75 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.*;
+
+
+/** P4Have - lists files currently on client.
+ * 
+ * P4Have simply dumps the current file version info into
+ * the Ant log (or stdout).
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ */
+public class P4Have extends P4Base {
+
+    public void execute() throws BuildException {
+        execP4Command("have "+P4CmdOpts+" "+P4View, new SimpleP4OutputHandler(this));
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Label.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Label.java
new file mode 100644
index 0000000..e97229b
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Label.java
@@ -0,0 +1,140 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.*;
+
+import java.util.Date;
+import java.text.SimpleDateFormat;
+
+
+/** P4Label - create a Perforce Label.
+ *
+ *  P4Label inserts a label into perforce reflecting the
+ *  current client contents.
+ *
+ *  Label name defaults to AntLabel if none set.
+ *
+ * Example Usage: <P4Label name="MyLabel-${TSTAMP}-${DSTAMP}" desc="Auto Build Label" />
+ *
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ */
+public class P4Label extends P4Base {
+
+    protected String name;
+    protected String desc;
+    
+    public void setName(String name) {
+        this.name = name;
+    }
+    
+    public void setDesc(String desc) {
+        this.desc = desc;
+    }
+    
+    public void execute() throws BuildException {
+        log("P4Label exec:",Project.MSG_INFO);
+        
+        if(P4View == null || P4View.length() < 1) {
+            log("View not set, assuming //depot/...", Project.MSG_WARN);
+            P4View = "//depot/...";
+        }
+        
+        if(desc == null || desc.length() < 1) {
+            log("Label Description not set, assuming 'AntLabel'", Project.MSG_WARN);
+            desc = "AntLabel";
+        }
+        
+
+        if(name == null || name.length() < 1) {
+            SimpleDateFormat formatter = new SimpleDateFormat ("yyyy.MM.dd-hh:mm");
+            Date now = new Date();
+            name = "AntLabel-"+formatter.format(now);
+            log("name not set, assuming '"+name+"'", Project.MSG_WARN);
+        }
+        
+        
+        String newLabel = 
+            "Label: "+name+"\n"+
+            "Description: "+desc+"\n"+
+            "Options: unlocked\n"+
+            "View: "+P4View+"\n";
+
+        P4Handler handler = new P4HandlerAdapter() {
+            public void process(String line) {
+                log(line, Project.MSG_VERBOSE);
+            }
+        };
+
+        handler.setOutput(newLabel);
+
+        execP4Command("label -i", handler);
+        
+        execP4Command("labelsync -l "+name, new P4HandlerAdapter() {
+            public void process(String line) {
+                log(line, Project.MSG_VERBOSE);
+            }
+        });
+        
+        
+        log("Created Label "+name+" ("+desc+")", Project.MSG_INFO);
+        
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4OutputHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4OutputHandler.java
new file mode 100644
index 0000000..f748f42
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4OutputHandler.java
@@ -0,0 +1,67 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.BuildException;
+
+/** Interface for p4 job output stream handler. Classes implementing this interface
+ * can be called back by P4Base.execP4Command();
+ *
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ */
+public interface P4OutputHandler {
+
+    public void process(String line) throws BuildException;
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Submit.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Submit.java
new file mode 100644
index 0000000..09444b7
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Submit.java
@@ -0,0 +1,98 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.*;
+
+/** P4Submit - submit a numbered changelist to Perforce.
+ *
+ * <B>Note:</B> P4Submit cannot (yet) submit the default changelist. 
+ * This shouldn't be a problem with the ANT API as the usual flow is 
+ * P4Change to create a new numbered change followed by P4Edit then P4Submit.
+ *
+ * Example Usage:-<br>
+ * &lt;p4submit change="${p4.change}" /&gt;
+ *
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+ *
+ */
+public class P4Submit extends P4Base {
+
+    //ToDo: If dealing with default cl need to parse out <enter description here>    
+    public String change;
+
+    public void setChange(String change) {
+        this.change = change;
+	}
+    public void execute() throws BuildException {
+        if(change != null) {
+	        execP4Command("submit -c "+change, new P4HandlerAdapter(){
+		            public void process(String line) {
+			            log(line, Project.MSG_VERBOSE);
+				    }
+		    });
+	
+	    } else {
+	    //here we'd parse the output from change -o into submit -i 
+	    //in order to support default change.
+	    throw new BuildException("No change specified (no support for default change yet....");
+    	}
+	}
+	
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4sync.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4sync.java
index 14e170b..4a1563c 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4sync.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4sync.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -50,208 +50,68 @@
  * individuals on behalf of the Apache Software Foundation.  For more
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
  */
 
 package org.apache.tools.ant.taskdefs.optional.perforce;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.taskdefs.Exec;
-import org.apache.tools.ant.Task;
+import org.apache.tools.ant.*;
 
-/**
- * <h2><a name="perforce">Perforce</a></h2>
- * <h3>Description</h3>
- * <p>Handles packages/modules retrieved from a <a href="http://www.perforce.com/">Perforce</a> repository.</p>
- * <h3>Parameters</h3>
- * <table border="1" cellpadding="2" cellspacing="0">
- *     <tr>
- *         <td valign="top"><b>Attribute</b></td>
- *         <td valign="top"><b>Description</b></td>
- *         <td align="center" valign="top"><b>Required</b></td>
- *     </tr>
- *     <tr>
- *         <td valign="top">localpath</td>
- *         <td valign="top">The local path of the file/directory to
- *         write file(s) to.</td>
- *         <td align="center" valign="top">Yes</td>
- *     </tr>
- *     <tr>
- *         <td>user</td>
- *         <td>Specifies the user name, overriding the value of $P4USER,
- *         $USER, and $USERNAME in the environment.</td>
- *         <td><p align="center">No</p>
- *         </td>
- *     </tr>
- *     <tr>
- *         <td>port</td>
- *         <td>Specifies the server's listen address, overriding the
- *         value of $P4PORT in the environment and the default (perforce:1666).</td>
- *         <td><p align="center">No</p>
- *         </td>
- *     </tr>
- *     <tr>
- *         <td valign="top">version</td>
- *         <td valign="top">The revision number of the file being
- *         extracted.</td>
- *         <td align="center" valign="top">No</td>
- *     </tr>
- *     <tr>
- *         <td valign="top">date</td>
- *         <td valign="top">Get files as of this date. Either [yyyy/mm/dd]
- *         or [yyyy/mm/dd:hh:mm:ss]. Note that [yyyy/mm/dd] means [yyyy/mm/dd:00:00:00],
- *         so if you want to include all events on that day refer to
- *         the next day.</td>
- *         <td align="center" valign="top">No</td>
- *     </tr>
- *     <tr>
- *         <td valign="top">label</td>
- *         <td valign="top">A label from which to check out files.</td>
- *         <td align="center" valign="top">No</td>
- *     </tr>
- *     <tr>
- *         <td valign="top">force</td>
- *         <td valign="top">&quot;[true|false]&quot;. Forces
- *         resynchronization even if the client already has the
- *         file, and clobbers writable files. This flag doesn't
- *         affect open files.</td>
- *         <td align="center" valign="top">No, default &quot;false&quot;</td>
- *     </tr>
- *     <tr>
- *         <td>change</td>
- *         <td>Gets the file(s) as they were when a specified change
- *         number was applied.</td>
- *         <td><p align="center">No</p>
- *         </td>
- *     </tr>
- * </table>
- *
- * <h3>Examples</h3>
- *
- * <pre>  &lt;perforce localpath=&quot;//path/to/source/...&quot;
- *        force=&quot;true&quot;
- *        change=&quot;4513&quot;
- *   /&gt;</pre>
+/** P4Sync  - synchronise client space to a perforce depot view.
+ *  The API allows additional functionality of the "p4 sync" command 
+ * (such as "p4 sync -f //...#have" or other exotic invocations).</P>
  *
- * <p>syncs the files in the source directory that are in the
- * Perforce repository, as of change number 4513, overwriting any
- * modified files in the current source tree is needed. You cannot
- * specify more than one of (date, label, revision).</p>
+ * <b>Example Usage:</b>
+ * <table border="1">
+ * <th>Function</th><th>Command</th>
+ * <tr><td>Sync to head using P4USER, P4PORT and P4CLIENT settings specified</td><td>&lt;P4Sync <br>P4view="//projects/foo/main/source/..." <br>P4User="fbloggs" <br>P4Port="km01:1666" <br>P4Client="fbloggsclient" /&gt;</td></tr>
+ * <tr><td>Sync to head using P4USER, P4PORT and P4CLIENT settings defined in environment</td><td>&lt;P4Sync P4view="//projects/foo/main/source/..." /&gt;</td></tr>
+ * <tr><td>Force a re-sync to head, refreshing all files</td><td>&lt;P4Sync force="yes" P4view="//projects/foo/main/source/..." /&gt;</td></tr>
+ * <tr><td>Sync to a label</td><td>&lt;P4Sync label="myPerforceLabel" /&gt;</td></tr>
+ * </table>
  *
- * <pre>  &lt;perforce localpath=&quot;//path/to/source/...&quot; /&gt;</pre>
+ * ToDo:  Add decent label error handling for non-exsitant labels
  *
- * <p>Syncs with the latest version of the file in the repository.</p>
+ * @author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
  */
-public class P4sync extends Exec {
-    private String p4user;
-    private String p4port;
-    private String directory;
-    private boolean force;
-    private String date;
-    private String label;
-    private String revision;
-    private String changenum;
-    private String error = "";
+public class P4Sync extends P4Base {
 
-    // The method executing the task
-    public void execute() throws BuildException {
-        StringBuffer cmdline = new StringBuffer();
-        String RevisionString = "";
-        int nRevisions = 0;
+    String label;
+    private String syncCmd = "";
 
-        cmdline.append("p4");
-        cmdline.append(" " + "-s"); // 'p4 -s' gives a tag for parsing each line
+    public void setLabel(String label) throws BuildException { 
+        if(label == null && !label.equals(""))
+                throw new BuildException("P4Sync: Labels cannot be Null or Empty");
 
-        if (p4user != null) {
-            cmdline.append( " " + "-u");
-            cmdline.append( " " + p4user);
-        }
-
-        if (p4port != null) {
-            cmdline.append( " " + "-p");
-            cmdline.append( " " + p4port);
-        }
-        cmdline.append( " " + "sync");
-
-        if (force) {
-            cmdline.append( " " + "-f");
-        }
-
-        if (directory == null) {
-            throw new BuildException("dir= not specified for 'p4sync'");
-        }
+        this.label = label;
 
-        if (label != null) {
-            String prefix = "";
-            if (!label.startsWith("@")) {
-               prefix = "@";
-            }
-            RevisionString = prefix + label;
-            nRevisions = nRevisions + 1;
-        }
+    }
 
-        if (changenum != null) {
-            String prefix = "";
-            if (!changenum.startsWith("@")) {
-                prefix = "@";
-            }
-            RevisionString = prefix + changenum;
-            nRevisions = nRevisions + 1;
-        }
 
-        if (date != null) {
-            String prefix = "";
-            if (!date.startsWith("@")) {
-                prefix = "@";
-            }
-            RevisionString = prefix + date;
-            nRevisions = nRevisions + 1;
+    public void setForce(String force) throws BuildException {
+        if(force == null && !label.equals(""))
+                throw new BuildException("P4Sync: If you want to force, set force to non-null string!");
+            P4CmdOpts = "-f";
         }
+        
+    public void execute() throws BuildException {
 
-        if (revision != null) {
-            if (revision.startsWith("#")) {
-                RevisionString = revision;
-            } else {
-                RevisionString = "#" + revision;
-            }
-            nRevisions = nRevisions + 1;
-        }
 
-        if (nRevisions > 1) {
-            throw new BuildException("date/revision/label/changenumber are mutually exclusive - specify only one.");
+        if (P4View != null) {
+                syncCmd = P4View;
         }
 
-        cmdline.append(" " + directory + RevisionString);
-
-        String command = cmdline.toString();
-        System.out.println("executing: "+command);
+        
+        if(label != null && !label.equals("")) {
+                syncCmd = syncCmd + "@" + label;
+        } 
 
-        run(command);
+        
+        log("Execing sync "+P4CmdOpts+" "+syncCmd, Project.MSG_VERBOSE);
 
-        if (error.length() != 0) {
-            throw new BuildException(error);
-        }
+        execP4Command("-s sync "+P4CmdOpts+" "+syncCmd, new SimpleP4OutputHandler(this));
     }
-
-    protected void outputLog(String line, int messageLevel) {
-        if (line.startsWith("error: ") && !line.endsWith("file(s) up-to-date.")) {
-            error += line.substring(7);
-        }
-
-        super.outputLog(line, messageLevel);
-    };
-
-    // The setter for the attributes
-    public void setForce(boolean force) { this.force = force; }
-    public void setLabel(String label) { this.label = label; }
-    public void setDate(String date) { this.date = date; }
-    public void setLocalpath(String directory) { this.directory = directory; }
-    public void setVersion(String revision) { this.revision = revision; }
-
-    public void setRevision(String revision) { this.revision = revision; }
-    public void setChange(String changenum) { this.changenum = changenum; }
-
-    public void setP4user(String p4user) { this.p4user = p4user; }
-    public void setUser(String p4user) { this.p4user = p4user; }
-    public void setPort(String p4port) { this.p4port = p4port; }
-    public void setP4port(String p4port) { this.p4port = p4port; }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/SimpleP4OutputHandler.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/SimpleP4OutputHandler.java
new file mode 100644
index 0000000..c4b57a3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/SimpleP4OutputHandler.java
@@ -0,0 +1,91 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.perforce;
+
+import org.apache.tools.ant.*;
+
+public class SimpleP4OutputHandler extends P4HandlerAdapter {
+
+	P4Base parent;
+	public SimpleP4OutputHandler(P4Base parent) {
+		this.parent = parent;
+	}
+	
+	public void process(String line) throws BuildException {
+		if(parent.util.match("/^exit/",line)) return;
+
+		//Throw exception on errors (except up-to-date)
+		//p4 -s is unpredicatable. For example a server down
+		//does not return error: markup
+		//
+		//Some forms producing commands (p4 -s change -o) do tag the output
+		//others don't.....
+		//Others mark errors as info, for example edit a file
+		//which is already open for edit.....
+		//Just look for error: - catches most things....
+
+		if(parent.util.match("/error:/", line) && !parent.util.match("/up-to-date/", line)) {
+			throw new BuildException(line);
+	
+		} 
+
+		parent.log(parent.util.substitute("s/^.*: //",line), Project.MSG_INFO);
+		
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/package.html b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/package.html
new file mode 100644
index 0000000..99e3183
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/perforce/package.html
@@ -0,0 +1,25 @@
+<body>
+ANT Tasks for Perforce integration.
+
+These tasks provide basic P4 capabilities to automated ANT-based build systems. <b>Note:</b> 
+the tasks in this package are linked against the Jakarta ORO 2.0 library which
+brings the power of Perl 5 regular expressions to Java.
+
+These tasks also require you to have the p4 (or p4.exe) client in your path.
+
+@see <A HREF="http://jakarta.apache.org/">Jakarta Project</A>
+@see <A HREF="http://www.perforce.com/">Perforce</A>
+
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Sync
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Label
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Have
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Change
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Edit
+@see org.apache.tools.ant.taskdefs.optional.perforce.P4Submit
+
+
+
+@author <A HREF="mailto:leslie.hughes@rubus.com">Les Hughes</A>
+
+
+</body>
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/scm/AntStarTeamCheckOut.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/scm/AntStarTeamCheckOut.java
index db1b598..5111b25 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/scm/AntStarTeamCheckOut.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/scm/AntStarTeamCheckOut.java
@@ -1,5 +1,4 @@
-/* ====================================================================
- * 
+/* 
  * The Apache Software License, Version 1.1
  *
  * Copyright (c) 1999 The Apache Software Foundation.  All rights 
@@ -24,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,11 +54,11 @@
  */
 package org.apache.tools.ant.taskdefs.optional.scm; 
  
-import org.apache.tools.ant.*;
-import java.io.*;
-import java.util.*;
 import com.starbase.starteam.*;
 import com.starbase.util.Platform;
+import java.io.*;
+import java.util.*;
+import org.apache.tools.ant.*;
 
 /**
  * Checks out files from a specific StarTeam server, project, view, and
@@ -105,1307 +104,1317 @@ import com.starbase.util.Platform;
  */
 public class AntStarTeamCheckOut extends org.apache.tools.ant.Task 
 {
-
-	/**
-	 * By default, <CODE>force</CODE> is set to "false" through this field.
-	 * If you set <CODE>force</CODE> to "true," AntStarTeamCheckOut will
-	 * overwrite files in the target directory. If the target directory does
-	 * not exist, the <CODE>force</CODE> setting does nothing. Note that
-	 * <CODE>DEFAULT_FORCESETTING</CODE> and <CODE>force</CODE> are strings,
-	 * not boolean values. See the links below for more information.
-	 * 
-	 * @see #getForce()
-	 * @see #getForceAsBoolean()
-	 * @see #setForce(String force)
-	 */
-	static public final String DEFAULT_FORCESETTING = "false";
-
-	/**
-	 * This field is used in setting <CODE>verbose</CODE> to "false", the
-	 * default. If <CODE>verbose</CODE> is true, AntStarTeamCheckOut will
-	 * display file and directory names as it checks files out. The default
-	 * setting displays only a total. Note that
-	 * <CODE>DEFAULT_VERBOSESETTING</CODE> and <CODE>verbose</CODE> are
-	 * strings, not boolean values. See the links below for more
-	 * information.
-	 * 
-	 * @see #getVerbose()
-	 * @see #getVerboseAsBoolean()
-	 * @see #setVerbose(String verbose)
-	 */
-	static public final String DEFAULT_VERBOSESETTING = "false";
-
-	/**
-	 * <CODE>DEFAULT_RECURSIONSETTING</CODE> contains the normal setting --
-	 * true -- for recursion.  Thus, if you do not
-	 * <CODE>setRecursion("false")</CODE> somewhere in your program,
-	 * AntStarTeamCheckOut will check files out from all subfolders as well
-	 * as from the given folder.
-	 * 
-	 * @see #getRecursion()
-	 * @see #setRecursion(String recursion)
-	 */
-	static public final String DEFAULT_RECURSIONSETTING = "true";
-
-	/**
-	 * This constant sets the filter to include all files. This default has
-	 * the same result as <CODE>setIncludes("*")</CODE>.
-	 * 
-	 * @see #getIncludes()
-	 * @see #setIncludes(String includes)
-	 */
-	static public final String DEFAULT_INCLUDESETTING = "*";
-
-	/**
-	 * This disables the exclude filter by default. In other words, no files
-	 * are excluded. This setting is equivalent to
-	 * <CODE>setExcludes(null)</CODE>.
-	 * 
-	 * @see #getExcludes()
-	 * @see #setExcludes(String excludes)
-	 */
-	static public final String DEFAULT_EXCLUDESETTING = null;
-
-	/**
-	 * The default folder to search; the root folder.  Since
-	 * AntStarTeamCheckOut searches subfolders, by default it processes an
-	 * entire view.
-	 * 
-	 * @see #getFolderName()
-	 * @see #setFolderName(String folderName)
-	 */
-	static public final String DEFAULT_FOLDERSETTING = null;
-
-
-	/**
-	 * This is used when formatting the output. The directory name is
-	 * displayed only when it changes.
-	 */
-	private Folder prevFolder = null;
-
-	/**
-	 * This field keeps count of the number of files checked out.
-	 */
-	private int checkedOut;
-
-	// Change these through their GET and SET methods.
-
-	/**
-	 * The name of the server you wish to connect to.
-	 */
-	private String serverName = null;
-
-	/**
-	 * The port on the server used for StarTeam.
-	 */
-	private String serverPort = null;
-
-	/**
-	 * The name of your project.
-	 */
-	private String projectName = null;
-
-	/**
-	 * The name of the folder you want to check out files from. All
-	 * subfolders will be searched, as well.
-	 */
-	private String folderName = DEFAULT_FOLDERSETTING;
-
-	/**
-	 * The view that the files you want are in.
-	 */
-	private String viewName = null;
-
-	/**
-	 * Your username on the StarTeam server.
-	 */
-	private String username = null;
-
-	/**
-	 * Your StarTeam password.
-	 */
-	private String password = null;
-
-	/**
-	 * The path to the root folder you want to check out to. This is a local
-	 * directory.
-	 */
-	private String targetFolder = null;
-
-	/**
-	 * If force set to true, AntStarTeamCheckOut will overwrite files in the
-	 * target directory.
-	 */
-	private String force = DEFAULT_FORCESETTING;
-
-	/**
-	 * When verbose is true, the program will display all files and
-	 * directories as they are checked out.
-	 */
-	private String verbose = DEFAULT_VERBOSESETTING;
-
-	/**
-	 * Set recursion to false to check out files in only the given folder
-	 * and not in its subfolders.
-	 */
-	private String recursion = DEFAULT_RECURSIONSETTING;
-
-	// These fields deal with includes and excludes
-
-	/**
-	 * All files that fit this pattern are checked out.
-	 */
-	private String includes = DEFAULT_INCLUDESETTING;
-
-	/**
-	 * All files fitting this pattern are ignored.
-	 */
-	private String excludes = DEFAULT_EXCLUDESETTING;
-
-	/**
-	 * The file delimitor on the user's system.
-	 */
-	private String delim = Platform.getFilePathDelim();
-
-	/**
-	 * Do the execution.
-	 * 
-	 * @exception BuildException
-	 */
-	public void execute() throws BuildException
-	{
-
-		// Check all of the properties that are required.
-		if ( getServerName() == null )
-		{
-			project.log("ServerName must not be null.");
-			return;
-		}
-		if ( getServerPort() == null )
-		{
-			project.log("ServerPort must not be null.");
-			return;
-		}
-		if ( getProjectName() == null )
-		{
-			project.log("ProjectName must not be null.");
-			return;
-		}
-		if ( getViewName() == null )
-		{
-			project.log("ViewName must not be null.");
-			return;
-		}
-		if ( getUsername() == null )
-		{
-			project.log("Username must not be null.");
-			return;
-		}
-		if ( getPassword() == null )
-		{
-			project.log("Password must not be null.");
-			return;
-		}
-		if ( getTargetFolder() == null )
-		{
-			project.log("TargetFolder must not be null.");
-			return;
-		}
-
-		// Because of the way I create the full target path, there must be NO slash at the end of targetFolder and folderName
-		// However, if the slash or backslash is the only character, leave it alone
-		if (!(getTargetFolder()==null))
-		{
-			if ((getTargetFolder().endsWith("/") || getTargetFolder().endsWith("\\")) && getTargetFolder().length() > 1)
-			{
-				setTargetFolder(getTargetFolder().substring(0, getTargetFolder().length() - 1));
-			}
-		}
-
-		if (!(getFolderName()==null))
-		{
-			if ((getFolderName().endsWith("/") || getFolderName().endsWith("\\")) && getFolderName().length() > 1)
-			{
-				setFolderName(getFolderName().substring(0, getFolderName().length() - 1));
-			}
-		}
-
-		// Check to see if the target directory exists.
-		java.io.File dirExist = new java.io.File(getTargetFolder());
-		if (dirExist.isDirectory() && !getForceAsBoolean())
-		{
-			project.log("Target directory exists. Set \"force\" to \"true\" to continue anyway.");
-			return;
-		}
-
-		try
-		{
-			// Connect to the StarTeam server, and log on.
-			Server s = getServer();
-
-			// Search the items on this server.
-			runServer(s);
-
-			// Disconnect from the server.
-			s.disconnect();
-
-			// after you are all of the properties are ok, do your thing
-			// with StarTeam.  If there are any kind of exceptions then
-			// send the message to the project log.
-
-			// Tell how many files were checked out.
-			project.log(checkedOut + " files checked out.");
-		}
-		catch (Throwable e)
-		{
-			project.log("    " + e.getMessage());
-		}
-	}
-
-	/**
-	 * Creates and logs in to a StarTeam server.
-	 * 
-	 * @return A StarTeam server.
-	 */
-	protected Server getServer()
-	{
-		// Simplest constructor, uses default encryption algorithm and compression level.
-		Server s = new Server(getServerName(), getServerPortAsInt());
-
-		// Optional; logOn() connects if necessary.
-		s.connect();
-
-		// Logon using specified user name and password.
-		s.logOn(getUsername(), getPassword());
-
-		return s;
-	}
-
-	/**
-	 * Searches for the specified project on the server.
-	 * 
-	 * @param s      A StarTeam server.
-	 */
-	protected void runServer(Server s)
-	{
-
-		com.starbase.starteam.Project[] projects = s.getProjects();
-		for (int i = 0; i < projects.length; i++)
-		{
-			com.starbase.starteam.Project p = projects[i];
-
-			if (p.getName().equals(getProjectName()))
-			{
-				if (getVerboseAsBoolean())
-				{
-					project.log("Found " + getProjectName() + delim);
-				}
-				runProject(s, p);
-				break;
-			}
-		}
-	}
-
-	/**
-	 * Searches for the given view in the project.
-	 * 
-	 * @param s      A StarTeam server.
-	 * @param p      A valid project on the given server.
-	 */
-	protected void runProject(Server s, com.starbase.starteam.Project p)
-	{
-		View[] views = p.getViews();
-		for (int i = 0; i < views.length; i++)
-		{
-			View v = views[i];
-			if (v.getName().equals(getViewName()))
-			{
-				if (getVerboseAsBoolean())
-				{
-					project.log("Found " + getProjectName() + delim + getViewName() + delim);
-				}
-				runType(s, p, v, s.typeForName((String)s.getTypeNames().FILE));
-				break;
-			}
-		}
-	}
-
-	/**
-	 * Searches for folders in the given view.
-	 * 
-	 * @param s      A StarTeam server.
-	 * @param p      A valid project on the server.
-	 * @param v      A view name from the specified project.
-	 * @param t      An item type which is currently always "file".
-	 */
-	protected void runType(Server s, com.starbase.starteam.Project p, View v, Type t)
-	{
-
-		// This is ugly; checking for the root folder.
-		Folder f = v.getRootFolder();
-		if (!(getFolderName()==null))
-		{
-			if (getFolderName().equals("\\") || getFolderName().equals("/"))
-			{
-				setFolderName(null);
-			}
-			else
-			{
-				f = StarTeamFinder.findFolder(v.getRootFolder(), getFolderName());
-			}
-		}
-
-		if (getVerboseAsBoolean() && !(getFolderName()==null))
-		{
-			project.log("Found " + getProjectName() + delim + getViewName() + delim + getFolderName() + delim + "\n");
-		}
-
-		// For performance reasons, it is important to pre-fetch all the
-		// properties we'll need for all the items we'll be searching.
-
-		// We always display the ItemID (OBJECT_ID) and primary descriptor.
-		int nProperties = 2;
-
-		// We'll need this item type's primary descriptor.
-		Property p1 = getPrimaryDescriptor(t);
-
-		// Does this item type have a secondary descriptor?
-		// If so, we'll need it.
-		Property p2 = getSecondaryDescriptor(t);
-		if (p2 != null)
-		{
-			nProperties++;
-		}
-
-		// Now, build an array of the property names.
-		String[] strNames = new String[nProperties];
-		int iProperty = 0;
-		strNames[iProperty++] = s.getPropertyNames().OBJECT_ID;
-		strNames[iProperty++] = p1.getName();
-		if (p2 != null)
-		{
-			strNames[iProperty++] = p2.getName();
-		}
-
-		// Pre-fetch the item properties and cache them.
-		f.populateNow(t.getName(), strNames, -1);
-
-		// Now, search for items in the selected folder.
-		runFolder(s, p, v, t, f);
-
-		// Free up the memory used by the cached items.
-		f.discardItems(t.getName(), -1);
-	}
-
-	/**
-	 * Searches for files in the given folder.  This method is recursive and
-	 * thus searches all subfolders.
-	 * 
-	 * @param s      A StarTeam server.
-	 * @param p      A valid project on the server.
-	 * @param v      A view name from the specified project.
-	 * @param t      An item type which is currently always "file".
-	 * @param f      The folder to search.
-	 */
-	protected void runFolder(Server s, com.starbase.starteam.Project p, View v, Type t, Folder f)
-	{
-
-		// Process all items in this folder.
-		Item[] items = f.getItems(t.getName());
-		for (int i = 0; i < items.length; i++)
-		{
-			runItem(s, p, v, t, f, items[i]);
-		}
-
-		// Process all subfolders recursively if recursion is on.
-		if (getRecursionAsBoolean())
-		{
-			Folder[] subfolders = f.getSubFolders();
-			for (int i = 0; i < subfolders.length; i++)
-			{
-				runFolder(s, p, v, t, subfolders[i]);
-			}
-		}
-	}
-
-	/**
-	 * Check out one file if it matches the include filter but not the
-	 * exclude filter.
-	 * 
-	 * @param s      A StarTeam server.
-	 * @param p      A valid project on the server.
-	 * @param v      A view name from the specified project.
-	 * @param t      An item type which is currently always "file".
-	 * @param f      The folder the file is localed in.
-	 * @param item   The file to check out.
-	 */
-	protected void runItem(Server s, com.starbase.starteam.Project p, View v, Type t, Folder f, Item item)
-	{
-
-		// Get descriptors for this item type.
-		Property p1 = getPrimaryDescriptor(t);
-		Property p2 = getSecondaryDescriptor(t);
-
-		// Time to filter...
-		String pName = (String)item.get(p1.getName());
-		boolean includeIt = false;
-		boolean excludeIt = false;
-
-		// See if it fits any includes.
-		if (getIncludes()!=null)
-		{
-			StringTokenizer inStr = new StringTokenizer(getIncludes(), " ");
-			while (inStr.hasMoreTokens())
-			{
-				if (match(inStr.nextToken(), pName))
-				{
-					includeIt = true;
-				}
-			}
-		}
-
-		// See if it fits any excludes.
-		if (getExcludes()!=null)
-		{
-			StringTokenizer exStr = new StringTokenizer(getExcludes(), " ");
-			while (exStr.hasMoreTokens())
-			{
-				if (match(exStr.nextToken(), pName))
-				{
-					excludeIt = true;
-				}
-			}
-		}
-
-		// Don't check it out if
-		// (a) It fits no include filters
-		// (b) It fits an exclude filter
-		if (!includeIt | excludeIt)
-		{
-			return;
-		}
-
-		// VERBOSE MODE ONLY
-		if (getVerboseAsBoolean())
-		{
-			// Show folder only if changed.
-			boolean bShowHeader = true;
-			if (f != prevFolder)
-			{
-				// We want to display the folder the same way you would
-				// enter it on the command line ... so we remove the 
-				// View name (which is also the name of the root folder,
-				// and therefore shows up at the start of the path).
-				String strFolder = f.getFolderHierarchy();
-				int i = strFolder.indexOf(delim);
-				if (i >= 0)
-				{
-					strFolder = strFolder.substring(i+1);
-				}
-				System.out.println("            Folder: \"" + strFolder + "\"");
-				prevFolder = f;
-			}
-			else
-				bShowHeader	= false;
-
-			// If we displayed the project, view, item type, or folder,
-			// then show the list of relevant item properties.
-			if (bShowHeader)
-			{
-				System.out.print("                Item");
-				System.out.print(",\t" + p1.getDisplayName());
-				if (p2 != null)
-				{
-					System.out.print(",\t" + p2.getDisplayName());
-				}
-				System.out.println("");
-			}
-
-			// Finally, show the Item properties ...
-
-			// Always show the ItemID.
-			System.out.print("                " + item.getItemID());
-
-			// Show the primary descriptor.
-			// There should always be one.
-			System.out.print(",\t" + formatForDisplay(p1, item.get(p1.getName())));
-
-			// Show the secondary descriptor, if there is one.
-			// Some item types have one, some don't.
-			if (p2 != null)
-			{
-				System.out.print(",\t" + formatForDisplay(p2, item.get(p2.getName())));
-			}
-
-			// Show if the file is locked.
-			int locker = item.getLocker();
-			if (locker>-1)
-			{
-				System.out.println(",\tLocked by " + locker);
-			}
-			else
-			{
-				System.out.println(",\tNot locked");
-			}
-		}
-		// END VERBOSE ONLY
-
-		// Check it out; also ugly.
-
-		// Change the item to be checked out to a StarTeam File.
-		com.starbase.starteam.File remote = (com.starbase.starteam.File)item;
-
-		// Create a variable dirName that contains the name of the StarTeam folder that is the root folder in this view.
-		// Get the default path to the current view.
-		String dirName = v.getDefaultPath();
-		// Settle on "/" as the default path separator for this purpose only.
-		dirName = dirName.replace('\\', '/');
-                // Take the StarTeam folder name furthest down in the hierarchy.
-                int endDirIndex = dirName.length();
-                // If it ends with separator then strip it off
-                if (dirName.endsWith("/"))
+    /**
+     * By default, <CODE>force</CODE> is set to "false" through this field.
+     * If you set <CODE>force</CODE> to "true," AntStarTeamCheckOut will
+     * overwrite files in the target directory. If the target directory does
+     * not exist, the <CODE>force</CODE> setting does nothing. Note that
+     * <CODE>DEFAULT_FORCESETTING</CODE> and <CODE>force</CODE> are strings,
+     * not boolean values. See the links below for more information.
+     * 
+     * @see #getForce()
+     * @see #getForceAsBoolean()
+     * @see #setForce(String force)
+     */
+    static public final String DEFAULT_FORCESETTING = "false";
+
+    /**
+     * This field is used in setting <CODE>verbose</CODE> to "false", the
+     * default. If <CODE>verbose</CODE> is true, AntStarTeamCheckOut will
+     * display file and directory names as it checks files out. The default
+     * setting displays only a total. Note that
+     * <CODE>DEFAULT_VERBOSESETTING</CODE> and <CODE>verbose</CODE> are
+     * strings, not boolean values. See the links below for more
+     * information.
+     * 
+     * @see #getVerbose()
+     * @see #getVerboseAsBoolean()
+     * @see #setVerbose(String verbose)
+     */
+    static public final String DEFAULT_VERBOSESETTING = "false";
+
+    /**
+     * <CODE>DEFAULT_RECURSIONSETTING</CODE> contains the normal setting --
+     * true -- for recursion.  Thus, if you do not
+     * <CODE>setRecursion("false")</CODE> somewhere in your program,
+     * AntStarTeamCheckOut will check files out from all subfolders as well
+     * as from the given folder.
+     * 
+     * @see #getRecursion()
+     * @see #setRecursion(String recursion)
+     */
+    static public final String DEFAULT_RECURSIONSETTING = "true";
+
+    /**
+     * This constant sets the filter to include all files. This default has
+     * the same result as <CODE>setIncludes("*")</CODE>.
+     * 
+     * @see #getIncludes()
+     * @see #setIncludes(String includes)
+     */
+    static public final String DEFAULT_INCLUDESETTING = "*";
+
+    /**
+     * This disables the exclude filter by default. In other words, no files
+     * are excluded. This setting is equivalent to
+     * <CODE>setExcludes(null)</CODE>.
+     * 
+     * @see #getExcludes()
+     * @see #setExcludes(String excludes)
+     */
+    static public final String DEFAULT_EXCLUDESETTING = null;
+
+    /**
+     * The default folder to search; the root folder.  Since
+     * AntStarTeamCheckOut searches subfolders, by default it processes an
+     * entire view.
+     * 
+     * @see #getFolderName()
+     * @see #setFolderName(String folderName)
+     */
+    static public final String DEFAULT_FOLDERSETTING = null;
+
+    /**
+     * This is used when formatting the output. The directory name is
+     * displayed only when it changes.
+     */
+    private Folder prevFolder = null;
+
+    /**
+     * This field keeps count of the number of files checked out.
+     */
+    private int checkedOut;
+
+    // Change these through their GET and SET methods.
+    
+    /**
+     * The name of the server you wish to connect to.
+     */
+    private String serverName = null;
+
+    /**
+     * The port on the server used for StarTeam.
+     */
+    private String serverPort = null;
+
+    /**
+     * The name of your project.
+     */
+    private String projectName = null;
+
+    /**
+     * The name of the folder you want to check out files from. All
+     * subfolders will be searched, as well.
+     */
+    private String folderName = DEFAULT_FOLDERSETTING;
+
+    /**
+     * The view that the files you want are in.
+     */
+    private String viewName = null;
+
+    /**
+     * Your username on the StarTeam server.
+     */
+    private String username = null;
+
+    /**
+     * Your StarTeam password.
+     */
+    private String password = null;
+
+    /**
+     * The path to the root folder you want to check out to. This is a local
+     * directory.
+     */
+    private String targetFolder = null;
+
+    /**
+     * If force set to true, AntStarTeamCheckOut will overwrite files in the
+     * target directory.
+     */
+    private String force = DEFAULT_FORCESETTING;
+
+    /**
+     * When verbose is true, the program will display all files and
+     * directories as they are checked out.
+     */
+    private String verbose = DEFAULT_VERBOSESETTING;
+
+    /**
+     * Set recursion to false to check out files in only the given folder
+     * and not in its subfolders.
+     */
+    private String recursion = DEFAULT_RECURSIONSETTING;
+
+    // These fields deal with includes and excludes
+
+    /**
+     * All files that fit this pattern are checked out.
+     */
+    private String includes = DEFAULT_INCLUDESETTING;
+
+    /**
+     * All files fitting this pattern are ignored.
+     */
+    private String excludes = DEFAULT_EXCLUDESETTING;
+    
+    /**
+     * The file delimitor on the user's system.
+     */
+    private String delim = Platform.getFilePathDelim();
+    
+    /**
+     * Do the execution.
+     * 
+     * @exception BuildException
+     */
+    public void execute() throws BuildException
+    {
+        // Check all of the properties that are required.
+        if ( getServerName() == null )
+        {
+            project.log("ServerName must not be null.");
+            return;
+        }
+        if ( getServerPort() == null )
+        {
+            project.log("ServerPort must not be null.");
+            return;
+        }
+        if ( getProjectName() == null )
+        {
+            project.log("ProjectName must not be null.");
+            return;
+        }
+        if ( getViewName() == null )
+        {
+            project.log("ViewName must not be null.");
+            return;
+        }
+        if ( getUsername() == null )
+        {
+            project.log("Username must not be null.");
+            return;
+        }
+        if ( getPassword() == null )
+        {
+            project.log("Password must not be null.");
+            return;
+        }
+        if ( getTargetFolder() == null )
+        {
+            project.log("TargetFolder must not be null.");
+            return;
+        }
+
+        // Because of the way I create the full target path, there
+        // must be NO slash at the end of targetFolder and folderName
+        // However, if the slash or backslash is the only character, leave it alone
+        if (null != getTargetFolder())
+        {
+            if ((getTargetFolder().endsWith("/") || 
+                 getTargetFolder().endsWith("\\")) && getTargetFolder().length() > 1)
+            {
+                setTargetFolder(getTargetFolder().substring(0, getTargetFolder().length() - 1));
+            }
+        }
+
+        if ( null != getFolderName() )
+        {
+            if ((getFolderName().endsWith("/") || 
+                 getFolderName().endsWith("\\")) && getFolderName().length() > 1)
+            {
+                setFolderName(getFolderName().substring(0, getFolderName().length() - 1));
+            }
+        }
+
+        // Check to see if the target directory exists.
+        java.io.File dirExist = new java.io.File(getTargetFolder());
+        if (dirExist.isDirectory() && !getForceAsBoolean())
+        {
+            project.log( "Target directory exists. Set \"force\" to \"true\" " +
+                         "to continue anyway." );
+            return;
+        }
+
+        try
+        {
+            // Connect to the StarTeam server, and log on.
+            Server s = getServer();
+
+            // Search the items on this server.
+            runServer(s);
+
+            // Disconnect from the server.
+            s.disconnect();
+
+            // after you are all of the properties are ok, do your thing
+            // with StarTeam.  If there are any kind of exceptions then
+            // send the message to the project log.
+
+            // Tell how many files were checked out.
+            project.log(checkedOut + " files checked out.");
+        }
+        catch (Throwable e)
+        {
+            project.log("    " + e.getMessage());
+        }
+    }
+
+    /**
+     * Creates and logs in to a StarTeam server.
+     * 
+     * @return A StarTeam server.
+     */
+    protected Server getServer()
+    {
+        // Simplest constructor, uses default encryption algorithm and compression level.
+        Server s = new Server(getServerName(), getServerPortAsInt());
+
+        // Optional; logOn() connects if necessary.
+        s.connect();
+
+        // Logon using specified user name and password.
+        s.logOn(getUsername(), getPassword());
+
+        return s;
+    }
+
+    /**
+     * Searches for the specified project on the server.
+     * 
+     * @param s      A StarTeam server.
+     */
+    protected void runServer(Server s)
+    {
+        com.starbase.starteam.Project[] projects = s.getProjects();
+        for (int i = 0; i < projects.length; i++)
+        {
+            com.starbase.starteam.Project p = projects[i];
+            
+            if (p.getName().equals(getProjectName()))
+            {
+                if (getVerboseAsBoolean())
                 {
-                    // This should be the SunOS and Linux case
-                    endDirIndex--;
+                    project.log("Found " + getProjectName() + delim);
                 }
-		dirName = dirName.substring(dirName.lastIndexOf("/", dirName.length() - 2) + 1, endDirIndex);
+                runProject(s, p);
+                break;
+            }
+        }
+    }
+
+    /**
+     * Searches for the given view in the project.
+     * 
+     * @param s      A StarTeam server.
+     * @param p      A valid project on the given server.
+     */
+    protected void runProject(Server s, com.starbase.starteam.Project p)
+    {
+        View[] views = p.getViews();
+        for (int i = 0; i < views.length; i++)
+        {
+            View v = views[i];
+            if (v.getName().equals(getViewName()))
+            {
+                if (getVerboseAsBoolean())
+                {
+                    project.log("Found " + getProjectName() + delim + getViewName() + delim);
+                }
+                runType(s, p, v, s.typeForName((String)s.getTypeNames().FILE));
+                break;
+            }
+        }
+    }
+
+    /**
+     * Searches for folders in the given view.
+     * 
+     * @param s      A StarTeam server.
+     * @param p      A valid project on the server.
+     * @param v      A view name from the specified project.
+     * @param t      An item type which is currently always "file".
+     */
+    protected void runType(Server s, com.starbase.starteam.Project p, View v, Type t)
+    {
+        // This is ugly; checking for the root folder.
+        Folder f = v.getRootFolder();
+        if (!(getFolderName()==null))
+        {
+            if (getFolderName().equals("\\") || getFolderName().equals("/"))
+            {
+                setFolderName(null);
+            }
+            else
+            {
+                f = StarTeamFinder.findFolder(v.getRootFolder(), getFolderName());
+            }
+        }
+
+        if (getVerboseAsBoolean() && !(getFolderName()==null))
+        {
+            project.log( "Found " + getProjectName() + delim + getViewName() + 
+                         delim + getFolderName() + delim + "\n" );
+        }
+
+        // For performance reasons, it is important to pre-fetch all the
+        // properties we'll need for all the items we'll be searching.
+
+        // We always display the ItemID (OBJECT_ID) and primary descriptor.
+        int nProperties = 2;
+
+        // We'll need this item type's primary descriptor.
+        Property p1 = getPrimaryDescriptor(t);
+
+        // Does this item type have a secondary descriptor?
+        // If so, we'll need it.
+        Property p2 = getSecondaryDescriptor(t);
+        if (p2 != null)
+        {
+            nProperties++;
+        }
+
+        // Now, build an array of the property names.
+        String[] strNames = new String[nProperties];
+        int iProperty = 0;
+        strNames[iProperty++] = s.getPropertyNames().OBJECT_ID;
+        strNames[iProperty++] = p1.getName();
+        if (p2 != null)
+        {
+            strNames[iProperty++] = p2.getName();
+        }
+
+        // Pre-fetch the item properties and cache them.
+        f.populateNow(t.getName(), strNames, -1);
+
+        // Now, search for items in the selected folder.
+        runFolder(s, p, v, t, f);
+
+        // Free up the memory used by the cached items.
+        f.discardItems(t.getName(), -1);
+    }
+
+    /**
+     * Searches for files in the given folder.  This method is recursive and
+     * thus searches all subfolders.
+     * 
+     * @param s      A StarTeam server.
+     * @param p      A valid project on the server.
+     * @param v      A view name from the specified project.
+     * @param t      An item type which is currently always "file".
+     * @param f      The folder to search.
+     */
+    protected void runFolder( Server s, 
+                              com.starbase.starteam.Project p, 
+                              View v, 
+                              Type t, 
+                              Folder f )
+    {
+        // Process all items in this folder.
+        Item[] items = f.getItems(t.getName());
+        for (int i = 0; i < items.length; i++)
+        {
+            runItem(s, p, v, t, f, items[i]);
+        }
+
+        // Process all subfolders recursively if recursion is on.
+        if (getRecursionAsBoolean())
+        {
+            Folder[] subfolders = f.getSubFolders();
+            for (int i = 0; i < subfolders.length; i++)
+            {
+                runFolder(s, p, v, t, subfolders[i]);
+            }
+        }
+    }
+
+    /**
+     * Check out one file if it matches the include filter but not the
+     * exclude filter.
+     * 
+     * @param s      A StarTeam server.
+     * @param p      A valid project on the server.
+     * @param v      A view name from the specified project.
+     * @param t      An item type which is currently always "file".
+     * @param f      The folder the file is localed in.
+     * @param item   The file to check out.
+     */
+    protected void runItem( Server s, 
+                            com.starbase.starteam.Project p, 
+                            View v, 
+                            Type t, 
+                            Folder f, 
+                            Item item )
+    {
+        // Get descriptors for this item type.
+        Property p1 = getPrimaryDescriptor(t);
+        Property p2 = getSecondaryDescriptor(t);
+
+        // Time to filter...
+        String pName = (String)item.get(p1.getName());
+        boolean includeIt = false;
+        boolean excludeIt = false;
+
+        // See if it fits any includes.
+        if (getIncludes()!=null)
+        {
+            StringTokenizer inStr = new StringTokenizer(getIncludes(), " ");
+            while (inStr.hasMoreTokens())
+            {
+                if (match(inStr.nextToken(), pName))
+                {
+                    includeIt = true;
+                }
+            }
+        }
+
+        // See if it fits any excludes.
+        if (getExcludes()!=null)
+        {
+            StringTokenizer exStr = new StringTokenizer(getExcludes(), " ");
+            while (exStr.hasMoreTokens())
+            {
+                if (match(exStr.nextToken(), pName))
+                {
+                    excludeIt = true;
+                }
+            }
+        }
+
+        // Don't check it out if
+        // (a) It fits no include filters
+        // (b) It fits an exclude filter
+        if (!includeIt | excludeIt)
+        {
+            return;
+        }
+
+        // VERBOSE MODE ONLY
+        if (getVerboseAsBoolean())
+        {
+            // Show folder only if changed.
+            boolean bShowHeader = true;
+            if (f != prevFolder)
+            {
+                // We want to display the folder the same way you would
+                // enter it on the command line ... so we remove the 
+                // View name (which is also the name of the root folder,
+                // and therefore shows up at the start of the path).
+                String strFolder = f.getFolderHierarchy();
+                int i = strFolder.indexOf(delim);
+                if (i >= 0)
+                {
+                    strFolder = strFolder.substring(i+1);
+                }
+                System.out.println("            Folder: \"" + strFolder + "\"");
+                prevFolder = f;
+            }
+            else
+                bShowHeader        = false;
+
+            // If we displayed the project, view, item type, or folder,
+            // then show the list of relevant item properties.
+            if (bShowHeader)
+            {
+                System.out.print("                Item");
+                System.out.print(",\t" + p1.getDisplayName());
+                if (p2 != null)
+                {
+                    System.out.print(",\t" + p2.getDisplayName());
+                }
+                System.out.println("");
+            }
+
+            // Finally, show the Item properties ...
+
+            // Always show the ItemID.
+            System.out.print("                " + item.getItemID());
+
+            // Show the primary descriptor.
+            // There should always be one.
+            System.out.print(",\t" + formatForDisplay(p1, item.get(p1.getName())));
+
+            // Show the secondary descriptor, if there is one.
+            // Some item types have one, some don't.
+            if (p2 != null)
+            {
+                System.out.print(",\t" + formatForDisplay(p2, item.get(p2.getName())));
+            }
+
+            // Show if the file is locked.
+            int locker = item.getLocker();
+            if (locker>-1)
+            {
+                System.out.println(",\tLocked by " + locker);
+            }
+            else
+            {
+                System.out.println(",\tNot locked");
+            }
+        }
+        // END VERBOSE ONLY
+
+        // Check it out; also ugly.
+
+        // Change the item to be checked out to a StarTeam File.
+        com.starbase.starteam.File remote = (com.starbase.starteam.File)item;
+
+        // Create a variable dirName that contains the name of 
+        //the StarTeam folder that is the root folder in this view.
+        // Get the default path to the current view.
+        String dirName = v.getDefaultPath();
+        // Settle on "/" as the default path separator for this purpose only.
+        dirName = dirName.replace('\\', '/');
+        // Take the StarTeam folder name furthest down in the hierarchy.
+        int endDirIndex = dirName.length();
+        // If it ends with separator then strip it off
+        if (dirName.endsWith("/"))
+        {
+            // This should be the SunOS and Linux case
+            endDirIndex--;
+        }
+        dirName = 
+            dirName.substring(dirName.lastIndexOf("/", dirName.length() - 2) + 1, endDirIndex);
                 
-		// Replace the projectName in the file's absolute path to the viewName.
-		// This eventually makes the target of a checkout operation equal to:
-		// targetFolder + dirName + [subfolders] + itemName
-		StringTokenizer pathTokenizer = new StringTokenizer(item.getParentFolder().getFolderHierarchy(), delim);
-		String localName = delim;
-		String currentToken = null;
-		while (pathTokenizer.hasMoreTokens())
-		{
-			currentToken = pathTokenizer.nextToken();
-			if (currentToken.equals(getProjectName()))
-			{
-				currentToken = dirName;
-			}
-			localName += currentToken + delim;
-		}
-		// Create a reference to the local target file using the format listed above.
-		java.io.File local = new java.io.File(getTargetFolder() + localName + item.get(p1.getName()));
-		try
-		{
-			remote.checkoutTo(local, Item.LockType.UNCHANGED, false, true, true);
-		}
-		catch (Throwable e)
-		{
-			project.log("    " + e.getMessage());
-		}
-		checkedOut++;
-	}
-
-	/**
-	 * Get the primary descriptor of the given item type.
-	 *  Returns null if there isn't one.
-	 *  In practice, all item types have a primary descriptor.
-	 * 
-	 * @param t      An item type. At this point it will always be "file".
-	 * @return The specified item's primary descriptor.
-	 */
-	protected Property getPrimaryDescriptor(Type t)
-	{
-		Property[] properties = t.getProperties();
-		for (int i = 0; i < properties.length; i++)
-		{
-			Property p = properties[i];
-			if (p.isPrimaryDescriptor())
-			{
-				return p;
-			}
-		}
-		return null;
-	}
-
-	/**
-	 * Get the secondary descriptor of the given item type.
-	 * Returns null if there isn't one.
-	 * 
-	 * @param t      An item type. At this point it will always be "file".
-	 * @return The specified item's secondary descriptor. There may not be
-	 *         one for every file.
-	 */
-	protected Property getSecondaryDescriptor(Type t)
-	{
-		Property[] properties = t.getProperties();
-		for (int i = 0; i < properties.length; i++)
-		{
-			Property p = properties[i];
-			if (p.isDescriptor() && !p.isPrimaryDescriptor())
-			{
-				return p;
-			}
-		}
-		return null;
-	}
-
-	/**
-	 * Formats a property value for display to the user.
-	 * 
-	 * @param p      An item property to format.
-	 * @param value
-	 * @return A string containing the property, which is truncated to 35
-	 *         characters for display.
-	 */
-	protected String formatForDisplay(Property p, Object value)
-	{
-		if (p.getTypeCode() == Property.Types.TEXT)
-		{
-			String str = value.toString();
-			if (str.length() > 35)
-			{
-				str = str.substring(0, 32) + "...";
-			}
-			return "\"" + str + "\"";
-		}
-		else
-		{
-			if (p.getTypeCode() == Property.Types.ENUMERATED)
-			{
-				return "\"" + p.getEnumDisplayName(((Integer)value).intValue()) + "\"";
-			}
-			else
-			{
-				return value.toString();
-			}
-		}
-	}
-
-	// TORN STRAIGHT FROM ANT.DIRECTORYSCANNER
-
-	/**
-	 * <B>TORN STRAIGHT FROM ANT.DIRECTORYSCANNER</B>
-	 * 
-	 * Matches a string against a pattern. The pattern contains two special
-	 * characters:<BR>
-	 * '*' which means zero or more characters,<BR>
-	 * '?' which means one and only one character.
-	 * 
-	 * @param pattern the (non-null) pattern to match against
-	 * @param str     the (non-null) string that must be matched against the
-	 *                pattern
-	 * @return <code>true</code> when the string matches against the
-	 *         pattern, <code>false</code> otherwise.
-	 */
-	private static boolean match(String pattern, String str)
-	{
-		char[] patArr = pattern.toCharArray();
-		char[] strArr = str.toCharArray();
-		int patIdxStart = 0;
-		int patIdxEnd   = patArr.length-1;
-		int strIdxStart = 0;
-		int strIdxEnd   = strArr.length-1;
-		char ch;
-
-		boolean containsStar = false;
-		for (int i = 0; i < patArr.length; i++)
-		{
-			if (patArr[i] == '*')
-			{
-				containsStar = true;
-				break;
-			}
-		}
-
-		if (!containsStar)
-		{
-			// No '*'s, so we make a shortcut
-			if (patIdxEnd != strIdxEnd)
-			{
-				return false;	// Pattern and string do not have the same size
-			}
-			for (int i = 0; i <= patIdxEnd; i++)
-			{
-				ch = patArr[i];
-				if (ch != '?' && ch != strArr[i])
-				{
-					return false;	// Character mismatch
-				}
-			}
-			return true; // String matches against pattern
-		}
-
-		if (patIdxEnd == 0)
-		{
-			return true; // Pattern contains only '*', which matches anything
-		}
-
-		// Process characters before first star
-		while ((ch = patArr[patIdxStart]) != '*' && strIdxStart <= strIdxEnd)
-		{
-			if (ch != '?' && ch != strArr[strIdxStart])
-			{
-				return false;
-			}
-			patIdxStart++;
-			strIdxStart++;
-		}
-		if (strIdxStart > strIdxEnd)
-		{
-			// All characters in the string are used. Check if only '*'s are
-			// left in the pattern. If so, we succeeded. Otherwise failure.
-			for (int i = patIdxStart; i <= patIdxEnd; i++)
-			{
-				if (patArr[i] != '*')
-				{
-					return false;
-				}
-			}
-			return true;
-		}
-
-		// Process characters after last star
-		while ((ch = patArr[patIdxEnd]) != '*' && strIdxStart <= strIdxEnd)
-		{
-			if (ch != '?' && ch != strArr[strIdxEnd])
-			{
-				return false;
-			}
-			patIdxEnd--;
-			strIdxEnd--;
-		}
-		if (strIdxStart > strIdxEnd)
-		{
-			// All characters in the string are used. Check if only '*'s are
-			// left in the pattern. If so, we succeeded. Otherwise failure.
-			for (int i = patIdxStart; i <= patIdxEnd; i++)
-			{
-				if (patArr[i] != '*')
-				{
-					return false;
-				}
-			}
-			return true;
-		}
-
-		// process pattern between stars. padIdxStart and patIdxEnd point
-		// always to a '*'.
-		while (patIdxStart != patIdxEnd && strIdxStart <= strIdxEnd)
-		{
-			int patIdxTmp = -1;
-			for (int i = patIdxStart+1; i <= patIdxEnd; i++)
-			{
-				if (patArr[i] == '*')
-				{
-					patIdxTmp = i;
-					break;
-				}
-			}
-			if (patIdxTmp == patIdxStart+1)
-			{
-				// Two stars next to each other, skip the first one.
-				patIdxStart++;
-				continue;
-			}
-			// Find the pattern between padIdxStart & padIdxTmp in str between
-			// strIdxStart & strIdxEnd
-			int patLength = (patIdxTmp-patIdxStart-1);
-			int strLength = (strIdxEnd-strIdxStart+1);
-			int foundIdx  = -1;
-			strLoop:
-			for (int i = 0; i <= strLength - patLength; i++)
-			{
-				for (int j = 0; j < patLength; j++)
-				{
-					ch = patArr[patIdxStart+j+1];
-					if (ch != '?' && ch != strArr[strIdxStart+i+j])
-					{
-						continue strLoop;
-					}
-				}
-
-				foundIdx = strIdxStart+i;
-				break;
-			}
-
-			if (foundIdx == -1)
-			{
-				return false;
-			}
-
-			patIdxStart = patIdxTmp;
-			strIdxStart = foundIdx+patLength;
-		}
-
-		// All characters in the string are used. Check if only '*'s are left
-		// in the pattern. If so, we succeeded. Otherwise failure.
-		for (int i = patIdxStart; i <= patIdxEnd; i++)
-		{
-			if (patArr[i] != '*')
-			{
-				return false;
-			}
-		}
-		return true;
-	}
-
-	// Begin SET and GET methods	
-
-	/**
-	 * Sets the <CODE>serverName</CODE> attribute to the given value.
-	 * 
-	 * @param serverName The name of the server you wish to connect to.
-	 * @see #getServerName()
-	 */
-	public void setServerName(String serverName)
-	{
-		this.serverName = serverName;
-	}
-
-	/**
-	 * Gets the <CODE>serverName</CODE> attribute.
-	 * 
-	 * @return The StarTeam server to log in to.
-	 * @see #setServerName(String serverName)
-	 */
-	public String getServerName()
-	{
-		return serverName;
-	}
-
-	/**
-	 * Sets the <CODE>serverPort</CODE> attribute to the given value. The
-	 * given value must be a valid integer, but it must be a string object.
-	 * 
-	 * @param serverPort A string containing the port on the StarTeam server
-	 *                   to use.
-	 * @see #getServerPort()
-	 */
-	public void setServerPort(String serverPort)
-	{
-		this.serverPort = serverPort;
-	}
-
-	/**
-	 * Gets the <CODE>serverPort</CODE> attribute.
-	 * 
-	 * @return A string containing the port on the StarTeam server to use.
-	 * @see #getServerPortAsInt()
-	 * @see #setServerPort(String serverPort)
-	 */
-	public String getServerPort()
-	{
-		return serverPort;
-	}
-
-	/**
-	 * Gets the <CODE>serverPort</CODE> attribute as an integer.
-	 * 
-	 * @return An integer value for the port on the StarTeam server to use.
-	 * @see #getServerPort()
-	 * @see #setServerPort(String serverPort)
-	 */
-	public int getServerPortAsInt()
-	{
-		return Integer.parseInt(serverPort);
-	}
-
-	/**
-	 * Sets the <CODE>projectName</CODE> attribute to the given value.
-	 * 
-	 * @param projectName
-	 *               The StarTeam project to search.
-	 * @see #getProjectName()
-	 */
-	public void setProjectName(String projectName)
-	{
-		this.projectName = projectName;
-	}
-
-	/**
-	 * Gets the <CODE>projectName</CODE> attribute.
-	 * 
-	 * @return The StarTeam project to search.
-	 * @see #setProjectName(String projectName)
-	 */
-	public String getProjectName()
-	{
-		return projectName;
-	}
-
-	/**
-	 * Sets the <CODE>viewName</CODE> attribute to the given value.
-	 * 
-	 * @param viewName The view to find the specified folder in.
-	 * @see #getViewName()
-	 */
-	public void setViewName(String viewName)
-	{
-		this.viewName = viewName;
-	}
-
-	/**
-	 * Gets the <CODE>viewName</CODE> attribute.
-	 * 
-	 * @return The view to find the specified folder in.
-	 * @see #setViewName(String viewName)
-	 */
-	public String getViewName()
-	{
-		return viewName;
-	}
-
-	/**
-	 * Sets the <CODE>folderName</CODE> attribute to the given value. To
-	 * search the root folder, use a slash or backslash, or simply don't set
-	 * a folder at all.
-	 * 
-	 * @param folderName The subfolder from which to check out files.
-	 * @see #getFolderName()
-	 */
-	public void setFolderName(String folderName)
-	{
-		this.folderName = folderName;
-	}
-
-	/**
-	 * Gets the <CODE>folderName</CODE> attribute.
-	 *
-	 * @return The subfolder from which to check out files. All subfolders
-	 * will be searched, as well.
-	 * @see #setFolderName(String folderName)
-	 */
-	public String getFolderName()
-	{
-		return folderName;
-	}
-
-	/**
-	 * Sets the <CODE>username</CODE> attribute to the given value.
-	 * 
-	 * @param username Your username for the specified StarTeam server.
-	 * @see #getUsername()
-	 */
-	public void setUsername(String username)
-	{
-		this.username = username;
-	}
-
-	/**
-	 * Gets the <CODE>username</CODE> attribute.
-	 * 
-	 * @return The username given by the user.
-	 * @see #setUsername(String username)
-	 */
-	public String getUsername()
-	{
-		return username;
-	}
-
-	/**
-	 * Sets the <CODE>password</CODE> attribute to the given value.
-	 * 
-	 * @param password Your password for the specified StarTeam server.
-	 * @see #getPassword()
-	 */
-	public void setPassword(String password)
-	{
-		this.password = password;
-	}
-
-	/**
-	 * Gets the <CODE>password</CODE> attribute.
-	 * 
-	 * @return The password given by the user.
-	 * @see #setPassword(String password)
-	 */
-	public String getPassword()
-	{
-		return password;
-	}
-
-	/**
-	 * Sets the <CODE>targetFolder</CODE> attribute to the given value.
-	 * 
-	 * @param target The target path on the local machine to check out to.
-	 * @see #getTargetFolder()
-	 */
-	public void setTargetFolder(String targetFolder)
-	{
-		this.targetFolder = targetFolder;
-	}
-
-	/**
-	 * Gets the <CODE>targetFolder</CODE> attribute.
-	 * 
-	 * @return The target path on the local machine to check out to.
-	 *
-	 * @see #setTargetFolder(String targetFolder)
-	 */
-	public String getTargetFolder()
-	{
-		return targetFolder;
-	}
-
-	/**
-	 * Sets the <CODE>force</CODE> attribute to the given value.
-	 * 
-	 * @param force  A string containing "true" or "false" that tells the
-	 *               application whether to continue if the target directory
-	 *               exists.  If <CODE>force</CODE> is true,
-	 *               AntStarTeamCheckOut will overwrite files in the target
-	 *               directory.  By default it set to false as a safeguard.
-	 *               Note that if the target directory does not exist, this
-	 *               setting has no effect.
-	 * @see #DEFAULT_FORCESETTING
-	 * @see #getForce()
-	 * @see #getForceAsBoolean()
-	 */
-	public void setForce(String force)
-	{
-		this.force = force;
-	}
-
-	/**
-	 * Gets the <CODE>force</CODE> attribute.
-	 * 
-	 * @return A string containing "true" or "false" telling the application
-	 *         whether to continue if the target directory exists.  If
-	 *         <CODE>force</CODE> is true, AntStarTeamCheckOut will
-	 *         overwrite files in the target directory. If it is false and
-	 *         the target directory exists, AntStarTeamCheckOut will exit
-	 *         with a warning.  If the target directory does not exist, this
-	 *         setting has no effect. The default setting is false.
-	 * @see #DEFAULT_FORCESETTING
-	 * @see #getForceAsBoolean()
-	 * @see #setForce(String force)
-	 */
-	public String getForce()
-	{
-		return force;
-	}
-
-	/**
-	 * Gets the <CODE>force</CODE> attribute as a boolean value.
-	 * 
-	 * @return A boolean value telling whether to continue if the target
-	 *         directory exists.
-	 * @see #DEFAULT_FORCESETTING
-	 * @see #getForce()
-	 * @see #setForce(String force)
-	 */
-	public boolean getForceAsBoolean()
-	{
-		return project.toBoolean(force);
-	}
-
-	/**
-	 * Turns recursion on or off.
-	 *
-	 * @param verbose A string containing "true" or "false."  If it is true,
-	 *                the default, subfolders are searched recursively for
-	 *                files to check out.  Otherwise, only files specified
-	 *                by <CODE>folderName</CODE> are scanned.
-	 * @see #DEFAULT_RECURSIONSETTING
-	 * @see #getRecursion()
-	 * @see #getRecursionAsBoolean()
-	 */
-	public void setRecursion(String recursion)
-	{
-		this.recursion = recursion;
-	}
-
-	/**
-	 * Gets the <CODE>recursion</CODE> attribute, which tells
-	 * AntStarTeamCheckOut whether to search subfolders when checking out
-	 * files.
-	 *
-	 * @return A string telling whether <CODE>recursion</CODE> is "true" or
-	 * "false."
-	 *
-	 * @see #DEFAULT_RECURSIONSETTING
-	 * @see #getRecursionAsBoolean()
-	 * @see #setRecursion(String recursion)
-	 */
-	public String getRecursion()
-	{
-		return recursion;
-	}
-
-	/**
-	 * Gets the <CODE>recursion</CODE> attribute as a boolean value.
-	 *
-	 * @return A boolean value telling whether subfolders of
-	 * <CODE>folderName</CODE> will be scanned for files to check out.
-	 *
-	 * @see #DEFAULT_RECURSIONSETTING
-	 * @see #getRecursion()
-	 * @see #setRecursion(String recursion)
-	 */
-	public boolean getRecursionAsBoolean()
-	{
-		return project.toBoolean(recursion);
-	}
-
-	/**
-	 * Sets the <CODE>verbose</CODE> attribute to the given value.
-	 * 
-	 * @param verbose A string containing "true" or "false" to tell
-	 *                AntStarTeamCheckOut whether to display files as they
-	 *                are checked out.  By default it is false, so the
-	 *                program only displays the total number of files unless
-	 *                you override this default.
-	 * @see #DEFAULT_FORCESETTING
-	 * @see #getForce()
-	 * @see #getForceAsBoolean()
-	 */
-	public void setVerbose(String verbose)
-	{
-		this.verbose = verbose;
-	}
-
-	/**
-	 * Gets the <CODE>verbose</CODE> attribute.
-	 * 
-	 * @return A string containing "true" or "false" telling the application
-	 *         to display all files as it checks them out.  By default it is
-	 *         false, so the program only displays the total number of
-	 *         files.
-	 * @see #DEFAULT_VERBOSESETTING
-	 * @see #getVerboseAsBoolean()
-	 * @see #setVerbose(String verbose)
-	 */
-	public String getVerbose()
-	{
-		return verbose;
-	}
-
-	/**
-	 * Gets the <CODE>verbose</CODE> attribute as a boolean value.
-	 * 
-	 * @return A boolean value telling whether to display all files as they
-	 *         are checked out.
-	 * @see #DEFAULT_VERBOSESETTING
-	 * @see #getVerbose()
-	 * @see #setVerbose(String verbose)
-	 */
-	public boolean getVerboseAsBoolean()
-	{
-		return project.toBoolean(verbose);
-	}
-
-	// Begin filter getters and setters
-
-	/**
-	 * Sets the include filter. When filtering files, AntStarTeamCheckOut
-	 * uses an unmodified version of <CODE>DirectoryScanner</CODE>'s
-	 * <CODE>match</CODE> method, so here are the patterns straight from the
-	 * Ant source code:
-	 * <BR><BR>
-	 * Matches a string against a pattern. The pattern contains two special
-	 * characters:
-	 * <BR>'*' which means zero or more characters,
-	 * <BR>'?' which means one and only one character.
-	 * <BR><BR>
-	 * I would have used the Ant method directly from its class, but
-	 * <CODE>match</CODE> is a private member, so I cannot access it from
-	 * this program.
-	 * <BR><BR>
-	 * Separate multiple inlcude filters by <I>spaces</I>, not commas as Ant
-	 * uses. For example, if you want to check out all .java and .class\
-	 * files, you would put the following line in your program:
-	 * <CODE>setIncludes("*.java *.class");</CODE>
-	 * Finally, note that filters have no effect on the <B>directories</B>
-	 * that are scanned; you could not check out files from directories with
-	 * names beginning only with "build," for instance. Of course, you
-	 * could limit AntStarTeamCheckOut to a particular folder and its
-	 * subfolders with the <CODE>setFolderName(String folderName)</CODE>
-	 * command.
-	 * <BR><BR>
-	 * Treatment of overlapping inlcudes and excludes: To give a simplistic
-	 * example suppose that you set your include filter to "*.htm *.html"
-	 * and your exclude filter to "index.*". What happens to index.html?
-	 * AntStarTeamCheckOut will not check out index.html, as it matches an
-	 * exclude filter ("index.*"), even though it matches the include
-	 * filter, as well.
-	 * <BR><BR>
-	 * Please also read the following sections before using filters:
-	 * 
-	 * @param includes A string of filter patterns to include. Separate the
-	 *                 patterns by spaces.
-	 * @see #getIncludes()
-	 * @see #setExcludes(String excludes)
-	 * @see #getExcludes()
-	 */
-	public void setIncludes(String includes)
-	{
-		this.includes = includes;
-	}
-
-	/**
-	 * Gets the patterns from the include filter. Rather that duplicate the
-	 * details of AntStarTeanCheckOut's filtering here, refer to these
-	 * links:
-	 * 
-	 * @return A string of filter patterns separated by spaces.
-	 * @see #setIncludes(String includes)
-	 * @see #setExcludes(String excludes)
-	 * @see #getExcludes()
-	 */
-	public String getIncludes()
-	{
-		return includes;
-	}
-
-	/**
-	 * Sets the exclude filter. When filtering files, AntStarTeamCheckOut
-	 * uses an unmodified version of <CODE>DirectoryScanner</CODE>'s
-	 * <CODE>match</CODE> method, so here are the patterns straight from the
-	 * Ant source code:
-	 * <BR><BR>
-	 * Matches a string against a pattern. The pattern contains two special
-	 * characters:
-	 * <BR>'*' which means zero or more characters,
-	 * <BR>'?' which means one and only one character.
-	 * <BR><BR>
-	 * I would have used the Ant method directly from its class, but
-	 * <CODE>match</CODE> is a private member, so I cannot access it from
-	 * this program.
-	 * <BR><BR>
-	 * Separate multiple exlcude filters by <I>spaces</I>, not commas as Ant
-	 * uses. For example, if you want to check out all files except .XML and
-	 * .HTML files, you would put the following line in your program:
-	 * <CODE>setExcludes("*.XML *.HTML");</CODE>
-	 * Finally, note that filters have no effect on the <B>directories</B>
-	 * that are scanned; you could not skip over all files in directories
-	 * whose names begin with "project," for instance.
-	 * <BR><BR>
-	 * Treatment of overlapping inlcudes and excludes: To give a simplistic
-	 * example suppose that you set your include filter to "*.htm *.html"
-	 * and your exclude filter to "index.*". What happens to index.html?
-	 * AntStarTeamCheckOut will not check out index.html, as it matches an
-	 * exclude filter ("index.*"), even though it matches the include
-	 * filter, as well.
-	 * <BR><BR>
-	 * Please also read the following sections before using filters:
-	 * 
-	 * @param excludes A string of filter patterns to exclude. Separate the
-	 *                 patterns by spaces.
-	 * @see #setIncludes(String includes)
-	 * @see #getIncludes()
-	 * @see #getExcludes()
-	 */
-	public void setExcludes(String excludes)
-	{
-		this.excludes = excludes;
-	}
-
-	/**
-	 * Gets the patterns from the exclude filter. Rather that duplicate the
-	 * details of AntStarTeanCheckOut's filtering here, refer to these
-	 * links:
-	 * 
-	 * @return A string of filter patterns separated by spaces.
-	 * @see #setExcludes(String excludes)
-	 * @see #setIncludes(String includes)
-	 * @see #getIncludes()
-	 */
-	public String getExcludes()
-	{
-		return excludes;
-	}
+        // Replace the projectName in the file's absolute path to the viewName.
+        // This eventually makes the target of a checkout operation equal to:
+        // targetFolder + dirName + [subfolders] + itemName
+        StringTokenizer pathTokenizer = 
+            new StringTokenizer(item.getParentFolder().getFolderHierarchy(), delim);
+        String localName = delim;
+        String currentToken = null;
+        while (pathTokenizer.hasMoreTokens())
+        {
+            currentToken = pathTokenizer.nextToken();
+            if (currentToken.equals(getProjectName()))
+            {
+                currentToken = dirName;
+            }
+            localName += currentToken + delim;
+        }
+        // Create a reference to the local target file using the format listed above.
+        java.io.File local = new java.io.File( getTargetFolder() + localName + 
+                                               item.get(p1.getName()) );
+        try
+        {
+            remote.checkoutTo(local, Item.LockType.UNCHANGED, false, true, true);
+        }
+        catch (Throwable e)
+        {
+            project.log("    " + e.getMessage());
+        }
+        checkedOut++;
+    }
+
+    /**
+     * Get the primary descriptor of the given item type.
+     *  Returns null if there isn't one.
+     *  In practice, all item types have a primary descriptor.
+     * 
+     * @param t      An item type. At this point it will always be "file".
+     * @return The specified item's primary descriptor.
+     */
+    protected Property getPrimaryDescriptor(Type t)
+    {
+        Property[] properties = t.getProperties();
+        for (int i = 0; i < properties.length; i++)
+        {
+            Property p = properties[i];
+            if (p.isPrimaryDescriptor())
+            {
+                return p;
+            }
+        }
+        return null;
+    }
+
+    /**
+     * Get the secondary descriptor of the given item type.
+     * Returns null if there isn't one.
+     * 
+     * @param t      An item type. At this point it will always be "file".
+     * @return The specified item's secondary descriptor. There may not be
+     *         one for every file.
+     */
+    protected Property getSecondaryDescriptor(Type t)
+    {
+        Property[] properties = t.getProperties();
+        for (int i = 0; i < properties.length; i++)
+        {
+            Property p = properties[i];
+            if (p.isDescriptor() && !p.isPrimaryDescriptor())
+            {
+                return p;
+            }
+        }
+        return null;
+    }
+
+    /**
+     * Formats a property value for display to the user.
+     * 
+     * @param p      An item property to format.
+     * @param value
+     * @return A string containing the property, which is truncated to 35
+     *         characters for display.
+     */
+    protected String formatForDisplay(Property p, Object value)
+    {
+        if (p.getTypeCode() == Property.Types.TEXT)
+        {
+            String str = value.toString();
+            if (str.length() > 35)
+            {
+                str = str.substring(0, 32) + "...";
+            }
+            return "\"" + str + "\"";
+        }
+        else
+        {
+            if (p.getTypeCode() == Property.Types.ENUMERATED)
+            {
+                return "\"" + p.getEnumDisplayName(((Integer)value).intValue()) + "\"";
+            }
+            else
+            {
+                return value.toString();
+            }
+        }
+    }
+
+    // TORN STRAIGHT FROM ANT.DIRECTORYSCANNER
+
+    /**
+     * <B>TORN STRAIGHT FROM ANT.DIRECTORYSCANNER</B>
+     * 
+     * Matches a string against a pattern. The pattern contains two special
+     * characters:<BR>
+     * '*' which means zero or more characters,<BR>
+     * '?' which means one and only one character.
+     * 
+     * @param pattern the (non-null) pattern to match against
+     * @param str     the (non-null) string that must be matched against the
+     *                pattern
+     * @return <code>true</code> when the string matches against the
+     *         pattern, <code>false</code> otherwise.
+     */
+    private static boolean match(String pattern, String str)
+    {
+        char[] patArr = pattern.toCharArray();
+        char[] strArr = str.toCharArray();
+        int patIdxStart = 0;
+        int patIdxEnd   = patArr.length-1;
+        int strIdxStart = 0;
+        int strIdxEnd   = strArr.length-1;
+        char ch;
+
+        boolean containsStar = false;
+        for (int i = 0; i < patArr.length; i++)
+        {
+            if (patArr[i] == '*')
+            {
+                containsStar = true;
+                break;
+            }
+        }
+
+        if (!containsStar)
+        {
+            // No '*'s, so we make a shortcut
+            if (patIdxEnd != strIdxEnd)
+            {
+                return false;        // Pattern and string do not have the same size
+            }
+            for (int i = 0; i <= patIdxEnd; i++)
+            {
+                ch = patArr[i];
+                if (ch != '?' && ch != strArr[i])
+                {
+                    return false;        // Character mismatch
+                }
+            }
+            return true; // String matches against pattern
+        }
+
+        if (patIdxEnd == 0)
+        {
+            return true; // Pattern contains only '*', which matches anything
+        }
+
+        // Process characters before first star
+        while ((ch = patArr[patIdxStart]) != '*' && strIdxStart <= strIdxEnd)
+        {
+            if (ch != '?' && ch != strArr[strIdxStart])
+            {
+                return false;
+            }
+            patIdxStart++;
+            strIdxStart++;
+        }
+        if (strIdxStart > strIdxEnd)
+        {
+            // All characters in the string are used. Check if only '*'s are
+            // left in the pattern. If so, we succeeded. Otherwise failure.
+            for (int i = patIdxStart; i <= patIdxEnd; i++)
+            {
+                if (patArr[i] != '*')
+                {
+                    return false;
+                }
+            }
+            return true;
+        }
+
+        // Process characters after last star
+        while ((ch = patArr[patIdxEnd]) != '*' && strIdxStart <= strIdxEnd)
+        {
+            if (ch != '?' && ch != strArr[strIdxEnd])
+            {
+                return false;
+            }
+            patIdxEnd--;
+            strIdxEnd--;
+        }
+        if (strIdxStart > strIdxEnd)
+        {
+            // All characters in the string are used. Check if only '*'s are
+            // left in the pattern. If so, we succeeded. Otherwise failure.
+            for (int i = patIdxStart; i <= patIdxEnd; i++)
+            {
+                if (patArr[i] != '*')
+                {
+                    return false;
+                }
+            }
+            return true;
+        }
+
+        // process pattern between stars. padIdxStart and patIdxEnd point
+        // always to a '*'.
+        while (patIdxStart != patIdxEnd && strIdxStart <= strIdxEnd)
+        {
+            int patIdxTmp = -1;
+            for (int i = patIdxStart+1; i <= patIdxEnd; i++)
+            {
+                if (patArr[i] == '*')
+                {
+                    patIdxTmp = i;
+                    break;
+                }
+            }
+            if (patIdxTmp == patIdxStart+1)
+            {
+                                // Two stars next to each other, skip the first one.
+                patIdxStart++;
+                continue;
+            }
+            // Find the pattern between padIdxStart & padIdxTmp in str between
+            // strIdxStart & strIdxEnd
+            int patLength = (patIdxTmp-patIdxStart-1);
+            int strLength = (strIdxEnd-strIdxStart+1);
+            int foundIdx  = -1;
+        strLoop:
+            for (int i = 0; i <= strLength - patLength; i++)
+            {
+                for (int j = 0; j < patLength; j++)
+                {
+                    ch = patArr[patIdxStart+j+1];
+                    if (ch != '?' && ch != strArr[strIdxStart+i+j])
+                    {
+                        continue strLoop;
+                    }
+                }
 
+                foundIdx = strIdxStart+i;
+                break;
+            }
+
+            if (foundIdx == -1)
+            {
+                return false;
+            }
+
+            patIdxStart = patIdxTmp;
+            strIdxStart = foundIdx+patLength;
+        }
+
+        // All characters in the string are used. Check if only '*'s are left
+        // in the pattern. If so, we succeeded. Otherwise failure.
+        for (int i = patIdxStart; i <= patIdxEnd; i++)
+        {
+            if (patArr[i] != '*')
+            {
+                return false;
+            }
+        }
+        return true;
+    }
+
+    // Begin SET and GET methods        
+
+    /**
+     * Sets the <CODE>serverName</CODE> attribute to the given value.
+     * 
+     * @param serverName The name of the server you wish to connect to.
+     * @see #getServerName()
+     */
+    public void setServerName(String serverName)
+    {
+        this.serverName = serverName;
+    }
+
+    /**
+     * Gets the <CODE>serverName</CODE> attribute.
+     * 
+     * @return The StarTeam server to log in to.
+     * @see #setServerName(String serverName)
+     */
+    public String getServerName()
+    {
+        return serverName;
+    }
+
+    /**
+     * Sets the <CODE>serverPort</CODE> attribute to the given value. The
+     * given value must be a valid integer, but it must be a string object.
+     * 
+     * @param serverPort A string containing the port on the StarTeam server
+     *                   to use.
+     * @see #getServerPort()
+     */
+    public void setServerPort(String serverPort)
+    {
+        this.serverPort = serverPort;
+    }
+
+    /**
+     * Gets the <CODE>serverPort</CODE> attribute.
+     * 
+     * @return A string containing the port on the StarTeam server to use.
+     * @see #getServerPortAsInt()
+     * @see #setServerPort(String serverPort)
+     */
+    public String getServerPort()
+    {
+        return serverPort;
+    }
+
+    /**
+     * Gets the <CODE>serverPort</CODE> attribute as an integer.
+     * 
+     * @return An integer value for the port on the StarTeam server to use.
+     * @see #getServerPort()
+     * @see #setServerPort(String serverPort)
+     */
+    public int getServerPortAsInt()
+    {
+        return Integer.parseInt(serverPort);
+    }
+
+    /**
+     * Sets the <CODE>projectName</CODE> attribute to the given value.
+     * 
+     * @param projectName
+     *               The StarTeam project to search.
+     * @see #getProjectName()
+     */
+    public void setProjectName(String projectName)
+    {
+        this.projectName = projectName;
+    }
+
+    /**
+     * Gets the <CODE>projectName</CODE> attribute.
+     * 
+     * @return The StarTeam project to search.
+     * @see #setProjectName(String projectName)
+     */
+    public String getProjectName()
+    {
+        return projectName;
+    }
+
+    /**
+     * Sets the <CODE>viewName</CODE> attribute to the given value.
+     * 
+     * @param viewName The view to find the specified folder in.
+     * @see #getViewName()
+     */
+    public void setViewName(String viewName)
+    {
+        this.viewName = viewName;
+    }
+
+    /**
+     * Gets the <CODE>viewName</CODE> attribute.
+     * 
+     * @return The view to find the specified folder in.
+     * @see #setViewName(String viewName)
+     */
+    public String getViewName()
+    {
+        return viewName;
+    }
+
+    /**
+     * Sets the <CODE>folderName</CODE> attribute to the given value. To
+     * search the root folder, use a slash or backslash, or simply don't set
+     * a folder at all.
+     * 
+     * @param folderName The subfolder from which to check out files.
+     * @see #getFolderName()
+     */
+    public void setFolderName(String folderName)
+    {
+        this.folderName = folderName;
+    }
+
+    /**
+     * Gets the <CODE>folderName</CODE> attribute.
+     *
+     * @return The subfolder from which to check out files. All subfolders
+     * will be searched, as well.
+     * @see #setFolderName(String folderName)
+     */
+    public String getFolderName()
+    {
+        return folderName;
+    }
+
+    /**
+     * Sets the <CODE>username</CODE> attribute to the given value.
+     * 
+     * @param username Your username for the specified StarTeam server.
+     * @see #getUsername()
+     */
+    public void setUsername(String username)
+    {
+        this.username = username;
+    }
+
+    /**
+     * Gets the <CODE>username</CODE> attribute.
+     * 
+     * @return The username given by the user.
+     * @see #setUsername(String username)
+     */
+    public String getUsername()
+    {
+        return username;
+    }
+
+    /**
+     * Sets the <CODE>password</CODE> attribute to the given value.
+     * 
+     * @param password Your password for the specified StarTeam server.
+     * @see #getPassword()
+     */
+    public void setPassword(String password)
+    {
+        this.password = password;
+    }
+
+    /**
+     * Gets the <CODE>password</CODE> attribute.
+     * 
+     * @return The password given by the user.
+     * @see #setPassword(String password)
+     */
+    public String getPassword()
+    {
+        return password;
+    }
+
+    /**
+     * Sets the <CODE>targetFolder</CODE> attribute to the given value.
+     * 
+     * @param target The target path on the local machine to check out to.
+     * @see #getTargetFolder()
+     */
+    public void setTargetFolder(String targetFolder)
+    {
+        this.targetFolder = targetFolder;
+    }
+
+    /**
+     * Gets the <CODE>targetFolder</CODE> attribute.
+     * 
+     * @return The target path on the local machine to check out to.
+     *
+     * @see #setTargetFolder(String targetFolder)
+     */
+    public String getTargetFolder()
+    {
+        return targetFolder;
+    }
+
+    /**
+     * Sets the <CODE>force</CODE> attribute to the given value.
+     * 
+     * @param force  A string containing "true" or "false" that tells the
+     *               application whether to continue if the target directory
+     *               exists.  If <CODE>force</CODE> is true,
+     *               AntStarTeamCheckOut will overwrite files in the target
+     *               directory.  By default it set to false as a safeguard.
+     *               Note that if the target directory does not exist, this
+     *               setting has no effect.
+     * @see #DEFAULT_FORCESETTING
+     * @see #getForce()
+     * @see #getForceAsBoolean()
+     */
+    public void setForce(String force)
+    {
+        this.force = force;
+    }
+
+    /**
+     * Gets the <CODE>force</CODE> attribute.
+     * 
+     * @return A string containing "true" or "false" telling the application
+     *         whether to continue if the target directory exists.  If
+     *         <CODE>force</CODE> is true, AntStarTeamCheckOut will
+     *         overwrite files in the target directory. If it is false and
+     *         the target directory exists, AntStarTeamCheckOut will exit
+     *         with a warning.  If the target directory does not exist, this
+     *         setting has no effect. The default setting is false.
+     * @see #DEFAULT_FORCESETTING
+     * @see #getForceAsBoolean()
+     * @see #setForce(String force)
+     */
+    public String getForce()
+    {
+        return force;
+    }
+
+    /**
+     * Gets the <CODE>force</CODE> attribute as a boolean value.
+     * 
+     * @return A boolean value telling whether to continue if the target
+     *         directory exists.
+     * @see #DEFAULT_FORCESETTING
+     * @see #getForce()
+     * @see #setForce(String force)
+     */
+    public boolean getForceAsBoolean()
+    {
+        return project.toBoolean(force);
+    }
+
+    /**
+     * Turns recursion on or off.
+     *
+     * @param verbose A string containing "true" or "false."  If it is true,
+     *                the default, subfolders are searched recursively for
+     *                files to check out.  Otherwise, only files specified
+     *                by <CODE>folderName</CODE> are scanned.
+     * @see #DEFAULT_RECURSIONSETTING
+     * @see #getRecursion()
+     * @see #getRecursionAsBoolean()
+     */
+    public void setRecursion(String recursion)
+    {
+        this.recursion = recursion;
+    }
+
+    /**
+     * Gets the <CODE>recursion</CODE> attribute, which tells
+     * AntStarTeamCheckOut whether to search subfolders when checking out
+     * files.
+     *
+     * @return A string telling whether <CODE>recursion</CODE> is "true" or
+     * "false."
+     *
+     * @see #DEFAULT_RECURSIONSETTING
+     * @see #getRecursionAsBoolean()
+     * @see #setRecursion(String recursion)
+     */
+    public String getRecursion()
+    {
+        return recursion;
+    }
+
+    /**
+     * Gets the <CODE>recursion</CODE> attribute as a boolean value.
+     *
+     * @return A boolean value telling whether subfolders of
+     * <CODE>folderName</CODE> will be scanned for files to check out.
+     *
+     * @see #DEFAULT_RECURSIONSETTING
+     * @see #getRecursion()
+     * @see #setRecursion(String recursion)
+     */
+    public boolean getRecursionAsBoolean()
+    {
+        return project.toBoolean(recursion);
+    }
+
+    /**
+     * Sets the <CODE>verbose</CODE> attribute to the given value.
+     * 
+     * @param verbose A string containing "true" or "false" to tell
+     *                AntStarTeamCheckOut whether to display files as they
+     *                are checked out.  By default it is false, so the
+     *                program only displays the total number of files unless
+     *                you override this default.
+     * @see #DEFAULT_FORCESETTING
+     * @see #getForce()
+     * @see #getForceAsBoolean()
+     */
+    public void setVerbose(String verbose)
+    {
+        this.verbose = verbose;
+    }
+    
+    /**
+     * Gets the <CODE>verbose</CODE> attribute.
+     * 
+     * @return A string containing "true" or "false" telling the application
+     *         to display all files as it checks them out.  By default it is
+     *         false, so the program only displays the total number of
+     *         files.
+     * @see #DEFAULT_VERBOSESETTING
+     * @see #getVerboseAsBoolean()
+     * @see #setVerbose(String verbose)
+     */
+    public String getVerbose()
+    {
+        return verbose;
+    }
+
+    /**
+     * Gets the <CODE>verbose</CODE> attribute as a boolean value.
+     * 
+     * @return A boolean value telling whether to display all files as they
+     *         are checked out.
+     * @see #DEFAULT_VERBOSESETTING
+     * @see #getVerbose()
+     * @see #setVerbose(String verbose)
+     */
+    public boolean getVerboseAsBoolean()
+    {
+        return project.toBoolean(verbose);
+    }
+
+    // Begin filter getters and setters
+
+    /**
+     * Sets the include filter. When filtering files, AntStarTeamCheckOut
+     * uses an unmodified version of <CODE>DirectoryScanner</CODE>'s
+     * <CODE>match</CODE> method, so here are the patterns straight from the
+     * Ant source code:
+     * <BR><BR>
+     * Matches a string against a pattern. The pattern contains two special
+     * characters:
+     * <BR>'*' which means zero or more characters,
+     * <BR>'?' which means one and only one character.
+     * <BR><BR>
+     * I would have used the Ant method directly from its class, but
+     * <CODE>match</CODE> is a private member, so I cannot access it from
+     * this program.
+     * <BR><BR>
+     * Separate multiple inlcude filters by <I>spaces</I>, not commas as Ant
+     * uses. For example, if you want to check out all .java and .class\
+     * files, you would put the following line in your program:
+     * <CODE>setIncludes("*.java *.class");</CODE>
+     * Finally, note that filters have no effect on the <B>directories</B>
+     * that are scanned; you could not check out files from directories with
+     * names beginning only with "build," for instance. Of course, you
+     * could limit AntStarTeamCheckOut to a particular folder and its
+     * subfolders with the <CODE>setFolderName(String folderName)</CODE>
+     * command.
+     * <BR><BR>
+     * Treatment of overlapping inlcudes and excludes: To give a simplistic
+     * example suppose that you set your include filter to "*.htm *.html"
+     * and your exclude filter to "index.*". What happens to index.html?
+     * AntStarTeamCheckOut will not check out index.html, as it matches an
+     * exclude filter ("index.*"), even though it matches the include
+     * filter, as well.
+     * <BR><BR>
+     * Please also read the following sections before using filters:
+     * 
+     * @param includes A string of filter patterns to include. Separate the
+     *                 patterns by spaces.
+     * @see #getIncludes()
+     * @see #setExcludes(String excludes)
+     * @see #getExcludes()
+     */
+    public void setIncludes(String includes)
+    {
+        this.includes = includes;
+    }
+
+    /**
+     * Gets the patterns from the include filter. Rather that duplicate the
+     * details of AntStarTeanCheckOut's filtering here, refer to these
+     * links:
+     * 
+     * @return A string of filter patterns separated by spaces.
+     * @see #setIncludes(String includes)
+     * @see #setExcludes(String excludes)
+     * @see #getExcludes()
+     */
+    public String getIncludes()
+    {
+        return includes;
+    }
+
+    /**
+     * Sets the exclude filter. When filtering files, AntStarTeamCheckOut
+     * uses an unmodified version of <CODE>DirectoryScanner</CODE>'s
+     * <CODE>match</CODE> method, so here are the patterns straight from the
+     * Ant source code:
+     * <BR><BR>
+     * Matches a string against a pattern. The pattern contains two special
+     * characters:
+     * <BR>'*' which means zero or more characters,
+     * <BR>'?' which means one and only one character.
+     * <BR><BR>
+     * I would have used the Ant method directly from its class, but
+     * <CODE>match</CODE> is a private member, so I cannot access it from
+     * this program.
+     * <BR><BR>
+     * Separate multiple exlcude filters by <I>spaces</I>, not commas as Ant
+     * uses. For example, if you want to check out all files except .XML and
+     * .HTML files, you would put the following line in your program:
+     * <CODE>setExcludes("*.XML *.HTML");</CODE>
+     * Finally, note that filters have no effect on the <B>directories</B>
+     * that are scanned; you could not skip over all files in directories
+     * whose names begin with "project," for instance.
+     * <BR><BR>
+     * Treatment of overlapping inlcudes and excludes: To give a simplistic
+     * example suppose that you set your include filter to "*.htm *.html"
+     * and your exclude filter to "index.*". What happens to index.html?
+     * AntStarTeamCheckOut will not check out index.html, as it matches an
+     * exclude filter ("index.*"), even though it matches the include
+     * filter, as well.
+     * <BR><BR>
+     * Please also read the following sections before using filters:
+     * 
+     * @param excludes A string of filter patterns to exclude. Separate the
+     *                 patterns by spaces.
+     * @see #setIncludes(String includes)
+     * @see #getIncludes()
+     * @see #getExcludes()
+     */
+    public void setExcludes(String excludes)
+    {
+        this.excludes = excludes;
+    }
+
+    /**
+     * Gets the patterns from the exclude filter. Rather that duplicate the
+     * details of AntStarTeanCheckOut's filtering here, refer to these
+     * links:
+     * 
+     * @return A string of filter patterns separated by spaces.
+     * @see #setExcludes(String excludes)
+     * @see #setIncludes(String includes)
+     * @see #getIncludes()
+     */
+    public String getExcludes()
+    {
+        return excludes;
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/AntSoundPlayer.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/AntSoundPlayer.java
new file mode 100644
index 0000000..f5f7bf6
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/AntSoundPlayer.java
@@ -0,0 +1,270 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.sound;
+
+// ant includes
+import org.apache.tools.ant.*;
+
+// imports for all the sound classes required
+// note: comes with jmf or jdk1.3 +
+// these can be obtained from http://java.sun.com/products/java-media/sound/
+import javax.sound.sampled.*;
+
+import java.io.*;
+import java.util.*;
+
+
+/**
+ * This class is designed to be used by any AntTask that requires audio output.
+ *
+ * It implements the BuildListener interface to listen for BuildEvents and could
+ * be easily extended to provide audio output upon any specific build events occuring.
+ *
+ * I have only tested this with .WAV and .AIFF sound file formats. Both seem to work fine.
+ *
+ * @author Nick Pellow
+ * @version $Revision: 1.3 $, $Date: 2001/02/04 10:51:00 $
+ */
+
+public class AntSoundPlayer implements LineListener, BuildListener {
+
+    private File fileSuccess = null;
+    private int loopsSuccess = 0;
+    private Long durationSuccess = null;
+
+    private File fileFail = null;
+    private int loopsFail = 0;
+    private Long durationFail = null;
+
+    public AntSoundPlayer() {
+
+    }
+
+    /**
+     * @param source the location of the audio file to be played when the build is successful
+     * @param loops the number of times the file should be played when the build is successful
+     * @param duration the number of milliseconds the file should be played when the build is successful
+     */
+    public void addBuildSuccessfulSound(File file, int loops, Long duration) {
+        this.fileSuccess = file;
+        this.loopsSuccess = loops;
+        this.durationSuccess = duration;
+    }
+
+
+    /**
+     * @param fileName the location of the audio file to be played when the build fails
+     * @param loops the number of times the file should be played when the build is fails
+     * @param duration the number of milliseconds the file should be played when the build fails
+     */
+    public void addBuildFailedSound(File fileFail, int loopsFail, Long durationFail) {
+        this.fileFail = fileFail;
+        this.loopsFail = loopsFail;
+        this.durationFail = durationFail;
+    }
+
+    /**
+     * Plays the file for duration milliseconds or loops.
+     */
+    private void play(Project project, File file, int loops, Long duration) {
+
+        Clip audioClip = null;
+
+        AudioInputStream audioInputStream = null;
+
+
+		try {
+			audioInputStream = AudioSystem.getAudioInputStream(file);
+		}
+		catch (UnsupportedAudioFileException uafe) {
+			project.log("Audio format is not yet supported: "+uafe.getMessage());
+		}
+        catch (IOException ioe) {
+            ioe.printStackTrace();
+        }
+
+		if (audioInputStream != null) {
+			AudioFormat	format = audioInputStream.getFormat();
+			DataLine.Info	info = new DataLine.Info(Clip.class, format,
+                                             AudioSystem.NOT_SPECIFIED);
+			try {
+				audioClip = (Clip) AudioSystem.getLine(info);
+				audioClip.addLineListener(this);
+                audioClip.open(audioInputStream);
+			}
+			catch (LineUnavailableException e) {
+                project.log("The sound device is currently unavailable");
+                return;
+			}
+			catch (IOException e) {
+				e.printStackTrace();
+			}
+
+            if (duration != null) {
+                playClip(audioClip, duration.longValue());
+            } else {
+                playClip(audioClip, loops);
+            }
+            audioClip.drain();
+            audioClip.close();
+		}
+		else {
+			project.log("Can't get data from file " + file.getName());
+		}
+    }
+
+    private void playClip(Clip clip, int loops) {
+
+        clip.loop(loops);
+        while (clip.isRunning()) {
+        }
+    }
+
+    private void playClip(Clip clip, long duration) {
+
+        long currentTime = System.currentTimeMillis();
+        clip.loop(Clip.LOOP_CONTINUOUSLY);
+        try {
+            Thread.sleep(duration);
+        }
+        catch (InterruptedException e) {
+        }
+    }
+
+    /**
+     * This is implemented to listen for any line events and closes the
+     * clip if required.
+     */
+    public void update(LineEvent event) {
+        if (event.getType().equals(LineEvent.Type.STOP)) {
+            Line line = event.getLine();
+            line.close();
+		}
+		else if (event.getType().equals(LineEvent.Type.CLOSE)) {
+			/*
+			 *	There is a bug in JavaSound 0.90 (jdk1.3beta).
+			 *	It prevents correct termination of the VM.
+			 *	So we have to exit ourselves.
+			 */
+			//System.exit(0);
+		}
+	}
+
+
+    /**
+     *  Fired before any targets are started.
+     */
+    public void buildStarted(BuildEvent event){
+    }
+    
+    /**
+     *  Fired after the last target has finished. This event
+     *  will still be thrown if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void buildFinished(BuildEvent event){
+        if (event.getException() == null && fileSuccess != null) {
+            // build successfull!
+            play(event.getProject(), fileSuccess, loopsSuccess, durationSuccess);
+        } else if ( event.getException() != null && fileFail != null) {
+            play(event.getProject(), fileFail, loopsFail, durationFail);
+        }
+    }
+
+    /**
+     *  Fired when a target is started.
+     *
+     *  @see BuildEvent#getTarget()
+     */
+    public void targetStarted(BuildEvent event){
+    }
+
+    /**
+     *  Fired when a target has finished. This event will
+     *  still be thrown if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void targetFinished(BuildEvent event){
+    }
+
+    /**
+     *  Fired when a task is started.
+     *
+     *  @see BuildEvent#getTask()
+     */
+    public void taskStarted(BuildEvent event){
+    }
+
+    /**
+     *  Fired when a task has finished. This event will still
+     *  be throw if an error occured during the build.
+     *
+     *  @see BuildEvent#getException()
+     */
+    public void taskFinished(BuildEvent event){
+    }
+
+    /**
+     *  Fired whenever a message is logged.
+     *
+     *  @see BuildEvent#getMessage()
+     *  @see BuildEvent#getPriority()
+     */
+    public void messageLogged(BuildEvent event){
+    }
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/SoundTask.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/SoundTask.java
new file mode 100644
index 0000000..0c9f66b
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/sound/SoundTask.java
@@ -0,0 +1,200 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.sound;
+
+import org.apache.tools.ant.*;
+
+import java.io.*;
+import java.util.*;
+
+/**
+ * This is an example of an AntTask that makes of use of the AntSoundPlayer.
+ *
+ * There are three attributes to be set:
+ *
+ * <code>source</code>: the location of the audio file to be played
+ * <code>duration</code>: play the sound file continuously until "duration" milliseconds has expired
+ * <code>loops</code>: the number of times the sound file should be played until stopped
+ *
+ * I have only tested this with .WAV and .AIFF sound file formats. Both seem
+ * to work fine.
+ *
+ * plans for the future:
+ * - use the midi api to define sounds (or drum beat etc) in xml and have
+ *   Ant play them back
+ *
+ * @author Nick Pellow
+ * @version $Revision: 1.3 $, $Date: 2001/02/04 10:51:01 $
+ */
+
+public class SoundTask extends Task {
+
+    private BuildAlert success = null;
+    private BuildAlert fail = null;
+
+    public BuildAlert createSuccess() {
+        success = new BuildAlert();
+        return success;
+    }
+
+    public BuildAlert createFail() {
+        fail = new BuildAlert();
+        return fail;
+     }
+
+    public SoundTask() {
+    }
+
+    public void init(){
+    }
+
+    public void execute() {
+
+        AntSoundPlayer soundPlayer = new AntSoundPlayer();
+
+        if ( success == null ) {
+            log("No nested success element found.", Project.MSG_WARN);
+        } else {
+            soundPlayer.addBuildSuccessfulSound(success.getSource(),
+              success.getLoops(), success.getDuration());
+        }
+
+        if (fail == null) {
+            log("No nested failure element found.", Project.MSG_WARN);
+        } else {
+            soundPlayer.addBuildFailedSound(fail.getSource(),
+              fail.getLoops(), fail.getDuration());
+        }
+
+        getProject().addBuildListener(soundPlayer);
+
+    }
+
+    /**
+     * A class to be extended by any BuildAlert's that require the output
+     * of sound.
+     */
+    public class BuildAlert {
+        private File source = null;
+        private int loops = 0;
+        private Long duration = null;
+
+        /**
+         * Sets the duration in milliseconds the file should be played.
+         */
+        public void setDuration(Long duration) {
+            this.duration = duration;
+        }
+
+        /**
+         * Sets the location of the file to get the audio.
+         *
+         * @param source the name a sound-file directory or of the audio file
+         */
+        public void setSource(File source) {
+            this.source = source;
+        }
+
+        /**
+         * Sets the number of times the source file should be played.
+         *
+         * @param loops the number of loops to play the source file
+         */
+        public void setLoops(int loops) {
+            this.loops = loops;
+        }
+
+        /**
+         * Gets the location of the file to get the audio.
+         */
+        public File getSource() {
+            File nofile = null ;
+            // Check if source is a directory
+            if( source.exists() ) {
+                if( source.isDirectory() ) {
+                    // get the list of files in the dir
+                    File[] files = source.listFiles() ; 
+                    int numfiles = files.length ;
+                    // get a random number between 0 and the number of files
+                    Random rn = new Random() ;
+                    int i = rn.nextInt(numfiles) ;
+                    // set the source to the file at that location
+                    this.source = files[i] ;
+                }
+            } else {
+                log(source + ": invalid path.", Project.MSG_WARN) ;
+                this.source = nofile ;
+            }
+            return this.source ;
+        }
+
+        /**
+         * Sets the number of times the source file should be played.
+         *
+         * @return the number of loops to play the source file
+         */
+        public int getLoops() {
+            return this.loops;
+        }
+
+        /**
+         * Gets the duration in milliseconds the file should be played.
+         */
+        public Long getDuration() {
+            return this.duration;
+        }
+    }
+}
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSS.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSS.java
index b11985e..69567fd 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSS.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSS.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,13 +54,13 @@
 
 package org.apache.tools.ant.taskdefs.optional.vss;
 
+
+import java.io.File;
 import org.apache.tools.ant.*;
 import org.apache.tools.ant.taskdefs.Execute;
 import org.apache.tools.ant.taskdefs.LogStreamHandler;
 import org.apache.tools.ant.types.Commandline;
 
-import java.io.File;
-
 /**
  * A base class for creating tasks for executing commands on Visual SourceSafe.
  * <p>
@@ -149,7 +149,6 @@ public abstract class MSVSS extends Task {
         return m_vssPath;
     }
 
-
     protected int run(Commandline cmd) {
         try {
             Execute exe = new Execute(new LogStreamHandler(this, 
@@ -168,7 +167,7 @@ public abstract class MSVSS extends Task {
      * Constant for the thing to execute
      */
     private static final String SS_EXE = "ss";
-	/** */
+    /** */
     public static final String PROJECT_PREFIX = "$";
 
     /**
@@ -188,25 +187,29 @@ public abstract class MSVSS extends Task {
      */
     public static final String COMMAND_HISTORY = "History";
 
-	/** */
+    /** */
     public static final String FLAG_LOGIN = "-Y";
-	/** */
+    /** */
     public static final String FLAG_OVERRIDE_WORKING_DIR = "-GL";
-	/** */
-    public static final String FLAG_AUTORESPONSE = "-I";
-	/** */
+    /** */
+    public static final String FLAG_AUTORESPONSE_DEF = "-I-";
+    /** */
+    public static final String FLAG_AUTORESPONSE_YES = "-I-Y";
+    /** */
+    public static final String FLAG_AUTORESPONSE_NO = "-I-N";
+    /** */
     public static final String FLAG_RECURSION = "-R";
-	/** */
+    /** */
     public static final String FLAG_VERSION = "-V";
-	/** */
+    /** */
     public static final String FLAG_VERSION_DATE = "-Vd";
-	/** */
+    /** */
     public static final String FLAG_VERSION_LABEL = "-VL";
-	/** */
+    /** */
     public static final String FLAG_WRITABLE = "-W";
-	/** */
+    /** */
     public static final String VALUE_NO = "-N";
-	/** */
+    /** */
     public static final String VALUE_YES = "-Y";
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSGET.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSGET.java
index ffa6b17..fba717a 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSGET.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSGET.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -124,6 +124,7 @@ public class MSVSSGET extends MSVSS {
     private String m_Version = null;
     private String m_Date = null;
     private String m_Label = null;
+    private String m_AutoResponse = null;
 
     /**
      * Executes the task.
@@ -153,8 +154,8 @@ public class MSVSSGET extends MSVSS {
         commandLine.createArgument().setValue(getVsspath());
         // -GL
         getLocalpathCommand(commandLine);
-        // -I-
-        commandLine.createArgument().setValue("-I-");  // ignore all errors
+        // -I- or -I-Y or -I-N
+        getAutoresponse(commandLine);
         // -R
         getRecursiveCommand(commandLine);
         // -V
@@ -302,5 +303,34 @@ public class MSVSSGET extends MSVSS {
         }
     }
 
+    public void setAutoresponse(String response){
+        if ( response.equals("") || response.equals("null") ) {
+            m_AutoResponse = null;
+        } else {
+            m_AutoResponse = response;
+        }
+    }
+    
+    /**
+     * Checks the value set for the autoResponse.
+     * if it equals "Y" then we return -I-Y
+     * if it equals "N" then we return -I-N
+     * otherwise we return -I
+     */
+    public void getAutoresponse(Commandline cmd) {
+        
+        if ( m_AutoResponse == null) {
+            cmd.createArgument().setValue(FLAG_AUTORESPONSE_DEF);
+        } else if ( m_AutoResponse.equalsIgnoreCase("Y")) {
+            cmd.createArgument().setValue(FLAG_AUTORESPONSE_YES);
+            
+        } else if ( m_AutoResponse.equalsIgnoreCase("N")) {
+            cmd.createArgument().setValue(FLAG_AUTORESPONSE_NO);
+        }else {
+            cmd.createArgument().setValue(FLAG_AUTORESPONSE_DEF);
+        } // end of else
+
+    }
+
 }
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSLABEL.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSLABEL.java
new file mode 100644
index 0000000..a7420cb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/taskdefs/optional/vss/MSVSSLABEL.java
@@ -0,0 +1,225 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional.vss;
+
+import org.apache.tools.ant.*;
+import org.apache.tools.ant.types.Commandline;
+
+/**
+ * Task to perform LABEL commands to Microsoft Visual Source Safe.
+ * <p>
+ * The following attributes are interpreted:
+ * <table border="1">
+ *   <tr>
+ *     <th>Attribute</th>
+ *     <th>Values</th>
+ *     <th>Required</th>
+ *   </tr>
+ *   <tr>
+ *      <td>login</td>
+ *      <td>username,password</td>
+ *      <td>No</td>
+ *   </tr>
+ *   <tr>
+ *      <td>vsspath</td>
+ *      <td>SourceSafe path</td>
+ *      <td>Yes</td>
+ *   </tr>
+ *   <tr>
+ *      <td>ssdir</td>
+ *      <td>directory where <code>ss.exe</code> resides. By default the task
+ *      expects it to be in the PATH.</td>
+ *      <td>No</td>
+ *   </tr>
+ *   <tr>
+ *      <td>label</td>
+ *      <td>A label to apply to the hierarchy</td>
+ *      <td>Yes</td>
+ *   </tr>
+ *   <tr>
+ *      <td>version</td>
+ *      <td>An existing file or project version to label</td>
+ *      <td>No</td>
+ *   </tr>
+ * </table>
+ *
+ * @author Phillip Wells
+ */
+public class MSVSSLABEL extends MSVSS
+{
+
+    private String m_Label = null;
+    private String m_Version = null;
+
+    public static final String FLAG_LABEL = "-L";
+
+    /**
+     * Executes the task.
+     * <p>
+     * Builds a command line to execute ss and then calls Exec's run method
+     * to execute the command line.
+     */
+    public void execute() throws BuildException {
+        Commandline commandLine = new Commandline();
+        int result = 0;
+
+        // first off, make sure that we've got a command and a vssdir and a label ...
+        if (getVsspath() == null) {
+            String msg = "vsspath attribute must be set!";
+            throw new BuildException(msg, location);
+        }
+        if (getLabel() == null) {
+            String msg = "label attribute must be set!";
+            throw new BuildException(msg, location);
+        }
+
+        // now look for illegal combinations of things ...
+
+        // build the command line from what we got the format is
+        // ss Label VSS items [-C]      [-H] [-I-] [-Llabel] [-N] [-O]      [-V]      [-Y] [-?]
+        // as specified in the SS.EXE help
+        commandLine.setExecutable(getSSCommand());
+        commandLine.createArgument().setValue(COMMAND_LABEL);
+
+        // VSS items
+        commandLine.createArgument().setValue(getVsspath());
+
+        // -C
+        // Use the same comment for all labels
+        // Not required
+
+        // -I-
+        commandLine.createArgument().setValue("-I-");  // ignore all errors
+
+        // -L
+        // Specify the new label on the command line (instead of being prompted)
+        getLabelCommand(commandLine);
+
+        // -V
+        // Label an existing file or project version
+        getVersionCommand(commandLine);
+
+        // -Y
+        getLoginCommand(commandLine);
+
+        result = run(commandLine);
+        if ( result != 0 ) {
+            String msg = "Failed executing: " + commandLine.toString();
+            throw new BuildException(msg, location);
+        }
+
+    }
+
+    /**
+     * Set the label to apply in SourceSafe
+     * <p>
+     * Note we assume that if the supplied string has the value "null" that something
+     * went wrong and that the string value got populated from a null object. This
+     * happens if a ant variable is used e.g. label="${label_server}" when label_server
+     * has not been defined to ant!
+     */
+    public void setLabel(String label) {
+        if ( label.equals("") || label.equals("null") ) {
+            m_Label = null;
+        } else {
+            m_Label = label;
+        }
+    }
+
+    /**
+     * Builds the version command.
+     * @param cmd the commandline the command is to be added to
+     */
+    public void getVersionCommand(Commandline cmd) {
+        if ( m_Version != null) {
+            cmd.createArgument().setValue(FLAG_VERSION + m_Version);
+        }
+    }
+
+    /**
+     * Builds the label command.
+     * @param cmd the commandline the command is to be added to
+     */
+    public void getLabelCommand(Commandline cmd) {
+        if ( m_Label != null) {
+            cmd.createArgument().setValue(FLAG_LABEL + m_Label);
+        }
+    }
+
+    /**
+     * Set the stored version string
+     * <p>
+     * Note we assume that if the supplied string has the value "null" that something
+     * went wrong and that the string value got populated from a null object. This
+     * happens if a ant variable is used e.g. version="${ver_server}" when ver_server
+     * has not been defined to ant!
+     */
+    public void setVersion(String version) {
+        if (version.equals("") || version.equals("null") ) {
+            m_Version = null;
+        } else {
+            m_Version = version;
+        }
+    }
+
+    /**
+     * Gets the label to be applied.
+     * @return the label to be applied.
+     */
+    public String getLabel() {
+        return m_Label;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Commandline.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Commandline.java
index ec0f40a..6ff65bc 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Commandline.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Commandline.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -156,6 +156,38 @@ public class Commandline implements Cloneable {
         }
     }
 
+    /**
+     * Class to keep track of the position of an Argument.
+     */
+    // <p>This class is there to support the srcfile and targetfile
+    // elements of &lt;execon&gt; and &lt;transform&gt; - don't know
+    // whether there might be additional use cases.</p> --SB
+    public class Marker {
+
+        private int position;
+        private int realPos = -1;
+
+        Marker(int position) {
+            this.position = position;
+        }
+
+        /**
+         * Return the number of arguments that preceeded this marker.
+         *
+         * <p>The name of the executable - if set - is counted as the
+         * very first argument.</p>
+         */
+        public int getPosition() {
+            if (realPos == -1) {
+                realPos = (executable == null ? 0 : 1);
+                for (int i=0; i<position; i++) {
+                    Argument arg = (Argument) arguments.elementAt(i);
+                    realPos += arg.getParts().length;
+                }
+            }
+            return realPos;
+        }
+    }
 
     /**
      * Creates an argument object.
@@ -174,7 +206,8 @@ public class Commandline implements Cloneable {
      */
     public void setExecutable(String executable) {
         if (executable == null || executable.length() == 0) return;
-        this.executable = executable;
+        this.executable = executable.replace('/', File.separatorChar)
+            .replace('\\', File.separatorChar);
     }
 
 
@@ -352,4 +385,14 @@ public class Commandline implements Cloneable {
         arguments.removeAllElements();
     }
         
+    /**
+     * Return a marker.
+     *
+     * <p>This marker can be used to locate a position on the
+     * commandline - to insert something for example - when all
+     * parameters have been set.</p>
+     */
+    public Marker createMarker() {
+        return new Marker(arguments.size());
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/CommandlineJava.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/CommandlineJava.java
index 025bb32..c614094 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/CommandlineJava.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/CommandlineJava.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -172,9 +172,10 @@ public class CommandlineJava implements Cloneable {
     }
 
     public String[] getCommandline() {
+        Path fullClasspath = classpath != null ? classpath.concatSystemClasspath("ignore") : null;
         int size = 
             vmCommand.size() + javaCommand.size() + sysProperties.size();
-        if (classpath != null && classpath.size() > 0) {
+        if (fullClasspath != null && fullClasspath.size() > 0) {
             size += 2;
         }
         
@@ -188,9 +189,9 @@ public class CommandlineJava implements Cloneable {
                              result, pos, sysProperties.size());
             pos += sysProperties.size();
         }
-        if (classpath != null && classpath.size() > 0) {
+        if (fullClasspath != null && fullClasspath.toString().trim().length() > 0) {
             result[pos++] = "-classpath";
-            result[pos++] = classpath.toString();
+            result[pos++] = fullClasspath.toString();
         }
         System.arraycopy(javaCommand.getCommandline(), 0, 
                          result, pos, javaCommand.size());
@@ -239,7 +240,9 @@ public class CommandlineJava implements Cloneable {
         c.vmCommand = (Commandline) vmCommand.clone();
         c.javaCommand = (Commandline) javaCommand.clone();
         c.sysProperties = (SysProperties) sysProperties.clone();
-        c.classpath = (Path) classpath.clone();
+        if (classpath != null) {
+            c.classpath = (Path) classpath.clone();
+        }
         c.vmVersion = vmVersion;
         return c;
     }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/DataType.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/DataType.java
index d8b863c..a9f83df 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/DataType.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/DataType.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -54,10 +54,10 @@
 
 package org.apache.tools.ant.types;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.Project;
 
 import java.util.Stack;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
 
 /**
  * Base class for those classes that can appear inside the build file
@@ -69,7 +69,7 @@ import java.util.Stack;
  * nested inside elements of the same type (i.e. &lt;patternset&gt;
  * but not &lt;path&gt;).</p>
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 public abstract class DataType {
     /**
@@ -95,14 +95,14 @@ public abstract class DataType {
      * in commenting what we are doing.  
      */
     public void setDescription( String desc ) {
-	description=desc;
+        description=desc;
     }
 
     /**
      * Return the description for the current data type.
      */
     public String getDescription() {
-	return description;
+        return description;
     }
 
     /**
@@ -166,7 +166,8 @@ public abstract class DataType {
      * only attribute if it is set.  
      */
     protected BuildException tooManyAttributes() {
-        return new BuildException("You must not specify more than one attribute when using refid");
+        return new BuildException( "You must not specify more than one attribute" +
+                                   " when using refid" );
     }
 
     /**
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/EnumeratedAttribute.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/EnumeratedAttribute.java
index f440194..48ca029 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/EnumeratedAttribute.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/EnumeratedAttribute.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -63,7 +63,7 @@ import org.apache.tools.ant.BuildException;
  * <p>See {@link org.apache.tools.ant.taskdefs.FixCRLF FixCRLF} for an
  * example.
  *
- * @author Stefan Bodewig <a href="mailto:stefan.bodewig@megabit.net">stefan.bodewig@megabit.net</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 public abstract class EnumeratedAttribute {
 
@@ -79,7 +79,7 @@ public abstract class EnumeratedAttribute {
     public EnumeratedAttribute() {}
 
     /**
-     * Invoked by {@link IntrospectionHelper IntrospectionHelper}.
+     * Invoked by {@link org.apache.tools.ant.IntrospectionHelper IntrospectionHelper}.
      */
     public final void setValue(String value) throws BuildException {
         if (!containsValue(value)) {
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Environment.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Environment.java
index 1aa0c01..49f2c34 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Environment.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Environment.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/FileSet.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/FileSet.java
index 716cfd0..da2f232 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/FileSet.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/FileSet.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -71,7 +71,7 @@ import java.util.Vector;
  * @author Stefano Mazzocchi <a href="mailto:stefano@apache.org">stefano@apache.org</a>
  * @author Sam Ruby <a href="mailto:rubys@us.ibm.com">rubys@us.ibm.com</a>
  * @author Jon S. Stevens <a href="mailto:jon@clearink.com">jon@clearink.com</a>
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a>
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
  */
 public class FileSet extends DataType {
     
@@ -85,6 +85,15 @@ public class FileSet extends DataType {
         super();
     }
 
+    protected FileSet(FileSet fileset) {
+        this.dir = fileset.dir;
+        this.defaultPatterns = fileset.defaultPatterns;
+        this.additionalPatterns = fileset.additionalPatterns;
+        this.useDefaultExcludes = fileset.useDefaultExcludes;
+    }
+    
+    
+
     /**
      * Makes this instance in effect a reference to another PatternSet
      * instance.
@@ -93,7 +102,7 @@ public class FileSet extends DataType {
      * this element if you make it a reference.</p> 
      */
     public void setRefid(Reference r) throws BuildException {
-        if (dir != null || defaultPatterns.countPatterns() > 0) {
+        if (dir != null || defaultPatterns.hasPatterns()) {
             throw tooManyAttributes();
         }
         if (!additionalPatterns.isEmpty()) {
@@ -260,7 +269,7 @@ public class FileSet extends DataType {
      * Performs the check for circular references and returns the
      * referenced FileSet.  
      */
-    private FileSet getRef(Project p) {
+    protected FileSet getRef(Project p) {
         if (!checked) {
             Stack stk = new Stack();
             stk.push(this);
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Mapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Mapper.java
new file mode 100644
index 0000000..96a9d50
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Mapper.java
@@ -0,0 +1,271 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.types;
+
+import org.apache.tools.ant.AntClassLoader;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.util.*;
+
+import java.util.Properties;
+import java.util.Stack;
+
+/**
+ * Element to define a FileNameMapper.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class Mapper extends DataType {
+
+    protected Project p;
+
+    protected MapperType type = null;
+
+    public Mapper(Project p) {
+        this.p = p;
+    }
+
+    /**
+     * Set the type of FileNameMapper to use.
+     */
+    public void setType(MapperType type) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        this.type = type;
+    }
+
+    protected String classname = null;
+
+    /**
+     * Set the class name of the FileNameMapper to use.
+     */
+    public void setClassname(String classname) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        this.classname = classname;
+    }
+
+    protected Path classpath = null;
+
+    /**
+     * Set the classpath to load the FileNameMapper through (attribute).
+     */
+    public void setClasspath(Path classpath) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        if (this.classpath == null) {
+            this.classpath = classpath;
+        } else {
+            this.classpath.append(classpath);
+        }
+    }
+
+    /**
+     * Set the classpath to load the FileNameMapper through (nested element).
+     */
+    public Path createClasspath() {
+        if (isReference()) {
+            throw noChildrenAllowed();
+        }
+        if (this.classpath == null) {
+            this.classpath = new Path(p);
+        }
+        return this.classpath.createPath();
+    }
+
+    /**
+     * Set the classpath to load the FileNameMapper through via
+     * reference (attribute).
+     */
+    public void setClasspathRef(Reference r) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        createClasspath().setRefid(r);
+    }
+
+    protected String from = null;
+
+    /**
+     * Set the argument to FileNameMapper.setFrom
+     */
+    public void setFrom(String from) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        this.from = from;
+    }
+
+    protected String to = null;
+
+    /**
+     * Set the argument to FileNameMapper.setTo
+     */
+    public void setTo(String to) {
+        if (isReference()) {
+            throw tooManyAttributes();
+        }
+        this.to = to;
+    }
+
+    /**
+     * Make this Mapper instance a reference to another Mapper.
+     *
+     * <p>You must not set any other attribute if you make it a
+     * reference.</p>
+     */
+    public void setRefid(Reference r) throws BuildException {
+        if (type != null || from != null || to != null) {
+            throw tooManyAttributes();
+        }
+        super.setRefid(r);
+    }
+
+    /**
+     * Returns a fully configured FileNameMapper implementation.
+     */
+    public FileNameMapper getImplementation() throws BuildException {
+        if (isReference()) {
+            return getRef().getImplementation();
+        }
+        
+        if (type == null && classname == null) {
+            throw new BuildException("one of the attributes type or classname is required");
+        }
+
+        if (type != null && classname != null) {
+            throw new BuildException("must not specify both type and classname attribute");
+        }
+
+        try {
+            if (type != null) {
+                classname = type.getImplementation();
+            }
+
+            Class c = null;
+            if (classpath == null) {
+                c = Class.forName(classname);
+            } else {
+                AntClassLoader al = new AntClassLoader(p, classpath);
+                c = al.loadClass(classname);
+            }
+            
+            FileNameMapper m = (FileNameMapper) c.newInstance();
+            m.setFrom(from);
+            m.setTo(to);
+            return m;
+        } catch (BuildException be) {
+            throw be;
+        } catch (Throwable t) {
+            throw new BuildException(t);
+        } finally {
+            if (type != null) {
+                classname = null;
+            }
+        }
+    }
+        
+    /**
+     * Performs the check for circular references and returns the
+     * referenced Mapper.  
+     */
+    protected Mapper getRef() {
+        if (!checked) {
+            Stack stk = new Stack();
+            stk.push(this);
+            dieOnCircularReference(stk, p);
+        }
+        
+        Object o = ref.getReferencedObject(p);
+        if (!(o instanceof Mapper)) {
+            String msg = ref.getRefId()+" doesn\'t denote a mapper";
+            throw new BuildException(msg);
+        } else {
+            return (Mapper) o;
+        }
+    }
+
+    /**
+     * Class as Argument to FileNameMapper.setType.
+     */
+    public static class MapperType extends EnumeratedAttribute {
+        private Properties implementations;
+
+        public MapperType() {
+            implementations = new Properties();
+            implementations.put("identity", 
+                                "org.apache.tools.ant.util.IdentityMapper");
+            implementations.put("flatten", 
+                                "org.apache.tools.ant.util.FlatFileNameMapper");
+            implementations.put("glob", 
+                                "org.apache.tools.ant.util.GlobPatternMapper");
+            implementations.put("merge", 
+                                "org.apache.tools.ant.util.MergingMapper");
+            implementations.put("regexp", 
+                                "org.apache.tools.ant.util.RegexpPatternMapper");
+        }
+
+        public String[] getValues() {
+            return new String[] {"identity", "flatten", "glob", "merge", "regexp"};
+        }
+
+        public String getImplementation() {
+            return implementations.getProperty(getValue());
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Path.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Path.java
index 19814e3..6241cf1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Path.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Path.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -60,6 +60,7 @@ import org.apache.tools.ant.Project;
 import org.apache.tools.ant.PathTokenizer;
 
 import java.io.File;
+import java.io.IOException;
 import java.util.Enumeration;
 import java.util.StringTokenizer;
 import java.util.Stack;
@@ -111,7 +112,16 @@ public class Path extends DataType implements Cloneable {
         private String[] parts;
 
         public void setLocation(File loc) {
-            parts = new String[] {translateFile(loc.getAbsolutePath())};
+            try {
+                parts = new String[] {translateFile(loc.getCanonicalPath())};
+            } catch(IOException e) {
+                // XXX I'd like to log something here but if I don't
+                //     have a Project I can't
+                if (project != null) {
+                    project.log(e.getMessage(), Project.MSG_WARN);
+                }
+                parts = new String[] {translateFile(loc.getAbsolutePath())};
+            }
         }
 
         public void setPath(String path) {
@@ -294,9 +304,15 @@ public class Path extends DataType implements Cloneable {
                 String[] s = ds.getIncludedFiles();
                 File dir = fs.getDir(project);
                 for (int j=0; j<s.length; j++) {
-                    addUnlessPresent(result, 
-                                     translateFile((new File(dir, s[j])).getAbsolutePath()));
-                }
+                    String canonicalPath;
+                    File f = new File(dir, s[j]);
+                    try {
+                        canonicalPath = f.getCanonicalPath();
+                    } catch(IOException e) {
+                        canonicalPath = f.getAbsolutePath();
+                    }
+                    addUnlessPresent(result, translateFile(canonicalPath));
+                } 
             }
         }
         String[] res = new String[result.size()];
@@ -430,7 +446,13 @@ public class Path extends DataType implements Cloneable {
      */
     private static String resolveFile(Project project, String relativeName) {
         if (project != null) {
-            return project.resolveFile(relativeName).getAbsolutePath();
+            File f = project.resolveFile(relativeName);
+            try {
+                return f.getCanonicalPath();
+            } catch(IOException e) {
+                project.log(e.getMessage(), Project.MSG_WARN);
+                return f.getAbsolutePath();
+            }
         }
         return relativeName;
     }
@@ -444,4 +466,54 @@ public class Path extends DataType implements Cloneable {
         }
     }
 
+    /**
+     * Concatenates the system class path in the order specified by
+     * the ${build.sysclasspath} property - using &quot;last&quot; as
+     * default value.
+     */
+    public Path concatSystemClasspath() {
+        return concatSystemClasspath("last");
+    }
+
+    /**
+     * Concatenates the system class path in the order specified by
+     * the ${build.sysclasspath} property - using the supplied value
+     * if ${build.sysclasspath} has not been set.
+     */
+    public Path concatSystemClasspath(String defValue) {
+
+        Path result = new Path(project);
+
+        String order = project.getProperty("build.sysclasspath");
+        if (order == null) order=defValue;
+
+        if (order.equals("only")) {
+            // only: the developer knows what (s)he is doing
+            result.addExisting(Path.systemClasspath);
+        
+        } else if (order.equals("first")) {
+            // first: developer could use a little help
+            result.addExisting(Path.systemClasspath);
+            result.addExisting(this);
+
+        } else if (order.equals("ignore")) {
+            // ignore: don't trust anyone
+            result.addExisting(this);
+
+        } else {
+            // last: don't trust the developer
+            if (!order.equals("last")) {
+                project.log("invalid value for build.sysclasspath: " + order, 
+                            Project.MSG_WARN);
+            }
+
+            result.addExisting(this);
+            result.addExisting(Path.systemClasspath);
+        }
+        
+
+        return result;
+
+    }
+
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/PatternSet.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/PatternSet.java
index ddf3251..bb47032 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/PatternSet.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/PatternSet.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -55,6 +55,7 @@
 package org.apache.tools.ant.types;
 
 import org.apache.tools.ant.Project;
+import org.apache.tools.ant.ProjectHelper;
 import org.apache.tools.ant.BuildException;
 
 import java.io.*;
@@ -79,6 +80,9 @@ public class PatternSet extends DataType {
     private Vector includeList = new Vector();
     private Vector excludeList = new Vector();
     
+    private File incl = null;
+    private File excl = null;
+
     /**
      * inner class to hold a name on list.  "If" and "Unless" attributes
      * may be used to invalidate the entry based on the existence of a 
@@ -214,9 +218,8 @@ public class PatternSet extends DataType {
          if (!incl.exists()) {
              throw new BuildException("Includesfile "+incl.getAbsolutePath()
                                       +" not found.");
-         } else {
-             readPatterns(incl, includeList);
          }
+         this.incl = incl;
      }
 
     /**
@@ -231,16 +234,15 @@ public class PatternSet extends DataType {
          if (!excl.exists()) {
              throw new BuildException("Excludesfile "+excl.getAbsolutePath()
                                       +" not found.");
-         } else {
-             readPatterns(excl, excludeList);
          }
+         this.excl = excl;
      }
     
     /**
      *  Reads path matching patterns from a file and adds them to the
      *  includes or excludes list (as appropriate).  
      */
-    private void readPatterns(File patternfile, Vector patternlist)
+    private void readPatterns(File patternfile, Vector patternlist, Project p)
         throws BuildException {
         
         try {
@@ -253,6 +255,8 @@ public class PatternSet extends DataType {
             String line = patternReader.readLine();
             while (line != null) {
                 if (line.length() > 0) {
+                    line = ProjectHelper.replaceProperties(p, line,
+                                                           p.getProperties());
                     addPatternToList(patternlist).setName(line);
                 }
                 line = patternReader.readLine();
@@ -294,6 +298,7 @@ public class PatternSet extends DataType {
         if (isReference()) {
             return getRef(p).getIncludePatterns(p);
         } else {
+            readFiles(p);
             return makeArray(includeList, p);
         }
     }
@@ -305,6 +310,7 @@ public class PatternSet extends DataType {
         if (isReference()) {
             return getRef(p).getExcludePatterns(p);
         } else {
+            readFiles(p);
             return makeArray(excludeList, p);
         }
     }
@@ -312,8 +318,9 @@ public class PatternSet extends DataType {
     /**
      * helper for FileSet.
      */
-    int countPatterns() {
-        return includeList.size() + excludeList.size();
+    boolean hasPatterns() {
+        return incl != null || excl != null
+            || includeList.size() > 0 || excludeList.size() > 0;
     }
 
     /**
@@ -356,4 +363,18 @@ public class PatternSet extends DataType {
         return result;
     }
         
+    /**
+     * Read includefile ot excludefile if not already done so.
+     */
+    private void readFiles(Project p) {
+        if (incl != null) {
+            readPatterns(incl, includeList, p);
+            incl = null;
+        }
+        if (excl != null) {
+            readPatterns(excl, excludeList, p);
+            excl = null;
+        }
+    }
+
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Reference.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Reference.java
index 97f4a94..0b3fae2 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Reference.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/Reference.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipFileSet.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipFileSet.java
new file mode 100644
index 0000000..7f67932
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipFileSet.java
@@ -0,0 +1,177 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.tools.ant.types;
+
+import java.io.File;
+import java.util.Stack;
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.DirectoryScanner;
+import org.apache.tools.ant.Project;
+
+/**
+ * A ZipFileSet is a FileSet with extra attributes useful in the context of 
+ * Zip/Jar tasks.
+ *
+ * A ZipFileSet extends FileSets with the ability to extract a subset of the
+ * entries of a Zip file for inclusion in another Zip file.  It also includes
+ * a prefix attribute which is prepended to each entry in the output Zip file.
+ *
+ * At present, ZipFileSets are not surfaced in the public API.  FileSets
+ * nested in a Zip task are instantiated as ZipFileSets, and their attributes
+ * are only recognized in the context of the the Zip task.
+ * It is not possible to define a ZipFileSet outside of the Zip task and
+ * refer to it via a refid.  However a standard FileSet may be included by
+ * reference in the Zip task, and attributes in the refering ZipFileSet
+ * can augment FileSet definition.
+ *
+ * @author Don Ferguson <a href="mailto:don@bea.com">don@bea.com</a>
+ */
+public class ZipFileSet extends FileSet {
+
+    private File srcFile          = null;
+    private String prefix         = "";
+    private String fullpath       = "";
+    private boolean hasDir        = false;
+
+    /**
+     * Set the directory for the fileset.  Prevents both "dir" and "src"
+     * from being specified.
+     */
+    public void setDir(File dir) throws BuildException {
+        if (srcFile != null) {
+            throw new BuildException("Cannot set both dir and src attributes");
+        } else {
+            super.setDir(dir);
+            hasDir = true;
+        }
+    }
+
+    /**
+     * Set the source Zip file for the zipfileset.  Prevents both
+     * "dir" and "src" from being specified.
+     *
+     * @param srcFile The zip file from which to extract entries.
+     */
+    public void setSrc(File srcFile) {
+        if (hasDir) {
+            throw new BuildException("Cannot set both dir and src attributes");
+        }
+        this.srcFile = srcFile;
+    }
+
+    /**
+     * Get the zip file from which entries will be extracted.
+     * References are not followed, since it is not possible
+     * to have a reference to a ZipFileSet, only to a FileSet.
+     */
+    public File getSrc() {
+        return srcFile;
+    }
+
+    /**
+     * Prepend this prefix to the path for each zip entry.
+     * Does not perform reference test; the referenced file set
+     * can be augmented with a prefix.
+     *
+     * @param prefix The prefix to prepend to entries in the zip file.
+     */
+    public void setPrefix(String prefix) {
+        this.prefix = prefix;
+    }
+
+    /**
+     * Return the prefix prepended to entries in the zip file.
+     */
+    public String getPrefix() {
+        return prefix;
+    }
+
+    /**
+     * Set the full pathname of the single entry in this fileset.
+     *
+     * @param prefix The prefix to prepend to entries in the zip file.
+     */
+    public void setFullpath(String fullpath) {
+        this.fullpath = fullpath;
+    }
+
+    /**
+     * Return the full pathname of the single entry in this fileset.
+     */
+    public String getFullpath() {
+        return fullpath;
+    }
+
+    /**
+     * Return the DirectoryScanner associated with this FileSet.
+     * If the ZipFileSet defines a source Zip file, then a ZipScanner
+     * is returned instead.
+     */
+    public DirectoryScanner getDirectoryScanner(Project p) {
+        if (isReference()) {
+            return getRef(p).getDirectoryScanner(p);
+        }
+        if (srcFile != null) {
+            ZipScanner zs = new ZipScanner();
+            zs.setSrc(srcFile);
+            super.setDir(new File("."));
+            setupDirectoryScanner(zs, p);
+            zs.init();
+            return zs;
+        } else {
+            return super.getDirectoryScanner(p);
+        }
+    }    
+  
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipScanner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipScanner.java
new file mode 100644
index 0000000..85178f1
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/ZipScanner.java
@@ -0,0 +1,138 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.types;
+
+import org.apache.tools.ant.DirectoryScanner;
+import java.io.File;
+
+/**
+ * ZipScanner accesses the pattern matching algorithm in DirectoryScanner,
+ * which are protected methods that can only be accessed by subclassing.
+ *
+ * This implementation of FileScanner defines getIncludedFiles to return
+ * only the Zip File which is being scanned, not the matching Zip entries.
+ * Arguably, it should return the matching entries, however this would
+ * complicate existing code which assumes that FileScanners return a
+ * set of file system files that can be accessed directly.
+ * 
+ * @author Don Ferguson <a href="mailto:don@bea.com">don@bea.com</a>
+ */
+public class ZipScanner extends DirectoryScanner {
+
+    /**
+     * The zip file which should be scanned.
+     */
+    protected File srcFile;
+
+    /**
+     * Sets the srcFile for scanning. This is the jar or zip file that is scanned
+     * for matching entries.
+     *
+     * @param srcFile the (non-null) zip file name for scanning
+     */
+    public void setSrc(File srcFile) {
+        this.srcFile = srcFile;
+    }
+
+    /**
+     * Returns the zip file itself, not the matching entries within the zip file.
+     * This keeps the uptodate test in the Zip task simple; otherwise we'd need
+     * to treat zip filesets specially.
+     *
+     * @return the source file from which entries will be extracted.
+     */
+    public String[] getIncludedFiles() {
+        String[] result = new String[1];
+        result[0] = srcFile.getAbsolutePath();
+        return result;
+    }
+
+    /**
+     * Returns an empty list of directories to create.
+     */
+    public String[] getIncludedDirectories() {
+        return new String[0];
+    }
+
+    /**
+     * Initialize DirectoryScanner data structures.
+     */
+    public void init() {
+        if (includes == null) {
+            // No includes supplied, so set it to 'matches all'
+            includes = new String[1];
+            includes[0] = "**";
+        }
+        if (excludes == null) {
+            excludes = new String[0];
+        }
+    }
+
+    /**
+     * Matches a jar entry against the includes/excludes list,
+     * normalizing the path separator.
+     *
+     * @param path the (non-null) path name to test for inclusion
+     *
+     * @return <code>true</code> if the path should be included
+     *         <code>false</code> otherwise.
+     */
+    public boolean match(String path) {
+        String vpath = path.replace('/', File.separatorChar).
+            replace('\\', File.separatorChar);
+        return isIncluded(vpath) && !isExcluded(vpath);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/defaults.properties b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/defaults.properties
index 48dd09a..fe10486 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/defaults.properties
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/types/defaults.properties
@@ -1,3 +1,4 @@
 path=org.apache.tools.ant.types.Path
 fileset=org.apache.tools.ant.types.FileSet
 patternset=org.apache.tools.ant.types.PatternSet
+mapper=org.apache.tools.ant.types.Mapper
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/DOMElementWriter.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/DOMElementWriter.java
new file mode 100644
index 0000000..cc44790
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/DOMElementWriter.java
@@ -0,0 +1,240 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+import java.io.*;
+import org.w3c.dom.*;
+
+/**
+ * Writes a DOM tree to a given Writer.
+ *
+ * <p>Utility class used by {@link org.apache.tools.ant.XmlLogger
+ * XmlLogger} and
+ * org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter
+ * XMLJUnitResultFormatter}.</p>
+ *
+ * @author The original author of XmlLogger
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ * @author <a href="mailto:bailliez@noos.fr">Stephane Bailliez</tt>
+ */
+public class DOMElementWriter {
+
+    private static String lSep = System.getProperty("line.separator");
+    private StringBuffer sb = new StringBuffer();
+
+    /**
+     * Don't try to be too smart but at least recognize the predefined
+     * entities.
+     */
+    protected String[] knownEntities = {"gt", "amp", "lt", "apos", "quot"};
+    
+    /**
+     * Writes a DOM tree to a stream.
+     *
+     * @param element the Root DOM element of the tree
+     * @param out where to send the output
+     * @param indent number of 
+     * @param indentWith strings, 
+     *       that should be used to indent the corresponding tag.
+     */
+    public void write(Element element, Writer out, int indent, 
+                      String indentWith)
+        throws IOException {
+
+        // Write indent characters
+        for (int i = 0; i < indent; i++) {
+            out.write(indentWith);
+        }
+
+        // Write element
+        out.write("<");
+        out.write(element.getTagName());
+
+        // Write attributes
+        NamedNodeMap attrs = element.getAttributes();
+        for (int i = 0; i < attrs.getLength(); i++) {
+            Attr attr = (Attr) attrs.item(i);
+            out.write(" ");
+            out.write(attr.getName());
+            out.write("=\"");
+            out.write(encode(attr.getValue()));
+            out.write("\"");
+        }
+        out.write(">");
+
+        // Write child elements and text
+        boolean hasChildren = false;
+        NodeList children = element.getChildNodes();
+        for (int i = 0; i < children.getLength(); i++) {
+            Node child = children.item(i);
+
+            switch (child.getNodeType()) {
+                
+            case Node.ELEMENT_NODE:
+                if (!hasChildren) {
+                    out.write(lSep);
+                    hasChildren = true;
+                }
+                write((Element)child, out, indent + 1, indentWith);
+                break;
+                
+            case Node.TEXT_NODE:
+            case Node.CDATA_SECTION_NODE:
+                out.write("<![CDATA[");
+                out.write(((Text)child).getData());
+                out.write("]]>");
+                break;
+
+            case Node.ENTITY_REFERENCE_NODE:
+                out.write('&');
+                out.write(child.getNodeName());
+                out.write(';');
+                break;
+
+            case Node.PROCESSING_INSTRUCTION_NODE:
+                out.write("<?");
+                out.write(child.getNodeName());
+                String data = child.getNodeValue();
+                if ( data != null && data.length() > 0 ) {
+                    out.write(' ');
+                    out.write(data);
+                }
+                out.write("?>");
+                break;
+            }
+        }
+
+        // If we had child elements, we need to indent before we close
+        // the element, otherwise we're on the same line and don't need
+        // to indent
+        if (hasChildren) {
+            for (int i = 0; i < indent; i++) {
+                out.write(indentWith);
+            }
+        }
+
+        // Write element close
+        out.write("</");
+        out.write(element.getTagName());
+        out.write(">");
+        out.write(lSep);
+    }
+
+    /**
+     * Escape &lt;, &amp; and &quot; as their entities.
+     */
+    public String encode(String value) {
+        sb.setLength(0);
+        for (int i=0; i<value.length(); i++) {
+            char c = value.charAt(i);
+            switch (c) {
+            case '<':
+                sb.append("&lt;");
+                break;
+            case '\"':
+                sb.append("&quot;");
+                break;
+            case '&':
+                int nextSemi = value.indexOf(";", i);
+                if (nextSemi < 0
+                    || !isReference(value.substring(i, nextSemi+1))) {
+                    sb.append("&amp;");
+                } else {
+                    sb.append('&');
+                }
+                break;
+            default:
+                sb.append(c);
+                break;
+            }
+        }
+        return sb.toString();
+    }
+
+    /**
+     * Is the given argument a character or entity reference?
+     */
+    public boolean isReference(String ent) {
+        if (!(ent.charAt(0) == '&') || !ent.endsWith(";")) {
+            return false;
+        }
+
+        if (ent.charAt(1) == '#') {
+            if (ent.charAt(2) == 'x') {
+                try {
+                    Integer.parseInt(ent.substring(3, ent.length()-1), 16);
+                    return true;
+                } catch (NumberFormatException nfe) {
+                    return false;
+                }
+            } else {
+                try {
+                    Integer.parseInt(ent.substring(2, ent.length()-1));
+                    return true;
+                } catch (NumberFormatException nfe) {
+                    return false;
+                }
+            }
+        }
+
+        String name = ent.substring(1, ent.length() - 1);
+        for (int i=0; i<knownEntities.length; i++) {
+            if (name.equals(knownEntities[i])) {
+                return true;
+            }
+        }
+        return false;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FileNameMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FileNameMapper.java
new file mode 100644
index 0000000..5a732ac
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FileNameMapper.java
@@ -0,0 +1,93 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+/**
+ * Interface to be used by SourceFileScanner.
+ *
+ * <p>Used to find the name of the target file(s) corresponding to a
+ * source file.</p>
+ *
+ * <p>The rule by which the file names are transformed is specified
+ * via the setFrom and setTo methods. The exact meaning of these is
+ * implementation dependent.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public interface FileNameMapper {
+
+    /**
+     * Sets the from part of the transformation rule.
+     */
+    public void setFrom(String from);
+
+    /**
+     * Sets the to part of the transformation rule.
+     */
+    public void setTo(String to);
+
+    /**
+     * Returns an array containing the target filename(s) for the
+     * given source file.
+     *
+     * <p>if the given rule doesn't apply to the source file,
+     * implementation must return null. SourceFileScanner will then
+     * omit the source file in question.</p> 
+     *
+     * @param sourceFileName the name of the source file relative to
+     *                       some given basedirectory.
+     */
+    public String[] mapFileName(String sourceFileName);
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FlatFileNameMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FlatFileNameMapper.java
new file mode 100644
index 0000000..4412d17
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/FlatFileNameMapper.java
@@ -0,0 +1,85 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+/**
+ * Implementation of FileNameMapper that always returns the source
+ * file name without any leading directory information.
+ *
+ * <p>This is the default FileNameMapper for the copy and move
+ * tasks if the flatten attribute has been set.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class FlatFileNameMapper implements FileNameMapper {
+
+    /**
+     * Ignored.
+     */
+    public void setFrom(String from) {}
+
+    /**
+     * Ignored.
+     */
+    public void setTo(String to) {}
+
+    /**
+     * Returns an one-element array containing the source file name
+     * without any leading directory information.
+     */
+    public String[] mapFileName(String sourceFileName) {
+        return new String[] {new java.io.File(sourceFileName).getName()};
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/GlobPatternMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/GlobPatternMapper.java
new file mode 100644
index 0000000..d2ca22a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/GlobPatternMapper.java
@@ -0,0 +1,156 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+/**
+ * Implementation of FileNameMapper that does simple wildcard pattern
+ * replacements.
+ *
+ * <p>This does simple translations like *.foo -> *.bar where the
+ * prefix to .foo will be left unchanged. It only handles a single *
+ * character, use regular expressions for more complicated
+ * situations.</p>
+ *
+ * <p>This is one of the more useful Mappers, it is used by javac for
+ * example.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class GlobPatternMapper implements FileNameMapper {
+    /**
+     * Part of &quot;from&quot; pattern before the *.
+     */
+    protected String fromPrefix = null;
+
+    /**
+     * Part of &quot;from&quot; pattern after the *.
+     */
+    protected String fromPostfix = null;
+    
+    /**
+     * Length of the prefix (&quot;from&quot; pattern).
+     */
+    protected int prefixLength;
+
+    /**
+     * Length of the postfix (&quot;from&quot; pattern).
+     */
+    protected int postfixLength;
+
+    /**
+     * Part of &quot;to&quot; pattern before the *.
+     */
+    protected String toPrefix = null;
+
+    /**
+     * Part of &quot;to&quot; pattern after the *.
+     */
+    protected String toPostfix = null;
+    
+    /**
+     * Sets the &quot;from&quot; pattern. Required.
+     */
+    public void setFrom(String from) {
+        int index = from.lastIndexOf("*");
+        if (index == -1) {
+            fromPrefix = from;
+            fromPostfix = "";
+        } else {
+            fromPrefix = from.substring(0, index);
+            fromPostfix = from.substring(index+1);
+        }
+        prefixLength = fromPrefix.length();
+        postfixLength = fromPostfix.length();
+    }
+
+    /**
+     * Sets the &quot;to&quot; pattern. Required.
+     */
+    public void setTo(String to) {
+        int index = to.lastIndexOf("*");
+        if (index == -1) {
+            toPrefix = to;
+            toPostfix = "";
+        } else {
+            toPrefix = to.substring(0, index);
+            toPostfix = to.substring(index+1);
+        }
+    }
+
+    /**
+     * Returns null if the source file name doesn't match the
+     * &quot;from&quot; pattern, an one-element array containing the
+     * translated file otherwise.
+     */
+    public String[] mapFileName(String sourceFileName) {
+        if (fromPrefix == null 
+            || !sourceFileName.startsWith(fromPrefix) 
+            || !sourceFileName.endsWith(fromPostfix)) {
+            return null;
+        }
+        return new String[] {toPrefix 
+                                 + extractVariablePart(sourceFileName)
+                                 + toPostfix};
+    }
+
+    /**
+     * Returns the part of the given string that matches the * in the
+     * &quot;from&quot; pattern.
+     */
+    protected String extractVariablePart(String name) {
+        return name.substring(prefixLength,
+                              name.length() - postfixLength);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/IdentityMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/IdentityMapper.java
new file mode 100644
index 0000000..587150a
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/IdentityMapper.java
@@ -0,0 +1,83 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+/**
+ * Implementation of FileNameMapper that always returns the source file name.
+ *
+ * <p>This is the default FileNameMapper for the copy and move
+ * tasks.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class IdentityMapper implements FileNameMapper {
+
+    /**
+     * Ignored.
+     */
+    public void setFrom(String from) {}
+
+    /**
+     * Ignored.
+     */
+    public void setTo(String to) {}
+
+    /**
+     * Returns an one-element array containing the source file name.
+     */
+    public String[] mapFileName(String sourceFileName) {
+        return new String[] {sourceFileName};
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/MergingMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/MergingMapper.java
new file mode 100644
index 0000000..524b7ad
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/MergingMapper.java
@@ -0,0 +1,88 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+/**
+ * Implementation of FileNameMapper that always returns the same
+ * target file name.
+ *
+ * <p>This is the default FileNameMapper for the archiving tasks and
+ * uptodate.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class MergingMapper implements FileNameMapper {
+    protected String[] mergedFile = null;
+
+    /**
+     * Ignored.
+     */
+    public void setFrom(String from) {}
+
+    /**
+     * Sets the name of the merged file.
+     */
+    public void setTo(String to) {
+        mergedFile = new String[] {to};
+    }
+
+    /**
+     * Returns an one-element array containing the file name set via setTo.
+     */
+    public String[] mapFileName(String sourceFileName) {
+        return mergedFile;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/RegexpPatternMapper.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/RegexpPatternMapper.java
new file mode 100644
index 0000000..8ec4f4d
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/RegexpPatternMapper.java
@@ -0,0 +1,141 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.util.regexp.RegexpMatcher;
+import org.apache.tools.ant.util.regexp.RegexpMatcherFactory;
+
+import java.util.Enumeration;
+import java.util.Vector;
+
+/**
+ * Implementation of FileNameMapper that does regular expression
+ * replacements.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class RegexpPatternMapper implements FileNameMapper {
+    protected RegexpMatcher reg = null;
+    protected char[] to = null;
+    protected StringBuffer result = new StringBuffer();
+
+    public RegexpPatternMapper() throws BuildException {
+        reg = (new RegexpMatcherFactory()).newRegexpMatcher();
+    }
+    
+    /**
+     * Sets the &quot;from&quot; pattern. Required.
+     */
+    public void setFrom(String from) throws BuildException {
+        try {
+            reg.setPattern(from);
+        } catch (NoClassDefFoundError e) {
+            // depending on the implementation the actual RE won't
+            // get instantiated in the constructor.
+            throw new BuildException("Cannot load regular expression matcher",
+                                     e);
+        }
+    }
+
+    /**
+     * Sets the &quot;to&quot; pattern. Required.
+     */
+    public void setTo(String to) {
+        this.to = to.toCharArray();
+    }
+
+    /**
+     * Returns null if the source file name doesn't match the
+     * &quot;from&quot; pattern, an one-element array containing the
+     * translated file otherwise.
+     */
+    public String[] mapFileName(String sourceFileName) {
+        if (reg == null  || to == null
+            || !reg.matches(sourceFileName)) {
+            return null;
+        }
+        return new String[] {replaceReferences(sourceFileName)};
+    }
+
+    /**
+     * Replace all backreferences in the to pattern with the matched
+     * groups of the source.
+     */
+    protected String replaceReferences(String source) {
+        Vector v = reg.getGroups(source);
+        
+        result.setLength(0);
+        for (int i=0; i<to.length; i++) {
+            if (to[i] == '\\') {
+                if (++i < to.length) {
+                    int value = Character.digit(to[i], 10);
+                    if (value > -1) {
+                        result.append((String) v.elementAt(value));
+                    } else {
+                        result.append(to[i]);
+                    }
+                } else {
+                    // XXX - should throw an exception instead?
+                    result.append('\\');
+                }
+            } else {
+                result.append(to[i]);
+            }
+        }
+        return result.toString();
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/SourceFileScanner.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/SourceFileScanner.java
new file mode 100644
index 0000000..57d7771
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/SourceFileScanner.java
@@ -0,0 +1,181 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.Task;
+
+import java.io.File;
+import java.util.Vector;
+
+/**
+ * Utility class that collects the functionality of the various
+ * scanDir methods that have been scattered in several tasks before.
+ *
+ * <p>The only method returns an array of source files. The array is a
+ * subset of the files given as a parameter and holds only those that
+ * are newer than their corresponding target files.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a>
+ */
+public class SourceFileScanner {
+
+    protected Task task;
+
+    /**
+     * @param task The task we should log messages through
+     */
+    public SourceFileScanner(Task task) {
+        this.task = task;
+    }
+
+    /**
+     * Restrict the given set of files to those that are newer than
+     * their corresponding target files.
+     *
+     * @param files   the original set of files
+     * @param srcDir  all files are relative to this directory
+     * @param destDir target files live here. if null file names
+     *                returned by the mapper are assumed to be absolute.
+     * @param mapper  knows how to construct a target file names from
+     *                source file names.
+     */
+    public String[] restrict(String[] files, File srcDir, File destDir,
+                             FileNameMapper mapper) {
+
+        long now = (new java.util.Date()).getTime();
+        StringBuffer targetList = new StringBuffer();
+
+        /*
+          If we're on Windows, we have to munge the time up to 2 secs to
+          be able to check file modification times.
+          (Windows has a max resolution of two secs for modification times)
+        */
+        String osname = System.getProperty("os.name").toLowerCase();
+        if ( osname.indexOf("windows") >= 0 ) {
+            now += 2000;
+        }
+
+        Vector v = new Vector();
+        for (int i=0; i< files.length; i++) {
+
+            String[] targets = mapper.mapFileName(files[i]);
+            if (targets == null || targets.length == 0) {
+                task.log(files[i]+" skipped - don\'t know how to handle it",
+                         Project.MSG_VERBOSE);
+                continue;
+            }
+
+            File src = new File(srcDir, files[i]);
+            if (src.lastModified() > now) {
+                task.log("Warning: "+files[i]+" modified in the future.", 
+                         Project.MSG_WARN);
+            }
+
+            boolean added = false;
+            targetList.setLength(0);
+            for (int j=0; !added && j<targets.length; j++) {
+                File dest = null;
+                if (destDir == null) {
+                    dest = new File(targets[j]);
+                } else {
+                    dest = new File(destDir, targets[j]);
+                }
+                
+                if (!dest.exists()) {
+                    task.log(files[i]+" added as "+dest.getAbsolutePath()+" doesn\'t exist.",
+                             Project.MSG_VERBOSE);
+                    v.addElement(files[i]);
+                    added = true;
+                } else if (src.lastModified() > dest.lastModified()) {
+                    task.log(files[i]+" added as "+dest.getAbsolutePath()+" is outdated.",
+                             Project.MSG_VERBOSE);
+                    v.addElement(files[i]);
+                    added = true;
+                } else {
+                    if (targetList.length() > 0) {
+                        targetList.append(", ");
+                    }
+                    targetList.append(dest.getAbsolutePath());
+                }
+            }
+
+            if (!added) {
+                task.log(files[i]+" omitted as "+targetList.toString()
+                         + (targets.length == 1 ? " is" : " are ")
+                         + " up to date.", Project.MSG_VERBOSE);
+            }
+            
+        }
+        String[] result = new String[v.size()];
+        v.copyInto(result);
+        return result;
+    }
+
+    /**
+     * Convinience layer on top of restrict that returns the source
+     * files as File objects (containing absolute paths if srcDir is
+     * absolute).
+     */
+    public File[] restrictAsFiles(String[] files, File srcDir, File destDir,
+                                  FileNameMapper mapper) {
+        String[] res = restrict(files, srcDir, destDir, mapper);
+        File[] result = new File[res.length];
+        for (int i=0; i<res.length; i++) {
+            result[i] = new File(srcDir, res[i]);
+        }
+        return result;
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaOroMatcher.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaOroMatcher.java
new file mode 100644
index 0000000..c2baf24
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaOroMatcher.java
@@ -0,0 +1,116 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+import org.apache.oro.text.regex.*;
+
+import org.apache.tools.ant.BuildException;
+import java.util.Vector;
+
+/**
+ * Implementation of RegexpMatcher for Jakarta-ORO.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class JakartaOroMatcher implements RegexpMatcher {
+
+    protected Perl5Matcher reg = new Perl5Matcher();
+    protected Perl5Compiler comp = new Perl5Compiler();
+    private Pattern pattern;
+
+    /**
+     * Set the regexp pattern from the String description.
+     */
+    public void setPattern(String pattern) throws BuildException {
+        try {
+            this.pattern = comp.compile(pattern);
+        } catch (MalformedPatternException e) {
+            throw new BuildException(e);
+        }
+    }
+
+    /**
+     * Get a String representation of the regexp pattern
+     */
+    public String getPattern() {
+        return pattern.getPattern();
+    }
+
+    /**
+     * Does the given argument match the pattern?
+     */
+    public boolean matches(String argument) {
+        return reg.contains(argument, pattern);
+    }
+
+    /**
+     * Returns a Vector of matched groups found in the argument.
+     *
+     * <p>Group 0 will be the full match, the rest are the
+     * parenthesized subexpressions</p>.
+     */
+    public Vector getGroups(String argument) {
+        if (!matches(argument)) {
+            return null;
+        }
+        Vector v = new Vector();
+        MatchResult mr = reg.getMatch();
+        for (int i=0; i<mr.groups(); i++) {
+            v.addElement(mr.group(i));
+        }
+        return v;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaRegexpMatcher.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaRegexpMatcher.java
new file mode 100644
index 0000000..2207e0c
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/JakartaRegexpMatcher.java
@@ -0,0 +1,115 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+import org.apache.regexp.*;
+
+import org.apache.tools.ant.BuildException;
+import java.util.Vector;
+
+/**
+ * Implementation of RegexpMatcher for Jakarta-Regexp.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class JakartaRegexpMatcher implements RegexpMatcher {
+
+    protected RE reg = null;
+    private String pattern;
+
+    /**
+     * Set the regexp pattern from the String description.
+     */
+    public void setPattern(String pattern) throws BuildException {
+        try {
+            this.pattern = pattern;
+            reg = new RE(pattern);
+        } catch (RESyntaxException e) {
+            throw new BuildException(e);
+        }
+    }
+
+    /**
+     * Get a String representation of the regexp pattern
+     */
+    public String getPattern() {
+        return pattern;
+    }
+
+    /**
+     * Does the given argument match the pattern?
+     */
+    public boolean matches(String argument) {
+        return reg.match(argument);
+    }
+
+    /**
+     * Returns a Vector of matched groups found in the argument.
+     *
+     * <p>Group 0 will be the full match, the rest are the
+     * parenthesized subexpressions</p>.
+     */
+    public Vector getGroups(String argument) {
+        if (!matches(argument)) {
+            return null;
+        }
+        Vector v = new Vector();
+        for (int i=0; i<reg.getParenCount(); i++) {
+            v.addElement(reg.getParen(i));
+        }
+        return v;
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcher.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcher.java
new file mode 100644
index 0000000..8591f83
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcher.java
@@ -0,0 +1,89 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+import org.apache.tools.ant.BuildException;
+import java.util.Vector;
+
+/**
+ * Interface describing a regular expression matcher.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public interface RegexpMatcher {
+
+    /**
+     * Set the regexp pattern from the String description.
+     */
+    public void setPattern(String pattern) throws BuildException;
+
+    /**
+     * Get a String representation of the regexp pattern
+     */
+    public String getPattern();
+
+    /**
+     * Does the given argument match the pattern?
+     */
+    public boolean matches(String argument);
+
+    /**
+     * Returns a Vector of matched groups found in the argument.
+     *
+     * <p>Group 0 will be the full match, the rest are the
+     * parenthesized subexpressions</p>.
+     */
+    public Vector getGroups(String argument);
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcherFactory.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcherFactory.java
new file mode 100644
index 0000000..76c5536
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/ant/util/regexp/RegexpMatcherFactory.java
@@ -0,0 +1,102 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer. 
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:  
+ *       "This product includes software developed by the 
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written 
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+import org.apache.tools.ant.BuildException;
+
+/**
+ * Simple Factory Class that produces an implementation of
+ * RegexpMatcher based on the system property
+ * <code>ant.regexp.matcherimpl</code> and the classes
+ * available.
+ * 
+ * <p>In a more general framework this class would be abstract and
+ * have a static newInstance method.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class RegexpMatcherFactory {
+
+    public RegexpMatcherFactory() {}
+
+    public RegexpMatcher newRegexpMatcher() throws BuildException {
+        String systemDefault = System.getProperty("ant.regexp.matcherimpl");
+        if (systemDefault != null) {
+            return createInstance(systemDefault);
+            // XXX     should we silently possible exceptions and try to 
+            //         load a different implementation?
+        }
+
+        try {
+            return createInstance("org.apache.tools.ant.util.regexp.JakartaOroMatcher");
+        } catch (BuildException be) {}
+        
+        try {
+            return createInstance("org.apache.tools.ant.util.regexp.JakartaRegexpMatcher");
+        } catch (BuildException be) {}
+
+        throw new BuildException("No supported regular expression matcher found");
+   }
+
+    protected RegexpMatcher createInstance(String className) 
+        throws BuildException {
+        try {
+            Class implClass = Class.forName(className);
+            return (RegexpMatcher) implClass.newInstance();
+        } catch (Throwable t) {
+            throw new BuildException(t);
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/MailMessage.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/MailMessage.java
index 601ab87..26585c1 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/MailMessage.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/MailMessage.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -125,7 +125,7 @@ public class MailMessage {
   Vector to, cc;
   Hashtable headers;
   MailPrintStream out;
-  BufferedReader in;
+  SmtpResponseReader in;
   Socket socket;
 
   /**
@@ -150,7 +150,7 @@ public class MailMessage {
     to = new Vector();
     cc = new Vector();
     headers = new Hashtable();
-    setHeader("X-Mailer", "com.oreilly.servlet.MailMessage (www.servlets.com)");
+    setHeader("X-Mailer", "org.apache.tools.mail.MailMessage (jakarta.apache.org)");
     connect();
     sendHelo();
   }
@@ -276,6 +276,7 @@ public class MailMessage {
    */
   public void sendAndClose() throws IOException {
     sendDot();
+    sendQuit();
     disconnect();
   }
 
@@ -323,12 +324,12 @@ public class MailMessage {
     out = new MailPrintStream(
           new BufferedOutputStream(
           socket.getOutputStream())); 
-    in = new BufferedReader(new InputStreamReader(socket.getInputStream())); 
+    in = new SmtpResponseReader(socket.getInputStream());
     getReady();
   }
 
   void getReady() throws IOException {
-    String response = in.readLine();
+    String response = in.getResponse();
     int[] ok = { 220 };
     if (!isResponseOK(response, ok)) {
       throw new IOException(
@@ -370,7 +371,7 @@ public class MailMessage {
   void send(String msg, int[] ok) throws IOException {
     out.rawPrint(msg + "\r\n");  // raw supports <CRLF>.<CRLF>
     //System.out.println("S: " + msg);
-    String response = in.readLine();
+    String response = in.getResponse();
     //System.out.println("R: " + response);
     if (!isResponseOK(response, ok)) {
       throw new IOException(
@@ -440,3 +441,4 @@ class MailPrintStream extends PrintStream {
     }
   }
 }
+
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/SmtpResponseReader.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/SmtpResponseReader.java
new file mode 100644
index 0000000..1d90767
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/mail/SmtpResponseReader.java
@@ -0,0 +1,122 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 1999 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ */
+
+package org.apache.tools.mail;
+
+import java.io.*;
+
+/**
+ * A wrapper around the raw input from the SMTP server that assembles
+ * multi line responses into a single String.
+ *
+ * <p>The same rules used here would apply to FTP and other Telnet
+ * based protocols as well.</p>
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class SmtpResponseReader {
+
+    protected BufferedReader reader = null;
+    private StringBuffer result = new StringBuffer();
+
+    /**
+     * Wrap this input stream.
+     */
+    public SmtpResponseReader(InputStream in) {
+        reader = new BufferedReader(new InputStreamReader(in)); 
+    }
+
+    /**
+     * Read until the server indicates that the response is complete.
+     *
+     * @return Responsecode (3 digits) + Blank + Text from all
+     *         response line concatenated (with blanks replacing the \r\n
+     *         sequences).
+     */
+    public String getResponse() throws IOException {
+        result.setLength(0);
+        String line = reader.readLine();
+        if (line != null) {
+            result.append(line.substring(0, 3));
+            result.append(" ");
+        }
+        
+        while (line != null) {
+            append(line);
+            if (!hasMoreLines(line)) {
+                break;
+            }
+            line = reader.readLine();
+        }
+        return result.toString().trim();
+    }
+
+    /**
+     * Closes the underlying stream.
+     */
+    public void close() throws IOException {
+        reader.close();
+    }
+
+    /**
+     * Should we expect more input?
+     */
+    protected boolean hasMoreLines(String line) {
+        return line.charAt(3) == '-';
+    }
+
+    /**
+     * Append the text from this line of the resonse.
+     */
+    private void append(String line) {
+        result.append(line.substring(4));
+        result.append(" ");
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarBuffer.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarBuffer.java
index dbf9166..5059b8f 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarBuffer.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarBuffer.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarConstants.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarConstants.java
index 41b76c3..fe4a699 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarConstants.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarConstants.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written 
  *    permission, please contact apache@apache.org.
@@ -179,4 +179,13 @@ public interface TarConstants {
      */
     public static final String GNU_TMAGIC = "ustar  ";
 
+    /**
+     * The namr of the GNU tar entry which contains a long name.
+     */
+    public static final String GNU_LONGLINK = "././@LongLink";
+    
+    /**
+     * Identifies the *next* file on the tape as having a long name.  
+     */
+    public static final byte LF_GNUTYPE_LONGNAME = (byte) 'L';
 }
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarEntry.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarEntry.java
index 436579d..451def9 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarEntry.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarEntry.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -177,6 +177,15 @@ public class TarEntry implements TarConstants {
         this.groupName = new StringBuffer("");
         this.devMajor = 0;
         this.devMinor = 0;
+
+    }   
+        
+    /** 
+     * Construct an entry with a name an a link flag.
+     */ 
+    public TarEntry(String name, byte linkFlag) {
+        this(name);
+        this.linkFlag = linkFlag;
     }   
         
     /** 
@@ -238,14 +247,6 @@ public class TarEntry implements TarConstants {
             this.linkFlag = LF_NORMAL;
         } 
         
-        if (this.name.length() > NAMELEN) {
-            throw new RuntimeException("file name '" + this.name 
-                                             + "' is too long ( > " 
-                                             + NAMELEN + " bytes)");
-        
-            // UNDONE When File lets us get the userName, use it!
-        } 
-        
         this.size = file.length();
         this.modTime = file.lastModified() / 1000;
         this.checkSum = 0;
@@ -304,6 +305,14 @@ public class TarEntry implements TarConstants {
     public void setName(String name) {
         this.name = new StringBuffer(name);
     }   
+
+    /**
+     * Set the mode for this entry
+     */
+    public void setMode(int mode) {
+        this.mode = mode;
+    }
+    
         
     /** 
      * Get this entry's user id.
@@ -453,7 +462,18 @@ public class TarEntry implements TarConstants {
     public void setSize(long size) {
         this.size = size;
     }   
+
         
+    /**
+     * Indicate if this entry is a GNU long name block
+     *
+     * @return true if this is a long name extension provided by GNU tar
+     */
+    public boolean isGNULongNameEntry() {
+        return linkFlag == LF_GNUTYPE_LONGNAME &&
+               name.toString().equals(GNU_LONGLINK);
+    }               
+
     /** 
      * Return whether or not this entry represents a directory.
      *  
@@ -568,5 +588,5 @@ public class TarEntry implements TarConstants {
         this.devMajor = (int) TarUtils.parseOctal(header, offset, DEVLEN);
         offset += DEVLEN;
         this.devMinor = (int) TarUtils.parseOctal(header, offset, DEVLEN);
-    }        
+    }
 }       
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarInputStream.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarInputStream.java
index a075898..00ad9c3 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarInputStream.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarInputStream.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -286,6 +286,18 @@ public class TarInputStream extends FilterInputStream {
             this.entrySize = (int) this.currEntry.getSize();
         } 
 
+        if (this.currEntry != null && this.currEntry.isGNULongNameEntry()) {
+            // read in the name
+            StringBuffer longName = new StringBuffer();
+            byte[] buffer = new byte[256];
+            int length = 0;
+            while ((length = read(buffer)) >= 0) {
+                longName.append(new String(buffer, 0, length));
+            }
+            getNextEntry();
+            this.currEntry.setName(longName.toString());
+        }
+
         return this.currEntry;
     } 
 
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarOutputStream.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarOutputStream.java
index c8e1e52..29fba41 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarOutputStream.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarOutputStream.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -69,6 +69,10 @@ import java.io.*;
  * @author Timothy Gerard Endres <a href="mailto:time@ice.com">time@ice.com</a>
  */
 public class TarOutputStream extends FilterOutputStream {
+    static public final int LONGFILE_ERROR = 0;
+    static public final int LONGFILE_TRUNCATE = 1;
+    static public final int LONGFILE_GNU = 2;
+    
     protected boolean   debug;
     protected int       currSize;
     protected int       currBytes;
@@ -77,6 +81,7 @@ public class TarOutputStream extends FilterOutputStream {
     protected int       assemLen;
     protected byte[]    assemBuf;
     protected TarBuffer buffer;
+    protected int       longFileMode = LONGFILE_ERROR;
 
     public TarOutputStream(OutputStream os) {
         this(os, TarBuffer.DEFAULT_BLKSIZE, TarBuffer.DEFAULT_RCDSIZE);
@@ -97,6 +102,11 @@ public class TarOutputStream extends FilterOutputStream {
         this.oneBuf = new byte[1];
     }
 
+    public void setLongFileMode(int longFileMode) {
+        this.longFileMode = longFileMode;
+    }
+    
+
     /**
      * Sets the debugging flag.
      * 
@@ -154,6 +164,27 @@ public class TarOutputStream extends FilterOutputStream {
      * @param entry The TarEntry to be written to the archive.
      */
     public void putNextEntry(TarEntry entry) throws IOException {
+        if (entry.getName().length() >= TarConstants.NAMELEN) {
+
+            if (longFileMode == LONGFILE_GNU) {
+                // create a TarEntry for the LongLink, the contents
+                // of which are the entry's name 
+                TarEntry longLinkEntry = new TarEntry(TarConstants.GNU_LONGLINK,
+                                                      TarConstants.LF_GNUTYPE_LONGNAME);
+                 
+                longLinkEntry.setSize(entry.getName().length() + 1);
+                putNextEntry(longLinkEntry);                                                    
+                write(entry.getName().getBytes());
+                write(0);
+                closeEntry();
+            }
+            else if (longFileMode != LONGFILE_TRUNCATE) {
+                throw new RuntimeException("file name '" + entry.getName() 
+                                             + "' is too long ( > " 
+                                             + TarConstants.NAMELEN + " bytes)");
+            }
+        } 
+
         entry.writeEntryHeader(this.recordBuf);
         this.buffer.writeRecord(this.recordBuf);
 
@@ -210,7 +241,7 @@ public class TarOutputStream extends FilterOutputStream {
     /**
      * Writes bytes to the current tar archive entry.
      * 
-     * This method simply calls read( byte[], int, int ).
+     * This method simply calls write( byte[], int, int ).
      * 
      * @param wBuf The buffer to write to the archive.
      * @return The number of bytes read, or -1 at EOF.
@@ -228,8 +259,6 @@ public class TarOutputStream extends FilterOutputStream {
      * that are not a multiple of recordsize in length, including
      * assembling records from small buffers.
      * 
-     * This method simply calls read( byte[], int, int ).
-     * 
      * @param wBuf The buffer to write to the archive.
      * @param wOffset The offset in the buffer from which to get bytes.
      * @param numToWrite The number of bytes to write.
diff --git a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarUtils.java b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarUtils.java
index 71ff311..1274e04 100644
--- a/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarUtils.java
+++ b/jakarta-ant-1.2-src/src/main/org/apache/tools/tar/TarUtils.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/bin/ant b/jakarta-ant-1.2-src/src/script/ant
similarity index 52%
rename from jakarta-ant-1.2-src/src/bin/ant
rename to jakarta-ant-1.2-src/src/script/ant
index dff60be..b43cc18 100644
--- a/jakarta-ant-1.2-src/src/bin/ant
+++ b/jakarta-ant-1.2-src/src/script/ant
@@ -4,6 +4,22 @@ if [ -f $HOME/.antrc ] ; then
   . $HOME/.antrc
 fi
 
+# Cygwin support.  $cygwin _must_ be set to either true or false.
+case "`uname`" in
+  CYGWIN*) cygwin=true ;;
+  *) cygwin=false ;;
+esac
+
+# For Cygwin, ensure paths are in UNIX format before anything is touched
+if $cygwin; then
+  [ -n "$ANT_HOME" ] &&
+    ANT_HOME=`cygpath --unix "$ANT_HOME"`
+  [ -n "$JAVA_HOME" ] &&
+    JAVA_HOME=`cygpath --unix "$JAVA_HOME"`
+  [ -n "$CLASSPATH" ] &&
+    CLASSPATH=`cygpath --path --unix "$CLASSPATH"`
+fi
+
 if [ "$ANT_HOME" = "" ] ; then
   # try to find ANT
   if [ -d /opt/ant ] ; then 
@@ -32,12 +48,26 @@ if [ "$ANT_HOME" = "" ] ; then
 
 fi
 
-# Allow .antrc to specifiy flags to java cmd
-if [ "$JAVACMD" = "" ] ; then 
-  JAVACMD=java
+if [ "$JAVA_HOME" != "" ] ; then
+  if [ "$JAVACMD" = "" ] ; then 
+    JAVACMD=$JAVA_HOME/bin/java
+  fi
+else
+  if [ "$JAVACMD" = "" ] ; then 
+    JAVACMD=java
+  fi
 fi
-
-LOCALCLASSPATH=`echo $ANT_HOME/lib/*.jar | tr ' ' ':'`
+ 
+# add in the dependency .jar files
+DIRLIBS=${ANT_HOME}/lib/*.jar
+for i in ${DIRLIBS}
+do
+    # if the directory is empty, then it will return the input string
+    # this is stupid, so case for it
+    if [ "$i" != "${DIRLIBS}" ] ; then
+        LOCALCLASSPATH=$LOCALCLASSPATH:"$i"
+    fi
+done
 
 if [ "$CLASSPATH" != "" ] ; then
   LOCALCLASSPATH=$CLASSPATH:$LOCALCLASSPATH
@@ -67,5 +97,11 @@ if [ "$JIKESPATH" != "" ] ; then
   fi
 fi
 
-$JAVACMD -classpath $LOCALCLASSPATH -Dant.home=${ANT_HOME} $ANT_OPTS org.apache.tools.ant.Main $@
+# For Cygwin, switch paths to Windows format before running java
+if $cygwin; then
+  ANT_HOME=`cygpath --path --windows "$ANT_HOME"`
+  JAVA_HOME=`cygpath --path --windows "$JAVA_HOME"`
+  LOCALCLASSPATH=`cygpath --path --windows "$LOCALCLASSPATH"`
+fi
 
+$JAVACMD -classpath "$LOCALCLASSPATH" -Dant.home="${ANT_HOME}" $ANT_OPTS org.apache.tools.ant.Main "$@"
diff --git a/jakarta-ant-1.2-src/src/bin/ant.bat b/jakarta-ant-1.2-src/src/script/ant.bat
similarity index 55%
rename from jakarta-ant-1.2-src/src/bin/ant.bat
rename to jakarta-ant-1.2-src/src/script/ant.bat
index 6f9ee76..a69b2de 100644
--- a/jakarta-ant-1.2-src/src/bin/ant.bat
+++ b/jakarta-ant-1.2-src/src/script/ant.bat
@@ -1,19 +1,39 @@
 @echo off
 
+if exist "%HOME%\antrc_pre.bat" call "%HOME%\antrc_pre.bat"
+
+if not "%OS%"=="Windows_NT" goto win9xStart
+:winNTStart
+@setlocal
+
+rem %~dp0 is name of current script under NT
+set DEFAULT_ANT_HOME=%~dp0
+
+rem : operator works similar to make : operator
+set DEFAULT_ANT_HOME=%DEFAULT_ANT_HOME:\bin\=%
+
+if %ANT_HOME%a==a set ANT_HOME=%DEFAULT_ANT_HOME%
+set DEFAULT_ANT_HOME=
+
+rem On NT/2K grab all arguments at once
+set ANT_CMD_LINE_ARGS=%*
+goto doneStart
+
+:win9xStart
 rem Slurp the command line arguments.  This loop allows for an unlimited number of 
 rem agruments (up to the command line limit, anyway).
 
 set ANT_CMD_LINE_ARGS=
 
 :setupArgs
-if %1a==a goto doneArgs
+if %1a==a goto doneStart
 set ANT_CMD_LINE_ARGS=%ANT_CMD_LINE_ARGS% %1
 shift
 goto setupArgs
 
-:doneArgs
-rem The doneArgs label is here just to provide a place for the argument list loop
-rem to break out to.
+:doneStart
+rem This label provides a place for the argument list loop to break out 
+rem and for NT handling to skip to.
 
 rem find ANT_HOME
 if not "%ANT_HOME%"=="" goto checkJava
@@ -34,17 +54,18 @@ echo ANT_HOME is not set and ant could not be located. Please set ANT_HOME.
 goto end
 
 :checkJava
-if "%JAVACMD%" == "" set JAVACMD=java
-
-set LOCALCLASSPATH="%CLASSPATH%"
+set _JAVACMD=%JAVACMD%
+set LOCALCLASSPATH=%CLASSPATH%
 for %%i in ("%ANT_HOME%\lib\*.jar") do call "%ANT_HOME%\bin\lcp.bat" "%%i"
 
 if "%JAVA_HOME%" == "" goto noJavaHome
+if "%_JAVACMD%" == "" set _JAVACMD=%JAVA_HOME%\bin\java
 if exist "%JAVA_HOME%\lib\tools.jar" call "%ANT_HOME%\bin\lcp.bat" "%JAVA_HOME%\lib\tools.jar"
 if exist "%JAVA_HOME%\lib\classes.zip" call "%ANT_HOME%\bin\lcp.bat" "%JAVA_HOME%\lib\classes.zip"
 goto checkJikes
 
 :noJavaHome
+if "%_JAVACMD%" == "" set _JAVACMD=java
 echo.
 echo Warning: JAVA_HOME environment variable is not set.
 echo   If build fails because sun.* classes could not be found
@@ -56,13 +77,21 @@ echo.
 if not "%JIKESPATH%" == "" goto runAntWithJikes
 
 :runAnt
-%JAVACMD% -classpath %LOCALCLASSPATH% -Dant.home="%ANT_HOME%" %ANT_OPTS% org.apache.tools.ant.Main %ANT_CMD_LINE_ARGS%
+%_JAVACMD% -classpath %LOCALCLASSPATH% -Dant.home="%ANT_HOME%" %ANT_OPTS% org.apache.tools.ant.Main %ANT_CMD_LINE_ARGS%
 goto end
 
 :runAntWithJikes
-%JAVACMD% -classpath %LOCALCLASSPATH% -Dant.home="%ANT_HOME%" -Djikes.class.path=%JIKESPATH% %ANT_OPTS% org.apache.tools.ant.Main %ANT_CMD_LINE_ARGS%
+%_JAVACMD% -classpath %LOCALCLASSPATH% -Dant.home="%ANT_HOME%" -Djikes.class.path=%JIKESPATH% %ANT_OPTS% org.apache.tools.ant.Main %ANT_CMD_LINE_ARGS%
 
 :end
 set LOCALCLASSPATH=
+set _JAVACMD=
 set ANT_CMD_LINE_ARGS=
 
+if not "%OS%"=="Windows_NT" goto mainEnd
+:winNTend
+@endlocal
+
+:mainEnd
+if exist "%HOME%\antrc_post.bat" call "%HOME%\antrc_post.bat"
+
diff --git a/jakarta-ant-1.2-src/src/bin/antRun b/jakarta-ant-1.2-src/src/script/antRun
similarity index 100%
rename from jakarta-ant-1.2-src/src/bin/antRun
rename to jakarta-ant-1.2-src/src/script/antRun
diff --git a/jakarta-ant-1.2-src/src/bin/antRun.bat b/jakarta-ant-1.2-src/src/script/antRun.bat
similarity index 73%
rename from jakarta-ant-1.2-src/src/bin/antRun.bat
rename to jakarta-ant-1.2-src/src/script/antRun.bat
index a083cbf..816cb60 100644
--- a/jakarta-ant-1.2-src/src/bin/antRun.bat
+++ b/jakarta-ant-1.2-src/src/script/antRun.bat
@@ -1,6 +1,8 @@
 @echo off
 
+# Change drive and directory to %1 (Win9X only for NT/2K use "cd /d")
 cd %1
+%1\
 set ANT_RUN_CMD=%2
 shift
 shift
diff --git a/jakarta-ant-1.2-src/src/script/lcp.bat b/jakarta-ant-1.2-src/src/script/lcp.bat
new file mode 100644
index 0000000..9ac743e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/script/lcp.bat
@@ -0,0 +1,2 @@
+set LOCALCLASSPATH=%1;%LOCALCLASSPATH%
+
diff --git a/jakarta-ant-1.2-src/src/bin/runant.pl b/jakarta-ant-1.2-src/src/script/runant.pl
similarity index 100%
rename from jakarta-ant-1.2-src/src/bin/runant.pl
rename to jakarta-ant-1.2-src/src/script/runant.pl
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IncludeTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IncludeTest.java
new file mode 100644
index 0000000..67dba02
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IncludeTest.java
@@ -0,0 +1,94 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant;
+
+import org.apache.tools.ant.taskdefs.TaskdefsTest;
+
+/**
+ * Test the build file inclusion using XML entities.
+ *
+ * @author Conor MacNeill
+ */
+public class IncludeTest extends TaskdefsTest { 
+    
+    public IncludeTest(String name) { 
+        super(name);
+    }    
+    
+    public void test1() { 
+        configureProject("src/etc/testcases/core/include/basic/include.xml");
+        expectLog("test1", "from included entity");
+    }
+    
+    public void test2() { 
+        configureProject("src/etc/testcases/core/include/frag#ment/include.xml");
+        expectLog("test1", "from included entity");
+    }
+    
+    public void test3() { 
+        configureProject("src/etc/testcases/core/include/frag#ment/simple.xml");
+        expectLog("test1", "from simple buildfile");
+    }
+    
+    public void test4() { 
+        configureProject("src/etc/testcases/core/include/basic/relative.xml");
+        expectLog("test1", "from included entity");
+    }
+    
+    public void test5() { 
+        configureProject("src/etc/testcases/core/include/frag#ment/relative.xml");
+        expectLog("test1", "from included entity");
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IntrospectionHelperTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IntrospectionHelperTest.java
index 460333e..9c94562 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IntrospectionHelperTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/IntrospectionHelperTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/ProjectTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/ProjectTest.java
index 0e558f5..019e04e 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/ProjectTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/ProjectTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -63,7 +63,7 @@ import junit.framework.TestSuite;
 /**
  * Very limited test class for Project. Waiting to be extended.
  *
- * @author Stefan Bodewig <a href="mailto:stefan.bodewig@megabit.net">stefan.bodewig@megabit.net</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 public class ProjectTest extends TestCase {
 
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntStructureTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntStructureTest.java
index 75e480a..0e5b8de 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntStructureTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntStructureTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntTest.java
index 7d9db00..64e046d 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AntTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AvailableTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AvailableTest.java
index 214917d..4dae554 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AvailableTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/AvailableTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopydirTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopydirTest.java
index 69b1128..32a3479 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopydirTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopydirTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopyfileTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopyfileTest.java
index 50cbf2b..3e1b215 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopyfileTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/CopyfileTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeleteTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeleteTest.java
index 797f48f..92d0aba 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeleteTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeleteTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeltreeTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeltreeTest.java
index b50de21..c6bee10 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeltreeTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/DeltreeTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/EchoTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/EchoTest.java
index b774af4..e323668 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/EchoTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/EchoTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -69,21 +69,21 @@ public class EchoTest extends TaskdefsTest {
     
     // Output an empty String
     public void test1() { 
-        expectOutput("test1", "\n");
+        expectLog("test1", "");
     }
 
     // Output 'OUTPUT OF ECHO'
     public void test2() { 
-        expectOutput("test2", "OUTPUT OF ECHO\n");
+        expectLog("test2", "OUTPUT OF ECHO");
     }
     
     public void test3() { 
-        expectOutput("test3", "\n"+
+        expectLog("test3", "\n"+
                               "    This \n"+
                               "    is\n"+
                               "    a \n"+
                               "    multiline\n"+
                               "    message\n"+
-                              "    \n");
+                              "    ");
     }
 }
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ExecuteWatchdogTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ExecuteWatchdogTest.java
new file mode 100644
index 0000000..2219022
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ExecuteWatchdogTest.java
@@ -0,0 +1,196 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs;
+
+import java.net.*;
+import junit.framework.*;
+import java.io.*;
+
+/**
+ * Simple testcase for the ExecuteWatchdog class.
+ *
+ * @author <a href="mailto:sbailliez@imediation.com">Stephane Bailliez</a>
+ */
+public class ExecuteWatchdogTest extends TestCase {
+
+	private final static int TIME_OUT = 5000;
+
+	private final static String TEST_CLASSPATH = getTestClassPath();
+
+	private ExecuteWatchdog watchdog;
+
+	public ExecuteWatchdogTest(String name) {
+		super(name);
+	}
+
+	protected void setUp(){
+		watchdog = new ExecuteWatchdog(TIME_OUT);
+	}
+
+	/**
+	 * Dangerous method to obtain the classpath for the test. This is
+	 * severely tighted to the build.xml properties.
+	 */
+	private static String getTestClassPath(){
+		String classpath = System.getProperty("build.tests");
+		if (classpath == null) {
+			System.err.println("WARNING: 'build.tests' property is not available !");
+			classpath = System.getProperty("java.class.path");
+		}
+		return classpath;
+	}
+
+	private Process getProcess(int timetorun) throws Exception {
+		String[] cmdArray = {
+			"java", "-classpath", TEST_CLASSPATH,
+			TimeProcess.class.getName(), String.valueOf(timetorun)
+		};
+		//System.out.println("Testing with classpath: " + System.getProperty("java.class.path"));
+		return Runtime.getRuntime().exec(cmdArray);
+	}
+
+	private String getErrorOutput(Process p) throws Exception {
+		BufferedReader err = new BufferedReader( new InputStreamReader(p.getErrorStream()) );
+		StringBuffer buf = new StringBuffer();
+		String line;
+		while ( (line = err.readLine()) != null){
+			buf.append(line);
+		}
+		return buf.toString();
+	}
+	
+	private int waitForEnd(Process p) throws Exception {
+		int retcode = p.waitFor();
+		if (retcode != 0){
+			String err = getErrorOutput(p);
+			if (err.length() > 0){
+				System.err.println("ERROR:");
+				System.err.println(err);
+			}
+		}
+		return retcode;
+	}
+
+	public void testNoTimeOut() throws Exception {
+		Process process = getProcess(TIME_OUT/2);
+		watchdog.start(process);
+		int retCode = waitForEnd(process);
+		assert("process should not have been killed", !watchdog.killedProcess());
+		assertEquals(0, retCode);
+	}
+
+	// test that the watchdog ends the process
+	public void testTimeOut() throws Exception {
+		Process process = getProcess(TIME_OUT*2);
+		long now = System.currentTimeMillis();
+		watchdog.start(process);
+		int retCode = process.waitFor();
+		long elapsed = System.currentTimeMillis() - now;
+		assert("process should have been killed", watchdog.killedProcess());
+                //		assert("return code is invalid: " + retCode, retCode!=0);
+		assert("elapse time is less than timeout value", elapsed > TIME_OUT);
+		assert("elapse time is greater than run value", elapsed < TIME_OUT*2);
+	}
+
+	// test a process that runs and failed
+	public void testFailed() throws Exception {
+		Process process = getProcess(-1); // process should abort
+		watchdog.start(process);
+		int retCode = process.waitFor();
+		assert("process should not have been killed", !watchdog.killedProcess());
+		assert("return code is invalid: " + retCode, retCode!=0);
+	}
+
+	public void testManualStop() throws Exception {
+		final Process process = getProcess(TIME_OUT*2);
+		watchdog.start(process);
+
+		// I assume that starting this takes less than TIME_OUT/2 ms...
+		Thread thread = new Thread(){
+				public void run(){
+					try {
+						process.waitFor();
+					} catch(InterruptedException e){
+						// not very nice but will do the job
+						fail("process interrupted in thread");
+					}
+				}
+		};
+		thread.start();
+
+		// wait for TIME_OUT/2, there should be about TIME_OUT/2 ms remaining before timeout
+		thread.join(TIME_OUT/2);
+
+		 // now stop the watchdog.
+		watchdog.stop();
+
+		// wait for the thread to die, should be the end of the process
+		thread.join();
+
+		// process should be dead and well finished
+		assertEquals(0, process.exitValue());
+		assert("process should not have been killed", !watchdog.killedProcess());
+	}
+
+	public static class TimeProcess {
+		public static void main(String[] args) throws Exception {
+			int time = Integer.parseInt(args[0]);
+			if (time < 1) {
+				throw new IllegalArgumentException("Invalid time: " + time);
+			}
+			Thread.sleep(time);
+		}
+	}
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FailTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FailTest.java
index 8c616a9..c32d4fe 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FailTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FailTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FilterTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FilterTest.java
index 232bc4b..7307bf1 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FilterTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/FilterTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GUnzipTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GUnzipTest.java
index 9c52f88..fc88375 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GUnzipTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GUnzipTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GetTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GetTest.java
index cf85857..5cf20ff 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GetTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GetTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GzipTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GzipTest.java
index 97bce1f..cd3b337 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GzipTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/GzipTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/JarTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/JarTest.java
new file mode 100644
index 0000000..e3fa522
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/JarTest.java
@@ -0,0 +1,100 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs;
+
+import java.io.File;
+import java.util.Date;
+
+/**
+ * @author Erik Meade <emeade@geekfarm.org>
+ */
+public class JarTest extends TaskdefsTest {
+
+    private static long jarModifiedDate;
+    private static String tempJar = "src/etc/testcases/taskdefs/tmp.jar";
+
+    public JarTest(String name) {
+        super(name);
+    }
+
+    public void setUp() {
+        configureProject("src/etc/testcases/taskdefs/jar.xml");
+    }
+
+    public void test1() {
+        expectBuildException("test1", "required argument not specified");
+    }
+
+    public void test2() {
+        expectBuildException("test2", "manifect file does not exist");
+    }
+
+    public void test3() {
+        expectBuildException("test3", "Unrecognized whenempty attribute: format C: /y");
+    }
+
+    public void test4() {
+        executeTarget("test4");
+        File jarFile = new File(tempJar);
+        assert(jarFile.exists());
+        jarModifiedDate = jarFile.lastModified();
+    }
+
+    public void XXXtest5() {
+        executeTarget("test5");
+        File jarFile = new File(tempJar);
+        assertEquals(jarModifiedDate, jarFile.lastModified());
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/MkdirTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/MkdirTest.java
index 41b9783..8d5c09e 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/MkdirTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/MkdirTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -72,9 +72,7 @@ public class MkdirTest extends TaskdefsTest {
     }
 
     public void test2() {
-        executeTarget("test2");
-        String log = getLog();
-        assert(log.indexOf("Warning: Specified directory is a file: ") > -1);
+        expectBuildException("test2", "directory already exists as a file");
     }
 
     public void test3() { 
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/PropertyTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/PropertyTest.java
new file mode 100644
index 0000000..3b53785
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/PropertyTest.java
@@ -0,0 +1,74 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs;
+
+/**
+ * @author Conor MacNeill
+ */
+public class PropertyTest extends TaskdefsTest { 
+    
+    public PropertyTest(String name) { 
+        super(name);
+    }    
+    
+    public void setUp() { 
+        configureProject("src/etc/testcases/taskdefs/property.xml");
+    }
+
+    public void test1() { 
+        // should get no output at all
+        expectOutputAndError("test1", "", "");
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/RenameTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/RenameTest.java
index adea12a..e733bc7 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/RenameTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/RenameTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ReplaceTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ReplaceTest.java
index a8e1e13..7588a09 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ReplaceTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ReplaceTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -87,4 +87,16 @@ public class ReplaceTest extends TaskdefsTest {
         executeTarget("test5");
     }
 
+    public void test6() { 
+        expectBuildException("test6", "required argument not specified");
+    }
+
+    public void test7() { 
+        expectBuildException("test7", "empty token not allowed");
+    }
+
+    public void test8() { 
+        executeTarget("test8");
+    }
+
 }
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TarTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TarTest.java
index a3d7a3e..64ee759 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TarTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TarTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -79,4 +79,11 @@ public class TarTest extends TaskdefsTest {
         expectBuildException("test3", "required argument not specified");
     }
 
+    public void test4() { 
+        expectBuildException("test4", "tar cannot include itself");
+    }
+
+    public void tearDown() {
+        executeTarget("cleanup");
+    }
 }
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefTest.java
index 7ba24e1..5a7e865 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefsTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefsTest.java
index 33668f2..92eb4b5 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefsTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/TaskdefsTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -67,6 +67,7 @@ public abstract class TaskdefsTest extends TestCase {
     
     private StringBuffer logBuffer;
     private StringBuffer outBuffer;
+    private StringBuffer errBuffer;
     private BuildException buildException;
     
     public TaskdefsTest(String name) {
@@ -92,36 +93,54 @@ public abstract class TaskdefsTest extends TestCase {
         assertEquals(output, realOutput);
     }
 
+    protected void expectOutputAndError(String taskname, String output, String error) { 
+        executeTarget(taskname);
+        String realOutput = getOutput();
+        assertEquals(output, realOutput);
+        String realError = getError();
+        assertEquals(error, realError);
+    }
+
     protected void expectLog(String taskname, String log) { 
         executeTarget(taskname);
         String realLog = getLog();
         assertEquals(log, realLog);
     }
 
-    protected String getOutput() { 
-        StringBuffer cleanOut = new StringBuffer();
+    
+    protected String getOutput() {
+        return cleanBuffer(outBuffer);
+    }
+     
+    protected String getError() {
+        return cleanBuffer(errBuffer);
+    }
+        
+    private String cleanBuffer(StringBuffer buffer) {
+        StringBuffer cleanedBuffer = new StringBuffer();
         boolean cr = false;
-        for (int i = 0; i < outBuffer.length(); i++) { 
-            char ch = outBuffer.charAt(i);
+        for (int i = 0; i < buffer.length(); i++) { 
+            char ch = buffer.charAt(i);
             if (ch == '\r') {
                 cr = true;
                 continue;
             }
 
             if (!cr) { 
-                cleanOut.append(ch);
+                cleanedBuffer.append(ch);
             } else { 
                 if (ch == '\n') {
-                    cleanOut.append(ch);
+                    cleanedBuffer.append(ch);
                 } else {
-                    cleanOut.append('\r').append(ch);
+                    cleanedBuffer.append('\r').append(ch);
                 }
             }
         }
-        return cleanOut.toString();
+        return cleanedBuffer.toString();
     }
     
     protected void configureProject(String filename) { 
+        logBuffer = new StringBuffer();
         project = new Project();
         project.init();
         project.setUserProperty( "ant.file" , new File(filename).getAbsolutePath() );
@@ -131,16 +150,22 @@ public abstract class TaskdefsTest extends TestCase {
     
     protected void executeTarget(String targetName) { 
         PrintStream sysOut = System.out;
+        PrintStream sysErr = System.err;
         try { 
-            outBuffer = new StringBuffer();
             sysOut.flush();
+            sysErr.flush();
+            outBuffer = new StringBuffer();
             PrintStream out = new PrintStream(new AntOutputStream());
             System.setOut(out);
+            errBuffer = new StringBuffer();
+            PrintStream err = new PrintStream(new AntOutputStream());
+            System.setErr(err);
             logBuffer = new StringBuffer();
             buildException = null;
             project.executeTarget(targetName);
         } finally { 
             System.setOut(sysOut);
+            System.setErr(sysErr);
         }
         
     }
@@ -213,6 +238,7 @@ public abstract class TaskdefsTest extends TestCase {
          */
         public void messageLogged(BuildEvent event) {
             if (event.getPriority() == Project.MSG_INFO ||
+                event.getPriority() == Project.MSG_WARN ||
                 event.getPriority() == Project.MSG_ERR)
             {
                 logBuffer.append(event.getMessage());
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/UnzipTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/UnzipTest.java
index 66ced43..bc2f8fb 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/UnzipTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/UnzipTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ZipTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ZipTest.java
index 51da27f..5d82d62 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ZipTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/ZipTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -74,4 +74,17 @@ public class ZipTest extends TaskdefsTest {
     public void test2() { 
         expectBuildException("test2", "required argument not specified");
     }
+    
+    public void test3() { 
+        expectBuildException("test3", "zip cannot include itself");
+    }
+
+    public void test4() { 
+        expectBuildException("test4", "zip cannot include itself");
+    }
+    
+    public void tearDown() {
+        executeTarget("cleanup");
+    }
+    
 }
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/optional/ANTLRTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/optional/ANTLRTest.java
new file mode 100644
index 0000000..d98beb3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/taskdefs/optional/ANTLRTest.java
@@ -0,0 +1,110 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.taskdefs.optional;
+
+import java.io.*;
+import org.apache.tools.ant.taskdefs.TaskdefsTest;
+/**
+ * @author Erik Meade <emeade@geekfarm.org>
+ */
+public class ANTLRTest extends TaskdefsTest {
+
+    private final static String TASKDEFS_DIR = "src/etc/testcases/taskdefs/optional/antlr/";
+
+    public ANTLRTest(String name) {
+        super(name);
+    }
+
+    public void setUp() {
+        configureProject(TASKDEFS_DIR + "antlr.xml");
+    }
+
+    public void test1() {
+        expectBuildException("test1", "required argument, target, missing");
+    }
+
+    public void test2() {
+        expectBuildException("test2", "Invalid output directory");
+    }
+
+    public void test3() {
+        executeTarget("test3");
+        File outputDirectory = new File(TASKDEFS_DIR + "antlr.tmp");
+        String[] calcFiles = outputDirectory.list(new CalcFileFilter());
+        assert(5 == calcFiles.length);
+    }
+
+    public void test4() {
+        executeTarget("test4");
+    }
+
+    public void test5() {
+        expectBuildException("test5", "Invalid working directory");
+    }
+
+    public void test6() {
+        executeTarget("test6");
+    }
+
+    public void test7() {
+        expectBuildException("test7", "Unable to determine generated class");
+    }
+}
+
+class CalcFileFilter implements FilenameFilter {
+    public boolean accept(File dir, String name) {
+        return name.startsWith("Calc");
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineJavaTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineJavaTest.java
index 87c061b..6c9a8a7 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineJavaTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineJavaTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -64,7 +64,7 @@ import java.io.File;
 /**
  * JUnit 3 testcases for org.apache.tools.ant.CommandlineJava
  *
- * @author Stefan Bodewig <a href="mailto:stefan.bodewig@megabit.net">stefan.bodewig@megabit.net</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 public class CommandlineJavaTest extends TestCase {
 
@@ -77,6 +77,7 @@ public class CommandlineJavaTest extends TestCase {
     public void setUp() {
         project = new Project();
         project.setBasedir(".");
+        project.setProperty("build.sysclasspath", "ignore");
     }
 
     public void testGetCommandline() {
@@ -91,9 +92,14 @@ public class CommandlineJavaTest extends TestCase {
         assertEquals("no classpath", "junit.textui.TestRunner", s[2]);
         assertEquals("no classpath", 
                      "org.apache.tools.ant.CommandlineJavaTest", s[3]);
+        try {
+            CommandlineJava c2 = (CommandlineJava) c.clone();
+        } catch (NullPointerException ex) {
+            fail("cloning should work without classpath specified");
+        }
 
-        c.createClasspath(project).setLocation(new File("junit.jar"));
-        c.createClasspath(project).setLocation(new File("ant.jar"));
+        c.createClasspath(project).setLocation(project.resolveFile("lib/optional/junit.jar"));
+        c.createClasspath(project).setLocation(project.resolveFile("bootstrap/lib/ant.jar"));
         s = c.getCommandline();
         assertEquals("with classpath", 6, s.length);
         assertEquals("with classpath", "java", s[0]);
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineTest.java
index d4a5ed9..20154fb 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/CommandlineTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/EnumeratedAttributeTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/EnumeratedAttributeTest.java
index c9dc8a0..92ea5f2 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/EnumeratedAttributeTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/EnumeratedAttributeTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/FileSetTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/FileSetTest.java
index a939447..05dc171 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/FileSetTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/FileSetTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/MapperTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/MapperTest.java
new file mode 100644
index 0000000..b4a599e
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/MapperTest.java
@@ -0,0 +1,198 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.types;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Project;
+import org.apache.tools.ant.util.*;
+import org.apache.tools.ant.taskdefs.TaskdefsTest;
+
+import junit.framework.TestCase;
+import junit.framework.AssertionFailedError;
+
+import java.io.File;
+
+/**
+ * JUnit 3 testcases for org.apache.tools.ant.types.Mapper.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+
+public class MapperTest extends TestCase {
+
+    private Project project;
+
+    public MapperTest(String name) {
+        super(name);
+    }
+
+    public void setUp() {
+        project = new Project();
+        project.setBasedir(".");
+    }
+
+    public void testEmptyElementIfIsReference() {
+        Mapper m = new Mapper(project);
+        m.setFrom("*.java");
+        try {
+            m.setRefid(new Reference("dummyref"));
+            fail("Can add reference to Mapper with from attribute set");
+        } catch (BuildException be) {
+            assertEquals("You must not specify more than one attribute when using refid",
+                         be.getMessage());
+        }
+
+        m = new Mapper(project);
+        m.setRefid(new Reference("dummyref"));
+        try {
+            m.setFrom("*.java");
+            fail("Can set from in Mapper that is a reference.");
+        } catch (BuildException be) {
+            assertEquals("You must not specify more than one attribute when using refid",
+                         be.getMessage());
+        }
+
+        m = new Mapper(project);
+        m.setRefid(new Reference("dummyref"));
+        try {
+            m.setTo("*.java");
+            fail("Can set to in Mapper that is a reference.");
+        } catch (BuildException be) {
+            assertEquals("You must not specify more than one attribute when using refid",
+                         be.getMessage());
+        }
+        try {
+            Mapper.MapperType mt = new Mapper.MapperType();
+            mt.setValue("glob");
+            m.setType(mt);
+            fail("Can set type in Mapper that is a reference.");
+        } catch (BuildException be) {
+            assertEquals("You must not specify more than one attribute when using refid",
+                         be.getMessage());
+        }
+    }
+
+    public void testCircularReferenceCheck() {
+        Mapper m = new Mapper(project);
+        project.addReference("dummy", m);
+        m.setRefid(new Reference("dummy"));
+        try {
+            m.getImplementation();
+            fail("Can make Mapper a Reference to itself.");
+        } catch (BuildException be) {
+            assertEquals("This data type contains a circular reference.",
+                         be.getMessage());
+        }
+
+        // dummy1 --> dummy2 --> dummy3 --> dummy1
+        Mapper m1 = new Mapper(project);
+        project.addReference("dummy1", m1);
+        m1.setRefid(new Reference("dummy2"));
+        Mapper m2 = new Mapper(project);
+        project.addReference("dummy2", m2);
+        m2.setRefid(new Reference("dummy3"));
+        Mapper m3 = new Mapper(project);
+        project.addReference("dummy3", m3);
+        m3.setRefid(new Reference("dummy1"));
+        try {
+            m1.getImplementation();
+            fail("Can make circular reference.");
+        } catch (BuildException be) {
+            assertEquals("This data type contains a circular reference.",
+                         be.getMessage());
+        }
+
+        // dummy1 --> dummy2 --> dummy3 
+        // (which holds a glob mapper from "*.java" to "*.class"
+        m1 = new Mapper(project);
+        project.addReference("dummy1", m1);
+        m1.setRefid(new Reference("dummy2"));
+        m2 = new Mapper(project);
+        project.addReference("dummy2", m2);
+        m2.setRefid(new Reference("dummy3"));
+        m3 = new Mapper(project);
+        project.addReference("dummy3", m3);
+        Mapper.MapperType mt = new Mapper.MapperType();
+        mt.setValue("glob");
+        m3.setType(mt);
+        m3.setFrom("*.java");
+        m3.setTo("*.class");
+        FileNameMapper fmm = m1.getImplementation();
+        assert("should be glob", fmm instanceof GlobPatternMapper);
+        String[] result = fmm.mapFileName("a.java");
+        assertEquals("a.java should match", 1, result.length);
+        assertEquals("a.class", result[0]);
+    }
+
+    public void testCopyTaskWithTwoFilesets() {
+        TaskdefForCopyTest t = new TaskdefForCopyTest("test1");
+        t.setUp();
+        t.test1();
+    }
+
+    private class TaskdefForCopyTest extends TaskdefsTest {
+        TaskdefForCopyTest(String name) {
+            super(name);
+        }
+
+        public void setUp() { 
+            configureProject("src/etc/testcases/types/mapper.xml");
+        }
+
+        public void test1() { 
+            executeTarget("test1");
+        }
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PathTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PathTest.java
index ea2cd21..1093fb4 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PathTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PathTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PatternSetTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PatternSetTest.java
index f68d4c3..1a81687 100644
--- a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PatternSetTest.java
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/types/PatternSetTest.java
@@ -23,7 +23,7 @@
  *    Alternately, this acknowlegement may appear in the software itself,
  *    if and wherever such third-party acknowlegements normally appear.
  *
- * 4. The names "The Jakarta Project", "Tomcat", and "Apache Software
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
  *    Foundation" must not be used to endorse or promote products derived
  *    from this software without prior written permission. For written
  *    permission, please contact apache@apache.org.
@@ -65,9 +65,9 @@ import java.io.File;
 /**
  * JUnit 3 testcases for org.apache.tools.ant.types.PatternSet.
  *
- * <p>This doesn't actually test much, mainly reference handling.
+ * <p>This doesn't actually test much, mainly reference handling.</p>
  *
- * @author <a href="mailto:stefan.bodewig@megabit.net">Stefan Bodewig</a> 
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
  */
 
 public class PatternSetTest extends TestCase {
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/DOMElementWriterTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/DOMElementWriterTest.java
new file mode 100644
index 0000000..7290ebb
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/DOMElementWriterTest.java
@@ -0,0 +1,104 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+import junit.framework.Test;
+import junit.framework.TestCase;
+import junit.framework.TestSuite;
+
+/**
+ * Tests for org.apache.tools.ant.util.DOMElementWriter.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class DOMElementWriterTest extends TestCase {
+
+    private DOMElementWriter w = new DOMElementWriter();
+
+    public DOMElementWriterTest(String name) {
+        super(name);
+    }
+
+    public void testIsReference() {
+        assert("&#20;", w.isReference("&#20;"));
+        assert("&#x20;", w.isReference("&#x20;"));
+        assert("&#xA0;", w.isReference("&#xA0;"));
+        assert("&#A0;", !w.isReference("&#A0;"));
+        assert("20;", !w.isReference("20;"));
+        assert("&#20", !w.isReference("&#20"));
+        assert("&quot;", w.isReference("&quot;"));
+        assert("&apos;", w.isReference("&apos;"));
+        assert("&gt;", w.isReference("&gt;"));
+        assert("&lt;", w.isReference("&lt;"));
+        assert("&amp;", w.isReference("&amp;"));
+    }
+
+    public void testEncode() {
+        assertEquals("&#20;", w.encode("&#20;"));
+        assertEquals("&#x20;", w.encode("&#x20;"));
+        assertEquals("&#xA0;", w.encode("&#xA0;"));
+        assertEquals("&amp;#A0;", w.encode("&#A0;"));
+        assertEquals("20;", w.encode("20;"));
+        assertEquals("&amp;#20", w.encode("&#20"));
+        assertEquals("&quot;", w.encode("&quot;"));
+        assertEquals("&apos;", w.encode("&apos;"));
+        assertEquals("&gt;", w.encode("&gt;"));
+        assertEquals("&lt;", w.encode("&lt;"));
+        assertEquals("&amp;", w.encode("&amp;"));
+        assertEquals("&quot;", w.encode("\""));
+        assertEquals("&lt;", w.encode("<"));
+        assertEquals("&amp;", w.encode("&"));
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/GlobPatternMapperTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/GlobPatternMapperTest.java
new file mode 100644
index 0000000..1b293d6
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/GlobPatternMapperTest.java
@@ -0,0 +1,137 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util;
+
+import junit.framework.Test;
+import junit.framework.TestCase;
+import junit.framework.TestSuite;
+
+/**
+ * Tests for org.apache.tools.ant.util;GlobPatternMapper.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class GlobPatternMapperTest extends TestCase {
+
+    public GlobPatternMapperTest(String name) {
+        super(name);
+    }
+
+    public void testNoPatternAtAll() {
+        GlobPatternMapper m = new GlobPatternMapper();
+        m.setFrom("foobar");
+        m.setTo("baz");
+        assertNull("Shouldn\'t match foobar", m.mapFileName("plonk"));
+        String[] result = m.mapFileName("foobar");
+        assertNotNull("Should match foobar", result);
+        assertEquals("only one result for foobar", 1, result.length);
+        assertEquals("baz", result[0]);
+    }
+
+    public void testPostfixOnly() {
+        GlobPatternMapper m = new GlobPatternMapper();
+        m.setFrom("*foo");
+        m.setTo("*plonk");
+        assertNull("Shouldn\'t match *foo", m.mapFileName("bar.baz"));
+        String[] result = m.mapFileName("bar.foo");
+        assertNotNull("Should match *.foo", result);
+        assertEquals("only one result for bar.foo", 1, result.length);
+        assertEquals("bar.plonk", result[0]);
+
+        // Try a silly case
+        m.setTo("foo*");
+        result = m.mapFileName("bar.foo");
+        assertEquals("foobar.", result[0]);
+    }
+
+    public void testPrefixOnly() {
+        GlobPatternMapper m = new GlobPatternMapper();
+        m.setFrom("foo*");
+        m.setTo("plonk*");
+        assertNull("Shouldn\'t match foo*", m.mapFileName("bar.baz"));
+        String[] result = m.mapFileName("foo.bar");
+        assertNotNull("Should match foo*", result);
+        assertEquals("only one result for foo.bar", 1, result.length);
+        assertEquals("plonk.bar", result[0]);
+
+        // Try a silly case
+        m.setTo("*foo");
+        result = m.mapFileName("foo.bar");
+        assertEquals(".barfoo", result[0]);
+    }
+
+    public void testPreAndPostfix() {
+        GlobPatternMapper m = new GlobPatternMapper();
+        m.setFrom("foo*bar");
+        m.setTo("plonk*pling");
+        assertNull("Shouldn\'t match foo*bar", m.mapFileName("bar.baz"));
+        String[] result = m.mapFileName("foo.bar");
+        assertNotNull("Should match foo*bar", result);
+        assertEquals("only one result for foo.bar", 1, result.length);
+        assertEquals("plonk.pling", result[0]);
+
+        // and a little longer
+        result = m.mapFileName("foo.baz.bar");
+        assertNotNull("Should match foo*bar", result);
+        assertEquals("only one result for foo.baz.bar", 1, result.length);
+        assertEquals("plonk.baz.pling", result[0]);
+
+        // and a little shorter
+        result = m.mapFileName("foobar");
+        assertNotNull("Should match foo*bar", result);
+        assertEquals("only one result for foobar", 1, result.length);
+        assertEquals("plonkpling", result[0]);
+    }
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaOroMatcherTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaOroMatcherTest.java
new file mode 100644
index 0000000..f1a6ec3
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaOroMatcherTest.java
@@ -0,0 +1,72 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+/**
+ * Tests for the jakarta-oro implementation of the OroMatcher interface.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class JakartaOroMatcherTest extends RegexpMatcherTest {
+
+    public RegexpMatcher getImplementation() {
+        return new JakartaOroMatcher();
+    }
+
+    public JakartaOroMatcherTest(String name) {
+        super(name);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaRegexpMatcherTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaRegexpMatcherTest.java
new file mode 100644
index 0000000..16d3e29
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/JakartaRegexpMatcherTest.java
@@ -0,0 +1,72 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+/**
+ * Tests for the jakarta-regexp implementation of the RegexpMatcher interface.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public class JakartaRegexpMatcherTest extends RegexpMatcherTest {
+
+    public RegexpMatcher getImplementation() {
+        return new JakartaRegexpMatcher();
+    }
+
+    public JakartaRegexpMatcherTest(String name) {
+        super(name);
+    }
+
+}
diff --git a/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/RegexpMatcherTest.java b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/RegexpMatcherTest.java
new file mode 100644
index 0000000..9959906
--- /dev/null
+++ b/jakarta-ant-1.2-src/src/testcases/org/apache/tools/ant/util/regexp/RegexpMatcherTest.java
@@ -0,0 +1,126 @@
+/*
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution, if
+ *    any, must include the following acknowlegement:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowlegement may appear in the software itself,
+ *    if and wherever such third-party acknowlegements normally appear.
+ *
+ * 4. The names "The Jakarta Project", "Ant", and "Apache Software
+ *    Foundation" must not be used to endorse or promote products derived
+ *    from this software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache"
+ *    nor may "Apache" appear in their names without prior written
+ *    permission of the Apache Group.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.tools.ant.util.regexp;
+
+import java.util.Vector;
+
+import junit.framework.Test;
+import junit.framework.TestCase;
+import junit.framework.TestSuite;
+
+/**
+ * Tests for all implementations of the RegexpMatcher interface.
+ *
+ * @author <a href="mailto:stefan.bodewig@epost.de">Stefan Bodewig</a> 
+ */
+public abstract class RegexpMatcherTest extends TestCase {
+
+    public abstract RegexpMatcher getImplementation();
+
+    public RegexpMatcherTest(String name) {
+        super(name);
+    }
+
+    public void testMatches() {
+        RegexpMatcher reg = getImplementation();
+        reg.setPattern("aaaa");
+        assert("aaaa should match itself", reg.matches("aaaa"));
+        assert("aaaa should match xaaaa", reg.matches("xaaaa"));
+        assert("aaaa shouldn\'t match xaaa", !reg.matches("xaaa"));
+        reg.setPattern("^aaaa");
+        assert("^aaaa shouldn\'t match xaaaa", !reg.matches("xaaaa"));
+        assert("^aaaa should match aaaax", reg.matches("aaaax"));
+        reg.setPattern("aaaa$");
+        assert("aaaa$ shouldn\'t match aaaax", !reg.matches("aaaax"));
+        assert("aaaa$ should match xaaaa", reg.matches("xaaaa"));
+        reg.setPattern("[0-9]+");
+        assert("[0-9]+ should match 123", reg.matches("123"));
+        assert("[0-9]+ should match 1", reg.matches("1"));
+        assert("[0-9]+ shouldn\'t match \'\'", !reg.matches(""));
+        assert("[0-9]+ shouldn\'t match a", !reg.matches("a"));
+        reg.setPattern("[0-9]*");
+        assert("[0-9]* should match 123", reg.matches("123"));
+        assert("[0-9]* should match 1", reg.matches("1"));
+        assert("[0-9]* should match \'\'", reg.matches(""));
+        assert("[0-9]* should match a", reg.matches("a"));
+        reg.setPattern("([0-9]+)=\\1");
+        assert("([0-9]+)=\\1 should match 1=1", reg.matches("1=1"));
+        assert("([0-9]+)=\\1 shouldn\'t match 1=2", !reg.matches("1=2"));
+    }
+
+    public void testGroups() {
+        RegexpMatcher reg = getImplementation();
+        reg.setPattern("aaaa");
+        Vector v = reg.getGroups("xaaaa");
+        assertEquals("No parens -> no extra groups", 1, v.size());
+        assertEquals("Trivial match with no parens", "aaaa", 
+                     (String) v.elementAt(0));
+
+        reg.setPattern("(aaaa)");
+        v = reg.getGroups("xaaaa");
+        assertEquals("Trivial match with single paren", 2, v.size());
+        assertEquals("Trivial match with single paren, full match", "aaaa", 
+                     (String) v.elementAt(0));
+        assertEquals("Trivial match with single paren, matched paren", "aaaa", 
+                     (String) v.elementAt(0));
+
+        reg.setPattern("(a+)b(b+)");
+        v = reg.getGroups("xaabb");
+        assertEquals(3, v.size());
+        assertEquals("aabb", (String) v.elementAt(0));
+        assertEquals("aa", (String) v.elementAt(1));
+        assertEquals("b", (String) v.elementAt(2));
+    }
+}
